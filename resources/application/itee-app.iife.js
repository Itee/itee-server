(function () {
  'use strict';

  var _typeof=typeof Symbol==="function"&&typeof Symbol.iterator==="symbol"?function(obj){return typeof obj;}:function(obj){return obj&&typeof Symbol==="function"&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":typeof obj;};var classCallCheck=function(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function");}};var createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor);}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor;};}();var defineProperty=function(obj,key,value){if(key in obj){Object.defineProperty(obj,key,{value:value,enumerable:true,configurable:true,writable:true});}else{obj[key]=value;}return obj;};var inherits=function(subClass,superClass){if(typeof superClass!=="function"&&superClass!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof superClass);}subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:false,writable:true,configurable:true}});if(superClass)Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass;};var possibleConstructorReturn=function(self,call){if(!self){throw new ReferenceError("this hasn't been initialised - super() hasn't been called");}return call&&(typeof call==="object"||typeof call==="function")?call:self;};// Polyfills
  if(Number.EPSILON===undefined){Number.EPSILON=Math.pow(2,-52);}if(Number.isInteger===undefined){// Missing in IE
  // https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Number/isInteger
  Number.isInteger=function(value){return typeof value==='number'&&isFinite(value)&&Math.floor(value)===value;};}//
  if(Math.sign===undefined){// https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Math/sign
  Math.sign=function(x){return x<0?-1:x>0?1:+x;};}if('name'in Function.prototype===false){// Missing in IE
  // https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Function/name
  Object.defineProperty(Function.prototype,'name',{get:function get$$1(){return this.toString().match(/^\s*function\s*([^\(\s]*)/)[1];}});}if(Object.assign===undefined){// Missing in IE
  // https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Object/assign
  (function(){Object.assign=function(target){var arguments$1=arguments;if(target===undefined||target===null){throw new TypeError('Cannot convert undefined or null to object');}var output=Object(target);for(var index=1;index<arguments.length;index++){var source=arguments$1[index];if(source!==undefined&&source!==null){for(var nextKey in source){if(Object.prototype.hasOwnProperty.call(source,nextKey)){output[nextKey]=source[nextKey];}}}}return output;};})();}/**
   * @author alteredq / http://alteredqualia.com/
   * @author mrdoob / http://mrdoob.com/
   */var _Math$1={DEG2RAD:Math.PI/180,RAD2DEG:180/Math.PI,generateUUID:function(){// http://stackoverflow.com/questions/105034/how-to-create-a-guid-uuid-in-javascript/21963136#21963136
  var lut=[];for(var i=0;i<256;i++){lut[i]=(i<16?'0':'')+i.toString(16).toUpperCase();}return function(){var d0=Math.random()*0xffffffff|0;var d1=Math.random()*0xffffffff|0;var d2=Math.random()*0xffffffff|0;var d3=Math.random()*0xffffffff|0;return lut[d0&0xff]+lut[d0>>8&0xff]+lut[d0>>16&0xff]+lut[d0>>24&0xff]+'-'+lut[d1&0xff]+lut[d1>>8&0xff]+'-'+lut[d1>>16&0x0f|0x40]+lut[d1>>24&0xff]+'-'+lut[d2&0x3f|0x80]+lut[d2>>8&0xff]+'-'+lut[d2>>16&0xff]+lut[d2>>24&0xff]+lut[d3&0xff]+lut[d3>>8&0xff]+lut[d3>>16&0xff]+lut[d3>>24&0xff];};}(),clamp:function clamp(value,min,max){return Math.max(min,Math.min(max,value));},// compute euclidian modulo of m % n
  // https://en.wikipedia.org/wiki/Modulo_operation
  euclideanModulo:function euclideanModulo(n,m){return(n%m+m)%m;},// Linear mapping from range <a1, a2> to range <b1, b2>
  mapLinear:function mapLinear(x,a1,a2,b1,b2){return b1+(x-a1)*(b2-b1)/(a2-a1);},// https://en.wikipedia.org/wiki/Linear_interpolation
  lerp:function lerp(x,y,t){return(1-t)*x+t*y;},// http://en.wikipedia.org/wiki/Smoothstep
  smoothstep:function smoothstep(x,min,max){if(x<=min){return 0;}if(x>=max){return 1;}x=(x-min)/(max-min);return x*x*(3-2*x);},smootherstep:function smootherstep(x,min,max){if(x<=min){return 0;}if(x>=max){return 1;}x=(x-min)/(max-min);return x*x*x*(x*(x*6-15)+10);},// Random integer from <low, high> interval
  randInt:function randInt(low,high){return low+Math.floor(Math.random()*(high-low+1));},// Random float from <low, high> interval
  randFloat:function randFloat(low,high){return low+Math.random()*(high-low);},// Random float from <-range/2, range/2> interval
  randFloatSpread:function randFloatSpread(range){return range*(0.5-Math.random());},degToRad:function degToRad(degrees){return degrees*_Math$1.DEG2RAD;},radToDeg:function radToDeg(radians){return radians*_Math$1.RAD2DEG;},isPowerOfTwo:function isPowerOfTwo(value){return(value&value-1)===0&&value!==0;},ceilPowerOfTwo:function ceilPowerOfTwo(value){return Math.pow(2,Math.ceil(Math.log(value)/Math.LN2));},floorPowerOfTwo:function floorPowerOfTwo(value){return Math.pow(2,Math.floor(Math.log(value)/Math.LN2));}};/**
   * @author mrdoob / http://mrdoob.com/
   * @author supereggbert / http://www.paulbrunt.co.uk/
   * @author philogb / http://blog.thejit.org/
   * @author jordi_ros / http://plattsoft.com
   * @author D1plo1d / http://github.com/D1plo1d
   * @author alteredq / http://alteredqualia.com/
   * @author mikael emtinger / http://gomo.se/
   * @author timknip / http://www.floorplanner.com/
   * @author bhouston / http://clara.io
   * @author WestLangley / http://github.com/WestLangley
   */function Matrix4(){this.elements=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1];if(arguments.length>0){console.error('THREE.Matrix4: the constructor no longer reads arguments. use .set() instead.');}}Object.assign(Matrix4.prototype,{isMatrix4:true,set:function set$$1(n11,n12,n13,n14,n21,n22,n23,n24,n31,n32,n33,n34,n41,n42,n43,n44){var te=this.elements;te[0]=n11;te[4]=n12;te[8]=n13;te[12]=n14;te[1]=n21;te[5]=n22;te[9]=n23;te[13]=n24;te[2]=n31;te[6]=n32;te[10]=n33;te[14]=n34;te[3]=n41;te[7]=n42;te[11]=n43;te[15]=n44;return this;},identity:function identity(){this.set(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1);return this;},clone:function clone(){return new Matrix4().fromArray(this.elements);},copy:function copy(m){var te=this.elements;var me=m.elements;te[0]=me[0];te[1]=me[1];te[2]=me[2];te[3]=me[3];te[4]=me[4];te[5]=me[5];te[6]=me[6];te[7]=me[7];te[8]=me[8];te[9]=me[9];te[10]=me[10];te[11]=me[11];te[12]=me[12];te[13]=me[13];te[14]=me[14];te[15]=me[15];return this;},copyPosition:function copyPosition(m){var te=this.elements,me=m.elements;te[12]=me[12];te[13]=me[13];te[14]=me[14];return this;},extractBasis:function extractBasis(xAxis,yAxis,zAxis){xAxis.setFromMatrixColumn(this,0);yAxis.setFromMatrixColumn(this,1);zAxis.setFromMatrixColumn(this,2);return this;},makeBasis:function makeBasis(xAxis,yAxis,zAxis){this.set(xAxis.x,yAxis.x,zAxis.x,0,xAxis.y,yAxis.y,zAxis.y,0,xAxis.z,yAxis.z,zAxis.z,0,0,0,0,1);return this;},extractRotation:function(){var v1=new Vector3$1();return function extractRotation(m){var te=this.elements;var me=m.elements;var scaleX=1/v1.setFromMatrixColumn(m,0).length();var scaleY=1/v1.setFromMatrixColumn(m,1).length();var scaleZ=1/v1.setFromMatrixColumn(m,2).length();te[0]=me[0]*scaleX;te[1]=me[1]*scaleX;te[2]=me[2]*scaleX;te[4]=me[4]*scaleY;te[5]=me[5]*scaleY;te[6]=me[6]*scaleY;te[8]=me[8]*scaleZ;te[9]=me[9]*scaleZ;te[10]=me[10]*scaleZ;return this;};}(),makeRotationFromEuler:function makeRotationFromEuler(euler){if(!(euler&&euler.isEuler)){console.error('THREE.Matrix4: .makeRotationFromEuler() now expects a Euler rotation rather than a Vector3 and order.');}var te=this.elements;var x=euler.x,y=euler.y,z=euler.z;var a=Math.cos(x),b=Math.sin(x);var c=Math.cos(y),d=Math.sin(y);var e=Math.cos(z),f=Math.sin(z);if(euler.order==='XYZ'){var ae=a*e,af=a*f,be=b*e,bf=b*f;te[0]=c*e;te[4]=-c*f;te[8]=d;te[1]=af+be*d;te[5]=ae-bf*d;te[9]=-b*c;te[2]=bf-ae*d;te[6]=be+af*d;te[10]=a*c;}else if(euler.order==='YXZ'){var ce=c*e,cf=c*f,de=d*e,df=d*f;te[0]=ce+df*b;te[4]=de*b-cf;te[8]=a*d;te[1]=a*f;te[5]=a*e;te[9]=-b;te[2]=cf*b-de;te[6]=df+ce*b;te[10]=a*c;}else if(euler.order==='ZXY'){var ce=c*e,cf=c*f,de=d*e,df=d*f;te[0]=ce-df*b;te[4]=-a*f;te[8]=de+cf*b;te[1]=cf+de*b;te[5]=a*e;te[9]=df-ce*b;te[2]=-a*d;te[6]=b;te[10]=a*c;}else if(euler.order==='ZYX'){var ae=a*e,af=a*f,be=b*e,bf=b*f;te[0]=c*e;te[4]=be*d-af;te[8]=ae*d+bf;te[1]=c*f;te[5]=bf*d+ae;te[9]=af*d-be;te[2]=-d;te[6]=b*c;te[10]=a*c;}else if(euler.order==='YZX'){var ac=a*c,ad=a*d,bc=b*c,bd=b*d;te[0]=c*e;te[4]=bd-ac*f;te[8]=bc*f+ad;te[1]=f;te[5]=a*e;te[9]=-b*e;te[2]=-d*e;te[6]=ad*f+bc;te[10]=ac-bd*f;}else if(euler.order==='XZY'){var ac=a*c,ad=a*d,bc=b*c,bd=b*d;te[0]=c*e;te[4]=-f;te[8]=d*e;te[1]=ac*f+bd;te[5]=a*e;te[9]=ad*f-bc;te[2]=bc*f-ad;te[6]=b*e;te[10]=bd*f+ac;}// last column
  te[3]=0;te[7]=0;te[11]=0;// bottom row
  te[12]=0;te[13]=0;te[14]=0;te[15]=1;return this;},makeRotationFromQuaternion:function makeRotationFromQuaternion(q){var te=this.elements;var x=q._x,y=q._y,z=q._z,w=q._w;var x2=x+x,y2=y+y,z2=z+z;var xx=x*x2,xy=x*y2,xz=x*z2;var yy=y*y2,yz=y*z2,zz=z*z2;var wx=w*x2,wy=w*y2,wz=w*z2;te[0]=1-(yy+zz);te[4]=xy-wz;te[8]=xz+wy;te[1]=xy+wz;te[5]=1-(xx+zz);te[9]=yz-wx;te[2]=xz-wy;te[6]=yz+wx;te[10]=1-(xx+yy);// last column
  te[3]=0;te[7]=0;te[11]=0;// bottom row
  te[12]=0;te[13]=0;te[14]=0;te[15]=1;return this;},lookAt:function(){var x=new Vector3$1();var y=new Vector3$1();var z=new Vector3$1();return function lookAt(eye,target,up){var te=this.elements;z.subVectors(eye,target);if(z.lengthSq()===0){// eye and target are in the same position
  z.z=1;}z.normalize();x.crossVectors(up,z);if(x.lengthSq()===0){// up and z are parallel
  if(Math.abs(up.z)===1){z.x+=0.0001;}else{z.z+=0.0001;}z.normalize();x.crossVectors(up,z);}x.normalize();y.crossVectors(z,x);te[0]=x.x;te[4]=y.x;te[8]=z.x;te[1]=x.y;te[5]=y.y;te[9]=z.y;te[2]=x.z;te[6]=y.z;te[10]=z.z;return this;};}(),multiply:function multiply(m,n){if(n!==undefined){console.warn('THREE.Matrix4: .multiply() now only accepts one argument. Use .multiplyMatrices( a, b ) instead.');return this.multiplyMatrices(m,n);}return this.multiplyMatrices(this,m);},premultiply:function premultiply(m){return this.multiplyMatrices(m,this);},multiplyMatrices:function multiplyMatrices(a,b){var ae=a.elements;var be=b.elements;var te=this.elements;var a11=ae[0],a12=ae[4],a13=ae[8],a14=ae[12];var a21=ae[1],a22=ae[5],a23=ae[9],a24=ae[13];var a31=ae[2],a32=ae[6],a33=ae[10],a34=ae[14];var a41=ae[3],a42=ae[7],a43=ae[11],a44=ae[15];var b11=be[0],b12=be[4],b13=be[8],b14=be[12];var b21=be[1],b22=be[5],b23=be[9],b24=be[13];var b31=be[2],b32=be[6],b33=be[10],b34=be[14];var b41=be[3],b42=be[7],b43=be[11],b44=be[15];te[0]=a11*b11+a12*b21+a13*b31+a14*b41;te[4]=a11*b12+a12*b22+a13*b32+a14*b42;te[8]=a11*b13+a12*b23+a13*b33+a14*b43;te[12]=a11*b14+a12*b24+a13*b34+a14*b44;te[1]=a21*b11+a22*b21+a23*b31+a24*b41;te[5]=a21*b12+a22*b22+a23*b32+a24*b42;te[9]=a21*b13+a22*b23+a23*b33+a24*b43;te[13]=a21*b14+a22*b24+a23*b34+a24*b44;te[2]=a31*b11+a32*b21+a33*b31+a34*b41;te[6]=a31*b12+a32*b22+a33*b32+a34*b42;te[10]=a31*b13+a32*b23+a33*b33+a34*b43;te[14]=a31*b14+a32*b24+a33*b34+a34*b44;te[3]=a41*b11+a42*b21+a43*b31+a44*b41;te[7]=a41*b12+a42*b22+a43*b32+a44*b42;te[11]=a41*b13+a42*b23+a43*b33+a44*b43;te[15]=a41*b14+a42*b24+a43*b34+a44*b44;return this;},multiplyScalar:function multiplyScalar(s){var te=this.elements;te[0]*=s;te[4]*=s;te[8]*=s;te[12]*=s;te[1]*=s;te[5]*=s;te[9]*=s;te[13]*=s;te[2]*=s;te[6]*=s;te[10]*=s;te[14]*=s;te[3]*=s;te[7]*=s;te[11]*=s;te[15]*=s;return this;},applyToBufferAttribute:function(){var v1=new Vector3$1();return function applyToBufferAttribute(attribute){var this$1=this;for(var i=0,l=attribute.count;i<l;i++){v1.x=attribute.getX(i);v1.y=attribute.getY(i);v1.z=attribute.getZ(i);v1.applyMatrix4(this$1);attribute.setXYZ(i,v1.x,v1.y,v1.z);}return attribute;};}(),determinant:function determinant(){var te=this.elements;var n11=te[0],n12=te[4],n13=te[8],n14=te[12];var n21=te[1],n22=te[5],n23=te[9],n24=te[13];var n31=te[2],n32=te[6],n33=te[10],n34=te[14];var n41=te[3],n42=te[7],n43=te[11],n44=te[15];//TODO: make this more efficient
  //( based on http://www.euclideanspace.com/maths/algebra/matrix/functions/inverse/fourD/index.htm )
  return n41*(+n14*n23*n32-n13*n24*n32-n14*n22*n33+n12*n24*n33+n13*n22*n34-n12*n23*n34)+n42*(+n11*n23*n34-n11*n24*n33+n14*n21*n33-n13*n21*n34+n13*n24*n31-n14*n23*n31)+n43*(+n11*n24*n32-n11*n22*n34-n14*n21*n32+n12*n21*n34+n14*n22*n31-n12*n24*n31)+n44*(-n13*n22*n31-n11*n23*n32+n11*n22*n33+n13*n21*n32-n12*n21*n33+n12*n23*n31);},transpose:function transpose(){var te=this.elements;var tmp;tmp=te[1];te[1]=te[4];te[4]=tmp;tmp=te[2];te[2]=te[8];te[8]=tmp;tmp=te[6];te[6]=te[9];te[9]=tmp;tmp=te[3];te[3]=te[12];te[12]=tmp;tmp=te[7];te[7]=te[13];te[13]=tmp;tmp=te[11];te[11]=te[14];te[14]=tmp;return this;},setPosition:function setPosition(v){var te=this.elements;te[12]=v.x;te[13]=v.y;te[14]=v.z;return this;},getInverse:function getInverse(m,throwOnDegenerate){// based on http://www.euclideanspace.com/maths/algebra/matrix/functions/inverse/fourD/index.htm
  var te=this.elements,me=m.elements,n11=me[0],n21=me[1],n31=me[2],n41=me[3],n12=me[4],n22=me[5],n32=me[6],n42=me[7],n13=me[8],n23=me[9],n33=me[10],n43=me[11],n14=me[12],n24=me[13],n34=me[14],n44=me[15],t11=n23*n34*n42-n24*n33*n42+n24*n32*n43-n22*n34*n43-n23*n32*n44+n22*n33*n44,t12=n14*n33*n42-n13*n34*n42-n14*n32*n43+n12*n34*n43+n13*n32*n44-n12*n33*n44,t13=n13*n24*n42-n14*n23*n42+n14*n22*n43-n12*n24*n43-n13*n22*n44+n12*n23*n44,t14=n14*n23*n32-n13*n24*n32-n14*n22*n33+n12*n24*n33+n13*n22*n34-n12*n23*n34;var det=n11*t11+n21*t12+n31*t13+n41*t14;if(det===0){var msg="THREE.Matrix4: .getInverse() can't invert matrix, determinant is 0";if(throwOnDegenerate===true){throw new Error(msg);}else{console.warn(msg);}return this.identity();}var detInv=1/det;te[0]=t11*detInv;te[1]=(n24*n33*n41-n23*n34*n41-n24*n31*n43+n21*n34*n43+n23*n31*n44-n21*n33*n44)*detInv;te[2]=(n22*n34*n41-n24*n32*n41+n24*n31*n42-n21*n34*n42-n22*n31*n44+n21*n32*n44)*detInv;te[3]=(n23*n32*n41-n22*n33*n41-n23*n31*n42+n21*n33*n42+n22*n31*n43-n21*n32*n43)*detInv;te[4]=t12*detInv;te[5]=(n13*n34*n41-n14*n33*n41+n14*n31*n43-n11*n34*n43-n13*n31*n44+n11*n33*n44)*detInv;te[6]=(n14*n32*n41-n12*n34*n41-n14*n31*n42+n11*n34*n42+n12*n31*n44-n11*n32*n44)*detInv;te[7]=(n12*n33*n41-n13*n32*n41+n13*n31*n42-n11*n33*n42-n12*n31*n43+n11*n32*n43)*detInv;te[8]=t13*detInv;te[9]=(n14*n23*n41-n13*n24*n41-n14*n21*n43+n11*n24*n43+n13*n21*n44-n11*n23*n44)*detInv;te[10]=(n12*n24*n41-n14*n22*n41+n14*n21*n42-n11*n24*n42-n12*n21*n44+n11*n22*n44)*detInv;te[11]=(n13*n22*n41-n12*n23*n41-n13*n21*n42+n11*n23*n42+n12*n21*n43-n11*n22*n43)*detInv;te[12]=t14*detInv;te[13]=(n13*n24*n31-n14*n23*n31+n14*n21*n33-n11*n24*n33-n13*n21*n34+n11*n23*n34)*detInv;te[14]=(n14*n22*n31-n12*n24*n31-n14*n21*n32+n11*n24*n32+n12*n21*n34-n11*n22*n34)*detInv;te[15]=(n12*n23*n31-n13*n22*n31+n13*n21*n32-n11*n23*n32-n12*n21*n33+n11*n22*n33)*detInv;return this;},scale:function scale(v){var te=this.elements;var x=v.x,y=v.y,z=v.z;te[0]*=x;te[4]*=y;te[8]*=z;te[1]*=x;te[5]*=y;te[9]*=z;te[2]*=x;te[6]*=y;te[10]*=z;te[3]*=x;te[7]*=y;te[11]*=z;return this;},getMaxScaleOnAxis:function getMaxScaleOnAxis(){var te=this.elements;var scaleXSq=te[0]*te[0]+te[1]*te[1]+te[2]*te[2];var scaleYSq=te[4]*te[4]+te[5]*te[5]+te[6]*te[6];var scaleZSq=te[8]*te[8]+te[9]*te[9]+te[10]*te[10];return Math.sqrt(Math.max(scaleXSq,scaleYSq,scaleZSq));},makeTranslation:function makeTranslation(x,y,z){this.set(1,0,0,x,0,1,0,y,0,0,1,z,0,0,0,1);return this;},makeRotationX:function makeRotationX(theta){var c=Math.cos(theta),s=Math.sin(theta);this.set(1,0,0,0,0,c,-s,0,0,s,c,0,0,0,0,1);return this;},makeRotationY:function makeRotationY(theta){var c=Math.cos(theta),s=Math.sin(theta);this.set(c,0,s,0,0,1,0,0,-s,0,c,0,0,0,0,1);return this;},makeRotationZ:function makeRotationZ(theta){var c=Math.cos(theta),s=Math.sin(theta);this.set(c,-s,0,0,s,c,0,0,0,0,1,0,0,0,0,1);return this;},makeRotationAxis:function makeRotationAxis(axis,angle){// Based on http://www.gamedev.net/reference/articles/article1199.asp
  var c=Math.cos(angle);var s=Math.sin(angle);var t=1-c;var x=axis.x,y=axis.y,z=axis.z;var tx=t*x,ty=t*y;this.set(tx*x+c,tx*y-s*z,tx*z+s*y,0,tx*y+s*z,ty*y+c,ty*z-s*x,0,tx*z-s*y,ty*z+s*x,t*z*z+c,0,0,0,0,1);return this;},makeScale:function makeScale(x,y,z){this.set(x,0,0,0,0,y,0,0,0,0,z,0,0,0,0,1);return this;},makeShear:function makeShear(x,y,z){this.set(1,y,z,0,x,1,z,0,x,y,1,0,0,0,0,1);return this;},compose:function compose(position,quaternion,scale){this.makeRotationFromQuaternion(quaternion);this.scale(scale);this.setPosition(position);return this;},decompose:function(){var vector=new Vector3$1();var matrix=new Matrix4();return function decompose(position,quaternion,scale){var te=this.elements;var sx=vector.set(te[0],te[1],te[2]).length();var sy=vector.set(te[4],te[5],te[6]).length();var sz=vector.set(te[8],te[9],te[10]).length();// if determine is negative, we need to invert one scale
  var det=this.determinant();if(det<0){sx=-sx;}position.x=te[12];position.y=te[13];position.z=te[14];// scale the rotation part
  matrix.copy(this);var invSX=1/sx;var invSY=1/sy;var invSZ=1/sz;matrix.elements[0]*=invSX;matrix.elements[1]*=invSX;matrix.elements[2]*=invSX;matrix.elements[4]*=invSY;matrix.elements[5]*=invSY;matrix.elements[6]*=invSY;matrix.elements[8]*=invSZ;matrix.elements[9]*=invSZ;matrix.elements[10]*=invSZ;quaternion.setFromRotationMatrix(matrix);scale.x=sx;scale.y=sy;scale.z=sz;return this;};}(),makePerspective:function makePerspective(left,right,top,bottom,near,far){if(far===undefined){console.warn('THREE.Matrix4: .makePerspective() has been redefined and has a new signature. Please check the docs.');}var te=this.elements;var x=2*near/(right-left);var y=2*near/(top-bottom);var a=(right+left)/(right-left);var b=(top+bottom)/(top-bottom);var c=-(far+near)/(far-near);var d=-2*far*near/(far-near);te[0]=x;te[4]=0;te[8]=a;te[12]=0;te[1]=0;te[5]=y;te[9]=b;te[13]=0;te[2]=0;te[6]=0;te[10]=c;te[14]=d;te[3]=0;te[7]=0;te[11]=-1;te[15]=0;return this;},makeOrthographic:function makeOrthographic(left,right,top,bottom,near,far){var te=this.elements;var w=1.0/(right-left);var h=1.0/(top-bottom);var p=1.0/(far-near);var x=(right+left)*w;var y=(top+bottom)*h;var z=(far+near)*p;te[0]=2*w;te[4]=0;te[8]=0;te[12]=-x;te[1]=0;te[5]=2*h;te[9]=0;te[13]=-y;te[2]=0;te[6]=0;te[10]=-2*p;te[14]=-z;te[3]=0;te[7]=0;te[11]=0;te[15]=1;return this;},equals:function equals(matrix){var te=this.elements;var me=matrix.elements;for(var i=0;i<16;i++){if(te[i]!==me[i]){return false;}}return true;},fromArray:function fromArray(array,offset){var this$1=this;if(offset===undefined){offset=0;}for(var i=0;i<16;i++){this$1.elements[i]=array[i+offset];}return this;},toArray:function toArray$$1(array,offset){if(array===undefined){array=[];}if(offset===undefined){offset=0;}var te=this.elements;array[offset]=te[0];array[offset+1]=te[1];array[offset+2]=te[2];array[offset+3]=te[3];array[offset+4]=te[4];array[offset+5]=te[5];array[offset+6]=te[6];array[offset+7]=te[7];array[offset+8]=te[8];array[offset+9]=te[9];array[offset+10]=te[10];array[offset+11]=te[11];array[offset+12]=te[12];array[offset+13]=te[13];array[offset+14]=te[14];array[offset+15]=te[15];return array;}});/**
   * @author mrdoob / http://mrdoob.com/
   * @author kile / http://kile.stravaganza.org/
   * @author philogb / http://blog.thejit.org/
   * @author mikael emtinger / http://gomo.se/
   * @author egraether / http://egraether.com/
   * @author WestLangley / http://github.com/WestLangley
   */function Vector3$1(x,y,z){this.x=x||0;this.y=y||0;this.z=z||0;}Object.assign(Vector3$1.prototype,{isVector3:true,set:function set$$1(x,y,z){this.x=x;this.y=y;this.z=z;return this;},setScalar:function setScalar(scalar){this.x=scalar;this.y=scalar;this.z=scalar;return this;},setX:function setX(x){this.x=x;return this;},setY:function setY(y){this.y=y;return this;},setZ:function setZ(z){this.z=z;return this;},setComponent:function setComponent(index,value){switch(index){case 0:this.x=value;break;case 1:this.y=value;break;case 2:this.z=value;break;default:throw new Error('index is out of range: '+index);}return this;},getComponent:function getComponent(index){switch(index){case 0:return this.x;case 1:return this.y;case 2:return this.z;default:throw new Error('index is out of range: '+index);}},clone:function clone(){return new this.constructor(this.x,this.y,this.z);},copy:function copy(v){this.x=v.x;this.y=v.y;this.z=v.z;return this;},add:function add(v,w){if(w!==undefined){console.warn('THREE.Vector3: .add() now only accepts one argument. Use .addVectors( a, b ) instead.');return this.addVectors(v,w);}this.x+=v.x;this.y+=v.y;this.z+=v.z;return this;},addScalar:function addScalar(s){this.x+=s;this.y+=s;this.z+=s;return this;},addVectors:function addVectors(a,b){this.x=a.x+b.x;this.y=a.y+b.y;this.z=a.z+b.z;return this;},addScaledVector:function addScaledVector(v,s){this.x+=v.x*s;this.y+=v.y*s;this.z+=v.z*s;return this;},sub:function sub(v,w){if(w!==undefined){console.warn('THREE.Vector3: .sub() now only accepts one argument. Use .subVectors( a, b ) instead.');return this.subVectors(v,w);}this.x-=v.x;this.y-=v.y;this.z-=v.z;return this;},subScalar:function subScalar(s){this.x-=s;this.y-=s;this.z-=s;return this;},subVectors:function subVectors(a,b){this.x=a.x-b.x;this.y=a.y-b.y;this.z=a.z-b.z;return this;},multiply:function multiply(v,w){if(w!==undefined){console.warn('THREE.Vector3: .multiply() now only accepts one argument. Use .multiplyVectors( a, b ) instead.');return this.multiplyVectors(v,w);}this.x*=v.x;this.y*=v.y;this.z*=v.z;return this;},multiplyScalar:function multiplyScalar(scalar){this.x*=scalar;this.y*=scalar;this.z*=scalar;return this;},multiplyVectors:function multiplyVectors(a,b){this.x=a.x*b.x;this.y=a.y*b.y;this.z=a.z*b.z;return this;},applyEuler:function(){var quaternion=new Quaternion();return function applyEuler(euler){if(!(euler&&euler.isEuler)){console.error('THREE.Vector3: .applyEuler() now expects an Euler rotation rather than a Vector3 and order.');}return this.applyQuaternion(quaternion.setFromEuler(euler));};}(),applyAxisAngle:function(){var quaternion=new Quaternion();return function applyAxisAngle(axis,angle){return this.applyQuaternion(quaternion.setFromAxisAngle(axis,angle));};}(),applyMatrix3:function applyMatrix3(m){var x=this.x,y=this.y,z=this.z;var e=m.elements;this.x=e[0]*x+e[3]*y+e[6]*z;this.y=e[1]*x+e[4]*y+e[7]*z;this.z=e[2]*x+e[5]*y+e[8]*z;return this;},applyMatrix4:function applyMatrix4(m){var x=this.x,y=this.y,z=this.z;var e=m.elements;var w=1/(e[3]*x+e[7]*y+e[11]*z+e[15]);this.x=(e[0]*x+e[4]*y+e[8]*z+e[12])*w;this.y=(e[1]*x+e[5]*y+e[9]*z+e[13])*w;this.z=(e[2]*x+e[6]*y+e[10]*z+e[14])*w;return this;},applyQuaternion:function applyQuaternion(q){var x=this.x,y=this.y,z=this.z;var qx=q.x,qy=q.y,qz=q.z,qw=q.w;// calculate quat * vector
  var ix=qw*x+qy*z-qz*y;var iy=qw*y+qz*x-qx*z;var iz=qw*z+qx*y-qy*x;var iw=-qx*x-qy*y-qz*z;// calculate result * inverse quat
  this.x=ix*qw+iw*-qx+iy*-qz-iz*-qy;this.y=iy*qw+iw*-qy+iz*-qx-ix*-qz;this.z=iz*qw+iw*-qz+ix*-qy-iy*-qx;return this;},project:function(){var matrix=new Matrix4();return function project(camera){matrix.multiplyMatrices(camera.projectionMatrix,matrix.getInverse(camera.matrixWorld));return this.applyMatrix4(matrix);};}(),unproject:function(){var matrix=new Matrix4();return function unproject(camera){matrix.multiplyMatrices(camera.matrixWorld,matrix.getInverse(camera.projectionMatrix));return this.applyMatrix4(matrix);};}(),transformDirection:function transformDirection(m){// input: THREE.Matrix4 affine matrix
  // vector interpreted as a direction
  var x=this.x,y=this.y,z=this.z;var e=m.elements;this.x=e[0]*x+e[4]*y+e[8]*z;this.y=e[1]*x+e[5]*y+e[9]*z;this.z=e[2]*x+e[6]*y+e[10]*z;return this.normalize();},divide:function divide(v){this.x/=v.x;this.y/=v.y;this.z/=v.z;return this;},divideScalar:function divideScalar(scalar){return this.multiplyScalar(1/scalar);},min:function min(v){this.x=Math.min(this.x,v.x);this.y=Math.min(this.y,v.y);this.z=Math.min(this.z,v.z);return this;},max:function max(v){this.x=Math.max(this.x,v.x);this.y=Math.max(this.y,v.y);this.z=Math.max(this.z,v.z);return this;},clamp:function clamp(min,max){// assumes min < max, componentwise
  this.x=Math.max(min.x,Math.min(max.x,this.x));this.y=Math.max(min.y,Math.min(max.y,this.y));this.z=Math.max(min.z,Math.min(max.z,this.z));return this;},clampScalar:function(){var min=new Vector3$1();var max=new Vector3$1();return function clampScalar(minVal,maxVal){min.set(minVal,minVal,minVal);max.set(maxVal,maxVal,maxVal);return this.clamp(min,max);};}(),clampLength:function clampLength(min,max){var length=this.length();return this.divideScalar(length||1).multiplyScalar(Math.max(min,Math.min(max,length)));},floor:function floor(){this.x=Math.floor(this.x);this.y=Math.floor(this.y);this.z=Math.floor(this.z);return this;},ceil:function ceil(){this.x=Math.ceil(this.x);this.y=Math.ceil(this.y);this.z=Math.ceil(this.z);return this;},round:function round(){this.x=Math.round(this.x);this.y=Math.round(this.y);this.z=Math.round(this.z);return this;},roundToZero:function roundToZero(){this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x);this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y);this.z=this.z<0?Math.ceil(this.z):Math.floor(this.z);return this;},negate:function negate(){this.x=-this.x;this.y=-this.y;this.z=-this.z;return this;},dot:function dot(v){return this.x*v.x+this.y*v.y+this.z*v.z;},// TODO lengthSquared?
  lengthSq:function lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z;},length:function length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z);},manhattanLength:function manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z);},normalize:function normalize(){return this.divideScalar(this.length()||1);},setLength:function setLength(length){return this.normalize().multiplyScalar(length);},lerp:function lerp(v,alpha){this.x+=(v.x-this.x)*alpha;this.y+=(v.y-this.y)*alpha;this.z+=(v.z-this.z)*alpha;return this;},lerpVectors:function lerpVectors(v1,v2,alpha){return this.subVectors(v2,v1).multiplyScalar(alpha).add(v1);},cross:function cross(v,w){if(w!==undefined){console.warn('THREE.Vector3: .cross() now only accepts one argument. Use .crossVectors( a, b ) instead.');return this.crossVectors(v,w);}return this.crossVectors(this,v);},crossVectors:function crossVectors(a,b){var ax=a.x,ay=a.y,az=a.z;var bx=b.x,by=b.y,bz=b.z;this.x=ay*bz-az*by;this.y=az*bx-ax*bz;this.z=ax*by-ay*bx;return this;},projectOnVector:function projectOnVector(vector){var scalar=vector.dot(this)/vector.lengthSq();return this.copy(vector).multiplyScalar(scalar);},projectOnPlane:function(){var v1=new Vector3$1();return function projectOnPlane(planeNormal){v1.copy(this).projectOnVector(planeNormal);return this.sub(v1);};}(),reflect:function(){// reflect incident vector off plane orthogonal to normal
  // normal is assumed to have unit length
  var v1=new Vector3$1();return function reflect(normal){return this.sub(v1.copy(normal).multiplyScalar(2*this.dot(normal)));};}(),angleTo:function angleTo(v){var theta=this.dot(v)/Math.sqrt(this.lengthSq()*v.lengthSq());// clamp, to handle numerical problems
  return Math.acos(_Math$1.clamp(theta,-1,1));},distanceTo:function distanceTo(v){return Math.sqrt(this.distanceToSquared(v));},distanceToSquared:function distanceToSquared(v){var dx=this.x-v.x,dy=this.y-v.y,dz=this.z-v.z;return dx*dx+dy*dy+dz*dz;},manhattanDistanceTo:function manhattanDistanceTo(v){return Math.abs(this.x-v.x)+Math.abs(this.y-v.y)+Math.abs(this.z-v.z);},setFromSpherical:function setFromSpherical(s){var sinPhiRadius=Math.sin(s.phi)*s.radius;this.x=sinPhiRadius*Math.sin(s.theta);this.y=Math.cos(s.phi)*s.radius;this.z=sinPhiRadius*Math.cos(s.theta);return this;},setFromCylindrical:function setFromCylindrical(c){this.x=c.radius*Math.sin(c.theta);this.y=c.y;this.z=c.radius*Math.cos(c.theta);return this;},setFromMatrixPosition:function setFromMatrixPosition(m){var e=m.elements;this.x=e[12];this.y=e[13];this.z=e[14];return this;},setFromMatrixScale:function setFromMatrixScale(m){var sx=this.setFromMatrixColumn(m,0).length();var sy=this.setFromMatrixColumn(m,1).length();var sz=this.setFromMatrixColumn(m,2).length();this.x=sx;this.y=sy;this.z=sz;return this;},setFromMatrixColumn:function setFromMatrixColumn(m,index){return this.fromArray(m.elements,index*4);},equals:function equals(v){return v.x===this.x&&v.y===this.y&&v.z===this.z;},fromArray:function fromArray(array,offset){if(offset===undefined){offset=0;}this.x=array[offset];this.y=array[offset+1];this.z=array[offset+2];return this;},toArray:function toArray$$1(array,offset){if(array===undefined){array=[];}if(offset===undefined){offset=0;}array[offset]=this.x;array[offset+1]=this.y;array[offset+2]=this.z;return array;},fromBufferAttribute:function fromBufferAttribute(attribute,index,offset){if(offset!==undefined){console.warn('THREE.Vector3: offset has been removed from .fromBufferAttribute().');}this.x=attribute.getX(index);this.y=attribute.getY(index);this.z=attribute.getZ(index);return this;}});/**
   * @author mikael emtinger / http://gomo.se/
   * @author alteredq / http://alteredqualia.com/
   * @author WestLangley / http://github.com/WestLangley
   * @author bhouston / http://clara.io
   */function Quaternion(x,y,z,w){this._x=x||0;this._y=y||0;this._z=z||0;this._w=w!==undefined?w:1;}Object.assign(Quaternion,{slerp:function slerp(qa,qb,qm,t){return qm.copy(qa).slerp(qb,t);},slerpFlat:function slerpFlat(dst,dstOffset,src0,srcOffset0,src1,srcOffset1,t){// fuzz-free, array-based Quaternion SLERP operation
  var x0=src0[srcOffset0+0],y0=src0[srcOffset0+1],z0=src0[srcOffset0+2],w0=src0[srcOffset0+3],x1=src1[srcOffset1+0],y1=src1[srcOffset1+1],z1=src1[srcOffset1+2],w1=src1[srcOffset1+3];if(w0!==w1||x0!==x1||y0!==y1||z0!==z1){var s=1-t,cos=x0*x1+y0*y1+z0*z1+w0*w1,dir=cos>=0?1:-1,sqrSin=1-cos*cos;// Skip the Slerp for tiny steps to avoid numeric problems:
  if(sqrSin>Number.EPSILON){var sin=Math.sqrt(sqrSin),len=Math.atan2(sin,cos*dir);s=Math.sin(s*len)/sin;t=Math.sin(t*len)/sin;}var tDir=t*dir;x0=x0*s+x1*tDir;y0=y0*s+y1*tDir;z0=z0*s+z1*tDir;w0=w0*s+w1*tDir;// Normalize in case we just did a lerp:
  if(s===1-t){var f=1/Math.sqrt(x0*x0+y0*y0+z0*z0+w0*w0);x0*=f;y0*=f;z0*=f;w0*=f;}}dst[dstOffset]=x0;dst[dstOffset+1]=y0;dst[dstOffset+2]=z0;dst[dstOffset+3]=w0;}});Object.defineProperties(Quaternion.prototype,{x:{get:function get$$1(){return this._x;},set:function set$$1(value){this._x=value;this.onChangeCallback();}},y:{get:function get$$1(){return this._y;},set:function set$$1(value){this._y=value;this.onChangeCallback();}},z:{get:function get$$1(){return this._z;},set:function set$$1(value){this._z=value;this.onChangeCallback();}},w:{get:function get$$1(){return this._w;},set:function set$$1(value){this._w=value;this.onChangeCallback();}}});Object.assign(Quaternion.prototype,{set:function set$$1(x,y,z,w){this._x=x;this._y=y;this._z=z;this._w=w;this.onChangeCallback();return this;},clone:function clone(){return new this.constructor(this._x,this._y,this._z,this._w);},copy:function copy(quaternion){this._x=quaternion.x;this._y=quaternion.y;this._z=quaternion.z;this._w=quaternion.w;this.onChangeCallback();return this;},setFromEuler:function setFromEuler(euler,update){if(!(euler&&euler.isEuler)){throw new Error('THREE.Quaternion: .setFromEuler() now expects an Euler rotation rather than a Vector3 and order.');}var x=euler._x,y=euler._y,z=euler._z,order=euler.order;// http://www.mathworks.com/matlabcentral/fileexchange/
  // 	20696-function-to-convert-between-dcm-euler-angles-quaternions-and-euler-vectors/
  //	content/SpinCalc.m
  var cos=Math.cos;var sin=Math.sin;var c1=cos(x/2);var c2=cos(y/2);var c3=cos(z/2);var s1=sin(x/2);var s2=sin(y/2);var s3=sin(z/2);if(order==='XYZ'){this._x=s1*c2*c3+c1*s2*s3;this._y=c1*s2*c3-s1*c2*s3;this._z=c1*c2*s3+s1*s2*c3;this._w=c1*c2*c3-s1*s2*s3;}else if(order==='YXZ'){this._x=s1*c2*c3+c1*s2*s3;this._y=c1*s2*c3-s1*c2*s3;this._z=c1*c2*s3-s1*s2*c3;this._w=c1*c2*c3+s1*s2*s3;}else if(order==='ZXY'){this._x=s1*c2*c3-c1*s2*s3;this._y=c1*s2*c3+s1*c2*s3;this._z=c1*c2*s3+s1*s2*c3;this._w=c1*c2*c3-s1*s2*s3;}else if(order==='ZYX'){this._x=s1*c2*c3-c1*s2*s3;this._y=c1*s2*c3+s1*c2*s3;this._z=c1*c2*s3-s1*s2*c3;this._w=c1*c2*c3+s1*s2*s3;}else if(order==='YZX'){this._x=s1*c2*c3+c1*s2*s3;this._y=c1*s2*c3+s1*c2*s3;this._z=c1*c2*s3-s1*s2*c3;this._w=c1*c2*c3-s1*s2*s3;}else if(order==='XZY'){this._x=s1*c2*c3-c1*s2*s3;this._y=c1*s2*c3-s1*c2*s3;this._z=c1*c2*s3+s1*s2*c3;this._w=c1*c2*c3+s1*s2*s3;}if(update!==false){this.onChangeCallback();}return this;},setFromAxisAngle:function setFromAxisAngle(axis,angle){// http://www.euclideanspace.com/maths/geometry/rotations/conversions/angleToQuaternion/index.htm
  // assumes axis is normalized
  var halfAngle=angle/2,s=Math.sin(halfAngle);this._x=axis.x*s;this._y=axis.y*s;this._z=axis.z*s;this._w=Math.cos(halfAngle);this.onChangeCallback();return this;},setFromRotationMatrix:function setFromRotationMatrix(m){// http://www.euclideanspace.com/maths/geometry/rotations/conversions/matrixToQuaternion/index.htm
  // assumes the upper 3x3 of m is a pure rotation matrix (i.e, unscaled)
  var te=m.elements,m11=te[0],m12=te[4],m13=te[8],m21=te[1],m22=te[5],m23=te[9],m31=te[2],m32=te[6],m33=te[10],trace=m11+m22+m33,s;if(trace>0){s=0.5/Math.sqrt(trace+1.0);this._w=0.25/s;this._x=(m32-m23)*s;this._y=(m13-m31)*s;this._z=(m21-m12)*s;}else if(m11>m22&&m11>m33){s=2.0*Math.sqrt(1.0+m11-m22-m33);this._w=(m32-m23)/s;this._x=0.25*s;this._y=(m12+m21)/s;this._z=(m13+m31)/s;}else if(m22>m33){s=2.0*Math.sqrt(1.0+m22-m11-m33);this._w=(m13-m31)/s;this._x=(m12+m21)/s;this._y=0.25*s;this._z=(m23+m32)/s;}else{s=2.0*Math.sqrt(1.0+m33-m11-m22);this._w=(m21-m12)/s;this._x=(m13+m31)/s;this._y=(m23+m32)/s;this._z=0.25*s;}this.onChangeCallback();return this;},setFromUnitVectors:function(){// assumes direction vectors vFrom and vTo are normalized
  var v1=new Vector3$1();var r;var EPS=0.000001;return function setFromUnitVectors(vFrom,vTo){if(v1===undefined){v1=new Vector3$1();}r=vFrom.dot(vTo)+1;if(r<EPS){r=0;if(Math.abs(vFrom.x)>Math.abs(vFrom.z)){v1.set(-vFrom.y,vFrom.x,0);}else{v1.set(0,-vFrom.z,vFrom.y);}}else{v1.crossVectors(vFrom,vTo);}this._x=v1.x;this._y=v1.y;this._z=v1.z;this._w=r;return this.normalize();};}(),inverse:function inverse(){return this.conjugate().normalize();},conjugate:function conjugate(){this._x*=-1;this._y*=-1;this._z*=-1;this.onChangeCallback();return this;},dot:function dot(v){return this._x*v._x+this._y*v._y+this._z*v._z+this._w*v._w;},lengthSq:function lengthSq(){return this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w;},length:function length(){return Math.sqrt(this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w);},normalize:function normalize(){var l=this.length();if(l===0){this._x=0;this._y=0;this._z=0;this._w=1;}else{l=1/l;this._x=this._x*l;this._y=this._y*l;this._z=this._z*l;this._w=this._w*l;}this.onChangeCallback();return this;},multiply:function multiply(q,p){if(p!==undefined){console.warn('THREE.Quaternion: .multiply() now only accepts one argument. Use .multiplyQuaternions( a, b ) instead.');return this.multiplyQuaternions(q,p);}return this.multiplyQuaternions(this,q);},premultiply:function premultiply(q){return this.multiplyQuaternions(q,this);},multiplyQuaternions:function multiplyQuaternions(a,b){// from http://www.euclideanspace.com/maths/algebra/realNormedAlgebra/quaternions/code/index.htm
  var qax=a._x,qay=a._y,qaz=a._z,qaw=a._w;var qbx=b._x,qby=b._y,qbz=b._z,qbw=b._w;this._x=qax*qbw+qaw*qbx+qay*qbz-qaz*qby;this._y=qay*qbw+qaw*qby+qaz*qbx-qax*qbz;this._z=qaz*qbw+qaw*qbz+qax*qby-qay*qbx;this._w=qaw*qbw-qax*qbx-qay*qby-qaz*qbz;this.onChangeCallback();return this;},slerp:function slerp(qb,t){if(t===0){return this;}if(t===1){return this.copy(qb);}var x=this._x,y=this._y,z=this._z,w=this._w;// http://www.euclideanspace.com/maths/algebra/realNormedAlgebra/quaternions/slerp/
  var cosHalfTheta=w*qb._w+x*qb._x+y*qb._y+z*qb._z;if(cosHalfTheta<0){this._w=-qb._w;this._x=-qb._x;this._y=-qb._y;this._z=-qb._z;cosHalfTheta=-cosHalfTheta;}else{this.copy(qb);}if(cosHalfTheta>=1.0){this._w=w;this._x=x;this._y=y;this._z=z;return this;}var sinHalfTheta=Math.sqrt(1.0-cosHalfTheta*cosHalfTheta);if(Math.abs(sinHalfTheta)<0.001){this._w=0.5*(w+this._w);this._x=0.5*(x+this._x);this._y=0.5*(y+this._y);this._z=0.5*(z+this._z);return this;}var halfTheta=Math.atan2(sinHalfTheta,cosHalfTheta);var ratioA=Math.sin((1-t)*halfTheta)/sinHalfTheta,ratioB=Math.sin(t*halfTheta)/sinHalfTheta;this._w=w*ratioA+this._w*ratioB;this._x=x*ratioA+this._x*ratioB;this._y=y*ratioA+this._y*ratioB;this._z=z*ratioA+this._z*ratioB;this.onChangeCallback();return this;},equals:function equals(quaternion){return quaternion._x===this._x&&quaternion._y===this._y&&quaternion._z===this._z&&quaternion._w===this._w;},fromArray:function fromArray(array,offset){if(offset===undefined){offset=0;}this._x=array[offset];this._y=array[offset+1];this._z=array[offset+2];this._w=array[offset+3];this.onChangeCallback();return this;},toArray:function toArray$$1(array,offset){if(array===undefined){array=[];}if(offset===undefined){offset=0;}array[offset]=this._x;array[offset+1]=this._y;array[offset+2]=this._z;array[offset+3]=this._w;return array;},onChange:function onChange(callback){this.onChangeCallback=callback;return this;},onChangeCallback:function onChangeCallback(){}});/**
   * https://github.com/mrdoob/eventdispatcher.js/
   */function EventDispatcher(){}Object.assign(EventDispatcher.prototype,{addEventListener:function addEventListener(type,listener){if(this._listeners===undefined){this._listeners={};}var listeners=this._listeners;if(listeners[type]===undefined){listeners[type]=[];}if(listeners[type].indexOf(listener)===-1){listeners[type].push(listener);}},hasEventListener:function hasEventListener(type,listener){if(this._listeners===undefined){return false;}var listeners=this._listeners;return listeners[type]!==undefined&&listeners[type].indexOf(listener)!==-1;},removeEventListener:function removeEventListener(type,listener){if(this._listeners===undefined){return;}var listeners=this._listeners;var listenerArray=listeners[type];if(listenerArray!==undefined){var index=listenerArray.indexOf(listener);if(index!==-1){listenerArray.splice(index,1);}}},dispatchEvent:function dispatchEvent(event){var this$1=this;if(this._listeners===undefined){return;}var listeners=this._listeners;var listenerArray=listeners[event.type];if(listenerArray!==undefined){event.target=this;var array=listenerArray.slice(0);for(var i=0,l=array.length;i<l;i++){array[i].call(this$1,event);}}}});/**
   * @author mrdoob / http://mrdoob.com/
   * @author WestLangley / http://github.com/WestLangley
   * @author bhouston / http://clara.io
   */function Euler(x,y,z,order){this._x=x||0;this._y=y||0;this._z=z||0;this._order=order||Euler.DefaultOrder;}Euler.RotationOrders=['XYZ','YZX','ZXY','XZY','YXZ','ZYX'];Euler.DefaultOrder='XYZ';Object.defineProperties(Euler.prototype,{x:{get:function get$$1(){return this._x;},set:function set$$1(value){this._x=value;this.onChangeCallback();}},y:{get:function get$$1(){return this._y;},set:function set$$1(value){this._y=value;this.onChangeCallback();}},z:{get:function get$$1(){return this._z;},set:function set$$1(value){this._z=value;this.onChangeCallback();}},order:{get:function get$$1(){return this._order;},set:function set$$1(value){this._order=value;this.onChangeCallback();}}});Object.assign(Euler.prototype,{isEuler:true,set:function set$$1(x,y,z,order){this._x=x;this._y=y;this._z=z;this._order=order||this._order;this.onChangeCallback();return this;},clone:function clone(){return new this.constructor(this._x,this._y,this._z,this._order);},copy:function copy(euler){this._x=euler._x;this._y=euler._y;this._z=euler._z;this._order=euler._order;this.onChangeCallback();return this;},setFromRotationMatrix:function setFromRotationMatrix(m,order,update){var clamp=_Math$1.clamp;// assumes the upper 3x3 of m is a pure rotation matrix (i.e, unscaled)
  var te=m.elements;var m11=te[0],m12=te[4],m13=te[8];var m21=te[1],m22=te[5],m23=te[9];var m31=te[2],m32=te[6],m33=te[10];order=order||this._order;if(order==='XYZ'){this._y=Math.asin(clamp(m13,-1,1));if(Math.abs(m13)<0.99999){this._x=Math.atan2(-m23,m33);this._z=Math.atan2(-m12,m11);}else{this._x=Math.atan2(m32,m22);this._z=0;}}else if(order==='YXZ'){this._x=Math.asin(-clamp(m23,-1,1));if(Math.abs(m23)<0.99999){this._y=Math.atan2(m13,m33);this._z=Math.atan2(m21,m22);}else{this._y=Math.atan2(-m31,m11);this._z=0;}}else if(order==='ZXY'){this._x=Math.asin(clamp(m32,-1,1));if(Math.abs(m32)<0.99999){this._y=Math.atan2(-m31,m33);this._z=Math.atan2(-m12,m22);}else{this._y=0;this._z=Math.atan2(m21,m11);}}else if(order==='ZYX'){this._y=Math.asin(-clamp(m31,-1,1));if(Math.abs(m31)<0.99999){this._x=Math.atan2(m32,m33);this._z=Math.atan2(m21,m11);}else{this._x=0;this._z=Math.atan2(-m12,m22);}}else if(order==='YZX'){this._z=Math.asin(clamp(m21,-1,1));if(Math.abs(m21)<0.99999){this._x=Math.atan2(-m23,m22);this._y=Math.atan2(-m31,m11);}else{this._x=0;this._y=Math.atan2(m13,m33);}}else if(order==='XZY'){this._z=Math.asin(-clamp(m12,-1,1));if(Math.abs(m12)<0.99999){this._x=Math.atan2(m32,m22);this._y=Math.atan2(m13,m11);}else{this._x=Math.atan2(-m23,m33);this._y=0;}}else{console.warn('THREE.Euler: .setFromRotationMatrix() given unsupported order: '+order);}this._order=order;if(update!==false){this.onChangeCallback();}return this;},setFromQuaternion:function(){var matrix=new Matrix4();return function setFromQuaternion(q,order,update){matrix.makeRotationFromQuaternion(q);return this.setFromRotationMatrix(matrix,order,update);};}(),setFromVector3:function setFromVector3(v,order){return this.set(v.x,v.y,v.z,order||this._order);},reorder:function(){// WARNING: this discards revolution information -bhouston
  var q=new Quaternion();return function reorder(newOrder){q.setFromEuler(this);return this.setFromQuaternion(q,newOrder);};}(),equals:function equals(euler){return euler._x===this._x&&euler._y===this._y&&euler._z===this._z&&euler._order===this._order;},fromArray:function fromArray(array){this._x=array[0];this._y=array[1];this._z=array[2];if(array[3]!==undefined){this._order=array[3];}this.onChangeCallback();return this;},toArray:function toArray$$1(array,offset){if(array===undefined){array=[];}if(offset===undefined){offset=0;}array[offset]=this._x;array[offset+1]=this._y;array[offset+2]=this._z;array[offset+3]=this._order;return array;},toVector3:function toVector3(optionalResult){if(optionalResult){return optionalResult.set(this._x,this._y,this._z);}else{return new Vector3$1(this._x,this._y,this._z);}},onChange:function onChange(callback){this.onChangeCallback=callback;return this;},onChangeCallback:function onChangeCallback(){}});/**
   * @author mrdoob / http://mrdoob.com/
   */function Layers(){this.mask=1|0;}Object.assign(Layers.prototype,{set:function set$$1(channel){this.mask=1<<channel|0;},enable:function enable(channel){this.mask|=1<<channel|0;},toggle:function toggle(channel){this.mask^=1<<channel|0;},disable:function disable(channel){this.mask&=~(1<<channel|0);},test:function test(layers){return(this.mask&layers.mask)!==0;}});/**
   * @author alteredq / http://alteredqualia.com/
   * @author WestLangley / http://github.com/WestLangley
   * @author bhouston / http://clara.io
   * @author tschw
   */function Matrix3$1(){this.elements=[1,0,0,0,1,0,0,0,1];if(arguments.length>0){console.error('THREE.Matrix3: the constructor no longer reads arguments. use .set() instead.');}}Object.assign(Matrix3$1.prototype,{isMatrix3:true,set:function set$$1(n11,n12,n13,n21,n22,n23,n31,n32,n33){var te=this.elements;te[0]=n11;te[1]=n21;te[2]=n31;te[3]=n12;te[4]=n22;te[5]=n32;te[6]=n13;te[7]=n23;te[8]=n33;return this;},identity:function identity(){this.set(1,0,0,0,1,0,0,0,1);return this;},clone:function clone(){return new this.constructor().fromArray(this.elements);},copy:function copy(m){var te=this.elements;var me=m.elements;te[0]=me[0];te[1]=me[1];te[2]=me[2];te[3]=me[3];te[4]=me[4];te[5]=me[5];te[6]=me[6];te[7]=me[7];te[8]=me[8];return this;},setFromMatrix4:function setFromMatrix4(m){var me=m.elements;this.set(me[0],me[4],me[8],me[1],me[5],me[9],me[2],me[6],me[10]);return this;},applyToBufferAttribute:function(){var v1=new Vector3$1();return function applyToBufferAttribute(attribute){var this$1=this;for(var i=0,l=attribute.count;i<l;i++){v1.x=attribute.getX(i);v1.y=attribute.getY(i);v1.z=attribute.getZ(i);v1.applyMatrix3(this$1);attribute.setXYZ(i,v1.x,v1.y,v1.z);}return attribute;};}(),multiply:function multiply(m){return this.multiplyMatrices(this,m);},premultiply:function premultiply(m){return this.multiplyMatrices(m,this);},multiplyMatrices:function multiplyMatrices(a,b){var ae=a.elements;var be=b.elements;var te=this.elements;var a11=ae[0],a12=ae[3],a13=ae[6];var a21=ae[1],a22=ae[4],a23=ae[7];var a31=ae[2],a32=ae[5],a33=ae[8];var b11=be[0],b12=be[3],b13=be[6];var b21=be[1],b22=be[4],b23=be[7];var b31=be[2],b32=be[5],b33=be[8];te[0]=a11*b11+a12*b21+a13*b31;te[3]=a11*b12+a12*b22+a13*b32;te[6]=a11*b13+a12*b23+a13*b33;te[1]=a21*b11+a22*b21+a23*b31;te[4]=a21*b12+a22*b22+a23*b32;te[7]=a21*b13+a22*b23+a23*b33;te[2]=a31*b11+a32*b21+a33*b31;te[5]=a31*b12+a32*b22+a33*b32;te[8]=a31*b13+a32*b23+a33*b33;return this;},multiplyScalar:function multiplyScalar(s){var te=this.elements;te[0]*=s;te[3]*=s;te[6]*=s;te[1]*=s;te[4]*=s;te[7]*=s;te[2]*=s;te[5]*=s;te[8]*=s;return this;},determinant:function determinant(){var te=this.elements;var a=te[0],b=te[1],c=te[2],d=te[3],e=te[4],f=te[5],g=te[6],h=te[7],i=te[8];return a*e*i-a*f*h-b*d*i+b*f*g+c*d*h-c*e*g;},getInverse:function getInverse(matrix,throwOnDegenerate){if(matrix&&matrix.isMatrix4){console.error("THREE.Matrix3: .getInverse() no longer takes a Matrix4 argument.");}var me=matrix.elements,te=this.elements,n11=me[0],n21=me[1],n31=me[2],n12=me[3],n22=me[4],n32=me[5],n13=me[6],n23=me[7],n33=me[8],t11=n33*n22-n32*n23,t12=n32*n13-n33*n12,t13=n23*n12-n22*n13,det=n11*t11+n21*t12+n31*t13;if(det===0){var msg="THREE.Matrix3: .getInverse() can't invert matrix, determinant is 0";if(throwOnDegenerate===true){throw new Error(msg);}else{console.warn(msg);}return this.identity();}var detInv=1/det;te[0]=t11*detInv;te[1]=(n31*n23-n33*n21)*detInv;te[2]=(n32*n21-n31*n22)*detInv;te[3]=t12*detInv;te[4]=(n33*n11-n31*n13)*detInv;te[5]=(n31*n12-n32*n11)*detInv;te[6]=t13*detInv;te[7]=(n21*n13-n23*n11)*detInv;te[8]=(n22*n11-n21*n12)*detInv;return this;},transpose:function transpose(){var tmp,m=this.elements;tmp=m[1];m[1]=m[3];m[3]=tmp;tmp=m[2];m[2]=m[6];m[6]=tmp;tmp=m[5];m[5]=m[7];m[7]=tmp;return this;},getNormalMatrix:function getNormalMatrix(matrix4){return this.setFromMatrix4(matrix4).getInverse(this).transpose();},transposeIntoArray:function transposeIntoArray(r){var m=this.elements;r[0]=m[0];r[1]=m[3];r[2]=m[6];r[3]=m[1];r[4]=m[4];r[5]=m[7];r[6]=m[2];r[7]=m[5];r[8]=m[8];return this;},setUvTransform:function setUvTransform(tx,ty,sx,sy,rotation,cx,cy){var c=Math.cos(rotation);var s=Math.sin(rotation);this.set(sx*c,sx*s,-sx*(c*cx+s*cy)+cx+tx,-sy*s,sy*c,-sy*(-s*cx+c*cy)+cy+ty,0,0,1);},scale:function scale(sx,sy){var te=this.elements;te[0]*=sx;te[3]*=sx;te[6]*=sx;te[1]*=sy;te[4]*=sy;te[7]*=sy;return this;},rotate:function rotate(theta){var c=Math.cos(theta);var s=Math.sin(theta);var te=this.elements;var a11=te[0],a12=te[3],a13=te[6];var a21=te[1],a22=te[4],a23=te[7];te[0]=c*a11+s*a21;te[3]=c*a12+s*a22;te[6]=c*a13+s*a23;te[1]=-s*a11+c*a21;te[4]=-s*a12+c*a22;te[7]=-s*a13+c*a23;return this;},translate:function translate(tx,ty){var te=this.elements;te[0]+=tx*te[2];te[3]+=tx*te[5];te[6]+=tx*te[8];te[1]+=ty*te[2];te[4]+=ty*te[5];te[7]+=ty*te[8];return this;},equals:function equals(matrix){var te=this.elements;var me=matrix.elements;for(var i=0;i<9;i++){if(te[i]!==me[i]){return false;}}return true;},fromArray:function fromArray(array,offset){var this$1=this;if(offset===undefined){offset=0;}for(var i=0;i<9;i++){this$1.elements[i]=array[i+offset];}return this;},toArray:function toArray$$1(array,offset){if(array===undefined){array=[];}if(offset===undefined){offset=0;}var te=this.elements;array[offset]=te[0];array[offset+1]=te[1];array[offset+2]=te[2];array[offset+3]=te[3];array[offset+4]=te[4];array[offset+5]=te[5];array[offset+6]=te[6];array[offset+7]=te[7];array[offset+8]=te[8];return array;}});/**
   * @author mrdoob / http://mrdoob.com/
   * @author mikael emtinger / http://gomo.se/
   * @author alteredq / http://alteredqualia.com/
   * @author WestLangley / http://github.com/WestLangley
   * @author elephantatwork / www.elephantatwork.ch
   */var object3DId=0;function Object3D(){Object.defineProperty(this,'id',{value:object3DId++});this.uuid=_Math$1.generateUUID();this.name='';this.type='Object3D';this.parent=null;this.children=[];this.up=Object3D.DefaultUp.clone();var position=new Vector3$1();var rotation=new Euler();var quaternion=new Quaternion();var scale=new Vector3$1(1,1,1);function onRotationChange(){quaternion.setFromEuler(rotation,false);}function onQuaternionChange(){rotation.setFromQuaternion(quaternion,undefined,false);}rotation.onChange(onRotationChange);quaternion.onChange(onQuaternionChange);Object.defineProperties(this,{position:{enumerable:true,value:position},rotation:{enumerable:true,value:rotation},quaternion:{enumerable:true,value:quaternion},scale:{enumerable:true,value:scale},modelViewMatrix:{value:new Matrix4()},normalMatrix:{value:new Matrix3$1()}});this.matrix=new Matrix4();this.matrixWorld=new Matrix4();this.matrixAutoUpdate=Object3D.DefaultMatrixAutoUpdate;this.matrixWorldNeedsUpdate=false;this.layers=new Layers();this.visible=true;this.castShadow=false;this.receiveShadow=false;this.frustumCulled=true;this.renderOrder=0;this.userData={};}Object3D.DefaultUp=new Vector3$1(0,1,0);Object3D.DefaultMatrixAutoUpdate=true;Object3D.prototype=Object.assign(Object.create(EventDispatcher.prototype),{constructor:Object3D,isObject3D:true,onBeforeRender:function onBeforeRender(){},onAfterRender:function onAfterRender(){},applyMatrix:function applyMatrix(matrix){this.matrix.multiplyMatrices(matrix,this.matrix);this.matrix.decompose(this.position,this.quaternion,this.scale);},applyQuaternion:function applyQuaternion(q){this.quaternion.premultiply(q);return this;},setRotationFromAxisAngle:function setRotationFromAxisAngle(axis,angle){// assumes axis is normalized
  this.quaternion.setFromAxisAngle(axis,angle);},setRotationFromEuler:function setRotationFromEuler(euler){this.quaternion.setFromEuler(euler,true);},setRotationFromMatrix:function setRotationFromMatrix(m){// assumes the upper 3x3 of m is a pure rotation matrix (i.e, unscaled)
  this.quaternion.setFromRotationMatrix(m);},setRotationFromQuaternion:function setRotationFromQuaternion(q){// assumes q is normalized
  this.quaternion.copy(q);},rotateOnAxis:function(){// rotate object on axis in object space
  // axis is assumed to be normalized
  var q1=new Quaternion();return function rotateOnAxis(axis,angle){q1.setFromAxisAngle(axis,angle);this.quaternion.multiply(q1);return this;};}(),rotateOnWorldAxis:function(){// rotate object on axis in world space
  // axis is assumed to be normalized
  // method assumes no rotated parent
  var q1=new Quaternion();return function rotateOnWorldAxis(axis,angle){q1.setFromAxisAngle(axis,angle);this.quaternion.premultiply(q1);return this;};}(),rotateX:function(){var v1=new Vector3$1(1,0,0);return function rotateX(angle){return this.rotateOnAxis(v1,angle);};}(),rotateY:function(){var v1=new Vector3$1(0,1,0);return function rotateY(angle){return this.rotateOnAxis(v1,angle);};}(),rotateZ:function(){var v1=new Vector3$1(0,0,1);return function rotateZ(angle){return this.rotateOnAxis(v1,angle);};}(),translateOnAxis:function(){// translate object by distance along axis in object space
  // axis is assumed to be normalized
  var v1=new Vector3$1();return function translateOnAxis(axis,distance){v1.copy(axis).applyQuaternion(this.quaternion);this.position.add(v1.multiplyScalar(distance));return this;};}(),translateX:function(){var v1=new Vector3$1(1,0,0);return function translateX(distance){return this.translateOnAxis(v1,distance);};}(),translateY:function(){var v1=new Vector3$1(0,1,0);return function translateY(distance){return this.translateOnAxis(v1,distance);};}(),translateZ:function(){var v1=new Vector3$1(0,0,1);return function translateZ(distance){return this.translateOnAxis(v1,distance);};}(),localToWorld:function localToWorld(vector){return vector.applyMatrix4(this.matrixWorld);},worldToLocal:function(){var m1=new Matrix4();return function worldToLocal(vector){return vector.applyMatrix4(m1.getInverse(this.matrixWorld));};}(),lookAt:function(){// This method does not support objects with rotated and/or translated parent(s)
  var m1=new Matrix4();var vector=new Vector3$1();return function lookAt(x,y,z){if(x.isVector3){vector.copy(x);}else{vector.set(x,y,z);}if(this.isCamera){m1.lookAt(this.position,vector,this.up);}else{m1.lookAt(vector,this.position,this.up);}this.quaternion.setFromRotationMatrix(m1);};}(),add:function add(object){var arguments$1=arguments;var this$1=this;if(arguments.length>1){for(var i=0;i<arguments.length;i++){this$1.add(arguments$1[i]);}return this;}if(object===this){console.error("THREE.Object3D.add: object can't be added as a child of itself.",object);return this;}if(object&&object.isObject3D){if(object.parent!==null){object.parent.remove(object);}object.parent=this;object.dispatchEvent({type:'added'});this.children.push(object);}else{console.error("THREE.Object3D.add: object not an instance of THREE.Object3D.",object);}return this;},remove:function remove(object){var arguments$1=arguments;var this$1=this;if(arguments.length>1){for(var i=0;i<arguments.length;i++){this$1.remove(arguments$1[i]);}return this;}var index=this.children.indexOf(object);if(index!==-1){object.parent=null;object.dispatchEvent({type:'removed'});this.children.splice(index,1);}return this;},getObjectById:function getObjectById(id){return this.getObjectByProperty('id',id);},getObjectByName:function getObjectByName(name){return this.getObjectByProperty('name',name);},getObjectByProperty:function getObjectByProperty(name,value){var this$1=this;if(this[name]===value){return this;}for(var i=0,l=this.children.length;i<l;i++){var child=this$1.children[i];var object=child.getObjectByProperty(name,value);if(object!==undefined){return object;}}return undefined;},getWorldPosition:function getWorldPosition(optionalTarget){var result=optionalTarget||new Vector3$1();this.updateMatrixWorld(true);return result.setFromMatrixPosition(this.matrixWorld);},getWorldQuaternion:function(){var position=new Vector3$1();var scale=new Vector3$1();return function getWorldQuaternion(optionalTarget){var result=optionalTarget||new Quaternion();this.updateMatrixWorld(true);this.matrixWorld.decompose(position,result,scale);return result;};}(),getWorldRotation:function(){var quaternion=new Quaternion();return function getWorldRotation(optionalTarget){var result=optionalTarget||new Euler();this.getWorldQuaternion(quaternion);return result.setFromQuaternion(quaternion,this.rotation.order,false);};}(),getWorldScale:function(){var position=new Vector3$1();var quaternion=new Quaternion();return function getWorldScale(optionalTarget){var result=optionalTarget||new Vector3$1();this.updateMatrixWorld(true);this.matrixWorld.decompose(position,quaternion,result);return result;};}(),getWorldDirection:function(){var quaternion=new Quaternion();return function getWorldDirection(optionalTarget){var result=optionalTarget||new Vector3$1();this.getWorldQuaternion(quaternion);return result.set(0,0,1).applyQuaternion(quaternion);};}(),raycast:function raycast(){},traverse:function traverse(callback){callback(this);var children=this.children;for(var i=0,l=children.length;i<l;i++){children[i].traverse(callback);}},traverseVisible:function traverseVisible(callback){if(this.visible===false){return;}callback(this);var children=this.children;for(var i=0,l=children.length;i<l;i++){children[i].traverseVisible(callback);}},traverseAncestors:function traverseAncestors(callback){var parent=this.parent;if(parent!==null){callback(parent);parent.traverseAncestors(callback);}},updateMatrix:function updateMatrix(){this.matrix.compose(this.position,this.quaternion,this.scale);this.matrixWorldNeedsUpdate=true;},updateMatrixWorld:function updateMatrixWorld(force){if(this.matrixAutoUpdate){this.updateMatrix();}if(this.matrixWorldNeedsUpdate||force){if(this.parent===null){this.matrixWorld.copy(this.matrix);}else{this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix);}this.matrixWorldNeedsUpdate=false;force=true;}// update children
  var children=this.children;for(var i=0,l=children.length;i<l;i++){children[i].updateMatrixWorld(force);}},toJSON:function toJSON(meta){var this$1=this;// meta is a string when called from JSON.stringify
  var isRootObject=meta===undefined||typeof meta==='string';var output={};// meta is a hash used to collect geometries, materials.
  // not providing it implies that this is the root object
  // being serialized.
  if(isRootObject){// initialize meta obj
  meta={geometries:{},materials:{},textures:{},images:{},shapes:{}};output.metadata={version:4.5,type:'Object',generator:'Object3D.toJSON'};}// standard Object3D serialization
  var object={};object.uuid=this.uuid;object.type=this.type;if(this.name!==''){object.name=this.name;}if(this.castShadow===true){object.castShadow=true;}if(this.receiveShadow===true){object.receiveShadow=true;}if(this.visible===false){object.visible=false;}if(JSON.stringify(this.userData)!=='{}'){object.userData=this.userData;}object.matrix=this.matrix.toArray();//
  function serialize(library,element){if(library[element.uuid]===undefined){library[element.uuid]=element.toJSON(meta);}return element.uuid;}if(this.geometry!==undefined){object.geometry=serialize(meta.geometries,this.geometry);var parameters=this.geometry.parameters;if(parameters!==undefined&&parameters.shapes!==undefined){var shapes=parameters.shapes;if(Array.isArray(shapes)){for(var i=0,l=shapes.length;i<l;i++){var shape=shapes[i];serialize(meta.shapes,shape);}}else{serialize(meta.shapes,shapes);}}}if(this.material!==undefined){if(Array.isArray(this.material)){var uuids=[];for(var i=0,l=this.material.length;i<l;i++){uuids.push(serialize(meta.materials,this$1.material[i]));}object.material=uuids;}else{object.material=serialize(meta.materials,this.material);}}//
  if(this.children.length>0){object.children=[];for(var i=0;i<this.children.length;i++){object.children.push(this$1.children[i].toJSON(meta).object);}}if(isRootObject){var geometries=extractFromCache(meta.geometries);var materials=extractFromCache(meta.materials);var textures=extractFromCache(meta.textures);var images=extractFromCache(meta.images);var shapes=extractFromCache(meta.shapes);if(geometries.length>0){output.geometries=geometries;}if(materials.length>0){output.materials=materials;}if(textures.length>0){output.textures=textures;}if(images.length>0){output.images=images;}if(shapes.length>0){output.shapes=shapes;}}output.object=object;return output;// extract data from the cache hash
  // remove metadata on each item
  // and return as array
  function extractFromCache(cache){var values=[];for(var key in cache){var data=cache[key];delete data.metadata;values.push(data);}return values;}},clone:function clone(recursive){return new this.constructor().copy(this,recursive);},copy:function copy(source,recursive){var this$1=this;if(recursive===undefined){recursive=true;}this.name=source.name;this.up.copy(source.up);this.position.copy(source.position);this.quaternion.copy(source.quaternion);this.scale.copy(source.scale);this.matrix.copy(source.matrix);this.matrixWorld.copy(source.matrixWorld);this.matrixAutoUpdate=source.matrixAutoUpdate;this.matrixWorldNeedsUpdate=source.matrixWorldNeedsUpdate;this.layers.mask=source.layers.mask;this.visible=source.visible;this.castShadow=source.castShadow;this.receiveShadow=source.receiveShadow;this.frustumCulled=source.frustumCulled;this.renderOrder=source.renderOrder;this.userData=JSON.parse(JSON.stringify(source.userData));if(recursive===true){for(var i=0;i<source.children.length;i++){var child=source.children[i];this$1.add(child.clone());}}return this;}});/**
   * @author bhouston / http://clara.io
   * @author mrdoob / http://mrdoob.com/
   */function Sphere(center,radius){this.center=center!==undefined?center:new Vector3$1();this.radius=radius!==undefined?radius:0;}Object.assign(Sphere.prototype,{set:function set$$1(center,radius){this.center.copy(center);this.radius=radius;return this;},setFromPoints:function(){var box=new Box3();return function setFromPoints(points,optionalCenter){var center=this.center;if(optionalCenter!==undefined){center.copy(optionalCenter);}else{box.setFromPoints(points).getCenter(center);}var maxRadiusSq=0;for(var i=0,il=points.length;i<il;i++){maxRadiusSq=Math.max(maxRadiusSq,center.distanceToSquared(points[i]));}this.radius=Math.sqrt(maxRadiusSq);return this;};}(),clone:function clone(){return new this.constructor().copy(this);},copy:function copy(sphere){this.center.copy(sphere.center);this.radius=sphere.radius;return this;},empty:function empty(){return this.radius<=0;},containsPoint:function containsPoint(point){return point.distanceToSquared(this.center)<=this.radius*this.radius;},distanceToPoint:function distanceToPoint(point){return point.distanceTo(this.center)-this.radius;},intersectsSphere:function intersectsSphere(sphere){var radiusSum=this.radius+sphere.radius;return sphere.center.distanceToSquared(this.center)<=radiusSum*radiusSum;},intersectsBox:function intersectsBox(box){return box.intersectsSphere(this);},intersectsPlane:function intersectsPlane(plane){return Math.abs(plane.distanceToPoint(this.center))<=this.radius;},clampPoint:function clampPoint(point,optionalTarget){var deltaLengthSq=this.center.distanceToSquared(point);var result=optionalTarget||new Vector3$1();result.copy(point);if(deltaLengthSq>this.radius*this.radius){result.sub(this.center).normalize();result.multiplyScalar(this.radius).add(this.center);}return result;},getBoundingBox:function getBoundingBox(optionalTarget){var box=optionalTarget||new Box3();box.set(this.center,this.center);box.expandByScalar(this.radius);return box;},applyMatrix4:function applyMatrix4(matrix){this.center.applyMatrix4(matrix);this.radius=this.radius*matrix.getMaxScaleOnAxis();return this;},translate:function translate(offset){this.center.add(offset);return this;},equals:function equals(sphere){return sphere.center.equals(this.center)&&sphere.radius===this.radius;}});/**
   * @author bhouston / http://clara.io
   * @author WestLangley / http://github.com/WestLangley
   */function Box3(min,max){this.min=min!==undefined?min:new Vector3$1(+Infinity,+Infinity,+Infinity);this.max=max!==undefined?max:new Vector3$1(-Infinity,-Infinity,-Infinity);}Object.assign(Box3.prototype,{isBox3:true,set:function set$$1(min,max){this.min.copy(min);this.max.copy(max);return this;},setFromArray:function setFromArray(array){var minX=+Infinity;var minY=+Infinity;var minZ=+Infinity;var maxX=-Infinity;var maxY=-Infinity;var maxZ=-Infinity;for(var i=0,l=array.length;i<l;i+=3){var x=array[i];var y=array[i+1];var z=array[i+2];if(x<minX){minX=x;}if(y<minY){minY=y;}if(z<minZ){minZ=z;}if(x>maxX){maxX=x;}if(y>maxY){maxY=y;}if(z>maxZ){maxZ=z;}}this.min.set(minX,minY,minZ);this.max.set(maxX,maxY,maxZ);return this;},setFromBufferAttribute:function setFromBufferAttribute(attribute){var minX=+Infinity;var minY=+Infinity;var minZ=+Infinity;var maxX=-Infinity;var maxY=-Infinity;var maxZ=-Infinity;for(var i=0,l=attribute.count;i<l;i++){var x=attribute.getX(i);var y=attribute.getY(i);var z=attribute.getZ(i);if(x<minX){minX=x;}if(y<minY){minY=y;}if(z<minZ){minZ=z;}if(x>maxX){maxX=x;}if(y>maxY){maxY=y;}if(z>maxZ){maxZ=z;}}this.min.set(minX,minY,minZ);this.max.set(maxX,maxY,maxZ);return this;},setFromPoints:function setFromPoints(points){var this$1=this;this.makeEmpty();for(var i=0,il=points.length;i<il;i++){this$1.expandByPoint(points[i]);}return this;},setFromCenterAndSize:function(){var v1=new Vector3$1();return function setFromCenterAndSize(center,size){var halfSize=v1.copy(size).multiplyScalar(0.5);this.min.copy(center).sub(halfSize);this.max.copy(center).add(halfSize);return this;};}(),setFromObject:function setFromObject(object){this.makeEmpty();return this.expandByObject(object);},clone:function clone(){return new this.constructor().copy(this);},copy:function copy(box){this.min.copy(box.min);this.max.copy(box.max);return this;},makeEmpty:function makeEmpty(){this.min.x=this.min.y=this.min.z=+Infinity;this.max.x=this.max.y=this.max.z=-Infinity;return this;},isEmpty:function isEmpty(){// this is a more robust check for empty than ( volume <= 0 ) because volume can get positive with two negative axes
  return this.max.x<this.min.x||this.max.y<this.min.y||this.max.z<this.min.z;},getCenter:function getCenter(optionalTarget){var result=optionalTarget||new Vector3$1();return this.isEmpty()?result.set(0,0,0):result.addVectors(this.min,this.max).multiplyScalar(0.5);},getSize:function getSize(optionalTarget){var result=optionalTarget||new Vector3$1();return this.isEmpty()?result.set(0,0,0):result.subVectors(this.max,this.min);},expandByPoint:function expandByPoint(point){this.min.min(point);this.max.max(point);return this;},expandByVector:function expandByVector(vector){this.min.sub(vector);this.max.add(vector);return this;},expandByScalar:function expandByScalar(scalar){this.min.addScalar(-scalar);this.max.addScalar(scalar);return this;},expandByObject:function(){// Computes the world-axis-aligned bounding box of an object (including its children),
  // accounting for both the object's, and children's, world transforms
  var scope,i,l;var v1=new Vector3$1();function traverse(node){var geometry=node.geometry;if(geometry!==undefined){if(geometry.isGeometry){var vertices=geometry.vertices;for(i=0, l=vertices.length;i<l;i++){v1.copy(vertices[i]);v1.applyMatrix4(node.matrixWorld);scope.expandByPoint(v1);}}else if(geometry.isBufferGeometry){var attribute=geometry.attributes.position;if(attribute!==undefined){for(i=0, l=attribute.count;i<l;i++){v1.fromBufferAttribute(attribute,i).applyMatrix4(node.matrixWorld);scope.expandByPoint(v1);}}}}}return function expandByObject(object){scope=this;object.updateMatrixWorld(true);object.traverse(traverse);return this;};}(),containsPoint:function containsPoint(point){return point.x<this.min.x||point.x>this.max.x||point.y<this.min.y||point.y>this.max.y||point.z<this.min.z||point.z>this.max.z?false:true;},containsBox:function containsBox(box){return this.min.x<=box.min.x&&box.max.x<=this.max.x&&this.min.y<=box.min.y&&box.max.y<=this.max.y&&this.min.z<=box.min.z&&box.max.z<=this.max.z;},getParameter:function getParameter(point,optionalTarget){// This can potentially have a divide by zero if the box
  // has a size dimension of 0.
  var result=optionalTarget||new Vector3$1();return result.set((point.x-this.min.x)/(this.max.x-this.min.x),(point.y-this.min.y)/(this.max.y-this.min.y),(point.z-this.min.z)/(this.max.z-this.min.z));},intersectsBox:function intersectsBox(box){// using 6 splitting planes to rule out intersections.
  return box.max.x<this.min.x||box.min.x>this.max.x||box.max.y<this.min.y||box.min.y>this.max.y||box.max.z<this.min.z||box.min.z>this.max.z?false:true;},intersectsSphere:function(){var closestPoint=new Vector3$1();return function intersectsSphere(sphere){// Find the point on the AABB closest to the sphere center.
  this.clampPoint(sphere.center,closestPoint);// If that point is inside the sphere, the AABB and sphere intersect.
  return closestPoint.distanceToSquared(sphere.center)<=sphere.radius*sphere.radius;};}(),intersectsPlane:function intersectsPlane(plane){// We compute the minimum and maximum dot product values. If those values
  // are on the same side (back or front) of the plane, then there is no intersection.
  var min,max;if(plane.normal.x>0){min=plane.normal.x*this.min.x;max=plane.normal.x*this.max.x;}else{min=plane.normal.x*this.max.x;max=plane.normal.x*this.min.x;}if(plane.normal.y>0){min+=plane.normal.y*this.min.y;max+=plane.normal.y*this.max.y;}else{min+=plane.normal.y*this.max.y;max+=plane.normal.y*this.min.y;}if(plane.normal.z>0){min+=plane.normal.z*this.min.z;max+=plane.normal.z*this.max.z;}else{min+=plane.normal.z*this.max.z;max+=plane.normal.z*this.min.z;}return min<=plane.constant&&max>=plane.constant;},clampPoint:function clampPoint(point,optionalTarget){var result=optionalTarget||new Vector3$1();return result.copy(point).clamp(this.min,this.max);},distanceToPoint:function(){var v1=new Vector3$1();return function distanceToPoint(point){var clampedPoint=v1.copy(point).clamp(this.min,this.max);return clampedPoint.sub(point).length();};}(),getBoundingSphere:function(){var v1=new Vector3$1();return function getBoundingSphere(optionalTarget){var result=optionalTarget||new Sphere();this.getCenter(result.center);result.radius=this.getSize(v1).length()*0.5;return result;};}(),intersect:function intersect(box){this.min.max(box.min);this.max.min(box.max);// ensure that if there is no overlap, the result is fully empty, not slightly empty with non-inf/+inf values that will cause subsequence intersects to erroneously return valid values.
  if(this.isEmpty()){this.makeEmpty();}return this;},union:function union(box){this.min.min(box.min);this.max.max(box.max);return this;},applyMatrix4:function(){var points=[new Vector3$1(),new Vector3$1(),new Vector3$1(),new Vector3$1(),new Vector3$1(),new Vector3$1(),new Vector3$1(),new Vector3$1()];return function applyMatrix4(matrix){// transform of empty box is an empty box.
  if(this.isEmpty()){return this;}// NOTE: I am using a binary pattern to specify all 2^3 combinations below
  points[0].set(this.min.x,this.min.y,this.min.z).applyMatrix4(matrix);// 000
  points[1].set(this.min.x,this.min.y,this.max.z).applyMatrix4(matrix);// 001
  points[2].set(this.min.x,this.max.y,this.min.z).applyMatrix4(matrix);// 010
  points[3].set(this.min.x,this.max.y,this.max.z).applyMatrix4(matrix);// 011
  points[4].set(this.max.x,this.min.y,this.min.z).applyMatrix4(matrix);// 100
  points[5].set(this.max.x,this.min.y,this.max.z).applyMatrix4(matrix);// 101
  points[6].set(this.max.x,this.max.y,this.min.z).applyMatrix4(matrix);// 110
  points[7].set(this.max.x,this.max.y,this.max.z).applyMatrix4(matrix);// 111
  this.setFromPoints(points);return this;};}(),translate:function translate(offset){this.min.add(offset);this.max.add(offset);return this;},equals:function equals(box){return box.min.equals(this.min)&&box.max.equals(this.max);}});/**
   * @author supereggbert / http://www.paulbrunt.co.uk/
   * @author philogb / http://blog.thejit.org/
   * @author mikael emtinger / http://gomo.se/
   * @author egraether / http://egraether.com/
   * @author WestLangley / http://github.com/WestLangley
   */function Vector4$1(x,y,z,w){this.x=x||0;this.y=y||0;this.z=z||0;this.w=w!==undefined?w:1;}Object.assign(Vector4$1.prototype,{isVector4:true,set:function set$$1(x,y,z,w){this.x=x;this.y=y;this.z=z;this.w=w;return this;},setScalar:function setScalar(scalar){this.x=scalar;this.y=scalar;this.z=scalar;this.w=scalar;return this;},setX:function setX(x){this.x=x;return this;},setY:function setY(y){this.y=y;return this;},setZ:function setZ(z){this.z=z;return this;},setW:function setW(w){this.w=w;return this;},setComponent:function setComponent(index,value){switch(index){case 0:this.x=value;break;case 1:this.y=value;break;case 2:this.z=value;break;case 3:this.w=value;break;default:throw new Error('index is out of range: '+index);}return this;},getComponent:function getComponent(index){switch(index){case 0:return this.x;case 1:return this.y;case 2:return this.z;case 3:return this.w;default:throw new Error('index is out of range: '+index);}},clone:function clone(){return new this.constructor(this.x,this.y,this.z,this.w);},copy:function copy(v){this.x=v.x;this.y=v.y;this.z=v.z;this.w=v.w!==undefined?v.w:1;return this;},add:function add(v,w){if(w!==undefined){console.warn('THREE.Vector4: .add() now only accepts one argument. Use .addVectors( a, b ) instead.');return this.addVectors(v,w);}this.x+=v.x;this.y+=v.y;this.z+=v.z;this.w+=v.w;return this;},addScalar:function addScalar(s){this.x+=s;this.y+=s;this.z+=s;this.w+=s;return this;},addVectors:function addVectors(a,b){this.x=a.x+b.x;this.y=a.y+b.y;this.z=a.z+b.z;this.w=a.w+b.w;return this;},addScaledVector:function addScaledVector(v,s){this.x+=v.x*s;this.y+=v.y*s;this.z+=v.z*s;this.w+=v.w*s;return this;},sub:function sub(v,w){if(w!==undefined){console.warn('THREE.Vector4: .sub() now only accepts one argument. Use .subVectors( a, b ) instead.');return this.subVectors(v,w);}this.x-=v.x;this.y-=v.y;this.z-=v.z;this.w-=v.w;return this;},subScalar:function subScalar(s){this.x-=s;this.y-=s;this.z-=s;this.w-=s;return this;},subVectors:function subVectors(a,b){this.x=a.x-b.x;this.y=a.y-b.y;this.z=a.z-b.z;this.w=a.w-b.w;return this;},multiplyScalar:function multiplyScalar(scalar){this.x*=scalar;this.y*=scalar;this.z*=scalar;this.w*=scalar;return this;},applyMatrix4:function applyMatrix4(m){var x=this.x,y=this.y,z=this.z,w=this.w;var e=m.elements;this.x=e[0]*x+e[4]*y+e[8]*z+e[12]*w;this.y=e[1]*x+e[5]*y+e[9]*z+e[13]*w;this.z=e[2]*x+e[6]*y+e[10]*z+e[14]*w;this.w=e[3]*x+e[7]*y+e[11]*z+e[15]*w;return this;},divideScalar:function divideScalar(scalar){return this.multiplyScalar(1/scalar);},setAxisAngleFromQuaternion:function setAxisAngleFromQuaternion(q){// http://www.euclideanspace.com/maths/geometry/rotations/conversions/quaternionToAngle/index.htm
  // q is assumed to be normalized
  this.w=2*Math.acos(q.w);var s=Math.sqrt(1-q.w*q.w);if(s<0.0001){this.x=1;this.y=0;this.z=0;}else{this.x=q.x/s;this.y=q.y/s;this.z=q.z/s;}return this;},setAxisAngleFromRotationMatrix:function setAxisAngleFromRotationMatrix(m){// http://www.euclideanspace.com/maths/geometry/rotations/conversions/matrixToAngle/index.htm
  // assumes the upper 3x3 of m is a pure rotation matrix (i.e, unscaled)
  var angle,x,y,z,// variables for result
  epsilon=0.01,// margin to allow for rounding errors
  epsilon2=0.1,// margin to distinguish between 0 and 180 degrees
  te=m.elements,m11=te[0],m12=te[4],m13=te[8],m21=te[1],m22=te[5],m23=te[9],m31=te[2],m32=te[6],m33=te[10];if(Math.abs(m12-m21)<epsilon&&Math.abs(m13-m31)<epsilon&&Math.abs(m23-m32)<epsilon){// singularity found
  // first check for identity matrix which must have +1 for all terms
  // in leading diagonal and zero in other terms
  if(Math.abs(m12+m21)<epsilon2&&Math.abs(m13+m31)<epsilon2&&Math.abs(m23+m32)<epsilon2&&Math.abs(m11+m22+m33-3)<epsilon2){// this singularity is identity matrix so angle = 0
  this.set(1,0,0,0);return this;// zero angle, arbitrary axis
  }// otherwise this singularity is angle = 180
  angle=Math.PI;var xx=(m11+1)/2;var yy=(m22+1)/2;var zz=(m33+1)/2;var xy=(m12+m21)/4;var xz=(m13+m31)/4;var yz=(m23+m32)/4;if(xx>yy&&xx>zz){// m11 is the largest diagonal term
  if(xx<epsilon){x=0;y=0.707106781;z=0.707106781;}else{x=Math.sqrt(xx);y=xy/x;z=xz/x;}}else if(yy>zz){// m22 is the largest diagonal term
  if(yy<epsilon){x=0.707106781;y=0;z=0.707106781;}else{y=Math.sqrt(yy);x=xy/y;z=yz/y;}}else{// m33 is the largest diagonal term so base result on this
  if(zz<epsilon){x=0.707106781;y=0.707106781;z=0;}else{z=Math.sqrt(zz);x=xz/z;y=yz/z;}}this.set(x,y,z,angle);return this;// return 180 deg rotation
  }// as we have reached here there are no singularities so we can handle normally
  var s=Math.sqrt((m32-m23)*(m32-m23)+(m13-m31)*(m13-m31)+(m21-m12)*(m21-m12));// used to normalize
  if(Math.abs(s)<0.001){s=1;}// prevent divide by zero, should not happen if matrix is orthogonal and should be
  // caught by singularity test above, but I've left it in just in case
  this.x=(m32-m23)/s;this.y=(m13-m31)/s;this.z=(m21-m12)/s;this.w=Math.acos((m11+m22+m33-1)/2);return this;},min:function min(v){this.x=Math.min(this.x,v.x);this.y=Math.min(this.y,v.y);this.z=Math.min(this.z,v.z);this.w=Math.min(this.w,v.w);return this;},max:function max(v){this.x=Math.max(this.x,v.x);this.y=Math.max(this.y,v.y);this.z=Math.max(this.z,v.z);this.w=Math.max(this.w,v.w);return this;},clamp:function clamp(min,max){// assumes min < max, componentwise
  this.x=Math.max(min.x,Math.min(max.x,this.x));this.y=Math.max(min.y,Math.min(max.y,this.y));this.z=Math.max(min.z,Math.min(max.z,this.z));this.w=Math.max(min.w,Math.min(max.w,this.w));return this;},clampScalar:function(){var min,max;return function clampScalar(minVal,maxVal){if(min===undefined){min=new Vector4$1();max=new Vector4$1();}min.set(minVal,minVal,minVal,minVal);max.set(maxVal,maxVal,maxVal,maxVal);return this.clamp(min,max);};}(),clampLength:function clampLength(min,max){var length=this.length();return this.divideScalar(length||1).multiplyScalar(Math.max(min,Math.min(max,length)));},floor:function floor(){this.x=Math.floor(this.x);this.y=Math.floor(this.y);this.z=Math.floor(this.z);this.w=Math.floor(this.w);return this;},ceil:function ceil(){this.x=Math.ceil(this.x);this.y=Math.ceil(this.y);this.z=Math.ceil(this.z);this.w=Math.ceil(this.w);return this;},round:function round(){this.x=Math.round(this.x);this.y=Math.round(this.y);this.z=Math.round(this.z);this.w=Math.round(this.w);return this;},roundToZero:function roundToZero(){this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x);this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y);this.z=this.z<0?Math.ceil(this.z):Math.floor(this.z);this.w=this.w<0?Math.ceil(this.w):Math.floor(this.w);return this;},negate:function negate(){this.x=-this.x;this.y=-this.y;this.z=-this.z;this.w=-this.w;return this;},dot:function dot(v){return this.x*v.x+this.y*v.y+this.z*v.z+this.w*v.w;},lengthSq:function lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w;},length:function length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w);},manhattanLength:function manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)+Math.abs(this.w);},normalize:function normalize(){return this.divideScalar(this.length()||1);},setLength:function setLength(length){return this.normalize().multiplyScalar(length);},lerp:function lerp(v,alpha){this.x+=(v.x-this.x)*alpha;this.y+=(v.y-this.y)*alpha;this.z+=(v.z-this.z)*alpha;this.w+=(v.w-this.w)*alpha;return this;},lerpVectors:function lerpVectors(v1,v2,alpha){return this.subVectors(v2,v1).multiplyScalar(alpha).add(v1);},equals:function equals(v){return v.x===this.x&&v.y===this.y&&v.z===this.z&&v.w===this.w;},fromArray:function fromArray(array,offset){if(offset===undefined){offset=0;}this.x=array[offset];this.y=array[offset+1];this.z=array[offset+2];this.w=array[offset+3];return this;},toArray:function toArray$$1(array,offset){if(array===undefined){array=[];}if(offset===undefined){offset=0;}array[offset]=this.x;array[offset+1]=this.y;array[offset+2]=this.z;array[offset+3]=this.w;return array;},fromBufferAttribute:function fromBufferAttribute(attribute,index,offset){if(offset!==undefined){console.warn('THREE.Vector4: offset has been removed from .fromBufferAttribute().');}this.x=attribute.getX(index);this.y=attribute.getY(index);this.z=attribute.getZ(index);this.w=attribute.getW(index);return this;}});/**
   * @author mrdoob / http://mrdoob.com/
   * @author philogb / http://blog.thejit.org/
   * @author egraether / http://egraether.com/
   * @author zz85 / http://www.lab4games.net/zz85/blog
   */function Vector2$1(x,y){this.x=x||0;this.y=y||0;}Object.defineProperties(Vector2$1.prototype,{"width":{get:function get$$1(){return this.x;},set:function set$$1(value){this.x=value;}},"height":{get:function get$$1(){return this.y;},set:function set$$1(value){this.y=value;}}});Object.assign(Vector2$1.prototype,{isVector2:true,set:function set$$1(x,y){this.x=x;this.y=y;return this;},setScalar:function setScalar(scalar){this.x=scalar;this.y=scalar;return this;},setX:function setX(x){this.x=x;return this;},setY:function setY(y){this.y=y;return this;},setComponent:function setComponent(index,value){switch(index){case 0:this.x=value;break;case 1:this.y=value;break;default:throw new Error('index is out of range: '+index);}return this;},getComponent:function getComponent(index){switch(index){case 0:return this.x;case 1:return this.y;default:throw new Error('index is out of range: '+index);}},clone:function clone(){return new this.constructor(this.x,this.y);},copy:function copy(v){this.x=v.x;this.y=v.y;return this;},add:function add(v,w){if(w!==undefined){console.warn('THREE.Vector2: .add() now only accepts one argument. Use .addVectors( a, b ) instead.');return this.addVectors(v,w);}this.x+=v.x;this.y+=v.y;return this;},addScalar:function addScalar(s){this.x+=s;this.y+=s;return this;},addVectors:function addVectors(a,b){this.x=a.x+b.x;this.y=a.y+b.y;return this;},addScaledVector:function addScaledVector(v,s){this.x+=v.x*s;this.y+=v.y*s;return this;},sub:function sub(v,w){if(w!==undefined){console.warn('THREE.Vector2: .sub() now only accepts one argument. Use .subVectors( a, b ) instead.');return this.subVectors(v,w);}this.x-=v.x;this.y-=v.y;return this;},subScalar:function subScalar(s){this.x-=s;this.y-=s;return this;},subVectors:function subVectors(a,b){this.x=a.x-b.x;this.y=a.y-b.y;return this;},multiply:function multiply(v){this.x*=v.x;this.y*=v.y;return this;},multiplyScalar:function multiplyScalar(scalar){this.x*=scalar;this.y*=scalar;return this;},divide:function divide(v){this.x/=v.x;this.y/=v.y;return this;},divideScalar:function divideScalar(scalar){return this.multiplyScalar(1/scalar);},applyMatrix3:function applyMatrix3(m){var x=this.x,y=this.y;var e=m.elements;this.x=e[0]*x+e[3]*y+e[6];this.y=e[1]*x+e[4]*y+e[7];return this;},min:function min(v){this.x=Math.min(this.x,v.x);this.y=Math.min(this.y,v.y);return this;},max:function max(v){this.x=Math.max(this.x,v.x);this.y=Math.max(this.y,v.y);return this;},clamp:function clamp(min,max){// assumes min < max, componentwise
  this.x=Math.max(min.x,Math.min(max.x,this.x));this.y=Math.max(min.y,Math.min(max.y,this.y));return this;},clampScalar:function(){var min=new Vector2$1();var max=new Vector2$1();return function clampScalar(minVal,maxVal){min.set(minVal,minVal);max.set(maxVal,maxVal);return this.clamp(min,max);};}(),clampLength:function clampLength(min,max){var length=this.length();return this.divideScalar(length||1).multiplyScalar(Math.max(min,Math.min(max,length)));},floor:function floor(){this.x=Math.floor(this.x);this.y=Math.floor(this.y);return this;},ceil:function ceil(){this.x=Math.ceil(this.x);this.y=Math.ceil(this.y);return this;},round:function round(){this.x=Math.round(this.x);this.y=Math.round(this.y);return this;},roundToZero:function roundToZero(){this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x);this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y);return this;},negate:function negate(){this.x=-this.x;this.y=-this.y;return this;},dot:function dot(v){return this.x*v.x+this.y*v.y;},lengthSq:function lengthSq(){return this.x*this.x+this.y*this.y;},length:function length(){return Math.sqrt(this.x*this.x+this.y*this.y);},manhattanLength:function manhattanLength(){return Math.abs(this.x)+Math.abs(this.y);},normalize:function normalize(){return this.divideScalar(this.length()||1);},angle:function angle(){// computes the angle in radians with respect to the positive x-axis
  var angle=Math.atan2(this.y,this.x);if(angle<0){angle+=2*Math.PI;}return angle;},distanceTo:function distanceTo(v){return Math.sqrt(this.distanceToSquared(v));},distanceToSquared:function distanceToSquared(v){var dx=this.x-v.x,dy=this.y-v.y;return dx*dx+dy*dy;},manhattanDistanceTo:function manhattanDistanceTo(v){return Math.abs(this.x-v.x)+Math.abs(this.y-v.y);},setLength:function setLength(length){return this.normalize().multiplyScalar(length);},lerp:function lerp(v,alpha){this.x+=(v.x-this.x)*alpha;this.y+=(v.y-this.y)*alpha;return this;},lerpVectors:function lerpVectors(v1,v2,alpha){return this.subVectors(v2,v1).multiplyScalar(alpha).add(v1);},equals:function equals(v){return v.x===this.x&&v.y===this.y;},fromArray:function fromArray(array,offset){if(offset===undefined){offset=0;}this.x=array[offset];this.y=array[offset+1];return this;},toArray:function toArray$$1(array,offset){if(array===undefined){array=[];}if(offset===undefined){offset=0;}array[offset]=this.x;array[offset+1]=this.y;return array;},fromBufferAttribute:function fromBufferAttribute(attribute,index,offset){if(offset!==undefined){console.warn('THREE.Vector2: offset has been removed from .fromBufferAttribute().');}this.x=attribute.getX(index);this.y=attribute.getY(index);return this;},rotateAround:function rotateAround(center,angle){var c=Math.cos(angle),s=Math.sin(angle);var x=this.x-center.x;var y=this.y-center.y;this.x=x*c-y*s+center.x;this.y=x*s+y*c+center.y;return this;}});/**
   * @author mrdoob / http://mrdoob.com/
   */var ColorKeywords={'aliceblue':0xF0F8FF,'antiquewhite':0xFAEBD7,'aqua':0x00FFFF,'aquamarine':0x7FFFD4,'azure':0xF0FFFF,'beige':0xF5F5DC,'bisque':0xFFE4C4,'black':0x000000,'blanchedalmond':0xFFEBCD,'blue':0x0000FF,'blueviolet':0x8A2BE2,'brown':0xA52A2A,'burlywood':0xDEB887,'cadetblue':0x5F9EA0,'chartreuse':0x7FFF00,'chocolate':0xD2691E,'coral':0xFF7F50,'cornflowerblue':0x6495ED,'cornsilk':0xFFF8DC,'crimson':0xDC143C,'cyan':0x00FFFF,'darkblue':0x00008B,'darkcyan':0x008B8B,'darkgoldenrod':0xB8860B,'darkgray':0xA9A9A9,'darkgreen':0x006400,'darkgrey':0xA9A9A9,'darkkhaki':0xBDB76B,'darkmagenta':0x8B008B,'darkolivegreen':0x556B2F,'darkorange':0xFF8C00,'darkorchid':0x9932CC,'darkred':0x8B0000,'darksalmon':0xE9967A,'darkseagreen':0x8FBC8F,'darkslateblue':0x483D8B,'darkslategray':0x2F4F4F,'darkslategrey':0x2F4F4F,'darkturquoise':0x00CED1,'darkviolet':0x9400D3,'deeppink':0xFF1493,'deepskyblue':0x00BFFF,'dimgray':0x696969,'dimgrey':0x696969,'dodgerblue':0x1E90FF,'firebrick':0xB22222,'floralwhite':0xFFFAF0,'forestgreen':0x228B22,'fuchsia':0xFF00FF,'gainsboro':0xDCDCDC,'ghostwhite':0xF8F8FF,'gold':0xFFD700,'goldenrod':0xDAA520,'gray':0x808080,'green':0x008000,'greenyellow':0xADFF2F,'grey':0x808080,'honeydew':0xF0FFF0,'hotpink':0xFF69B4,'indianred':0xCD5C5C,'indigo':0x4B0082,'ivory':0xFFFFF0,'khaki':0xF0E68C,'lavender':0xE6E6FA,'lavenderblush':0xFFF0F5,'lawngreen':0x7CFC00,'lemonchiffon':0xFFFACD,'lightblue':0xADD8E6,'lightcoral':0xF08080,'lightcyan':0xE0FFFF,'lightgoldenrodyellow':0xFAFAD2,'lightgray':0xD3D3D3,'lightgreen':0x90EE90,'lightgrey':0xD3D3D3,'lightpink':0xFFB6C1,'lightsalmon':0xFFA07A,'lightseagreen':0x20B2AA,'lightskyblue':0x87CEFA,'lightslategray':0x778899,'lightslategrey':0x778899,'lightsteelblue':0xB0C4DE,'lightyellow':0xFFFFE0,'lime':0x00FF00,'limegreen':0x32CD32,'linen':0xFAF0E6,'magenta':0xFF00FF,'maroon':0x800000,'mediumaquamarine':0x66CDAA,'mediumblue':0x0000CD,'mediumorchid':0xBA55D3,'mediumpurple':0x9370DB,'mediumseagreen':0x3CB371,'mediumslateblue':0x7B68EE,'mediumspringgreen':0x00FA9A,'mediumturquoise':0x48D1CC,'mediumvioletred':0xC71585,'midnightblue':0x191970,'mintcream':0xF5FFFA,'mistyrose':0xFFE4E1,'moccasin':0xFFE4B5,'navajowhite':0xFFDEAD,'navy':0x000080,'oldlace':0xFDF5E6,'olive':0x808000,'olivedrab':0x6B8E23,'orange':0xFFA500,'orangered':0xFF4500,'orchid':0xDA70D6,'palegoldenrod':0xEEE8AA,'palegreen':0x98FB98,'paleturquoise':0xAFEEEE,'palevioletred':0xDB7093,'papayawhip':0xFFEFD5,'peachpuff':0xFFDAB9,'peru':0xCD853F,'pink':0xFFC0CB,'plum':0xDDA0DD,'powderblue':0xB0E0E6,'purple':0x800080,'rebeccapurple':0x663399,'red':0xFF0000,'rosybrown':0xBC8F8F,'royalblue':0x4169E1,'saddlebrown':0x8B4513,'salmon':0xFA8072,'sandybrown':0xF4A460,'seagreen':0x2E8B57,'seashell':0xFFF5EE,'sienna':0xA0522D,'silver':0xC0C0C0,'skyblue':0x87CEEB,'slateblue':0x6A5ACD,'slategray':0x708090,'slategrey':0x708090,'snow':0xFFFAFA,'springgreen':0x00FF7F,'steelblue':0x4682B4,'tan':0xD2B48C,'teal':0x008080,'thistle':0xD8BFD8,'tomato':0xFF6347,'turquoise':0x40E0D0,'violet':0xEE82EE,'wheat':0xF5DEB3,'white':0xFFFFFF,'whitesmoke':0xF5F5F5,'yellow':0xFFFF00,'yellowgreen':0x9ACD32};function Color$1(r,g,b){if(g===undefined&&b===undefined){// r is THREE.Color, hex or string
  return this.set(r);}return this.setRGB(r,g,b);}Object.assign(Color$1.prototype,{isColor:true,r:1,g:1,b:1,set:function set$$1(value){if(value&&value.isColor){this.copy(value);}else if(typeof value==='number'){this.setHex(value);}else if(typeof value==='string'){this.setStyle(value);}return this;},setScalar:function setScalar(scalar){this.r=scalar;this.g=scalar;this.b=scalar;return this;},setHex:function setHex(hex){hex=Math.floor(hex);this.r=(hex>>16&255)/255;this.g=(hex>>8&255)/255;this.b=(hex&255)/255;return this;},setRGB:function setRGB(r,g,b){this.r=r;this.g=g;this.b=b;return this;},setHSL:function(){function hue2rgb(p,q,t){if(t<0){t+=1;}if(t>1){t-=1;}if(t<1/6){return p+(q-p)*6*t;}if(t<1/2){return q;}if(t<2/3){return p+(q-p)*6*(2/3-t);}return p;}return function setHSL(h,s,l){// h,s,l ranges are in 0.0 - 1.0
  h=_Math$1.euclideanModulo(h,1);s=_Math$1.clamp(s,0,1);l=_Math$1.clamp(l,0,1);if(s===0){this.r=this.g=this.b=l;}else{var p=l<=0.5?l*(1+s):l+s-l*s;var q=2*l-p;this.r=hue2rgb(q,p,h+1/3);this.g=hue2rgb(q,p,h);this.b=hue2rgb(q,p,h-1/3);}return this;};}(),setStyle:function setStyle(style){function handleAlpha(string){if(string===undefined){return;}if(parseFloat(string)<1){console.warn('THREE.Color: Alpha component of '+style+' will be ignored.');}}var m;if(m=/^((?:rgb|hsl)a?)\(\s*([^\)]*)\)/.exec(style)){// rgb / hsl
  var color;var name=m[1];var components=m[2];switch(name){case'rgb':case'rgba':if(color=/^(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*(,\s*([0-9]*\.?[0-9]+)\s*)?$/.exec(components)){// rgb(255,0,0) rgba(255,0,0,0.5)
  this.r=Math.min(255,parseInt(color[1],10))/255;this.g=Math.min(255,parseInt(color[2],10))/255;this.b=Math.min(255,parseInt(color[3],10))/255;handleAlpha(color[5]);return this;}if(color=/^(\d+)\%\s*,\s*(\d+)\%\s*,\s*(\d+)\%\s*(,\s*([0-9]*\.?[0-9]+)\s*)?$/.exec(components)){// rgb(100%,0%,0%) rgba(100%,0%,0%,0.5)
  this.r=Math.min(100,parseInt(color[1],10))/100;this.g=Math.min(100,parseInt(color[2],10))/100;this.b=Math.min(100,parseInt(color[3],10))/100;handleAlpha(color[5]);return this;}break;case'hsl':case'hsla':if(color=/^([0-9]*\.?[0-9]+)\s*,\s*(\d+)\%\s*,\s*(\d+)\%\s*(,\s*([0-9]*\.?[0-9]+)\s*)?$/.exec(components)){// hsl(120,50%,50%) hsla(120,50%,50%,0.5)
  var h=parseFloat(color[1])/360;var s=parseInt(color[2],10)/100;var l=parseInt(color[3],10)/100;handleAlpha(color[5]);return this.setHSL(h,s,l);}break;}}else if(m=/^\#([A-Fa-f0-9]+)$/.exec(style)){// hex color
  var hex=m[1];var size=hex.length;if(size===3){// #ff0
  this.r=parseInt(hex.charAt(0)+hex.charAt(0),16)/255;this.g=parseInt(hex.charAt(1)+hex.charAt(1),16)/255;this.b=parseInt(hex.charAt(2)+hex.charAt(2),16)/255;return this;}else if(size===6){// #ff0000
  this.r=parseInt(hex.charAt(0)+hex.charAt(1),16)/255;this.g=parseInt(hex.charAt(2)+hex.charAt(3),16)/255;this.b=parseInt(hex.charAt(4)+hex.charAt(5),16)/255;return this;}}if(style&&style.length>0){// color keywords
  var hex=ColorKeywords[style];if(hex!==undefined){// red
  this.setHex(hex);}else{// unknown color
  console.warn('THREE.Color: Unknown color '+style);}}return this;},clone:function clone(){return new this.constructor(this.r,this.g,this.b);},copy:function copy(color){this.r=color.r;this.g=color.g;this.b=color.b;return this;},copyGammaToLinear:function copyGammaToLinear(color,gammaFactor){if(gammaFactor===undefined){gammaFactor=2.0;}this.r=Math.pow(color.r,gammaFactor);this.g=Math.pow(color.g,gammaFactor);this.b=Math.pow(color.b,gammaFactor);return this;},copyLinearToGamma:function copyLinearToGamma(color,gammaFactor){if(gammaFactor===undefined){gammaFactor=2.0;}var safeInverse=gammaFactor>0?1.0/gammaFactor:1.0;this.r=Math.pow(color.r,safeInverse);this.g=Math.pow(color.g,safeInverse);this.b=Math.pow(color.b,safeInverse);return this;},convertGammaToLinear:function convertGammaToLinear(){var r=this.r,g=this.g,b=this.b;this.r=r*r;this.g=g*g;this.b=b*b;return this;},convertLinearToGamma:function convertLinearToGamma(){this.r=Math.sqrt(this.r);this.g=Math.sqrt(this.g);this.b=Math.sqrt(this.b);return this;},getHex:function getHex(){return this.r*255<<16^this.g*255<<8^this.b*255<<0;},getHexString:function getHexString(){return('000000'+this.getHex().toString(16)).slice(-6);},getHSL:function getHSL(optionalTarget){// h,s,l ranges are in 0.0 - 1.0
  var hsl=optionalTarget||{h:0,s:0,l:0};var r=this.r,g=this.g,b=this.b;var max=Math.max(r,g,b);var min=Math.min(r,g,b);var hue,saturation;var lightness=(min+max)/2.0;if(min===max){hue=0;saturation=0;}else{var delta=max-min;saturation=lightness<=0.5?delta/(max+min):delta/(2-max-min);switch(max){case r:hue=(g-b)/delta+(g<b?6:0);break;case g:hue=(b-r)/delta+2;break;case b:hue=(r-g)/delta+4;break;}hue/=6;}hsl.h=hue;hsl.s=saturation;hsl.l=lightness;return hsl;},getStyle:function getStyle(){return'rgb('+(this.r*255|0)+','+(this.g*255|0)+','+(this.b*255|0)+')';},offsetHSL:function offsetHSL(h,s,l){var hsl=this.getHSL();hsl.h+=h;hsl.s+=s;hsl.l+=l;this.setHSL(hsl.h,hsl.s,hsl.l);return this;},add:function add(color){this.r+=color.r;this.g+=color.g;this.b+=color.b;return this;},addColors:function addColors(color1,color2){this.r=color1.r+color2.r;this.g=color1.g+color2.g;this.b=color1.b+color2.b;return this;},addScalar:function addScalar(s){this.r+=s;this.g+=s;this.b+=s;return this;},sub:function sub(color){this.r=Math.max(0,this.r-color.r);this.g=Math.max(0,this.g-color.g);this.b=Math.max(0,this.b-color.b);return this;},multiply:function multiply(color){this.r*=color.r;this.g*=color.g;this.b*=color.b;return this;},multiplyScalar:function multiplyScalar(s){this.r*=s;this.g*=s;this.b*=s;return this;},lerp:function lerp(color,alpha){this.r+=(color.r-this.r)*alpha;this.g+=(color.g-this.g)*alpha;this.b+=(color.b-this.b)*alpha;return this;},equals:function equals(c){return c.r===this.r&&c.g===this.g&&c.b===this.b;},fromArray:function fromArray(array,offset){if(offset===undefined){offset=0;}this.r=array[offset];this.g=array[offset+1];this.b=array[offset+2];return this;},toArray:function toArray$$1(array,offset){if(array===undefined){array=[];}if(offset===undefined){offset=0;}array[offset]=this.r;array[offset+1]=this.g;array[offset+2]=this.b;return array;},toJSON:function toJSON(){return this.getHex();}});/**
   * @author mrdoob / http://mrdoob.com/
   */function BufferAttribute(array,itemSize,normalized){if(Array.isArray(array)){throw new TypeError('THREE.BufferAttribute: array should be a Typed Array.');}this.uuid=_Math$1.generateUUID();this.name='';this.array=array;this.itemSize=itemSize;this.count=array!==undefined?array.length/itemSize:0;this.normalized=normalized===true;this.dynamic=false;this.updateRange={offset:0,count:-1};this.onUploadCallback=function(){};this.version=0;}Object.defineProperty(BufferAttribute.prototype,'needsUpdate',{set:function set$$1(value){if(value===true){this.version++;}}});Object.assign(BufferAttribute.prototype,{isBufferAttribute:true,setArray:function setArray(array){if(Array.isArray(array)){throw new TypeError('THREE.BufferAttribute: array should be a Typed Array.');}this.count=array!==undefined?array.length/this.itemSize:0;this.array=array;},setDynamic:function setDynamic(value){this.dynamic=value;return this;},copy:function copy(source){this.array=new source.array.constructor(source.array);this.itemSize=source.itemSize;this.count=source.count;this.normalized=source.normalized;this.dynamic=source.dynamic;return this;},copyAt:function copyAt(index1,attribute,index2){var this$1=this;index1*=this.itemSize;index2*=attribute.itemSize;for(var i=0,l=this.itemSize;i<l;i++){this$1.array[index1+i]=attribute.array[index2+i];}return this;},copyArray:function copyArray(array){this.array.set(array);return this;},copyColorsArray:function copyColorsArray(colors){var array=this.array,offset=0;for(var i=0,l=colors.length;i<l;i++){var color=colors[i];if(color===undefined){console.warn('THREE.BufferAttribute.copyColorsArray(): color is undefined',i);color=new Color$1();}array[offset++]=color.r;array[offset++]=color.g;array[offset++]=color.b;}return this;},copyIndicesArray:function copyIndicesArray(indices){var array=this.array,offset=0;for(var i=0,l=indices.length;i<l;i++){var index=indices[i];array[offset++]=index.a;array[offset++]=index.b;array[offset++]=index.c;}return this;},copyVector2sArray:function copyVector2sArray(vectors){var array=this.array,offset=0;for(var i=0,l=vectors.length;i<l;i++){var vector=vectors[i];if(vector===undefined){console.warn('THREE.BufferAttribute.copyVector2sArray(): vector is undefined',i);vector=new Vector2$1();}array[offset++]=vector.x;array[offset++]=vector.y;}return this;},copyVector3sArray:function copyVector3sArray(vectors){var array=this.array,offset=0;for(var i=0,l=vectors.length;i<l;i++){var vector=vectors[i];if(vector===undefined){console.warn('THREE.BufferAttribute.copyVector3sArray(): vector is undefined',i);vector=new Vector3$1();}array[offset++]=vector.x;array[offset++]=vector.y;array[offset++]=vector.z;}return this;},copyVector4sArray:function copyVector4sArray(vectors){var array=this.array,offset=0;for(var i=0,l=vectors.length;i<l;i++){var vector=vectors[i];if(vector===undefined){console.warn('THREE.BufferAttribute.copyVector4sArray(): vector is undefined',i);vector=new Vector4$1();}array[offset++]=vector.x;array[offset++]=vector.y;array[offset++]=vector.z;array[offset++]=vector.w;}return this;},set:function set$$1(value,offset){if(offset===undefined){offset=0;}this.array.set(value,offset);return this;},getX:function getX(index){return this.array[index*this.itemSize];},setX:function setX(index,x){this.array[index*this.itemSize]=x;return this;},getY:function getY(index){return this.array[index*this.itemSize+1];},setY:function setY(index,y){this.array[index*this.itemSize+1]=y;return this;},getZ:function getZ(index){return this.array[index*this.itemSize+2];},setZ:function setZ(index,z){this.array[index*this.itemSize+2]=z;return this;},getW:function getW(index){return this.array[index*this.itemSize+3];},setW:function setW(index,w){this.array[index*this.itemSize+3]=w;return this;},setXY:function setXY(index,x,y){index*=this.itemSize;this.array[index+0]=x;this.array[index+1]=y;return this;},setXYZ:function setXYZ(index,x,y,z){index*=this.itemSize;this.array[index+0]=x;this.array[index+1]=y;this.array[index+2]=z;return this;},setXYZW:function setXYZW(index,x,y,z,w){index*=this.itemSize;this.array[index+0]=x;this.array[index+1]=y;this.array[index+2]=z;this.array[index+3]=w;return this;},onUpload:function onUpload(callback){this.onUploadCallback=callback;return this;},clone:function clone(){return new this.constructor(this.array,this.itemSize).copy(this);}});//
  function Int8BufferAttribute(array,itemSize,normalized){BufferAttribute.call(this,new Int8Array(array),itemSize,normalized);}Int8BufferAttribute.prototype=Object.create(BufferAttribute.prototype);Int8BufferAttribute.prototype.constructor=Int8BufferAttribute;function Uint8BufferAttribute(array,itemSize,normalized){BufferAttribute.call(this,new Uint8Array(array),itemSize,normalized);}Uint8BufferAttribute.prototype=Object.create(BufferAttribute.prototype);Uint8BufferAttribute.prototype.constructor=Uint8BufferAttribute;function Uint8ClampedBufferAttribute(array,itemSize,normalized){BufferAttribute.call(this,new Uint8ClampedArray(array),itemSize,normalized);}Uint8ClampedBufferAttribute.prototype=Object.create(BufferAttribute.prototype);Uint8ClampedBufferAttribute.prototype.constructor=Uint8ClampedBufferAttribute;function Int16BufferAttribute(array,itemSize,normalized){BufferAttribute.call(this,new Int16Array(array),itemSize,normalized);}Int16BufferAttribute.prototype=Object.create(BufferAttribute.prototype);Int16BufferAttribute.prototype.constructor=Int16BufferAttribute;function Uint16BufferAttribute(array,itemSize,normalized){BufferAttribute.call(this,new Uint16Array(array),itemSize,normalized);}Uint16BufferAttribute.prototype=Object.create(BufferAttribute.prototype);Uint16BufferAttribute.prototype.constructor=Uint16BufferAttribute;function Int32BufferAttribute(array,itemSize,normalized){BufferAttribute.call(this,new Int32Array(array),itemSize,normalized);}Int32BufferAttribute.prototype=Object.create(BufferAttribute.prototype);Int32BufferAttribute.prototype.constructor=Int32BufferAttribute;function Uint32BufferAttribute(array,itemSize,normalized){BufferAttribute.call(this,new Uint32Array(array),itemSize,normalized);}Uint32BufferAttribute.prototype=Object.create(BufferAttribute.prototype);Uint32BufferAttribute.prototype.constructor=Uint32BufferAttribute;function Float32BufferAttribute(array,itemSize,normalized){BufferAttribute.call(this,new Float32Array(array),itemSize,normalized);}Float32BufferAttribute.prototype=Object.create(BufferAttribute.prototype);Float32BufferAttribute.prototype.constructor=Float32BufferAttribute;function Float64BufferAttribute(array,itemSize,normalized){BufferAttribute.call(this,new Float64Array(array),itemSize,normalized);}Float64BufferAttribute.prototype=Object.create(BufferAttribute.prototype);Float64BufferAttribute.prototype.constructor=Float64BufferAttribute;/**
   * @author mrdoob / http://mrdoob.com/
   */function DirectGeometry(){this.indices=[];this.vertices=[];this.normals=[];this.colors=[];this.uvs=[];this.uvs2=[];this.groups=[];this.morphTargets={};this.skinWeights=[];this.skinIndices=[];// this.lineDistances = [];
  this.boundingBox=null;this.boundingSphere=null;// update flags
  this.verticesNeedUpdate=false;this.normalsNeedUpdate=false;this.colorsNeedUpdate=false;this.uvsNeedUpdate=false;this.groupsNeedUpdate=false;}Object.assign(DirectGeometry.prototype,{computeGroups:function computeGroups(geometry){var group;var groups=[];var materialIndex=undefined;var faces=geometry.faces;for(var i=0;i<faces.length;i++){var face=faces[i];// materials
  if(face.materialIndex!==materialIndex){materialIndex=face.materialIndex;if(group!==undefined){group.count=i*3-group.start;groups.push(group);}group={start:i*3,materialIndex:materialIndex};}}if(group!==undefined){group.count=i*3-group.start;groups.push(group);}this.groups=groups;},fromGeometry:function fromGeometry(geometry){var this$1=this;var faces=geometry.faces;var vertices=geometry.vertices;var faceVertexUvs=geometry.faceVertexUvs;var hasFaceVertexUv=faceVertexUvs[0]&&faceVertexUvs[0].length>0;var hasFaceVertexUv2=faceVertexUvs[1]&&faceVertexUvs[1].length>0;// morphs
  var morphTargets=geometry.morphTargets;var morphTargetsLength=morphTargets.length;var morphTargetsPosition;if(morphTargetsLength>0){morphTargetsPosition=[];for(var i=0;i<morphTargetsLength;i++){morphTargetsPosition[i]=[];}this.morphTargets.position=morphTargetsPosition;}var morphNormals=geometry.morphNormals;var morphNormalsLength=morphNormals.length;var morphTargetsNormal;if(morphNormalsLength>0){morphTargetsNormal=[];for(var i=0;i<morphNormalsLength;i++){morphTargetsNormal[i]=[];}this.morphTargets.normal=morphTargetsNormal;}// skins
  var skinIndices=geometry.skinIndices;var skinWeights=geometry.skinWeights;var hasSkinIndices=skinIndices.length===vertices.length;var hasSkinWeights=skinWeights.length===vertices.length;//
  for(var i=0;i<faces.length;i++){var face=faces[i];this$1.vertices.push(vertices[face.a],vertices[face.b],vertices[face.c]);var vertexNormals=face.vertexNormals;if(vertexNormals.length===3){this$1.normals.push(vertexNormals[0],vertexNormals[1],vertexNormals[2]);}else{var normal=face.normal;this$1.normals.push(normal,normal,normal);}var vertexColors=face.vertexColors;if(vertexColors.length===3){this$1.colors.push(vertexColors[0],vertexColors[1],vertexColors[2]);}else{var color=face.color;this$1.colors.push(color,color,color);}if(hasFaceVertexUv===true){var vertexUvs=faceVertexUvs[0][i];if(vertexUvs!==undefined){this$1.uvs.push(vertexUvs[0],vertexUvs[1],vertexUvs[2]);}else{console.warn('THREE.DirectGeometry.fromGeometry(): Undefined vertexUv ',i);this$1.uvs.push(new Vector2$1(),new Vector2$1(),new Vector2$1());}}if(hasFaceVertexUv2===true){var vertexUvs=faceVertexUvs[1][i];if(vertexUvs!==undefined){this$1.uvs2.push(vertexUvs[0],vertexUvs[1],vertexUvs[2]);}else{console.warn('THREE.DirectGeometry.fromGeometry(): Undefined vertexUv2 ',i);this$1.uvs2.push(new Vector2$1(),new Vector2$1(),new Vector2$1());}}// morphs
  for(var j=0;j<morphTargetsLength;j++){var morphTarget=morphTargets[j].vertices;morphTargetsPosition[j].push(morphTarget[face.a],morphTarget[face.b],morphTarget[face.c]);}for(var j=0;j<morphNormalsLength;j++){var morphNormal=morphNormals[j].vertexNormals[i];morphTargetsNormal[j].push(morphNormal.a,morphNormal.b,morphNormal.c);}// skins
  if(hasSkinIndices){this$1.skinIndices.push(skinIndices[face.a],skinIndices[face.b],skinIndices[face.c]);}if(hasSkinWeights){this$1.skinWeights.push(skinWeights[face.a],skinWeights[face.b],skinWeights[face.c]);}}this.computeGroups(geometry);this.verticesNeedUpdate=geometry.verticesNeedUpdate;this.normalsNeedUpdate=geometry.normalsNeedUpdate;this.colorsNeedUpdate=geometry.colorsNeedUpdate;this.uvsNeedUpdate=geometry.uvsNeedUpdate;this.groupsNeedUpdate=geometry.groupsNeedUpdate;return this;}});/**
   * @author mrdoob / http://mrdoob.com/
   */function arrayMax(array){if(array.length===0){return-Infinity;}var max=array[0];for(var i=1,l=array.length;i<l;++i){if(array[i]>max){max=array[i];}}return max;}/**
   * @author alteredq / http://alteredqualia.com/
   * @author mrdoob / http://mrdoob.com/
   */var bufferGeometryId=1;// BufferGeometry uses odd numbers as Id
  function BufferGeometry(){Object.defineProperty(this,'id',{value:bufferGeometryId+=2});this.uuid=_Math$1.generateUUID();this.name='';this.type='BufferGeometry';this.index=null;this.attributes={};this.morphAttributes={};this.groups=[];this.boundingBox=null;this.boundingSphere=null;this.drawRange={start:0,count:Infinity};}BufferGeometry.prototype=Object.assign(Object.create(EventDispatcher.prototype),{constructor:BufferGeometry,isBufferGeometry:true,getIndex:function getIndex(){return this.index;},setIndex:function setIndex(index){if(Array.isArray(index)){this.index=new(arrayMax(index)>65535?Uint32BufferAttribute:Uint16BufferAttribute)(index,1);}else{this.index=index;}},addAttribute:function addAttribute(name,attribute){if(!(attribute&&attribute.isBufferAttribute)&&!(attribute&&attribute.isInterleavedBufferAttribute)){console.warn('THREE.BufferGeometry: .addAttribute() now expects ( name, attribute ).');this.addAttribute(name,new BufferAttribute(arguments[1],arguments[2]));return;}if(name==='index'){console.warn('THREE.BufferGeometry.addAttribute: Use .setIndex() for index attribute.');this.setIndex(attribute);return;}this.attributes[name]=attribute;return this;},getAttribute:function getAttribute(name){return this.attributes[name];},removeAttribute:function removeAttribute(name){delete this.attributes[name];return this;},addGroup:function addGroup(start,count,materialIndex){this.groups.push({start:start,count:count,materialIndex:materialIndex!==undefined?materialIndex:0});},clearGroups:function clearGroups(){this.groups=[];},setDrawRange:function setDrawRange(start,count){this.drawRange.start=start;this.drawRange.count=count;},applyMatrix:function applyMatrix(matrix){var position=this.attributes.position;if(position!==undefined){matrix.applyToBufferAttribute(position);position.needsUpdate=true;}var normal=this.attributes.normal;if(normal!==undefined){var normalMatrix=new Matrix3$1().getNormalMatrix(matrix);normalMatrix.applyToBufferAttribute(normal);normal.needsUpdate=true;}if(this.boundingBox!==null){this.computeBoundingBox();}if(this.boundingSphere!==null){this.computeBoundingSphere();}return this;},rotateX:function(){// rotate geometry around world x-axis
  var m1=new Matrix4();return function rotateX(angle){m1.makeRotationX(angle);this.applyMatrix(m1);return this;};}(),rotateY:function(){// rotate geometry around world y-axis
  var m1=new Matrix4();return function rotateY(angle){m1.makeRotationY(angle);this.applyMatrix(m1);return this;};}(),rotateZ:function(){// rotate geometry around world z-axis
  var m1=new Matrix4();return function rotateZ(angle){m1.makeRotationZ(angle);this.applyMatrix(m1);return this;};}(),translate:function(){// translate geometry
  var m1=new Matrix4();return function translate(x,y,z){m1.makeTranslation(x,y,z);this.applyMatrix(m1);return this;};}(),scale:function(){// scale geometry
  var m1=new Matrix4();return function scale(x,y,z){m1.makeScale(x,y,z);this.applyMatrix(m1);return this;};}(),lookAt:function(){var obj=new Object3D();return function lookAt(vector){obj.lookAt(vector);obj.updateMatrix();this.applyMatrix(obj.matrix);};}(),center:function center(){this.computeBoundingBox();var offset=this.boundingBox.getCenter().negate();this.translate(offset.x,offset.y,offset.z);return offset;},setFromObject:function setFromObject(object){// console.log( 'THREE.BufferGeometry.setFromObject(). Converting', object, this );
  var geometry=object.geometry;if(object.isPoints||object.isLine){var positions=new Float32BufferAttribute(geometry.vertices.length*3,3);var colors=new Float32BufferAttribute(geometry.colors.length*3,3);this.addAttribute('position',positions.copyVector3sArray(geometry.vertices));this.addAttribute('color',colors.copyColorsArray(geometry.colors));if(geometry.lineDistances&&geometry.lineDistances.length===geometry.vertices.length){var lineDistances=new Float32BufferAttribute(geometry.lineDistances.length,1);this.addAttribute('lineDistance',lineDistances.copyArray(geometry.lineDistances));}if(geometry.boundingSphere!==null){this.boundingSphere=geometry.boundingSphere.clone();}if(geometry.boundingBox!==null){this.boundingBox=geometry.boundingBox.clone();}}else if(object.isMesh){if(geometry&&geometry.isGeometry){this.fromGeometry(geometry);}}return this;},setFromPoints:function setFromPoints(points){var position=[];for(var i=0,l=points.length;i<l;i++){var point=points[i];position.push(point.x,point.y,point.z||0);}this.addAttribute('position',new Float32BufferAttribute(position,3));return this;},updateFromObject:function updateFromObject(object){var geometry=object.geometry;if(object.isMesh){var direct=geometry.__directGeometry;if(geometry.elementsNeedUpdate===true){direct=undefined;geometry.elementsNeedUpdate=false;}if(direct===undefined){return this.fromGeometry(geometry);}direct.verticesNeedUpdate=geometry.verticesNeedUpdate;direct.normalsNeedUpdate=geometry.normalsNeedUpdate;direct.colorsNeedUpdate=geometry.colorsNeedUpdate;direct.uvsNeedUpdate=geometry.uvsNeedUpdate;direct.groupsNeedUpdate=geometry.groupsNeedUpdate;geometry.verticesNeedUpdate=false;geometry.normalsNeedUpdate=false;geometry.colorsNeedUpdate=false;geometry.uvsNeedUpdate=false;geometry.groupsNeedUpdate=false;geometry=direct;}var attribute;if(geometry.verticesNeedUpdate===true){attribute=this.attributes.position;if(attribute!==undefined){attribute.copyVector3sArray(geometry.vertices);attribute.needsUpdate=true;}geometry.verticesNeedUpdate=false;}if(geometry.normalsNeedUpdate===true){attribute=this.attributes.normal;if(attribute!==undefined){attribute.copyVector3sArray(geometry.normals);attribute.needsUpdate=true;}geometry.normalsNeedUpdate=false;}if(geometry.colorsNeedUpdate===true){attribute=this.attributes.color;if(attribute!==undefined){attribute.copyColorsArray(geometry.colors);attribute.needsUpdate=true;}geometry.colorsNeedUpdate=false;}if(geometry.uvsNeedUpdate){attribute=this.attributes.uv;if(attribute!==undefined){attribute.copyVector2sArray(geometry.uvs);attribute.needsUpdate=true;}geometry.uvsNeedUpdate=false;}if(geometry.lineDistancesNeedUpdate){attribute=this.attributes.lineDistance;if(attribute!==undefined){attribute.copyArray(geometry.lineDistances);attribute.needsUpdate=true;}geometry.lineDistancesNeedUpdate=false;}if(geometry.groupsNeedUpdate){geometry.computeGroups(object.geometry);this.groups=geometry.groups;geometry.groupsNeedUpdate=false;}return this;},fromGeometry:function fromGeometry(geometry){geometry.__directGeometry=new DirectGeometry().fromGeometry(geometry);return this.fromDirectGeometry(geometry.__directGeometry);},fromDirectGeometry:function fromDirectGeometry(geometry){var this$1=this;var positions=new Float32Array(geometry.vertices.length*3);this.addAttribute('position',new BufferAttribute(positions,3).copyVector3sArray(geometry.vertices));if(geometry.normals.length>0){var normals=new Float32Array(geometry.normals.length*3);this.addAttribute('normal',new BufferAttribute(normals,3).copyVector3sArray(geometry.normals));}if(geometry.colors.length>0){var colors=new Float32Array(geometry.colors.length*3);this.addAttribute('color',new BufferAttribute(colors,3).copyColorsArray(geometry.colors));}if(geometry.uvs.length>0){var uvs=new Float32Array(geometry.uvs.length*2);this.addAttribute('uv',new BufferAttribute(uvs,2).copyVector2sArray(geometry.uvs));}if(geometry.uvs2.length>0){var uvs2=new Float32Array(geometry.uvs2.length*2);this.addAttribute('uv2',new BufferAttribute(uvs2,2).copyVector2sArray(geometry.uvs2));}if(geometry.indices.length>0){var TypeArray=arrayMax(geometry.indices)>65535?Uint32Array:Uint16Array;var indices=new TypeArray(geometry.indices.length*3);this.setIndex(new BufferAttribute(indices,1).copyIndicesArray(geometry.indices));}// groups
  this.groups=geometry.groups;// morphs
  for(var name in geometry.morphTargets){var array=[];var morphTargets=geometry.morphTargets[name];for(var i=0,l=morphTargets.length;i<l;i++){var morphTarget=morphTargets[i];var attribute=new Float32BufferAttribute(morphTarget.length*3,3);array.push(attribute.copyVector3sArray(morphTarget));}this$1.morphAttributes[name]=array;}// skinning
  if(geometry.skinIndices.length>0){var skinIndices=new Float32BufferAttribute(geometry.skinIndices.length*4,4);this.addAttribute('skinIndex',skinIndices.copyVector4sArray(geometry.skinIndices));}if(geometry.skinWeights.length>0){var skinWeights=new Float32BufferAttribute(geometry.skinWeights.length*4,4);this.addAttribute('skinWeight',skinWeights.copyVector4sArray(geometry.skinWeights));}//
  if(geometry.boundingSphere!==null){this.boundingSphere=geometry.boundingSphere.clone();}if(geometry.boundingBox!==null){this.boundingBox=geometry.boundingBox.clone();}return this;},computeBoundingBox:function computeBoundingBox(){if(this.boundingBox===null){this.boundingBox=new Box3();}var position=this.attributes.position;if(position!==undefined){this.boundingBox.setFromBufferAttribute(position);}else{this.boundingBox.makeEmpty();}if(isNaN(this.boundingBox.min.x)||isNaN(this.boundingBox.min.y)||isNaN(this.boundingBox.min.z)){console.error('THREE.BufferGeometry.computeBoundingBox: Computed min/max have NaN values. The "position" attribute is likely to have NaN values.',this);}},computeBoundingSphere:function(){var box=new Box3();var vector=new Vector3$1();return function computeBoundingSphere(){if(this.boundingSphere===null){this.boundingSphere=new Sphere();}var position=this.attributes.position;if(position){var center=this.boundingSphere.center;box.setFromBufferAttribute(position);box.getCenter(center);// hoping to find a boundingSphere with a radius smaller than the
  // boundingSphere of the boundingBox: sqrt(3) smaller in the best case
  var maxRadiusSq=0;for(var i=0,il=position.count;i<il;i++){vector.x=position.getX(i);vector.y=position.getY(i);vector.z=position.getZ(i);maxRadiusSq=Math.max(maxRadiusSq,center.distanceToSquared(vector));}this.boundingSphere.radius=Math.sqrt(maxRadiusSq);if(isNaN(this.boundingSphere.radius)){console.error('THREE.BufferGeometry.computeBoundingSphere(): Computed radius is NaN. The "position" attribute is likely to have NaN values.',this);}}};}(),computeFaceNormals:function computeFaceNormals(){// backwards compatibility
  },computeVertexNormals:function computeVertexNormals(){var index=this.index;var attributes=this.attributes;var groups=this.groups;if(attributes.position){var positions=attributes.position.array;if(attributes.normal===undefined){this.addAttribute('normal',new BufferAttribute(new Float32Array(positions.length),3));}else{// reset existing normals to zero
  var array=attributes.normal.array;for(var i=0,il=array.length;i<il;i++){array[i]=0;}}var normals=attributes.normal.array;var vA,vB,vC;var pA=new Vector3$1(),pB=new Vector3$1(),pC=new Vector3$1();var cb=new Vector3$1(),ab=new Vector3$1();// indexed elements
  if(index){var indices=index.array;if(groups.length===0){this.addGroup(0,indices.length);}for(var j=0,jl=groups.length;j<jl;++j){var group=groups[j];var start=group.start;var count=group.count;for(var i=start,il=start+count;i<il;i+=3){vA=indices[i+0]*3;vB=indices[i+1]*3;vC=indices[i+2]*3;pA.fromArray(positions,vA);pB.fromArray(positions,vB);pC.fromArray(positions,vC);cb.subVectors(pC,pB);ab.subVectors(pA,pB);cb.cross(ab);normals[vA]+=cb.x;normals[vA+1]+=cb.y;normals[vA+2]+=cb.z;normals[vB]+=cb.x;normals[vB+1]+=cb.y;normals[vB+2]+=cb.z;normals[vC]+=cb.x;normals[vC+1]+=cb.y;normals[vC+2]+=cb.z;}}}else{// non-indexed elements (unconnected triangle soup)
  for(var i=0,il=positions.length;i<il;i+=9){pA.fromArray(positions,i);pB.fromArray(positions,i+3);pC.fromArray(positions,i+6);cb.subVectors(pC,pB);ab.subVectors(pA,pB);cb.cross(ab);normals[i]=cb.x;normals[i+1]=cb.y;normals[i+2]=cb.z;normals[i+3]=cb.x;normals[i+4]=cb.y;normals[i+5]=cb.z;normals[i+6]=cb.x;normals[i+7]=cb.y;normals[i+8]=cb.z;}}this.normalizeNormals();attributes.normal.needsUpdate=true;}},merge:function merge(geometry,offset){if(!(geometry&&geometry.isBufferGeometry)){console.error('THREE.BufferGeometry.merge(): geometry not an instance of THREE.BufferGeometry.',geometry);return;}if(offset===undefined){offset=0;}var attributes=this.attributes;for(var key in attributes){if(geometry.attributes[key]===undefined){continue;}var attribute1=attributes[key];var attributeArray1=attribute1.array;var attribute2=geometry.attributes[key];var attributeArray2=attribute2.array;var attributeSize=attribute2.itemSize;for(var i=0,j=attributeSize*offset;i<attributeArray2.length;i++, j++){attributeArray1[j]=attributeArray2[i];}}return this;},normalizeNormals:function(){var vector=new Vector3$1();return function normalizeNormals(){var normals=this.attributes.normal;for(var i=0,il=normals.count;i<il;i++){vector.x=normals.getX(i);vector.y=normals.getY(i);vector.z=normals.getZ(i);vector.normalize();normals.setXYZ(i,vector.x,vector.y,vector.z);}};}(),toNonIndexed:function toNonIndexed(){if(this.index===null){console.warn('THREE.BufferGeometry.toNonIndexed(): Geometry is already non-indexed.');return this;}var geometry2=new BufferGeometry();var indices=this.index.array;var attributes=this.attributes;for(var name in attributes){var attribute=attributes[name];var array=attribute.array;var itemSize=attribute.itemSize;var array2=new array.constructor(indices.length*itemSize);var index=0,index2=0;for(var i=0,l=indices.length;i<l;i++){index=indices[i]*itemSize;for(var j=0;j<itemSize;j++){array2[index2++]=array[index++];}}geometry2.addAttribute(name,new BufferAttribute(array2,itemSize));}return geometry2;},toJSON:function toJSON(){var data={metadata:{version:4.5,type:'BufferGeometry',generator:'BufferGeometry.toJSON'}};// standard BufferGeometry serialization
  data.uuid=this.uuid;data.type=this.type;if(this.name!==''){data.name=this.name;}if(this.parameters!==undefined){var parameters=this.parameters;for(var key in parameters){if(parameters[key]!==undefined){data[key]=parameters[key];}}return data;}data.data={attributes:{}};var index=this.index;if(index!==null){var array=Array.prototype.slice.call(index.array);data.data.index={type:index.array.constructor.name,array:array};}var attributes=this.attributes;for(var key in attributes){var attribute=attributes[key];var array=Array.prototype.slice.call(attribute.array);data.data.attributes[key]={itemSize:attribute.itemSize,type:attribute.array.constructor.name,array:array,normalized:attribute.normalized};}var groups=this.groups;if(groups.length>0){data.data.groups=JSON.parse(JSON.stringify(groups));}var boundingSphere=this.boundingSphere;if(boundingSphere!==null){data.data.boundingSphere={center:boundingSphere.center.toArray(),radius:boundingSphere.radius};}return data;},clone:function clone(){/*
  		 // Handle primitives

  		 var parameters = this.parameters;

  		 if ( parameters !== undefined ) {

  		 var values = [];

  		 for ( var key in parameters ) {

  		 values.push( parameters[ key ] );

  		 }

  		 var geometry = Object.create( this.constructor.prototype );
  		 this.constructor.apply( geometry, values );
  		 return geometry;

  		 }

  		 return new this.constructor().copy( this );
  		 */return new BufferGeometry().copy(this);},copy:function copy(source){var this$1=this;var name,i,l;// reset
  this.index=null;this.attributes={};this.morphAttributes={};this.groups=[];this.boundingBox=null;this.boundingSphere=null;// name
  this.name=source.name;// index
  var index=source.index;if(index!==null){this.setIndex(index.clone());}// attributes
  var attributes=source.attributes;for(name in attributes){var attribute=attributes[name];this$1.addAttribute(name,attribute.clone());}// morph attributes
  var morphAttributes=source.morphAttributes;for(name in morphAttributes){var array=[];var morphAttribute=morphAttributes[name];// morphAttribute: array of Float32BufferAttributes
  for(i=0, l=morphAttribute.length;i<l;i++){array.push(morphAttribute[i].clone());}this$1.morphAttributes[name]=array;}// groups
  var groups=source.groups;for(i=0, l=groups.length;i<l;i++){var group=groups[i];this$1.addGroup(group.start,group.count,group.materialIndex);}// bounding box
  var boundingBox=source.boundingBox;if(boundingBox!==null){this.boundingBox=boundingBox.clone();}// bounding sphere
  var boundingSphere=source.boundingSphere;if(boundingSphere!==null){this.boundingSphere=boundingSphere.clone();}// draw range
  this.drawRange.start=source.drawRange.start;this.drawRange.count=source.drawRange.count;return this;},dispose:function dispose(){this.dispatchEvent({type:'dispose'});}});/**
   * @author mrdoob / http://mrdoob.com/
   * @author Mugen87 / https://github.com/Mugen87
   */function WireframeGeometry(geometry){BufferGeometry.call(this);this.type='WireframeGeometry';// buffer
  var vertices=[];// helper variables
  var i,j,l,o,ol;var edge=[0,0],edges={},e,edge1,edge2;var key,keys=['a','b','c'];var vertex;// different logic for Geometry and BufferGeometry
  if(geometry&&geometry.isGeometry){// create a data structure that contains all edges without duplicates
  var faces=geometry.faces;for(i=0, l=faces.length;i<l;i++){var face=faces[i];for(j=0;j<3;j++){edge1=face[keys[j]];edge2=face[keys[(j+1)%3]];edge[0]=Math.min(edge1,edge2);// sorting prevents duplicates
  edge[1]=Math.max(edge1,edge2);key=edge[0]+','+edge[1];if(edges[key]===undefined){edges[key]={index1:edge[0],index2:edge[1]};}}}// generate vertices
  for(key in edges){e=edges[key];vertex=geometry.vertices[e.index1];vertices.push(vertex.x,vertex.y,vertex.z);vertex=geometry.vertices[e.index2];vertices.push(vertex.x,vertex.y,vertex.z);}}else if(geometry&&geometry.isBufferGeometry){var position,indices,groups;var group,start,count;var index1,index2;vertex=new Vector3$1();if(geometry.index!==null){// indexed BufferGeometry
  position=geometry.attributes.position;indices=geometry.index;groups=geometry.groups;if(groups.length===0){groups=[{start:0,count:indices.count,materialIndex:0}];}// create a data structure that contains all eges without duplicates
  for(o=0, ol=groups.length;o<ol;++o){group=groups[o];start=group.start;count=group.count;for(i=start, l=start+count;i<l;i+=3){for(j=0;j<3;j++){edge1=indices.getX(i+j);edge2=indices.getX(i+(j+1)%3);edge[0]=Math.min(edge1,edge2);// sorting prevents duplicates
  edge[1]=Math.max(edge1,edge2);key=edge[0]+','+edge[1];if(edges[key]===undefined){edges[key]={index1:edge[0],index2:edge[1]};}}}}// generate vertices
  for(key in edges){e=edges[key];vertex.fromBufferAttribute(position,e.index1);vertices.push(vertex.x,vertex.y,vertex.z);vertex.fromBufferAttribute(position,e.index2);vertices.push(vertex.x,vertex.y,vertex.z);}}else{// non-indexed BufferGeometry
  position=geometry.attributes.position;for(i=0, l=position.count/3;i<l;i++){for(j=0;j<3;j++){// three edges per triangle, an edge is represented as (index1, index2)
  // e.g. the first triangle has the following edges: (0,1),(1,2),(2,0)
  index1=3*i+j;vertex.fromBufferAttribute(position,index1);vertices.push(vertex.x,vertex.y,vertex.z);index2=3*i+(j+1)%3;vertex.fromBufferAttribute(position,index2);vertices.push(vertex.x,vertex.y,vertex.z);}}}}// build geometry
  this.addAttribute('position',new Float32BufferAttribute(vertices,3));}WireframeGeometry.prototype=Object.create(BufferGeometry.prototype);WireframeGeometry.prototype.constructor=WireframeGeometry;/**
   * @author mrdoob / http://mrdoob.com/
   * @author alteredq / http://alteredqualia.com/
   */function Face3$1(a,b,c,normal,color,materialIndex){this.a=a;this.b=b;this.c=c;this.normal=normal&&normal.isVector3?normal:new Vector3$1();this.vertexNormals=Array.isArray(normal)?normal:[];this.color=color&&color.isColor?color:new Color$1();this.vertexColors=Array.isArray(color)?color:[];this.materialIndex=materialIndex!==undefined?materialIndex:0;}Object.assign(Face3$1.prototype,{clone:function clone(){return new this.constructor().copy(this);},copy:function copy(source){var this$1=this;this.a=source.a;this.b=source.b;this.c=source.c;this.normal.copy(source.normal);this.color.copy(source.color);this.materialIndex=source.materialIndex;for(var i=0,il=source.vertexNormals.length;i<il;i++){this$1.vertexNormals[i]=source.vertexNormals[i].clone();}for(var i=0,il=source.vertexColors.length;i<il;i++){this$1.vertexColors[i]=source.vertexColors[i].clone();}return this;}});/**
   * @author mrdoob / http://mrdoob.com/
   * @author kile / http://kile.stravaganza.org/
   * @author alteredq / http://alteredqualia.com/
   * @author mikael emtinger / http://gomo.se/
   * @author zz85 / http://www.lab4games.net/zz85/blog
   * @author bhouston / http://clara.io
   */var geometryId=0;// Geometry uses even numbers as Id
  function Geometry(){Object.defineProperty(this,'id',{value:geometryId+=2});this.uuid=_Math$1.generateUUID();this.name='';this.type='Geometry';this.vertices=[];this.colors=[];this.faces=[];this.faceVertexUvs=[[]];this.morphTargets=[];this.morphNormals=[];this.skinWeights=[];this.skinIndices=[];this.lineDistances=[];this.boundingBox=null;this.boundingSphere=null;// update flags
  this.elementsNeedUpdate=false;this.verticesNeedUpdate=false;this.uvsNeedUpdate=false;this.normalsNeedUpdate=false;this.colorsNeedUpdate=false;this.lineDistancesNeedUpdate=false;this.groupsNeedUpdate=false;}Geometry.prototype=Object.assign(Object.create(EventDispatcher.prototype),{constructor:Geometry,isGeometry:true,applyMatrix:function applyMatrix(matrix){var this$1=this;var normalMatrix=new Matrix3$1().getNormalMatrix(matrix);for(var i=0,il=this.vertices.length;i<il;i++){var vertex=this$1.vertices[i];vertex.applyMatrix4(matrix);}for(var i=0,il=this.faces.length;i<il;i++){var face=this$1.faces[i];face.normal.applyMatrix3(normalMatrix).normalize();for(var j=0,jl=face.vertexNormals.length;j<jl;j++){face.vertexNormals[j].applyMatrix3(normalMatrix).normalize();}}if(this.boundingBox!==null){this.computeBoundingBox();}if(this.boundingSphere!==null){this.computeBoundingSphere();}this.verticesNeedUpdate=true;this.normalsNeedUpdate=true;return this;},rotateX:function(){// rotate geometry around world x-axis
  var m1=new Matrix4();return function rotateX(angle){m1.makeRotationX(angle);this.applyMatrix(m1);return this;};}(),rotateY:function(){// rotate geometry around world y-axis
  var m1=new Matrix4();return function rotateY(angle){m1.makeRotationY(angle);this.applyMatrix(m1);return this;};}(),rotateZ:function(){// rotate geometry around world z-axis
  var m1=new Matrix4();return function rotateZ(angle){m1.makeRotationZ(angle);this.applyMatrix(m1);return this;};}(),translate:function(){// translate geometry
  var m1=new Matrix4();return function translate(x,y,z){m1.makeTranslation(x,y,z);this.applyMatrix(m1);return this;};}(),scale:function(){// scale geometry
  var m1=new Matrix4();return function scale(x,y,z){m1.makeScale(x,y,z);this.applyMatrix(m1);return this;};}(),lookAt:function(){var obj=new Object3D();return function lookAt(vector){obj.lookAt(vector);obj.updateMatrix();this.applyMatrix(obj.matrix);};}(),fromBufferGeometry:function fromBufferGeometry(geometry){var scope=this;var indices=geometry.index!==null?geometry.index.array:undefined;var attributes=geometry.attributes;var positions=attributes.position.array;var normals=attributes.normal!==undefined?attributes.normal.array:undefined;var colors=attributes.color!==undefined?attributes.color.array:undefined;var uvs=attributes.uv!==undefined?attributes.uv.array:undefined;var uvs2=attributes.uv2!==undefined?attributes.uv2.array:undefined;if(uvs2!==undefined){this.faceVertexUvs[1]=[];}var tempNormals=[];var tempUVs=[];var tempUVs2=[];for(var i=0,j=0;i<positions.length;i+=3, j+=2){scope.vertices.push(new Vector3$1(positions[i],positions[i+1],positions[i+2]));if(normals!==undefined){tempNormals.push(new Vector3$1(normals[i],normals[i+1],normals[i+2]));}if(colors!==undefined){scope.colors.push(new Color$1(colors[i],colors[i+1],colors[i+2]));}if(uvs!==undefined){tempUVs.push(new Vector2$1(uvs[j],uvs[j+1]));}if(uvs2!==undefined){tempUVs2.push(new Vector2$1(uvs2[j],uvs2[j+1]));}}function addFace(a,b,c,materialIndex){var vertexNormals=normals!==undefined?[tempNormals[a].clone(),tempNormals[b].clone(),tempNormals[c].clone()]:[];var vertexColors=colors!==undefined?[scope.colors[a].clone(),scope.colors[b].clone(),scope.colors[c].clone()]:[];var face=new Face3$1(a,b,c,vertexNormals,vertexColors,materialIndex);scope.faces.push(face);if(uvs!==undefined){scope.faceVertexUvs[0].push([tempUVs[a].clone(),tempUVs[b].clone(),tempUVs[c].clone()]);}if(uvs2!==undefined){scope.faceVertexUvs[1].push([tempUVs2[a].clone(),tempUVs2[b].clone(),tempUVs2[c].clone()]);}}var groups=geometry.groups;if(groups.length>0){for(var i=0;i<groups.length;i++){var group=groups[i];var start=group.start;var count=group.count;for(var j=start,jl=start+count;j<jl;j+=3){if(indices!==undefined){addFace(indices[j],indices[j+1],indices[j+2],group.materialIndex);}else{addFace(j,j+1,j+2,group.materialIndex);}}}}else{if(indices!==undefined){for(var i=0;i<indices.length;i+=3){addFace(indices[i],indices[i+1],indices[i+2]);}}else{for(var i=0;i<positions.length/3;i+=3){addFace(i,i+1,i+2);}}}this.computeFaceNormals();if(geometry.boundingBox!==null){this.boundingBox=geometry.boundingBox.clone();}if(geometry.boundingSphere!==null){this.boundingSphere=geometry.boundingSphere.clone();}return this;},center:function center(){this.computeBoundingBox();var offset=this.boundingBox.getCenter().negate();this.translate(offset.x,offset.y,offset.z);return offset;},normalize:function normalize(){this.computeBoundingSphere();var center=this.boundingSphere.center;var radius=this.boundingSphere.radius;var s=radius===0?1:1.0/radius;var matrix=new Matrix4();matrix.set(s,0,0,-s*center.x,0,s,0,-s*center.y,0,0,s,-s*center.z,0,0,0,1);this.applyMatrix(matrix);return this;},computeFaceNormals:function computeFaceNormals(){var this$1=this;var cb=new Vector3$1(),ab=new Vector3$1();for(var f=0,fl=this.faces.length;f<fl;f++){var face=this$1.faces[f];var vA=this$1.vertices[face.a];var vB=this$1.vertices[face.b];var vC=this$1.vertices[face.c];cb.subVectors(vC,vB);ab.subVectors(vA,vB);cb.cross(ab);cb.normalize();face.normal.copy(cb);}},computeVertexNormals:function computeVertexNormals(areaWeighted){var this$1=this;if(areaWeighted===undefined){areaWeighted=true;}var v,vl,f,fl,face,vertices;vertices=new Array(this.vertices.length);for(v=0, vl=this.vertices.length;v<vl;v++){vertices[v]=new Vector3$1();}if(areaWeighted){// vertex normals weighted by triangle areas
  // http://www.iquilezles.org/www/articles/normals/normals.htm
  var vA,vB,vC;var cb=new Vector3$1(),ab=new Vector3$1();for(f=0, fl=this.faces.length;f<fl;f++){face=this$1.faces[f];vA=this$1.vertices[face.a];vB=this$1.vertices[face.b];vC=this$1.vertices[face.c];cb.subVectors(vC,vB);ab.subVectors(vA,vB);cb.cross(ab);vertices[face.a].add(cb);vertices[face.b].add(cb);vertices[face.c].add(cb);}}else{this.computeFaceNormals();for(f=0, fl=this.faces.length;f<fl;f++){face=this$1.faces[f];vertices[face.a].add(face.normal);vertices[face.b].add(face.normal);vertices[face.c].add(face.normal);}}for(v=0, vl=this.vertices.length;v<vl;v++){vertices[v].normalize();}for(f=0, fl=this.faces.length;f<fl;f++){face=this$1.faces[f];var vertexNormals=face.vertexNormals;if(vertexNormals.length===3){vertexNormals[0].copy(vertices[face.a]);vertexNormals[1].copy(vertices[face.b]);vertexNormals[2].copy(vertices[face.c]);}else{vertexNormals[0]=vertices[face.a].clone();vertexNormals[1]=vertices[face.b].clone();vertexNormals[2]=vertices[face.c].clone();}}if(this.faces.length>0){this.normalsNeedUpdate=true;}},computeFlatVertexNormals:function computeFlatVertexNormals(){var this$1=this;var f,fl,face;this.computeFaceNormals();for(f=0, fl=this.faces.length;f<fl;f++){face=this$1.faces[f];var vertexNormals=face.vertexNormals;if(vertexNormals.length===3){vertexNormals[0].copy(face.normal);vertexNormals[1].copy(face.normal);vertexNormals[2].copy(face.normal);}else{vertexNormals[0]=face.normal.clone();vertexNormals[1]=face.normal.clone();vertexNormals[2]=face.normal.clone();}}if(this.faces.length>0){this.normalsNeedUpdate=true;}},computeMorphNormals:function computeMorphNormals(){var this$1=this;var i,il,f,fl,face;// save original normals
  // - create temp variables on first access
  //   otherwise just copy (for faster repeated calls)
  for(f=0, fl=this.faces.length;f<fl;f++){face=this$1.faces[f];if(!face.__originalFaceNormal){face.__originalFaceNormal=face.normal.clone();}else{face.__originalFaceNormal.copy(face.normal);}if(!face.__originalVertexNormals){face.__originalVertexNormals=[];}for(i=0, il=face.vertexNormals.length;i<il;i++){if(!face.__originalVertexNormals[i]){face.__originalVertexNormals[i]=face.vertexNormals[i].clone();}else{face.__originalVertexNormals[i].copy(face.vertexNormals[i]);}}}// use temp geometry to compute face and vertex normals for each morph
  var tmpGeo=new Geometry();tmpGeo.faces=this.faces;for(i=0, il=this.morphTargets.length;i<il;i++){// create on first access
  if(!this$1.morphNormals[i]){this$1.morphNormals[i]={};this$1.morphNormals[i].faceNormals=[];this$1.morphNormals[i].vertexNormals=[];var dstNormalsFace=this$1.morphNormals[i].faceNormals;var dstNormalsVertex=this$1.morphNormals[i].vertexNormals;var faceNormal,vertexNormals;for(f=0, fl=this.faces.length;f<fl;f++){faceNormal=new Vector3$1();vertexNormals={a:new Vector3$1(),b:new Vector3$1(),c:new Vector3$1()};dstNormalsFace.push(faceNormal);dstNormalsVertex.push(vertexNormals);}}var morphNormals=this$1.morphNormals[i];// set vertices to morph target
  tmpGeo.vertices=this$1.morphTargets[i].vertices;// compute morph normals
  tmpGeo.computeFaceNormals();tmpGeo.computeVertexNormals();// store morph normals
  var faceNormal,vertexNormals;for(f=0, fl=this.faces.length;f<fl;f++){face=this$1.faces[f];faceNormal=morphNormals.faceNormals[f];vertexNormals=morphNormals.vertexNormals[f];faceNormal.copy(face.normal);vertexNormals.a.copy(face.vertexNormals[0]);vertexNormals.b.copy(face.vertexNormals[1]);vertexNormals.c.copy(face.vertexNormals[2]);}}// restore original normals
  for(f=0, fl=this.faces.length;f<fl;f++){face=this$1.faces[f];face.normal=face.__originalFaceNormal;face.vertexNormals=face.__originalVertexNormals;}},computeLineDistances:function computeLineDistances(){var this$1=this;var d=0;var vertices=this.vertices;for(var i=0,il=vertices.length;i<il;i++){if(i>0){d+=vertices[i].distanceTo(vertices[i-1]);}this$1.lineDistances[i]=d;}},computeBoundingBox:function computeBoundingBox(){if(this.boundingBox===null){this.boundingBox=new Box3();}this.boundingBox.setFromPoints(this.vertices);},computeBoundingSphere:function computeBoundingSphere(){if(this.boundingSphere===null){this.boundingSphere=new Sphere();}this.boundingSphere.setFromPoints(this.vertices);},merge:function merge(geometry,matrix,materialIndexOffset){if(!(geometry&&geometry.isGeometry)){console.error('THREE.Geometry.merge(): geometry not an instance of THREE.Geometry.',geometry);return;}var normalMatrix,vertexOffset=this.vertices.length,vertices1=this.vertices,vertices2=geometry.vertices,faces1=this.faces,faces2=geometry.faces,uvs1=this.faceVertexUvs[0],uvs2=geometry.faceVertexUvs[0],colors1=this.colors,colors2=geometry.colors;if(materialIndexOffset===undefined){materialIndexOffset=0;}if(matrix!==undefined){normalMatrix=new Matrix3$1().getNormalMatrix(matrix);}// vertices
  for(var i=0,il=vertices2.length;i<il;i++){var vertex=vertices2[i];var vertexCopy=vertex.clone();if(matrix!==undefined){vertexCopy.applyMatrix4(matrix);}vertices1.push(vertexCopy);}// colors
  for(var i=0,il=colors2.length;i<il;i++){colors1.push(colors2[i].clone());}// faces
  for(i=0, il=faces2.length;i<il;i++){var face=faces2[i],faceCopy,normal,color,faceVertexNormals=face.vertexNormals,faceVertexColors=face.vertexColors;faceCopy=new Face3$1(face.a+vertexOffset,face.b+vertexOffset,face.c+vertexOffset);faceCopy.normal.copy(face.normal);if(normalMatrix!==undefined){faceCopy.normal.applyMatrix3(normalMatrix).normalize();}for(var j=0,jl=faceVertexNormals.length;j<jl;j++){normal=faceVertexNormals[j].clone();if(normalMatrix!==undefined){normal.applyMatrix3(normalMatrix).normalize();}faceCopy.vertexNormals.push(normal);}faceCopy.color.copy(face.color);for(var j=0,jl=faceVertexColors.length;j<jl;j++){color=faceVertexColors[j];faceCopy.vertexColors.push(color.clone());}faceCopy.materialIndex=face.materialIndex+materialIndexOffset;faces1.push(faceCopy);}// uvs
  for(i=0, il=uvs2.length;i<il;i++){var uv=uvs2[i],uvCopy=[];if(uv===undefined){continue;}for(var j=0,jl=uv.length;j<jl;j++){uvCopy.push(uv[j].clone());}uvs1.push(uvCopy);}},mergeMesh:function mergeMesh(mesh){if(!(mesh&&mesh.isMesh)){console.error('THREE.Geometry.mergeMesh(): mesh not an instance of THREE.Mesh.',mesh);return;}mesh.matrixAutoUpdate&&mesh.updateMatrix();this.merge(mesh.geometry,mesh.matrix);},/*
  	 * Checks for duplicate vertices with hashmap.
  	 * Duplicated vertices are removed
  	 * and faces' vertices are updated.
  	 */mergeVertices:function mergeVertices(){var this$1=this;var verticesMap={};// Hashmap for looking up vertices by position coordinates (and making sure they are unique)
  var unique=[],changes=[];var v,key;var precisionPoints=4;// number of decimal points, e.g. 4 for epsilon of 0.0001
  var precision=Math.pow(10,precisionPoints);var i,il,face;var indices,j,jl;for(i=0, il=this.vertices.length;i<il;i++){v=this$1.vertices[i];key=Math.round(v.x*precision)+'_'+Math.round(v.y*precision)+'_'+Math.round(v.z*precision);if(verticesMap[key]===undefined){verticesMap[key]=i;unique.push(this$1.vertices[i]);changes[i]=unique.length-1;}else{//console.log('Duplicate vertex found. ', i, ' could be using ', verticesMap[key]);
  changes[i]=changes[verticesMap[key]];}}// if faces are completely degenerate after merging vertices, we
  // have to remove them from the geometry.
  var faceIndicesToRemove=[];for(i=0, il=this.faces.length;i<il;i++){face=this$1.faces[i];face.a=changes[face.a];face.b=changes[face.b];face.c=changes[face.c];indices=[face.a,face.b,face.c];// if any duplicate vertices are found in a Face3
  // we have to remove the face as nothing can be saved
  for(var n=0;n<3;n++){if(indices[n]===indices[(n+1)%3]){faceIndicesToRemove.push(i);break;}}}for(i=faceIndicesToRemove.length-1;i>=0;i--){var idx=faceIndicesToRemove[i];this$1.faces.splice(idx,1);for(j=0, jl=this.faceVertexUvs.length;j<jl;j++){this$1.faceVertexUvs[j].splice(idx,1);}}// Use unique set of vertices
  var diff=this.vertices.length-unique.length;this.vertices=unique;return diff;},setFromPoints:function setFromPoints(points){var this$1=this;this.vertices=[];for(var i=0,l=points.length;i<l;i++){var point=points[i];this$1.vertices.push(new Vector3$1(point.x,point.y,point.z||0));}return this;},sortFacesByMaterialIndex:function sortFacesByMaterialIndex(){var faces=this.faces;var length=faces.length;// tag faces
  for(var i=0;i<length;i++){faces[i]._id=i;}// sort faces
  function materialIndexSort(a,b){return a.materialIndex-b.materialIndex;}faces.sort(materialIndexSort);// sort uvs
  var uvs1=this.faceVertexUvs[0];var uvs2=this.faceVertexUvs[1];var newUvs1,newUvs2;if(uvs1&&uvs1.length===length){newUvs1=[];}if(uvs2&&uvs2.length===length){newUvs2=[];}for(var i=0;i<length;i++){var id=faces[i]._id;if(newUvs1){newUvs1.push(uvs1[id]);}if(newUvs2){newUvs2.push(uvs2[id]);}}if(newUvs1){this.faceVertexUvs[0]=newUvs1;}if(newUvs2){this.faceVertexUvs[1]=newUvs2;}},toJSON:function toJSON(){var this$1=this;var data={metadata:{version:4.5,type:'Geometry',generator:'Geometry.toJSON'}};// standard Geometry serialization
  data.uuid=this.uuid;data.type=this.type;if(this.name!==''){data.name=this.name;}if(this.parameters!==undefined){var parameters=this.parameters;for(var key in parameters){if(parameters[key]!==undefined){data[key]=parameters[key];}}return data;}var vertices=[];for(var i=0;i<this.vertices.length;i++){var vertex=this$1.vertices[i];vertices.push(vertex.x,vertex.y,vertex.z);}var faces=[];var normals=[];var normalsHash={};var colors=[];var colorsHash={};var uvs=[];var uvsHash={};for(var i=0;i<this.faces.length;i++){var face=this$1.faces[i];var hasMaterial=true;var hasFaceUv=false;// deprecated
  var hasFaceVertexUv=this$1.faceVertexUvs[0][i]!==undefined;var hasFaceNormal=face.normal.length()>0;var hasFaceVertexNormal=face.vertexNormals.length>0;var hasFaceColor=face.color.r!==1||face.color.g!==1||face.color.b!==1;var hasFaceVertexColor=face.vertexColors.length>0;var faceType=0;faceType=setBit(faceType,0,0);// isQuad
  faceType=setBit(faceType,1,hasMaterial);faceType=setBit(faceType,2,hasFaceUv);faceType=setBit(faceType,3,hasFaceVertexUv);faceType=setBit(faceType,4,hasFaceNormal);faceType=setBit(faceType,5,hasFaceVertexNormal);faceType=setBit(faceType,6,hasFaceColor);faceType=setBit(faceType,7,hasFaceVertexColor);faces.push(faceType);faces.push(face.a,face.b,face.c);faces.push(face.materialIndex);if(hasFaceVertexUv){var faceVertexUvs=this$1.faceVertexUvs[0][i];faces.push(getUvIndex(faceVertexUvs[0]),getUvIndex(faceVertexUvs[1]),getUvIndex(faceVertexUvs[2]));}if(hasFaceNormal){faces.push(getNormalIndex(face.normal));}if(hasFaceVertexNormal){var vertexNormals=face.vertexNormals;faces.push(getNormalIndex(vertexNormals[0]),getNormalIndex(vertexNormals[1]),getNormalIndex(vertexNormals[2]));}if(hasFaceColor){faces.push(getColorIndex(face.color));}if(hasFaceVertexColor){var vertexColors=face.vertexColors;faces.push(getColorIndex(vertexColors[0]),getColorIndex(vertexColors[1]),getColorIndex(vertexColors[2]));}}function setBit(value,position,enabled){return enabled?value|1<<position:value&~(1<<position);}function getNormalIndex(normal){var hash=normal.x.toString()+normal.y.toString()+normal.z.toString();if(normalsHash[hash]!==undefined){return normalsHash[hash];}normalsHash[hash]=normals.length/3;normals.push(normal.x,normal.y,normal.z);return normalsHash[hash];}function getColorIndex(color){var hash=color.r.toString()+color.g.toString()+color.b.toString();if(colorsHash[hash]!==undefined){return colorsHash[hash];}colorsHash[hash]=colors.length;colors.push(color.getHex());return colorsHash[hash];}function getUvIndex(uv){var hash=uv.x.toString()+uv.y.toString();if(uvsHash[hash]!==undefined){return uvsHash[hash];}uvsHash[hash]=uvs.length/2;uvs.push(uv.x,uv.y);return uvsHash[hash];}data.data={};data.data.vertices=vertices;data.data.normals=normals;if(colors.length>0){data.data.colors=colors;}if(uvs.length>0){data.data.uvs=[uvs];}// temporal backward compatibility
  data.data.faces=faces;return data;},clone:function clone(){/*
  		 // Handle primitives

  		 var parameters = this.parameters;

  		 if ( parameters !== undefined ) {

  		 var values = [];

  		 for ( var key in parameters ) {

  		 values.push( parameters[ key ] );

  		 }

  		 var geometry = Object.create( this.constructor.prototype );
  		 this.constructor.apply( geometry, values );
  		 return geometry;

  		 }

  		 return new this.constructor().copy( this );
  		 */return new Geometry().copy(this);},copy:function copy(source){var this$1=this;var i,il,j,jl,k,kl;// reset
  this.vertices=[];this.colors=[];this.faces=[];this.faceVertexUvs=[[]];this.morphTargets=[];this.morphNormals=[];this.skinWeights=[];this.skinIndices=[];this.lineDistances=[];this.boundingBox=null;this.boundingSphere=null;// name
  this.name=source.name;// vertices
  var vertices=source.vertices;for(i=0, il=vertices.length;i<il;i++){this$1.vertices.push(vertices[i].clone());}// colors
  var colors=source.colors;for(i=0, il=colors.length;i<il;i++){this$1.colors.push(colors[i].clone());}// faces
  var faces=source.faces;for(i=0, il=faces.length;i<il;i++){this$1.faces.push(faces[i].clone());}// face vertex uvs
  for(i=0, il=source.faceVertexUvs.length;i<il;i++){var faceVertexUvs=source.faceVertexUvs[i];if(this$1.faceVertexUvs[i]===undefined){this$1.faceVertexUvs[i]=[];}for(j=0, jl=faceVertexUvs.length;j<jl;j++){var uvs=faceVertexUvs[j],uvsCopy=[];for(k=0, kl=uvs.length;k<kl;k++){var uv=uvs[k];uvsCopy.push(uv.clone());}this$1.faceVertexUvs[i].push(uvsCopy);}}// morph targets
  var morphTargets=source.morphTargets;for(i=0, il=morphTargets.length;i<il;i++){var morphTarget={};morphTarget.name=morphTargets[i].name;// vertices
  if(morphTargets[i].vertices!==undefined){morphTarget.vertices=[];for(j=0, jl=morphTargets[i].vertices.length;j<jl;j++){morphTarget.vertices.push(morphTargets[i].vertices[j].clone());}}// normals
  if(morphTargets[i].normals!==undefined){morphTarget.normals=[];for(j=0, jl=morphTargets[i].normals.length;j<jl;j++){morphTarget.normals.push(morphTargets[i].normals[j].clone());}}this$1.morphTargets.push(morphTarget);}// morph normals
  var morphNormals=source.morphNormals;for(i=0, il=morphNormals.length;i<il;i++){var morphNormal={};// vertex normals
  if(morphNormals[i].vertexNormals!==undefined){morphNormal.vertexNormals=[];for(j=0, jl=morphNormals[i].vertexNormals.length;j<jl;j++){var srcVertexNormal=morphNormals[i].vertexNormals[j];var destVertexNormal={};destVertexNormal.a=srcVertexNormal.a.clone();destVertexNormal.b=srcVertexNormal.b.clone();destVertexNormal.c=srcVertexNormal.c.clone();morphNormal.vertexNormals.push(destVertexNormal);}}// face normals
  if(morphNormals[i].faceNormals!==undefined){morphNormal.faceNormals=[];for(j=0, jl=morphNormals[i].faceNormals.length;j<jl;j++){morphNormal.faceNormals.push(morphNormals[i].faceNormals[j].clone());}}this$1.morphNormals.push(morphNormal);}// skin weights
  var skinWeights=source.skinWeights;for(i=0, il=skinWeights.length;i<il;i++){this$1.skinWeights.push(skinWeights[i].clone());}// skin indices
  var skinIndices=source.skinIndices;for(i=0, il=skinIndices.length;i<il;i++){this$1.skinIndices.push(skinIndices[i].clone());}// line distances
  var lineDistances=source.lineDistances;for(i=0, il=lineDistances.length;i<il;i++){this$1.lineDistances.push(lineDistances[i]);}// bounding box
  var boundingBox=source.boundingBox;if(boundingBox!==null){this.boundingBox=boundingBox.clone();}// bounding sphere
  var boundingSphere=source.boundingSphere;if(boundingSphere!==null){this.boundingSphere=boundingSphere.clone();}// update flags
  this.elementsNeedUpdate=source.elementsNeedUpdate;this.verticesNeedUpdate=source.verticesNeedUpdate;this.uvsNeedUpdate=source.uvsNeedUpdate;this.normalsNeedUpdate=source.normalsNeedUpdate;this.colorsNeedUpdate=source.colorsNeedUpdate;this.lineDistancesNeedUpdate=source.lineDistancesNeedUpdate;this.groupsNeedUpdate=source.groupsNeedUpdate;return this;},dispose:function dispose(){this.dispatchEvent({type:'dispose'});}});/**
   * @author zz85 / https://github.com/zz85
   * @author Mugen87 / https://github.com/Mugen87
   *
   * Parametric Surfaces Geometry
   * based on the brilliant article by @prideout http://prideout.net/blog/?p=44
   */// ParametricGeometry
  function ParametricGeometry(func,slices,stacks){Geometry.call(this);this.type='ParametricGeometry';this.parameters={func:func,slices:slices,stacks:stacks};this.fromBufferGeometry(new ParametricBufferGeometry(func,slices,stacks));this.mergeVertices();}ParametricGeometry.prototype=Object.create(Geometry.prototype);ParametricGeometry.prototype.constructor=ParametricGeometry;// ParametricBufferGeometry
  function ParametricBufferGeometry(func,slices,stacks){BufferGeometry.call(this);this.type='ParametricBufferGeometry';this.parameters={func:func,slices:slices,stacks:stacks};// buffers
  var indices=[];var vertices=[];var normals=[];var uvs=[];var EPS=0.00001;var normal=new Vector3$1();var p0=new Vector3$1(),p1=new Vector3$1();var pu=new Vector3$1(),pv=new Vector3$1();var i,j;// generate vertices, normals and uvs
  var sliceCount=slices+1;for(i=0;i<=stacks;i++){var v=i/stacks;for(j=0;j<=slices;j++){var u=j/slices;// vertex
  p0=func(u,v,p0);vertices.push(p0.x,p0.y,p0.z);// normal
  // approximate tangent vectors via finite differences
  if(u-EPS>=0){p1=func(u-EPS,v,p1);pu.subVectors(p0,p1);}else{p1=func(u+EPS,v,p1);pu.subVectors(p1,p0);}if(v-EPS>=0){p1=func(u,v-EPS,p1);pv.subVectors(p0,p1);}else{p1=func(u,v+EPS,p1);pv.subVectors(p1,p0);}// cross product of tangent vectors returns surface normal
  normal.crossVectors(pu,pv).normalize();normals.push(normal.x,normal.y,normal.z);// uv
  uvs.push(u,v);}}// generate indices
  for(i=0;i<stacks;i++){for(j=0;j<slices;j++){var a=i*sliceCount+j;var b=i*sliceCount+j+1;var c=(i+1)*sliceCount+j+1;var d=(i+1)*sliceCount+j;// faces one and two
  indices.push(a,b,d);indices.push(b,c,d);}}// build geometry
  this.setIndex(indices);this.addAttribute('position',new Float32BufferAttribute(vertices,3));this.addAttribute('normal',new Float32BufferAttribute(normals,3));this.addAttribute('uv',new Float32BufferAttribute(uvs,2));}ParametricBufferGeometry.prototype=Object.create(BufferGeometry.prototype);ParametricBufferGeometry.prototype.constructor=ParametricBufferGeometry;/**
   * @author clockworkgeek / https://github.com/clockworkgeek
   * @author timothypratley / https://github.com/timothypratley
   * @author WestLangley / http://github.com/WestLangley
   * @author Mugen87 / https://github.com/Mugen87
   */// PolyhedronGeometry
  function PolyhedronGeometry(vertices,indices,radius,detail){Geometry.call(this);this.type='PolyhedronGeometry';this.parameters={vertices:vertices,indices:indices,radius:radius,detail:detail};this.fromBufferGeometry(new PolyhedronBufferGeometry(vertices,indices,radius,detail));this.mergeVertices();}PolyhedronGeometry.prototype=Object.create(Geometry.prototype);PolyhedronGeometry.prototype.constructor=PolyhedronGeometry;// PolyhedronBufferGeometry
  function PolyhedronBufferGeometry(vertices,indices,radius,detail){BufferGeometry.call(this);this.type='PolyhedronBufferGeometry';this.parameters={vertices:vertices,indices:indices,radius:radius,detail:detail};radius=radius||1;detail=detail||0;// default buffer data
  var vertexBuffer=[];var uvBuffer=[];// the subdivision creates the vertex buffer data
  subdivide(detail);// all vertices should lie on a conceptual sphere with a given radius
  appplyRadius(radius);// finally, create the uv data
  generateUVs();// build non-indexed geometry
  this.addAttribute('position',new Float32BufferAttribute(vertexBuffer,3));this.addAttribute('normal',new Float32BufferAttribute(vertexBuffer.slice(),3));this.addAttribute('uv',new Float32BufferAttribute(uvBuffer,2));if(detail===0){this.computeVertexNormals();// flat normals
  }else{this.normalizeNormals();// smooth normals
  }// helper functions
  function subdivide(detail){var a=new Vector3$1();var b=new Vector3$1();var c=new Vector3$1();// iterate over all faces and apply a subdivison with the given detail value
  for(var i=0;i<indices.length;i+=3){// get the vertices of the face
  getVertexByIndex(indices[i+0],a);getVertexByIndex(indices[i+1],b);getVertexByIndex(indices[i+2],c);// perform subdivision
  subdivideFace(a,b,c,detail);}}function subdivideFace(a,b,c,detail){var cols=Math.pow(2,detail);// we use this multidimensional array as a data structure for creating the subdivision
  var v=[];var i,j;// construct all of the vertices for this subdivision
  for(i=0;i<=cols;i++){v[i]=[];var aj=a.clone().lerp(c,i/cols);var bj=b.clone().lerp(c,i/cols);var rows=cols-i;for(j=0;j<=rows;j++){if(j===0&&i===cols){v[i][j]=aj;}else{v[i][j]=aj.clone().lerp(bj,j/rows);}}}// construct all of the faces
  for(i=0;i<cols;i++){for(j=0;j<2*(cols-i)-1;j++){var k=Math.floor(j/2);if(j%2===0){pushVertex(v[i][k+1]);pushVertex(v[i+1][k]);pushVertex(v[i][k]);}else{pushVertex(v[i][k+1]);pushVertex(v[i+1][k+1]);pushVertex(v[i+1][k]);}}}}function appplyRadius(radius){var vertex=new Vector3$1();// iterate over the entire buffer and apply the radius to each vertex
  for(var i=0;i<vertexBuffer.length;i+=3){vertex.x=vertexBuffer[i+0];vertex.y=vertexBuffer[i+1];vertex.z=vertexBuffer[i+2];vertex.normalize().multiplyScalar(radius);vertexBuffer[i+0]=vertex.x;vertexBuffer[i+1]=vertex.y;vertexBuffer[i+2]=vertex.z;}}function generateUVs(){var vertex=new Vector3$1();for(var i=0;i<vertexBuffer.length;i+=3){vertex.x=vertexBuffer[i+0];vertex.y=vertexBuffer[i+1];vertex.z=vertexBuffer[i+2];var u=azimuth(vertex)/2/Math.PI+0.5;var v=inclination(vertex)/Math.PI+0.5;uvBuffer.push(u,1-v);}correctUVs();correctSeam();}function correctSeam(){// handle case when face straddles the seam, see #3269
  for(var i=0;i<uvBuffer.length;i+=6){// uv data of a single face
  var x0=uvBuffer[i+0];var x1=uvBuffer[i+2];var x2=uvBuffer[i+4];var max=Math.max(x0,x1,x2);var min=Math.min(x0,x1,x2);// 0.9 is somewhat arbitrary
  if(max>0.9&&min<0.1){if(x0<0.2){uvBuffer[i+0]+=1;}if(x1<0.2){uvBuffer[i+2]+=1;}if(x2<0.2){uvBuffer[i+4]+=1;}}}}function pushVertex(vertex){vertexBuffer.push(vertex.x,vertex.y,vertex.z);}function getVertexByIndex(index,vertex){var stride=index*3;vertex.x=vertices[stride+0];vertex.y=vertices[stride+1];vertex.z=vertices[stride+2];}function correctUVs(){var a=new Vector3$1();var b=new Vector3$1();var c=new Vector3$1();var centroid=new Vector3$1();var uvA=new Vector2$1();var uvB=new Vector2$1();var uvC=new Vector2$1();for(var i=0,j=0;i<vertexBuffer.length;i+=9, j+=6){a.set(vertexBuffer[i+0],vertexBuffer[i+1],vertexBuffer[i+2]);b.set(vertexBuffer[i+3],vertexBuffer[i+4],vertexBuffer[i+5]);c.set(vertexBuffer[i+6],vertexBuffer[i+7],vertexBuffer[i+8]);uvA.set(uvBuffer[j+0],uvBuffer[j+1]);uvB.set(uvBuffer[j+2],uvBuffer[j+3]);uvC.set(uvBuffer[j+4],uvBuffer[j+5]);centroid.copy(a).add(b).add(c).divideScalar(3);var azi=azimuth(centroid);correctUV(uvA,j+0,a,azi);correctUV(uvB,j+2,b,azi);correctUV(uvC,j+4,c,azi);}}function correctUV(uv,stride,vector,azimuth){if(azimuth<0&&uv.x===1){uvBuffer[stride]=uv.x-1;}if(vector.x===0&&vector.z===0){uvBuffer[stride]=azimuth/2/Math.PI+0.5;}}// Angle around the Y axis, counter-clockwise when looking from above.
  function azimuth(vector){return Math.atan2(vector.z,-vector.x);}// Angle above the XZ plane.
  function inclination(vector){return Math.atan2(-vector.y,Math.sqrt(vector.x*vector.x+vector.z*vector.z));}}PolyhedronBufferGeometry.prototype=Object.create(BufferGeometry.prototype);PolyhedronBufferGeometry.prototype.constructor=PolyhedronBufferGeometry;/**
   * @author timothypratley / https://github.com/timothypratley
   * @author Mugen87 / https://github.com/Mugen87
   */// TetrahedronGeometry
  function TetrahedronGeometry(radius,detail){Geometry.call(this);this.type='TetrahedronGeometry';this.parameters={radius:radius,detail:detail};this.fromBufferGeometry(new TetrahedronBufferGeometry(radius,detail));this.mergeVertices();}TetrahedronGeometry.prototype=Object.create(Geometry.prototype);TetrahedronGeometry.prototype.constructor=TetrahedronGeometry;// TetrahedronBufferGeometry
  function TetrahedronBufferGeometry(radius,detail){var vertices=[1,1,1,-1,-1,1,-1,1,-1,1,-1,-1];var indices=[2,1,0,0,3,2,1,3,0,2,3,1];PolyhedronBufferGeometry.call(this,vertices,indices,radius,detail);this.type='TetrahedronBufferGeometry';this.parameters={radius:radius,detail:detail};}TetrahedronBufferGeometry.prototype=Object.create(PolyhedronBufferGeometry.prototype);TetrahedronBufferGeometry.prototype.constructor=TetrahedronBufferGeometry;/**
   * @author timothypratley / https://github.com/timothypratley
   * @author Mugen87 / https://github.com/Mugen87
   */// OctahedronGeometry
  function OctahedronGeometry(radius,detail){Geometry.call(this);this.type='OctahedronGeometry';this.parameters={radius:radius,detail:detail};this.fromBufferGeometry(new OctahedronBufferGeometry(radius,detail));this.mergeVertices();}OctahedronGeometry.prototype=Object.create(Geometry.prototype);OctahedronGeometry.prototype.constructor=OctahedronGeometry;// OctahedronBufferGeometry
  function OctahedronBufferGeometry(radius,detail){var vertices=[1,0,0,-1,0,0,0,1,0,0,-1,0,0,0,1,0,0,-1];var indices=[0,2,4,0,4,3,0,3,5,0,5,2,1,2,5,1,5,3,1,3,4,1,4,2];PolyhedronBufferGeometry.call(this,vertices,indices,radius,detail);this.type='OctahedronBufferGeometry';this.parameters={radius:radius,detail:detail};}OctahedronBufferGeometry.prototype=Object.create(PolyhedronBufferGeometry.prototype);OctahedronBufferGeometry.prototype.constructor=OctahedronBufferGeometry;/**
   * @author timothypratley / https://github.com/timothypratley
   * @author Mugen87 / https://github.com/Mugen87
   */// IcosahedronGeometry
  function IcosahedronGeometry(radius,detail){Geometry.call(this);this.type='IcosahedronGeometry';this.parameters={radius:radius,detail:detail};this.fromBufferGeometry(new IcosahedronBufferGeometry(radius,detail));this.mergeVertices();}IcosahedronGeometry.prototype=Object.create(Geometry.prototype);IcosahedronGeometry.prototype.constructor=IcosahedronGeometry;// IcosahedronBufferGeometry
  function IcosahedronBufferGeometry(radius,detail){var t=(1+Math.sqrt(5))/2;var vertices=[-1,t,0,1,t,0,-1,-t,0,1,-t,0,0,-1,t,0,1,t,0,-1,-t,0,1,-t,t,0,-1,t,0,1,-t,0,-1,-t,0,1];var indices=[0,11,5,0,5,1,0,1,7,0,7,10,0,10,11,1,5,9,5,11,4,11,10,2,10,7,6,7,1,8,3,9,4,3,4,2,3,2,6,3,6,8,3,8,9,4,9,5,2,4,11,6,2,10,8,6,7,9,8,1];PolyhedronBufferGeometry.call(this,vertices,indices,radius,detail);this.type='IcosahedronBufferGeometry';this.parameters={radius:radius,detail:detail};}IcosahedronBufferGeometry.prototype=Object.create(PolyhedronBufferGeometry.prototype);IcosahedronBufferGeometry.prototype.constructor=IcosahedronBufferGeometry;/**
   * @author Abe Pazos / https://hamoid.com
   * @author Mugen87 / https://github.com/Mugen87
   */// DodecahedronGeometry
  function DodecahedronGeometry(radius,detail){Geometry.call(this);this.type='DodecahedronGeometry';this.parameters={radius:radius,detail:detail};this.fromBufferGeometry(new DodecahedronBufferGeometry(radius,detail));this.mergeVertices();}DodecahedronGeometry.prototype=Object.create(Geometry.prototype);DodecahedronGeometry.prototype.constructor=DodecahedronGeometry;// DodecahedronBufferGeometry
  function DodecahedronBufferGeometry(radius,detail){var t=(1+Math.sqrt(5))/2;var r=1/t;var vertices=[// (±1, ±1, ±1)
  -1,-1,-1,-1,-1,1,-1,1,-1,-1,1,1,1,-1,-1,1,-1,1,1,1,-1,1,1,1,// (0, ±1/φ, ±φ)
  0,-r,-t,0,-r,t,0,r,-t,0,r,t,// (±1/φ, ±φ, 0)
  -r,-t,0,-r,t,0,r,-t,0,r,t,0,// (±φ, 0, ±1/φ)
  -t,0,-r,t,0,-r,-t,0,r,t,0,r];var indices=[3,11,7,3,7,15,3,15,13,7,19,17,7,17,6,7,6,15,17,4,8,17,8,10,17,10,6,8,0,16,8,16,2,8,2,10,0,12,1,0,1,18,0,18,16,6,10,2,6,2,13,6,13,15,2,16,18,2,18,3,2,3,13,18,1,9,18,9,11,18,11,3,4,14,12,4,12,0,4,0,8,11,9,5,11,5,19,11,19,7,19,5,14,19,14,4,19,4,17,1,12,14,1,14,5,1,5,9];PolyhedronBufferGeometry.call(this,vertices,indices,radius,detail);this.type='DodecahedronBufferGeometry';this.parameters={radius:radius,detail:detail};}DodecahedronBufferGeometry.prototype=Object.create(PolyhedronBufferGeometry.prototype);DodecahedronBufferGeometry.prototype.constructor=DodecahedronBufferGeometry;/**
   * @author oosmoxiecode / https://github.com/oosmoxiecode
   * @author WestLangley / https://github.com/WestLangley
   * @author zz85 / https://github.com/zz85
   * @author miningold / https://github.com/miningold
   * @author jonobr1 / https://github.com/jonobr1
   * @author Mugen87 / https://github.com/Mugen87
   *
   */// TubeGeometry
  function TubeGeometry(path,tubularSegments,radius,radialSegments,closed,taper){Geometry.call(this);this.type='TubeGeometry';this.parameters={path:path,tubularSegments:tubularSegments,radius:radius,radialSegments:radialSegments,closed:closed};if(taper!==undefined){console.warn('THREE.TubeGeometry: taper has been removed.');}var bufferGeometry=new TubeBufferGeometry(path,tubularSegments,radius,radialSegments,closed);// expose internals
  this.tangents=bufferGeometry.tangents;this.normals=bufferGeometry.normals;this.binormals=bufferGeometry.binormals;// create geometry
  this.fromBufferGeometry(bufferGeometry);this.mergeVertices();}TubeGeometry.prototype=Object.create(Geometry.prototype);TubeGeometry.prototype.constructor=TubeGeometry;// TubeBufferGeometry
  function TubeBufferGeometry(path,tubularSegments,radius,radialSegments,closed){BufferGeometry.call(this);this.type='TubeBufferGeometry';this.parameters={path:path,tubularSegments:tubularSegments,radius:radius,radialSegments:radialSegments,closed:closed};tubularSegments=tubularSegments||64;radius=radius||1;radialSegments=radialSegments||8;closed=closed||false;var frames=path.computeFrenetFrames(tubularSegments,closed);// expose internals
  this.tangents=frames.tangents;this.normals=frames.normals;this.binormals=frames.binormals;// helper variables
  var vertex=new Vector3$1();var normal=new Vector3$1();var uv=new Vector2$1();var P=new Vector3$1();var i,j;// buffer
  var vertices=[];var normals=[];var uvs=[];var indices=[];// create buffer data
  generateBufferData();// build geometry
  this.setIndex(indices);this.addAttribute('position',new Float32BufferAttribute(vertices,3));this.addAttribute('normal',new Float32BufferAttribute(normals,3));this.addAttribute('uv',new Float32BufferAttribute(uvs,2));// functions
  function generateBufferData(){for(i=0;i<tubularSegments;i++){generateSegment(i);}// if the geometry is not closed, generate the last row of vertices and normals
  // at the regular position on the given path
  //
  // if the geometry is closed, duplicate the first row of vertices and normals (uvs will differ)
  generateSegment(closed===false?tubularSegments:0);// uvs are generated in a separate function.
  // this makes it easy compute correct values for closed geometries
  generateUVs();// finally create faces
  generateIndices();}function generateSegment(i){// we use getPointAt to sample evenly distributed points from the given path
  P=path.getPointAt(i/tubularSegments,P);// retrieve corresponding normal and binormal
  var N=frames.normals[i];var B=frames.binormals[i];// generate normals and vertices for the current segment
  for(j=0;j<=radialSegments;j++){var v=j/radialSegments*Math.PI*2;var sin=Math.sin(v);var cos=-Math.cos(v);// normal
  normal.x=cos*N.x+sin*B.x;normal.y=cos*N.y+sin*B.y;normal.z=cos*N.z+sin*B.z;normal.normalize();normals.push(normal.x,normal.y,normal.z);// vertex
  vertex.x=P.x+radius*normal.x;vertex.y=P.y+radius*normal.y;vertex.z=P.z+radius*normal.z;vertices.push(vertex.x,vertex.y,vertex.z);}}function generateIndices(){for(j=1;j<=tubularSegments;j++){for(i=1;i<=radialSegments;i++){var a=(radialSegments+1)*(j-1)+(i-1);var b=(radialSegments+1)*j+(i-1);var c=(radialSegments+1)*j+i;var d=(radialSegments+1)*(j-1)+i;// faces
  indices.push(a,b,d);indices.push(b,c,d);}}}function generateUVs(){for(i=0;i<=tubularSegments;i++){for(j=0;j<=radialSegments;j++){uv.x=i/tubularSegments;uv.y=j/radialSegments;uvs.push(uv.x,uv.y);}}}}TubeBufferGeometry.prototype=Object.create(BufferGeometry.prototype);TubeBufferGeometry.prototype.constructor=TubeBufferGeometry;/**
   * @author oosmoxiecode
   * @author Mugen87 / https://github.com/Mugen87
   *
   * based on http://www.blackpawn.com/texts/pqtorus/
   */// TorusKnotGeometry
  function TorusKnotGeometry(radius,tube,tubularSegments,radialSegments,p,q,heightScale){Geometry.call(this);this.type='TorusKnotGeometry';this.parameters={radius:radius,tube:tube,tubularSegments:tubularSegments,radialSegments:radialSegments,p:p,q:q};if(heightScale!==undefined){console.warn('THREE.TorusKnotGeometry: heightScale has been deprecated. Use .scale( x, y, z ) instead.');}this.fromBufferGeometry(new TorusKnotBufferGeometry(radius,tube,tubularSegments,radialSegments,p,q));this.mergeVertices();}TorusKnotGeometry.prototype=Object.create(Geometry.prototype);TorusKnotGeometry.prototype.constructor=TorusKnotGeometry;// TorusKnotBufferGeometry
  function TorusKnotBufferGeometry(radius,tube,tubularSegments,radialSegments,p,q){BufferGeometry.call(this);this.type='TorusKnotBufferGeometry';this.parameters={radius:radius,tube:tube,tubularSegments:tubularSegments,radialSegments:radialSegments,p:p,q:q};radius=radius||1;tube=tube||0.4;tubularSegments=Math.floor(tubularSegments)||64;radialSegments=Math.floor(radialSegments)||8;p=p||2;q=q||3;// buffers
  var indices=[];var vertices=[];var normals=[];var uvs=[];// helper variables
  var i,j;var vertex=new Vector3$1();var normal=new Vector3$1();var P1=new Vector3$1();var P2=new Vector3$1();var B=new Vector3$1();var T=new Vector3$1();var N=new Vector3$1();// generate vertices, normals and uvs
  for(i=0;i<=tubularSegments;++i){// the radian "u" is used to calculate the position on the torus curve of the current tubular segement
  var u=i/tubularSegments*p*Math.PI*2;// now we calculate two points. P1 is our current position on the curve, P2 is a little farther ahead.
  // these points are used to create a special "coordinate space", which is necessary to calculate the correct vertex positions
  calculatePositionOnCurve(u,p,q,radius,P1);calculatePositionOnCurve(u+0.01,p,q,radius,P2);// calculate orthonormal basis
  T.subVectors(P2,P1);N.addVectors(P2,P1);B.crossVectors(T,N);N.crossVectors(B,T);// normalize B, N. T can be ignored, we don't use it
  B.normalize();N.normalize();for(j=0;j<=radialSegments;++j){// now calculate the vertices. they are nothing more than an extrusion of the torus curve.
  // because we extrude a shape in the xy-plane, there is no need to calculate a z-value.
  var v=j/radialSegments*Math.PI*2;var cx=-tube*Math.cos(v);var cy=tube*Math.sin(v);// now calculate the final vertex position.
  // first we orient the extrusion with our basis vectos, then we add it to the current position on the curve
  vertex.x=P1.x+(cx*N.x+cy*B.x);vertex.y=P1.y+(cx*N.y+cy*B.y);vertex.z=P1.z+(cx*N.z+cy*B.z);vertices.push(vertex.x,vertex.y,vertex.z);// normal (P1 is always the center/origin of the extrusion, thus we can use it to calculate the normal)
  normal.subVectors(vertex,P1).normalize();normals.push(normal.x,normal.y,normal.z);// uv
  uvs.push(i/tubularSegments);uvs.push(j/radialSegments);}}// generate indices
  for(j=1;j<=tubularSegments;j++){for(i=1;i<=radialSegments;i++){// indices
  var a=(radialSegments+1)*(j-1)+(i-1);var b=(radialSegments+1)*j+(i-1);var c=(radialSegments+1)*j+i;var d=(radialSegments+1)*(j-1)+i;// faces
  indices.push(a,b,d);indices.push(b,c,d);}}// build geometry
  this.setIndex(indices);this.addAttribute('position',new Float32BufferAttribute(vertices,3));this.addAttribute('normal',new Float32BufferAttribute(normals,3));this.addAttribute('uv',new Float32BufferAttribute(uvs,2));// this function calculates the current position on the torus curve
  function calculatePositionOnCurve(u,p,q,radius,position){var cu=Math.cos(u);var su=Math.sin(u);var quOverP=q/p*u;var cs=Math.cos(quOverP);position.x=radius*(2+cs)*0.5*cu;position.y=radius*(2+cs)*su*0.5;position.z=radius*Math.sin(quOverP)*0.5;}}TorusKnotBufferGeometry.prototype=Object.create(BufferGeometry.prototype);TorusKnotBufferGeometry.prototype.constructor=TorusKnotBufferGeometry;/**
   * @author oosmoxiecode
   * @author mrdoob / http://mrdoob.com/
   * @author Mugen87 / https://github.com/Mugen87
   */// TorusGeometry
  function TorusGeometry(radius,tube,radialSegments,tubularSegments,arc){Geometry.call(this);this.type='TorusGeometry';this.parameters={radius:radius,tube:tube,radialSegments:radialSegments,tubularSegments:tubularSegments,arc:arc};this.fromBufferGeometry(new TorusBufferGeometry(radius,tube,radialSegments,tubularSegments,arc));this.mergeVertices();}TorusGeometry.prototype=Object.create(Geometry.prototype);TorusGeometry.prototype.constructor=TorusGeometry;// TorusBufferGeometry
  function TorusBufferGeometry(radius,tube,radialSegments,tubularSegments,arc){BufferGeometry.call(this);this.type='TorusBufferGeometry';this.parameters={radius:radius,tube:tube,radialSegments:radialSegments,tubularSegments:tubularSegments,arc:arc};radius=radius||1;tube=tube||0.4;radialSegments=Math.floor(radialSegments)||8;tubularSegments=Math.floor(tubularSegments)||6;arc=arc||Math.PI*2;// buffers
  var indices=[];var vertices=[];var normals=[];var uvs=[];// helper variables
  var center=new Vector3$1();var vertex=new Vector3$1();var normal=new Vector3$1();var j,i;// generate vertices, normals and uvs
  for(j=0;j<=radialSegments;j++){for(i=0;i<=tubularSegments;i++){var u=i/tubularSegments*arc;var v=j/radialSegments*Math.PI*2;// vertex
  vertex.x=(radius+tube*Math.cos(v))*Math.cos(u);vertex.y=(radius+tube*Math.cos(v))*Math.sin(u);vertex.z=tube*Math.sin(v);vertices.push(vertex.x,vertex.y,vertex.z);// normal
  center.x=radius*Math.cos(u);center.y=radius*Math.sin(u);normal.subVectors(vertex,center).normalize();normals.push(normal.x,normal.y,normal.z);// uv
  uvs.push(i/tubularSegments);uvs.push(j/radialSegments);}}// generate indices
  for(j=1;j<=radialSegments;j++){for(i=1;i<=tubularSegments;i++){// indices
  var a=(tubularSegments+1)*j+i-1;var b=(tubularSegments+1)*(j-1)+i-1;var c=(tubularSegments+1)*(j-1)+i;var d=(tubularSegments+1)*j+i;// faces
  indices.push(a,b,d);indices.push(b,c,d);}}// build geometry
  this.setIndex(indices);this.addAttribute('position',new Float32BufferAttribute(vertices,3));this.addAttribute('normal',new Float32BufferAttribute(normals,3));this.addAttribute('uv',new Float32BufferAttribute(uvs,2));}TorusBufferGeometry.prototype=Object.create(BufferGeometry.prototype);TorusBufferGeometry.prototype.constructor=TorusBufferGeometry;/**
   * @author Mugen87 / https://github.com/Mugen87
   * Port from https://github.com/mapbox/earcut (v2.1.2)
   */var Earcut={triangulate:function triangulate(data,holeIndices,dim){dim=dim||2;var hasHoles=holeIndices&&holeIndices.length,outerLen=hasHoles?holeIndices[0]*dim:data.length,outerNode=linkedList(data,0,outerLen,dim,true),triangles=[];if(!outerNode){return triangles;}var minX,minY,maxX,maxY,x,y,invSize;if(hasHoles){outerNode=eliminateHoles(data,holeIndices,outerNode,dim);}// if the shape is not too simple, we'll use z-order curve hash later; calculate polygon bbox
  if(data.length>80*dim){minX=maxX=data[0];minY=maxY=data[1];for(var i=dim;i<outerLen;i+=dim){x=data[i];y=data[i+1];if(x<minX){minX=x;}if(y<minY){minY=y;}if(x>maxX){maxX=x;}if(y>maxY){maxY=y;}}// minX, minY and invSize are later used to transform coords into integers for z-order calculation
  invSize=Math.max(maxX-minX,maxY-minY);invSize=invSize!==0?1/invSize:0;}earcutLinked(outerNode,triangles,dim,minX,minY,invSize);return triangles;}};// create a circular doubly linked list from polygon points in the specified winding order
  function linkedList(data,start,end,dim,clockwise){var i,last;if(clockwise===signedArea(data,start,end,dim)>0){for(i=start;i<end;i+=dim){last=insertNode(i,data[i],data[i+1],last);}}else{for(i=end-dim;i>=start;i-=dim){last=insertNode(i,data[i],data[i+1],last);}}if(last&&equals(last,last.next)){removeNode(last);last=last.next;}return last;}// eliminate colinear or duplicate points
  function filterPoints(start,end){if(!start){return start;}if(!end){end=start;}var p=start,again;do{again=false;if(!p.steiner&&(equals(p,p.next)||area(p.prev,p,p.next)===0)){removeNode(p);p=end=p.prev;if(p===p.next){break;}again=true;}else{p=p.next;}}while(again||p!==end);return end;}// main ear slicing loop which triangulates a polygon (given as a linked list)
  function earcutLinked(ear,triangles,dim,minX,minY,invSize,pass){if(!ear){return;}// interlink polygon nodes in z-order
  if(!pass&&invSize){indexCurve(ear,minX,minY,invSize);}var stop=ear,prev,next;// iterate through ears, slicing them one by one
  while(ear.prev!==ear.next){prev=ear.prev;next=ear.next;if(invSize?isEarHashed(ear,minX,minY,invSize):isEar(ear)){// cut off the triangle
  triangles.push(prev.i/dim);triangles.push(ear.i/dim);triangles.push(next.i/dim);removeNode(ear);// skipping the next vertice leads to less sliver triangles
  ear=next.next;stop=next.next;continue;}ear=next;// if we looped through the whole remaining polygon and can't find any more ears
  if(ear===stop){// try filtering points and slicing again
  if(!pass){earcutLinked(filterPoints(ear),triangles,dim,minX,minY,invSize,1);// if this didn't work, try curing all small self-intersections locally
  }else if(pass===1){ear=cureLocalIntersections(ear,triangles,dim);earcutLinked(ear,triangles,dim,minX,minY,invSize,2);// as a last resort, try splitting the remaining polygon into two
  }else if(pass===2){splitEarcut(ear,triangles,dim,minX,minY,invSize);}break;}}}// check whether a polygon node forms a valid ear with adjacent nodes
  function isEar(ear){var a=ear.prev,b=ear,c=ear.next;if(area(a,b,c)>=0){return false;}// reflex, can't be an ear
  // now make sure we don't have other points inside the potential ear
  var p=ear.next.next;while(p!==ear.prev){if(pointInTriangle(a.x,a.y,b.x,b.y,c.x,c.y,p.x,p.y)&&area(p.prev,p,p.next)>=0){return false;}p=p.next;}return true;}function isEarHashed(ear,minX,minY,invSize){var a=ear.prev,b=ear,c=ear.next;if(area(a,b,c)>=0){return false;}// reflex, can't be an ear
  // triangle bbox; min & max are calculated like this for speed
  var minTX=a.x<b.x?a.x<c.x?a.x:c.x:b.x<c.x?b.x:c.x,minTY=a.y<b.y?a.y<c.y?a.y:c.y:b.y<c.y?b.y:c.y,maxTX=a.x>b.x?a.x>c.x?a.x:c.x:b.x>c.x?b.x:c.x,maxTY=a.y>b.y?a.y>c.y?a.y:c.y:b.y>c.y?b.y:c.y;// z-order range for the current triangle bbox;
  var minZ=zOrder(minTX,minTY,minX,minY,invSize),maxZ=zOrder(maxTX,maxTY,minX,minY,invSize);// first look for points inside the triangle in increasing z-order
  var p=ear.nextZ;while(p&&p.z<=maxZ){if(p!==ear.prev&&p!==ear.next&&pointInTriangle(a.x,a.y,b.x,b.y,c.x,c.y,p.x,p.y)&&area(p.prev,p,p.next)>=0){return false;}p=p.nextZ;}// then look for points in decreasing z-order
  p=ear.prevZ;while(p&&p.z>=minZ){if(p!==ear.prev&&p!==ear.next&&pointInTriangle(a.x,a.y,b.x,b.y,c.x,c.y,p.x,p.y)&&area(p.prev,p,p.next)>=0){return false;}p=p.prevZ;}return true;}// go through all polygon nodes and cure small local self-intersections
  function cureLocalIntersections(start,triangles,dim){var p=start;do{var a=p.prev,b=p.next.next;if(!equals(a,b)&&intersects(a,p,p.next,b)&&locallyInside(a,b)&&locallyInside(b,a)){triangles.push(a.i/dim);triangles.push(p.i/dim);triangles.push(b.i/dim);// remove two nodes involved
  removeNode(p);removeNode(p.next);p=start=b;}p=p.next;}while(p!==start);return p;}// try splitting polygon into two and triangulate them independently
  function splitEarcut(start,triangles,dim,minX,minY,invSize){// look for a valid diagonal that divides the polygon into two
  var a=start;do{var b=a.next.next;while(b!==a.prev){if(a.i!==b.i&&isValidDiagonal(a,b)){// split the polygon in two by the diagonal
  var c=splitPolygon(a,b);// filter colinear points around the cuts
  a=filterPoints(a,a.next);c=filterPoints(c,c.next);// run earcut on each half
  earcutLinked(a,triangles,dim,minX,minY,invSize);earcutLinked(c,triangles,dim,minX,minY,invSize);return;}b=b.next;}a=a.next;}while(a!==start);}// link every hole into the outer loop, producing a single-ring polygon without holes
  function eliminateHoles(data,holeIndices,outerNode,dim){var queue=[],i,len,start,end,list;for(i=0, len=holeIndices.length;i<len;i++){start=holeIndices[i]*dim;end=i<len-1?holeIndices[i+1]*dim:data.length;list=linkedList(data,start,end,dim,false);if(list===list.next){list.steiner=true;}queue.push(getLeftmost(list));}queue.sort(compareX);// process holes from left to right
  for(i=0;i<queue.length;i++){eliminateHole(queue[i],outerNode);outerNode=filterPoints(outerNode,outerNode.next);}return outerNode;}function compareX(a,b){return a.x-b.x;}// find a bridge between vertices that connects hole with an outer ring and and link it
  function eliminateHole(hole,outerNode){outerNode=findHoleBridge(hole,outerNode);if(outerNode){var b=splitPolygon(outerNode,hole);filterPoints(b,b.next);}}// David Eberly's algorithm for finding a bridge between hole and outer polygon
  function findHoleBridge(hole,outerNode){var p=outerNode,hx=hole.x,hy=hole.y,qx=-Infinity,m;// find a segment intersected by a ray from the hole's leftmost point to the left;
  // segment's endpoint with lesser x will be potential connection point
  do{if(hy<=p.y&&hy>=p.next.y&&p.next.y!==p.y){var x=p.x+(hy-p.y)*(p.next.x-p.x)/(p.next.y-p.y);if(x<=hx&&x>qx){qx=x;if(x===hx){if(hy===p.y){return p;}if(hy===p.next.y){return p.next;}}m=p.x<p.next.x?p:p.next;}}p=p.next;}while(p!==outerNode);if(!m){return null;}if(hx===qx){return m.prev;}// hole touches outer segment; pick lower endpoint
  // look for points inside the triangle of hole point, segment intersection and endpoint;
  // if there are no points found, we have a valid connection;
  // otherwise choose the point of the minimum angle with the ray as connection point
  var stop=m,mx=m.x,my=m.y,tanMin=Infinity,tan;p=m.next;while(p!==stop){if(hx>=p.x&&p.x>=mx&&hx!==p.x&&pointInTriangle(hy<my?hx:qx,hy,mx,my,hy<my?qx:hx,hy,p.x,p.y)){tan=Math.abs(hy-p.y)/(hx-p.x);// tangential
  if((tan<tanMin||tan===tanMin&&p.x>m.x)&&locallyInside(p,hole)){m=p;tanMin=tan;}}p=p.next;}return m;}// interlink polygon nodes in z-order
  function indexCurve(start,minX,minY,invSize){var p=start;do{if(p.z===null){p.z=zOrder(p.x,p.y,minX,minY,invSize);}p.prevZ=p.prev;p.nextZ=p.next;p=p.next;}while(p!==start);p.prevZ.nextZ=null;p.prevZ=null;sortLinked(p);}// Simon Tatham's linked list merge sort algorithm
  // http://www.chiark.greenend.org.uk/~sgtatham/algorithms/listsort.html
  function sortLinked(list){var i,p,q,e,tail,numMerges,pSize,qSize,inSize=1;do{p=list;list=null;tail=null;numMerges=0;while(p){numMerges++;q=p;pSize=0;for(i=0;i<inSize;i++){pSize++;q=q.nextZ;if(!q){break;}}qSize=inSize;while(pSize>0||qSize>0&&q){if(pSize!==0&&(qSize===0||!q||p.z<=q.z)){e=p;p=p.nextZ;pSize--;}else{e=q;q=q.nextZ;qSize--;}if(tail){tail.nextZ=e;}else{list=e;}e.prevZ=tail;tail=e;}p=q;}tail.nextZ=null;inSize*=2;}while(numMerges>1);return list;}// z-order of a point given coords and inverse of the longer side of data bbox
  function zOrder(x,y,minX,minY,invSize){// coords are transformed into non-negative 15-bit integer range
  x=32767*(x-minX)*invSize;y=32767*(y-minY)*invSize;x=(x|x<<8)&0x00FF00FF;x=(x|x<<4)&0x0F0F0F0F;x=(x|x<<2)&0x33333333;x=(x|x<<1)&0x55555555;y=(y|y<<8)&0x00FF00FF;y=(y|y<<4)&0x0F0F0F0F;y=(y|y<<2)&0x33333333;y=(y|y<<1)&0x55555555;return x|y<<1;}// find the leftmost node of a polygon ring
  function getLeftmost(start){var p=start,leftmost=start;do{if(p.x<leftmost.x){leftmost=p;}p=p.next;}while(p!==start);return leftmost;}// check if a point lies within a convex triangle
  function pointInTriangle(ax,ay,bx,by,cx,cy,px,py){return(cx-px)*(ay-py)-(ax-px)*(cy-py)>=0&&(ax-px)*(by-py)-(bx-px)*(ay-py)>=0&&(bx-px)*(cy-py)-(cx-px)*(by-py)>=0;}// check if a diagonal between two polygon nodes is valid (lies in polygon interior)
  function isValidDiagonal(a,b){return a.next.i!==b.i&&a.prev.i!==b.i&&!intersectsPolygon(a,b)&&locallyInside(a,b)&&locallyInside(b,a)&&middleInside(a,b);}// signed area of a triangle
  function area(p,q,r){return(q.y-p.y)*(r.x-q.x)-(q.x-p.x)*(r.y-q.y);}// check if two points are equal
  function equals(p1,p2){return p1.x===p2.x&&p1.y===p2.y;}// check if two segments intersect
  function intersects(p1,q1,p2,q2){if(equals(p1,q1)&&equals(p2,q2)||equals(p1,q2)&&equals(p2,q1)){return true;}return area(p1,q1,p2)>0!==area(p1,q1,q2)>0&&area(p2,q2,p1)>0!==area(p2,q2,q1)>0;}// check if a polygon diagonal intersects any polygon segments
  function intersectsPolygon(a,b){var p=a;do{if(p.i!==a.i&&p.next.i!==a.i&&p.i!==b.i&&p.next.i!==b.i&&intersects(p,p.next,a,b)){return true;}p=p.next;}while(p!==a);return false;}// check if a polygon diagonal is locally inside the polygon
  function locallyInside(a,b){return area(a.prev,a,a.next)<0?area(a,b,a.next)>=0&&area(a,a.prev,b)>=0:area(a,b,a.prev)<0||area(a,a.next,b)<0;}// check if the middle point of a polygon diagonal is inside the polygon
  function middleInside(a,b){var p=a,inside=false,px=(a.x+b.x)/2,py=(a.y+b.y)/2;do{if(p.y>py!==p.next.y>py&&p.next.y!==p.y&&px<(p.next.x-p.x)*(py-p.y)/(p.next.y-p.y)+p.x){inside=!inside;}p=p.next;}while(p!==a);return inside;}// link two polygon vertices with a bridge; if the vertices belong to the same ring, it splits polygon into two;
  // if one belongs to the outer ring and another to a hole, it merges it into a single ring
  function splitPolygon(a,b){var a2=new Node(a.i,a.x,a.y),b2=new Node(b.i,b.x,b.y),an=a.next,bp=b.prev;a.next=b;b.prev=a;a2.next=an;an.prev=a2;b2.next=a2;a2.prev=b2;bp.next=b2;b2.prev=bp;return b2;}// create a node and optionally link it with previous one (in a circular doubly linked list)
  function insertNode(i,x,y,last){var p=new Node(i,x,y);if(!last){p.prev=p;p.next=p;}else{p.next=last.next;p.prev=last;last.next.prev=p;last.next=p;}return p;}function removeNode(p){p.next.prev=p.prev;p.prev.next=p.next;if(p.prevZ){p.prevZ.nextZ=p.nextZ;}if(p.nextZ){p.nextZ.prevZ=p.prevZ;}}function Node(i,x,y){// vertice index in coordinates array
  this.i=i;// vertex coordinates
  this.x=x;this.y=y;// previous and next vertice nodes in a polygon ring
  this.prev=null;this.next=null;// z-order curve value
  this.z=null;// previous and next nodes in z-order
  this.prevZ=null;this.nextZ=null;// indicates whether this is a steiner point
  this.steiner=false;}function signedArea(data,start,end,dim){var sum=0;for(var i=start,j=end-dim;i<end;i+=dim){sum+=(data[j]-data[i])*(data[i+1]+data[j+1]);j=i;}return sum;}/**
   * @author zz85 / http://www.lab4games.net/zz85/blog
   */var ShapeUtils={// calculate area of the contour polygon
  area:function area(contour){var n=contour.length;var a=0.0;for(var p=n-1,q=0;q<n;p=q++){a+=contour[p].x*contour[q].y-contour[q].x*contour[p].y;}return a*0.5;},isClockWise:function isClockWise(pts){return ShapeUtils.area(pts)<0;},triangulateShape:function triangulateShape(contour,holes){function removeDupEndPts(points){var l=points.length;if(l>2&&points[l-1].equals(points[0])){points.pop();}}function addContour(vertices,contour){for(var i=0;i<contour.length;i++){vertices.push(contour[i].x);vertices.push(contour[i].y);}}var vertices=[];// flat array of vertices like [ x0,y0, x1,y1, x2,y2, ... ]
  var holeIndices=[];// array of hole indices
  var faces=[];// final array of vertex indices like [ [ a,b,d ], [ b,c,d ] ]
  removeDupEndPts(contour);addContour(vertices,contour);//
  var holeIndex=contour.length;holes.forEach(removeDupEndPts);for(i=0;i<holes.length;i++){holeIndices.push(holeIndex);holeIndex+=holes[i].length;addContour(vertices,holes[i]);}//
  var triangles=Earcut.triangulate(vertices,holeIndices);//
  for(var i=0;i<triangles.length;i+=3){faces.push(triangles.slice(i,i+3));}return faces;}};/**
   * @author zz85 / http://www.lab4games.net/zz85/blog
   *
   * Creates extruded geometry from a path shape.
   *
   * parameters = {
   *
   *  curveSegments: <int>, // number of points on the curves
   *  steps: <int>, // number of points for z-side extrusions / used for subdividing segments of extrude spline too
   *  amount: <int>, // Depth to extrude the shape
   *
   *  bevelEnabled: <bool>, // turn on bevel
   *  bevelThickness: <float>, // how deep into the original shape bevel goes
   *  bevelSize: <float>, // how far from shape outline is bevel
   *  bevelSegments: <int>, // number of bevel layers
   *
   *  extrudePath: <THREE.Curve> // curve to extrude shape along
   *  frames: <Object> // containing arrays of tangents, normals, binormals
   *
   *  UVGenerator: <Object> // object that provides UV generator functions
   *
   * }
   */// ExtrudeGeometry
  function ExtrudeGeometry(shapes,options){Geometry.call(this);this.type='ExtrudeGeometry';this.parameters={shapes:shapes,options:options};this.fromBufferGeometry(new ExtrudeBufferGeometry(shapes,options));this.mergeVertices();}ExtrudeGeometry.prototype=Object.create(Geometry.prototype);ExtrudeGeometry.prototype.constructor=ExtrudeGeometry;// ExtrudeBufferGeometry
  function ExtrudeBufferGeometry(shapes,options){if(typeof shapes==="undefined"){return;}BufferGeometry.call(this);this.type='ExtrudeBufferGeometry';shapes=Array.isArray(shapes)?shapes:[shapes];this.addShapeList(shapes,options);this.computeVertexNormals();// can't really use automatic vertex normals
  // as then front and back sides get smoothed too
  // should do separate smoothing just for sides
  //this.computeVertexNormals();
  //console.log( "took", ( Date.now() - startTime ) );
  }ExtrudeBufferGeometry.prototype=Object.create(BufferGeometry.prototype);ExtrudeBufferGeometry.prototype.constructor=ExtrudeBufferGeometry;ExtrudeBufferGeometry.prototype.getArrays=function(){var positionAttribute=this.getAttribute("position");var verticesArray=positionAttribute?Array.prototype.slice.call(positionAttribute.array):[];var uvAttribute=this.getAttribute("uv");var uvArray=uvAttribute?Array.prototype.slice.call(uvAttribute.array):[];var IndexAttribute=this.index;var indicesArray=IndexAttribute?Array.prototype.slice.call(IndexAttribute.array):[];return{position:verticesArray,uv:uvArray,index:indicesArray};};ExtrudeBufferGeometry.prototype.addShapeList=function(shapes,options){var this$1=this;var sl=shapes.length;options.arrays=this.getArrays();for(var s=0;s<sl;s++){var shape=shapes[s];this$1.addShape(shape,options);}this.setIndex(options.arrays.index);this.addAttribute('position',new Float32BufferAttribute(options.arrays.position,3));this.addAttribute('uv',new Float32BufferAttribute(options.arrays.uv,2));};ExtrudeBufferGeometry.prototype.addShape=function(shape,options){var arrays=options.arrays?options.arrays:this.getArrays();var verticesArray=arrays.position;var indicesArray=arrays.index;var uvArray=arrays.uv;var placeholder=[];var amount=options.amount!==undefined?options.amount:100;var bevelThickness=options.bevelThickness!==undefined?options.bevelThickness:6;// 10
  var bevelSize=options.bevelSize!==undefined?options.bevelSize:bevelThickness-2;// 8
  var bevelSegments=options.bevelSegments!==undefined?options.bevelSegments:3;var bevelEnabled=options.bevelEnabled!==undefined?options.bevelEnabled:true;// false
  var curveSegments=options.curveSegments!==undefined?options.curveSegments:12;var steps=options.steps!==undefined?options.steps:1;var extrudePath=options.extrudePath;var extrudePts,extrudeByPath=false;// Use default WorldUVGenerator if no UV generators are specified.
  var uvgen=options.UVGenerator!==undefined?options.UVGenerator:ExtrudeGeometry.WorldUVGenerator;var splineTube,binormal,normal,position2;if(extrudePath){extrudePts=extrudePath.getSpacedPoints(steps);extrudeByPath=true;bevelEnabled=false;// bevels not supported for path extrusion
  // SETUP TNB variables
  // TODO1 - have a .isClosed in spline?
  splineTube=options.frames!==undefined?options.frames:extrudePath.computeFrenetFrames(steps,false);// console.log(splineTube, 'splineTube', splineTube.normals.length, 'steps', steps, 'extrudePts', extrudePts.length);
  binormal=new Vector3$1();normal=new Vector3$1();position2=new Vector3$1();}// Safeguards if bevels are not enabled
  if(!bevelEnabled){bevelSegments=0;bevelThickness=0;bevelSize=0;}// Variables initialization
  var ahole,h,hl;// looping of holes
  var scope=this;var shapePoints=shape.extractPoints(curveSegments);var vertices=shapePoints.shape;var holes=shapePoints.holes;var reverse=!ShapeUtils.isClockWise(vertices);if(reverse){vertices=vertices.reverse();// Maybe we should also check if holes are in the opposite direction, just to be safe ...
  for(h=0, hl=holes.length;h<hl;h++){ahole=holes[h];if(ShapeUtils.isClockWise(ahole)){holes[h]=ahole.reverse();}}}var faces=ShapeUtils.triangulateShape(vertices,holes);/* Vertices */var contour=vertices;// vertices has all points but contour has only points of circumference
  for(h=0, hl=holes.length;h<hl;h++){ahole=holes[h];vertices=vertices.concat(ahole);}function scalePt2(pt,vec,size){if(!vec){console.error("THREE.ExtrudeGeometry: vec does not exist");}return vec.clone().multiplyScalar(size).add(pt);}var b,bs,t,z,vert,vlen=vertices.length,face,flen=faces.length;// Find directions for point movement
  function getBevelVec(inPt,inPrev,inNext){// computes for inPt the corresponding point inPt' on a new contour
  //   shifted by 1 unit (length of normalized vector) to the left
  // if we walk along contour clockwise, this new contour is outside the old one
  //
  // inPt' is the intersection of the two lines parallel to the two
  //  adjacent edges of inPt at a distance of 1 unit on the left side.
  var v_trans_x,v_trans_y,shrink_by;// resulting translation vector for inPt
  // good reading for geometry algorithms (here: line-line intersection)
  // http://geomalgorithms.com/a05-_intersect-1.html
  var v_prev_x=inPt.x-inPrev.x,v_prev_y=inPt.y-inPrev.y;var v_next_x=inNext.x-inPt.x,v_next_y=inNext.y-inPt.y;var v_prev_lensq=v_prev_x*v_prev_x+v_prev_y*v_prev_y;// check for collinear edges
  var collinear0=v_prev_x*v_next_y-v_prev_y*v_next_x;if(Math.abs(collinear0)>Number.EPSILON){// not collinear
  // length of vectors for normalizing
  var v_prev_len=Math.sqrt(v_prev_lensq);var v_next_len=Math.sqrt(v_next_x*v_next_x+v_next_y*v_next_y);// shift adjacent points by unit vectors to the left
  var ptPrevShift_x=inPrev.x-v_prev_y/v_prev_len;var ptPrevShift_y=inPrev.y+v_prev_x/v_prev_len;var ptNextShift_x=inNext.x-v_next_y/v_next_len;var ptNextShift_y=inNext.y+v_next_x/v_next_len;// scaling factor for v_prev to intersection point
  var sf=((ptNextShift_x-ptPrevShift_x)*v_next_y-(ptNextShift_y-ptPrevShift_y)*v_next_x)/(v_prev_x*v_next_y-v_prev_y*v_next_x);// vector from inPt to intersection point
  v_trans_x=ptPrevShift_x+v_prev_x*sf-inPt.x;v_trans_y=ptPrevShift_y+v_prev_y*sf-inPt.y;// Don't normalize!, otherwise sharp corners become ugly
  //  but prevent crazy spikes
  var v_trans_lensq=v_trans_x*v_trans_x+v_trans_y*v_trans_y;if(v_trans_lensq<=2){return new Vector2$1(v_trans_x,v_trans_y);}else{shrink_by=Math.sqrt(v_trans_lensq/2);}}else{// handle special case of collinear edges
  var direction_eq=false;// assumes: opposite
  if(v_prev_x>Number.EPSILON){if(v_next_x>Number.EPSILON){direction_eq=true;}}else{if(v_prev_x<-Number.EPSILON){if(v_next_x<-Number.EPSILON){direction_eq=true;}}else{if(Math.sign(v_prev_y)===Math.sign(v_next_y)){direction_eq=true;}}}if(direction_eq){// console.log("Warning: lines are a straight sequence");
  v_trans_x=-v_prev_y;v_trans_y=v_prev_x;shrink_by=Math.sqrt(v_prev_lensq);}else{// console.log("Warning: lines are a straight spike");
  v_trans_x=v_prev_x;v_trans_y=v_prev_y;shrink_by=Math.sqrt(v_prev_lensq/2);}}return new Vector2$1(v_trans_x/shrink_by,v_trans_y/shrink_by);}var contourMovements=[];for(var i=0,il=contour.length,j=il-1,k=i+1;i<il;i++, j++, k++){if(j===il){j=0;}if(k===il){k=0;}//  (j)---(i)---(k)
  // console.log('i,j,k', i, j , k)
  contourMovements[i]=getBevelVec(contour[i],contour[j],contour[k]);}var holesMovements=[],oneHoleMovements,verticesMovements=contourMovements.concat();for(h=0, hl=holes.length;h<hl;h++){ahole=holes[h];oneHoleMovements=[];for(i=0, il=ahole.length, j=il-1, k=i+1;i<il;i++, j++, k++){if(j===il){j=0;}if(k===il){k=0;}//  (j)---(i)---(k)
  oneHoleMovements[i]=getBevelVec(ahole[i],ahole[j],ahole[k]);}holesMovements.push(oneHoleMovements);verticesMovements=verticesMovements.concat(oneHoleMovements);}// Loop bevelSegments, 1 for the front, 1 for the back
  for(b=0;b<bevelSegments;b++){//for ( b = bevelSegments; b > 0; b -- ) {
  t=b/bevelSegments;z=bevelThickness*Math.cos(t*Math.PI/2);bs=bevelSize*Math.sin(t*Math.PI/2);// contract shape
  for(i=0, il=contour.length;i<il;i++){vert=scalePt2(contour[i],contourMovements[i],bs);v(vert.x,vert.y,-z);}// expand holes
  for(h=0, hl=holes.length;h<hl;h++){ahole=holes[h];oneHoleMovements=holesMovements[h];for(i=0, il=ahole.length;i<il;i++){vert=scalePt2(ahole[i],oneHoleMovements[i],bs);v(vert.x,vert.y,-z);}}}bs=bevelSize;// Back facing vertices
  for(i=0;i<vlen;i++){vert=bevelEnabled?scalePt2(vertices[i],verticesMovements[i],bs):vertices[i];if(!extrudeByPath){v(vert.x,vert.y,0);}else{// v( vert.x, vert.y + extrudePts[ 0 ].y, extrudePts[ 0 ].x );
  normal.copy(splineTube.normals[0]).multiplyScalar(vert.x);binormal.copy(splineTube.binormals[0]).multiplyScalar(vert.y);position2.copy(extrudePts[0]).add(normal).add(binormal);v(position2.x,position2.y,position2.z);}}// Add stepped vertices...
  // Including front facing vertices
  var s;for(s=1;s<=steps;s++){for(i=0;i<vlen;i++){vert=bevelEnabled?scalePt2(vertices[i],verticesMovements[i],bs):vertices[i];if(!extrudeByPath){v(vert.x,vert.y,amount/steps*s);}else{// v( vert.x, vert.y + extrudePts[ s - 1 ].y, extrudePts[ s - 1 ].x );
  normal.copy(splineTube.normals[s]).multiplyScalar(vert.x);binormal.copy(splineTube.binormals[s]).multiplyScalar(vert.y);position2.copy(extrudePts[s]).add(normal).add(binormal);v(position2.x,position2.y,position2.z);}}}// Add bevel segments planes
  //for ( b = 1; b <= bevelSegments; b ++ ) {
  for(b=bevelSegments-1;b>=0;b--){t=b/bevelSegments;z=bevelThickness*Math.cos(t*Math.PI/2);bs=bevelSize*Math.sin(t*Math.PI/2);// contract shape
  for(i=0, il=contour.length;i<il;i++){vert=scalePt2(contour[i],contourMovements[i],bs);v(vert.x,vert.y,amount+z);}// expand holes
  for(h=0, hl=holes.length;h<hl;h++){ahole=holes[h];oneHoleMovements=holesMovements[h];for(i=0, il=ahole.length;i<il;i++){vert=scalePt2(ahole[i],oneHoleMovements[i],bs);if(!extrudeByPath){v(vert.x,vert.y,amount+z);}else{v(vert.x,vert.y+extrudePts[steps-1].y,extrudePts[steps-1].x+z);}}}}/* Faces */// Top and bottom faces
  buildLidFaces();// Sides faces
  buildSideFaces();/////  Internal functions
  function buildLidFaces(){var start=verticesArray.length/3;if(bevelEnabled){var layer=0;// steps + 1
  var offset=vlen*layer;// Bottom faces
  for(i=0;i<flen;i++){face=faces[i];f3(face[2]+offset,face[1]+offset,face[0]+offset);}layer=steps+bevelSegments*2;offset=vlen*layer;// Top faces
  for(i=0;i<flen;i++){face=faces[i];f3(face[0]+offset,face[1]+offset,face[2]+offset);}}else{// Bottom faces
  for(i=0;i<flen;i++){face=faces[i];f3(face[2],face[1],face[0]);}// Top faces
  for(i=0;i<flen;i++){face=faces[i];f3(face[0]+vlen*steps,face[1]+vlen*steps,face[2]+vlen*steps);}}scope.addGroup(start,verticesArray.length/3-start,options.material!==undefined?options.material:0);}// Create faces for the z-sides of the shape
  function buildSideFaces(){var start=verticesArray.length/3;var layeroffset=0;sidewalls(contour,layeroffset);layeroffset+=contour.length;for(h=0, hl=holes.length;h<hl;h++){ahole=holes[h];sidewalls(ahole,layeroffset);//, true
  layeroffset+=ahole.length;}scope.addGroup(start,verticesArray.length/3-start,options.extrudeMaterial!==undefined?options.extrudeMaterial:1);}function sidewalls(contour,layeroffset){var j,k;i=contour.length;while(--i>=0){j=i;k=i-1;if(k<0){k=contour.length-1;}//console.log('b', i,j, i-1, k,vertices.length);
  var s=0,sl=steps+bevelSegments*2;for(s=0;s<sl;s++){var slen1=vlen*s;var slen2=vlen*(s+1);var a=layeroffset+j+slen1,b=layeroffset+k+slen1,c=layeroffset+k+slen2,d=layeroffset+j+slen2;f4(a,b,c,d);}}}function v(x,y,z){placeholder.push(x);placeholder.push(y);placeholder.push(z);}function f3(a,b,c){addVertex(a);addVertex(b);addVertex(c);var nextIndex=verticesArray.length/3;var uvs=uvgen.generateTopUV(scope,verticesArray,nextIndex-3,nextIndex-2,nextIndex-1);addUV(uvs[0]);addUV(uvs[1]);addUV(uvs[2]);}function f4(a,b,c,d){addVertex(a);addVertex(b);addVertex(d);addVertex(b);addVertex(c);addVertex(d);var nextIndex=verticesArray.length/3;var uvs=uvgen.generateSideWallUV(scope,verticesArray,nextIndex-6,nextIndex-3,nextIndex-2,nextIndex-1);addUV(uvs[0]);addUV(uvs[1]);addUV(uvs[3]);addUV(uvs[1]);addUV(uvs[2]);addUV(uvs[3]);}function addVertex(index){indicesArray.push(verticesArray.length/3);verticesArray.push(placeholder[index*3+0]);verticesArray.push(placeholder[index*3+1]);verticesArray.push(placeholder[index*3+2]);}function addUV(vector2){uvArray.push(vector2.x);uvArray.push(vector2.y);}if(!options.arrays){this.setIndex(indicesArray);this.addAttribute('position',new Float32BufferAttribute(verticesArray,3));this.addAttribute('uv',new Float32BufferAttribute(uvArray,2));}};ExtrudeGeometry.WorldUVGenerator={generateTopUV:function generateTopUV(geometry,vertices,indexA,indexB,indexC){var a_x=vertices[indexA*3];var a_y=vertices[indexA*3+1];var b_x=vertices[indexB*3];var b_y=vertices[indexB*3+1];var c_x=vertices[indexC*3];var c_y=vertices[indexC*3+1];return[new Vector2$1(a_x,a_y),new Vector2$1(b_x,b_y),new Vector2$1(c_x,c_y)];},generateSideWallUV:function generateSideWallUV(geometry,vertices,indexA,indexB,indexC,indexD){var a_x=vertices[indexA*3];var a_y=vertices[indexA*3+1];var a_z=vertices[indexA*3+2];var b_x=vertices[indexB*3];var b_y=vertices[indexB*3+1];var b_z=vertices[indexB*3+2];var c_x=vertices[indexC*3];var c_y=vertices[indexC*3+1];var c_z=vertices[indexC*3+2];var d_x=vertices[indexD*3];var d_y=vertices[indexD*3+1];var d_z=vertices[indexD*3+2];if(Math.abs(a_y-b_y)<0.01){return[new Vector2$1(a_x,1-a_z),new Vector2$1(b_x,1-b_z),new Vector2$1(c_x,1-c_z),new Vector2$1(d_x,1-d_z)];}else{return[new Vector2$1(a_y,1-a_z),new Vector2$1(b_y,1-b_z),new Vector2$1(c_y,1-c_z),new Vector2$1(d_y,1-d_z)];}}};/**
   * @author zz85 / http://www.lab4games.net/zz85/blog
   * @author alteredq / http://alteredqualia.com/
   *
   * Text = 3D Text
   *
   * parameters = {
   *  font: <THREE.Font>, // font
   *
   *  size: <float>, // size of the text
   *  height: <float>, // thickness to extrude text
   *  curveSegments: <int>, // number of points on the curves
   *
   *  bevelEnabled: <bool>, // turn on bevel
   *  bevelThickness: <float>, // how deep into text bevel goes
   *  bevelSize: <float> // how far from text outline is bevel
   * }
   */// TextGeometry
  function TextGeometry(text,parameters){Geometry.call(this);this.type='TextGeometry';this.parameters={text:text,parameters:parameters};this.fromBufferGeometry(new TextBufferGeometry(text,parameters));this.mergeVertices();}TextGeometry.prototype=Object.create(Geometry.prototype);TextGeometry.prototype.constructor=TextGeometry;// TextBufferGeometry
  function TextBufferGeometry(text,parameters){parameters=parameters||{};var font=parameters.font;if(!(font&&font.isFont)){console.error('THREE.TextGeometry: font parameter is not an instance of THREE.Font.');return new Geometry();}var shapes=font.generateShapes(text,parameters.size,parameters.curveSegments);// translate parameters to ExtrudeGeometry API
  parameters.amount=parameters.height!==undefined?parameters.height:50;// defaults
  if(parameters.bevelThickness===undefined){parameters.bevelThickness=10;}if(parameters.bevelSize===undefined){parameters.bevelSize=8;}if(parameters.bevelEnabled===undefined){parameters.bevelEnabled=false;}ExtrudeBufferGeometry.call(this,shapes,parameters);this.type='TextBufferGeometry';}TextBufferGeometry.prototype=Object.create(ExtrudeBufferGeometry.prototype);TextBufferGeometry.prototype.constructor=TextBufferGeometry;/**
   * @author mrdoob / http://mrdoob.com/
   * @author benaadams / https://twitter.com/ben_a_adams
   * @author Mugen87 / https://github.com/Mugen87
   */// SphereGeometry
  function SphereGeometry(radius,widthSegments,heightSegments,phiStart,phiLength,thetaStart,thetaLength){Geometry.call(this);this.type='SphereGeometry';this.parameters={radius:radius,widthSegments:widthSegments,heightSegments:heightSegments,phiStart:phiStart,phiLength:phiLength,thetaStart:thetaStart,thetaLength:thetaLength};this.fromBufferGeometry(new SphereBufferGeometry(radius,widthSegments,heightSegments,phiStart,phiLength,thetaStart,thetaLength));this.mergeVertices();}SphereGeometry.prototype=Object.create(Geometry.prototype);SphereGeometry.prototype.constructor=SphereGeometry;// SphereBufferGeometry
  function SphereBufferGeometry(radius,widthSegments,heightSegments,phiStart,phiLength,thetaStart,thetaLength){BufferGeometry.call(this);this.type='SphereBufferGeometry';this.parameters={radius:radius,widthSegments:widthSegments,heightSegments:heightSegments,phiStart:phiStart,phiLength:phiLength,thetaStart:thetaStart,thetaLength:thetaLength};radius=radius||1;widthSegments=Math.max(3,Math.floor(widthSegments)||8);heightSegments=Math.max(2,Math.floor(heightSegments)||6);phiStart=phiStart!==undefined?phiStart:0;phiLength=phiLength!==undefined?phiLength:Math.PI*2;thetaStart=thetaStart!==undefined?thetaStart:0;thetaLength=thetaLength!==undefined?thetaLength:Math.PI;var thetaEnd=thetaStart+thetaLength;var ix,iy;var index=0;var grid=[];var vertex=new Vector3$1();var normal=new Vector3$1();// buffers
  var indices=[];var vertices=[];var normals=[];var uvs=[];// generate vertices, normals and uvs
  for(iy=0;iy<=heightSegments;iy++){var verticesRow=[];var v=iy/heightSegments;for(ix=0;ix<=widthSegments;ix++){var u=ix/widthSegments;// vertex
  vertex.x=-radius*Math.cos(phiStart+u*phiLength)*Math.sin(thetaStart+v*thetaLength);vertex.y=radius*Math.cos(thetaStart+v*thetaLength);vertex.z=radius*Math.sin(phiStart+u*phiLength)*Math.sin(thetaStart+v*thetaLength);vertices.push(vertex.x,vertex.y,vertex.z);// normal
  normal.set(vertex.x,vertex.y,vertex.z).normalize();normals.push(normal.x,normal.y,normal.z);// uv
  uvs.push(u,1-v);verticesRow.push(index++);}grid.push(verticesRow);}// indices
  for(iy=0;iy<heightSegments;iy++){for(ix=0;ix<widthSegments;ix++){var a=grid[iy][ix+1];var b=grid[iy][ix];var c=grid[iy+1][ix];var d=grid[iy+1][ix+1];if(iy!==0||thetaStart>0){indices.push(a,b,d);}if(iy!==heightSegments-1||thetaEnd<Math.PI){indices.push(b,c,d);}}}// build geometry
  this.setIndex(indices);this.addAttribute('position',new Float32BufferAttribute(vertices,3));this.addAttribute('normal',new Float32BufferAttribute(normals,3));this.addAttribute('uv',new Float32BufferAttribute(uvs,2));}SphereBufferGeometry.prototype=Object.create(BufferGeometry.prototype);SphereBufferGeometry.prototype.constructor=SphereBufferGeometry;/**
   * @author Kaleb Murphy
   * @author Mugen87 / https://github.com/Mugen87
   */// RingGeometry
  function RingGeometry(innerRadius,outerRadius,thetaSegments,phiSegments,thetaStart,thetaLength){Geometry.call(this);this.type='RingGeometry';this.parameters={innerRadius:innerRadius,outerRadius:outerRadius,thetaSegments:thetaSegments,phiSegments:phiSegments,thetaStart:thetaStart,thetaLength:thetaLength};this.fromBufferGeometry(new RingBufferGeometry(innerRadius,outerRadius,thetaSegments,phiSegments,thetaStart,thetaLength));this.mergeVertices();}RingGeometry.prototype=Object.create(Geometry.prototype);RingGeometry.prototype.constructor=RingGeometry;// RingBufferGeometry
  function RingBufferGeometry(innerRadius,outerRadius,thetaSegments,phiSegments,thetaStart,thetaLength){BufferGeometry.call(this);this.type='RingBufferGeometry';this.parameters={innerRadius:innerRadius,outerRadius:outerRadius,thetaSegments:thetaSegments,phiSegments:phiSegments,thetaStart:thetaStart,thetaLength:thetaLength};innerRadius=innerRadius||0.5;outerRadius=outerRadius||1;thetaStart=thetaStart!==undefined?thetaStart:0;thetaLength=thetaLength!==undefined?thetaLength:Math.PI*2;thetaSegments=thetaSegments!==undefined?Math.max(3,thetaSegments):8;phiSegments=phiSegments!==undefined?Math.max(1,phiSegments):1;// buffers
  var indices=[];var vertices=[];var normals=[];var uvs=[];// some helper variables
  var segment;var radius=innerRadius;var radiusStep=(outerRadius-innerRadius)/phiSegments;var vertex=new Vector3$1();var uv=new Vector2$1();var j,i;// generate vertices, normals and uvs
  for(j=0;j<=phiSegments;j++){for(i=0;i<=thetaSegments;i++){// values are generate from the inside of the ring to the outside
  segment=thetaStart+i/thetaSegments*thetaLength;// vertex
  vertex.x=radius*Math.cos(segment);vertex.y=radius*Math.sin(segment);vertices.push(vertex.x,vertex.y,vertex.z);// normal
  normals.push(0,0,1);// uv
  uv.x=(vertex.x/outerRadius+1)/2;uv.y=(vertex.y/outerRadius+1)/2;uvs.push(uv.x,uv.y);}// increase the radius for next row of vertices
  radius+=radiusStep;}// indices
  for(j=0;j<phiSegments;j++){var thetaSegmentLevel=j*(thetaSegments+1);for(i=0;i<thetaSegments;i++){segment=i+thetaSegmentLevel;var a=segment;var b=segment+thetaSegments+1;var c=segment+thetaSegments+2;var d=segment+1;// faces
  indices.push(a,b,d);indices.push(b,c,d);}}// build geometry
  this.setIndex(indices);this.addAttribute('position',new Float32BufferAttribute(vertices,3));this.addAttribute('normal',new Float32BufferAttribute(normals,3));this.addAttribute('uv',new Float32BufferAttribute(uvs,2));}RingBufferGeometry.prototype=Object.create(BufferGeometry.prototype);RingBufferGeometry.prototype.constructor=RingBufferGeometry;/**
   * @author mrdoob / http://mrdoob.com/
   * @author Mugen87 / https://github.com/Mugen87
   */// PlaneGeometry
  function PlaneGeometry(width,height,widthSegments,heightSegments){Geometry.call(this);this.type='PlaneGeometry';this.parameters={width:width,height:height,widthSegments:widthSegments,heightSegments:heightSegments};this.fromBufferGeometry(new PlaneBufferGeometry(width,height,widthSegments,heightSegments));this.mergeVertices();}PlaneGeometry.prototype=Object.create(Geometry.prototype);PlaneGeometry.prototype.constructor=PlaneGeometry;// PlaneBufferGeometry
  function PlaneBufferGeometry(width,height,widthSegments,heightSegments){BufferGeometry.call(this);this.type='PlaneBufferGeometry';this.parameters={width:width,height:height,widthSegments:widthSegments,heightSegments:heightSegments};width=width||1;height=height||1;var width_half=width/2;var height_half=height/2;var gridX=Math.floor(widthSegments)||1;var gridY=Math.floor(heightSegments)||1;var gridX1=gridX+1;var gridY1=gridY+1;var segment_width=width/gridX;var segment_height=height/gridY;var ix,iy;// buffers
  var indices=[];var vertices=[];var normals=[];var uvs=[];// generate vertices, normals and uvs
  for(iy=0;iy<gridY1;iy++){var y=iy*segment_height-height_half;for(ix=0;ix<gridX1;ix++){var x=ix*segment_width-width_half;vertices.push(x,-y,0);normals.push(0,0,1);uvs.push(ix/gridX);uvs.push(1-iy/gridY);}}// indices
  for(iy=0;iy<gridY;iy++){for(ix=0;ix<gridX;ix++){var a=ix+gridX1*iy;var b=ix+gridX1*(iy+1);var c=ix+1+gridX1*(iy+1);var d=ix+1+gridX1*iy;// faces
  indices.push(a,b,d);indices.push(b,c,d);}}// build geometry
  this.setIndex(indices);this.addAttribute('position',new Float32BufferAttribute(vertices,3));this.addAttribute('normal',new Float32BufferAttribute(normals,3));this.addAttribute('uv',new Float32BufferAttribute(uvs,2));}PlaneBufferGeometry.prototype=Object.create(BufferGeometry.prototype);PlaneBufferGeometry.prototype.constructor=PlaneBufferGeometry;/**
   * @author astrodud / http://astrodud.isgreat.org/
   * @author zz85 / https://github.com/zz85
   * @author bhouston / http://clara.io
   * @author Mugen87 / https://github.com/Mugen87
   */// LatheGeometry
  function LatheGeometry(points,segments,phiStart,phiLength){Geometry.call(this);this.type='LatheGeometry';this.parameters={points:points,segments:segments,phiStart:phiStart,phiLength:phiLength};this.fromBufferGeometry(new LatheBufferGeometry(points,segments,phiStart,phiLength));this.mergeVertices();}LatheGeometry.prototype=Object.create(Geometry.prototype);LatheGeometry.prototype.constructor=LatheGeometry;// LatheBufferGeometry
  function LatheBufferGeometry(points,segments,phiStart,phiLength){BufferGeometry.call(this);this.type='LatheBufferGeometry';this.parameters={points:points,segments:segments,phiStart:phiStart,phiLength:phiLength};segments=Math.floor(segments)||12;phiStart=phiStart||0;phiLength=phiLength||Math.PI*2;// clamp phiLength so it's in range of [ 0, 2PI ]
  phiLength=_Math$1.clamp(phiLength,0,Math.PI*2);// buffers
  var indices=[];var vertices=[];var uvs=[];// helper variables
  var base;var inverseSegments=1.0/segments;var vertex=new Vector3$1();var uv=new Vector2$1();var i,j;// generate vertices and uvs
  for(i=0;i<=segments;i++){var phi=phiStart+i*inverseSegments*phiLength;var sin=Math.sin(phi);var cos=Math.cos(phi);for(j=0;j<=points.length-1;j++){// vertex
  vertex.x=points[j].x*sin;vertex.y=points[j].y;vertex.z=points[j].x*cos;vertices.push(vertex.x,vertex.y,vertex.z);// uv
  uv.x=i/segments;uv.y=j/(points.length-1);uvs.push(uv.x,uv.y);}}// indices
  for(i=0;i<segments;i++){for(j=0;j<points.length-1;j++){base=j+i*points.length;var a=base;var b=base+points.length;var c=base+points.length+1;var d=base+1;// faces
  indices.push(a,b,d);indices.push(b,c,d);}}// build geometry
  this.setIndex(indices);this.addAttribute('position',new Float32BufferAttribute(vertices,3));this.addAttribute('uv',new Float32BufferAttribute(uvs,2));// generate normals
  this.computeVertexNormals();// if the geometry is closed, we need to average the normals along the seam.
  // because the corresponding vertices are identical (but still have different UVs).
  if(phiLength===Math.PI*2){var normals=this.attributes.normal.array;var n1=new Vector3$1();var n2=new Vector3$1();var n=new Vector3$1();// this is the buffer offset for the last line of vertices
  base=segments*points.length*3;for(i=0, j=0;i<points.length;i++, j+=3){// select the normal of the vertex in the first line
  n1.x=normals[j+0];n1.y=normals[j+1];n1.z=normals[j+2];// select the normal of the vertex in the last line
  n2.x=normals[base+j+0];n2.y=normals[base+j+1];n2.z=normals[base+j+2];// average normals
  n.addVectors(n1,n2).normalize();// assign the new values to both normals
  normals[j+0]=normals[base+j+0]=n.x;normals[j+1]=normals[base+j+1]=n.y;normals[j+2]=normals[base+j+2]=n.z;}}}LatheBufferGeometry.prototype=Object.create(BufferGeometry.prototype);LatheBufferGeometry.prototype.constructor=LatheBufferGeometry;/**
   * @author jonobr1 / http://jonobr1.com
   * @author Mugen87 / https://github.com/Mugen87
   */// ShapeGeometry
  function ShapeGeometry(shapes,curveSegments){Geometry.call(this);this.type='ShapeGeometry';if((typeof curveSegments==='undefined'?'undefined':_typeof(curveSegments))==='object'){console.warn('THREE.ShapeGeometry: Options parameter has been removed.');curveSegments=curveSegments.curveSegments;}this.parameters={shapes:shapes,curveSegments:curveSegments};this.fromBufferGeometry(new ShapeBufferGeometry(shapes,curveSegments));this.mergeVertices();}ShapeGeometry.prototype=Object.create(Geometry.prototype);ShapeGeometry.prototype.constructor=ShapeGeometry;ShapeGeometry.prototype.toJSON=function(){var data=Geometry.prototype.toJSON.call(this);var shapes=this.parameters.shapes;return toJSON(shapes,data);};// ShapeBufferGeometry
  function ShapeBufferGeometry(shapes,curveSegments){var this$1=this;BufferGeometry.call(this);this.type='ShapeBufferGeometry';this.parameters={shapes:shapes,curveSegments:curveSegments};curveSegments=curveSegments||12;// buffers
  var indices=[];var vertices=[];var normals=[];var uvs=[];// helper variables
  var groupStart=0;var groupCount=0;// allow single and array values for "shapes" parameter
  if(Array.isArray(shapes)===false){addShape(shapes);}else{for(var i=0;i<shapes.length;i++){addShape(shapes[i]);this$1.addGroup(groupStart,groupCount,i);// enables MultiMaterial support
  groupStart+=groupCount;groupCount=0;}}// build geometry
  this.setIndex(indices);this.addAttribute('position',new Float32BufferAttribute(vertices,3));this.addAttribute('normal',new Float32BufferAttribute(normals,3));this.addAttribute('uv',new Float32BufferAttribute(uvs,2));// helper functions
  function addShape(shape){var i,l,shapeHole;var indexOffset=vertices.length/3;var points=shape.extractPoints(curveSegments);var shapeVertices=points.shape;var shapeHoles=points.holes;// check direction of vertices
  if(ShapeUtils.isClockWise(shapeVertices)===false){shapeVertices=shapeVertices.reverse();// also check if holes are in the opposite direction
  for(i=0, l=shapeHoles.length;i<l;i++){shapeHole=shapeHoles[i];if(ShapeUtils.isClockWise(shapeHole)===true){shapeHoles[i]=shapeHole.reverse();}}}var faces=ShapeUtils.triangulateShape(shapeVertices,shapeHoles);// join vertices of inner and outer paths to a single array
  for(i=0, l=shapeHoles.length;i<l;i++){shapeHole=shapeHoles[i];shapeVertices=shapeVertices.concat(shapeHole);}// vertices, normals, uvs
  for(i=0, l=shapeVertices.length;i<l;i++){var vertex=shapeVertices[i];vertices.push(vertex.x,vertex.y,0);normals.push(0,0,1);uvs.push(vertex.x,vertex.y);// world uvs
  }// incides
  for(i=0, l=faces.length;i<l;i++){var face=faces[i];var a=face[0]+indexOffset;var b=face[1]+indexOffset;var c=face[2]+indexOffset;indices.push(a,b,c);groupCount+=3;}}}ShapeBufferGeometry.prototype=Object.create(BufferGeometry.prototype);ShapeBufferGeometry.prototype.constructor=ShapeBufferGeometry;ShapeBufferGeometry.prototype.toJSON=function(){var data=BufferGeometry.prototype.toJSON.call(this);var shapes=this.parameters.shapes;return toJSON(shapes,data);};//
  function toJSON(shapes,data){data.shapes=[];if(Array.isArray(shapes)){for(var i=0,l=shapes.length;i<l;i++){var shape=shapes[i];data.shapes.push(shape.uuid);}}else{data.shapes.push(shapes.uuid);}return data;}/**
   * @author WestLangley / http://github.com/WestLangley
   * @author Mugen87 / https://github.com/Mugen87
   */function EdgesGeometry(geometry,thresholdAngle){BufferGeometry.call(this);this.type='EdgesGeometry';this.parameters={thresholdAngle:thresholdAngle};thresholdAngle=thresholdAngle!==undefined?thresholdAngle:1;// buffer
  var vertices=[];// helper variables
  var thresholdDot=Math.cos(_Math$1.DEG2RAD*thresholdAngle);var edge=[0,0],edges={},edge1,edge2;var key,keys=['a','b','c'];// prepare source geometry
  var geometry2;if(geometry.isBufferGeometry){geometry2=new Geometry();geometry2.fromBufferGeometry(geometry);}else{geometry2=geometry.clone();}geometry2.mergeVertices();geometry2.computeFaceNormals();var sourceVertices=geometry2.vertices;var faces=geometry2.faces;// now create a data structure where each entry represents an edge with its adjoining faces
  for(var i=0,l=faces.length;i<l;i++){var face=faces[i];for(var j=0;j<3;j++){edge1=face[keys[j]];edge2=face[keys[(j+1)%3]];edge[0]=Math.min(edge1,edge2);edge[1]=Math.max(edge1,edge2);key=edge[0]+','+edge[1];if(edges[key]===undefined){edges[key]={index1:edge[0],index2:edge[1],face1:i,face2:undefined};}else{edges[key].face2=i;}}}// generate vertices
  for(key in edges){var e=edges[key];// an edge is only rendered if the angle (in degrees) between the face normals of the adjoining faces exceeds this value. default = 1 degree.
  if(e.face2===undefined||faces[e.face1].normal.dot(faces[e.face2].normal)<=thresholdDot){var vertex=sourceVertices[e.index1];vertices.push(vertex.x,vertex.y,vertex.z);vertex=sourceVertices[e.index2];vertices.push(vertex.x,vertex.y,vertex.z);}}// build geometry
  this.addAttribute('position',new Float32BufferAttribute(vertices,3));}EdgesGeometry.prototype=Object.create(BufferGeometry.prototype);EdgesGeometry.prototype.constructor=EdgesGeometry;/**
   * @author mrdoob / http://mrdoob.com/
   * @author Mugen87 / https://github.com/Mugen87
   */// CylinderGeometry
  function CylinderGeometry(radiusTop,radiusBottom,height,radialSegments,heightSegments,openEnded,thetaStart,thetaLength){Geometry.call(this);this.type='CylinderGeometry';this.parameters={radiusTop:radiusTop,radiusBottom:radiusBottom,height:height,radialSegments:radialSegments,heightSegments:heightSegments,openEnded:openEnded,thetaStart:thetaStart,thetaLength:thetaLength};this.fromBufferGeometry(new CylinderBufferGeometry(radiusTop,radiusBottom,height,radialSegments,heightSegments,openEnded,thetaStart,thetaLength));this.mergeVertices();}CylinderGeometry.prototype=Object.create(Geometry.prototype);CylinderGeometry.prototype.constructor=CylinderGeometry;// CylinderBufferGeometry
  function CylinderBufferGeometry(radiusTop,radiusBottom,height,radialSegments,heightSegments,openEnded,thetaStart,thetaLength){BufferGeometry.call(this);this.type='CylinderBufferGeometry';this.parameters={radiusTop:radiusTop,radiusBottom:radiusBottom,height:height,radialSegments:radialSegments,heightSegments:heightSegments,openEnded:openEnded,thetaStart:thetaStart,thetaLength:thetaLength};var scope=this;radiusTop=radiusTop!==undefined?radiusTop:1;radiusBottom=radiusBottom!==undefined?radiusBottom:1;height=height||1;radialSegments=Math.floor(radialSegments)||8;heightSegments=Math.floor(heightSegments)||1;openEnded=openEnded!==undefined?openEnded:false;thetaStart=thetaStart!==undefined?thetaStart:0.0;thetaLength=thetaLength!==undefined?thetaLength:Math.PI*2;// buffers
  var indices=[];var vertices=[];var normals=[];var uvs=[];// helper variables
  var index=0;var indexArray=[];var halfHeight=height/2;var groupStart=0;// generate geometry
  generateTorso();if(openEnded===false){if(radiusTop>0){generateCap(true);}if(radiusBottom>0){generateCap(false);}}// build geometry
  this.setIndex(indices);this.addAttribute('position',new Float32BufferAttribute(vertices,3));this.addAttribute('normal',new Float32BufferAttribute(normals,3));this.addAttribute('uv',new Float32BufferAttribute(uvs,2));function generateTorso(){var x,y;var normal=new Vector3$1();var vertex=new Vector3$1();var groupCount=0;// this will be used to calculate the normal
  var slope=(radiusBottom-radiusTop)/height;// generate vertices, normals and uvs
  for(y=0;y<=heightSegments;y++){var indexRow=[];var v=y/heightSegments;// calculate the radius of the current row
  var radius=v*(radiusBottom-radiusTop)+radiusTop;for(x=0;x<=radialSegments;x++){var u=x/radialSegments;var theta=u*thetaLength+thetaStart;var sinTheta=Math.sin(theta);var cosTheta=Math.cos(theta);// vertex
  vertex.x=radius*sinTheta;vertex.y=-v*height+halfHeight;vertex.z=radius*cosTheta;vertices.push(vertex.x,vertex.y,vertex.z);// normal
  normal.set(sinTheta,slope,cosTheta).normalize();normals.push(normal.x,normal.y,normal.z);// uv
  uvs.push(u,1-v);// save index of vertex in respective row
  indexRow.push(index++);}// now save vertices of the row in our index array
  indexArray.push(indexRow);}// generate indices
  for(x=0;x<radialSegments;x++){for(y=0;y<heightSegments;y++){// we use the index array to access the correct indices
  var a=indexArray[y][x];var b=indexArray[y+1][x];var c=indexArray[y+1][x+1];var d=indexArray[y][x+1];// faces
  indices.push(a,b,d);indices.push(b,c,d);// update group counter
  groupCount+=6;}}// add a group to the geometry. this will ensure multi material support
  scope.addGroup(groupStart,groupCount,0);// calculate new start value for groups
  groupStart+=groupCount;}function generateCap(top){var x,centerIndexStart,centerIndexEnd;var uv=new Vector2$1();var vertex=new Vector3$1();var groupCount=0;var radius=top===true?radiusTop:radiusBottom;var sign=top===true?1:-1;// save the index of the first center vertex
  centerIndexStart=index;// first we generate the center vertex data of the cap.
  // because the geometry needs one set of uvs per face,
  // we must generate a center vertex per face/segment
  for(x=1;x<=radialSegments;x++){// vertex
  vertices.push(0,halfHeight*sign,0);// normal
  normals.push(0,sign,0);// uv
  uvs.push(0.5,0.5);// increase index
  index++;}// save the index of the last center vertex
  centerIndexEnd=index;// now we generate the surrounding vertices, normals and uvs
  for(x=0;x<=radialSegments;x++){var u=x/radialSegments;var theta=u*thetaLength+thetaStart;var cosTheta=Math.cos(theta);var sinTheta=Math.sin(theta);// vertex
  vertex.x=radius*sinTheta;vertex.y=halfHeight*sign;vertex.z=radius*cosTheta;vertices.push(vertex.x,vertex.y,vertex.z);// normal
  normals.push(0,sign,0);// uv
  uv.x=cosTheta*0.5+0.5;uv.y=sinTheta*0.5*sign+0.5;uvs.push(uv.x,uv.y);// increase index
  index++;}// generate indices
  for(x=0;x<radialSegments;x++){var c=centerIndexStart+x;var i=centerIndexEnd+x;if(top===true){// face top
  indices.push(i,i+1,c);}else{// face bottom
  indices.push(i+1,i,c);}groupCount+=3;}// add a group to the geometry. this will ensure multi material support
  scope.addGroup(groupStart,groupCount,top===true?1:2);// calculate new start value for groups
  groupStart+=groupCount;}}CylinderBufferGeometry.prototype=Object.create(BufferGeometry.prototype);CylinderBufferGeometry.prototype.constructor=CylinderBufferGeometry;/**
   * @author abelnation / http://github.com/abelnation
   */// ConeGeometry
  function ConeGeometry(radius,height,radialSegments,heightSegments,openEnded,thetaStart,thetaLength){CylinderGeometry.call(this,0,radius,height,radialSegments,heightSegments,openEnded,thetaStart,thetaLength);this.type='ConeGeometry';this.parameters={radius:radius,height:height,radialSegments:radialSegments,heightSegments:heightSegments,openEnded:openEnded,thetaStart:thetaStart,thetaLength:thetaLength};}ConeGeometry.prototype=Object.create(CylinderGeometry.prototype);ConeGeometry.prototype.constructor=ConeGeometry;// ConeBufferGeometry
  function ConeBufferGeometry(radius,height,radialSegments,heightSegments,openEnded,thetaStart,thetaLength){CylinderBufferGeometry.call(this,0,radius,height,radialSegments,heightSegments,openEnded,thetaStart,thetaLength);this.type='ConeBufferGeometry';this.parameters={radius:radius,height:height,radialSegments:radialSegments,heightSegments:heightSegments,openEnded:openEnded,thetaStart:thetaStart,thetaLength:thetaLength};}ConeBufferGeometry.prototype=Object.create(CylinderBufferGeometry.prototype);ConeBufferGeometry.prototype.constructor=ConeBufferGeometry;/**
   * @author benaadams / https://twitter.com/ben_a_adams
   * @author Mugen87 / https://github.com/Mugen87
   * @author hughes
   */// CircleGeometry
  function CircleGeometry(radius,segments,thetaStart,thetaLength){Geometry.call(this);this.type='CircleGeometry';this.parameters={radius:radius,segments:segments,thetaStart:thetaStart,thetaLength:thetaLength};this.fromBufferGeometry(new CircleBufferGeometry(radius,segments,thetaStart,thetaLength));this.mergeVertices();}CircleGeometry.prototype=Object.create(Geometry.prototype);CircleGeometry.prototype.constructor=CircleGeometry;// CircleBufferGeometry
  function CircleBufferGeometry(radius,segments,thetaStart,thetaLength){BufferGeometry.call(this);this.type='CircleBufferGeometry';this.parameters={radius:radius,segments:segments,thetaStart:thetaStart,thetaLength:thetaLength};radius=radius||1;segments=segments!==undefined?Math.max(3,segments):8;thetaStart=thetaStart!==undefined?thetaStart:0;thetaLength=thetaLength!==undefined?thetaLength:Math.PI*2;// buffers
  var indices=[];var vertices=[];var normals=[];var uvs=[];// helper variables
  var i,s;var vertex=new Vector3$1();var uv=new Vector2$1();// center point
  vertices.push(0,0,0);normals.push(0,0,1);uvs.push(0.5,0.5);for(s=0, i=3;s<=segments;s++, i+=3){var segment=thetaStart+s/segments*thetaLength;// vertex
  vertex.x=radius*Math.cos(segment);vertex.y=radius*Math.sin(segment);vertices.push(vertex.x,vertex.y,vertex.z);// normal
  normals.push(0,0,1);// uvs
  uv.x=(vertices[i]/radius+1)/2;uv.y=(vertices[i+1]/radius+1)/2;uvs.push(uv.x,uv.y);}// indices
  for(i=1;i<=segments;i++){indices.push(i,i+1,0);}// build geometry
  this.setIndex(indices);this.addAttribute('position',new Float32BufferAttribute(vertices,3));this.addAttribute('normal',new Float32BufferAttribute(normals,3));this.addAttribute('uv',new Float32BufferAttribute(uvs,2));}CircleBufferGeometry.prototype=Object.create(BufferGeometry.prototype);CircleBufferGeometry.prototype.constructor=CircleBufferGeometry;/**
   * @author mrdoob / http://mrdoob.com/
   * @author Mugen87 / https://github.com/Mugen87
   */// BoxGeometry
  function BoxGeometry(width,height,depth,widthSegments,heightSegments,depthSegments){Geometry.call(this);this.type='BoxGeometry';this.parameters={width:width,height:height,depth:depth,widthSegments:widthSegments,heightSegments:heightSegments,depthSegments:depthSegments};this.fromBufferGeometry(new BoxBufferGeometry(width,height,depth,widthSegments,heightSegments,depthSegments));this.mergeVertices();}BoxGeometry.prototype=Object.create(Geometry.prototype);BoxGeometry.prototype.constructor=BoxGeometry;// BoxBufferGeometry
  function BoxBufferGeometry(width,height,depth,widthSegments,heightSegments,depthSegments){BufferGeometry.call(this);this.type='BoxBufferGeometry';this.parameters={width:width,height:height,depth:depth,widthSegments:widthSegments,heightSegments:heightSegments,depthSegments:depthSegments};var scope=this;width=width||1;height=height||1;depth=depth||1;// segments
  widthSegments=Math.floor(widthSegments)||1;heightSegments=Math.floor(heightSegments)||1;depthSegments=Math.floor(depthSegments)||1;// buffers
  var indices=[];var vertices=[];var normals=[];var uvs=[];// helper variables
  var numberOfVertices=0;var groupStart=0;// build each side of the box geometry
  buildPlane('z','y','x',-1,-1,depth,height,width,depthSegments,heightSegments,0);// px
  buildPlane('z','y','x',1,-1,depth,height,-width,depthSegments,heightSegments,1);// nx
  buildPlane('x','z','y',1,1,width,depth,height,widthSegments,depthSegments,2);// py
  buildPlane('x','z','y',1,-1,width,depth,-height,widthSegments,depthSegments,3);// ny
  buildPlane('x','y','z',1,-1,width,height,depth,widthSegments,heightSegments,4);// pz
  buildPlane('x','y','z',-1,-1,width,height,-depth,widthSegments,heightSegments,5);// nz
  // build geometry
  this.setIndex(indices);this.addAttribute('position',new Float32BufferAttribute(vertices,3));this.addAttribute('normal',new Float32BufferAttribute(normals,3));this.addAttribute('uv',new Float32BufferAttribute(uvs,2));function buildPlane(u,v,w,udir,vdir,width,height,depth,gridX,gridY,materialIndex){var segmentWidth=width/gridX;var segmentHeight=height/gridY;var widthHalf=width/2;var heightHalf=height/2;var depthHalf=depth/2;var gridX1=gridX+1;var gridY1=gridY+1;var vertexCounter=0;var groupCount=0;var ix,iy;var vector=new Vector3$1();// generate vertices, normals and uvs
  for(iy=0;iy<gridY1;iy++){var y=iy*segmentHeight-heightHalf;for(ix=0;ix<gridX1;ix++){var x=ix*segmentWidth-widthHalf;// set values to correct vector component
  vector[u]=x*udir;vector[v]=y*vdir;vector[w]=depthHalf;// now apply vector to vertex buffer
  vertices.push(vector.x,vector.y,vector.z);// set values to correct vector component
  vector[u]=0;vector[v]=0;vector[w]=depth>0?1:-1;// now apply vector to normal buffer
  normals.push(vector.x,vector.y,vector.z);// uvs
  uvs.push(ix/gridX);uvs.push(1-iy/gridY);// counters
  vertexCounter+=1;}}// indices
  // 1. you need three indices to draw a single face
  // 2. a single segment consists of two faces
  // 3. so we need to generate six (2*3) indices per segment
  for(iy=0;iy<gridY;iy++){for(ix=0;ix<gridX;ix++){var a=numberOfVertices+ix+gridX1*iy;var b=numberOfVertices+ix+gridX1*(iy+1);var c=numberOfVertices+(ix+1)+gridX1*(iy+1);var d=numberOfVertices+(ix+1)+gridX1*iy;// faces
  indices.push(a,b,d);indices.push(b,c,d);// increase counter
  groupCount+=6;}}// add a group to the geometry. this will ensure multi material support
  scope.addGroup(groupStart,groupCount,materialIndex);// calculate new start value for groups
  groupStart+=groupCount;// update total number of vertices
  numberOfVertices+=vertexCounter;}}BoxBufferGeometry.prototype=Object.create(BufferGeometry.prototype);BoxBufferGeometry.prototype.constructor=BoxBufferGeometry;var Geometries=Object.freeze({WireframeGeometry:WireframeGeometry,ParametricGeometry:ParametricGeometry,ParametricBufferGeometry:ParametricBufferGeometry,TetrahedronGeometry:TetrahedronGeometry,TetrahedronBufferGeometry:TetrahedronBufferGeometry,OctahedronGeometry:OctahedronGeometry,OctahedronBufferGeometry:OctahedronBufferGeometry,IcosahedronGeometry:IcosahedronGeometry,IcosahedronBufferGeometry:IcosahedronBufferGeometry,DodecahedronGeometry:DodecahedronGeometry,DodecahedronBufferGeometry:DodecahedronBufferGeometry,PolyhedronGeometry:PolyhedronGeometry,PolyhedronBufferGeometry:PolyhedronBufferGeometry,TubeGeometry:TubeGeometry,TubeBufferGeometry:TubeBufferGeometry,TorusKnotGeometry:TorusKnotGeometry,TorusKnotBufferGeometry:TorusKnotBufferGeometry,TorusGeometry:TorusGeometry,TorusBufferGeometry:TorusBufferGeometry,TextGeometry:TextGeometry,TextBufferGeometry:TextBufferGeometry,SphereGeometry:SphereGeometry,SphereBufferGeometry:SphereBufferGeometry,RingGeometry:RingGeometry,RingBufferGeometry:RingBufferGeometry,PlaneGeometry:PlaneGeometry,PlaneBufferGeometry:PlaneBufferGeometry,LatheGeometry:LatheGeometry,LatheBufferGeometry:LatheBufferGeometry,ShapeGeometry:ShapeGeometry,ShapeBufferGeometry:ShapeBufferGeometry,ExtrudeGeometry:ExtrudeGeometry,ExtrudeBufferGeometry:ExtrudeBufferGeometry,EdgesGeometry:EdgesGeometry,ConeGeometry:ConeGeometry,ConeBufferGeometry:ConeBufferGeometry,CylinderGeometry:CylinderGeometry,CylinderBufferGeometry:CylinderBufferGeometry,CircleGeometry:CircleGeometry,CircleBufferGeometry:CircleBufferGeometry,BoxGeometry:BoxGeometry,BoxBufferGeometry:BoxBufferGeometry});var REVISION='89';var MOUSE={LEFT:0,MIDDLE:1,RIGHT:2};var CullFaceNone=0;var CullFaceBack=1;var CullFaceFront=2;var FrontFaceDirectionCW=0;var PCFShadowMap=1;var PCFSoftShadowMap=2;var FrontSide=0;var BackSide=1;var DoubleSide=2;var FlatShading=1;var NoColors=0;var FaceColors=1;var VertexColors=2;var NoBlending=0;var NormalBlending=1;var AdditiveBlending=2;var SubtractiveBlending=3;var MultiplyBlending=4;var CustomBlending=5;var AddEquation=100;var SubtractEquation=101;var ReverseSubtractEquation=102;var MinEquation=103;var MaxEquation=104;var ZeroFactor=200;var OneFactor=201;var SrcColorFactor=202;var OneMinusSrcColorFactor=203;var SrcAlphaFactor=204;var OneMinusSrcAlphaFactor=205;var DstAlphaFactor=206;var OneMinusDstAlphaFactor=207;var DstColorFactor=208;var OneMinusDstColorFactor=209;var SrcAlphaSaturateFactor=210;var NeverDepth=0;var AlwaysDepth=1;var LessDepth=2;var LessEqualDepth=3;var EqualDepth=4;var GreaterEqualDepth=5;var GreaterDepth=6;var NotEqualDepth=7;var MultiplyOperation=0;var MixOperation=1;var AddOperation=2;var NoToneMapping=0;var LinearToneMapping=1;var ReinhardToneMapping=2;var Uncharted2ToneMapping=3;var CineonToneMapping=4;var UVMapping=300;var CubeReflectionMapping=301;var CubeRefractionMapping=302;var EquirectangularReflectionMapping=303;var EquirectangularRefractionMapping=304;var SphericalReflectionMapping=305;var CubeUVReflectionMapping=306;var CubeUVRefractionMapping=307;var RepeatWrapping=1000;var ClampToEdgeWrapping=1001;var MirroredRepeatWrapping=1002;var NearestFilter=1003;var NearestMipMapNearestFilter=1004;var NearestMipMapLinearFilter=1005;var LinearFilter=1006;var LinearMipMapNearestFilter=1007;var LinearMipMapLinearFilter=1008;var UnsignedByteType=1009;var ByteType=1010;var ShortType=1011;var UnsignedShortType=1012;var IntType=1013;var UnsignedIntType=1014;var FloatType=1015;var HalfFloatType=1016;var UnsignedShort4444Type=1017;var UnsignedShort5551Type=1018;var UnsignedShort565Type=1019;var UnsignedInt248Type=1020;var AlphaFormat=1021;var RGBFormat=1022;var RGBAFormat=1023;var LuminanceFormat=1024;var LuminanceAlphaFormat=1025;var RGBEFormat=RGBAFormat;var DepthFormat=1026;var DepthStencilFormat=1027;var RGB_S3TC_DXT1_Format=2001;var RGBA_S3TC_DXT1_Format=2002;var RGBA_S3TC_DXT3_Format=2003;var RGBA_S3TC_DXT5_Format=2004;var RGB_PVRTC_4BPPV1_Format=2100;var RGB_PVRTC_2BPPV1_Format=2101;var RGBA_PVRTC_4BPPV1_Format=2102;var RGBA_PVRTC_2BPPV1_Format=2103;var RGB_ETC1_Format=2151;var LoopOnce=2200;var LoopRepeat=2201;var LoopPingPong=2202;var InterpolateDiscrete=2300;var InterpolateLinear=2301;var InterpolateSmooth=2302;var ZeroCurvatureEnding=2400;var ZeroSlopeEnding=2401;var WrapAroundEnding=2402;var TrianglesDrawMode=0;var TriangleStripDrawMode=1;var TriangleFanDrawMode=2;var LinearEncoding=3000;var sRGBEncoding=3001;var GammaEncoding=3007;var RGBEEncoding=3002;var RGBM7Encoding=3004;var RGBM16Encoding=3005;var RGBDEncoding=3006;var BasicDepthPacking=3200;var RGBADepthPacking=3201;/**
   * @author mrdoob / http://mrdoob.com/
   * @author alteredq / http://alteredqualia.com/
   */var materialId=0;function Material(){Object.defineProperty(this,'id',{value:materialId++});this.uuid=_Math$1.generateUUID();this.name='';this.type='Material';this.fog=true;this.lights=true;this.blending=NormalBlending;this.side=FrontSide;this.flatShading=false;this.vertexColors=NoColors;// THREE.NoColors, THREE.VertexColors, THREE.FaceColors
  this.opacity=1;this.transparent=false;this.blendSrc=SrcAlphaFactor;this.blendDst=OneMinusSrcAlphaFactor;this.blendEquation=AddEquation;this.blendSrcAlpha=null;this.blendDstAlpha=null;this.blendEquationAlpha=null;this.depthFunc=LessEqualDepth;this.depthTest=true;this.depthWrite=true;this.clippingPlanes=null;this.clipIntersection=false;this.clipShadows=false;this.colorWrite=true;this.precision=null;// override the renderer's default precision for this material
  this.polygonOffset=false;this.polygonOffsetFactor=0;this.polygonOffsetUnits=0;this.dithering=false;this.alphaTest=0;this.premultipliedAlpha=false;this.overdraw=0;// Overdrawn pixels (typically between 0 and 1) for fixing antialiasing gaps in CanvasRenderer
  this.visible=true;this.userData={};this.needsUpdate=true;}Material.prototype=Object.assign(Object.create(EventDispatcher.prototype),{constructor:Material,isMaterial:true,onBeforeCompile:function onBeforeCompile(){},setValues:function setValues(values){var this$1=this;if(values===undefined){return;}for(var key in values){var newValue=values[key];if(newValue===undefined){console.warn("THREE.Material: '"+key+"' parameter is undefined.");continue;}// for backward compatability if shading is set in the constructor
  if(key==='shading'){console.warn('THREE.'+this$1.type+': .shading has been removed. Use the boolean .flatShading instead.');this$1.flatShading=newValue===FlatShading?true:false;continue;}var currentValue=this$1[key];if(currentValue===undefined){console.warn("THREE."+this$1.type+": '"+key+"' is not a property of this material.");continue;}if(currentValue&&currentValue.isColor){currentValue.set(newValue);}else if(currentValue&&currentValue.isVector3&&newValue&&newValue.isVector3){currentValue.copy(newValue);}else if(key==='overdraw'){// ensure overdraw is backwards-compatible with legacy boolean type
  this$1[key]=Number(newValue);}else{this$1[key]=newValue;}}},toJSON:function toJSON(meta){var isRoot=meta===undefined||typeof meta==='string';if(isRoot){meta={textures:{},images:{}};}var data={metadata:{version:4.5,type:'Material',generator:'Material.toJSON'}};// standard Material serialization
  data.uuid=this.uuid;data.type=this.type;if(this.name!==''){data.name=this.name;}if(this.color&&this.color.isColor){data.color=this.color.getHex();}if(this.roughness!==undefined){data.roughness=this.roughness;}if(this.metalness!==undefined){data.metalness=this.metalness;}if(this.emissive&&this.emissive.isColor){data.emissive=this.emissive.getHex();}if(this.emissiveIntensity!==1){data.emissiveIntensity=this.emissiveIntensity;}if(this.specular&&this.specular.isColor){data.specular=this.specular.getHex();}if(this.shininess!==undefined){data.shininess=this.shininess;}if(this.clearCoat!==undefined){data.clearCoat=this.clearCoat;}if(this.clearCoatRoughness!==undefined){data.clearCoatRoughness=this.clearCoatRoughness;}if(this.map&&this.map.isTexture){data.map=this.map.toJSON(meta).uuid;}if(this.alphaMap&&this.alphaMap.isTexture){data.alphaMap=this.alphaMap.toJSON(meta).uuid;}if(this.lightMap&&this.lightMap.isTexture){data.lightMap=this.lightMap.toJSON(meta).uuid;}if(this.bumpMap&&this.bumpMap.isTexture){data.bumpMap=this.bumpMap.toJSON(meta).uuid;data.bumpScale=this.bumpScale;}if(this.normalMap&&this.normalMap.isTexture){data.normalMap=this.normalMap.toJSON(meta).uuid;data.normalScale=this.normalScale.toArray();}if(this.displacementMap&&this.displacementMap.isTexture){data.displacementMap=this.displacementMap.toJSON(meta).uuid;data.displacementScale=this.displacementScale;data.displacementBias=this.displacementBias;}if(this.roughnessMap&&this.roughnessMap.isTexture){data.roughnessMap=this.roughnessMap.toJSON(meta).uuid;}if(this.metalnessMap&&this.metalnessMap.isTexture){data.metalnessMap=this.metalnessMap.toJSON(meta).uuid;}if(this.emissiveMap&&this.emissiveMap.isTexture){data.emissiveMap=this.emissiveMap.toJSON(meta).uuid;}if(this.specularMap&&this.specularMap.isTexture){data.specularMap=this.specularMap.toJSON(meta).uuid;}if(this.envMap&&this.envMap.isTexture){data.envMap=this.envMap.toJSON(meta).uuid;data.reflectivity=this.reflectivity;// Scale behind envMap
  }if(this.gradientMap&&this.gradientMap.isTexture){data.gradientMap=this.gradientMap.toJSON(meta).uuid;}if(this.size!==undefined){data.size=this.size;}if(this.sizeAttenuation!==undefined){data.sizeAttenuation=this.sizeAttenuation;}if(this.blending!==NormalBlending){data.blending=this.blending;}if(this.flatShading===true){data.flatShading=this.flatShading;}if(this.side!==FrontSide){data.side=this.side;}if(this.vertexColors!==NoColors){data.vertexColors=this.vertexColors;}if(this.opacity<1){data.opacity=this.opacity;}if(this.transparent===true){data.transparent=this.transparent;}data.depthFunc=this.depthFunc;data.depthTest=this.depthTest;data.depthWrite=this.depthWrite;// rotation (SpriteMaterial)
  if(this.rotation!==0){data.rotation=this.rotation;}if(this.linewidth!==1){data.linewidth=this.linewidth;}if(this.dashSize!==undefined){data.dashSize=this.dashSize;}if(this.gapSize!==undefined){data.gapSize=this.gapSize;}if(this.scale!==undefined){data.scale=this.scale;}if(this.dithering===true){data.dithering=true;}if(this.alphaTest>0){data.alphaTest=this.alphaTest;}if(this.premultipliedAlpha===true){data.premultipliedAlpha=this.premultipliedAlpha;}if(this.wireframe===true){data.wireframe=this.wireframe;}if(this.wireframeLinewidth>1){data.wireframeLinewidth=this.wireframeLinewidth;}if(this.wireframeLinecap!=='round'){data.wireframeLinecap=this.wireframeLinecap;}if(this.wireframeLinejoin!=='round'){data.wireframeLinejoin=this.wireframeLinejoin;}if(this.morphTargets===true){data.morphTargets=true;}if(this.skinning===true){data.skinning=true;}if(this.visible===false){data.visible=false;}if(JSON.stringify(this.userData)!=='{}'){data.userData=this.userData;}// TODO: Copied from Object3D.toJSON
  function extractFromCache(cache){var values=[];for(var key in cache){var data=cache[key];delete data.metadata;values.push(data);}return values;}if(isRoot){var textures=extractFromCache(meta.textures);var images=extractFromCache(meta.images);if(textures.length>0){data.textures=textures;}if(images.length>0){data.images=images;}}return data;},clone:function clone(){return new this.constructor().copy(this);},copy:function copy(source){this.name=source.name;this.fog=source.fog;this.lights=source.lights;this.blending=source.blending;this.side=source.side;this.flatShading=source.flatShading;this.vertexColors=source.vertexColors;this.opacity=source.opacity;this.transparent=source.transparent;this.blendSrc=source.blendSrc;this.blendDst=source.blendDst;this.blendEquation=source.blendEquation;this.blendSrcAlpha=source.blendSrcAlpha;this.blendDstAlpha=source.blendDstAlpha;this.blendEquationAlpha=source.blendEquationAlpha;this.depthFunc=source.depthFunc;this.depthTest=source.depthTest;this.depthWrite=source.depthWrite;this.colorWrite=source.colorWrite;this.precision=source.precision;this.polygonOffset=source.polygonOffset;this.polygonOffsetFactor=source.polygonOffsetFactor;this.polygonOffsetUnits=source.polygonOffsetUnits;this.dithering=source.dithering;this.alphaTest=source.alphaTest;this.premultipliedAlpha=source.premultipliedAlpha;this.overdraw=source.overdraw;this.visible=source.visible;this.userData=JSON.parse(JSON.stringify(source.userData));this.clipShadows=source.clipShadows;this.clipIntersection=source.clipIntersection;var srcPlanes=source.clippingPlanes,dstPlanes=null;if(srcPlanes!==null){var n=srcPlanes.length;dstPlanes=new Array(n);for(var i=0;i!==n;++i){dstPlanes[i]=srcPlanes[i].clone();}}this.clippingPlanes=dstPlanes;return this;},dispose:function dispose(){this.dispatchEvent({type:'dispose'});}});/**
   * @author mrdoob / http://mrdoob.com/
   *
   * parameters = {
   *  color: <THREE.Color>,
   *  opacity: <float>
   * }
   */function ShadowMaterial(parameters){Material.call(this);this.type='ShadowMaterial';this.color=new Color$1(0x000000);this.opacity=1.0;this.lights=true;this.transparent=true;this.setValues(parameters);}ShadowMaterial.prototype=Object.create(Material.prototype);ShadowMaterial.prototype.constructor=ShadowMaterial;ShadowMaterial.prototype.isShadowMaterial=true;/**
   * @author alteredq / http://alteredqualia.com/
   *
   * parameters = {
   *  color: <hex>,
   *  opacity: <float>,
   *  map: new THREE.Texture( <Image> ),
   *
   *	uvOffset: new THREE.Vector2(),
   *	uvScale: new THREE.Vector2()
   * }
   */function SpriteMaterial(parameters){Material.call(this);this.type='SpriteMaterial';this.color=new Color$1(0xffffff);this.map=null;this.rotation=0;this.fog=false;this.lights=false;this.setValues(parameters);}SpriteMaterial.prototype=Object.create(Material.prototype);SpriteMaterial.prototype.constructor=SpriteMaterial;SpriteMaterial.prototype.isSpriteMaterial=true;SpriteMaterial.prototype.copy=function(source){Material.prototype.copy.call(this,source);this.color.copy(source.color);this.map=source.map;this.rotation=source.rotation;return this;};/**
   * Uniform Utilities
   */var UniformsUtils={merge:function merge(uniforms){var this$1=this;var merged={};for(var u=0;u<uniforms.length;u++){var tmp=this$1.clone(uniforms[u]);for(var p in tmp){merged[p]=tmp[p];}}return merged;},clone:function clone(uniforms_src){var uniforms_dst={};for(var u in uniforms_src){uniforms_dst[u]={};for(var p in uniforms_src[u]){var parameter_src=uniforms_src[u][p];if(parameter_src&&(parameter_src.isColor||parameter_src.isMatrix3||parameter_src.isMatrix4||parameter_src.isVector2||parameter_src.isVector3||parameter_src.isVector4||parameter_src.isTexture)){uniforms_dst[u][p]=parameter_src.clone();}else if(Array.isArray(parameter_src)){uniforms_dst[u][p]=parameter_src.slice();}else{uniforms_dst[u][p]=parameter_src;}}}return uniforms_dst;}};/**
   * @author alteredq / http://alteredqualia.com/
   *
   * parameters = {
   *  defines: { "label" : "value" },
   *  uniforms: { "parameter1": { value: 1.0 }, "parameter2": { value2: 2 } },
   *
   *  fragmentShader: <string>,
   *  vertexShader: <string>,
   *
   *  wireframe: <boolean>,
   *  wireframeLinewidth: <float>,
   *
   *  lights: <bool>,
   *
   *  skinning: <bool>,
   *  morphTargets: <bool>,
   *  morphNormals: <bool>
   * }
   */function ShaderMaterial(parameters){Material.call(this);this.type='ShaderMaterial';this.defines={};this.uniforms={};this.vertexShader='void main() {\n\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n}';this.fragmentShader='void main() {\n\tgl_FragColor = vec4( 1.0, 0.0, 0.0, 1.0 );\n}';this.linewidth=1;this.wireframe=false;this.wireframeLinewidth=1;this.fog=false;// set to use scene fog
  this.lights=false;// set to use scene lights
  this.clipping=false;// set to use user-defined clipping planes
  this.skinning=false;// set to use skinning attribute streams
  this.morphTargets=false;// set to use morph targets
  this.morphNormals=false;// set to use morph normals
  this.extensions={derivatives:false,// set to use derivatives
  fragDepth:false,// set to use fragment depth values
  drawBuffers:false,// set to use draw buffers
  shaderTextureLOD:false// set to use shader texture LOD
  };// When rendered geometry doesn't include these attributes but the material does,
  // use these default values in WebGL. This avoids errors when buffer data is missing.
  this.defaultAttributeValues={'color':[1,1,1],'uv':[0,0],'uv2':[0,0]};this.index0AttributeName=undefined;if(parameters!==undefined){if(parameters.attributes!==undefined){console.error('THREE.ShaderMaterial: attributes should now be defined in THREE.BufferGeometry instead.');}this.setValues(parameters);}}ShaderMaterial.prototype=Object.create(Material.prototype);ShaderMaterial.prototype.constructor=ShaderMaterial;ShaderMaterial.prototype.isShaderMaterial=true;ShaderMaterial.prototype.copy=function(source){Material.prototype.copy.call(this,source);this.fragmentShader=source.fragmentShader;this.vertexShader=source.vertexShader;this.uniforms=UniformsUtils.clone(source.uniforms);this.defines=source.defines;this.wireframe=source.wireframe;this.wireframeLinewidth=source.wireframeLinewidth;this.lights=source.lights;this.clipping=source.clipping;this.skinning=source.skinning;this.morphTargets=source.morphTargets;this.morphNormals=source.morphNormals;this.extensions=source.extensions;return this;};ShaderMaterial.prototype.toJSON=function(meta){var data=Material.prototype.toJSON.call(this,meta);data.uniforms=this.uniforms;data.vertexShader=this.vertexShader;data.fragmentShader=this.fragmentShader;return data;};/**
   * @author mrdoob / http://mrdoob.com/
   */function RawShaderMaterial(parameters){ShaderMaterial.call(this,parameters);this.type='RawShaderMaterial';}RawShaderMaterial.prototype=Object.create(ShaderMaterial.prototype);RawShaderMaterial.prototype.constructor=RawShaderMaterial;RawShaderMaterial.prototype.isRawShaderMaterial=true;/**
   * @author mrdoob / http://mrdoob.com/
   * @author alteredq / http://alteredqualia.com/
   *
   * parameters = {
   *  color: <hex>,
   *  opacity: <float>,
   *  map: new THREE.Texture( <Image> ),
   *
   *  size: <float>,
   *  sizeAttenuation: <bool>
   * }
   */function PointsMaterial(parameters){Material.call(this);this.type='PointsMaterial';this.color=new Color$1(0xffffff);this.map=null;this.size=1;this.sizeAttenuation=true;this.lights=false;this.setValues(parameters);}PointsMaterial.prototype=Object.create(Material.prototype);PointsMaterial.prototype.constructor=PointsMaterial;PointsMaterial.prototype.isPointsMaterial=true;PointsMaterial.prototype.copy=function(source){Material.prototype.copy.call(this,source);this.color.copy(source.color);this.map=source.map;this.size=source.size;this.sizeAttenuation=source.sizeAttenuation;return this;};/**
   * @author WestLangley / http://github.com/WestLangley
   *
   * parameters = {
   *  color: <hex>,
   *  roughness: <float>,
   *  metalness: <float>,
   *  opacity: <float>,
   *
   *  map: new THREE.Texture( <Image> ),
   *
   *  lightMap: new THREE.Texture( <Image> ),
   *  lightMapIntensity: <float>
   *
   *  aoMap: new THREE.Texture( <Image> ),
   *  aoMapIntensity: <float>
   *
   *  emissive: <hex>,
   *  emissiveIntensity: <float>
   *  emissiveMap: new THREE.Texture( <Image> ),
   *
   *  bumpMap: new THREE.Texture( <Image> ),
   *  bumpScale: <float>,
   *
   *  normalMap: new THREE.Texture( <Image> ),
   *  normalScale: <Vector2>,
   *
   *  displacementMap: new THREE.Texture( <Image> ),
   *  displacementScale: <float>,
   *  displacementBias: <float>,
   *
   *  roughnessMap: new THREE.Texture( <Image> ),
   *
   *  metalnessMap: new THREE.Texture( <Image> ),
   *
   *  alphaMap: new THREE.Texture( <Image> ),
   *
   *  envMap: new THREE.CubeTexture( [posx, negx, posy, negy, posz, negz] ),
   *  envMapIntensity: <float>
   *
   *  refractionRatio: <float>,
   *
   *  wireframe: <boolean>,
   *  wireframeLinewidth: <float>,
   *
   *  skinning: <bool>,
   *  morphTargets: <bool>,
   *  morphNormals: <bool>
   * }
   */function MeshStandardMaterial(parameters){Material.call(this);this.defines={'STANDARD':''};this.type='MeshStandardMaterial';this.color=new Color$1(0xffffff);// diffuse
  this.roughness=0.5;this.metalness=0.5;this.map=null;this.lightMap=null;this.lightMapIntensity=1.0;this.aoMap=null;this.aoMapIntensity=1.0;this.emissive=new Color$1(0x000000);this.emissiveIntensity=1.0;this.emissiveMap=null;this.bumpMap=null;this.bumpScale=1;this.normalMap=null;this.normalScale=new Vector2$1(1,1);this.displacementMap=null;this.displacementScale=1;this.displacementBias=0;this.roughnessMap=null;this.metalnessMap=null;this.alphaMap=null;this.envMap=null;this.envMapIntensity=1.0;this.refractionRatio=0.98;this.wireframe=false;this.wireframeLinewidth=1;this.wireframeLinecap='round';this.wireframeLinejoin='round';this.skinning=false;this.morphTargets=false;this.morphNormals=false;this.setValues(parameters);}MeshStandardMaterial.prototype=Object.create(Material.prototype);MeshStandardMaterial.prototype.constructor=MeshStandardMaterial;MeshStandardMaterial.prototype.isMeshStandardMaterial=true;MeshStandardMaterial.prototype.copy=function(source){Material.prototype.copy.call(this,source);this.defines={'STANDARD':''};this.color.copy(source.color);this.roughness=source.roughness;this.metalness=source.metalness;this.map=source.map;this.lightMap=source.lightMap;this.lightMapIntensity=source.lightMapIntensity;this.aoMap=source.aoMap;this.aoMapIntensity=source.aoMapIntensity;this.emissive.copy(source.emissive);this.emissiveMap=source.emissiveMap;this.emissiveIntensity=source.emissiveIntensity;this.bumpMap=source.bumpMap;this.bumpScale=source.bumpScale;this.normalMap=source.normalMap;this.normalScale.copy(source.normalScale);this.displacementMap=source.displacementMap;this.displacementScale=source.displacementScale;this.displacementBias=source.displacementBias;this.roughnessMap=source.roughnessMap;this.metalnessMap=source.metalnessMap;this.alphaMap=source.alphaMap;this.envMap=source.envMap;this.envMapIntensity=source.envMapIntensity;this.refractionRatio=source.refractionRatio;this.wireframe=source.wireframe;this.wireframeLinewidth=source.wireframeLinewidth;this.wireframeLinecap=source.wireframeLinecap;this.wireframeLinejoin=source.wireframeLinejoin;this.skinning=source.skinning;this.morphTargets=source.morphTargets;this.morphNormals=source.morphNormals;return this;};/**
   * @author WestLangley / http://github.com/WestLangley
   *
   * parameters = {
   *  reflectivity: <float>
   * }
   */function MeshPhysicalMaterial(parameters){MeshStandardMaterial.call(this);this.defines={'PHYSICAL':''};this.type='MeshPhysicalMaterial';this.reflectivity=0.5;// maps to F0 = 0.04
  this.clearCoat=0.0;this.clearCoatRoughness=0.0;this.setValues(parameters);}MeshPhysicalMaterial.prototype=Object.create(MeshStandardMaterial.prototype);MeshPhysicalMaterial.prototype.constructor=MeshPhysicalMaterial;MeshPhysicalMaterial.prototype.isMeshPhysicalMaterial=true;MeshPhysicalMaterial.prototype.copy=function(source){MeshStandardMaterial.prototype.copy.call(this,source);this.defines={'PHYSICAL':''};this.reflectivity=source.reflectivity;this.clearCoat=source.clearCoat;this.clearCoatRoughness=source.clearCoatRoughness;return this;};/**
   * @author mrdoob / http://mrdoob.com/
   * @author alteredq / http://alteredqualia.com/
   *
   * parameters = {
   *  color: <hex>,
   *  specular: <hex>,
   *  shininess: <float>,
   *  opacity: <float>,
   *
   *  map: new THREE.Texture( <Image> ),
   *
   *  lightMap: new THREE.Texture( <Image> ),
   *  lightMapIntensity: <float>
   *
   *  aoMap: new THREE.Texture( <Image> ),
   *  aoMapIntensity: <float>
   *
   *  emissive: <hex>,
   *  emissiveIntensity: <float>
   *  emissiveMap: new THREE.Texture( <Image> ),
   *
   *  bumpMap: new THREE.Texture( <Image> ),
   *  bumpScale: <float>,
   *
   *  normalMap: new THREE.Texture( <Image> ),
   *  normalScale: <Vector2>,
   *
   *  displacementMap: new THREE.Texture( <Image> ),
   *  displacementScale: <float>,
   *  displacementBias: <float>,
   *
   *  specularMap: new THREE.Texture( <Image> ),
   *
   *  alphaMap: new THREE.Texture( <Image> ),
   *
   *  envMap: new THREE.TextureCube( [posx, negx, posy, negy, posz, negz] ),
   *  combine: THREE.Multiply,
   *  reflectivity: <float>,
   *  refractionRatio: <float>,
   *
   *  wireframe: <boolean>,
   *  wireframeLinewidth: <float>,
   *
   *  skinning: <bool>,
   *  morphTargets: <bool>,
   *  morphNormals: <bool>
   * }
   */function MeshPhongMaterial(parameters){Material.call(this);this.type='MeshPhongMaterial';this.color=new Color$1(0xffffff);// diffuse
  this.specular=new Color$1(0x111111);this.shininess=30;this.map=null;this.lightMap=null;this.lightMapIntensity=1.0;this.aoMap=null;this.aoMapIntensity=1.0;this.emissive=new Color$1(0x000000);this.emissiveIntensity=1.0;this.emissiveMap=null;this.bumpMap=null;this.bumpScale=1;this.normalMap=null;this.normalScale=new Vector2$1(1,1);this.displacementMap=null;this.displacementScale=1;this.displacementBias=0;this.specularMap=null;this.alphaMap=null;this.envMap=null;this.combine=MultiplyOperation;this.reflectivity=1;this.refractionRatio=0.98;this.wireframe=false;this.wireframeLinewidth=1;this.wireframeLinecap='round';this.wireframeLinejoin='round';this.skinning=false;this.morphTargets=false;this.morphNormals=false;this.setValues(parameters);}MeshPhongMaterial.prototype=Object.create(Material.prototype);MeshPhongMaterial.prototype.constructor=MeshPhongMaterial;MeshPhongMaterial.prototype.isMeshPhongMaterial=true;MeshPhongMaterial.prototype.copy=function(source){Material.prototype.copy.call(this,source);this.color.copy(source.color);this.specular.copy(source.specular);this.shininess=source.shininess;this.map=source.map;this.lightMap=source.lightMap;this.lightMapIntensity=source.lightMapIntensity;this.aoMap=source.aoMap;this.aoMapIntensity=source.aoMapIntensity;this.emissive.copy(source.emissive);this.emissiveMap=source.emissiveMap;this.emissiveIntensity=source.emissiveIntensity;this.bumpMap=source.bumpMap;this.bumpScale=source.bumpScale;this.normalMap=source.normalMap;this.normalScale.copy(source.normalScale);this.displacementMap=source.displacementMap;this.displacementScale=source.displacementScale;this.displacementBias=source.displacementBias;this.specularMap=source.specularMap;this.alphaMap=source.alphaMap;this.envMap=source.envMap;this.combine=source.combine;this.reflectivity=source.reflectivity;this.refractionRatio=source.refractionRatio;this.wireframe=source.wireframe;this.wireframeLinewidth=source.wireframeLinewidth;this.wireframeLinecap=source.wireframeLinecap;this.wireframeLinejoin=source.wireframeLinejoin;this.skinning=source.skinning;this.morphTargets=source.morphTargets;this.morphNormals=source.morphNormals;return this;};/**
   * @author takahirox / http://github.com/takahirox
   *
   * parameters = {
   *  gradientMap: new THREE.Texture( <Image> )
   * }
   */function MeshToonMaterial(parameters){MeshPhongMaterial.call(this);this.defines={'TOON':''};this.type='MeshToonMaterial';this.gradientMap=null;this.setValues(parameters);}MeshToonMaterial.prototype=Object.create(MeshPhongMaterial.prototype);MeshToonMaterial.prototype.constructor=MeshToonMaterial;MeshToonMaterial.prototype.isMeshToonMaterial=true;MeshToonMaterial.prototype.copy=function(source){MeshPhongMaterial.prototype.copy.call(this,source);this.gradientMap=source.gradientMap;return this;};/**
   * @author mrdoob / http://mrdoob.com/
   * @author WestLangley / http://github.com/WestLangley
   *
   * parameters = {
   *  opacity: <float>,
   *
   *  bumpMap: new THREE.Texture( <Image> ),
   *  bumpScale: <float>,
   *
   *  normalMap: new THREE.Texture( <Image> ),
   *  normalScale: <Vector2>,
   *
   *  displacementMap: new THREE.Texture( <Image> ),
   *  displacementScale: <float>,
   *  displacementBias: <float>,
   *
   *  wireframe: <boolean>,
   *  wireframeLinewidth: <float>
   *
   *  skinning: <bool>,
   *  morphTargets: <bool>,
   *  morphNormals: <bool>
   * }
   */function MeshNormalMaterial(parameters){Material.call(this);this.type='MeshNormalMaterial';this.bumpMap=null;this.bumpScale=1;this.normalMap=null;this.normalScale=new Vector2$1(1,1);this.displacementMap=null;this.displacementScale=1;this.displacementBias=0;this.wireframe=false;this.wireframeLinewidth=1;this.fog=false;this.lights=false;this.skinning=false;this.morphTargets=false;this.morphNormals=false;this.setValues(parameters);}MeshNormalMaterial.prototype=Object.create(Material.prototype);MeshNormalMaterial.prototype.constructor=MeshNormalMaterial;MeshNormalMaterial.prototype.isMeshNormalMaterial=true;MeshNormalMaterial.prototype.copy=function(source){Material.prototype.copy.call(this,source);this.bumpMap=source.bumpMap;this.bumpScale=source.bumpScale;this.normalMap=source.normalMap;this.normalScale.copy(source.normalScale);this.displacementMap=source.displacementMap;this.displacementScale=source.displacementScale;this.displacementBias=source.displacementBias;this.wireframe=source.wireframe;this.wireframeLinewidth=source.wireframeLinewidth;this.skinning=source.skinning;this.morphTargets=source.morphTargets;this.morphNormals=source.morphNormals;return this;};/**
   * @author mrdoob / http://mrdoob.com/
   * @author alteredq / http://alteredqualia.com/
   *
   * parameters = {
   *  color: <hex>,
   *  opacity: <float>,
   *
   *  map: new THREE.Texture( <Image> ),
   *
   *  lightMap: new THREE.Texture( <Image> ),
   *  lightMapIntensity: <float>
   *
   *  aoMap: new THREE.Texture( <Image> ),
   *  aoMapIntensity: <float>
   *
   *  emissive: <hex>,
   *  emissiveIntensity: <float>
   *  emissiveMap: new THREE.Texture( <Image> ),
   *
   *  specularMap: new THREE.Texture( <Image> ),
   *
   *  alphaMap: new THREE.Texture( <Image> ),
   *
   *  envMap: new THREE.TextureCube( [posx, negx, posy, negy, posz, negz] ),
   *  combine: THREE.Multiply,
   *  reflectivity: <float>,
   *  refractionRatio: <float>,
   *
   *  wireframe: <boolean>,
   *  wireframeLinewidth: <float>,
   *
   *  skinning: <bool>,
   *  morphTargets: <bool>,
   *  morphNormals: <bool>
   * }
   */function MeshLambertMaterial$1(parameters){Material.call(this);this.type='MeshLambertMaterial';this.color=new Color$1(0xffffff);// diffuse
  this.map=null;this.lightMap=null;this.lightMapIntensity=1.0;this.aoMap=null;this.aoMapIntensity=1.0;this.emissive=new Color$1(0x000000);this.emissiveIntensity=1.0;this.emissiveMap=null;this.specularMap=null;this.alphaMap=null;this.envMap=null;this.combine=MultiplyOperation;this.reflectivity=1;this.refractionRatio=0.98;this.wireframe=false;this.wireframeLinewidth=1;this.wireframeLinecap='round';this.wireframeLinejoin='round';this.skinning=false;this.morphTargets=false;this.morphNormals=false;this.setValues(parameters);}MeshLambertMaterial$1.prototype=Object.create(Material.prototype);MeshLambertMaterial$1.prototype.constructor=MeshLambertMaterial$1;MeshLambertMaterial$1.prototype.isMeshLambertMaterial=true;MeshLambertMaterial$1.prototype.copy=function(source){Material.prototype.copy.call(this,source);this.color.copy(source.color);this.map=source.map;this.lightMap=source.lightMap;this.lightMapIntensity=source.lightMapIntensity;this.aoMap=source.aoMap;this.aoMapIntensity=source.aoMapIntensity;this.emissive.copy(source.emissive);this.emissiveMap=source.emissiveMap;this.emissiveIntensity=source.emissiveIntensity;this.specularMap=source.specularMap;this.alphaMap=source.alphaMap;this.envMap=source.envMap;this.combine=source.combine;this.reflectivity=source.reflectivity;this.refractionRatio=source.refractionRatio;this.wireframe=source.wireframe;this.wireframeLinewidth=source.wireframeLinewidth;this.wireframeLinecap=source.wireframeLinecap;this.wireframeLinejoin=source.wireframeLinejoin;this.skinning=source.skinning;this.morphTargets=source.morphTargets;this.morphNormals=source.morphNormals;return this;};/**
   * @author mrdoob / http://mrdoob.com/
   * @author alteredq / http://alteredqualia.com/
   * @author bhouston / https://clara.io
   * @author WestLangley / http://github.com/WestLangley
   *
   * parameters = {
   *
   *  opacity: <float>,
   *
   *  map: new THREE.Texture( <Image> ),
   *
   *  alphaMap: new THREE.Texture( <Image> ),
   *
   *  displacementMap: new THREE.Texture( <Image> ),
   *  displacementScale: <float>,
   *  displacementBias: <float>,
   *
   *  wireframe: <boolean>,
   *  wireframeLinewidth: <float>
   * }
   */function MeshDepthMaterial(parameters){Material.call(this);this.type='MeshDepthMaterial';this.depthPacking=BasicDepthPacking;this.skinning=false;this.morphTargets=false;this.map=null;this.alphaMap=null;this.displacementMap=null;this.displacementScale=1;this.displacementBias=0;this.wireframe=false;this.wireframeLinewidth=1;this.fog=false;this.lights=false;this.setValues(parameters);}MeshDepthMaterial.prototype=Object.create(Material.prototype);MeshDepthMaterial.prototype.constructor=MeshDepthMaterial;MeshDepthMaterial.prototype.isMeshDepthMaterial=true;MeshDepthMaterial.prototype.copy=function(source){Material.prototype.copy.call(this,source);this.depthPacking=source.depthPacking;this.skinning=source.skinning;this.morphTargets=source.morphTargets;this.map=source.map;this.alphaMap=source.alphaMap;this.displacementMap=source.displacementMap;this.displacementScale=source.displacementScale;this.displacementBias=source.displacementBias;this.wireframe=source.wireframe;this.wireframeLinewidth=source.wireframeLinewidth;return this;};/**
   * @author WestLangley / http://github.com/WestLangley
   *
   * parameters = {
   *
   *  referencePosition: <float>,
   *  nearDistance: <float>,
   *  farDistance: <float>,
   *
   *  skinning: <bool>,
   *  morphTargets: <bool>,
   *
   *  map: new THREE.Texture( <Image> ),
   *
   *  alphaMap: new THREE.Texture( <Image> ),
   *
   *  displacementMap: new THREE.Texture( <Image> ),
   *  displacementScale: <float>,
   *  displacementBias: <float>
   *
   * }
   */function MeshDistanceMaterial(parameters){Material.call(this);this.type='MeshDistanceMaterial';this.referencePosition=new Vector3$1();this.nearDistance=1;this.farDistance=1000;this.skinning=false;this.morphTargets=false;this.map=null;this.alphaMap=null;this.displacementMap=null;this.displacementScale=1;this.displacementBias=0;this.fog=false;this.lights=false;this.setValues(parameters);}MeshDistanceMaterial.prototype=Object.create(Material.prototype);MeshDistanceMaterial.prototype.constructor=MeshDistanceMaterial;MeshDistanceMaterial.prototype.isMeshDistanceMaterial=true;MeshDistanceMaterial.prototype.copy=function(source){Material.prototype.copy.call(this,source);this.referencePosition.copy(source.referencePosition);this.nearDistance=source.nearDistance;this.farDistance=source.farDistance;this.skinning=source.skinning;this.morphTargets=source.morphTargets;this.map=source.map;this.alphaMap=source.alphaMap;this.displacementMap=source.displacementMap;this.displacementScale=source.displacementScale;this.displacementBias=source.displacementBias;return this;};/**
   * @author mrdoob / http://mrdoob.com/
   * @author alteredq / http://alteredqualia.com/
   *
   * parameters = {
   *  color: <hex>,
   *  opacity: <float>,
   *  map: new THREE.Texture( <Image> ),
   *
   *  lightMap: new THREE.Texture( <Image> ),
   *  lightMapIntensity: <float>
   *
   *  aoMap: new THREE.Texture( <Image> ),
   *  aoMapIntensity: <float>
   *
   *  specularMap: new THREE.Texture( <Image> ),
   *
   *  alphaMap: new THREE.Texture( <Image> ),
   *
   *  envMap: new THREE.TextureCube( [posx, negx, posy, negy, posz, negz] ),
   *  combine: THREE.Multiply,
   *  reflectivity: <float>,
   *  refractionRatio: <float>,
   *
   *  depthTest: <bool>,
   *  depthWrite: <bool>,
   *
   *  wireframe: <boolean>,
   *  wireframeLinewidth: <float>,
   *
   *  skinning: <bool>,
   *  morphTargets: <bool>
   * }
   */function MeshBasicMaterial(parameters){Material.call(this);this.type='MeshBasicMaterial';this.color=new Color$1(0xffffff);// emissive
  this.map=null;this.lightMap=null;this.lightMapIntensity=1.0;this.aoMap=null;this.aoMapIntensity=1.0;this.specularMap=null;this.alphaMap=null;this.envMap=null;this.combine=MultiplyOperation;this.reflectivity=1;this.refractionRatio=0.98;this.wireframe=false;this.wireframeLinewidth=1;this.wireframeLinecap='round';this.wireframeLinejoin='round';this.skinning=false;this.morphTargets=false;this.lights=false;this.setValues(parameters);}MeshBasicMaterial.prototype=Object.create(Material.prototype);MeshBasicMaterial.prototype.constructor=MeshBasicMaterial;MeshBasicMaterial.prototype.isMeshBasicMaterial=true;MeshBasicMaterial.prototype.copy=function(source){Material.prototype.copy.call(this,source);this.color.copy(source.color);this.map=source.map;this.lightMap=source.lightMap;this.lightMapIntensity=source.lightMapIntensity;this.aoMap=source.aoMap;this.aoMapIntensity=source.aoMapIntensity;this.specularMap=source.specularMap;this.alphaMap=source.alphaMap;this.envMap=source.envMap;this.combine=source.combine;this.reflectivity=source.reflectivity;this.refractionRatio=source.refractionRatio;this.wireframe=source.wireframe;this.wireframeLinewidth=source.wireframeLinewidth;this.wireframeLinecap=source.wireframeLinecap;this.wireframeLinejoin=source.wireframeLinejoin;this.skinning=source.skinning;this.morphTargets=source.morphTargets;return this;};/**
   * @author mrdoob / http://mrdoob.com/
   * @author alteredq / http://alteredqualia.com/
   *
   * parameters = {
   *  color: <hex>,
   *  opacity: <float>,
   *
   *  linewidth: <float>,
   *  linecap: "round",
   *  linejoin: "round"
   * }
   */function LineBasicMaterial$1(parameters){Material.call(this);this.type='LineBasicMaterial';this.color=new Color$1(0xffffff);this.linewidth=1;this.linecap='round';this.linejoin='round';this.lights=false;this.setValues(parameters);}LineBasicMaterial$1.prototype=Object.create(Material.prototype);LineBasicMaterial$1.prototype.constructor=LineBasicMaterial$1;LineBasicMaterial$1.prototype.isLineBasicMaterial=true;LineBasicMaterial$1.prototype.copy=function(source){Material.prototype.copy.call(this,source);this.color.copy(source.color);this.linewidth=source.linewidth;this.linecap=source.linecap;this.linejoin=source.linejoin;return this;};/**
   * @author alteredq / http://alteredqualia.com/
   *
   * parameters = {
   *  color: <hex>,
   *  opacity: <float>,
   *
   *  linewidth: <float>,
   *
   *  scale: <float>,
   *  dashSize: <float>,
   *  gapSize: <float>
   * }
   */function LineDashedMaterial(parameters){LineBasicMaterial$1.call(this);this.type='LineDashedMaterial';this.scale=1;this.dashSize=3;this.gapSize=1;this.setValues(parameters);}LineDashedMaterial.prototype=Object.create(LineBasicMaterial$1.prototype);LineDashedMaterial.prototype.constructor=LineDashedMaterial;LineDashedMaterial.prototype.isLineDashedMaterial=true;LineDashedMaterial.prototype.copy=function(source){LineBasicMaterial$1.prototype.copy.call(this,source);this.scale=source.scale;this.dashSize=source.dashSize;this.gapSize=source.gapSize;return this;};var Materials=Object.freeze({ShadowMaterial:ShadowMaterial,SpriteMaterial:SpriteMaterial,RawShaderMaterial:RawShaderMaterial,ShaderMaterial:ShaderMaterial,PointsMaterial:PointsMaterial,MeshPhysicalMaterial:MeshPhysicalMaterial,MeshStandardMaterial:MeshStandardMaterial,MeshPhongMaterial:MeshPhongMaterial,MeshToonMaterial:MeshToonMaterial,MeshNormalMaterial:MeshNormalMaterial,MeshLambertMaterial:MeshLambertMaterial$1,MeshDepthMaterial:MeshDepthMaterial,MeshDistanceMaterial:MeshDistanceMaterial,MeshBasicMaterial:MeshBasicMaterial,LineDashedMaterial:LineDashedMaterial,LineBasicMaterial:LineBasicMaterial$1,Material:Material});/**
   * @author bhouston / http://clara.io
   */function Ray(origin,direction){this.origin=origin!==undefined?origin:new Vector3$1();this.direction=direction!==undefined?direction:new Vector3$1();}Object.assign(Ray.prototype,{set:function set$$1(origin,direction){this.origin.copy(origin);this.direction.copy(direction);return this;},clone:function clone(){return new this.constructor().copy(this);},copy:function copy(ray){this.origin.copy(ray.origin);this.direction.copy(ray.direction);return this;},at:function at(t,optionalTarget){var result=optionalTarget||new Vector3$1();return result.copy(this.direction).multiplyScalar(t).add(this.origin);},lookAt:function lookAt(v){this.direction.copy(v).sub(this.origin).normalize();return this;},recast:function(){var v1=new Vector3$1();return function recast(t){this.origin.copy(this.at(t,v1));return this;};}(),closestPointToPoint:function closestPointToPoint(point,optionalTarget){var result=optionalTarget||new Vector3$1();result.subVectors(point,this.origin);var directionDistance=result.dot(this.direction);if(directionDistance<0){return result.copy(this.origin);}return result.copy(this.direction).multiplyScalar(directionDistance).add(this.origin);},distanceToPoint:function distanceToPoint(point){return Math.sqrt(this.distanceSqToPoint(point));},distanceSqToPoint:function(){var v1=new Vector3$1();return function distanceSqToPoint(point){var directionDistance=v1.subVectors(point,this.origin).dot(this.direction);// point behind the ray
  if(directionDistance<0){return this.origin.distanceToSquared(point);}v1.copy(this.direction).multiplyScalar(directionDistance).add(this.origin);return v1.distanceToSquared(point);};}(),distanceSqToSegment:function(){var segCenter=new Vector3$1();var segDir=new Vector3$1();var diff=new Vector3$1();return function distanceSqToSegment(v0,v1,optionalPointOnRay,optionalPointOnSegment){// from http://www.geometrictools.com/GTEngine/Include/Mathematics/GteDistRaySegment.h
  // It returns the min distance between the ray and the segment
  // defined by v0 and v1
  // It can also set two optional targets :
  // - The closest point on the ray
  // - The closest point on the segment
  segCenter.copy(v0).add(v1).multiplyScalar(0.5);segDir.copy(v1).sub(v0).normalize();diff.copy(this.origin).sub(segCenter);var segExtent=v0.distanceTo(v1)*0.5;var a01=-this.direction.dot(segDir);var b0=diff.dot(this.direction);var b1=-diff.dot(segDir);var c=diff.lengthSq();var det=Math.abs(1-a01*a01);var s0,s1,sqrDist,extDet;if(det>0){// The ray and segment are not parallel.
  s0=a01*b1-b0;s1=a01*b0-b1;extDet=segExtent*det;if(s0>=0){if(s1>=-extDet){if(s1<=extDet){// region 0
  // Minimum at interior points of ray and segment.
  var invDet=1/det;s0*=invDet;s1*=invDet;sqrDist=s0*(s0+a01*s1+2*b0)+s1*(a01*s0+s1+2*b1)+c;}else{// region 1
  s1=segExtent;s0=Math.max(0,-(a01*s1+b0));sqrDist=-s0*s0+s1*(s1+2*b1)+c;}}else{// region 5
  s1=-segExtent;s0=Math.max(0,-(a01*s1+b0));sqrDist=-s0*s0+s1*(s1+2*b1)+c;}}else{if(s1<=-extDet){// region 4
  s0=Math.max(0,-(-a01*segExtent+b0));s1=s0>0?-segExtent:Math.min(Math.max(-segExtent,-b1),segExtent);sqrDist=-s0*s0+s1*(s1+2*b1)+c;}else if(s1<=extDet){// region 3
  s0=0;s1=Math.min(Math.max(-segExtent,-b1),segExtent);sqrDist=s1*(s1+2*b1)+c;}else{// region 2
  s0=Math.max(0,-(a01*segExtent+b0));s1=s0>0?segExtent:Math.min(Math.max(-segExtent,-b1),segExtent);sqrDist=-s0*s0+s1*(s1+2*b1)+c;}}}else{// Ray and segment are parallel.
  s1=a01>0?-segExtent:segExtent;s0=Math.max(0,-(a01*s1+b0));sqrDist=-s0*s0+s1*(s1+2*b1)+c;}if(optionalPointOnRay){optionalPointOnRay.copy(this.direction).multiplyScalar(s0).add(this.origin);}if(optionalPointOnSegment){optionalPointOnSegment.copy(segDir).multiplyScalar(s1).add(segCenter);}return sqrDist;};}(),intersectSphere:function(){var v1=new Vector3$1();return function intersectSphere(sphere,optionalTarget){v1.subVectors(sphere.center,this.origin);var tca=v1.dot(this.direction);var d2=v1.dot(v1)-tca*tca;var radius2=sphere.radius*sphere.radius;if(d2>radius2){return null;}var thc=Math.sqrt(radius2-d2);// t0 = first intersect point - entrance on front of sphere
  var t0=tca-thc;// t1 = second intersect point - exit point on back of sphere
  var t1=tca+thc;// test to see if both t0 and t1 are behind the ray - if so, return null
  if(t0<0&&t1<0){return null;}// test to see if t0 is behind the ray:
  // if it is, the ray is inside the sphere, so return the second exit point scaled by t1,
  // in order to always return an intersect point that is in front of the ray.
  if(t0<0){return this.at(t1,optionalTarget);}// else t0 is in front of the ray, so return the first collision point scaled by t0
  return this.at(t0,optionalTarget);};}(),intersectsSphere:function intersectsSphere(sphere){return this.distanceToPoint(sphere.center)<=sphere.radius;},distanceToPlane:function distanceToPlane(plane){var denominator=plane.normal.dot(this.direction);if(denominator===0){// line is coplanar, return origin
  if(plane.distanceToPoint(this.origin)===0){return 0;}// Null is preferable to undefined since undefined means.... it is undefined
  return null;}var t=-(this.origin.dot(plane.normal)+plane.constant)/denominator;// Return if the ray never intersects the plane
  return t>=0?t:null;},intersectPlane:function intersectPlane(plane,optionalTarget){var t=this.distanceToPlane(plane);if(t===null){return null;}return this.at(t,optionalTarget);},intersectsPlane:function intersectsPlane(plane){// check if the ray lies on the plane first
  var distToPoint=plane.distanceToPoint(this.origin);if(distToPoint===0){return true;}var denominator=plane.normal.dot(this.direction);if(denominator*distToPoint<0){return true;}// ray origin is behind the plane (and is pointing behind it)
  return false;},intersectBox:function intersectBox(box,optionalTarget){var tmin,tmax,tymin,tymax,tzmin,tzmax;var invdirx=1/this.direction.x,invdiry=1/this.direction.y,invdirz=1/this.direction.z;var origin=this.origin;if(invdirx>=0){tmin=(box.min.x-origin.x)*invdirx;tmax=(box.max.x-origin.x)*invdirx;}else{tmin=(box.max.x-origin.x)*invdirx;tmax=(box.min.x-origin.x)*invdirx;}if(invdiry>=0){tymin=(box.min.y-origin.y)*invdiry;tymax=(box.max.y-origin.y)*invdiry;}else{tymin=(box.max.y-origin.y)*invdiry;tymax=(box.min.y-origin.y)*invdiry;}if(tmin>tymax||tymin>tmax){return null;}// These lines also handle the case where tmin or tmax is NaN
  // (result of 0 * Infinity). x !== x returns true if x is NaN
  if(tymin>tmin||tmin!==tmin){tmin=tymin;}if(tymax<tmax||tmax!==tmax){tmax=tymax;}if(invdirz>=0){tzmin=(box.min.z-origin.z)*invdirz;tzmax=(box.max.z-origin.z)*invdirz;}else{tzmin=(box.max.z-origin.z)*invdirz;tzmax=(box.min.z-origin.z)*invdirz;}if(tmin>tzmax||tzmin>tmax){return null;}if(tzmin>tmin||tmin!==tmin){tmin=tzmin;}if(tzmax<tmax||tmax!==tmax){tmax=tzmax;}//return point closest to the ray (positive side)
  if(tmax<0){return null;}return this.at(tmin>=0?tmin:tmax,optionalTarget);},intersectsBox:function(){var v=new Vector3$1();return function intersectsBox(box){return this.intersectBox(box,v)!==null;};}(),intersectTriangle:function(){// Compute the offset origin, edges, and normal.
  var diff=new Vector3$1();var edge1=new Vector3$1();var edge2=new Vector3$1();var normal=new Vector3$1();return function intersectTriangle(a,b,c,backfaceCulling,optionalTarget){// from http://www.geometrictools.com/GTEngine/Include/Mathematics/GteIntrRay3Triangle3.h
  edge1.subVectors(b,a);edge2.subVectors(c,a);normal.crossVectors(edge1,edge2);// Solve Q + t*D = b1*E1 + b2*E2 (Q = kDiff, D = ray direction,
  // E1 = kEdge1, E2 = kEdge2, N = Cross(E1,E2)) by
  //   |Dot(D,N)|*b1 = sign(Dot(D,N))*Dot(D,Cross(Q,E2))
  //   |Dot(D,N)|*b2 = sign(Dot(D,N))*Dot(D,Cross(E1,Q))
  //   |Dot(D,N)|*t = -sign(Dot(D,N))*Dot(Q,N)
  var DdN=this.direction.dot(normal);var sign;if(DdN>0){if(backfaceCulling){return null;}sign=1;}else if(DdN<0){sign=-1;DdN=-DdN;}else{return null;}diff.subVectors(this.origin,a);var DdQxE2=sign*this.direction.dot(edge2.crossVectors(diff,edge2));// b1 < 0, no intersection
  if(DdQxE2<0){return null;}var DdE1xQ=sign*this.direction.dot(edge1.cross(diff));// b2 < 0, no intersection
  if(DdE1xQ<0){return null;}// b1+b2 > 1, no intersection
  if(DdQxE2+DdE1xQ>DdN){return null;}// Line intersects triangle, check if ray does.
  var QdN=-sign*diff.dot(normal);// t < 0, no intersection
  if(QdN<0){return null;}// Ray intersects triangle.
  return this.at(QdN/DdN,optionalTarget);};}(),applyMatrix4:function applyMatrix4(matrix4){this.origin.applyMatrix4(matrix4);this.direction.transformDirection(matrix4);return this;},equals:function equals(ray){return ray.origin.equals(this.origin)&&ray.direction.equals(this.direction);}});/**
   * @author bhouston / http://clara.io
   */function Line3(start,end){this.start=start!==undefined?start:new Vector3$1();this.end=end!==undefined?end:new Vector3$1();}Object.assign(Line3.prototype,{set:function set$$1(start,end){this.start.copy(start);this.end.copy(end);return this;},clone:function clone(){return new this.constructor().copy(this);},copy:function copy(line){this.start.copy(line.start);this.end.copy(line.end);return this;},getCenter:function getCenter(optionalTarget){var result=optionalTarget||new Vector3$1();return result.addVectors(this.start,this.end).multiplyScalar(0.5);},delta:function delta(optionalTarget){var result=optionalTarget||new Vector3$1();return result.subVectors(this.end,this.start);},distanceSq:function distanceSq(){return this.start.distanceToSquared(this.end);},distance:function distance(){return this.start.distanceTo(this.end);},at:function at(t,optionalTarget){var result=optionalTarget||new Vector3$1();return this.delta(result).multiplyScalar(t).add(this.start);},closestPointToPointParameter:function(){var startP=new Vector3$1();var startEnd=new Vector3$1();return function closestPointToPointParameter(point,clampToLine){startP.subVectors(point,this.start);startEnd.subVectors(this.end,this.start);var startEnd2=startEnd.dot(startEnd);var startEnd_startP=startEnd.dot(startP);var t=startEnd_startP/startEnd2;if(clampToLine){t=_Math$1.clamp(t,0,1);}return t;};}(),closestPointToPoint:function closestPointToPoint(point,clampToLine,optionalTarget){var t=this.closestPointToPointParameter(point,clampToLine);var result=optionalTarget||new Vector3$1();return this.delta(result).multiplyScalar(t).add(this.start);},applyMatrix4:function applyMatrix4(matrix){this.start.applyMatrix4(matrix);this.end.applyMatrix4(matrix);return this;},equals:function equals(line){return line.start.equals(this.start)&&line.end.equals(this.end);}});/**
   * @author bhouston / http://clara.io
   */function Plane(normal,constant){// normal is assumed to be normalized
  this.normal=normal!==undefined?normal:new Vector3$1(1,0,0);this.constant=constant!==undefined?constant:0;}Object.assign(Plane.prototype,{set:function set$$1(normal,constant){this.normal.copy(normal);this.constant=constant;return this;},setComponents:function setComponents(x,y,z,w){this.normal.set(x,y,z);this.constant=w;return this;},setFromNormalAndCoplanarPoint:function setFromNormalAndCoplanarPoint(normal,point){this.normal.copy(normal);this.constant=-point.dot(this.normal);return this;},setFromCoplanarPoints:function(){var v1=new Vector3$1();var v2=new Vector3$1();return function setFromCoplanarPoints(a,b,c){var normal=v1.subVectors(c,b).cross(v2.subVectors(a,b)).normalize();// Q: should an error be thrown if normal is zero (e.g. degenerate plane)?
  this.setFromNormalAndCoplanarPoint(normal,a);return this;};}(),clone:function clone(){return new this.constructor().copy(this);},copy:function copy(plane){this.normal.copy(plane.normal);this.constant=plane.constant;return this;},normalize:function normalize(){// Note: will lead to a divide by zero if the plane is invalid.
  var inverseNormalLength=1.0/this.normal.length();this.normal.multiplyScalar(inverseNormalLength);this.constant*=inverseNormalLength;return this;},negate:function negate(){this.constant*=-1;this.normal.negate();return this;},distanceToPoint:function distanceToPoint(point){return this.normal.dot(point)+this.constant;},distanceToSphere:function distanceToSphere(sphere){return this.distanceToPoint(sphere.center)-sphere.radius;},projectPoint:function projectPoint(point,optionalTarget){var result=optionalTarget||new Vector3$1();return result.copy(this.normal).multiplyScalar(-this.distanceToPoint(point)).add(point);},intersectLine:function(){var v1=new Vector3$1();return function intersectLine(line,optionalTarget){var result=optionalTarget||new Vector3$1();var direction=line.delta(v1);var denominator=this.normal.dot(direction);if(denominator===0){// line is coplanar, return origin
  if(this.distanceToPoint(line.start)===0){return result.copy(line.start);}// Unsure if this is the correct method to handle this case.
  return undefined;}var t=-(line.start.dot(this.normal)+this.constant)/denominator;if(t<0||t>1){return undefined;}return result.copy(direction).multiplyScalar(t).add(line.start);};}(),intersectsLine:function intersectsLine(line){// Note: this tests if a line intersects the plane, not whether it (or its end-points) are coplanar with it.
  var startSign=this.distanceToPoint(line.start);var endSign=this.distanceToPoint(line.end);return startSign<0&&endSign>0||endSign<0&&startSign>0;},intersectsBox:function intersectsBox(box){return box.intersectsPlane(this);},intersectsSphere:function intersectsSphere(sphere){return sphere.intersectsPlane(this);},coplanarPoint:function coplanarPoint(optionalTarget){var result=optionalTarget||new Vector3$1();return result.copy(this.normal).multiplyScalar(-this.constant);},applyMatrix4:function(){var v1=new Vector3$1();var m1=new Matrix3$1();return function applyMatrix4(matrix,optionalNormalMatrix){var normalMatrix=optionalNormalMatrix||m1.getNormalMatrix(matrix);var referencePoint=this.coplanarPoint(v1).applyMatrix4(matrix);var normal=this.normal.applyMatrix3(normalMatrix).normalize();this.constant=-referencePoint.dot(normal);return this;};}(),translate:function translate(offset){this.constant-=offset.dot(this.normal);return this;},equals:function equals(plane){return plane.normal.equals(this.normal)&&plane.constant===this.constant;}});/**
   * @author bhouston / http://clara.io
   * @author mrdoob / http://mrdoob.com/
   */function Triangle(a,b,c){this.a=a!==undefined?a:new Vector3$1();this.b=b!==undefined?b:new Vector3$1();this.c=c!==undefined?c:new Vector3$1();}Object.assign(Triangle,{normal:function(){var v0=new Vector3$1();return function normal(a,b,c,optionalTarget){var result=optionalTarget||new Vector3$1();result.subVectors(c,b);v0.subVectors(a,b);result.cross(v0);var resultLengthSq=result.lengthSq();if(resultLengthSq>0){return result.multiplyScalar(1/Math.sqrt(resultLengthSq));}return result.set(0,0,0);};}(),// static/instance method to calculate barycentric coordinates
  // based on: http://www.blackpawn.com/texts/pointinpoly/default.html
  barycoordFromPoint:function(){var v0=new Vector3$1();var v1=new Vector3$1();var v2=new Vector3$1();return function barycoordFromPoint(point,a,b,c,optionalTarget){v0.subVectors(c,a);v1.subVectors(b,a);v2.subVectors(point,a);var dot00=v0.dot(v0);var dot01=v0.dot(v1);var dot02=v0.dot(v2);var dot11=v1.dot(v1);var dot12=v1.dot(v2);var denom=dot00*dot11-dot01*dot01;var result=optionalTarget||new Vector3$1();// collinear or singular triangle
  if(denom===0){// arbitrary location outside of triangle?
  // not sure if this is the best idea, maybe should be returning undefined
  return result.set(-2,-1,-1);}var invDenom=1/denom;var u=(dot11*dot02-dot01*dot12)*invDenom;var v=(dot00*dot12-dot01*dot02)*invDenom;// barycentric coordinates must always sum to 1
  return result.set(1-u-v,v,u);};}(),containsPoint:function(){var v1=new Vector3$1();return function containsPoint(point,a,b,c){var result=Triangle.barycoordFromPoint(point,a,b,c,v1);return result.x>=0&&result.y>=0&&result.x+result.y<=1;};}()});Object.assign(Triangle.prototype,{set:function set$$1(a,b,c){this.a.copy(a);this.b.copy(b);this.c.copy(c);return this;},setFromPointsAndIndices:function setFromPointsAndIndices(points,i0,i1,i2){this.a.copy(points[i0]);this.b.copy(points[i1]);this.c.copy(points[i2]);return this;},clone:function clone(){return new this.constructor().copy(this);},copy:function copy(triangle){this.a.copy(triangle.a);this.b.copy(triangle.b);this.c.copy(triangle.c);return this;},area:function(){var v0=new Vector3$1();var v1=new Vector3$1();return function area(){v0.subVectors(this.c,this.b);v1.subVectors(this.a,this.b);return v0.cross(v1).length()*0.5;};}(),midpoint:function midpoint(optionalTarget){var result=optionalTarget||new Vector3$1();return result.addVectors(this.a,this.b).add(this.c).multiplyScalar(1/3);},normal:function normal(optionalTarget){return Triangle.normal(this.a,this.b,this.c,optionalTarget);},plane:function plane(optionalTarget){var result=optionalTarget||new Plane();return result.setFromCoplanarPoints(this.a,this.b,this.c);},barycoordFromPoint:function barycoordFromPoint(point,optionalTarget){return Triangle.barycoordFromPoint(point,this.a,this.b,this.c,optionalTarget);},containsPoint:function containsPoint(point){return Triangle.containsPoint(point,this.a,this.b,this.c);},closestPointToPoint:function(){var plane=new Plane();var edgeList=[new Line3(),new Line3(),new Line3()];var projectedPoint=new Vector3$1();var closestPoint=new Vector3$1();return function closestPointToPoint(point,optionalTarget){var result=optionalTarget||new Vector3$1();var minDistance=Infinity;// project the point onto the plane of the triangle
  plane.setFromCoplanarPoints(this.a,this.b,this.c);plane.projectPoint(point,projectedPoint);// check if the projection lies within the triangle
  if(this.containsPoint(projectedPoint)===true){// if so, this is the closest point
  result.copy(projectedPoint);}else{// if not, the point falls outside the triangle. the result is the closest point to the triangle's edges or vertices
  edgeList[0].set(this.a,this.b);edgeList[1].set(this.b,this.c);edgeList[2].set(this.c,this.a);for(var i=0;i<edgeList.length;i++){edgeList[i].closestPointToPoint(projectedPoint,true,closestPoint);var distance=projectedPoint.distanceToSquared(closestPoint);if(distance<minDistance){minDistance=distance;result.copy(closestPoint);}}}return result;};}(),equals:function equals(triangle){return triangle.a.equals(this.a)&&triangle.b.equals(this.b)&&triangle.c.equals(this.c);}});/**
   * @author mrdoob / http://mrdoob.com/
   * @author alteredq / http://alteredqualia.com/
   * @author mikael emtinger / http://gomo.se/
   * @author jonobr1 / http://jonobr1.com/
   */function Mesh(geometry,material){Object3D.call(this);this.type='Mesh';this.geometry=geometry!==undefined?geometry:new BufferGeometry();this.material=material!==undefined?material:new MeshBasicMaterial({color:Math.random()*0xffffff});this.drawMode=TrianglesDrawMode;this.updateMorphTargets();}Mesh.prototype=Object.assign(Object.create(Object3D.prototype),{constructor:Mesh,isMesh:true,setDrawMode:function setDrawMode(value){this.drawMode=value;},copy:function copy(source){Object3D.prototype.copy.call(this,source);this.drawMode=source.drawMode;if(source.morphTargetInfluences!==undefined){this.morphTargetInfluences=source.morphTargetInfluences.slice();}if(source.morphTargetDictionary!==undefined){this.morphTargetDictionary=Object.assign({},source.morphTargetDictionary);}return this;},updateMorphTargets:function updateMorphTargets(){var this$1=this;var geometry=this.geometry;var m,ml,name;if(geometry.isBufferGeometry){var morphAttributes=geometry.morphAttributes;var keys=Object.keys(morphAttributes);if(keys.length>0){var morphAttribute=morphAttributes[keys[0]];if(morphAttribute!==undefined){this.morphTargetInfluences=[];this.morphTargetDictionary={};for(m=0, ml=morphAttribute.length;m<ml;m++){name=morphAttribute[m].name||String(m);this$1.morphTargetInfluences.push(0);this$1.morphTargetDictionary[name]=m;}}}}else{var morphTargets=geometry.morphTargets;if(morphTargets!==undefined&&morphTargets.length>0){this.morphTargetInfluences=[];this.morphTargetDictionary={};for(m=0, ml=morphTargets.length;m<ml;m++){name=morphTargets[m].name||String(m);this$1.morphTargetInfluences.push(0);this$1.morphTargetDictionary[name]=m;}}}},raycast:function(){var inverseMatrix=new Matrix4();var ray=new Ray();var sphere=new Sphere();var vA=new Vector3$1();var vB=new Vector3$1();var vC=new Vector3$1();var tempA=new Vector3$1();var tempB=new Vector3$1();var tempC=new Vector3$1();var uvA=new Vector2$1();var uvB=new Vector2$1();var uvC=new Vector2$1();var barycoord=new Vector3$1();var intersectionPoint=new Vector3$1();var intersectionPointWorld=new Vector3$1();function uvIntersection(point,p1,p2,p3,uv1,uv2,uv3){Triangle.barycoordFromPoint(point,p1,p2,p3,barycoord);uv1.multiplyScalar(barycoord.x);uv2.multiplyScalar(barycoord.y);uv3.multiplyScalar(barycoord.z);uv1.add(uv2).add(uv3);return uv1.clone();}function checkIntersection(object,material,raycaster,ray,pA,pB,pC,point){var intersect;if(material.side===BackSide){intersect=ray.intersectTriangle(pC,pB,pA,true,point);}else{intersect=ray.intersectTriangle(pA,pB,pC,material.side!==DoubleSide,point);}if(intersect===null){return null;}intersectionPointWorld.copy(point);intersectionPointWorld.applyMatrix4(object.matrixWorld);var distance=raycaster.ray.origin.distanceTo(intersectionPointWorld);if(distance<raycaster.near||distance>raycaster.far){return null;}return{distance:distance,point:intersectionPointWorld.clone(),object:object};}function checkBufferGeometryIntersection(object,raycaster,ray,position,uv,a,b,c){vA.fromBufferAttribute(position,a);vB.fromBufferAttribute(position,b);vC.fromBufferAttribute(position,c);var intersection=checkIntersection(object,object.material,raycaster,ray,vA,vB,vC,intersectionPoint);if(intersection){if(uv){uvA.fromBufferAttribute(uv,a);uvB.fromBufferAttribute(uv,b);uvC.fromBufferAttribute(uv,c);intersection.uv=uvIntersection(intersectionPoint,vA,vB,vC,uvA,uvB,uvC);}intersection.face=new Face3$1(a,b,c,Triangle.normal(vA,vB,vC));intersection.faceIndex=a;}return intersection;}return function raycast(raycaster,intersects){var this$1=this;var geometry=this.geometry;var material=this.material;var matrixWorld=this.matrixWorld;if(material===undefined){return;}// Checking boundingSphere distance to ray
  if(geometry.boundingSphere===null){geometry.computeBoundingSphere();}sphere.copy(geometry.boundingSphere);sphere.applyMatrix4(matrixWorld);if(raycaster.ray.intersectsSphere(sphere)===false){return;}//
  inverseMatrix.getInverse(matrixWorld);ray.copy(raycaster.ray).applyMatrix4(inverseMatrix);// Check boundingBox before continuing
  if(geometry.boundingBox!==null){if(ray.intersectsBox(geometry.boundingBox)===false){return;}}var intersection;if(geometry.isBufferGeometry){var a,b,c;var index=geometry.index;var position=geometry.attributes.position;var uv=geometry.attributes.uv;var i,l;if(index!==null){// indexed buffer geometry
  for(i=0, l=index.count;i<l;i+=3){a=index.getX(i);b=index.getX(i+1);c=index.getX(i+2);intersection=checkBufferGeometryIntersection(this$1,raycaster,ray,position,uv,a,b,c);if(intersection){intersection.faceIndex=Math.floor(i/3);// triangle number in indices buffer semantics
  intersects.push(intersection);}}}else if(position!==undefined){// non-indexed buffer geometry
  for(i=0, l=position.count;i<l;i+=3){a=i;b=i+1;c=i+2;intersection=checkBufferGeometryIntersection(this$1,raycaster,ray,position,uv,a,b,c);if(intersection){intersection.index=a;// triangle number in positions buffer semantics
  intersects.push(intersection);}}}}else if(geometry.isGeometry){var fvA,fvB,fvC;var isMultiMaterial=Array.isArray(material);var vertices=geometry.vertices;var faces=geometry.faces;var uvs;var faceVertexUvs=geometry.faceVertexUvs[0];if(faceVertexUvs.length>0){uvs=faceVertexUvs;}for(var f=0,fl=faces.length;f<fl;f++){var face=faces[f];var faceMaterial=isMultiMaterial?material[face.materialIndex]:material;if(faceMaterial===undefined){continue;}fvA=vertices[face.a];fvB=vertices[face.b];fvC=vertices[face.c];if(faceMaterial.morphTargets===true){var morphTargets=geometry.morphTargets;var morphInfluences=this$1.morphTargetInfluences;vA.set(0,0,0);vB.set(0,0,0);vC.set(0,0,0);for(var t=0,tl=morphTargets.length;t<tl;t++){var influence=morphInfluences[t];if(influence===0){continue;}var targets=morphTargets[t].vertices;vA.addScaledVector(tempA.subVectors(targets[face.a],fvA),influence);vB.addScaledVector(tempB.subVectors(targets[face.b],fvB),influence);vC.addScaledVector(tempC.subVectors(targets[face.c],fvC),influence);}vA.add(fvA);vB.add(fvB);vC.add(fvC);fvA=vA;fvB=vB;fvC=vC;}intersection=checkIntersection(this$1,faceMaterial,raycaster,ray,fvA,fvB,fvC,intersectionPoint);if(intersection){if(uvs&&uvs[f]){var uvs_f=uvs[f];uvA.copy(uvs_f[0]);uvB.copy(uvs_f[1]);uvC.copy(uvs_f[2]);intersection.uv=uvIntersection(intersectionPoint,fvA,fvB,fvC,uvA,uvB,uvC);}intersection.face=face;intersection.faceIndex=f;intersects.push(intersection);}}}};}(),clone:function clone(){return new this.constructor(this.geometry,this.material).copy(this);}});/**
   * @author mrdoob / http://mrdoob.com/
   */function Line$1(geometry,material,mode){if(mode===1){console.error('THREE.Line: parameter THREE.LinePieces no longer supported. Created THREE.LineSegments instead.');}Object3D.call(this);this.type='Line';this.geometry=geometry!==undefined?geometry:new BufferGeometry();this.material=material!==undefined?material:new LineBasicMaterial$1({color:Math.random()*0xffffff});}Line$1.prototype=Object.assign(Object.create(Object3D.prototype),{constructor:Line$1,isLine:true,raycast:function(){var inverseMatrix=new Matrix4();var ray=new Ray();var sphere=new Sphere();return function raycast(raycaster,intersects){var this$1=this;var precision=raycaster.linePrecision;var precisionSq=precision*precision;var geometry=this.geometry;var matrixWorld=this.matrixWorld;// Checking boundingSphere distance to ray
  if(geometry.boundingSphere===null){geometry.computeBoundingSphere();}sphere.copy(geometry.boundingSphere);sphere.applyMatrix4(matrixWorld);if(raycaster.ray.intersectsSphere(sphere)===false){return;}//
  inverseMatrix.getInverse(matrixWorld);ray.copy(raycaster.ray).applyMatrix4(inverseMatrix);var vStart=new Vector3$1();var vEnd=new Vector3$1();var interSegment=new Vector3$1();var interRay=new Vector3$1();var step=this&&this.isLineSegments?2:1;if(geometry.isBufferGeometry){var index=geometry.index;var attributes=geometry.attributes;var positions=attributes.position.array;if(index!==null){var indices=index.array;for(var i=0,l=indices.length-1;i<l;i+=step){var a=indices[i];var b=indices[i+1];vStart.fromArray(positions,a*3);vEnd.fromArray(positions,b*3);var distSq=ray.distanceSqToSegment(vStart,vEnd,interRay,interSegment);if(distSq>precisionSq){continue;}interRay.applyMatrix4(this$1.matrixWorld);//Move back to world space for distance calculation
  var distance=raycaster.ray.origin.distanceTo(interRay);if(distance<raycaster.near||distance>raycaster.far){continue;}intersects.push({distance:distance,// What do we want? intersection point on the ray or on the segment??
  // point: raycaster.ray.at( distance ),
  point:interSegment.clone().applyMatrix4(this$1.matrixWorld),index:i,face:null,faceIndex:null,object:this$1});}}else{for(var i=0,l=positions.length/3-1;i<l;i+=step){vStart.fromArray(positions,3*i);vEnd.fromArray(positions,3*i+3);var distSq=ray.distanceSqToSegment(vStart,vEnd,interRay,interSegment);if(distSq>precisionSq){continue;}interRay.applyMatrix4(this$1.matrixWorld);//Move back to world space for distance calculation
  var distance=raycaster.ray.origin.distanceTo(interRay);if(distance<raycaster.near||distance>raycaster.far){continue;}intersects.push({distance:distance,// What do we want? intersection point on the ray or on the segment??
  // point: raycaster.ray.at( distance ),
  point:interSegment.clone().applyMatrix4(this$1.matrixWorld),index:i,face:null,faceIndex:null,object:this$1});}}}else if(geometry.isGeometry){var vertices=geometry.vertices;var nbVertices=vertices.length;for(var i=0;i<nbVertices-1;i+=step){var distSq=ray.distanceSqToSegment(vertices[i],vertices[i+1],interRay,interSegment);if(distSq>precisionSq){continue;}interRay.applyMatrix4(this$1.matrixWorld);//Move back to world space for distance calculation
  var distance=raycaster.ray.origin.distanceTo(interRay);if(distance<raycaster.near||distance>raycaster.far){continue;}intersects.push({distance:distance,// What do we want? intersection point on the ray or on the segment??
  // point: raycaster.ray.at( distance ),
  point:interSegment.clone().applyMatrix4(this$1.matrixWorld),index:i,face:null,faceIndex:null,object:this$1});}}};}(),clone:function clone(){return new this.constructor(this.geometry,this.material).copy(this);}});/**
   * @author takahiro / https://github.com/takahirox
   *
   * CCD Algorithm
   *  https://sites.google.com/site/auraliusproject/ccd-algorithm
   *
   * mesh.geometry needs to have iks array.
   *
   * // ik parameter example
   * //
   * // target, effector, index in links are bone index in skeleton.
   * // the bones relation should be
   * // <-- parent                                  child -->
   * // links[ n ], links[ n - 1 ], ..., links[ 0 ], effector
   * ik = {
   *	target: 1,
   *	effector: 2,
   *	links: [ { index: 5, limitation: new Vector3( 1, 0, 0 ) }, { index: 4, enabled: false }, { index : 3 } ],
   *	iteration: 10,
   *	minAngle: 0.0,
   *	maxAngle: 1.0,
   * };
   */var CCDIKHelper=function CCDIKHelper(mesh){if(mesh.geometry.iks===undefined||mesh.skeleton===undefined){throw'CCDIKHelper requires iks in mesh.geometry and skeleton in mesh.';}Object3D.call(this);this.root=mesh;this.matrix=mesh.matrixWorld;this.matrixAutoUpdate=false;this.sphereGeometry=new SphereBufferGeometry(0.25,16,8);this.targetSphereMaterial=new MeshBasicMaterial({color:new Color$1(0xff8888),depthTest:false,depthWrite:false,transparent:true});this.effectorSphereMaterial=new MeshBasicMaterial({color:new Color$1(0x88ff88),depthTest:false,depthWrite:false,transparent:true});this.linkSphereMaterial=new MeshBasicMaterial({color:new Color$1(0x8888ff),depthTest:false,depthWrite:false,transparent:true});this.lineMaterial=new LineBasicMaterial$1({color:new Color$1(0xff0000),depthTest:false,depthWrite:false,transparent:true});this._init();this.update();};CCDIKHelper.prototype=Object.create(Object3D.prototype);CCDIKHelper.prototype.constructor=CCDIKHelper;CCDIKHelper.prototype._init=function(){var this$1=this;var self=this;var mesh=this.root;var iks=mesh.geometry.iks;function createLineGeometry(ik){var geometry=new BufferGeometry();var vertices=new Float32Array((2+ik.links.length)*3);geometry.addAttribute('position',new BufferAttribute(vertices,3));return geometry;}function createTargetMesh(){return new Mesh(self.sphereGeometry,self.targetSphereMaterial);}function createEffectorMesh(){return new Mesh(self.sphereGeometry,self.effectorSphereMaterial);}function createLinkMesh(){return new Mesh(self.sphereGeometry,self.linkSphereMaterial);}function createLine(ik){return new Line$1(createLineGeometry(ik),self.lineMaterial);}for(var i=0,il=iks.length;i<il;i++){var ik=iks[i];this$1.add(createTargetMesh());this$1.add(createEffectorMesh());for(var j=0,jl=ik.links.length;j<jl;j++){this$1.add(createLinkMesh());}this$1.add(createLine(ik));}};CCDIKHelper.prototype.update=function(){var this$1=this;var offset=0;var mesh=this.root;var iks=mesh.geometry.iks;var bones=mesh.skeleton.bones;var matrixWorldInv=new Matrix4().getInverse(mesh.matrixWorld);var vector=new Vector3$1();function getPosition(bone){vector.setFromMatrixPosition(bone.matrixWorld);vector.applyMatrix4(matrixWorldInv);return vector;}function setPositionOfBoneToAttributeArray(array,index,bone){var v=getPosition(bone);array[index*3+0]=v.x;array[index*3+1]=v.y;array[index*3+2]=v.z;}for(var i=0,il=iks.length;i<il;i++){var ik=iks[i];var targetBone=bones[ik.target];var effectorBone=bones[ik.effector];var targetMesh=this$1.children[offset++];var effectorMesh=this$1.children[offset++];targetMesh.position.copy(getPosition(targetBone));effectorMesh.position.copy(getPosition(effectorBone));for(var j=0,jl=ik.links.length;j<jl;j++){var link=ik.links[j];var linkBone=bones[link.index];var linkMesh=this$1.children[offset++];linkMesh.position.copy(getPosition(linkBone));}var line=this$1.children[offset++];var array=line.geometry.attributes.position.array;setPositionOfBoneToAttributeArray(array,0,targetBone);setPositionOfBoneToAttributeArray(array,1,effectorBone);for(var j=0,jl=ik.links.length;j<jl;j++){var link=ik.links[j];var linkBone=bones[link.index];setPositionOfBoneToAttributeArray(array,j+2,linkBone);}line.geometry.attributes.position.needsUpdate=true;}};/**
   * @author mikael emtinger / http://gomo.se/
   * @author alteredq / http://alteredqualia.com/
   * @author ikerr / http://verold.com
   */function Bone$1(){Object3D.call(this);this.type='Bone';}Bone$1.prototype=Object.assign(Object.create(Object3D.prototype),{constructor:Bone$1,isBone:true});/**
   * @author takahiro / https://github.com/takahirox
   *
   * Dependencies
   *  - Ammo.js https://github.com/kripken/ammo.js
   *
   * MMD specific Physics class.
   *
   * See MMDLoader for the passed parameter list of RigidBody/Constraint.
   *
   * Requirement:
   *  - don't change object's scale from (1,1,1) after setting physics to object
   *
   * TODO
   *  - optimize for the performance
   *  - use Physijs http://chandlerprall.github.io/Physijs/
   *    and improve the performance by making use of Web worker.
   *  - if possible, make this class being non-MMD specific.
   *  - object scale change support
   */var MMDPhysics=function MMDPhysics(mesh,params){if(params===undefined){params={};}this.mesh=mesh;this.helper=new MMDPhysics.ResourceHelper();/*
  	 * I don't know why but 1/60 unitStep easily breaks models
  	 * so I set it 1/65 so far.
  	 * Don't set too small unitStep because
  	 * the smaller unitStep can make the performance worse.
  	 */this.unitStep=params.unitStep!==undefined?params.unitStep:1/65;this.maxStepNum=params.maxStepNum!==undefined?params.maxStepNum:3;this.world=params.world!==undefined?params.world:null;this.bodies=[];this.constraints=[];this.init(mesh);};MMDPhysics.prototype={constructor:MMDPhysics,init:function init(mesh){var parent=mesh.parent;if(parent!==null){parent.remove(mesh);}var helper=this.helper;var currentPosition=helper.allocThreeVector3();var currentRotation=helper.allocThreeEuler();var currentScale=helper.allocThreeVector3();currentPosition.copy(mesh.position);currentRotation.copy(mesh.rotation);currentScale.copy(mesh.scale);mesh.position.set(0,0,0);mesh.rotation.set(0,0,0);mesh.scale.set(1,1,1);mesh.updateMatrixWorld(true);if(this.world===null){this.initWorld();}this.initRigidBodies();this.initConstraints();if(parent!==null){parent.add(mesh);}mesh.position.copy(currentPosition);mesh.rotation.copy(currentRotation);mesh.scale.copy(currentScale);mesh.updateMatrixWorld(true);this.reset();helper.freeThreeVector3(currentPosition);helper.freeThreeEuler(currentRotation);helper.freeThreeVector3(currentScale);},initWorld:function initWorld(){var config=new Ammo.btDefaultCollisionConfiguration();var dispatcher=new Ammo.btCollisionDispatcher(config);var cache=new Ammo.btDbvtBroadphase();var solver=new Ammo.btSequentialImpulseConstraintSolver();var world=new Ammo.btDiscreteDynamicsWorld(dispatcher,cache,solver,config);world.setGravity(new Ammo.btVector3(0,-9.8*10,0));this.world=world;},initRigidBodies:function initRigidBodies(){var this$1=this;var bodies=this.mesh.geometry.rigidBodies;for(var i=0;i<bodies.length;i++){var b=new MMDPhysics.RigidBody(this$1.mesh,this$1.world,bodies[i],this$1.helper);this$1.bodies.push(b);}},initConstraints:function initConstraints(){var this$1=this;var constraints=this.mesh.geometry.constraints;for(var i=0;i<constraints.length;i++){var params=constraints[i];var bodyA=this$1.bodies[params.rigidBodyIndex1];var bodyB=this$1.bodies[params.rigidBodyIndex2];var c=new MMDPhysics.Constraint(this$1.mesh,this$1.world,bodyA,bodyB,params,this$1.helper);this$1.constraints.push(c);}},update:function update(delta){this.updateRigidBodies();this.stepSimulation(delta);this.updateBones();},stepSimulation:function stepSimulation(delta){var unitStep=this.unitStep;var stepTime=delta;var maxStepNum=(delta/unitStep|0)+1;if(stepTime<unitStep){stepTime=unitStep;maxStepNum=1;}if(maxStepNum>this.maxStepNum){maxStepNum=this.maxStepNum;}this.world.stepSimulation(stepTime,maxStepNum,unitStep);},updateRigidBodies:function updateRigidBodies(){var this$1=this;for(var i=0;i<this.bodies.length;i++){this$1.bodies[i].updateFromBone();}},updateBones:function updateBones(){var this$1=this;for(var i=0;i<this.bodies.length;i++){this$1.bodies[i].updateBone();}},reset:function reset(){var this$1=this;for(var i=0;i<this.bodies.length;i++){this$1.bodies[i].reset();}},warmup:function warmup(cycles){var this$1=this;for(var i=0;i<cycles;i++){this$1.update(1/60);}}};/**
   * This helper class responsibilies are
   *
   * 1. manage Ammo.js and Three.js object resources and
   *    improve the performance and the memory consumption by
   *    reusing objects.
   *
   * 2. provide simple Ammo object operations.
   */MMDPhysics.ResourceHelper=function(){// for Three.js
  this.threeVector3s=[];this.threeMatrix4s=[];this.threeQuaternions=[];this.threeEulers=[];// for Ammo.js
  this.transforms=[];this.quaternions=[];this.vector3s=[];};MMDPhysics.ResourceHelper.prototype={allocThreeVector3:function allocThreeVector3(){return this.threeVector3s.length>0?this.threeVector3s.pop():new Vector3$1();},freeThreeVector3:function freeThreeVector3(v){this.threeVector3s.push(v);},allocThreeMatrix4:function allocThreeMatrix4(){return this.threeMatrix4s.length>0?this.threeMatrix4s.pop():new Matrix4();},freeThreeMatrix4:function freeThreeMatrix4(m){this.threeMatrix4s.push(m);},allocThreeQuaternion:function allocThreeQuaternion(){return this.threeQuaternions.length>0?this.threeQuaternions.pop():new Quaternion();},freeThreeQuaternion:function freeThreeQuaternion(q){this.threeQuaternions.push(q);},allocThreeEuler:function allocThreeEuler(){return this.threeEulers.length>0?this.threeEulers.pop():new Euler();},freeThreeEuler:function freeThreeEuler(e){this.threeEulers.push(e);},allocTransform:function allocTransform(){return this.transforms.length>0?this.transforms.pop():new Ammo.btTransform();},freeTransform:function freeTransform(t){this.transforms.push(t);},allocQuaternion:function allocQuaternion(){return this.quaternions.length>0?this.quaternions.pop():new Ammo.btQuaternion();},freeQuaternion:function freeQuaternion(q){this.quaternions.push(q);},allocVector3:function allocVector3(){return this.vector3s.length>0?this.vector3s.pop():new Ammo.btVector3();},freeVector3:function freeVector3(v){this.vector3s.push(v);},setIdentity:function setIdentity(t){t.setIdentity();},getBasis:function getBasis(t){var q=this.allocQuaternion();t.getBasis().getRotation(q);return q;},getBasisAsMatrix3:function getBasisAsMatrix3(t){var q=this.getBasis(t);var m=this.quaternionToMatrix3(q);this.freeQuaternion(q);return m;},getOrigin:function getOrigin(t){return t.getOrigin();},setOrigin:function setOrigin(t,v){t.getOrigin().setValue(v.x(),v.y(),v.z());},copyOrigin:function copyOrigin(t1,t2){var o=t2.getOrigin();this.setOrigin(t1,o);},setBasis:function setBasis(t,q){t.setRotation(q);},setBasisFromMatrix3:function setBasisFromMatrix3(t,m){var q=this.matrix3ToQuaternion(m);this.setBasis(t,q);this.freeQuaternion(q);},setOriginFromArray3:function setOriginFromArray3(t,a){t.getOrigin().setValue(a[0],a[1],a[2]);},setOriginFromThreeVector3:function setOriginFromThreeVector3(t,v){t.getOrigin().setValue(v.x,v.y,v.z);},setBasisFromArray3:function setBasisFromArray3(t,a){var thQ=this.allocThreeQuaternion();var thE=this.allocThreeEuler();thE.set(a[0],a[1],a[2]);this.setBasisFromThreeQuaternion(t,thQ.setFromEuler(thE));this.freeThreeEuler(thE);this.freeThreeQuaternion(thQ);},setBasisFromThreeQuaternion:function setBasisFromThreeQuaternion(t,a){var q=this.allocQuaternion();q.setX(a.x);q.setY(a.y);q.setZ(a.z);q.setW(a.w);this.setBasis(t,q);this.freeQuaternion(q);},multiplyTransforms:function multiplyTransforms(t1,t2){var t=this.allocTransform();this.setIdentity(t);var m1=this.getBasisAsMatrix3(t1);var m2=this.getBasisAsMatrix3(t2);var o1=this.getOrigin(t1);var o2=this.getOrigin(t2);var v1=this.multiplyMatrix3ByVector3(m1,o2);var v2=this.addVector3(v1,o1);this.setOrigin(t,v2);var m3=this.multiplyMatrices3(m1,m2);this.setBasisFromMatrix3(t,m3);this.freeVector3(v1);this.freeVector3(v2);return t;},inverseTransform:function inverseTransform(t){var t2=this.allocTransform();var m1=this.getBasisAsMatrix3(t);var o=this.getOrigin(t);var m2=this.transposeMatrix3(m1);var v1=this.negativeVector3(o);var v2=this.multiplyMatrix3ByVector3(m2,v1);this.setOrigin(t2,v2);this.setBasisFromMatrix3(t2,m2);this.freeVector3(v1);this.freeVector3(v2);return t2;},multiplyMatrices3:function multiplyMatrices3(m1,m2){var m3=[];var v10=this.rowOfMatrix3(m1,0);var v11=this.rowOfMatrix3(m1,1);var v12=this.rowOfMatrix3(m1,2);var v20=this.columnOfMatrix3(m2,0);var v21=this.columnOfMatrix3(m2,1);var v22=this.columnOfMatrix3(m2,2);m3[0]=this.dotVectors3(v10,v20);m3[1]=this.dotVectors3(v10,v21);m3[2]=this.dotVectors3(v10,v22);m3[3]=this.dotVectors3(v11,v20);m3[4]=this.dotVectors3(v11,v21);m3[5]=this.dotVectors3(v11,v22);m3[6]=this.dotVectors3(v12,v20);m3[7]=this.dotVectors3(v12,v21);m3[8]=this.dotVectors3(v12,v22);this.freeVector3(v10);this.freeVector3(v11);this.freeVector3(v12);this.freeVector3(v20);this.freeVector3(v21);this.freeVector3(v22);return m3;},addVector3:function addVector3(v1,v2){var v=this.allocVector3();v.setValue(v1.x()+v2.x(),v1.y()+v2.y(),v1.z()+v2.z());return v;},dotVectors3:function dotVectors3(v1,v2){return v1.x()*v2.x()+v1.y()*v2.y()+v1.z()*v2.z();},rowOfMatrix3:function rowOfMatrix3(m,i){var v=this.allocVector3();v.setValue(m[i*3+0],m[i*3+1],m[i*3+2]);return v;},columnOfMatrix3:function columnOfMatrix3(m,i){var v=this.allocVector3();v.setValue(m[i+0],m[i+3],m[i+6]);return v;},negativeVector3:function negativeVector3(v){var v2=this.allocVector3();v2.setValue(-v.x(),-v.y(),-v.z());return v2;},multiplyMatrix3ByVector3:function multiplyMatrix3ByVector3(m,v){var v4=this.allocVector3();var v0=this.rowOfMatrix3(m,0);var v1=this.rowOfMatrix3(m,1);var v2=this.rowOfMatrix3(m,2);var x=this.dotVectors3(v0,v);var y=this.dotVectors3(v1,v);var z=this.dotVectors3(v2,v);v4.setValue(x,y,z);this.freeVector3(v0);this.freeVector3(v1);this.freeVector3(v2);return v4;},transposeMatrix3:function transposeMatrix3(m){var m2=[];m2[0]=m[0];m2[1]=m[3];m2[2]=m[6];m2[3]=m[1];m2[4]=m[4];m2[5]=m[7];m2[6]=m[2];m2[7]=m[5];m2[8]=m[8];return m2;},quaternionToMatrix3:function quaternionToMatrix3(q){var m=[];var x=q.x();var y=q.y();var z=q.z();var w=q.w();var xx=x*x;var yy=y*y;var zz=z*z;var xy=x*y;var yz=y*z;var zx=z*x;var xw=x*w;var yw=y*w;var zw=z*w;m[0]=1-2*(yy+zz);m[1]=2*(xy-zw);m[2]=2*(zx+yw);m[3]=2*(xy+zw);m[4]=1-2*(zz+xx);m[5]=2*(yz-xw);m[6]=2*(zx-yw);m[7]=2*(yz+xw);m[8]=1-2*(xx+yy);return m;},matrix3ToQuaternion:function matrix3ToQuaternion(m){var t=m[0]+m[4]+m[8];var s,x,y,z,w;if(t>0){s=Math.sqrt(t+1.0)*2;w=0.25*s;x=(m[7]-m[5])/s;y=(m[2]-m[6])/s;z=(m[3]-m[1])/s;}else if(m[0]>m[4]&&m[0]>m[8]){s=Math.sqrt(1.0+m[0]-m[4]-m[8])*2;w=(m[7]-m[5])/s;x=0.25*s;y=(m[1]+m[3])/s;z=(m[2]+m[6])/s;}else if(m[4]>m[8]){s=Math.sqrt(1.0+m[4]-m[0]-m[8])*2;w=(m[2]-m[6])/s;x=(m[1]+m[3])/s;y=0.25*s;z=(m[5]+m[7])/s;}else{s=Math.sqrt(1.0+m[8]-m[0]-m[4])*2;w=(m[3]-m[1])/s;x=(m[2]+m[6])/s;y=(m[5]+m[7])/s;z=0.25*s;}var q=this.allocQuaternion();q.setX(x);q.setY(y);q.setZ(z);q.setW(w);return q;}};MMDPhysics.RigidBody=function(mesh,world,params,helper){this.mesh=mesh;this.world=world;this.params=params;this.helper=helper;this.body=null;this.bone=null;this.boneOffsetForm=null;this.boneOffsetFormInverse=null;this.init();};MMDPhysics.RigidBody.prototype={constructor:MMDPhysics.RigidBody,init:function init(){function generateShape(p){switch(p.shapeType){case 0:return new Ammo.btSphereShape(p.width);case 1:return new Ammo.btBoxShape(new Ammo.btVector3(p.width,p.height,p.depth));case 2:return new Ammo.btCapsuleShape(p.width,p.height);default:throw'unknown shape type '+p.shapeType;}}var helper=this.helper;var params=this.params;var bones=this.mesh.skeleton.bones;var bone=params.boneIndex===-1?new Bone$1():bones[params.boneIndex];var shape=generateShape(params);var weight=params.type===0?0:params.weight;var localInertia=helper.allocVector3();localInertia.setValue(0,0,0);if(weight!==0){shape.calculateLocalInertia(weight,localInertia);}var boneOffsetForm=helper.allocTransform();helper.setIdentity(boneOffsetForm);helper.setOriginFromArray3(boneOffsetForm,params.position);helper.setBasisFromArray3(boneOffsetForm,params.rotation);var vector=helper.allocThreeVector3();var boneForm=helper.allocTransform();helper.setIdentity(boneForm);helper.setOriginFromThreeVector3(boneForm,bone.getWorldPosition(vector));var form=helper.multiplyTransforms(boneForm,boneOffsetForm);var state=new Ammo.btDefaultMotionState(form);var info=new Ammo.btRigidBodyConstructionInfo(weight,state,shape,localInertia);info.set_m_friction(params.friction);info.set_m_restitution(params.restitution);var body=new Ammo.btRigidBody(info);if(params.type===0){body.setCollisionFlags(body.getCollisionFlags()|2);/*
  			 * It'd be better to comment out this line though in general I should call this method
  			 * because I'm not sure why but physics will be more like MMD's
  			 * if I comment out.
  			 */body.setActivationState(4);}body.setDamping(params.positionDamping,params.rotationDamping);body.setSleepingThresholds(0,0);this.world.addRigidBody(body,1<<params.groupIndex,params.groupTarget);this.body=body;this.bone=bone;this.boneOffsetForm=boneOffsetForm;this.boneOffsetFormInverse=helper.inverseTransform(boneOffsetForm);helper.freeVector3(localInertia);helper.freeTransform(form);helper.freeTransform(boneForm);helper.freeThreeVector3(vector);},reset:function reset(){this.setTransformFromBone();},updateFromBone:function updateFromBone(){if(this.params.boneIndex===-1){return;}if(this.params.type===0){this.setTransformFromBone();}},updateBone:function updateBone(){if(this.params.type===0||this.params.boneIndex===-1){return;}this.updateBoneRotation();if(this.params.type===1){this.updateBonePosition();}this.bone.updateMatrixWorld(true);if(this.params.type===2){this.setPositionFromBone();}},getBoneTransform:function getBoneTransform(){var helper=this.helper;var p=helper.allocThreeVector3();var q=helper.allocThreeQuaternion();this.bone.getWorldPosition(p);this.bone.getWorldQuaternion(q);var tr=helper.allocTransform();helper.setOriginFromThreeVector3(tr,p);helper.setBasisFromThreeQuaternion(tr,q);var form=helper.multiplyTransforms(tr,this.boneOffsetForm);helper.freeTransform(tr);helper.freeThreeQuaternion(q);helper.freeThreeVector3(p);return form;},getWorldTransformForBone:function getWorldTransformForBone(){var helper=this.helper;var tr=helper.allocTransform();this.body.getMotionState().getWorldTransform(tr);var tr2=helper.multiplyTransforms(tr,this.boneOffsetFormInverse);helper.freeTransform(tr);return tr2;},setTransformFromBone:function setTransformFromBone(){var helper=this.helper;var form=this.getBoneTransform();// TODO: check the most appropriate way to set
  //this.body.setWorldTransform( form );
  this.body.setCenterOfMassTransform(form);this.body.getMotionState().setWorldTransform(form);helper.freeTransform(form);},setPositionFromBone:function setPositionFromBone(){var helper=this.helper;var form=this.getBoneTransform();var tr=helper.allocTransform();this.body.getMotionState().getWorldTransform(tr);helper.copyOrigin(tr,form);// TODO: check the most appropriate way to set
  //this.body.setWorldTransform( tr );
  this.body.setCenterOfMassTransform(tr);this.body.getMotionState().setWorldTransform(tr);helper.freeTransform(tr);helper.freeTransform(form);},updateBoneRotation:function updateBoneRotation(){this.bone.updateMatrixWorld(true);var helper=this.helper;var tr=this.getWorldTransformForBone();var q=helper.getBasis(tr);var thQ=helper.allocThreeQuaternion();var thQ2=helper.allocThreeQuaternion();var thQ3=helper.allocThreeQuaternion();thQ.set(q.x(),q.y(),q.z(),q.w());thQ2.setFromRotationMatrix(this.bone.matrixWorld);thQ2.conjugate();thQ2.multiply(thQ);//this.bone.quaternion.multiply( thQ2 );
  thQ3.setFromRotationMatrix(this.bone.matrix);this.bone.quaternion.copy(thQ2.multiply(thQ3));helper.freeThreeQuaternion(thQ);helper.freeThreeQuaternion(thQ2);helper.freeThreeQuaternion(thQ3);helper.freeQuaternion(q);helper.freeTransform(tr);},updateBonePosition:function updateBonePosition(){var helper=this.helper;var tr=this.getWorldTransformForBone();var thV=helper.allocThreeVector3();var o=helper.getOrigin(tr);thV.set(o.x(),o.y(),o.z());var v=this.bone.worldToLocal(thV);this.bone.position.add(v);helper.freeThreeVector3(thV);helper.freeTransform(tr);}};MMDPhysics.Constraint=function(mesh,world,bodyA,bodyB,params,helper){this.mesh=mesh;this.world=world;this.bodyA=bodyA;this.bodyB=bodyB;this.params=params;this.helper=helper;this.constraint=null;this.init();};MMDPhysics.Constraint.prototype={constructor:MMDPhysics.Constraint,init:function init(){var helper=this.helper;var params=this.params;var bodyA=this.bodyA;var bodyB=this.bodyB;var form=helper.allocTransform();helper.setIdentity(form);helper.setOriginFromArray3(form,params.position);helper.setBasisFromArray3(form,params.rotation);var formA=helper.allocTransform();var formB=helper.allocTransform();bodyA.body.getMotionState().getWorldTransform(formA);bodyB.body.getMotionState().getWorldTransform(formB);var formInverseA=helper.inverseTransform(formA);var formInverseB=helper.inverseTransform(formB);var formA2=helper.multiplyTransforms(formInverseA,form);var formB2=helper.multiplyTransforms(formInverseB,form);var constraint=new Ammo.btGeneric6DofSpringConstraint(bodyA.body,bodyB.body,formA2,formB2,true);var lll=helper.allocVector3();var lul=helper.allocVector3();var all=helper.allocVector3();var aul=helper.allocVector3();lll.setValue(params.translationLimitation1[0],params.translationLimitation1[1],params.translationLimitation1[2]);lul.setValue(params.translationLimitation2[0],params.translationLimitation2[1],params.translationLimitation2[2]);all.setValue(params.rotationLimitation1[0],params.rotationLimitation1[1],params.rotationLimitation1[2]);aul.setValue(params.rotationLimitation2[0],params.rotationLimitation2[1],params.rotationLimitation2[2]);constraint.setLinearLowerLimit(lll);constraint.setLinearUpperLimit(lul);constraint.setAngularLowerLimit(all);constraint.setAngularUpperLimit(aul);for(var i=0;i<3;i++){if(params.springPosition[i]!==0){constraint.enableSpring(i,true);constraint.setStiffness(i,params.springPosition[i]);}}for(var i=0;i<3;i++){if(params.springRotation[i]!==0){constraint.enableSpring(i+3,true);constraint.setStiffness(i+3,params.springRotation[i]);}}/*
  		 * Currently(10/31/2016) official ammo.js doesn't support
  		 * btGeneric6DofSpringConstraint.setParam method.
  		 * You need custom ammo.js (add the method into idl) if you wanna use.
  		 * By setting this parameter, physics will be more like MMD's
  		 */if(constraint.setParam!==undefined){for(var i=0;i<6;i++){// this parameter is from http://www20.atpages.jp/katwat/three.js_r58/examples/mytest37/mmd.three.js
  constraint.setParam(2,0.475,i);}}this.world.addConstraint(constraint,true);this.constraint=constraint;helper.freeTransform(form);helper.freeTransform(formA);helper.freeTransform(formB);helper.freeTransform(formInverseA);helper.freeTransform(formInverseB);helper.freeTransform(formA2);helper.freeTransform(formB2);helper.freeVector3(lll);helper.freeVector3(lul);helper.freeVector3(all);helper.freeVector3(aul);}};var MMDPhysicsHelper=function MMDPhysicsHelper(mesh){if(mesh.physics===undefined||mesh.geometry.rigidBodies===undefined){throw'MMDPhysicsHelper requires physics in mesh and rigidBodies in mesh.geometry.';}Object3D.call(this);this.root=mesh;this.matrix=mesh.matrixWorld;this.matrixAutoUpdate=false;this.materials=[];this.materials.push(new MeshBasicMaterial({color:new Color$1(0xff8888),wireframe:true,depthTest:false,depthWrite:false,opacity:0.25,transparent:true}));this.materials.push(new MeshBasicMaterial({color:new Color$1(0x88ff88),wireframe:true,depthTest:false,depthWrite:false,opacity:0.25,transparent:true}));this.materials.push(new MeshBasicMaterial({color:new Color$1(0x8888ff),wireframe:true,depthTest:false,depthWrite:false,opacity:0.25,transparent:true}));this._init();this.update();};MMDPhysicsHelper.prototype=Object.create(Object3D.prototype);MMDPhysicsHelper.prototype.constructor=MMDPhysicsHelper;MMDPhysicsHelper.prototype._init=function(){var this$1=this;var mesh=this.root;var rigidBodies=mesh.geometry.rigidBodies;function createGeometry(param){switch(param.shapeType){case 0:return new SphereBufferGeometry(param.width,16,8);case 1:return new BoxBufferGeometry(param.width*2,param.height*2,param.depth*2,8,8,8);case 2:return new createCapsuleGeometry(param.width,param.height,16,8);default:return null;}}// copy from http://www20.atpages.jp/katwat/three.js_r58/examples/mytest37/mytest37.js?ver=20160815
  function createCapsuleGeometry(radius,cylinderHeight,segmentsRadius,segmentsHeight){var geometry=new CylinderBufferGeometry(radius,radius,cylinderHeight,segmentsRadius,segmentsHeight,true);var upperSphere=new Mesh(new SphereBufferGeometry(radius,segmentsRadius,segmentsHeight,0,Math.PI*2,0,Math.PI/2));var lowerSphere=new Mesh(new SphereBufferGeometry(radius,segmentsRadius,segmentsHeight,0,Math.PI*2,Math.PI/2,Math.PI/2));upperSphere.position.set(0,cylinderHeight/2,0);lowerSphere.position.set(0,-cylinderHeight/2,0);upperSphere.updateMatrix();lowerSphere.updateMatrix();geometry.merge(upperSphere.geometry,upperSphere.matrix);geometry.merge(lowerSphere.geometry,lowerSphere.matrix);return geometry;}for(var i=0,il=rigidBodies.length;i<il;i++){var param=rigidBodies[i];this$1.add(new Mesh(createGeometry(param),this$1.materials[param.type]));}};MMDPhysicsHelper.prototype.update=function(){var this$1=this;var mesh=this.root;var rigidBodies=mesh.geometry.rigidBodies;var bodies=mesh.physics.bodies;var matrixWorldInv=new Matrix4().getInverse(mesh.matrixWorld);var vector=new Vector3$1();var quaternion=new Quaternion();var quaternion2=new Quaternion();function getPosition(origin){vector.set(origin.x(),origin.y(),origin.z());vector.applyMatrix4(matrixWorldInv);return vector;}function getQuaternion(rotation){quaternion.set(rotation.x(),rotation.y(),rotation.z(),rotation.w());quaternion2.setFromRotationMatrix(matrixWorldInv);quaternion2.multiply(quaternion);return quaternion2;}for(var i=0,il=rigidBodies.length;i<il;i++){var body=bodies[i].body;var mesh=this$1.children[i];var tr=body.getCenterOfMassTransform();mesh.position.copy(getPosition(tr.getOrigin()));mesh.quaternion.copy(getQuaternion(tr.getRotation()));}};/**
   *
   * A Track that interpolates Strings
   *
   *
   * @author Ben Houston / http://clara.io/
   * @author David Sarno / http://lighthaus.us/
   * @author tschw
   */function StringKeyframeTrack(name,times,values,interpolation){KeyframeTrack.call(this,name,times,values,interpolation);}StringKeyframeTrack.prototype=Object.assign(Object.create(KeyframeTrack.prototype),{constructor:StringKeyframeTrack,ValueTypeName:'string',ValueBufferType:Array,DefaultInterpolation:InterpolateDiscrete,InterpolantFactoryMethodLinear:undefined,InterpolantFactoryMethodSmooth:undefined});/**
   *
   * A Track of Boolean keyframe values.
   *
   *
   * @author Ben Houston / http://clara.io/
   * @author David Sarno / http://lighthaus.us/
   * @author tschw
   */function BooleanKeyframeTrack(name,times,values){KeyframeTrack.call(this,name,times,values);}BooleanKeyframeTrack.prototype=Object.assign(Object.create(KeyframeTrack.prototype),{constructor:BooleanKeyframeTrack,ValueTypeName:'bool',ValueBufferType:Array,DefaultInterpolation:InterpolateDiscrete,InterpolantFactoryMethodLinear:undefined,InterpolantFactoryMethodSmooth:undefined// Note: Actually this track could have a optimized / compressed
  // representation of a single value and a custom interpolant that
  // computes "firstValue ^ isOdd( index )".
  });/**
   * Abstract base class of interpolants over parametric samples.
   *
   * The parameter domain is one dimensional, typically the time or a path
   * along a curve defined by the data.
   *
   * The sample values can have any dimensionality and derived classes may
   * apply special interpretations to the data.
   *
   * This class provides the interval seek in a Template Method, deferring
   * the actual interpolation to derived classes.
   *
   * Time complexity is O(1) for linear access crossing at most two points
   * and O(log N) for random access, where N is the number of positions.
   *
   * References:
   *
   * 		http://www.oodesign.com/template-method-pattern.html
   *
   * @author tschw
   */function Interpolant$1(parameterPositions,sampleValues,sampleSize,resultBuffer){this.parameterPositions=parameterPositions;this._cachedIndex=0;this.resultBuffer=resultBuffer!==undefined?resultBuffer:new sampleValues.constructor(sampleSize);this.sampleValues=sampleValues;this.valueSize=sampleSize;}Object.assign(Interpolant$1.prototype,{evaluate:function evaluate(t){var this$1=this;var pp=this.parameterPositions,i1=this._cachedIndex,t1=pp[i1],t0=pp[i1-1];validate_interval:{seek:{var right;linear_scan:{//- See http://jsperf.com/comparison-to-undefined/3
  //- slower code:
  //-
  //- 				if ( t >= t1 || t1 === undefined ) {
  forward_scan:if(!(t<t1)){for(var giveUpAt=i1+2;;){if(t1===undefined){if(t<t0){break forward_scan;}// after end
  i1=pp.length;this$1._cachedIndex=i1;return this$1.afterEnd_(i1-1,t,t0);}if(i1===giveUpAt){break;}// this loop
  t0=t1;t1=pp[++i1];if(t<t1){// we have arrived at the sought interval
  break seek;}}// prepare binary search on the right side of the index
  right=pp.length;break linear_scan;}//- slower code:
  //-					if ( t < t0 || t0 === undefined ) {
  if(!(t>=t0)){// looping?
  var t1global=pp[1];if(t<t1global){i1=2;// + 1, using the scan for the details
  t0=t1global;}// linear reverse scan
  for(var giveUpAt=i1-2;;){if(t0===undefined){// before start
  this$1._cachedIndex=0;return this$1.beforeStart_(0,t,t1);}if(i1===giveUpAt){break;}// this loop
  t1=t0;t0=pp[--i1-1];if(t>=t0){// we have arrived at the sought interval
  break seek;}}// prepare binary search on the left side of the index
  right=i1;i1=0;break linear_scan;}// the interval is valid
  break validate_interval;}// linear scan
  // binary search
  while(i1<right){var mid=i1+right>>>1;if(t<pp[mid]){right=mid;}else{i1=mid+1;}}t1=pp[i1];t0=pp[i1-1];// check boundary cases, again
  if(t0===undefined){this._cachedIndex=0;return this.beforeStart_(0,t,t1);}if(t1===undefined){i1=pp.length;this._cachedIndex=i1;return this.afterEnd_(i1-1,t0,t);}}// seek
  this._cachedIndex=i1;this.intervalChanged_(i1,t0,t1);}// validate_interval
  return this.interpolate_(i1,t0,t,t1);},settings:null,// optional, subclass-specific settings structure
  // Note: The indirection allows central control of many interpolants.
  // --- Protected interface
  DefaultSettings_:{},getSettings_:function getSettings_(){return this.settings||this.DefaultSettings_;},copySampleValue_:function copySampleValue_(index){// copies a sample value to the result buffer
  var result=this.resultBuffer,values=this.sampleValues,stride=this.valueSize,offset=index*stride;for(var i=0;i!==stride;++i){result[i]=values[offset+i];}return result;},// Template methods for derived classes:
  interpolate_:function interpolate_()/* i1, t0, t, t1 */{throw new Error('call to abstract method');// implementations shall return this.resultBuffer
  },intervalChanged_:function intervalChanged_()/* i1, t0, t1 */{// empty
  }});//!\ DECLARE ALIAS AFTER assign prototype !
  Object.assign(Interpolant$1.prototype,{//( 0, t, t0 ), returns this.resultBuffer
  beforeStart_:Interpolant$1.prototype.copySampleValue_,//( N-1, tN-1, t ), returns this.resultBuffer
  afterEnd_:Interpolant$1.prototype.copySampleValue_});/**
   * Spherical linear unit quaternion interpolant.
   *
   * @author tschw
   */function QuaternionLinearInterpolant(parameterPositions,sampleValues,sampleSize,resultBuffer){Interpolant$1.call(this,parameterPositions,sampleValues,sampleSize,resultBuffer);}QuaternionLinearInterpolant.prototype=Object.assign(Object.create(Interpolant$1.prototype),{constructor:QuaternionLinearInterpolant,interpolate_:function interpolate_(i1,t0,t,t1){var result=this.resultBuffer,values=this.sampleValues,stride=this.valueSize,offset=i1*stride,alpha=(t-t0)/(t1-t0);for(var end=offset+stride;offset!==end;offset+=4){Quaternion.slerpFlat(result,0,values,offset-stride,values,offset,alpha);}return result;}});/**
   *
   * A Track of quaternion keyframe values.
   *
   * @author Ben Houston / http://clara.io/
   * @author David Sarno / http://lighthaus.us/
   * @author tschw
   */function QuaternionKeyframeTrack$1(name,times,values,interpolation){KeyframeTrack.call(this,name,times,values,interpolation);}QuaternionKeyframeTrack$1.prototype=Object.assign(Object.create(KeyframeTrack.prototype),{constructor:QuaternionKeyframeTrack$1,ValueTypeName:'quaternion',// ValueBufferType is inherited
  DefaultInterpolation:InterpolateLinear,InterpolantFactoryMethodLinear:function InterpolantFactoryMethodLinear(result){return new QuaternionLinearInterpolant(this.times,this.values,this.getValueSize(),result);},InterpolantFactoryMethodSmooth:undefined// not yet implemented
  });/**
   *
   * A Track of keyframe values that represent color.
   *
   *
   * @author Ben Houston / http://clara.io/
   * @author David Sarno / http://lighthaus.us/
   * @author tschw
   */function ColorKeyframeTrack(name,times,values,interpolation){KeyframeTrack.call(this,name,times,values,interpolation);}ColorKeyframeTrack.prototype=Object.assign(Object.create(KeyframeTrack.prototype),{constructor:ColorKeyframeTrack,ValueTypeName:'color'// ValueBufferType is inherited
  // DefaultInterpolation is inherited
  // Note: Very basic implementation and nothing special yet.
  // However, this is the place for color space parameterization.
  });/**
   *
   * A Track of vectored keyframe values.
   *
   *
   * @author Ben Houston / http://clara.io/
   * @author David Sarno / http://lighthaus.us/
   * @author tschw
   */function VectorKeyframeTrack$1(name,times,values,interpolation){KeyframeTrack.call(this,name,times,values,interpolation);}VectorKeyframeTrack$1.prototype=Object.assign(Object.create(KeyframeTrack.prototype),{constructor:VectorKeyframeTrack$1,ValueTypeName:'vector'// ValueBufferType is inherited
  // DefaultInterpolation is inherited
  });/**
   * Fast and simple cubic spline interpolant.
   *
   * It was derived from a Hermitian construction setting the first derivative
   * at each sample position to the linear slope between neighboring positions
   * over their parameter interval.
   *
   * @author tschw
   */function CubicInterpolant(parameterPositions,sampleValues,sampleSize,resultBuffer){Interpolant$1.call(this,parameterPositions,sampleValues,sampleSize,resultBuffer);this._weightPrev=-0;this._offsetPrev=-0;this._weightNext=-0;this._offsetNext=-0;}CubicInterpolant.prototype=Object.assign(Object.create(Interpolant$1.prototype),{constructor:CubicInterpolant,DefaultSettings_:{endingStart:ZeroCurvatureEnding,endingEnd:ZeroCurvatureEnding},intervalChanged_:function intervalChanged_(i1,t0,t1){var pp=this.parameterPositions,iPrev=i1-2,iNext=i1+1,tPrev=pp[iPrev],tNext=pp[iNext];if(tPrev===undefined){switch(this.getSettings_().endingStart){case ZeroSlopeEnding:// f'(t0) = 0
  iPrev=i1;tPrev=2*t0-t1;break;case WrapAroundEnding:// use the other end of the curve
  iPrev=pp.length-2;tPrev=t0+pp[iPrev]-pp[iPrev+1];break;default:// ZeroCurvatureEnding
  // f''(t0) = 0 a.k.a. Natural Spline
  iPrev=i1;tPrev=t1;}}if(tNext===undefined){switch(this.getSettings_().endingEnd){case ZeroSlopeEnding:// f'(tN) = 0
  iNext=i1;tNext=2*t1-t0;break;case WrapAroundEnding:// use the other end of the curve
  iNext=1;tNext=t1+pp[1]-pp[0];break;default:// ZeroCurvatureEnding
  // f''(tN) = 0, a.k.a. Natural Spline
  iNext=i1-1;tNext=t0;}}var halfDt=(t1-t0)*0.5,stride=this.valueSize;this._weightPrev=halfDt/(t0-tPrev);this._weightNext=halfDt/(tNext-t1);this._offsetPrev=iPrev*stride;this._offsetNext=iNext*stride;},interpolate_:function interpolate_(i1,t0,t,t1){var result=this.resultBuffer,values=this.sampleValues,stride=this.valueSize,o1=i1*stride,o0=o1-stride,oP=this._offsetPrev,oN=this._offsetNext,wP=this._weightPrev,wN=this._weightNext,p=(t-t0)/(t1-t0),pp=p*p,ppp=pp*p;// evaluate polynomials
  var sP=-wP*ppp+2*wP*pp-wP*p;var s0=(1+wP)*ppp+(-1.5-2*wP)*pp+(-0.5+wP)*p+1;var s1=(-1-wN)*ppp+(1.5+wN)*pp+0.5*p;var sN=wN*ppp-wN*pp;// combine data linearly
  for(var i=0;i!==stride;++i){result[i]=sP*values[oP+i]+s0*values[o0+i]+s1*values[o1+i]+sN*values[oN+i];}return result;}});/**
   * @author tschw
   */function LinearInterpolant(parameterPositions,sampleValues,sampleSize,resultBuffer){Interpolant$1.call(this,parameterPositions,sampleValues,sampleSize,resultBuffer);}LinearInterpolant.prototype=Object.assign(Object.create(Interpolant$1.prototype),{constructor:LinearInterpolant,interpolate_:function interpolate_(i1,t0,t,t1){var result=this.resultBuffer,values=this.sampleValues,stride=this.valueSize,offset1=i1*stride,offset0=offset1-stride,weight1=(t-t0)/(t1-t0),weight0=1-weight1;for(var i=0;i!==stride;++i){result[i]=values[offset0+i]*weight0+values[offset1+i]*weight1;}return result;}});/**
   *
   * Interpolant that evaluates to the sample value at the position preceeding
   * the parameter.
   *
   * @author tschw
   */function DiscreteInterpolant(parameterPositions,sampleValues,sampleSize,resultBuffer){Interpolant$1.call(this,parameterPositions,sampleValues,sampleSize,resultBuffer);}DiscreteInterpolant.prototype=Object.assign(Object.create(Interpolant$1.prototype),{constructor:DiscreteInterpolant,interpolate_:function interpolate_(i1/* t0, t, t1 */){return this.copySampleValue_(i1-1);}});/**
   * @author tschw
   * @author Ben Houston / http://clara.io/
   * @author David Sarno / http://lighthaus.us/
   */var AnimationUtils={// same as Array.prototype.slice, but also works on typed arrays
  arraySlice:function arraySlice(array,from,to){if(AnimationUtils.isTypedArray(array)){// in ios9 array.subarray(from, undefined) will return empty array
  // but array.subarray(from) or array.subarray(from, len) is correct
  return new array.constructor(array.subarray(from,to!==undefined?to:array.length));}return array.slice(from,to);},// converts an array to a specific type
  convertArray:function convertArray(array,type,forceClone){if(!array||// let 'undefined' and 'null' pass
  !forceClone&&array.constructor===type){return array;}if(typeof type.BYTES_PER_ELEMENT==='number'){return new type(array);// create typed array
  }return Array.prototype.slice.call(array);// create Array
  },isTypedArray:function isTypedArray(object){return ArrayBuffer.isView(object)&&!(object instanceof DataView);},// returns an array by which times and values can be sorted
  getKeyframeOrder:function getKeyframeOrder(times){function compareTime(i,j){return times[i]-times[j];}var n=times.length;var result=new Array(n);for(var i=0;i!==n;++i){result[i]=i;}result.sort(compareTime);return result;},// uses the array previously returned by 'getKeyframeOrder' to sort data
  sortedArray:function sortedArray(values,stride,order){var nValues=values.length;var result=new values.constructor(nValues);for(var i=0,dstOffset=0;dstOffset!==nValues;++i){var srcOffset=order[i]*stride;for(var j=0;j!==stride;++j){result[dstOffset++]=values[srcOffset+j];}}return result;},// function for parsing AOS keyframe formats
  flattenJSON:function flattenJSON(jsonKeys,times,values,valuePropertyName){var i=1,key=jsonKeys[0];while(key!==undefined&&key[valuePropertyName]===undefined){key=jsonKeys[i++];}if(key===undefined){return;}// no data
  var value=key[valuePropertyName];if(value===undefined){return;}// no data
  if(Array.isArray(value)){do{value=key[valuePropertyName];if(value!==undefined){times.push(key.time);values.push.apply(values,value);// push all elements
  }key=jsonKeys[i++];}while(key!==undefined);}else if(value.toArray!==undefined){// ...assume THREE.Math-ish
  do{value=key[valuePropertyName];if(value!==undefined){times.push(key.time);value.toArray(values,values.length);}key=jsonKeys[i++];}while(key!==undefined);}else{// otherwise push as-is
  do{value=key[valuePropertyName];if(value!==undefined){times.push(key.time);values.push(value);}key=jsonKeys[i++];}while(key!==undefined);}}};/**
   *
   * A timed sequence of keyframes for a specific property.
   *
   *
   * @author Ben Houston / http://clara.io/
   * @author David Sarno / http://lighthaus.us/
   * @author tschw
   */function KeyframeTrack(name,times,values,interpolation){if(name===undefined){throw new Error('THREE.KeyframeTrack: track name is undefined');}if(times===undefined||times.length===0){throw new Error('THREE.KeyframeTrack: no keyframes in track named '+name);}this.name=name;this.times=AnimationUtils.convertArray(times,this.TimeBufferType);this.values=AnimationUtils.convertArray(values,this.ValueBufferType);this.setInterpolation(interpolation||this.DefaultInterpolation);this.validate();this.optimize();}// Static methods:
  Object.assign(KeyframeTrack,{// Serialization (in static context, because of constructor invocation
  // and automatic invocation of .toJSON):
  parse:function parse(json){if(json.type===undefined){throw new Error('THREE.KeyframeTrack: track type undefined, can not parse');}var trackType=KeyframeTrack._getTrackTypeForValueTypeName(json.type);if(json.times===undefined){var times=[],values=[];AnimationUtils.flattenJSON(json.keys,times,values,'value');json.times=times;json.values=values;}// derived classes can define a static parse method
  if(trackType.parse!==undefined){return trackType.parse(json);}else{// by default, we assume a constructor compatible with the base
  return new trackType(json.name,json.times,json.values,json.interpolation);}},toJSON:function toJSON(track){var trackType=track.constructor;var json;// derived classes can define a static toJSON method
  if(trackType.toJSON!==undefined){json=trackType.toJSON(track);}else{// by default, we assume the data can be serialized as-is
  json={'name':track.name,'times':AnimationUtils.convertArray(track.times,Array),'values':AnimationUtils.convertArray(track.values,Array)};var interpolation=track.getInterpolation();if(interpolation!==track.DefaultInterpolation){json.interpolation=interpolation;}}json.type=track.ValueTypeName;// mandatory
  return json;},_getTrackTypeForValueTypeName:function _getTrackTypeForValueTypeName(typeName){switch(typeName.toLowerCase()){case'scalar':case'double':case'float':case'number':case'integer':return NumberKeyframeTrack$1;case'vector':case'vector2':case'vector3':case'vector4':return VectorKeyframeTrack$1;case'color':return ColorKeyframeTrack;case'quaternion':return QuaternionKeyframeTrack$1;case'bool':case'boolean':return BooleanKeyframeTrack;case'string':return StringKeyframeTrack;}throw new Error('THREE.KeyframeTrack: Unsupported typeName: '+typeName);}});Object.assign(KeyframeTrack.prototype,{constructor:KeyframeTrack,TimeBufferType:Float32Array,ValueBufferType:Float32Array,DefaultInterpolation:InterpolateLinear,InterpolantFactoryMethodDiscrete:function InterpolantFactoryMethodDiscrete(result){return new DiscreteInterpolant(this.times,this.values,this.getValueSize(),result);},InterpolantFactoryMethodLinear:function InterpolantFactoryMethodLinear(result){return new LinearInterpolant(this.times,this.values,this.getValueSize(),result);},InterpolantFactoryMethodSmooth:function InterpolantFactoryMethodSmooth(result){return new CubicInterpolant(this.times,this.values,this.getValueSize(),result);},setInterpolation:function setInterpolation(interpolation){var factoryMethod;switch(interpolation){case InterpolateDiscrete:factoryMethod=this.InterpolantFactoryMethodDiscrete;break;case InterpolateLinear:factoryMethod=this.InterpolantFactoryMethodLinear;break;case InterpolateSmooth:factoryMethod=this.InterpolantFactoryMethodSmooth;break;}if(factoryMethod===undefined){var message="unsupported interpolation for "+this.ValueTypeName+" keyframe track named "+this.name;if(this.createInterpolant===undefined){// fall back to default, unless the default itself is messed up
  if(interpolation!==this.DefaultInterpolation){this.setInterpolation(this.DefaultInterpolation);}else{throw new Error(message);// fatal, in this case
  }}console.warn('THREE.KeyframeTrack:',message);return;}this.createInterpolant=factoryMethod;},getInterpolation:function getInterpolation(){switch(this.createInterpolant){case this.InterpolantFactoryMethodDiscrete:return InterpolateDiscrete;case this.InterpolantFactoryMethodLinear:return InterpolateLinear;case this.InterpolantFactoryMethodSmooth:return InterpolateSmooth;}},getValueSize:function getValueSize(){return this.values.length/this.times.length;},// move all keyframes either forwards or backwards in time
  shift:function shift(timeOffset){if(timeOffset!==0.0){var times=this.times;for(var i=0,n=times.length;i!==n;++i){times[i]+=timeOffset;}}return this;},// scale all keyframe times by a factor (useful for frame <-> seconds conversions)
  scale:function scale(timeScale){if(timeScale!==1.0){var times=this.times;for(var i=0,n=times.length;i!==n;++i){times[i]*=timeScale;}}return this;},// removes keyframes before and after animation without changing any values within the range [startTime, endTime].
  // IMPORTANT: We do not shift around keys to the start of the track time, because for interpolated keys this will change their values
  trim:function trim(startTime,endTime){var times=this.times,nKeys=times.length,from=0,to=nKeys-1;while(from!==nKeys&&times[from]<startTime){++from;}while(to!==-1&&times[to]>endTime){--to;}++to;// inclusive -> exclusive bound
  if(from!==0||to!==nKeys){// empty tracks are forbidden, so keep at least one keyframe
  if(from>=to){to=Math.max(to,1), from=to-1;}var stride=this.getValueSize();this.times=AnimationUtils.arraySlice(times,from,to);this.values=AnimationUtils.arraySlice(this.values,from*stride,to*stride);}return this;},// ensure we do not get a GarbageInGarbageOut situation, make sure tracks are at least minimally viable
  validate:function validate(){var this$1=this;var valid=true;var valueSize=this.getValueSize();if(valueSize-Math.floor(valueSize)!==0){console.error('THREE.KeyframeTrack: Invalid value size in track.',this);valid=false;}var times=this.times,values=this.values,nKeys=times.length;if(nKeys===0){console.error('THREE.KeyframeTrack: Track is empty.',this);valid=false;}var prevTime=null;for(var i=0;i!==nKeys;i++){var currTime=times[i];if(typeof currTime==='number'&&isNaN(currTime)){console.error('THREE.KeyframeTrack: Time is not a valid number.',this$1,i,currTime);valid=false;break;}if(prevTime!==null&&prevTime>currTime){console.error('THREE.KeyframeTrack: Out of order keys.',this$1,i,currTime,prevTime);valid=false;break;}prevTime=currTime;}if(values!==undefined){if(AnimationUtils.isTypedArray(values)){for(var i=0,n=values.length;i!==n;++i){var value=values[i];if(isNaN(value)){console.error('THREE.KeyframeTrack: Value is not a valid number.',this$1,i,value);valid=false;break;}}}}return valid;},// removes equivalent sequential keys as common in morph target sequences
  // (0,0,0,0,1,1,1,0,0,0,0,0,0,0) --> (0,0,1,1,0,0)
  optimize:function optimize(){var times=this.times,values=this.values,stride=this.getValueSize(),smoothInterpolation=this.getInterpolation()===InterpolateSmooth,writeIndex=1,lastIndex=times.length-1;for(var i=1;i<lastIndex;++i){var keep=false;var time=times[i];var timeNext=times[i+1];// remove adjacent keyframes scheduled at the same time
  if(time!==timeNext&&(i!==1||time!==time[0])){if(!smoothInterpolation){// remove unnecessary keyframes same as their neighbors
  var offset=i*stride,offsetP=offset-stride,offsetN=offset+stride;for(var j=0;j!==stride;++j){var value=values[offset+j];if(value!==values[offsetP+j]||value!==values[offsetN+j]){keep=true;break;}}}else{keep=true;}}// in-place compaction
  if(keep){if(i!==writeIndex){times[writeIndex]=times[i];var readOffset=i*stride,writeOffset=writeIndex*stride;for(var j=0;j!==stride;++j){values[writeOffset+j]=values[readOffset+j];}}++writeIndex;}}// flush last keyframe (compaction looks ahead)
  if(lastIndex>0){times[writeIndex]=times[lastIndex];for(var readOffset=lastIndex*stride,writeOffset=writeIndex*stride,j=0;j!==stride;++j){values[writeOffset+j]=values[readOffset+j];}++writeIndex;}if(writeIndex!==times.length){this.times=AnimationUtils.arraySlice(times,0,writeIndex);this.values=AnimationUtils.arraySlice(values,0,writeIndex*stride);}return this;}});/**
   *
   * A Track of numeric keyframe values.
   *
   * @author Ben Houston / http://clara.io/
   * @author David Sarno / http://lighthaus.us/
   * @author tschw
   */function NumberKeyframeTrack$1(name,times,values,interpolation){KeyframeTrack.call(this,name,times,values,interpolation);}NumberKeyframeTrack$1.prototype=Object.assign(Object.create(KeyframeTrack.prototype),{constructor:NumberKeyframeTrack$1,ValueTypeName:'number'// ValueBufferType is inherited
  // DefaultInterpolation is inherited
  });/**
   *
   * Reusable set of Tracks that represent an animation.
   *
   * @author Ben Houston / http://clara.io/
   * @author David Sarno / http://lighthaus.us/
   */function AnimationClip$1(name,duration,tracks){this.name=name;this.tracks=tracks;this.duration=duration!==undefined?duration:-1;this.uuid=_Math$1.generateUUID();// this means it should figure out its duration by scanning the tracks
  if(this.duration<0){this.resetDuration();}this.optimize();}Object.assign(AnimationClip$1,{parse:function parse(json){var tracks=[],jsonTracks=json.tracks,frameTime=1.0/(json.fps||1.0);for(var i=0,n=jsonTracks.length;i!==n;++i){tracks.push(KeyframeTrack.parse(jsonTracks[i]).scale(frameTime));}return new AnimationClip$1(json.name,json.duration,tracks);},toJSON:function toJSON(clip){var tracks=[],clipTracks=clip.tracks;var json={'name':clip.name,'duration':clip.duration,'tracks':tracks};for(var i=0,n=clipTracks.length;i!==n;++i){tracks.push(KeyframeTrack.toJSON(clipTracks[i]));}return json;},CreateFromMorphTargetSequence:function CreateFromMorphTargetSequence(name,morphTargetSequence,fps,noLoop){var numMorphTargets=morphTargetSequence.length;var tracks=[];for(var i=0;i<numMorphTargets;i++){var times=[];var values=[];times.push((i+numMorphTargets-1)%numMorphTargets,i,(i+1)%numMorphTargets);values.push(0,1,0);var order=AnimationUtils.getKeyframeOrder(times);times=AnimationUtils.sortedArray(times,1,order);values=AnimationUtils.sortedArray(values,1,order);// if there is a key at the first frame, duplicate it as the
  // last frame as well for perfect loop.
  if(!noLoop&&times[0]===0){times.push(numMorphTargets);values.push(values[0]);}tracks.push(new NumberKeyframeTrack$1('.morphTargetInfluences['+morphTargetSequence[i].name+']',times,values).scale(1.0/fps));}return new AnimationClip$1(name,-1,tracks);},findByName:function findByName(objectOrClipArray,name){var clipArray=objectOrClipArray;if(!Array.isArray(objectOrClipArray)){var o=objectOrClipArray;clipArray=o.geometry&&o.geometry.animations||o.animations;}for(var i=0;i<clipArray.length;i++){if(clipArray[i].name===name){return clipArray[i];}}return null;},CreateClipsFromMorphTargetSequences:function CreateClipsFromMorphTargetSequences(morphTargets,fps,noLoop){var animationToMorphTargets={};// tested with https://regex101.com/ on trick sequences
  // such flamingo_flyA_003, flamingo_run1_003, crdeath0059
  var pattern=/^([\w-]*?)([\d]+)$/;// sort morph target names into animation groups based
  // patterns like Walk_001, Walk_002, Run_001, Run_002
  for(var i=0,il=morphTargets.length;i<il;i++){var morphTarget=morphTargets[i];var parts=morphTarget.name.match(pattern);if(parts&&parts.length>1){var name=parts[1];var animationMorphTargets=animationToMorphTargets[name];if(!animationMorphTargets){animationToMorphTargets[name]=animationMorphTargets=[];}animationMorphTargets.push(morphTarget);}}var clips=[];for(var name in animationToMorphTargets){clips.push(AnimationClip$1.CreateFromMorphTargetSequence(name,animationToMorphTargets[name],fps,noLoop));}return clips;},// parse the animation.hierarchy format
  parseAnimation:function parseAnimation(animation,bones){if(!animation){console.error('THREE.AnimationClip: No animation in JSONLoader data.');return null;}var addNonemptyTrack=function addNonemptyTrack(trackType,trackName,animationKeys,propertyName,destTracks){// only return track if there are actually keys.
  if(animationKeys.length!==0){var times=[];var values=[];AnimationUtils.flattenJSON(animationKeys,times,values,propertyName);// empty keys are filtered out, so check again
  if(times.length!==0){destTracks.push(new trackType(trackName,times,values));}}};var tracks=[];var clipName=animation.name||'default';// automatic length determination in AnimationClip.
  var duration=animation.length||-1;var fps=animation.fps||30;var hierarchyTracks=animation.hierarchy||[];for(var h=0;h<hierarchyTracks.length;h++){var animationKeys=hierarchyTracks[h].keys;// skip empty tracks
  if(!animationKeys||animationKeys.length===0){continue;}// process morph targets
  if(animationKeys[0].morphTargets){// figure out all morph targets used in this track
  var morphTargetNames={};for(var k=0;k<animationKeys.length;k++){if(animationKeys[k].morphTargets){for(var m=0;m<animationKeys[k].morphTargets.length;m++){morphTargetNames[animationKeys[k].morphTargets[m]]=-1;}}}// create a track for each morph target with all zero
  // morphTargetInfluences except for the keys in which
  // the morphTarget is named.
  for(var morphTargetName in morphTargetNames){var times=[];var values=[];for(var m=0;m!==animationKeys[k].morphTargets.length;++m){var animationKey=animationKeys[k];times.push(animationKey.time);values.push(animationKey.morphTarget===morphTargetName?1:0);}tracks.push(new NumberKeyframeTrack$1('.morphTargetInfluence['+morphTargetName+']',times,values));}duration=morphTargetNames.length*(fps||1.0);}else{// ...assume skeletal animation
  var boneName='.bones['+bones[h].name+']';addNonemptyTrack(VectorKeyframeTrack$1,boneName+'.position',animationKeys,'pos',tracks);addNonemptyTrack(QuaternionKeyframeTrack$1,boneName+'.quaternion',animationKeys,'rot',tracks);addNonemptyTrack(VectorKeyframeTrack$1,boneName+'.scale',animationKeys,'scl',tracks);}}if(tracks.length===0){return null;}var clip=new AnimationClip$1(clipName,duration,tracks);return clip;}});Object.assign(AnimationClip$1.prototype,{resetDuration:function resetDuration(){var this$1=this;var tracks=this.tracks,duration=0;for(var i=0,n=tracks.length;i!==n;++i){var track=this$1.tracks[i];duration=Math.max(duration,track.times[track.times.length-1]);}this.duration=duration;},trim:function trim(){var this$1=this;for(var i=0;i<this.tracks.length;i++){this$1.tracks[i].trim(0,this$1.duration);}return this;},optimize:function optimize(){var this$1=this;for(var i=0;i<this.tracks.length;i++){this$1.tracks[i].optimize();}return this;}});/**
   *
   * Creator of typical test AnimationClips / KeyframeTracks
   *
   * @author Ben Houston / http://clara.io/
   * @author David Sarno / http://lighthaus.us/
   */function Camera(){Object3D.call(this);this.type='Camera';this.matrixWorldInverse=new Matrix4();this.projectionMatrix=new Matrix4();}Camera.prototype=Object.assign(Object.create(Object3D.prototype),{constructor:Camera,isCamera:true,copy:function copy(source,recursive){Object3D.prototype.copy.call(this,source,recursive);this.matrixWorldInverse.copy(source.matrixWorldInverse);this.projectionMatrix.copy(source.projectionMatrix);return this;},getWorldDirection:function(){var quaternion=new Quaternion();return function getWorldDirection(optionalTarget){var result=optionalTarget||new Vector3$1();this.getWorldQuaternion(quaternion);return result.set(0,0,-1).applyQuaternion(quaternion);};}(),updateMatrixWorld:function updateMatrixWorld(force){Object3D.prototype.updateMatrixWorld.call(this,force);this.matrixWorldInverse.getInverse(this.matrixWorld);},clone:function clone(){return new this.constructor().copy(this);}});/**
   * @author mrdoob / http://mrdoob.com/
   * @author greggman / http://games.greggman.com/
   * @author zz85 / http://www.lab4games.net/zz85/blog
   * @author tschw
   */function PerspectiveCamera(fov,aspect,near,far){Camera.call(this);this.type='PerspectiveCamera';this.fov=fov!==undefined?fov:50;this.zoom=1;this.near=near!==undefined?near:0.1;this.far=far!==undefined?far:2000;this.focus=10;this.aspect=aspect!==undefined?aspect:1;this.view=null;this.filmGauge=35;// width of the film (default in millimeters)
  this.filmOffset=0;// horizontal film offset (same unit as gauge)
  this.updateProjectionMatrix();}PerspectiveCamera.prototype=Object.assign(Object.create(Camera.prototype),{constructor:PerspectiveCamera,isPerspectiveCamera:true,copy:function copy(source,recursive){Camera.prototype.copy.call(this,source,recursive);this.fov=source.fov;this.zoom=source.zoom;this.near=source.near;this.far=source.far;this.focus=source.focus;this.aspect=source.aspect;this.view=source.view===null?null:Object.assign({},source.view);this.filmGauge=source.filmGauge;this.filmOffset=source.filmOffset;return this;},/**
  	 * Sets the FOV by focal length in respect to the current .filmGauge.
  	 *
  	 * The default film gauge is 35, so that the focal length can be specified for
  	 * a 35mm (full frame) camera.
  	 *
  	 * Values for focal length and film gauge must have the same unit.
  	 */setFocalLength:function setFocalLength(focalLength){// see http://www.bobatkins.com/photography/technical/field_of_view.html
  var vExtentSlope=0.5*this.getFilmHeight()/focalLength;this.fov=_Math$1.RAD2DEG*2*Math.atan(vExtentSlope);this.updateProjectionMatrix();},/**
  	 * Calculates the focal length from the current .fov and .filmGauge.
  	 */getFocalLength:function getFocalLength(){var vExtentSlope=Math.tan(_Math$1.DEG2RAD*0.5*this.fov);return 0.5*this.getFilmHeight()/vExtentSlope;},getEffectiveFOV:function getEffectiveFOV(){return _Math$1.RAD2DEG*2*Math.atan(Math.tan(_Math$1.DEG2RAD*0.5*this.fov)/this.zoom);},getFilmWidth:function getFilmWidth(){// film not completely covered in portrait format (aspect < 1)
  return this.filmGauge*Math.min(this.aspect,1);},getFilmHeight:function getFilmHeight(){// film not completely covered in landscape format (aspect > 1)
  return this.filmGauge/Math.max(this.aspect,1);},/**
  	 * Sets an offset in a larger frustum. This is useful for multi-window or
  	 * multi-monitor/multi-machine setups.
  	 *
  	 * For example, if you have 3x2 monitors and each monitor is 1920x1080 and
  	 * the monitors are in grid like this
  	 *
  	 *   +---+---+---+
  	 *   | A | B | C |
  	 *   +---+---+---+
  	 *   | D | E | F |
  	 *   +---+---+---+
  	 *
  	 * then for each monitor you would call it like this
  	 *
  	 *   var w = 1920;
  	 *   var h = 1080;
  	 *   var fullWidth = w * 3;
  	 *   var fullHeight = h * 2;
  	 *
  	 *   --A--
  	 *   camera.setOffset( fullWidth, fullHeight, w * 0, h * 0, w, h );
  	 *   --B--
  	 *   camera.setOffset( fullWidth, fullHeight, w * 1, h * 0, w, h );
  	 *   --C--
  	 *   camera.setOffset( fullWidth, fullHeight, w * 2, h * 0, w, h );
  	 *   --D--
  	 *   camera.setOffset( fullWidth, fullHeight, w * 0, h * 1, w, h );
  	 *   --E--
  	 *   camera.setOffset( fullWidth, fullHeight, w * 1, h * 1, w, h );
  	 *   --F--
  	 *   camera.setOffset( fullWidth, fullHeight, w * 2, h * 1, w, h );
  	 *
  	 *   Note there is no reason monitors have to be the same size or in a grid.
  	 */setViewOffset:function setViewOffset(fullWidth,fullHeight,x,y,width,height){this.aspect=fullWidth/fullHeight;if(this.view===null){this.view={enabled:true,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1};}this.view.enabled=true;this.view.fullWidth=fullWidth;this.view.fullHeight=fullHeight;this.view.offsetX=x;this.view.offsetY=y;this.view.width=width;this.view.height=height;this.updateProjectionMatrix();},clearViewOffset:function clearViewOffset(){if(this.view!==null){this.view.enabled=false;}this.updateProjectionMatrix();},updateProjectionMatrix:function updateProjectionMatrix(){var near=this.near,top=near*Math.tan(_Math$1.DEG2RAD*0.5*this.fov)/this.zoom,height=2*top,width=this.aspect*height,left=-0.5*width,view=this.view;if(this.view!==null&&this.view.enabled){var fullWidth=view.fullWidth,fullHeight=view.fullHeight;left+=view.offsetX*width/fullWidth;top-=view.offsetY*height/fullHeight;width*=view.width/fullWidth;height*=view.height/fullHeight;}var skew=this.filmOffset;if(skew!==0){left+=near*skew/this.getFilmWidth();}this.projectionMatrix.makePerspective(left,left+width,top,top-height,near,this.far);},toJSON:function toJSON(meta){var data=Object3D.prototype.toJSON.call(this,meta);data.object.fov=this.fov;data.object.zoom=this.zoom;data.object.near=this.near;data.object.far=this.far;data.object.focus=this.focus;data.object.aspect=this.aspect;if(this.view!==null){data.object.view=Object.assign({},this.view);}data.object.filmGauge=this.filmGauge;data.object.filmOffset=this.filmOffset;return data;}});/**
   * @author mrdoob / http://mrdoob.com/
   */function Scene(){Object3D.call(this);this.type='Scene';this.background=null;this.fog=null;this.overrideMaterial=null;this.autoUpdate=true;// checked by the renderer
  }Scene.prototype=Object.assign(Object.create(Object3D.prototype),{constructor:Scene,copy:function copy(source,recursive){Object3D.prototype.copy.call(this,source,recursive);if(source.background!==null){this.background=source.background.clone();}if(source.fog!==null){this.fog=source.fog.clone();}if(source.overrideMaterial!==null){this.overrideMaterial=source.overrideMaterial.clone();}this.autoUpdate=source.autoUpdate;this.matrixAutoUpdate=source.matrixAutoUpdate;return this;},toJSON:function toJSON(meta){var data=Object3D.prototype.toJSON.call(this,meta);if(this.background!==null){data.object.background=this.background.toJSON(meta);}if(this.fog!==null){data.object.fog=this.fog.toJSON();}return data;}});/**
   * @author alteredq / http://alteredqualia.com/
   * @author arose / http://github.com/arose
   */function OrthographicCamera(left,right,top,bottom,near,far){Camera.call(this);this.type='OrthographicCamera';this.zoom=1;this.view=null;this.left=left;this.right=right;this.top=top;this.bottom=bottom;this.near=near!==undefined?near:0.1;this.far=far!==undefined?far:2000;this.updateProjectionMatrix();}OrthographicCamera.prototype=Object.assign(Object.create(Camera.prototype),{constructor:OrthographicCamera,isOrthographicCamera:true,copy:function copy(source,recursive){Camera.prototype.copy.call(this,source,recursive);this.left=source.left;this.right=source.right;this.top=source.top;this.bottom=source.bottom;this.near=source.near;this.far=source.far;this.zoom=source.zoom;this.view=source.view===null?null:Object.assign({},source.view);return this;},setViewOffset:function setViewOffset(fullWidth,fullHeight,x,y,width,height){if(this.view===null){this.view={enabled:true,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1};}this.view.enabled=true;this.view.fullWidth=fullWidth;this.view.fullHeight=fullHeight;this.view.offsetX=x;this.view.offsetY=y;this.view.width=width;this.view.height=height;this.updateProjectionMatrix();},clearViewOffset:function clearViewOffset(){if(this.view!==null){this.view.enabled=false;}this.updateProjectionMatrix();},updateProjectionMatrix:function updateProjectionMatrix(){var dx=(this.right-this.left)/(2*this.zoom);var dy=(this.top-this.bottom)/(2*this.zoom);var cx=(this.right+this.left)/2;var cy=(this.top+this.bottom)/2;var left=cx-dx;var right=cx+dx;var top=cy+dy;var bottom=cy-dy;if(this.view!==null&&this.view.enabled){var zoomW=this.zoom/(this.view.width/this.view.fullWidth);var zoomH=this.zoom/(this.view.height/this.view.fullHeight);var scaleW=(this.right-this.left)/this.view.width;var scaleH=(this.top-this.bottom)/this.view.height;left+=scaleW*(this.view.offsetX/zoomW);right=left+scaleW*(this.view.width/zoomW);top-=scaleH*(this.view.offsetY/zoomH);bottom=top-scaleH*(this.view.height/zoomH);}this.projectionMatrix.makeOrthographic(left,right,top,bottom,this.near,this.far);},toJSON:function toJSON(meta){var data=Object3D.prototype.toJSON.call(this,meta);data.object.zoom=this.zoom;data.object.left=this.left;data.object.right=this.right;data.object.top=this.top;data.object.bottom=this.bottom;data.object.near=this.near;data.object.far=this.far;if(this.view!==null){data.object.view=Object.assign({},this.view);}return data;}});/**
   * @author mrdoob / http://mrdoob.com/
   * @author alteredq / http://alteredqualia.com/
   * @author szimek / https://github.com/szimek/
   */var textureId=0;function Texture$1(image,mapping,wrapS,wrapT,magFilter,minFilter,format,type,anisotropy,encoding){Object.defineProperty(this,'id',{value:textureId++});this.uuid=_Math$1.generateUUID();this.name='';this.image=image!==undefined?image:Texture$1.DEFAULT_IMAGE;this.mipmaps=[];this.mapping=mapping!==undefined?mapping:Texture$1.DEFAULT_MAPPING;this.wrapS=wrapS!==undefined?wrapS:ClampToEdgeWrapping;this.wrapT=wrapT!==undefined?wrapT:ClampToEdgeWrapping;this.magFilter=magFilter!==undefined?magFilter:LinearFilter;this.minFilter=minFilter!==undefined?minFilter:LinearMipMapLinearFilter;this.anisotropy=anisotropy!==undefined?anisotropy:1;this.format=format!==undefined?format:RGBAFormat;this.type=type!==undefined?type:UnsignedByteType;this.offset=new Vector2$1(0,0);this.repeat=new Vector2$1(1,1);this.center=new Vector2$1(0,0);this.rotation=0;this.matrixAutoUpdate=true;this.matrix=new Matrix3$1();this.generateMipmaps=true;this.premultiplyAlpha=false;this.flipY=true;this.unpackAlignment=4;// valid values: 1, 2, 4, 8 (see http://www.khronos.org/opengles/sdk/docs/man/xhtml/glPixelStorei.xml)
  // Values of encoding !== THREE.LinearEncoding only supported on map, envMap and emissiveMap.
  //
  // Also changing the encoding after already used by a Material will not automatically make the Material
  // update.  You need to explicitly call Material.needsUpdate to trigger it to recompile.
  this.encoding=encoding!==undefined?encoding:LinearEncoding;this.version=0;this.onUpdate=null;}Texture$1.DEFAULT_IMAGE=undefined;Texture$1.DEFAULT_MAPPING=UVMapping;Texture$1.prototype=Object.assign(Object.create(EventDispatcher.prototype),{constructor:Texture$1,isTexture:true,clone:function clone(){return new this.constructor().copy(this);},copy:function copy(source){this.name=source.name;this.image=source.image;this.mipmaps=source.mipmaps.slice(0);this.mapping=source.mapping;this.wrapS=source.wrapS;this.wrapT=source.wrapT;this.magFilter=source.magFilter;this.minFilter=source.minFilter;this.anisotropy=source.anisotropy;this.format=source.format;this.type=source.type;this.offset.copy(source.offset);this.repeat.copy(source.repeat);this.center.copy(source.center);this.rotation=source.rotation;this.matrixAutoUpdate=source.matrixAutoUpdate;this.matrix.copy(source.matrix);this.generateMipmaps=source.generateMipmaps;this.premultiplyAlpha=source.premultiplyAlpha;this.flipY=source.flipY;this.unpackAlignment=source.unpackAlignment;this.encoding=source.encoding;return this;},toJSON:function toJSON(meta){var isRootObject=meta===undefined||typeof meta==='string';if(!isRootObject&&meta.textures[this.uuid]!==undefined){return meta.textures[this.uuid];}function getDataURL(image){var canvas;if(image instanceof HTMLCanvasElement){canvas=image;}else{canvas=document.createElementNS('http://www.w3.org/1999/xhtml','canvas');canvas.width=image.width;canvas.height=image.height;var context=canvas.getContext('2d');if(image instanceof ImageData){context.putImageData(image,0,0);}else{context.drawImage(image,0,0,image.width,image.height);}}if(canvas.width>2048||canvas.height>2048){return canvas.toDataURL('image/jpeg',0.6);}else{return canvas.toDataURL('image/png');}}var output={metadata:{version:4.5,type:'Texture',generator:'Texture.toJSON'},uuid:this.uuid,name:this.name,mapping:this.mapping,repeat:[this.repeat.x,this.repeat.y],offset:[this.offset.x,this.offset.y],center:[this.center.x,this.center.y],rotation:this.rotation,wrap:[this.wrapS,this.wrapT],minFilter:this.minFilter,magFilter:this.magFilter,anisotropy:this.anisotropy,flipY:this.flipY};if(this.image!==undefined){// TODO: Move to THREE.Image
  var image=this.image;if(image.uuid===undefined){image.uuid=_Math$1.generateUUID();// UGH
  }if(!isRootObject&&meta.images[image.uuid]===undefined){meta.images[image.uuid]={uuid:image.uuid,url:getDataURL(image)};}output.image=image.uuid;}if(!isRootObject){meta.textures[this.uuid]=output;}return output;},dispose:function dispose(){this.dispatchEvent({type:'dispose'});},transformUv:function transformUv(uv){if(this.mapping!==UVMapping){return;}uv.applyMatrix3(this.matrix);if(uv.x<0||uv.x>1){switch(this.wrapS){case RepeatWrapping:uv.x=uv.x-Math.floor(uv.x);break;case ClampToEdgeWrapping:uv.x=uv.x<0?0:1;break;case MirroredRepeatWrapping:if(Math.abs(Math.floor(uv.x)%2)===1){uv.x=Math.ceil(uv.x)-uv.x;}else{uv.x=uv.x-Math.floor(uv.x);}break;}}if(uv.y<0||uv.y>1){switch(this.wrapT){case RepeatWrapping:uv.y=uv.y-Math.floor(uv.y);break;case ClampToEdgeWrapping:uv.y=uv.y<0?0:1;break;case MirroredRepeatWrapping:if(Math.abs(Math.floor(uv.y)%2)===1){uv.y=Math.ceil(uv.y)-uv.y;}else{uv.y=uv.y-Math.floor(uv.y);}break;}}if(this.flipY){uv.y=1-uv.y;}}});Object.defineProperty(Texture$1.prototype,"needsUpdate",{set:function set$$1(value){if(value===true){this.version++;}}});/**
   * @author szimek / https://github.com/szimek/
   * @author alteredq / http://alteredqualia.com/
   * @author Marius Kintel / https://github.com/kintel
   *//*
   In options, we can specify:
   * Texture parameters for an auto-generated target texture
   * depthBuffer/stencilBuffer: Booleans to indicate if we should generate these buffers
  */function WebGLRenderTarget(width,height,options){this.uuid=_Math$1.generateUUID();this.width=width;this.height=height;this.scissor=new Vector4$1(0,0,width,height);this.scissorTest=false;this.viewport=new Vector4$1(0,0,width,height);options=options||{};if(options.minFilter===undefined){options.minFilter=LinearFilter;}this.texture=new Texture$1(undefined,undefined,options.wrapS,options.wrapT,options.magFilter,options.minFilter,options.format,options.type,options.anisotropy,options.encoding);this.depthBuffer=options.depthBuffer!==undefined?options.depthBuffer:true;this.stencilBuffer=options.stencilBuffer!==undefined?options.stencilBuffer:true;this.depthTexture=options.depthTexture!==undefined?options.depthTexture:null;}WebGLRenderTarget.prototype=Object.assign(Object.create(EventDispatcher.prototype),{constructor:WebGLRenderTarget,isWebGLRenderTarget:true,setSize:function setSize(width,height){if(this.width!==width||this.height!==height){this.width=width;this.height=height;this.dispose();}this.viewport.set(0,0,width,height);this.scissor.set(0,0,width,height);},clone:function clone(){return new this.constructor().copy(this);},copy:function copy(source){this.width=source.width;this.height=source.height;this.viewport.copy(source.viewport);this.texture=source.texture.clone();this.depthBuffer=source.depthBuffer;this.stencilBuffer=source.stencilBuffer;this.depthTexture=source.depthTexture;return this;},dispose:function dispose(){this.dispatchEvent({type:'dispose'});}});/**
   * @author alteredq / http://alteredqualia.com/
   *
   * Depth-of-field shader with bokeh
   * ported from GLSL shader by Martins Upitis
   * http://artmartinsh.blogspot.com/2010/02/glsl-lens-blur-filter-with-bokeh.html
   */var BokehShader={defines:{"DEPTH_PACKING":1,"PERSPECTIVE_CAMERA":1},uniforms:{"tColor":{value:null},"tDepth":{value:null},"focus":{value:1.0},"aspect":{value:1.0},"aperture":{value:0.025},"maxblur":{value:1.0},"nearClip":{value:1.0},"farClip":{value:1000.0}},vertexShader:["varying vec2 vUv;","void main() {","vUv = uv;","gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),fragmentShader:["#include <common>","varying vec2 vUv;","uniform sampler2D tColor;","uniform sampler2D tDepth;","uniform float maxblur;",// max blur amount
  "uniform float aperture;",// aperture - bigger values for shallower depth of field
  "uniform float nearClip;","uniform float farClip;","uniform float focus;","uniform float aspect;","#include <packing>","float getDepth( const in vec2 screenPosition ) {","	#if DEPTH_PACKING == 1","	return unpackRGBAToDepth( texture2D( tDepth, screenPosition ) );","	#else","	return texture2D( tDepth, screenPosition ).x;","	#endif","}","float getViewZ( const in float depth ) {","	#if PERSPECTIVE_CAMERA == 1","	return perspectiveDepthToViewZ( depth, nearClip, farClip );","	#else","	return orthoDepthToViewZ( depth, nearClip, farClip );","	#endif","}","void main() {","vec2 aspectcorrect = vec2( 1.0, aspect );","float viewZ = getViewZ( getDepth( vUv ) );","float factor = ( focus + viewZ );",// viewZ is <= 0, so this is a difference equation
  "vec2 dofblur = vec2 ( clamp( factor * aperture, -maxblur, maxblur ) );","vec2 dofblur9 = dofblur * 0.9;","vec2 dofblur7 = dofblur * 0.7;","vec2 dofblur4 = dofblur * 0.4;","vec4 col = vec4( 0.0 );","col += texture2D( tColor, vUv.xy );","col += texture2D( tColor, vUv.xy + ( vec2(  0.0,   0.4  ) * aspectcorrect ) * dofblur );","col += texture2D( tColor, vUv.xy + ( vec2(  0.15,  0.37 ) * aspectcorrect ) * dofblur );","col += texture2D( tColor, vUv.xy + ( vec2(  0.29,  0.29 ) * aspectcorrect ) * dofblur );","col += texture2D( tColor, vUv.xy + ( vec2( -0.37,  0.15 ) * aspectcorrect ) * dofblur );","col += texture2D( tColor, vUv.xy + ( vec2(  0.40,  0.0  ) * aspectcorrect ) * dofblur );","col += texture2D( tColor, vUv.xy + ( vec2(  0.37, -0.15 ) * aspectcorrect ) * dofblur );","col += texture2D( tColor, vUv.xy + ( vec2(  0.29, -0.29 ) * aspectcorrect ) * dofblur );","col += texture2D( tColor, vUv.xy + ( vec2( -0.15, -0.37 ) * aspectcorrect ) * dofblur );","col += texture2D( tColor, vUv.xy + ( vec2(  0.0,  -0.4  ) * aspectcorrect ) * dofblur );","col += texture2D( tColor, vUv.xy + ( vec2( -0.15,  0.37 ) * aspectcorrect ) * dofblur );","col += texture2D( tColor, vUv.xy + ( vec2( -0.29,  0.29 ) * aspectcorrect ) * dofblur );","col += texture2D( tColor, vUv.xy + ( vec2(  0.37,  0.15 ) * aspectcorrect ) * dofblur );","col += texture2D( tColor, vUv.xy + ( vec2( -0.4,   0.0  ) * aspectcorrect ) * dofblur );","col += texture2D( tColor, vUv.xy + ( vec2( -0.37, -0.15 ) * aspectcorrect ) * dofblur );","col += texture2D( tColor, vUv.xy + ( vec2( -0.29, -0.29 ) * aspectcorrect ) * dofblur );","col += texture2D( tColor, vUv.xy + ( vec2(  0.15, -0.37 ) * aspectcorrect ) * dofblur );","col += texture2D( tColor, vUv.xy + ( vec2(  0.15,  0.37 ) * aspectcorrect ) * dofblur9 );","col += texture2D( tColor, vUv.xy + ( vec2( -0.37,  0.15 ) * aspectcorrect ) * dofblur9 );","col += texture2D( tColor, vUv.xy + ( vec2(  0.37, -0.15 ) * aspectcorrect ) * dofblur9 );","col += texture2D( tColor, vUv.xy + ( vec2( -0.15, -0.37 ) * aspectcorrect ) * dofblur9 );","col += texture2D( tColor, vUv.xy + ( vec2( -0.15,  0.37 ) * aspectcorrect ) * dofblur9 );","col += texture2D( tColor, vUv.xy + ( vec2(  0.37,  0.15 ) * aspectcorrect ) * dofblur9 );","col += texture2D( tColor, vUv.xy + ( vec2( -0.37, -0.15 ) * aspectcorrect ) * dofblur9 );","col += texture2D( tColor, vUv.xy + ( vec2(  0.15, -0.37 ) * aspectcorrect ) * dofblur9 );","col += texture2D( tColor, vUv.xy + ( vec2(  0.29,  0.29 ) * aspectcorrect ) * dofblur7 );","col += texture2D( tColor, vUv.xy + ( vec2(  0.40,  0.0  ) * aspectcorrect ) * dofblur7 );","col += texture2D( tColor, vUv.xy + ( vec2(  0.29, -0.29 ) * aspectcorrect ) * dofblur7 );","col += texture2D( tColor, vUv.xy + ( vec2(  0.0,  -0.4  ) * aspectcorrect ) * dofblur7 );","col += texture2D( tColor, vUv.xy + ( vec2( -0.29,  0.29 ) * aspectcorrect ) * dofblur7 );","col += texture2D( tColor, vUv.xy + ( vec2( -0.4,   0.0  ) * aspectcorrect ) * dofblur7 );","col += texture2D( tColor, vUv.xy + ( vec2( -0.29, -0.29 ) * aspectcorrect ) * dofblur7 );","col += texture2D( tColor, vUv.xy + ( vec2(  0.0,   0.4  ) * aspectcorrect ) * dofblur7 );","col += texture2D( tColor, vUv.xy + ( vec2(  0.29,  0.29 ) * aspectcorrect ) * dofblur4 );","col += texture2D( tColor, vUv.xy + ( vec2(  0.4,   0.0  ) * aspectcorrect ) * dofblur4 );","col += texture2D( tColor, vUv.xy + ( vec2(  0.29, -0.29 ) * aspectcorrect ) * dofblur4 );","col += texture2D( tColor, vUv.xy + ( vec2(  0.0,  -0.4  ) * aspectcorrect ) * dofblur4 );","col += texture2D( tColor, vUv.xy + ( vec2( -0.29,  0.29 ) * aspectcorrect ) * dofblur4 );","col += texture2D( tColor, vUv.xy + ( vec2( -0.4,   0.0  ) * aspectcorrect ) * dofblur4 );","col += texture2D( tColor, vUv.xy + ( vec2( -0.29, -0.29 ) * aspectcorrect ) * dofblur4 );","col += texture2D( tColor, vUv.xy + ( vec2(  0.0,   0.4  ) * aspectcorrect ) * dofblur4 );","gl_FragColor = col / 41.0;","gl_FragColor.a = 1.0;","}"].join("\n")};/**
   * @author mrdoob / http://mrdoob.com/
   * @author greggman / http://games.greggman.com/
   * @author zz85 / http://www.lab4games.net/zz85/blog
   * @author kaypiKun
   */var CinematicCamera=function CinematicCamera(fov,aspect,near,far){PerspectiveCamera.call(this,fov,aspect,near,far);this.type="CinematicCamera";this.postprocessing={enabled:true};this.shaderSettings={rings:3,samples:4};this.material_depth=new MeshDepthMaterial();// In case of cinematicCamera, having a default lens set is important
  this.setLens();this.initPostProcessing();};CinematicCamera.prototype=Object.create(PerspectiveCamera.prototype);CinematicCamera.prototype.constructor=CinematicCamera;// providing fnumber and coc(Circle of Confusion) as extra arguments
  CinematicCamera.prototype.setLens=function(focalLength,filmGauge,fNumber,coc){// In case of cinematicCamera, having a default lens set is important
  if(focalLength===undefined){focalLength=35;}if(filmGauge!==undefined){this.filmGauge=filmGauge;}this.setFocalLength(focalLength);// if fnumber and coc are not provided, cinematicCamera tries to act as a basic PerspectiveCamera
  if(fNumber===undefined){fNumber=8;}if(coc===undefined){coc=0.019;}this.fNumber=fNumber;this.coc=coc;// fNumber is focalLength by aperture
  this.aperture=focalLength/this.fNumber;// hyperFocal is required to calculate depthOfField when a lens tries to focus at a distance with given fNumber and focalLength
  this.hyperFocal=focalLength*focalLength/(this.aperture*this.coc);};CinematicCamera.prototype.linearize=function(depth){var zfar=this.far;var znear=this.near;return-zfar*znear/(depth*(zfar-znear)-zfar);};CinematicCamera.prototype.smoothstep=function(near,far,depth){var x=this.saturate((depth-near)/(far-near));return x*x*(3-2*x);};CinematicCamera.prototype.saturate=function(x){return Math.max(0,Math.min(1,x));};// function for focusing at a distance from the camera
  CinematicCamera.prototype.focusAt=function(focusDistance){if(focusDistance===undefined){focusDistance=20;}var focalLength=this.getFocalLength();// distance from the camera (normal to frustrum) to focus on
  this.focus=focusDistance;// the nearest point from the camera which is in focus (unused)
  this.nearPoint=this.hyperFocal*this.focus/(this.hyperFocal+(this.focus-focalLength));// the farthest point from the camera which is in focus (unused)
  this.farPoint=this.hyperFocal*this.focus/(this.hyperFocal-(this.focus-focalLength));// the gap or width of the space in which is everything is in focus (unused)
  this.depthOfField=this.farPoint-this.nearPoint;// Considering minimum distance of focus for a standard lens (unused)
  if(this.depthOfField<0){this.depthOfField=0;}this.sdistance=this.smoothstep(this.near,this.far,this.focus);this.ldistance=this.linearize(1-this.sdistance);this.postprocessing.bokeh_uniforms['focalDepth'].value=this.ldistance;};CinematicCamera.prototype.initPostProcessing=function(){if(this.postprocessing.enabled){this.postprocessing.scene=new Scene();this.postprocessing.camera=new OrthographicCamera(window.innerWidth/-2,window.innerWidth/2,window.innerHeight/2,window.innerHeight/-2,-10000,10000);this.postprocessing.scene.add(this.postprocessing.camera);var pars={minFilter:LinearFilter,magFilter:LinearFilter,format:RGBFormat};this.postprocessing.rtTextureDepth=new WebGLRenderTarget(window.innerWidth,window.innerHeight,pars);this.postprocessing.rtTextureColor=new WebGLRenderTarget(window.innerWidth,window.innerHeight,pars);var bokeh_shader=BokehShader;this.postprocessing.bokeh_uniforms=UniformsUtils.clone(bokeh_shader.uniforms);this.postprocessing.bokeh_uniforms["tColor"].value=this.postprocessing.rtTextureColor.texture;this.postprocessing.bokeh_uniforms["tDepth"].value=this.postprocessing.rtTextureDepth.texture;this.postprocessing.bokeh_uniforms["manualdof"].value=0;this.postprocessing.bokeh_uniforms["shaderFocus"].value=0;this.postprocessing.bokeh_uniforms["fstop"].value=2.8;this.postprocessing.bokeh_uniforms["showFocus"].value=1;this.postprocessing.bokeh_uniforms["focalDepth"].value=0.1;//console.log( this.postprocessing.bokeh_uniforms[ "focalDepth" ].value );
  this.postprocessing.bokeh_uniforms["znear"].value=this.near;this.postprocessing.bokeh_uniforms["zfar"].value=this.near;this.postprocessing.bokeh_uniforms["textureWidth"].value=window.innerWidth;this.postprocessing.bokeh_uniforms["textureHeight"].value=window.innerHeight;this.postprocessing.materialBokeh=new ShaderMaterial({uniforms:this.postprocessing.bokeh_uniforms,vertexShader:bokeh_shader.vertexShader,fragmentShader:bokeh_shader.fragmentShader,defines:{RINGS:this.shaderSettings.rings,SAMPLES:this.shaderSettings.samples}});this.postprocessing.quad=new Mesh(new PlaneBufferGeometry(window.innerWidth,window.innerHeight),this.postprocessing.materialBokeh);this.postprocessing.quad.position.z=-500;this.postprocessing.scene.add(this.postprocessing.quad);}};CinematicCamera.prototype.renderCinematic=function(scene,renderer){if(this.postprocessing.enabled){renderer.clear();// Render scene into texture
  scene.overrideMaterial=null;renderer.render(scene,camera,this.postprocessing.rtTextureColor,true);// Render depth into texture
  scene.overrideMaterial=this.material_depth;renderer.render(scene,camera,this.postprocessing.rtTextureDepth,true);// Render bokeh composite
  renderer.render(this.postprocessing.scene,this.postprocessing.camera);}};/**
   * @author mrdoob / http://mrdoob.com/
   */var Cache={enabled:false,files:{},add:function add(key,file){if(this.enabled===false){return;}// console.log( 'THREE.Cache', 'Adding key:', key );
  this.files[key]=file;},get:function get$$1(key){if(this.enabled===false){return;}// console.log( 'THREE.Cache', 'Checking key:', key );
  return this.files[key];},remove:function remove(key){delete this.files[key];},clear:function clear(){this.files={};}};/**
   * @author mrdoob / http://mrdoob.com/
   */function LoadingManager(onLoad,onProgress,onError){var scope=this;var isLoading=false;var itemsLoaded=0;var itemsTotal=0;var urlModifier=undefined;this.onStart=undefined;this.onLoad=onLoad;this.onProgress=onProgress;this.onError=onError;this.itemStart=function(url){itemsTotal++;if(isLoading===false){if(scope.onStart!==undefined){scope.onStart(url,itemsLoaded,itemsTotal);}}isLoading=true;};this.itemEnd=function(url){itemsLoaded++;if(scope.onProgress!==undefined){scope.onProgress(url,itemsLoaded,itemsTotal);}if(itemsLoaded===itemsTotal){isLoading=false;if(scope.onLoad!==undefined){scope.onLoad();}}};this.itemError=function(url){if(scope.onError!==undefined){scope.onError(url);}};this.resolveURL=function(url){if(urlModifier){return urlModifier(url);}return url;};this.setURLModifier=function(transform){urlModifier=transform;return this;};}var DefaultLoadingManager=new LoadingManager();/**
   * @author mrdoob / http://mrdoob.com/
   */var loading={};function FileLoader(manager){this.manager=manager!==undefined?manager:DefaultLoadingManager;}Object.assign(FileLoader.prototype,{load:function load(url,onLoad,onProgress,onError){var this$1=this;if(url===undefined){url='';}if(this.path!==undefined){url=this.path+url;}url=this.manager.resolveURL(url);var scope=this;var cached=Cache.get(url);if(cached!==undefined){scope.manager.itemStart(url);setTimeout(function(){if(onLoad){onLoad(cached);}scope.manager.itemEnd(url);},0);return cached;}// Check if request is duplicate
  if(loading[url]!==undefined){loading[url].push({onLoad:onLoad,onProgress:onProgress,onError:onError});return;}// Check for data: URI
  var dataUriRegex=/^data:(.*?)(;base64)?,(.*)$/;var dataUriRegexResult=url.match(dataUriRegex);// Safari can not handle Data URIs through XMLHttpRequest so process manually
  if(dataUriRegexResult){var mimeType=dataUriRegexResult[1];var isBase64=!!dataUriRegexResult[2];var data=dataUriRegexResult[3];data=window.decodeURIComponent(data);if(isBase64){data=window.atob(data);}try{var response;var responseType=(this.responseType||'').toLowerCase();switch(responseType){case'arraybuffer':case'blob':var view=new Uint8Array(data.length);for(var i=0;i<data.length;i++){view[i]=data.charCodeAt(i);}if(responseType==='blob'){response=new Blob([view.buffer],{type:mimeType});}else{response=view.buffer;}break;case'document':var parser=new DOMParser();response=parser.parseFromString(data,mimeType);break;case'json':response=JSON.parse(data);break;default:// 'text' or other
  response=data;break;}// Wait for next browser tick like standard XMLHttpRequest event dispatching does
  window.setTimeout(function(){if(onLoad){onLoad(response);}scope.manager.itemEnd(url);},0);}catch(error){// Wait for next browser tick like standard XMLHttpRequest event dispatching does
  window.setTimeout(function(){if(onError){onError(error);}scope.manager.itemEnd(url);scope.manager.itemError(url);},0);}}else{// Initialise array for duplicate requests
  loading[url]=[];loading[url].push({onLoad:onLoad,onProgress:onProgress,onError:onError});var request=new XMLHttpRequest();request.open('GET',url,true);request.addEventListener('load',function(event){var response=this.response;Cache.add(url,response);var callbacks=loading[url];delete loading[url];if(this.status===200){for(var i=0,il=callbacks.length;i<il;i++){var callback=callbacks[i];if(callback.onLoad){callback.onLoad(response);}}scope.manager.itemEnd(url);}else if(this.status===0){// Some browsers return HTTP Status 0 when using non-http protocol
  // e.g. 'file://' or 'data://'. Handle as success.
  console.warn('THREE.FileLoader: HTTP Status 0 received.');for(var i=0,il=callbacks.length;i<il;i++){var callback=callbacks[i];if(callback.onLoad){callback.onLoad(response);}}scope.manager.itemEnd(url);}else{for(var i=0,il=callbacks.length;i<il;i++){var callback=callbacks[i];if(callback.onError){callback.onError(event);}}scope.manager.itemEnd(url);scope.manager.itemError(url);}},false);request.addEventListener('progress',function(event){var callbacks=loading[url];for(var i=0,il=callbacks.length;i<il;i++){var callback=callbacks[i];if(callback.onProgress){callback.onProgress(event);}}},false);request.addEventListener('error',function(event){var callbacks=loading[url];delete loading[url];for(var i=0,il=callbacks.length;i<il;i++){var callback=callbacks[i];if(callback.onError){callback.onError(event);}}scope.manager.itemEnd(url);scope.manager.itemError(url);},false);if(this.responseType!==undefined){request.responseType=this.responseType;}if(this.withCredentials!==undefined){request.withCredentials=this.withCredentials;}if(request.overrideMimeType){request.overrideMimeType(this.mimeType!==undefined?this.mimeType:'text/plain');}for(var header in this$1.requestHeader){request.setRequestHeader(header,this$1.requestHeader[header]);}request.send(null);}scope.manager.itemStart(url);return request;},setPath:function setPath(value){this.path=value;return this;},setResponseType:function setResponseType(value){this.responseType=value;return this;},setWithCredentials:function setWithCredentials(value){this.withCredentials=value;return this;},setMimeType:function setMimeType(value){this.mimeType=value;return this;},setRequestHeader:function setRequestHeader(value){this.requestHeader=value;return this;}});/**
   * @author mrdoob / http://mrdoob.com/
   */function MaterialLoader(manager){this.manager=manager!==undefined?manager:DefaultLoadingManager;this.textures={};}Object.assign(MaterialLoader.prototype,{load:function load(url,onLoad,onProgress,onError){var scope=this;var loader=new FileLoader(scope.manager);loader.load(url,function(text){onLoad(scope.parse(JSON.parse(text)));},onProgress,onError);},setTextures:function setTextures(value){this.textures=value;},parse:function parse(json){var textures=this.textures;function getTexture(name){if(textures[name]===undefined){console.warn('THREE.MaterialLoader: Undefined texture',name);}return textures[name];}var material=new Materials[json.type]();if(json.uuid!==undefined){material.uuid=json.uuid;}if(json.name!==undefined){material.name=json.name;}if(json.color!==undefined){material.color.setHex(json.color);}if(json.roughness!==undefined){material.roughness=json.roughness;}if(json.metalness!==undefined){material.metalness=json.metalness;}if(json.emissive!==undefined){material.emissive.setHex(json.emissive);}if(json.specular!==undefined){material.specular.setHex(json.specular);}if(json.shininess!==undefined){material.shininess=json.shininess;}if(json.clearCoat!==undefined){material.clearCoat=json.clearCoat;}if(json.clearCoatRoughness!==undefined){material.clearCoatRoughness=json.clearCoatRoughness;}if(json.uniforms!==undefined){material.uniforms=json.uniforms;}if(json.vertexShader!==undefined){material.vertexShader=json.vertexShader;}if(json.fragmentShader!==undefined){material.fragmentShader=json.fragmentShader;}if(json.vertexColors!==undefined){material.vertexColors=json.vertexColors;}if(json.fog!==undefined){material.fog=json.fog;}if(json.flatShading!==undefined){material.flatShading=json.flatShading;}if(json.blending!==undefined){material.blending=json.blending;}if(json.side!==undefined){material.side=json.side;}if(json.opacity!==undefined){material.opacity=json.opacity;}if(json.transparent!==undefined){material.transparent=json.transparent;}if(json.alphaTest!==undefined){material.alphaTest=json.alphaTest;}if(json.depthTest!==undefined){material.depthTest=json.depthTest;}if(json.depthWrite!==undefined){material.depthWrite=json.depthWrite;}if(json.colorWrite!==undefined){material.colorWrite=json.colorWrite;}if(json.wireframe!==undefined){material.wireframe=json.wireframe;}if(json.wireframeLinewidth!==undefined){material.wireframeLinewidth=json.wireframeLinewidth;}if(json.wireframeLinecap!==undefined){material.wireframeLinecap=json.wireframeLinecap;}if(json.wireframeLinejoin!==undefined){material.wireframeLinejoin=json.wireframeLinejoin;}if(json.rotation!==undefined){material.rotation=json.rotation;}if(json.linewidth!==1){material.linewidth=json.linewidth;}if(json.dashSize!==undefined){material.dashSize=json.dashSize;}if(json.gapSize!==undefined){material.gapSize=json.gapSize;}if(json.scale!==undefined){material.scale=json.scale;}if(json.skinning!==undefined){material.skinning=json.skinning;}if(json.morphTargets!==undefined){material.morphTargets=json.morphTargets;}if(json.dithering!==undefined){material.dithering=json.dithering;}if(json.visible!==undefined){material.visible=json.visible;}if(json.userData!==undefined){material.userData=json.userData;}// Deprecated
  if(json.shading!==undefined){material.flatShading=json.shading===1;}// THREE.FlatShading
  // for PointsMaterial
  if(json.size!==undefined){material.size=json.size;}if(json.sizeAttenuation!==undefined){material.sizeAttenuation=json.sizeAttenuation;}// maps
  if(json.map!==undefined){material.map=getTexture(json.map);}if(json.alphaMap!==undefined){material.alphaMap=getTexture(json.alphaMap);material.transparent=true;}if(json.bumpMap!==undefined){material.bumpMap=getTexture(json.bumpMap);}if(json.bumpScale!==undefined){material.bumpScale=json.bumpScale;}if(json.normalMap!==undefined){material.normalMap=getTexture(json.normalMap);}if(json.normalScale!==undefined){var normalScale=json.normalScale;if(Array.isArray(normalScale)===false){// Blender exporter used to export a scalar. See #7459
  normalScale=[normalScale,normalScale];}material.normalScale=new Vector2$1().fromArray(normalScale);}if(json.displacementMap!==undefined){material.displacementMap=getTexture(json.displacementMap);}if(json.displacementScale!==undefined){material.displacementScale=json.displacementScale;}if(json.displacementBias!==undefined){material.displacementBias=json.displacementBias;}if(json.roughnessMap!==undefined){material.roughnessMap=getTexture(json.roughnessMap);}if(json.metalnessMap!==undefined){material.metalnessMap=getTexture(json.metalnessMap);}if(json.emissiveMap!==undefined){material.emissiveMap=getTexture(json.emissiveMap);}if(json.emissiveIntensity!==undefined){material.emissiveIntensity=json.emissiveIntensity;}if(json.specularMap!==undefined){material.specularMap=getTexture(json.specularMap);}if(json.envMap!==undefined){material.envMap=getTexture(json.envMap);}if(json.reflectivity!==undefined){material.reflectivity=json.reflectivity;}if(json.lightMap!==undefined){material.lightMap=getTexture(json.lightMap);}if(json.lightMapIntensity!==undefined){material.lightMapIntensity=json.lightMapIntensity;}if(json.aoMap!==undefined){material.aoMap=getTexture(json.aoMap);}if(json.aoMapIntensity!==undefined){material.aoMapIntensity=json.aoMapIntensity;}if(json.gradientMap!==undefined){material.gradientMap=getTexture(json.gradientMap);}return material;}});/**
   * @author mrdoob / http://mrdoob.com/
   */function ImageLoader(manager){this.manager=manager!==undefined?manager:DefaultLoadingManager;}Object.assign(ImageLoader.prototype,{crossOrigin:'Anonymous',load:function load(url,onLoad,onProgress,onError){if(url===undefined){url='';}if(this.path!==undefined){url=this.path+url;}url=this.manager.resolveURL(url);var scope=this;var cached=Cache.get(url);if(cached!==undefined){scope.manager.itemStart(url);setTimeout(function(){if(onLoad){onLoad(cached);}scope.manager.itemEnd(url);},0);return cached;}var image=document.createElementNS('http://www.w3.org/1999/xhtml','img');image.addEventListener('load',function(){Cache.add(url,this);if(onLoad){onLoad(this);}scope.manager.itemEnd(url);},false);/*
  		image.addEventListener( 'progress', function ( event ) {

  			if ( onProgress ) onProgress( event );

  		}, false );
  		*/image.addEventListener('error',function(event){if(onError){onError(event);}scope.manager.itemEnd(url);scope.manager.itemError(url);},false);if(url.substr(0,5)!=='data:'){if(this.crossOrigin!==undefined){image.crossOrigin=this.crossOrigin;}}scope.manager.itemStart(url);image.src=url;return image;},setCrossOrigin:function setCrossOrigin(value){this.crossOrigin=value;return this;},setPath:function setPath(value){this.path=value;return this;}});/**
   * @author mrdoob / http://mrdoob.com/
   */function TextureLoader(manager){this.manager=manager!==undefined?manager:DefaultLoadingManager;}Object.assign(TextureLoader.prototype,{crossOrigin:'Anonymous',load:function load(url,onLoad,onProgress,onError){var texture=new Texture$1();var loader=new ImageLoader(this.manager);loader.setCrossOrigin(this.crossOrigin);loader.setPath(this.path);loader.load(url,function(image){texture.image=image;// JPEGs can't have an alpha channel, so memory can be saved by storing them as RGB.
  var isJPEG=url.search(/\.(jpg|jpeg)$/)>0||url.search(/^data\:image\/jpeg/)===0;texture.format=isJPEG?RGBFormat:RGBAFormat;texture.needsUpdate=true;if(onLoad!==undefined){onLoad(texture);}},onProgress,onError);return texture;},setCrossOrigin:function setCrossOrigin(value){this.crossOrigin=value;return this;},setPath:function setPath(value){this.path=value;return this;}});/**
   * @author alteredq / http://alteredqualia.com/
   */function Loader$1(){this.onLoadStart=function(){};this.onLoadProgress=function(){};this.onLoadComplete=function(){};}Loader$1.Handlers={handlers:[],add:function add(regex,loader){this.handlers.push(regex,loader);},get:function get$$1(file){var handlers=this.handlers;for(var i=0,l=handlers.length;i<l;i+=2){var regex=handlers[i];var loader=handlers[i+1];if(regex.test(file)){return loader;}}return null;}};Object.assign(Loader$1.prototype,{crossOrigin:undefined,initMaterials:function initMaterials(materials,texturePath,crossOrigin){var this$1=this;var array=[];for(var i=0;i<materials.length;++i){array[i]=this$1.createMaterial(materials[i],texturePath,crossOrigin);}return array;},createMaterial:function(){var BlendingMode={NoBlending:NoBlending,NormalBlending:NormalBlending,AdditiveBlending:AdditiveBlending,SubtractiveBlending:SubtractiveBlending,MultiplyBlending:MultiplyBlending,CustomBlending:CustomBlending};var color=new Color$1();var textureLoader=new TextureLoader();var materialLoader=new MaterialLoader();return function createMaterial(m,texturePath,crossOrigin){// convert from old material format
  var textures={};function loadTexture(path,repeat,offset,wrap,anisotropy){var fullPath=texturePath+path;var loader=Loader$1.Handlers.get(fullPath);var texture;if(loader!==null){texture=loader.load(fullPath);}else{textureLoader.setCrossOrigin(crossOrigin);texture=textureLoader.load(fullPath);}if(repeat!==undefined){texture.repeat.fromArray(repeat);if(repeat[0]!==1){texture.wrapS=RepeatWrapping;}if(repeat[1]!==1){texture.wrapT=RepeatWrapping;}}if(offset!==undefined){texture.offset.fromArray(offset);}if(wrap!==undefined){if(wrap[0]==='repeat'){texture.wrapS=RepeatWrapping;}if(wrap[0]==='mirror'){texture.wrapS=MirroredRepeatWrapping;}if(wrap[1]==='repeat'){texture.wrapT=RepeatWrapping;}if(wrap[1]==='mirror'){texture.wrapT=MirroredRepeatWrapping;}}if(anisotropy!==undefined){texture.anisotropy=anisotropy;}var uuid=_Math$1.generateUUID();textures[uuid]=texture;return uuid;}//
  var json={uuid:_Math$1.generateUUID(),type:'MeshLambertMaterial'};for(var name in m){var value=m[name];switch(name){case'DbgColor':case'DbgIndex':case'opticalDensity':case'illumination':break;case'DbgName':json.name=value;break;case'blending':json.blending=BlendingMode[value];break;case'colorAmbient':case'mapAmbient':console.warn('THREE.Loader.createMaterial:',name,'is no longer supported.');break;case'colorDiffuse':json.color=color.fromArray(value).getHex();break;case'colorSpecular':json.specular=color.fromArray(value).getHex();break;case'colorEmissive':json.emissive=color.fromArray(value).getHex();break;case'specularCoef':json.shininess=value;break;case'shading':if(value.toLowerCase()==='basic'){json.type='MeshBasicMaterial';}if(value.toLowerCase()==='phong'){json.type='MeshPhongMaterial';}if(value.toLowerCase()==='standard'){json.type='MeshStandardMaterial';}break;case'mapDiffuse':json.map=loadTexture(value,m.mapDiffuseRepeat,m.mapDiffuseOffset,m.mapDiffuseWrap,m.mapDiffuseAnisotropy);break;case'mapDiffuseRepeat':case'mapDiffuseOffset':case'mapDiffuseWrap':case'mapDiffuseAnisotropy':break;case'mapEmissive':json.emissiveMap=loadTexture(value,m.mapEmissiveRepeat,m.mapEmissiveOffset,m.mapEmissiveWrap,m.mapEmissiveAnisotropy);break;case'mapEmissiveRepeat':case'mapEmissiveOffset':case'mapEmissiveWrap':case'mapEmissiveAnisotropy':break;case'mapLight':json.lightMap=loadTexture(value,m.mapLightRepeat,m.mapLightOffset,m.mapLightWrap,m.mapLightAnisotropy);break;case'mapLightRepeat':case'mapLightOffset':case'mapLightWrap':case'mapLightAnisotropy':break;case'mapAO':json.aoMap=loadTexture(value,m.mapAORepeat,m.mapAOOffset,m.mapAOWrap,m.mapAOAnisotropy);break;case'mapAORepeat':case'mapAOOffset':case'mapAOWrap':case'mapAOAnisotropy':break;case'mapBump':json.bumpMap=loadTexture(value,m.mapBumpRepeat,m.mapBumpOffset,m.mapBumpWrap,m.mapBumpAnisotropy);break;case'mapBumpScale':json.bumpScale=value;break;case'mapBumpRepeat':case'mapBumpOffset':case'mapBumpWrap':case'mapBumpAnisotropy':break;case'mapNormal':json.normalMap=loadTexture(value,m.mapNormalRepeat,m.mapNormalOffset,m.mapNormalWrap,m.mapNormalAnisotropy);break;case'mapNormalFactor':json.normalScale=[value,value];break;case'mapNormalRepeat':case'mapNormalOffset':case'mapNormalWrap':case'mapNormalAnisotropy':break;case'mapSpecular':json.specularMap=loadTexture(value,m.mapSpecularRepeat,m.mapSpecularOffset,m.mapSpecularWrap,m.mapSpecularAnisotropy);break;case'mapSpecularRepeat':case'mapSpecularOffset':case'mapSpecularWrap':case'mapSpecularAnisotropy':break;case'mapMetalness':json.metalnessMap=loadTexture(value,m.mapMetalnessRepeat,m.mapMetalnessOffset,m.mapMetalnessWrap,m.mapMetalnessAnisotropy);break;case'mapMetalnessRepeat':case'mapMetalnessOffset':case'mapMetalnessWrap':case'mapMetalnessAnisotropy':break;case'mapRoughness':json.roughnessMap=loadTexture(value,m.mapRoughnessRepeat,m.mapRoughnessOffset,m.mapRoughnessWrap,m.mapRoughnessAnisotropy);break;case'mapRoughnessRepeat':case'mapRoughnessOffset':case'mapRoughnessWrap':case'mapRoughnessAnisotropy':break;case'mapAlpha':json.alphaMap=loadTexture(value,m.mapAlphaRepeat,m.mapAlphaOffset,m.mapAlphaWrap,m.mapAlphaAnisotropy);break;case'mapAlphaRepeat':case'mapAlphaOffset':case'mapAlphaWrap':case'mapAlphaAnisotropy':break;case'flipSided':json.side=BackSide;break;case'doubleSided':json.side=DoubleSide;break;case'transparency':console.warn('THREE.Loader.createMaterial: transparency has been renamed to opacity');json.opacity=value;break;case'depthTest':case'depthWrite':case'colorWrite':case'opacity':case'reflectivity':case'transparent':case'visible':case'wireframe':json[name]=value;break;case'vertexColors':if(value===true){json.vertexColors=VertexColors;}if(value==='face'){json.vertexColors=FaceColors;}break;default:console.error('THREE.Loader.createMaterial: Unsupported',name,value);break;}}if(json.type==='MeshBasicMaterial'){delete json.emissive;}if(json.type!=='MeshPhongMaterial'){delete json.specular;}if(json.opacity<1){json.transparent=true;}materialLoader.setTextures(textures);return materialLoader.parse(json);};}()});/**
   * @author Don McCurdy / https://www.donmccurdy.com
   */var LoaderUtils={decodeText:function decodeText(array){if(typeof TextDecoder!=='undefined'){return new TextDecoder().decode(array);}// Avoid the String.fromCharCode.apply(null, array) shortcut, which
  // throws a "maximum call stack size exceeded" error for large arrays.
  var s='';for(var i=0,il=array.length;i<il;i++){// Implicitly assumes little-endian.
  s+=String.fromCharCode(array[i]);}return s;},extractUrlBase:function extractUrlBase(url){var parts=url.split('/');if(parts.length===1){return'./';}parts.pop();return parts.join('/')+'/';}};/**
   * @author mrdoob / http://mrdoob.com/
   * @author alteredq / http://alteredqualia.com/
   */function JSONLoader(manager){if(typeof manager==='boolean'){console.warn('THREE.JSONLoader: showStatus parameter has been removed from constructor.');manager=undefined;}this.manager=manager!==undefined?manager:DefaultLoadingManager;this.withCredentials=false;}Object.assign(JSONLoader.prototype,{load:function load(url,onLoad,onProgress,onError){var scope=this;var texturePath=this.texturePath&&typeof this.texturePath==='string'?this.texturePath:LoaderUtils.extractUrlBase(url);var loader=new FileLoader(this.manager);loader.setWithCredentials(this.withCredentials);loader.load(url,function(text){var json=JSON.parse(text);var metadata=json.metadata;if(metadata!==undefined){var type=metadata.type;if(type!==undefined){if(type.toLowerCase()==='object'){console.error('THREE.JSONLoader: '+url+' should be loaded with THREE.ObjectLoader instead.');return;}if(type.toLowerCase()==='scene'){console.error('THREE.JSONLoader: '+url+' should be loaded with THREE.SceneLoader instead.');return;}}}var object=scope.parse(json,texturePath);onLoad(object.geometry,object.materials);},onProgress,onError);},setTexturePath:function setTexturePath(value){this.texturePath=value;},parse:function(){function parseModel(json,geometry){function isBitSet(value,position){return value&1<<position;}var i,j,fi,offset,zLength,colorIndex,normalIndex,uvIndex,materialIndex,type,isQuad,hasMaterial,hasFaceVertexUv,hasFaceNormal,hasFaceVertexNormal,hasFaceColor,hasFaceVertexColor,vertex,face,faceA,faceB,hex,normal,uvLayer,uv,u,v,faces=json.faces,vertices=json.vertices,normals=json.normals,colors=json.colors,scale=json.scale,nUvLayers=0;if(json.uvs!==undefined){// disregard empty arrays
  for(i=0;i<json.uvs.length;i++){if(json.uvs[i].length){nUvLayers++;}}for(i=0;i<nUvLayers;i++){geometry.faceVertexUvs[i]=[];}}offset=0;zLength=vertices.length;while(offset<zLength){vertex=new Vector3$1();vertex.x=vertices[offset++]*scale;vertex.y=vertices[offset++]*scale;vertex.z=vertices[offset++]*scale;geometry.vertices.push(vertex);}offset=0;zLength=faces.length;while(offset<zLength){type=faces[offset++];isQuad=isBitSet(type,0);hasMaterial=isBitSet(type,1);hasFaceVertexUv=isBitSet(type,3);hasFaceNormal=isBitSet(type,4);hasFaceVertexNormal=isBitSet(type,5);hasFaceColor=isBitSet(type,6);hasFaceVertexColor=isBitSet(type,7);// console.log("type", type, "bits", isQuad, hasMaterial, hasFaceVertexUv, hasFaceNormal, hasFaceVertexNormal, hasFaceColor, hasFaceVertexColor);
  if(isQuad){faceA=new Face3$1();faceA.a=faces[offset];faceA.b=faces[offset+1];faceA.c=faces[offset+3];faceB=new Face3$1();faceB.a=faces[offset+1];faceB.b=faces[offset+2];faceB.c=faces[offset+3];offset+=4;if(hasMaterial){materialIndex=faces[offset++];faceA.materialIndex=materialIndex;faceB.materialIndex=materialIndex;}// to get face <=> uv index correspondence
  fi=geometry.faces.length;if(hasFaceVertexUv){for(i=0;i<nUvLayers;i++){uvLayer=json.uvs[i];geometry.faceVertexUvs[i][fi]=[];geometry.faceVertexUvs[i][fi+1]=[];for(j=0;j<4;j++){uvIndex=faces[offset++];u=uvLayer[uvIndex*2];v=uvLayer[uvIndex*2+1];uv=new Vector2$1(u,v);if(j!==2){geometry.faceVertexUvs[i][fi].push(uv);}if(j!==0){geometry.faceVertexUvs[i][fi+1].push(uv);}}}}if(hasFaceNormal){normalIndex=faces[offset++]*3;faceA.normal.set(normals[normalIndex++],normals[normalIndex++],normals[normalIndex]);faceB.normal.copy(faceA.normal);}if(hasFaceVertexNormal){for(i=0;i<4;i++){normalIndex=faces[offset++]*3;normal=new Vector3$1(normals[normalIndex++],normals[normalIndex++],normals[normalIndex]);if(i!==2){faceA.vertexNormals.push(normal);}if(i!==0){faceB.vertexNormals.push(normal);}}}if(hasFaceColor){colorIndex=faces[offset++];hex=colors[colorIndex];faceA.color.setHex(hex);faceB.color.setHex(hex);}if(hasFaceVertexColor){for(i=0;i<4;i++){colorIndex=faces[offset++];hex=colors[colorIndex];if(i!==2){faceA.vertexColors.push(new Color$1(hex));}if(i!==0){faceB.vertexColors.push(new Color$1(hex));}}}geometry.faces.push(faceA);geometry.faces.push(faceB);}else{face=new Face3$1();face.a=faces[offset++];face.b=faces[offset++];face.c=faces[offset++];if(hasMaterial){materialIndex=faces[offset++];face.materialIndex=materialIndex;}// to get face <=> uv index correspondence
  fi=geometry.faces.length;if(hasFaceVertexUv){for(i=0;i<nUvLayers;i++){uvLayer=json.uvs[i];geometry.faceVertexUvs[i][fi]=[];for(j=0;j<3;j++){uvIndex=faces[offset++];u=uvLayer[uvIndex*2];v=uvLayer[uvIndex*2+1];uv=new Vector2$1(u,v);geometry.faceVertexUvs[i][fi].push(uv);}}}if(hasFaceNormal){normalIndex=faces[offset++]*3;face.normal.set(normals[normalIndex++],normals[normalIndex++],normals[normalIndex]);}if(hasFaceVertexNormal){for(i=0;i<3;i++){normalIndex=faces[offset++]*3;normal=new Vector3$1(normals[normalIndex++],normals[normalIndex++],normals[normalIndex]);face.vertexNormals.push(normal);}}if(hasFaceColor){colorIndex=faces[offset++];face.color.setHex(colors[colorIndex]);}if(hasFaceVertexColor){for(i=0;i<3;i++){colorIndex=faces[offset++];face.vertexColors.push(new Color$1(colors[colorIndex]));}}geometry.faces.push(face);}}}function parseSkin(json,geometry){var influencesPerVertex=json.influencesPerVertex!==undefined?json.influencesPerVertex:2;if(json.skinWeights){for(var i=0,l=json.skinWeights.length;i<l;i+=influencesPerVertex){var x=json.skinWeights[i];var y=influencesPerVertex>1?json.skinWeights[i+1]:0;var z=influencesPerVertex>2?json.skinWeights[i+2]:0;var w=influencesPerVertex>3?json.skinWeights[i+3]:0;geometry.skinWeights.push(new Vector4$1(x,y,z,w));}}if(json.skinIndices){for(var i=0,l=json.skinIndices.length;i<l;i+=influencesPerVertex){var a=json.skinIndices[i];var b=influencesPerVertex>1?json.skinIndices[i+1]:0;var c=influencesPerVertex>2?json.skinIndices[i+2]:0;var d=influencesPerVertex>3?json.skinIndices[i+3]:0;geometry.skinIndices.push(new Vector4$1(a,b,c,d));}}geometry.bones=json.bones;if(geometry.bones&&geometry.bones.length>0&&(geometry.skinWeights.length!==geometry.skinIndices.length||geometry.skinIndices.length!==geometry.vertices.length)){console.warn('When skinning, number of vertices ('+geometry.vertices.length+'), skinIndices ('+geometry.skinIndices.length+'), and skinWeights ('+geometry.skinWeights.length+') should match.');}}function parseMorphing(json,geometry){var scale=json.scale;if(json.morphTargets!==undefined){for(var i=0,l=json.morphTargets.length;i<l;i++){geometry.morphTargets[i]={};geometry.morphTargets[i].name=json.morphTargets[i].name;geometry.morphTargets[i].vertices=[];var dstVertices=geometry.morphTargets[i].vertices;var srcVertices=json.morphTargets[i].vertices;for(var v=0,vl=srcVertices.length;v<vl;v+=3){var vertex=new Vector3$1();vertex.x=srcVertices[v]*scale;vertex.y=srcVertices[v+1]*scale;vertex.z=srcVertices[v+2]*scale;dstVertices.push(vertex);}}}if(json.morphColors!==undefined&&json.morphColors.length>0){console.warn('THREE.JSONLoader: "morphColors" no longer supported. Using them as face colors.');var faces=geometry.faces;var morphColors=json.morphColors[0].colors;for(var i=0,l=faces.length;i<l;i++){faces[i].color.fromArray(morphColors,i*3);}}}function parseAnimations(json,geometry){var outputAnimations=[];// parse old style Bone/Hierarchy animations
  var animations=[];if(json.animation!==undefined){animations.push(json.animation);}if(json.animations!==undefined){if(json.animations.length){animations=animations.concat(json.animations);}else{animations.push(json.animations);}}for(var i=0;i<animations.length;i++){var clip=AnimationClip$1.parseAnimation(animations[i],geometry.bones);if(clip){outputAnimations.push(clip);}}// parse implicit morph animations
  if(geometry.morphTargets){// TODO: Figure out what an appropraite FPS is for morph target animations -- defaulting to 10, but really it is completely arbitrary.
  var morphAnimationClips=AnimationClip$1.CreateClipsFromMorphTargetSequences(geometry.morphTargets,10);outputAnimations=outputAnimations.concat(morphAnimationClips);}if(outputAnimations.length>0){geometry.animations=outputAnimations;}}return function(json,texturePath){if(json.data!==undefined){// Geometry 4.0 spec
  json=json.data;}if(json.scale!==undefined){json.scale=1.0/json.scale;}else{json.scale=1.0;}var geometry=new Geometry();parseModel(json,geometry);parseSkin(json,geometry);parseMorphing(json,geometry);parseAnimations(json,geometry);geometry.computeFaceNormals();geometry.computeBoundingSphere();if(json.materials===undefined||json.materials.length===0){return{geometry:geometry};}else{var materials=Loader$1.prototype.initMaterials(json.materials,texturePath,this.crossOrigin);return{geometry:geometry,materials:materials};}};}()});/**
   * @author alteredq / http://alteredqualia.com/
   */function Raycaster(origin,direction,near,far){this.ray=new Ray(origin,direction);// direction is assumed to be normalized (for accurate distance calculations)
  this.near=near||0;this.far=far||Infinity;this.params={Mesh:{},Line:{},LOD:{},Points:{threshold:1},Sprite:{}};Object.defineProperties(this.params,{PointCloud:{get:function get$$1(){console.warn('THREE.Raycaster: params.PointCloud has been renamed to params.Points.');return this.Points;}}});}function ascSort(a,b){return a.distance-b.distance;}function _intersectObject(object,raycaster,intersects,recursive){if(object.visible===false){return;}object.raycast(raycaster,intersects);if(recursive===true){var children=object.children;for(var i=0,l=children.length;i<l;i++){_intersectObject(children[i],raycaster,intersects,true);}}}Object.assign(Raycaster.prototype,{linePrecision:1,set:function set$$1(origin,direction){// direction is assumed to be normalized (for accurate distance calculations)
  this.ray.set(origin,direction);},setFromCamera:function setFromCamera(coords,camera){if(camera&&camera.isPerspectiveCamera){this.ray.origin.setFromMatrixPosition(camera.matrixWorld);this.ray.direction.set(coords.x,coords.y,0.5).unproject(camera).sub(this.ray.origin).normalize();}else if(camera&&camera.isOrthographicCamera){this.ray.origin.set(coords.x,coords.y,(camera.near+camera.far)/(camera.near-camera.far)).unproject(camera);// set origin in plane of camera
  this.ray.direction.set(0,0,-1).transformDirection(camera.matrixWorld);}else{console.error('THREE.Raycaster: Unsupported camera type.');}},intersectObject:function intersectObject(object,recursive){var intersects=[];_intersectObject(object,this,intersects,recursive);intersects.sort(ascSort);return intersects;},intersectObjects:function intersectObjects(objects,recursive){var this$1=this;var intersects=[];if(Array.isArray(objects)===false){console.warn('THREE.Raycaster.intersectObjects: objects is not an Array.');return intersects;}for(var i=0,l=objects.length;i<l;i++){_intersectObject(objects[i],this$1,intersects,recursive);}intersects.sort(ascSort);return intersects;}});/*
   * @author zz85 / https://github.com/zz85
   * @author mrdoob / http://mrdoob.com
   * Running this will allow you to drag three.js objects around the screen.
   */var DragControls=function DragControls(_objects,_camera,_domElement){if(_objects instanceof Camera){console.warn('DragControls: Constructor now expects ( objects, camera, domElement )');var temp=_objects;_objects=_camera;_camera=temp;}var _plane=new Plane();var _raycaster=new Raycaster();var _mouse=new Vector2$1();var _offset=new Vector3$1();var _intersection=new Vector3$1();var _selected=null,_hovered=null;//
  var scope=this;function activate(){_domElement.addEventListener('mousemove',onDocumentMouseMove,false);_domElement.addEventListener('mousedown',onDocumentMouseDown,false);_domElement.addEventListener('mouseup',onDocumentMouseCancel,false);_domElement.addEventListener('mouseleave',onDocumentMouseCancel,false);_domElement.addEventListener('touchmove',onDocumentTouchMove,false);_domElement.addEventListener('touchstart',onDocumentTouchStart,false);_domElement.addEventListener('touchend',onDocumentTouchEnd,false);}function deactivate(){_domElement.removeEventListener('mousemove',onDocumentMouseMove,false);_domElement.removeEventListener('mousedown',onDocumentMouseDown,false);_domElement.removeEventListener('mouseup',onDocumentMouseCancel,false);_domElement.removeEventListener('mouseleave',onDocumentMouseCancel,false);_domElement.removeEventListener('touchmove',onDocumentTouchMove,false);_domElement.removeEventListener('touchstart',onDocumentTouchStart,false);_domElement.removeEventListener('touchend',onDocumentTouchEnd,false);}function dispose(){deactivate();}function onDocumentMouseMove(event){event.preventDefault();var rect=_domElement.getBoundingClientRect();_mouse.x=(event.clientX-rect.left)/rect.width*2-1;_mouse.y=-((event.clientY-rect.top)/rect.height)*2+1;_raycaster.setFromCamera(_mouse,_camera);if(_selected&&scope.enabled){if(_raycaster.ray.intersectPlane(_plane,_intersection)){_selected.position.copy(_intersection.sub(_offset));}scope.dispatchEvent({type:'drag',object:_selected});return;}_raycaster.setFromCamera(_mouse,_camera);var intersects=_raycaster.intersectObjects(_objects);if(intersects.length>0){var object=intersects[0].object;_plane.setFromNormalAndCoplanarPoint(_camera.getWorldDirection(_plane.normal),object.position);if(_hovered!==object){scope.dispatchEvent({type:'hoveron',object:object});_domElement.style.cursor='pointer';_hovered=object;}}else{if(_hovered!==null){scope.dispatchEvent({type:'hoveroff',object:_hovered});_domElement.style.cursor='auto';_hovered=null;}}}function onDocumentMouseDown(event){event.preventDefault();_raycaster.setFromCamera(_mouse,_camera);var intersects=_raycaster.intersectObjects(_objects);if(intersects.length>0){_selected=intersects[0].object;if(_raycaster.ray.intersectPlane(_plane,_intersection)){_offset.copy(_intersection).sub(_selected.position);}_domElement.style.cursor='move';scope.dispatchEvent({type:'dragstart',object:_selected});}}function onDocumentMouseCancel(event){event.preventDefault();if(_selected){scope.dispatchEvent({type:'dragend',object:_selected});_selected=null;}_domElement.style.cursor='auto';}function onDocumentTouchMove(event){event.preventDefault();event=event.changedTouches[0];var rect=_domElement.getBoundingClientRect();_mouse.x=(event.clientX-rect.left)/rect.width*2-1;_mouse.y=-((event.clientY-rect.top)/rect.height)*2+1;_raycaster.setFromCamera(_mouse,_camera);if(_selected&&scope.enabled){if(_raycaster.ray.intersectPlane(_plane,_intersection)){_selected.position.copy(_intersection.sub(_offset));}scope.dispatchEvent({type:'drag',object:_selected});return;}}function onDocumentTouchStart(event){event.preventDefault();event=event.changedTouches[0];var rect=_domElement.getBoundingClientRect();_mouse.x=(event.clientX-rect.left)/rect.width*2-1;_mouse.y=-((event.clientY-rect.top)/rect.height)*2+1;_raycaster.setFromCamera(_mouse,_camera);var intersects=_raycaster.intersectObjects(_objects);if(intersects.length>0){_selected=intersects[0].object;_plane.setFromNormalAndCoplanarPoint(_camera.getWorldDirection(_plane.normal),_selected.position);if(_raycaster.ray.intersectPlane(_plane,_intersection)){_offset.copy(_intersection).sub(_selected.position);}_domElement.style.cursor='move';scope.dispatchEvent({type:'dragstart',object:_selected});}}function onDocumentTouchEnd(event){event.preventDefault();if(_selected){scope.dispatchEvent({type:'dragend',object:_selected});_selected=null;}_domElement.style.cursor='auto';}activate();// API
  this.enabled=true;this.activate=activate;this.deactivate=deactivate;this.dispose=dispose;// Backward compatibility
  this.setObjects=function(){console.error('DragControls: setObjects() has been removed.');};this.on=function(type,listener){console.warn('DragControls: on() has been deprecated. Use addEventListener() instead.');scope.addEventListener(type,listener);};this.off=function(type,listener){console.warn('DragControls: off() has been deprecated. Use removeEventListener() instead.');scope.removeEventListener(type,listener);};this.notify=function(type){console.error('DragControls: notify() has been deprecated. Use dispatchEvent() instead.');scope.dispatchEvent({type:type});};};DragControls.prototype=Object.create(EventDispatcher.prototype);DragControls.prototype.constructor=DragControls;/**
   * @author bhouston / http://clara.io
   * @author WestLangley / http://github.com/WestLangley
   *
   * Ref: https://en.wikipedia.org/wiki/Spherical_coordinate_system
   *
   * The poles (phi) are at the positive and negative y axis.
   * The equator starts at positive z.
   */function Spherical(radius,phi,theta){this.radius=radius!==undefined?radius:1.0;this.phi=phi!==undefined?phi:0;// up / down towards top and bottom pole
  this.theta=theta!==undefined?theta:0;// around the equator of the sphere
  return this;}Object.assign(Spherical.prototype,{set:function set$$1(radius,phi,theta){this.radius=radius;this.phi=phi;this.theta=theta;return this;},clone:function clone(){return new this.constructor().copy(this);},copy:function copy(other){this.radius=other.radius;this.phi=other.phi;this.theta=other.theta;return this;},// restrict phi to be betwee EPS and PI-EPS
  makeSafe:function makeSafe(){var EPS=0.000001;this.phi=Math.max(EPS,Math.min(Math.PI-EPS,this.phi));return this;},setFromVector3:function setFromVector3(vec3){this.radius=vec3.length();if(this.radius===0){this.theta=0;this.phi=0;}else{this.theta=Math.atan2(vec3.x,vec3.z);// equator angle around y-up axis
  this.phi=Math.acos(_Math$1.clamp(vec3.y/this.radius,-1,1));// polar angle
  }return this;}});/**
   * @author qiao / https://github.com/qiao
   * @author mrdoob / http://mrdoob.com
   * @author alteredq / http://alteredqualia.com/
   * @author WestLangley / http://github.com/WestLangley
   */var EditorControls=function EditorControls(object,domElement){domElement=domElement!==undefined?domElement:document;// API
  this.enabled=true;this.center=new Vector3$1();this.panSpeed=0.001;this.zoomSpeed=0.001;this.rotationSpeed=0.005;// internals
  var scope=this;var vector=new Vector3$1();var STATE={NONE:-1,ROTATE:0,ZOOM:1,PAN:2};var state=STATE.NONE;var center=this.center;var normalMatrix=new Matrix3$1();var pointer=new Vector2$1();var pointerOld=new Vector2$1();var spherical=new Spherical();// events
  var changeEvent={type:'change'};this.focus=function(target){var box=new Box3().setFromObject(target);object.lookAt(center.copy(box.getCenter()));scope.dispatchEvent(changeEvent);};this.pan=function(delta){var distance=object.position.distanceTo(center);delta.multiplyScalar(distance*scope.panSpeed);delta.applyMatrix3(normalMatrix.getNormalMatrix(object.matrix));object.position.add(delta);center.add(delta);scope.dispatchEvent(changeEvent);};this.zoom=function(delta){var distance=object.position.distanceTo(center);delta.multiplyScalar(distance*scope.zoomSpeed);if(delta.length()>distance){return;}delta.applyMatrix3(normalMatrix.getNormalMatrix(object.matrix));object.position.add(delta);scope.dispatchEvent(changeEvent);};this.rotate=function(delta){vector.copy(object.position).sub(center);spherical.setFromVector3(vector);spherical.theta+=delta.x;spherical.phi+=delta.y;spherical.makeSafe();vector.setFromSpherical(spherical);object.position.copy(center).add(vector);object.lookAt(center);scope.dispatchEvent(changeEvent);};// mouse
  function onMouseDown(event){if(scope.enabled===false){return;}if(event.button===0){state=STATE.ROTATE;}else if(event.button===1){state=STATE.ZOOM;}else if(event.button===2){state=STATE.PAN;}pointerOld.set(event.clientX,event.clientY);domElement.addEventListener('mousemove',onMouseMove,false);domElement.addEventListener('mouseup',onMouseUp,false);domElement.addEventListener('mouseout',onMouseUp,false);domElement.addEventListener('dblclick',onMouseUp,false);}function onMouseMove(event){if(scope.enabled===false){return;}pointer.set(event.clientX,event.clientY);var movementX=pointer.x-pointerOld.x;var movementY=pointer.y-pointerOld.y;if(state===STATE.ROTATE){scope.rotate(new Vector3$1(-movementX*scope.rotationSpeed,-movementY*scope.rotationSpeed,0));}else if(state===STATE.ZOOM){scope.zoom(new Vector3$1(0,0,movementY));}else if(state===STATE.PAN){scope.pan(new Vector3$1(-movementX,movementY,0));}pointerOld.set(event.clientX,event.clientY);}function onMouseUp(event){domElement.removeEventListener('mousemove',onMouseMove,false);domElement.removeEventListener('mouseup',onMouseUp,false);domElement.removeEventListener('mouseout',onMouseUp,false);domElement.removeEventListener('dblclick',onMouseUp,false);state=STATE.NONE;}function onMouseWheel(event){event.preventDefault();// if ( scope.enabled === false ) return;
  scope.zoom(new Vector3$1(0,0,event.deltaY));}function contextmenu(event){event.preventDefault();}this.dispose=function(){domElement.removeEventListener('contextmenu',contextmenu,false);domElement.removeEventListener('mousedown',onMouseDown,false);domElement.removeEventListener('wheel',onMouseWheel,false);domElement.removeEventListener('mousemove',onMouseMove,false);domElement.removeEventListener('mouseup',onMouseUp,false);domElement.removeEventListener('mouseout',onMouseUp,false);domElement.removeEventListener('dblclick',onMouseUp,false);domElement.removeEventListener('touchstart',touchStart,false);domElement.removeEventListener('touchmove',touchMove,false);};domElement.addEventListener('contextmenu',contextmenu,false);domElement.addEventListener('mousedown',onMouseDown,false);domElement.addEventListener('wheel',onMouseWheel,false);// touch
  var touches=[new Vector3$1(),new Vector3$1(),new Vector3$1()];var prevTouches=[new Vector3$1(),new Vector3$1(),new Vector3$1()];var prevDistance=null;function touchStart(event){if(scope.enabled===false){return;}switch(event.touches.length){case 1:touches[0].set(event.touches[0].pageX,event.touches[0].pageY,0);touches[1].set(event.touches[0].pageX,event.touches[0].pageY,0);break;case 2:touches[0].set(event.touches[0].pageX,event.touches[0].pageY,0);touches[1].set(event.touches[1].pageX,event.touches[1].pageY,0);prevDistance=touches[0].distanceTo(touches[1]);break;}prevTouches[0].copy(touches[0]);prevTouches[1].copy(touches[1]);}function touchMove(event){if(scope.enabled===false){return;}event.preventDefault();event.stopPropagation();function getClosest(touch,touches){var closest=touches[0];for(var i in touches){if(closest.distanceTo(touch)>touches[i].distanceTo(touch)){closest=touches[i];}}return closest;}switch(event.touches.length){case 1:touches[0].set(event.touches[0].pageX,event.touches[0].pageY,0);touches[1].set(event.touches[0].pageX,event.touches[0].pageY,0);scope.rotate(touches[0].sub(getClosest(touches[0],prevTouches)).multiplyScalar(-scope.rotationSpeed));break;case 2:touches[0].set(event.touches[0].pageX,event.touches[0].pageY,0);touches[1].set(event.touches[1].pageX,event.touches[1].pageY,0);var distance=touches[0].distanceTo(touches[1]);scope.zoom(new Vector3$1(0,0,prevDistance-distance));prevDistance=distance;var offset0=touches[0].clone().sub(getClosest(touches[0],prevTouches));var offset1=touches[1].clone().sub(getClosest(touches[1],prevTouches));offset0.x=-offset0.x;offset1.x=-offset1.x;scope.pan(offset0.add(offset1).multiplyScalar(0.5));break;}prevTouches[0].copy(touches[0]);prevTouches[1].copy(touches[1]);}domElement.addEventListener('touchstart',touchStart,false);domElement.addEventListener('touchmove',touchMove,false);};EditorControls.prototype=Object.create(EventDispatcher.prototype);EditorControls.prototype.constructor=EditorControls;/**
   * @author mrdoob / http://mrdoob.com/
   * @author alteredq / http://alteredqualia.com/
   * @author paulirish / http://paulirish.com/
   */// This set of controls performs orbiting, dollying (zooming), and panning.
  // Unlike TrackballControls, it maintains the "up" direction object.up (+Y by default).
  //
  //    Orbit - left mouse / touch: one finger move
  //    Zoom - middle mouse, or mousewheel / touch: two finger spread or squish
  //    Pan - right mouse, or arrow keys / touch: three finger swipe
  var OrbitControls=function OrbitControls(object,domElement){this.object=object;this.domElement=domElement!==undefined?domElement:document;// Set to false to disable this control
  this.enabled=true;// "target" sets the location of focus, where the object orbits around
  this.target=new Vector3$1();// How far you can dolly in and out ( PerspectiveCamera only )
  this.minDistance=0;this.maxDistance=Infinity;// How far you can zoom in and out ( OrthographicCamera only )
  this.minZoom=0;this.maxZoom=Infinity;// How far you can orbit vertically, upper and lower limits.
  // Range is 0 to Math.PI radians.
  this.minPolarAngle=0;// radians
  this.maxPolarAngle=Math.PI;// radians
  // How far you can orbit horizontally, upper and lower limits.
  // If set, must be a sub-interval of the interval [ - Math.PI, Math.PI ].
  this.minAzimuthAngle=-Infinity;// radians
  this.maxAzimuthAngle=Infinity;// radians
  // Set to true to enable damping (inertia)
  // If damping is enabled, you must call controls.update() in your animation loop
  this.enableDamping=false;this.dampingFactor=0.25;// This option actually enables dollying in and out; left as "zoom" for backwards compatibility.
  // Set to false to disable zooming
  this.enableZoom=true;this.zoomSpeed=1.0;// Set to false to disable rotating
  this.enableRotate=true;this.rotateSpeed=1.0;// Set to false to disable panning
  this.enablePan=true;this.keyPanSpeed=7.0;// pixels moved per arrow key push
  // Set to true to automatically rotate around the target
  // If auto-rotate is enabled, you must call controls.update() in your animation loop
  this.autoRotate=false;this.autoRotateSpeed=2.0;// 30 seconds per round when fps is 60
  // Set to false to disable use of the keys
  this.enableKeys=true;// The four arrow keys
  this.keys={LEFT:37,UP:38,RIGHT:39,BOTTOM:40};// Mouse buttons
  this.mouseButtons={ORBIT:MOUSE.LEFT,ZOOM:MOUSE.MIDDLE,PAN:MOUSE.RIGHT};// for reset
  this.target0=this.target.clone();this.position0=this.object.position.clone();this.zoom0=this.object.zoom;//
  // public methods
  //
  this.getPolarAngle=function(){return spherical.phi;};this.getAzimuthalAngle=function(){return spherical.theta;};this.saveState=function(){scope.target0.copy(scope.target);scope.position0.copy(scope.object.position);scope.zoom0=scope.object.zoom;};this.reset=function(){scope.target.copy(scope.target0);scope.object.position.copy(scope.position0);scope.object.zoom=scope.zoom0;scope.object.updateProjectionMatrix();scope.dispatchEvent(changeEvent);scope.update();state=STATE.NONE;};// this method is exposed, but perhaps it would be better if we can make it private...
  this.update=function(){var offset=new Vector3$1();// so camera.up is the orbit axis
  var quat=new Quaternion().setFromUnitVectors(object.up,new Vector3$1(0,1,0));var quatInverse=quat.clone().inverse();var lastPosition=new Vector3$1();var lastQuaternion=new Quaternion();return function update(){var position=scope.object.position;offset.copy(position).sub(scope.target);// rotate offset to "y-axis-is-up" space
  offset.applyQuaternion(quat);// angle from z-axis around y-axis
  spherical.setFromVector3(offset);if(scope.autoRotate&&state===STATE.NONE){rotateLeft(getAutoRotationAngle());}spherical.theta+=sphericalDelta.theta;spherical.phi+=sphericalDelta.phi;// restrict theta to be between desired limits
  spherical.theta=Math.max(scope.minAzimuthAngle,Math.min(scope.maxAzimuthAngle,spherical.theta));// restrict phi to be between desired limits
  spherical.phi=Math.max(scope.minPolarAngle,Math.min(scope.maxPolarAngle,spherical.phi));spherical.makeSafe();spherical.radius*=scale;// restrict radius to be between desired limits
  spherical.radius=Math.max(scope.minDistance,Math.min(scope.maxDistance,spherical.radius));// move target to panned location
  scope.target.add(panOffset);offset.setFromSpherical(spherical);// rotate offset back to "camera-up-vector-is-up" space
  offset.applyQuaternion(quatInverse);position.copy(scope.target).add(offset);scope.object.lookAt(scope.target);if(scope.enableDamping===true){sphericalDelta.theta*=1-scope.dampingFactor;sphericalDelta.phi*=1-scope.dampingFactor;}else{sphericalDelta.set(0,0,0);}scale=1;panOffset.set(0,0,0);// update condition is:
  // min(camera displacement, camera rotation in radians)^2 > EPS
  // using small-angle approximation cos(x/2) = 1 - x^2 / 8
  if(zoomChanged||lastPosition.distanceToSquared(scope.object.position)>EPS||8*(1-lastQuaternion.dot(scope.object.quaternion))>EPS){scope.dispatchEvent(changeEvent);lastPosition.copy(scope.object.position);lastQuaternion.copy(scope.object.quaternion);zoomChanged=false;return true;}return false;};}();this.dispose=function(){scope.domElement.removeEventListener('contextmenu',onContextMenu,false);scope.domElement.removeEventListener('mousedown',onMouseDown,false);scope.domElement.removeEventListener('wheel',onMouseWheel,false);scope.domElement.removeEventListener('touchstart',onTouchStart,false);scope.domElement.removeEventListener('touchend',onTouchEnd,false);scope.domElement.removeEventListener('touchmove',onTouchMove,false);document.removeEventListener('mousemove',onMouseMove,false);document.removeEventListener('mouseup',onMouseUp,false);window.removeEventListener('keydown',onKeyDown,false);//scope.dispatchEvent( { type: 'dispose' } ); // should this be added here?
  };//
  // internals
  //
  var scope=this;var changeEvent={type:'change'};var startEvent={type:'start'};var endEvent={type:'end'};var STATE={NONE:-1,ROTATE:0,DOLLY:1,PAN:2,TOUCH_ROTATE:3,TOUCH_DOLLY:4,TOUCH_PAN:5};var state=STATE.NONE;var EPS=0.000001;// current position in spherical coordinates
  var spherical=new Spherical();var sphericalDelta=new Spherical();var scale=1;var panOffset=new Vector3$1();var zoomChanged=false;var rotateStart=new Vector2$1();var rotateEnd=new Vector2$1();var rotateDelta=new Vector2$1();var panStart=new Vector2$1();var panEnd=new Vector2$1();var panDelta=new Vector2$1();var dollyStart=new Vector2$1();var dollyEnd=new Vector2$1();var dollyDelta=new Vector2$1();function getAutoRotationAngle(){return 2*Math.PI/60/60*scope.autoRotateSpeed;}function getZoomScale(){return Math.pow(0.95,scope.zoomSpeed);}function rotateLeft(angle){sphericalDelta.theta-=angle;}function rotateUp(angle){sphericalDelta.phi-=angle;}var panLeft=function(){var v=new Vector3$1();return function panLeft(distance,objectMatrix){v.setFromMatrixColumn(objectMatrix,0);// get X column of objectMatrix
  v.multiplyScalar(-distance);panOffset.add(v);};}();var panUp=function(){var v=new Vector3$1();return function panUp(distance,objectMatrix){v.setFromMatrixColumn(objectMatrix,1);// get Y column of objectMatrix
  v.multiplyScalar(distance);panOffset.add(v);};}();// deltaX and deltaY are in pixels; right and down are positive
  var pan=function(){var offset=new Vector3$1();return function pan(deltaX,deltaY){var element=scope.domElement===document?scope.domElement.body:scope.domElement;if(scope.object.isPerspectiveCamera){// perspective
  var position=scope.object.position;offset.copy(position).sub(scope.target);var targetDistance=offset.length();// half of the fov is center to top of screen
  targetDistance*=Math.tan(scope.object.fov/2*Math.PI/180.0);// we actually don't use screenWidth, since perspective camera is fixed to screen height
  panLeft(2*deltaX*targetDistance/element.clientHeight,scope.object.matrix);panUp(2*deltaY*targetDistance/element.clientHeight,scope.object.matrix);}else if(scope.object.isOrthographicCamera){// orthographic
  panLeft(deltaX*(scope.object.right-scope.object.left)/scope.object.zoom/element.clientWidth,scope.object.matrix);panUp(deltaY*(scope.object.top-scope.object.bottom)/scope.object.zoom/element.clientHeight,scope.object.matrix);}else{// camera neither orthographic nor perspective
  console.warn('WARNING: OrbitControls.js encountered an unknown camera type - pan disabled.');scope.enablePan=false;}};}();function dollyIn(dollyScale){if(scope.object.isPerspectiveCamera){scale/=dollyScale;}else if(scope.object.isOrthographicCamera){scope.object.zoom=Math.max(scope.minZoom,Math.min(scope.maxZoom,scope.object.zoom*dollyScale));scope.object.updateProjectionMatrix();zoomChanged=true;}else{console.warn('WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled.');scope.enableZoom=false;}}function dollyOut(dollyScale){if(scope.object.isPerspectiveCamera){scale*=dollyScale;}else if(scope.object.isOrthographicCamera){scope.object.zoom=Math.max(scope.minZoom,Math.min(scope.maxZoom,scope.object.zoom/dollyScale));scope.object.updateProjectionMatrix();zoomChanged=true;}else{console.warn('WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled.');scope.enableZoom=false;}}//
  // event callbacks - update the object state
  //
  function handleMouseDownRotate(event){//console.log( 'handleMouseDownRotate' );
  rotateStart.set(event.clientX,event.clientY);}function handleMouseDownDolly(event){//console.log( 'handleMouseDownDolly' );
  dollyStart.set(event.clientX,event.clientY);}function handleMouseDownPan(event){//console.log( 'handleMouseDownPan' );
  panStart.set(event.clientX,event.clientY);}function handleMouseMoveRotate(event){//console.log( 'handleMouseMoveRotate' );
  rotateEnd.set(event.clientX,event.clientY);rotateDelta.subVectors(rotateEnd,rotateStart);var element=scope.domElement===document?scope.domElement.body:scope.domElement;// rotating across whole screen goes 360 degrees around
  rotateLeft(2*Math.PI*rotateDelta.x/element.clientWidth*scope.rotateSpeed);// rotating up and down along whole screen attempts to go 360, but limited to 180
  rotateUp(2*Math.PI*rotateDelta.y/element.clientHeight*scope.rotateSpeed);rotateStart.copy(rotateEnd);scope.update();}function handleMouseMoveDolly(event){//console.log( 'handleMouseMoveDolly' );
  dollyEnd.set(event.clientX,event.clientY);dollyDelta.subVectors(dollyEnd,dollyStart);if(dollyDelta.y>0){dollyIn(getZoomScale());}else if(dollyDelta.y<0){dollyOut(getZoomScale());}dollyStart.copy(dollyEnd);scope.update();}function handleMouseMovePan(event){//console.log( 'handleMouseMovePan' );
  panEnd.set(event.clientX,event.clientY);panDelta.subVectors(panEnd,panStart);pan(panDelta.x,panDelta.y);panStart.copy(panEnd);scope.update();}function handleMouseWheel(event){// console.log( 'handleMouseWheel' );
  if(event.deltaY<0){dollyOut(getZoomScale());}else if(event.deltaY>0){dollyIn(getZoomScale());}scope.update();}function handleKeyDown(event){//console.log( 'handleKeyDown' );
  switch(event.keyCode){case scope.keys.UP:pan(0,scope.keyPanSpeed);scope.update();break;case scope.keys.BOTTOM:pan(0,-scope.keyPanSpeed);scope.update();break;case scope.keys.LEFT:pan(scope.keyPanSpeed,0);scope.update();break;case scope.keys.RIGHT:pan(-scope.keyPanSpeed,0);scope.update();break;}}function handleTouchStartRotate(event){//console.log( 'handleTouchStartRotate' );
  rotateStart.set(event.touches[0].pageX,event.touches[0].pageY);}function handleTouchStartDolly(event){//console.log( 'handleTouchStartDolly' );
  var dx=event.touches[0].pageX-event.touches[1].pageX;var dy=event.touches[0].pageY-event.touches[1].pageY;var distance=Math.sqrt(dx*dx+dy*dy);dollyStart.set(0,distance);}function handleTouchStartPan(event){//console.log( 'handleTouchStartPan' );
  panStart.set(event.touches[0].pageX,event.touches[0].pageY);}function handleTouchMoveRotate(event){//console.log( 'handleTouchMoveRotate' );
  rotateEnd.set(event.touches[0].pageX,event.touches[0].pageY);rotateDelta.subVectors(rotateEnd,rotateStart);var element=scope.domElement===document?scope.domElement.body:scope.domElement;// rotating across whole screen goes 360 degrees around
  rotateLeft(2*Math.PI*rotateDelta.x/element.clientWidth*scope.rotateSpeed);// rotating up and down along whole screen attempts to go 360, but limited to 180
  rotateUp(2*Math.PI*rotateDelta.y/element.clientHeight*scope.rotateSpeed);rotateStart.copy(rotateEnd);scope.update();}function handleTouchMoveDolly(event){//console.log( 'handleTouchMoveDolly' );
  var dx=event.touches[0].pageX-event.touches[1].pageX;var dy=event.touches[0].pageY-event.touches[1].pageY;var distance=Math.sqrt(dx*dx+dy*dy);dollyEnd.set(0,distance);dollyDelta.subVectors(dollyEnd,dollyStart);if(dollyDelta.y>0){dollyOut(getZoomScale());}else if(dollyDelta.y<0){dollyIn(getZoomScale());}dollyStart.copy(dollyEnd);scope.update();}function handleTouchMovePan(event){//console.log( 'handleTouchMovePan' );
  panEnd.set(event.touches[0].pageX,event.touches[0].pageY);panDelta.subVectors(panEnd,panStart);pan(panDelta.x,panDelta.y);panStart.copy(panEnd);scope.update();}function onMouseDown(event){if(scope.enabled===false){return;}event.preventDefault();switch(event.button){case scope.mouseButtons.ORBIT:if(scope.enableRotate===false){return;}handleMouseDownRotate(event);state=STATE.ROTATE;break;case scope.mouseButtons.ZOOM:if(scope.enableZoom===false){return;}handleMouseDownDolly(event);state=STATE.DOLLY;break;case scope.mouseButtons.PAN:if(scope.enablePan===false){return;}handleMouseDownPan(event);state=STATE.PAN;break;}if(state!==STATE.NONE){document.addEventListener('mousemove',onMouseMove,false);document.addEventListener('mouseup',onMouseUp,false);scope.dispatchEvent(startEvent);}}function onMouseMove(event){if(scope.enabled===false){return;}event.preventDefault();switch(state){case STATE.ROTATE:if(scope.enableRotate===false){return;}handleMouseMoveRotate(event);break;case STATE.DOLLY:if(scope.enableZoom===false){return;}handleMouseMoveDolly(event);break;case STATE.PAN:if(scope.enablePan===false){return;}handleMouseMovePan(event);break;}}function onMouseUp(event){if(scope.enabled===false){return;}document.removeEventListener('mousemove',onMouseMove,false);document.removeEventListener('mouseup',onMouseUp,false);scope.dispatchEvent(endEvent);state=STATE.NONE;}function onMouseWheel(event){if(scope.enabled===false||scope.enableZoom===false||state!==STATE.NONE&&state!==STATE.ROTATE){return;}event.preventDefault();event.stopPropagation();handleMouseWheel(event);scope.dispatchEvent(startEvent);// not sure why these are here...
  scope.dispatchEvent(endEvent);}function onKeyDown(event){if(scope.enabled===false||scope.enableKeys===false||scope.enablePan===false){return;}handleKeyDown(event);}function onTouchStart(event){if(scope.enabled===false){return;}switch(event.touches.length){case 1:// one-fingered touch: rotate
  if(scope.enableRotate===false){return;}handleTouchStartRotate(event);state=STATE.TOUCH_ROTATE;break;case 2:// two-fingered touch: dolly
  if(scope.enableZoom===false){return;}handleTouchStartDolly(event);state=STATE.TOUCH_DOLLY;break;case 3:// three-fingered touch: pan
  if(scope.enablePan===false){return;}handleTouchStartPan(event);state=STATE.TOUCH_PAN;break;default:state=STATE.NONE;}if(state!==STATE.NONE){scope.dispatchEvent(startEvent);}}function onTouchMove(event){if(scope.enabled===false){return;}event.preventDefault();event.stopPropagation();switch(event.touches.length){case 1:// one-fingered touch: rotate
  if(scope.enableRotate===false){return;}if(state!==STATE.TOUCH_ROTATE){return;}// is this needed?...
  handleTouchMoveRotate(event);break;case 2:// two-fingered touch: dolly
  if(scope.enableZoom===false){return;}if(state!==STATE.TOUCH_DOLLY){return;}// is this needed?...
  handleTouchMoveDolly(event);break;case 3:// three-fingered touch: pan
  if(scope.enablePan===false){return;}if(state!==STATE.TOUCH_PAN){return;}// is this needed?...
  handleTouchMovePan(event);break;default:state=STATE.NONE;}}function onTouchEnd(event){if(scope.enabled===false){return;}scope.dispatchEvent(endEvent);state=STATE.NONE;}function onContextMenu(event){if(scope.enabled===false){return;}event.preventDefault();}//
  scope.domElement.addEventListener('contextmenu',onContextMenu,false);scope.domElement.addEventListener('mousedown',onMouseDown,false);scope.domElement.addEventListener('wheel',onMouseWheel,false);scope.domElement.addEventListener('touchstart',onTouchStart,false);scope.domElement.addEventListener('touchend',onTouchEnd,false);scope.domElement.addEventListener('touchmove',onTouchMove,false);window.addEventListener('keydown',onKeyDown,false);// force an update at start
  this.update();};OrbitControls.prototype=Object.create(EventDispatcher.prototype);OrbitControls.prototype.constructor=OrbitControls;Object.defineProperties(OrbitControls.prototype,{center:{get:function get$$1(){console.warn('OrbitControls: .center has been renamed to .target');return this.target;}},// backward compatibility
  noZoom:{get:function get$$1(){console.warn('OrbitControls: .noZoom has been deprecated. Use .enableZoom instead.');return!this.enableZoom;},set:function set$$1(value){console.warn('OrbitControls: .noZoom has been deprecated. Use .enableZoom instead.');this.enableZoom=!value;}},noRotate:{get:function get$$1(){console.warn('OrbitControls: .noRotate has been deprecated. Use .enableRotate instead.');return!this.enableRotate;},set:function set$$1(value){console.warn('OrbitControls: .noRotate has been deprecated. Use .enableRotate instead.');this.enableRotate=!value;}},noPan:{get:function get$$1(){console.warn('OrbitControls: .noPan has been deprecated. Use .enablePan instead.');return!this.enablePan;},set:function set$$1(value){console.warn('OrbitControls: .noPan has been deprecated. Use .enablePan instead.');this.enablePan=!value;}},noKeys:{get:function get$$1(){console.warn('OrbitControls: .noKeys has been deprecated. Use .enableKeys instead.');return!this.enableKeys;},set:function set$$1(value){console.warn('OrbitControls: .noKeys has been deprecated. Use .enableKeys instead.');this.enableKeys=!value;}},staticMoving:{get:function get$$1(){console.warn('OrbitControls: .staticMoving has been deprecated. Use .enableDamping instead.');return!this.enableDamping;},set:function set$$1(value){console.warn('OrbitControls: .staticMoving has been deprecated. Use .enableDamping instead.');this.enableDamping=!value;}},dynamicDampingFactor:{get:function get$$1(){console.warn('OrbitControls: .dynamicDampingFactor has been renamed. Use .dampingFactor instead.');return this.dampingFactor;},set:function set$$1(value){console.warn('OrbitControls: .dynamicDampingFactor has been renamed. Use .dampingFactor instead.');this.dampingFactor=value;}}});/**
   * @author Eberhard Graether / http://egraether.com/
   * @author Mark Lundin 	/ http://mark-lundin.com
   * @author Patrick Fuller / http://patrick-fuller.com
   * @author Max Smolens / https://github.com/msmolens
   */var OrthographicTrackballControls=function OrthographicTrackballControls(object,domElement){var _this=this;var STATE={NONE:-1,ROTATE:0,ZOOM:1,PAN:2,TOUCH_ROTATE:3,TOUCH_ZOOM_PAN:4};this.object=object;this.domElement=domElement!==undefined?domElement:document;// API
  this.enabled=true;this.screen={left:0,top:0,width:0,height:0};this.radius=0;this.rotateSpeed=1.0;this.zoomSpeed=1.2;this.noRotate=false;this.noZoom=false;this.noPan=false;this.noRoll=false;this.staticMoving=false;this.dynamicDampingFactor=0.2;this.keys=[65/*A*/,83/*S*/,68/*D*/];// internals
  this.target=new Vector3$1();var EPS=0.000001;var _changed=true;var _state=STATE.NONE,_prevState=STATE.NONE,_eye=new Vector3$1(),_rotateStart=new Vector3$1(),_rotateEnd=new Vector3$1(),_zoomStart=new Vector2$1(),_zoomEnd=new Vector2$1(),_touchZoomDistanceStart=0,_touchZoomDistanceEnd=0,_panStart=new Vector2$1(),_panEnd=new Vector2$1();// for reset
  this.target0=this.target.clone();this.position0=this.object.position.clone();this.up0=this.object.up.clone();this.left0=this.object.left;this.right0=this.object.right;this.top0=this.object.top;this.bottom0=this.object.bottom;// events
  var changeEvent={type:'change'};var startEvent={type:'start'};var endEvent={type:'end'};// methods
  this.handleResize=function(){if(this.domElement===document){this.screen.left=0;this.screen.top=0;this.screen.width=window.innerWidth;this.screen.height=window.innerHeight;}else{var box=this.domElement.getBoundingClientRect();// adjustments come from similar code in the jquery offset() function
  var d=this.domElement.ownerDocument.documentElement;this.screen.left=box.left+window.pageXOffset-d.clientLeft;this.screen.top=box.top+window.pageYOffset-d.clientTop;this.screen.width=box.width;this.screen.height=box.height;}this.radius=0.5*Math.min(this.screen.width,this.screen.height);this.left0=this.object.left;this.right0=this.object.right;this.top0=this.object.top;this.bottom0=this.object.bottom;};this.handleEvent=function(event){if(typeof this[event.type]=='function'){this[event.type](event);}};var getMouseOnScreen=function(){var vector=new Vector2$1();return function getMouseOnScreen(pageX,pageY){vector.set((pageX-_this.screen.left)/_this.screen.width,(pageY-_this.screen.top)/_this.screen.height);return vector;};}();var getMouseProjectionOnBall=function(){var vector=new Vector3$1();var objectUp=new Vector3$1();var mouseOnBall=new Vector3$1();return function getMouseProjectionOnBall(pageX,pageY){mouseOnBall.set((pageX-_this.screen.width*0.5-_this.screen.left)/_this.radius,(_this.screen.height*0.5+_this.screen.top-pageY)/_this.radius,0.0);var length=mouseOnBall.length();if(_this.noRoll){if(length<Math.SQRT1_2){mouseOnBall.z=Math.sqrt(1.0-length*length);}else{mouseOnBall.z=.5/length;}}else if(length>1.0){mouseOnBall.normalize();}else{mouseOnBall.z=Math.sqrt(1.0-length*length);}_eye.copy(_this.object.position).sub(_this.target);vector.copy(_this.object.up).setLength(mouseOnBall.y);vector.add(objectUp.copy(_this.object.up).cross(_eye).setLength(mouseOnBall.x));vector.add(_eye.setLength(mouseOnBall.z));return vector;};}();this.rotateCamera=function(){var axis=new Vector3$1(),quaternion=new Quaternion();return function rotateCamera(){var angle=Math.acos(_rotateStart.dot(_rotateEnd)/_rotateStart.length()/_rotateEnd.length());if(angle){axis.crossVectors(_rotateStart,_rotateEnd).normalize();angle*=_this.rotateSpeed;quaternion.setFromAxisAngle(axis,-angle);_eye.applyQuaternion(quaternion);_this.object.up.applyQuaternion(quaternion);_rotateEnd.applyQuaternion(quaternion);if(_this.staticMoving){_rotateStart.copy(_rotateEnd);}else{quaternion.setFromAxisAngle(axis,angle*(_this.dynamicDampingFactor-1.0));_rotateStart.applyQuaternion(quaternion);}_changed=true;}};}();this.zoomCamera=function(){if(_state===STATE.TOUCH_ZOOM_PAN){var factor=_touchZoomDistanceEnd/_touchZoomDistanceStart;_touchZoomDistanceStart=_touchZoomDistanceEnd;_this.object.zoom*=factor;_changed=true;}else{var factor=1.0+(_zoomEnd.y-_zoomStart.y)*_this.zoomSpeed;if(Math.abs(factor-1.0)>EPS&&factor>0.0){_this.object.zoom/=factor;if(_this.staticMoving){_zoomStart.copy(_zoomEnd);}else{_zoomStart.y+=(_zoomEnd.y-_zoomStart.y)*this.dynamicDampingFactor;}_changed=true;}}};this.panCamera=function(){var mouseChange=new Vector2$1(),objectUp=new Vector3$1(),pan=new Vector3$1();return function panCamera(){mouseChange.copy(_panEnd).sub(_panStart);if(mouseChange.lengthSq()){// Scale movement to keep clicked/dragged position under cursor
  var scale_x=(_this.object.right-_this.object.left)/_this.object.zoom;var scale_y=(_this.object.top-_this.object.bottom)/_this.object.zoom;mouseChange.x*=scale_x;mouseChange.y*=scale_y;pan.copy(_eye).cross(_this.object.up).setLength(mouseChange.x);pan.add(objectUp.copy(_this.object.up).setLength(mouseChange.y));_this.object.position.add(pan);_this.target.add(pan);if(_this.staticMoving){_panStart.copy(_panEnd);}else{_panStart.add(mouseChange.subVectors(_panEnd,_panStart).multiplyScalar(_this.dynamicDampingFactor));}_changed=true;}};}();this.update=function(){_eye.subVectors(_this.object.position,_this.target);if(!_this.noRotate){_this.rotateCamera();}if(!_this.noZoom){_this.zoomCamera();if(_changed){_this.object.updateProjectionMatrix();}}if(!_this.noPan){_this.panCamera();}_this.object.position.addVectors(_this.target,_eye);_this.object.lookAt(_this.target);if(_changed){_this.dispatchEvent(changeEvent);_changed=false;}};this.reset=function(){_state=STATE.NONE;_prevState=STATE.NONE;_this.target.copy(_this.target0);_this.object.position.copy(_this.position0);_this.object.up.copy(_this.up0);_eye.subVectors(_this.object.position,_this.target);_this.object.left=_this.left0;_this.object.right=_this.right0;_this.object.top=_this.top0;_this.object.bottom=_this.bottom0;_this.object.lookAt(_this.target);_this.dispatchEvent(changeEvent);_changed=false;};// listeners
  function keydown(event){if(_this.enabled===false){return;}window.removeEventListener('keydown',keydown);_prevState=_state;if(_state!==STATE.NONE){return;}else if(event.keyCode===_this.keys[STATE.ROTATE]&&!_this.noRotate){_state=STATE.ROTATE;}else if(event.keyCode===_this.keys[STATE.ZOOM]&&!_this.noZoom){_state=STATE.ZOOM;}else if(event.keyCode===_this.keys[STATE.PAN]&&!_this.noPan){_state=STATE.PAN;}}function keyup(event){if(_this.enabled===false){return;}_state=_prevState;window.addEventListener('keydown',keydown,false);}function mousedown(event){if(_this.enabled===false){return;}event.preventDefault();event.stopPropagation();if(_state===STATE.NONE){_state=event.button;}if(_state===STATE.ROTATE&&!_this.noRotate){_rotateStart.copy(getMouseProjectionOnBall(event.pageX,event.pageY));_rotateEnd.copy(_rotateStart);}else if(_state===STATE.ZOOM&&!_this.noZoom){_zoomStart.copy(getMouseOnScreen(event.pageX,event.pageY));_zoomEnd.copy(_zoomStart);}else if(_state===STATE.PAN&&!_this.noPan){_panStart.copy(getMouseOnScreen(event.pageX,event.pageY));_panEnd.copy(_panStart);}document.addEventListener('mousemove',mousemove,false);document.addEventListener('mouseup',mouseup,false);_this.dispatchEvent(startEvent);}function mousemove(event){if(_this.enabled===false){return;}event.preventDefault();event.stopPropagation();if(_state===STATE.ROTATE&&!_this.noRotate){_rotateEnd.copy(getMouseProjectionOnBall(event.pageX,event.pageY));}else if(_state===STATE.ZOOM&&!_this.noZoom){_zoomEnd.copy(getMouseOnScreen(event.pageX,event.pageY));}else if(_state===STATE.PAN&&!_this.noPan){_panEnd.copy(getMouseOnScreen(event.pageX,event.pageY));}}function mouseup(event){if(_this.enabled===false){return;}event.preventDefault();event.stopPropagation();_state=STATE.NONE;document.removeEventListener('mousemove',mousemove);document.removeEventListener('mouseup',mouseup);_this.dispatchEvent(endEvent);}function mousewheel(event){if(_this.enabled===false){return;}event.preventDefault();event.stopPropagation();_zoomStart.y+=event.deltaY*0.01;_this.dispatchEvent(startEvent);_this.dispatchEvent(endEvent);}function touchstart(event){if(_this.enabled===false){return;}switch(event.touches.length){case 1:_state=STATE.TOUCH_ROTATE;_rotateStart.copy(getMouseProjectionOnBall(event.touches[0].pageX,event.touches[0].pageY));_rotateEnd.copy(_rotateStart);break;case 2:_state=STATE.TOUCH_ZOOM_PAN;var dx=event.touches[0].pageX-event.touches[1].pageX;var dy=event.touches[0].pageY-event.touches[1].pageY;_touchZoomDistanceEnd=_touchZoomDistanceStart=Math.sqrt(dx*dx+dy*dy);var x=(event.touches[0].pageX+event.touches[1].pageX)/2;var y=(event.touches[0].pageY+event.touches[1].pageY)/2;_panStart.copy(getMouseOnScreen(x,y));_panEnd.copy(_panStart);break;default:_state=STATE.NONE;}_this.dispatchEvent(startEvent);}function touchmove(event){if(_this.enabled===false){return;}event.preventDefault();event.stopPropagation();switch(event.touches.length){case 1:_rotateEnd.copy(getMouseProjectionOnBall(event.touches[0].pageX,event.touches[0].pageY));break;case 2:var dx=event.touches[0].pageX-event.touches[1].pageX;var dy=event.touches[0].pageY-event.touches[1].pageY;_touchZoomDistanceEnd=Math.sqrt(dx*dx+dy*dy);var x=(event.touches[0].pageX+event.touches[1].pageX)/2;var y=(event.touches[0].pageY+event.touches[1].pageY)/2;_panEnd.copy(getMouseOnScreen(x,y));break;default:_state=STATE.NONE;}}function touchend(event){if(_this.enabled===false){return;}switch(event.touches.length){case 1:_rotateEnd.copy(getMouseProjectionOnBall(event.touches[0].pageX,event.touches[0].pageY));_rotateStart.copy(_rotateEnd);break;case 2:_touchZoomDistanceStart=_touchZoomDistanceEnd=0;var x=(event.touches[0].pageX+event.touches[1].pageX)/2;var y=(event.touches[0].pageY+event.touches[1].pageY)/2;_panEnd.copy(getMouseOnScreen(x,y));_panStart.copy(_panEnd);break;}_state=STATE.NONE;_this.dispatchEvent(endEvent);}function contextmenu(event){event.preventDefault();}this.dispose=function(){this.domElement.removeEventListener('contextmenu',contextmenu,false);this.domElement.removeEventListener('mousedown',mousedown,false);this.domElement.removeEventListener('wheel',mousewheel,false);this.domElement.removeEventListener('touchstart',touchstart,false);this.domElement.removeEventListener('touchend',touchend,false);this.domElement.removeEventListener('touchmove',touchmove,false);document.removeEventListener('mousemove',mousemove,false);document.removeEventListener('mouseup',mouseup,false);window.removeEventListener('keydown',keydown,false);window.removeEventListener('keyup',keyup,false);};this.domElement.addEventListener('contextmenu',contextmenu,false);this.domElement.addEventListener('mousedown',mousedown,false);this.domElement.addEventListener('wheel',mousewheel,false);this.domElement.addEventListener('touchstart',touchstart,false);this.domElement.addEventListener('touchend',touchend,false);this.domElement.addEventListener('touchmove',touchmove,false);window.addEventListener('keydown',keydown,false);window.addEventListener('keyup',keyup,false);this.handleResize();// force an update at start
  this.update();};OrthographicTrackballControls.prototype=Object.create(EventDispatcher.prototype);OrthographicTrackballControls.prototype.constructor=OrthographicTrackballControls;/**
   * @author mrdoob / http://mrdoob.com/
   */var TrackballControls=function TrackballControls(object,domElement){var _this=this;var STATE={NONE:-1,ROTATE:0,ZOOM:1,PAN:2,TOUCH_ROTATE:3,TOUCH_ZOOM_PAN:4};this.object=object;this.domElement=domElement!==undefined?domElement:document;// API
  this.enabled=true;this.screen={left:0,top:0,width:0,height:0};this.rotateSpeed=1.0;this.zoomSpeed=1.2;this.panSpeed=0.3;this.noRotate=false;this.noZoom=false;this.noPan=false;this.staticMoving=false;this.dynamicDampingFactor=0.2;this.minDistance=0;this.maxDistance=Infinity;this.keys=[65/*A*/,83/*S*/,68/*D*/];// internals
  this.target=new Vector3$1();var EPS=0.000001;var lastPosition=new Vector3$1();var _state=STATE.NONE,_prevState=STATE.NONE,_eye=new Vector3$1(),_movePrev=new Vector2$1(),_moveCurr=new Vector2$1(),_lastAxis=new Vector3$1(),_lastAngle=0,_zoomStart=new Vector2$1(),_zoomEnd=new Vector2$1(),_touchZoomDistanceStart=0,_touchZoomDistanceEnd=0,_panStart=new Vector2$1(),_panEnd=new Vector2$1();// for reset
  this.target0=this.target.clone();this.position0=this.object.position.clone();this.up0=this.object.up.clone();// events
  var changeEvent={type:'change'};var startEvent={type:'start'};var endEvent={type:'end'};// methods
  this.handleResize=function(){if(this.domElement===document){this.screen.left=0;this.screen.top=0;this.screen.width=window.innerWidth;this.screen.height=window.innerHeight;}else{var box=this.domElement.getBoundingClientRect();// adjustments come from similar code in the jquery offset() function
  var d=this.domElement.ownerDocument.documentElement;this.screen.left=box.left+window.pageXOffset-d.clientLeft;this.screen.top=box.top+window.pageYOffset-d.clientTop;this.screen.width=box.width;this.screen.height=box.height;}};this.handleEvent=function(event){if(typeof this[event.type]=='function'){this[event.type](event);}};var getMouseOnScreen=function(){var vector=new Vector2$1();return function getMouseOnScreen(pageX,pageY){vector.set((pageX-_this.screen.left)/_this.screen.width,(pageY-_this.screen.top)/_this.screen.height);return vector;};}();var getMouseOnCircle=function(){var vector=new Vector2$1();return function getMouseOnCircle(pageX,pageY){vector.set((pageX-_this.screen.width*0.5-_this.screen.left)/(_this.screen.width*0.5),(_this.screen.height+2*(_this.screen.top-pageY))/_this.screen.width// screen.width intentional
  );return vector;};}();this.rotateCamera=function(){var axis=new Vector3$1(),quaternion=new Quaternion(),eyeDirection=new Vector3$1(),objectUpDirection=new Vector3$1(),objectSidewaysDirection=new Vector3$1(),moveDirection=new Vector3$1(),angle;return function rotateCamera(){moveDirection.set(_moveCurr.x-_movePrev.x,_moveCurr.y-_movePrev.y,0);angle=moveDirection.length();if(angle){_eye.copy(_this.object.position).sub(_this.target);eyeDirection.copy(_eye).normalize();objectUpDirection.copy(_this.object.up).normalize();objectSidewaysDirection.crossVectors(objectUpDirection,eyeDirection).normalize();objectUpDirection.setLength(_moveCurr.y-_movePrev.y);objectSidewaysDirection.setLength(_moveCurr.x-_movePrev.x);moveDirection.copy(objectUpDirection.add(objectSidewaysDirection));axis.crossVectors(moveDirection,_eye).normalize();angle*=_this.rotateSpeed;quaternion.setFromAxisAngle(axis,angle);_eye.applyQuaternion(quaternion);_this.object.up.applyQuaternion(quaternion);_lastAxis.copy(axis);_lastAngle=angle;}else if(!_this.staticMoving&&_lastAngle){_lastAngle*=Math.sqrt(1.0-_this.dynamicDampingFactor);_eye.copy(_this.object.position).sub(_this.target);quaternion.setFromAxisAngle(_lastAxis,_lastAngle);_eye.applyQuaternion(quaternion);_this.object.up.applyQuaternion(quaternion);}_movePrev.copy(_moveCurr);};}();this.zoomCamera=function(){var factor;if(_state===STATE.TOUCH_ZOOM_PAN){factor=_touchZoomDistanceStart/_touchZoomDistanceEnd;_touchZoomDistanceStart=_touchZoomDistanceEnd;_eye.multiplyScalar(factor);}else{factor=1.0+(_zoomEnd.y-_zoomStart.y)*_this.zoomSpeed;if(factor!==1.0&&factor>0.0){_eye.multiplyScalar(factor);}if(_this.staticMoving){_zoomStart.copy(_zoomEnd);}else{_zoomStart.y+=(_zoomEnd.y-_zoomStart.y)*this.dynamicDampingFactor;}}};this.panCamera=function(){var mouseChange=new Vector2$1(),objectUp=new Vector3$1(),pan=new Vector3$1();return function panCamera(){mouseChange.copy(_panEnd).sub(_panStart);if(mouseChange.lengthSq()){mouseChange.multiplyScalar(_eye.length()*_this.panSpeed);pan.copy(_eye).cross(_this.object.up).setLength(mouseChange.x);pan.add(objectUp.copy(_this.object.up).setLength(mouseChange.y));_this.object.position.add(pan);_this.target.add(pan);if(_this.staticMoving){_panStart.copy(_panEnd);}else{_panStart.add(mouseChange.subVectors(_panEnd,_panStart).multiplyScalar(_this.dynamicDampingFactor));}}};}();this.checkDistances=function(){if(!_this.noZoom||!_this.noPan){if(_eye.lengthSq()>_this.maxDistance*_this.maxDistance){_this.object.position.addVectors(_this.target,_eye.setLength(_this.maxDistance));_zoomStart.copy(_zoomEnd);}if(_eye.lengthSq()<_this.minDistance*_this.minDistance){_this.object.position.addVectors(_this.target,_eye.setLength(_this.minDistance));_zoomStart.copy(_zoomEnd);}}};this.update=function(){_eye.subVectors(_this.object.position,_this.target);if(!_this.noRotate){_this.rotateCamera();}if(!_this.noZoom){_this.zoomCamera();}if(!_this.noPan){_this.panCamera();}_this.object.position.addVectors(_this.target,_eye);_this.checkDistances();_this.object.lookAt(_this.target);if(lastPosition.distanceToSquared(_this.object.position)>EPS){_this.dispatchEvent(changeEvent);lastPosition.copy(_this.object.position);}};this.reset=function(){_state=STATE.NONE;_prevState=STATE.NONE;_this.target.copy(_this.target0);_this.object.position.copy(_this.position0);_this.object.up.copy(_this.up0);_eye.subVectors(_this.object.position,_this.target);_this.object.lookAt(_this.target);_this.dispatchEvent(changeEvent);lastPosition.copy(_this.object.position);};// listeners
  function keydown(event){if(_this.enabled===false){return;}window.removeEventListener('keydown',keydown);_prevState=_state;if(_state!==STATE.NONE){return;}else if(event.keyCode===_this.keys[STATE.ROTATE]&&!_this.noRotate){_state=STATE.ROTATE;}else if(event.keyCode===_this.keys[STATE.ZOOM]&&!_this.noZoom){_state=STATE.ZOOM;}else if(event.keyCode===_this.keys[STATE.PAN]&&!_this.noPan){_state=STATE.PAN;}}function keyup(event){if(_this.enabled===false){return;}_state=_prevState;window.addEventListener('keydown',keydown,false);}function mousedown(event){if(_this.enabled===false){return;}event.preventDefault();event.stopPropagation();if(_state===STATE.NONE){_state=event.button;}if(_state===STATE.ROTATE&&!_this.noRotate){_moveCurr.copy(getMouseOnCircle(event.pageX,event.pageY));_movePrev.copy(_moveCurr);}else if(_state===STATE.ZOOM&&!_this.noZoom){_zoomStart.copy(getMouseOnScreen(event.pageX,event.pageY));_zoomEnd.copy(_zoomStart);}else if(_state===STATE.PAN&&!_this.noPan){_panStart.copy(getMouseOnScreen(event.pageX,event.pageY));_panEnd.copy(_panStart);}document.addEventListener('mousemove',mousemove,false);document.addEventListener('mouseup',mouseup,false);_this.dispatchEvent(startEvent);}function mousemove(event){if(_this.enabled===false){return;}event.preventDefault();event.stopPropagation();if(_state===STATE.ROTATE&&!_this.noRotate){_movePrev.copy(_moveCurr);_moveCurr.copy(getMouseOnCircle(event.pageX,event.pageY));}else if(_state===STATE.ZOOM&&!_this.noZoom){_zoomEnd.copy(getMouseOnScreen(event.pageX,event.pageY));}else if(_state===STATE.PAN&&!_this.noPan){_panEnd.copy(getMouseOnScreen(event.pageX,event.pageY));}}function mouseup(event){if(_this.enabled===false){return;}event.preventDefault();event.stopPropagation();_state=STATE.NONE;document.removeEventListener('mousemove',mousemove);document.removeEventListener('mouseup',mouseup);_this.dispatchEvent(endEvent);}function mousewheel(event){if(_this.enabled===false){return;}event.preventDefault();event.stopPropagation();switch(event.deltaMode){case 2:// Zoom in pages
  _zoomStart.y-=event.deltaY*0.025;break;case 1:// Zoom in lines
  _zoomStart.y-=event.deltaY*0.01;break;default:// undefined, 0, assume pixels
  _zoomStart.y-=event.deltaY*0.00025;break;}_this.dispatchEvent(startEvent);_this.dispatchEvent(endEvent);}function touchstart(event){if(_this.enabled===false){return;}switch(event.touches.length){case 1:_state=STATE.TOUCH_ROTATE;_moveCurr.copy(getMouseOnCircle(event.touches[0].pageX,event.touches[0].pageY));_movePrev.copy(_moveCurr);break;default:// 2 or more
  _state=STATE.TOUCH_ZOOM_PAN;var dx=event.touches[0].pageX-event.touches[1].pageX;var dy=event.touches[0].pageY-event.touches[1].pageY;_touchZoomDistanceEnd=_touchZoomDistanceStart=Math.sqrt(dx*dx+dy*dy);var x=(event.touches[0].pageX+event.touches[1].pageX)/2;var y=(event.touches[0].pageY+event.touches[1].pageY)/2;_panStart.copy(getMouseOnScreen(x,y));_panEnd.copy(_panStart);break;}_this.dispatchEvent(startEvent);}function touchmove(event){if(_this.enabled===false){return;}event.preventDefault();event.stopPropagation();switch(event.touches.length){case 1:_movePrev.copy(_moveCurr);_moveCurr.copy(getMouseOnCircle(event.touches[0].pageX,event.touches[0].pageY));break;default:// 2 or more
  var dx=event.touches[0].pageX-event.touches[1].pageX;var dy=event.touches[0].pageY-event.touches[1].pageY;_touchZoomDistanceEnd=Math.sqrt(dx*dx+dy*dy);var x=(event.touches[0].pageX+event.touches[1].pageX)/2;var y=(event.touches[0].pageY+event.touches[1].pageY)/2;_panEnd.copy(getMouseOnScreen(x,y));break;}}function touchend(event){if(_this.enabled===false){return;}switch(event.touches.length){case 0:_state=STATE.NONE;break;case 1:_state=STATE.TOUCH_ROTATE;_moveCurr.copy(getMouseOnCircle(event.touches[0].pageX,event.touches[0].pageY));_movePrev.copy(_moveCurr);break;}_this.dispatchEvent(endEvent);}function contextmenu(event){if(_this.enabled===false){return;}event.preventDefault();}this.dispose=function(){this.domElement.removeEventListener('contextmenu',contextmenu,false);this.domElement.removeEventListener('mousedown',mousedown,false);this.domElement.removeEventListener('wheel',mousewheel,false);this.domElement.removeEventListener('touchstart',touchstart,false);this.domElement.removeEventListener('touchend',touchend,false);this.domElement.removeEventListener('touchmove',touchmove,false);document.removeEventListener('mousemove',mousemove,false);document.removeEventListener('mouseup',mouseup,false);window.removeEventListener('keydown',keydown,false);window.removeEventListener('keyup',keyup,false);};this.domElement.addEventListener('contextmenu',contextmenu,false);this.domElement.addEventListener('mousedown',mousedown,false);this.domElement.addEventListener('wheel',mousewheel,false);this.domElement.addEventListener('touchstart',touchstart,false);this.domElement.addEventListener('touchend',touchend,false);this.domElement.addEventListener('touchmove',touchmove,false);window.addEventListener('keydown',keydown,false);window.addEventListener('keyup',keyup,false);this.handleResize();// force an update at start
  this.update();};TrackballControls.prototype=Object.create(EventDispatcher.prototype);TrackballControls.prototype.constructor=TrackballControls;var GizmoMaterial=function GizmoMaterial(parameters){MeshBasicMaterial.call(this);this.depthTest=false;this.depthWrite=false;this.side=FrontSide;this.transparent=true;this.setValues(parameters);this.oldColor=this.color.clone();this.oldOpacity=this.opacity;this.highlight=function(highlighted){if(highlighted){this.color.setRGB(1,1,0);this.opacity=1;}else{this.color.copy(this.oldColor);this.opacity=this.oldOpacity;}};};GizmoMaterial.prototype=Object.create(MeshBasicMaterial.prototype);GizmoMaterial.prototype.constructor=GizmoMaterial;var GizmoLineMaterial=function GizmoLineMaterial(parameters){LineBasicMaterial$1.call(this);this.depthTest=false;this.depthWrite=false;this.transparent=true;this.linewidth=1;this.setValues(parameters);this.oldColor=this.color.clone();this.oldOpacity=this.opacity;this.highlight=function(highlighted){if(highlighted){this.color.setRGB(1,1,0);this.opacity=1;}else{this.color.copy(this.oldColor);this.opacity=this.oldOpacity;}};};GizmoLineMaterial.prototype=Object.create(LineBasicMaterial$1.prototype);GizmoLineMaterial.prototype.constructor=GizmoLineMaterial;var pickerMaterial=new GizmoMaterial({visible:false,transparent:false});var TransformGizmo=function TransformGizmo(){this.init=function(){var this$1=this;Object3D.call(this);this.handles=new Object3D();this.pickers=new Object3D();this.planes=new Object3D();this.add(this.handles);this.add(this.pickers);this.add(this.planes);//// PLANES
  var planeGeometry=new PlaneBufferGeometry(50,50,2,2);var planeMaterial=new MeshBasicMaterial({visible:false,side:DoubleSide});var planes={"XY":new Mesh(planeGeometry,planeMaterial),"YZ":new Mesh(planeGeometry,planeMaterial),"XZ":new Mesh(planeGeometry,planeMaterial),"XYZE":new Mesh(planeGeometry,planeMaterial)};this.activePlane=planes["XYZE"];planes["YZ"].rotation.set(0,Math.PI/2,0);planes["XZ"].rotation.set(-Math.PI/2,0,0);for(var i in planes){planes[i].name=i;this$1.planes.add(planes[i]);this$1.planes[i]=planes[i];}//// HANDLES AND PICKERS
  var setupGizmos=function setupGizmos(gizmoMap,parent){for(var name in gizmoMap){for(i=gizmoMap[name].length;i--;){var object=gizmoMap[name][i][0];var position=gizmoMap[name][i][1];var rotation=gizmoMap[name][i][2];object.name=name;if(position){object.position.set(position[0],position[1],position[2]);}if(rotation){object.rotation.set(rotation[0],rotation[1],rotation[2]);}parent.add(object);}}};setupGizmos(this.handleGizmos,this.handles);setupGizmos(this.pickerGizmos,this.pickers);// reset Transformations
  this.traverse(function(child){if(child instanceof Mesh){child.updateMatrix();var tempGeometry=child.geometry.clone();tempGeometry.applyMatrix(child.matrix);child.geometry=tempGeometry;child.position.set(0,0,0);child.rotation.set(0,0,0);child.scale.set(1,1,1);}});};this.highlight=function(axis){this.traverse(function(child){if(child.material&&child.material.highlight){if(child.name===axis){child.material.highlight(true);}else{child.material.highlight(false);}}});};};TransformGizmo.prototype=Object.create(Object3D.prototype);TransformGizmo.prototype.constructor=TransformGizmo;TransformGizmo.prototype.update=function(rotation,eye){var vec1=new Vector3$1(0,0,0);var vec2=new Vector3$1(0,1,0);var lookAtMatrix=new Matrix4();this.traverse(function(child){if(child.name.search("E")!==-1){child.quaternion.setFromRotationMatrix(lookAtMatrix.lookAt(eye,vec1,vec2));}else if(child.name.search("X")!==-1||child.name.search("Y")!==-1||child.name.search("Z")!==-1){child.quaternion.setFromEuler(rotation);}});};var TransformGizmoTranslate=function TransformGizmoTranslate(){TransformGizmo.call(this);var arrowGeometry=new Geometry();var mesh=new Mesh(new CylinderGeometry(0,0.05,0.2,12,1,false));mesh.position.y=0.5;mesh.updateMatrix();arrowGeometry.merge(mesh.geometry,mesh.matrix);var lineXGeometry=new BufferGeometry();lineXGeometry.addAttribute('position',new Float32BufferAttribute([0,0,0,1,0,0],3));var lineYGeometry=new BufferGeometry();lineYGeometry.addAttribute('position',new Float32BufferAttribute([0,0,0,0,1,0],3));var lineZGeometry=new BufferGeometry();lineZGeometry.addAttribute('position',new Float32BufferAttribute([0,0,0,0,0,1],3));this.handleGizmos={X:[[new Mesh(arrowGeometry,new GizmoMaterial({color:0xff0000})),[0.5,0,0],[0,0,-Math.PI/2]],[new Line$1(lineXGeometry,new GizmoLineMaterial({color:0xff0000}))]],Y:[[new Mesh(arrowGeometry,new GizmoMaterial({color:0x00ff00})),[0,0.5,0]],[new Line$1(lineYGeometry,new GizmoLineMaterial({color:0x00ff00}))]],Z:[[new Mesh(arrowGeometry,new GizmoMaterial({color:0x0000ff})),[0,0,0.5],[Math.PI/2,0,0]],[new Line$1(lineZGeometry,new GizmoLineMaterial({color:0x0000ff}))]],XYZ:[[new Mesh(new OctahedronGeometry(0.1,0),new GizmoMaterial({color:0xffffff,opacity:0.25})),[0,0,0],[0,0,0]]],XY:[[new Mesh(new PlaneBufferGeometry(0.29,0.29),new GizmoMaterial({color:0xffff00,opacity:0.25})),[0.15,0.15,0]]],YZ:[[new Mesh(new PlaneBufferGeometry(0.29,0.29),new GizmoMaterial({color:0x00ffff,opacity:0.25})),[0,0.15,0.15],[0,Math.PI/2,0]]],XZ:[[new Mesh(new PlaneBufferGeometry(0.29,0.29),new GizmoMaterial({color:0xff00ff,opacity:0.25})),[0.15,0,0.15],[-Math.PI/2,0,0]]]};this.pickerGizmos={X:[[new Mesh(new CylinderBufferGeometry(0.2,0,1,4,1,false),pickerMaterial),[0.6,0,0],[0,0,-Math.PI/2]]],Y:[[new Mesh(new CylinderBufferGeometry(0.2,0,1,4,1,false),pickerMaterial),[0,0.6,0]]],Z:[[new Mesh(new CylinderBufferGeometry(0.2,0,1,4,1,false),pickerMaterial),[0,0,0.6],[Math.PI/2,0,0]]],XYZ:[[new Mesh(new OctahedronGeometry(0.2,0),pickerMaterial)]],XY:[[new Mesh(new PlaneBufferGeometry(0.4,0.4),pickerMaterial),[0.2,0.2,0]]],YZ:[[new Mesh(new PlaneBufferGeometry(0.4,0.4),pickerMaterial),[0,0.2,0.2],[0,Math.PI/2,0]]],XZ:[[new Mesh(new PlaneBufferGeometry(0.4,0.4),pickerMaterial),[0.2,0,0.2],[-Math.PI/2,0,0]]]};this.setActivePlane=function(axis,eye){var tempMatrix=new Matrix4();eye.applyMatrix4(tempMatrix.getInverse(tempMatrix.extractRotation(this.planes["XY"].matrixWorld)));if(axis==="X"){this.activePlane=this.planes["XY"];if(Math.abs(eye.y)>Math.abs(eye.z)){this.activePlane=this.planes["XZ"];}}if(axis==="Y"){this.activePlane=this.planes["XY"];if(Math.abs(eye.x)>Math.abs(eye.z)){this.activePlane=this.planes["YZ"];}}if(axis==="Z"){this.activePlane=this.planes["XZ"];if(Math.abs(eye.x)>Math.abs(eye.y)){this.activePlane=this.planes["YZ"];}}if(axis==="XYZ"){this.activePlane=this.planes["XYZE"];}if(axis==="XY"){this.activePlane=this.planes["XY"];}if(axis==="YZ"){this.activePlane=this.planes["YZ"];}if(axis==="XZ"){this.activePlane=this.planes["XZ"];}};this.init();};TransformGizmoTranslate.prototype=Object.create(TransformGizmo.prototype);TransformGizmoTranslate.prototype.constructor=TransformGizmoTranslate;var TransformGizmoRotate=function TransformGizmoRotate(){TransformGizmo.call(this);var CircleGeometry=function CircleGeometry(radius,facing,arc){var geometry=new BufferGeometry();var vertices=[];arc=arc?arc:1;for(var i=0;i<=64*arc;++i){if(facing==='x'){vertices.push(0,Math.cos(i/32*Math.PI)*radius,Math.sin(i/32*Math.PI)*radius);}if(facing==='y'){vertices.push(Math.cos(i/32*Math.PI)*radius,0,Math.sin(i/32*Math.PI)*radius);}if(facing==='z'){vertices.push(Math.sin(i/32*Math.PI)*radius,Math.cos(i/32*Math.PI)*radius,0);}}geometry.addAttribute('position',new Float32BufferAttribute(vertices,3));return geometry;};this.handleGizmos={X:[[new Line$1(new CircleGeometry(1,'x',0.5),new GizmoLineMaterial({color:0xff0000}))]],Y:[[new Line$1(new CircleGeometry(1,'y',0.5),new GizmoLineMaterial({color:0x00ff00}))]],Z:[[new Line$1(new CircleGeometry(1,'z',0.5),new GizmoLineMaterial({color:0x0000ff}))]],E:[[new Line$1(new CircleGeometry(1.25,'z',1),new GizmoLineMaterial({color:0xcccc00}))]],XYZE:[[new Line$1(new CircleGeometry(1,'z',1),new GizmoLineMaterial({color:0x787878}))]]};this.pickerGizmos={X:[[new Mesh(new TorusBufferGeometry(1,0.12,4,12,Math.PI),pickerMaterial),[0,0,0],[0,-Math.PI/2,-Math.PI/2]]],Y:[[new Mesh(new TorusBufferGeometry(1,0.12,4,12,Math.PI),pickerMaterial),[0,0,0],[Math.PI/2,0,0]]],Z:[[new Mesh(new TorusBufferGeometry(1,0.12,4,12,Math.PI),pickerMaterial),[0,0,0],[0,0,-Math.PI/2]]],E:[[new Mesh(new TorusBufferGeometry(1.25,0.12,2,24),pickerMaterial)]],XYZE:[[new Mesh()]// TODO
  ]};this.setActivePlane=function(axis){if(axis==="E"){this.activePlane=this.planes["XYZE"];}if(axis==="X"){this.activePlane=this.planes["YZ"];}if(axis==="Y"){this.activePlane=this.planes["XZ"];}if(axis==="Z"){this.activePlane=this.planes["XY"];}};this.update=function(rotation,eye2){TransformGizmo.prototype.update.apply(this,arguments);var tempMatrix=new Matrix4();var worldRotation=new Euler(0,0,1);var tempQuaternion=new Quaternion();var unitX=new Vector3$1(1,0,0);var unitY=new Vector3$1(0,1,0);var unitZ=new Vector3$1(0,0,1);var quaternionX=new Quaternion();var quaternionY=new Quaternion();var quaternionZ=new Quaternion();var eye=eye2.clone();worldRotation.copy(this.planes["XY"].rotation);tempQuaternion.setFromEuler(worldRotation);tempMatrix.makeRotationFromQuaternion(tempQuaternion).getInverse(tempMatrix);eye.applyMatrix4(tempMatrix);this.traverse(function(child){tempQuaternion.setFromEuler(worldRotation);if(child.name==="X"){quaternionX.setFromAxisAngle(unitX,Math.atan2(-eye.y,eye.z));tempQuaternion.multiplyQuaternions(tempQuaternion,quaternionX);child.quaternion.copy(tempQuaternion);}if(child.name==="Y"){quaternionY.setFromAxisAngle(unitY,Math.atan2(eye.x,eye.z));tempQuaternion.multiplyQuaternions(tempQuaternion,quaternionY);child.quaternion.copy(tempQuaternion);}if(child.name==="Z"){quaternionZ.setFromAxisAngle(unitZ,Math.atan2(eye.y,eye.x));tempQuaternion.multiplyQuaternions(tempQuaternion,quaternionZ);child.quaternion.copy(tempQuaternion);}});};this.init();};TransformGizmoRotate.prototype=Object.create(TransformGizmo.prototype);TransformGizmoRotate.prototype.constructor=TransformGizmoRotate;var TransformGizmoScale=function TransformGizmoScale(){TransformGizmo.call(this);var arrowGeometry=new Geometry();var mesh=new Mesh(new BoxGeometry(0.125,0.125,0.125));mesh.position.y=0.5;mesh.updateMatrix();arrowGeometry.merge(mesh.geometry,mesh.matrix);var lineXGeometry=new BufferGeometry();lineXGeometry.addAttribute('position',new Float32BufferAttribute([0,0,0,1,0,0],3));var lineYGeometry=new BufferGeometry();lineYGeometry.addAttribute('position',new Float32BufferAttribute([0,0,0,0,1,0],3));var lineZGeometry=new BufferGeometry();lineZGeometry.addAttribute('position',new Float32BufferAttribute([0,0,0,0,0,1],3));this.handleGizmos={X:[[new Mesh(arrowGeometry,new GizmoMaterial({color:0xff0000})),[0.5,0,0],[0,0,-Math.PI/2]],[new Line$1(lineXGeometry,new GizmoLineMaterial({color:0xff0000}))]],Y:[[new Mesh(arrowGeometry,new GizmoMaterial({color:0x00ff00})),[0,0.5,0]],[new Line$1(lineYGeometry,new GizmoLineMaterial({color:0x00ff00}))]],Z:[[new Mesh(arrowGeometry,new GizmoMaterial({color:0x0000ff})),[0,0,0.5],[Math.PI/2,0,0]],[new Line$1(lineZGeometry,new GizmoLineMaterial({color:0x0000ff}))]],XYZ:[[new Mesh(new BoxBufferGeometry(0.125,0.125,0.125),new GizmoMaterial({color:0xffffff,opacity:0.25}))]]};this.pickerGizmos={X:[[new Mesh(new CylinderBufferGeometry(0.2,0,1,4,1,false),pickerMaterial),[0.6,0,0],[0,0,-Math.PI/2]]],Y:[[new Mesh(new CylinderBufferGeometry(0.2,0,1,4,1,false),pickerMaterial),[0,0.6,0]]],Z:[[new Mesh(new CylinderBufferGeometry(0.2,0,1,4,1,false),pickerMaterial),[0,0,0.6],[Math.PI/2,0,0]]],XYZ:[[new Mesh(new BoxBufferGeometry(0.4,0.4,0.4),pickerMaterial)]]};this.setActivePlane=function(axis,eye){var tempMatrix=new Matrix4();eye.applyMatrix4(tempMatrix.getInverse(tempMatrix.extractRotation(this.planes["XY"].matrixWorld)));if(axis==="X"){this.activePlane=this.planes["XY"];if(Math.abs(eye.y)>Math.abs(eye.z)){this.activePlane=this.planes["XZ"];}}if(axis==="Y"){this.activePlane=this.planes["XY"];if(Math.abs(eye.x)>Math.abs(eye.z)){this.activePlane=this.planes["YZ"];}}if(axis==="Z"){this.activePlane=this.planes["XZ"];if(Math.abs(eye.x)>Math.abs(eye.y)){this.activePlane=this.planes["YZ"];}}if(axis==="XYZ"){this.activePlane=this.planes["XYZE"];}};this.init();};TransformGizmoScale.prototype=Object.create(TransformGizmo.prototype);TransformGizmoScale.prototype.constructor=TransformGizmoScale;var TransformControls=function TransformControls(camera,domElement){var this$1=this;// TODO: Make non-uniform scale and rotate play nice in hierarchies
  // TODO: ADD RXYZ contol
  Object3D.call(this);domElement=domElement!==undefined?domElement:document;this.object=undefined;this.visible=false;this.translationSnap=null;this.rotationSnap=null;this.space="world";this.size=1;this.axis=null;var scope=this;var _mode="translate";var _dragging=false;var _gizmo={"translate":new TransformGizmoTranslate(),"rotate":new TransformGizmoRotate(),"scale":new TransformGizmoScale()};for(var type in _gizmo){var gizmoObj=_gizmo[type];gizmoObj.visible=type===_mode;this$1.add(gizmoObj);}var changeEvent={type:"change"};var mouseDownEvent={type:"mouseDown"};var mouseUpEvent={type:"mouseUp",mode:_mode};var objectChangeEvent={type:"objectChange"};var ray=new Raycaster();var pointerVector=new Vector2$1();var point=new Vector3$1();var offset=new Vector3$1();var rotation=new Vector3$1();var offsetRotation=new Vector3$1();var scale=1;var lookAtMatrix=new Matrix4();var eye=new Vector3$1();var tempMatrix=new Matrix4();var tempVector=new Vector3$1();var tempQuaternion=new Quaternion();var unitX=new Vector3$1(1,0,0);var unitY=new Vector3$1(0,1,0);var unitZ=new Vector3$1(0,0,1);var quaternionXYZ=new Quaternion();var quaternionX=new Quaternion();var quaternionY=new Quaternion();var quaternionZ=new Quaternion();var quaternionE=new Quaternion();var oldPosition=new Vector3$1();var oldScale=new Vector3$1();var oldRotationMatrix=new Matrix4();var parentRotationMatrix=new Matrix4();var parentScale=new Vector3$1();var worldPosition=new Vector3$1();var worldRotation=new Euler();var worldRotationMatrix=new Matrix4();var camPosition=new Vector3$1();var camRotation=new Euler();domElement.addEventListener("mousedown",onPointerDown,false);domElement.addEventListener("touchstart",onPointerDown,false);domElement.addEventListener("mousemove",onPointerHover,false);domElement.addEventListener("touchmove",onPointerHover,false);domElement.addEventListener("mousemove",onPointerMove,false);domElement.addEventListener("touchmove",onPointerMove,false);domElement.addEventListener("mouseup",onPointerUp,false);domElement.addEventListener("mouseout",onPointerUp,false);domElement.addEventListener("touchend",onPointerUp,false);domElement.addEventListener("touchcancel",onPointerUp,false);domElement.addEventListener("touchleave",onPointerUp,false);this.dispose=function(){domElement.removeEventListener("mousedown",onPointerDown);domElement.removeEventListener("touchstart",onPointerDown);domElement.removeEventListener("mousemove",onPointerHover);domElement.removeEventListener("touchmove",onPointerHover);domElement.removeEventListener("mousemove",onPointerMove);domElement.removeEventListener("touchmove",onPointerMove);domElement.removeEventListener("mouseup",onPointerUp);domElement.removeEventListener("mouseout",onPointerUp);domElement.removeEventListener("touchend",onPointerUp);domElement.removeEventListener("touchcancel",onPointerUp);domElement.removeEventListener("touchleave",onPointerUp);};this.attach=function(object){this.object=object;this.visible=true;this.update();};this.detach=function(){this.object=undefined;this.visible=false;this.axis=null;};this.getMode=function(){return _mode;};this.setMode=function(mode){_mode=mode?mode:_mode;if(_mode==="scale"){scope.space="local";}for(var type in _gizmo){_gizmo[type].visible=type===_mode;}this.update();scope.dispatchEvent(changeEvent);};this.setTranslationSnap=function(translationSnap){scope.translationSnap=translationSnap;};this.setRotationSnap=function(rotationSnap){scope.rotationSnap=rotationSnap;};this.setSize=function(size){scope.size=size;this.update();scope.dispatchEvent(changeEvent);};this.setSpace=function(space){scope.space=space;this.update();scope.dispatchEvent(changeEvent);};this.update=function(){if(scope.object===undefined){return;}scope.object.updateMatrixWorld();worldPosition.setFromMatrixPosition(scope.object.matrixWorld);worldRotation.setFromRotationMatrix(tempMatrix.extractRotation(scope.object.matrixWorld));camera.updateMatrixWorld();camPosition.setFromMatrixPosition(camera.matrixWorld);camRotation.setFromRotationMatrix(tempMatrix.extractRotation(camera.matrixWorld));scale=worldPosition.distanceTo(camPosition)/6*scope.size;this.position.copy(worldPosition);this.scale.set(scale,scale,scale);if(camera instanceof PerspectiveCamera){eye.copy(camPosition).sub(worldPosition).normalize();}else if(camera instanceof OrthographicCamera){eye.copy(camPosition).normalize();}if(scope.space==="local"){_gizmo[_mode].update(worldRotation,eye);}else if(scope.space==="world"){_gizmo[_mode].update(new Euler(),eye);}_gizmo[_mode].highlight(scope.axis);};function onPointerHover(event){if(scope.object===undefined||_dragging===true||event.button!==undefined&&event.button!==0){return;}var pointer=event.changedTouches?event.changedTouches[0]:event;var intersect=intersectObjects(pointer,_gizmo[_mode].pickers.children);var axis=null;if(intersect){axis=intersect.object.name;event.preventDefault();}if(scope.axis!==axis){scope.axis=axis;scope.update();scope.dispatchEvent(changeEvent);}}function onPointerDown(event){if(scope.object===undefined||_dragging===true||event.button!==undefined&&event.button!==0){return;}var pointer=event.changedTouches?event.changedTouches[0]:event;if(pointer.button===0||pointer.button===undefined){var intersect=intersectObjects(pointer,_gizmo[_mode].pickers.children);if(intersect){event.preventDefault();event.stopPropagation();scope.dispatchEvent(mouseDownEvent);scope.axis=intersect.object.name;scope.update();eye.copy(camPosition).sub(worldPosition).normalize();_gizmo[_mode].setActivePlane(scope.axis,eye);var planeIntersect=intersectObjects(pointer,[_gizmo[_mode].activePlane]);if(planeIntersect){oldPosition.copy(scope.object.position);oldScale.copy(scope.object.scale);oldRotationMatrix.extractRotation(scope.object.matrix);worldRotationMatrix.extractRotation(scope.object.matrixWorld);parentRotationMatrix.extractRotation(scope.object.parent.matrixWorld);parentScale.setFromMatrixScale(tempMatrix.getInverse(scope.object.parent.matrixWorld));offset.copy(planeIntersect.point);}}}_dragging=true;}function onPointerMove(event){if(scope.object===undefined||scope.axis===null||_dragging===false||event.button!==undefined&&event.button!==0){return;}var pointer=event.changedTouches?event.changedTouches[0]:event;var planeIntersect=intersectObjects(pointer,[_gizmo[_mode].activePlane]);if(planeIntersect===false){return;}event.preventDefault();event.stopPropagation();point.copy(planeIntersect.point);if(_mode==="translate"){point.sub(offset);point.multiply(parentScale);if(scope.space==="local"){point.applyMatrix4(tempMatrix.getInverse(worldRotationMatrix));if(scope.axis.search("X")===-1){point.x=0;}if(scope.axis.search("Y")===-1){point.y=0;}if(scope.axis.search("Z")===-1){point.z=0;}point.applyMatrix4(oldRotationMatrix);scope.object.position.copy(oldPosition);scope.object.position.add(point);}if(scope.space==="world"||scope.axis.search("XYZ")!==-1){if(scope.axis.search("X")===-1){point.x=0;}if(scope.axis.search("Y")===-1){point.y=0;}if(scope.axis.search("Z")===-1){point.z=0;}point.applyMatrix4(tempMatrix.getInverse(parentRotationMatrix));scope.object.position.copy(oldPosition);scope.object.position.add(point);}if(scope.translationSnap!==null){if(scope.space==="local"){scope.object.position.applyMatrix4(tempMatrix.getInverse(worldRotationMatrix));}if(scope.axis.search("X")!==-1){scope.object.position.x=Math.round(scope.object.position.x/scope.translationSnap)*scope.translationSnap;}if(scope.axis.search("Y")!==-1){scope.object.position.y=Math.round(scope.object.position.y/scope.translationSnap)*scope.translationSnap;}if(scope.axis.search("Z")!==-1){scope.object.position.z=Math.round(scope.object.position.z/scope.translationSnap)*scope.translationSnap;}if(scope.space==="local"){scope.object.position.applyMatrix4(worldRotationMatrix);}}}else if(_mode==="scale"){point.sub(offset);point.multiply(parentScale);if(scope.space==="local"){if(scope.axis==="XYZ"){scale=1+point.y/Math.max(oldScale.x,oldScale.y,oldScale.z);scope.object.scale.x=oldScale.x*scale;scope.object.scale.y=oldScale.y*scale;scope.object.scale.z=oldScale.z*scale;}else{point.applyMatrix4(tempMatrix.getInverse(worldRotationMatrix));if(scope.axis==="X"){scope.object.scale.x=oldScale.x*(1+point.x/oldScale.x);}if(scope.axis==="Y"){scope.object.scale.y=oldScale.y*(1+point.y/oldScale.y);}if(scope.axis==="Z"){scope.object.scale.z=oldScale.z*(1+point.z/oldScale.z);}}}}else if(_mode==="rotate"){point.sub(worldPosition);point.multiply(parentScale);tempVector.copy(offset).sub(worldPosition);tempVector.multiply(parentScale);if(scope.axis==="E"){point.applyMatrix4(tempMatrix.getInverse(lookAtMatrix));tempVector.applyMatrix4(tempMatrix.getInverse(lookAtMatrix));rotation.set(Math.atan2(point.z,point.y),Math.atan2(point.x,point.z),Math.atan2(point.y,point.x));offsetRotation.set(Math.atan2(tempVector.z,tempVector.y),Math.atan2(tempVector.x,tempVector.z),Math.atan2(tempVector.y,tempVector.x));tempQuaternion.setFromRotationMatrix(tempMatrix.getInverse(parentRotationMatrix));quaternionE.setFromAxisAngle(eye,rotation.z-offsetRotation.z);quaternionXYZ.setFromRotationMatrix(worldRotationMatrix);tempQuaternion.multiplyQuaternions(tempQuaternion,quaternionE);tempQuaternion.multiplyQuaternions(tempQuaternion,quaternionXYZ);scope.object.quaternion.copy(tempQuaternion);}else if(scope.axis==="XYZE"){quaternionE.setFromEuler(point.clone().cross(tempVector).normalize());// rotation axis
  tempQuaternion.setFromRotationMatrix(tempMatrix.getInverse(parentRotationMatrix));quaternionX.setFromAxisAngle(quaternionE,-point.clone().angleTo(tempVector));quaternionXYZ.setFromRotationMatrix(worldRotationMatrix);tempQuaternion.multiplyQuaternions(tempQuaternion,quaternionX);tempQuaternion.multiplyQuaternions(tempQuaternion,quaternionXYZ);scope.object.quaternion.copy(tempQuaternion);}else if(scope.space==="local"){point.applyMatrix4(tempMatrix.getInverse(worldRotationMatrix));tempVector.applyMatrix4(tempMatrix.getInverse(worldRotationMatrix));rotation.set(Math.atan2(point.z,point.y),Math.atan2(point.x,point.z),Math.atan2(point.y,point.x));offsetRotation.set(Math.atan2(tempVector.z,tempVector.y),Math.atan2(tempVector.x,tempVector.z),Math.atan2(tempVector.y,tempVector.x));quaternionXYZ.setFromRotationMatrix(oldRotationMatrix);if(scope.rotationSnap!==null){quaternionX.setFromAxisAngle(unitX,Math.round((rotation.x-offsetRotation.x)/scope.rotationSnap)*scope.rotationSnap);quaternionY.setFromAxisAngle(unitY,Math.round((rotation.y-offsetRotation.y)/scope.rotationSnap)*scope.rotationSnap);quaternionZ.setFromAxisAngle(unitZ,Math.round((rotation.z-offsetRotation.z)/scope.rotationSnap)*scope.rotationSnap);}else{quaternionX.setFromAxisAngle(unitX,rotation.x-offsetRotation.x);quaternionY.setFromAxisAngle(unitY,rotation.y-offsetRotation.y);quaternionZ.setFromAxisAngle(unitZ,rotation.z-offsetRotation.z);}if(scope.axis==="X"){quaternionXYZ.multiplyQuaternions(quaternionXYZ,quaternionX);}if(scope.axis==="Y"){quaternionXYZ.multiplyQuaternions(quaternionXYZ,quaternionY);}if(scope.axis==="Z"){quaternionXYZ.multiplyQuaternions(quaternionXYZ,quaternionZ);}scope.object.quaternion.copy(quaternionXYZ);}else if(scope.space==="world"){rotation.set(Math.atan2(point.z,point.y),Math.atan2(point.x,point.z),Math.atan2(point.y,point.x));offsetRotation.set(Math.atan2(tempVector.z,tempVector.y),Math.atan2(tempVector.x,tempVector.z),Math.atan2(tempVector.y,tempVector.x));tempQuaternion.setFromRotationMatrix(tempMatrix.getInverse(parentRotationMatrix));if(scope.rotationSnap!==null){quaternionX.setFromAxisAngle(unitX,Math.round((rotation.x-offsetRotation.x)/scope.rotationSnap)*scope.rotationSnap);quaternionY.setFromAxisAngle(unitY,Math.round((rotation.y-offsetRotation.y)/scope.rotationSnap)*scope.rotationSnap);quaternionZ.setFromAxisAngle(unitZ,Math.round((rotation.z-offsetRotation.z)/scope.rotationSnap)*scope.rotationSnap);}else{quaternionX.setFromAxisAngle(unitX,rotation.x-offsetRotation.x);quaternionY.setFromAxisAngle(unitY,rotation.y-offsetRotation.y);quaternionZ.setFromAxisAngle(unitZ,rotation.z-offsetRotation.z);}quaternionXYZ.setFromRotationMatrix(worldRotationMatrix);if(scope.axis==="X"){tempQuaternion.multiplyQuaternions(tempQuaternion,quaternionX);}if(scope.axis==="Y"){tempQuaternion.multiplyQuaternions(tempQuaternion,quaternionY);}if(scope.axis==="Z"){tempQuaternion.multiplyQuaternions(tempQuaternion,quaternionZ);}tempQuaternion.multiplyQuaternions(tempQuaternion,quaternionXYZ);scope.object.quaternion.copy(tempQuaternion);}}scope.update();scope.dispatchEvent(changeEvent);scope.dispatchEvent(objectChangeEvent);}function onPointerUp(event){event.preventDefault();// Prevent MouseEvent on mobile
  if(event.button!==undefined&&event.button!==0){return;}if(_dragging&&scope.axis!==null){mouseUpEvent.mode=_mode;scope.dispatchEvent(mouseUpEvent);}_dragging=false;if('TouchEvent'in window&&event instanceof TouchEvent){// Force "rollover"
  scope.axis=null;scope.update();scope.dispatchEvent(changeEvent);}else{onPointerHover(event);}}function intersectObjects(pointer,objects){var rect=domElement.getBoundingClientRect();var x=(pointer.clientX-rect.left)/rect.width;var y=(pointer.clientY-rect.top)/rect.height;pointerVector.set(x*2-1,-(y*2)+1);ray.setFromCamera(pointerVector,camera);var intersections=ray.intersectObjects(objects,true);return intersections[0]?intersections[0]:false;}};TransformControls.prototype=Object.create(Object3D.prototype);TransformControls.prototype.constructor=TransformControls;/**
   * @author dmarcos / https://github.com/dmarcos
   * @author mrdoob / http://mrdoob.com
   */var Visible=0;var Deleted=1;function QuickHull(){this.tolerance=-1;this.faces=[];// the generated faces of the convex hull
  this.newFaces=[];// this array holds the faces that are generated within a single iteration
  // the vertex lists work as follows:
  //
  // let 'a' and 'b' be 'Face' instances
  // let 'v' be points wrapped as instance of 'Vertex'
  //
  //     [v, v, ..., v, v, v, ...]
  //      ^             ^
  //      |             |
  //  a.outside     b.outside
  //
  this.assigned=new VertexList();this.unassigned=new VertexList();this.vertices=[];// vertices of the hull (internal representation of given geometry data)
  }Object.assign(QuickHull.prototype,{setFromPoints:function setFromPoints(points){var this$1=this;if(Array.isArray(points)!==true){console.error('QuickHull: Points parameter is not an array.');}if(points.length<4){console.error('QuickHull: The algorithm needs at least four points.');}this.makeEmpty();for(var i=0,l=points.length;i<l;i++){this$1.vertices.push(new VertexNode(points[i]));}this.compute();return this;},setFromObject:function setFromObject(object){var points=[];object.updateMatrixWorld(true);object.traverse(function(node){var i,l,point;var geometry=node.geometry;if(geometry!==undefined){if(geometry.isGeometry){var vertices=geometry.vertices;for(i=0, l=vertices.length;i<l;i++){point=vertices[i].clone();point.applyMatrix4(node.matrixWorld);points.push(point);}}else if(geometry.isBufferGeometry){var attribute=geometry.attributes.position;if(attribute!==undefined){for(i=0, l=attribute.count;i<l;i++){point=new Vector3$1();point.fromBufferAttribute(attribute,i).applyMatrix4(node.matrixWorld);points.push(point);}}}}});return this.setFromPoints(points);},makeEmpty:function makeEmpty(){this.faces=[];this.vertices=[];return this;},// Adds a vertex to the 'assigned' list of vertices and assigns it to the given face
  addVertexToFace:function addVertexToFace(vertex,face){vertex.face=face;if(face.outside===null){this.assigned.append(vertex);}else{this.assigned.insertBefore(face.outside,vertex);}face.outside=vertex;return this;},// Removes a vertex from the 'assigned' list of vertices and from the given face
  removeVertexFromFace:function removeVertexFromFace(vertex,face){if(vertex===face.outside){// fix face.outside link
  if(vertex.next!==null&&vertex.next.face===face){// face has at least 2 outside vertices, move the 'outside' reference
  face.outside=vertex.next;}else{// vertex was the only outside vertex that face had
  face.outside=null;}}this.assigned.remove(vertex);return this;},// Removes all the visible vertices that a given face is able to see which are stored in the 'assigned' vertext list
  removeAllVerticesFromFace:function removeAllVerticesFromFace(face){if(face.outside!==null){// reference to the first and last vertex of this face
  var start=face.outside;var end=face.outside;while(end.next!==null&&end.next.face===face){end=end.next;}this.assigned.removeSubList(start,end);// fix references
  start.prev=end.next=null;face.outside=null;return start;}},// Removes all the visible vertices that 'face' is able to see
  deleteFaceVertices:function deleteFaceVertices(face,absorbingFace){var this$1=this;var faceVertices=this.removeAllVerticesFromFace(face);if(faceVertices!==undefined){if(absorbingFace===undefined){// mark the vertices to be reassigned to some other face
  this.unassigned.appendChain(faceVertices);}else{// if there's an absorbing face try to assign as many vertices as possible to it
  var vertex=faceVertices;do{// we need to buffer the subsequent vertex at this point because the 'vertex.next' reference
  // will be changed by upcoming method calls
  var nextVertex=vertex.next;var distance=absorbingFace.distanceToPoint(vertex.point);// check if 'vertex' is able to see 'absorbingFace'
  if(distance>this$1.tolerance){this$1.addVertexToFace(vertex,absorbingFace);}else{this$1.unassigned.append(vertex);}// now assign next vertex
  vertex=nextVertex;}while(vertex!==null);}}return this;},// Reassigns as many vertices as possible from the unassigned list to the new faces
  resolveUnassignedPoints:function resolveUnassignedPoints(newFaces){var this$1=this;if(this.unassigned.isEmpty()===false){var vertex=this.unassigned.first();do{// buffer 'next' reference, see .deleteFaceVertices()
  var nextVertex=vertex.next;var maxDistance=this$1.tolerance;var maxFace=null;for(var i=0;i<newFaces.length;i++){var face=newFaces[i];if(face.mark===Visible){var distance=face.distanceToPoint(vertex.point);if(distance>maxDistance){maxDistance=distance;maxFace=face;}if(maxDistance>1000*this$1.tolerance){break;}}}// 'maxFace' can be null e.g. if there are identical vertices
  if(maxFace!==null){this$1.addVertexToFace(vertex,maxFace);}vertex=nextVertex;}while(vertex!==null);}return this;},// Computes the extremes of a simplex which will be the initial hull
  computeExtremes:function computeExtremes(){var this$1=this;var min=new Vector3$1();var max=new Vector3$1();var minVertices=[];var maxVertices=[];var i,l,j;// initially assume that the first vertex is the min/max
  for(i=0;i<3;i++){minVertices[i]=maxVertices[i]=this$1.vertices[0];}min.copy(this.vertices[0].point);max.copy(this.vertices[0].point);// compute the min/max vertex on all six directions
  for(i=0, l=this.vertices.length;i<l;i++){var vertex=this$1.vertices[i];var point=vertex.point;// update the min coordinates
  for(j=0;j<3;j++){if(point.getComponent(j)<min.getComponent(j)){min.setComponent(j,point.getComponent(j));minVertices[j]=vertex;}}// update the max coordinates
  for(j=0;j<3;j++){if(point.getComponent(j)>max.getComponent(j)){max.setComponent(j,point.getComponent(j));maxVertices[j]=vertex;}}}// use min/max vectors to compute an optimal epsilon
  this.tolerance=3*Number.EPSILON*(Math.max(Math.abs(min.x),Math.abs(max.x))+Math.max(Math.abs(min.y),Math.abs(max.y))+Math.max(Math.abs(min.z),Math.abs(max.z)));return{min:minVertices,max:maxVertices};},// Computes the initial simplex assigning to its faces all the points
  // that are candidates to form part of the hull
  computeInitialHull:function(){var line3,plane,closestPoint;return function computeInitialHull(){var this$1=this;if(line3===undefined){line3=new Line3();plane=new Plane();closestPoint=new Vector3$1();}var vertex,vertices=this.vertices;var extremes=this.computeExtremes();var min=extremes.min;var max=extremes.max;var v0,v1,v2,v3;var i,l,j;// 1. Find the two vertices 'v0' and 'v1' with the greatest 1d separation
  // (max.x - min.x)
  // (max.y - min.y)
  // (max.z - min.z)
  var distance,maxDistance=0;var index=0;for(i=0;i<3;i++){distance=max[i].point.getComponent(i)-min[i].point.getComponent(i);if(distance>maxDistance){maxDistance=distance;index=i;}}v0=min[index];v1=max[index];// 2. The next vertex 'v2' is the one farthest to the line formed by 'v0' and 'v1'
  maxDistance=0;line3.set(v0.point,v1.point);for(i=0, l=this.vertices.length;i<l;i++){vertex=vertices[i];if(vertex!==v0&&vertex!==v1){line3.closestPointToPoint(vertex.point,true,closestPoint);distance=closestPoint.distanceToSquared(vertex.point);if(distance>maxDistance){maxDistance=distance;v2=vertex;}}}// 3. The next vertex 'v3' is the one farthest to the plane 'v0', 'v1', 'v2'
  maxDistance=-1;plane.setFromCoplanarPoints(v0.point,v1.point,v2.point);for(i=0, l=this.vertices.length;i<l;i++){vertex=vertices[i];if(vertex!==v0&&vertex!==v1&&vertex!==v2){distance=Math.abs(plane.distanceToPoint(vertex.point));if(distance>maxDistance){maxDistance=distance;v3=vertex;}}}var faces=[];if(plane.distanceToPoint(v3.point)<0){// the face is not able to see the point so 'plane.normal' is pointing outside the tetrahedron
  faces.push(Face.create(v0,v1,v2),Face.create(v3,v1,v0),Face.create(v3,v2,v1),Face.create(v3,v0,v2));// set the twin edge
  for(i=0;i<3;i++){j=(i+1)%3;// join face[ i ] i > 0, with the first face
  faces[i+1].getEdge(2).setTwin(faces[0].getEdge(j));// join face[ i ] with face[ i + 1 ], 1 <= i <= 3
  faces[i+1].getEdge(1).setTwin(faces[j+1].getEdge(0));}}else{// the face is able to see the point so 'plane.normal' is pointing inside the tetrahedron
  faces.push(Face.create(v0,v2,v1),Face.create(v3,v0,v1),Face.create(v3,v1,v2),Face.create(v3,v2,v0));// set the twin edge
  for(i=0;i<3;i++){j=(i+1)%3;// join face[ i ] i > 0, with the first face
  faces[i+1].getEdge(2).setTwin(faces[0].getEdge((3-i)%3));// join face[ i ] with face[ i + 1 ]
  faces[i+1].getEdge(0).setTwin(faces[j+1].getEdge(1));}}// the initial hull is the tetrahedron
  for(i=0;i<4;i++){this$1.faces.push(faces[i]);}// initial assignment of vertices to the faces of the tetrahedron
  for(i=0, l=vertices.length;i<l;i++){vertex=vertices[i];if(vertex!==v0&&vertex!==v1&&vertex!==v2&&vertex!==v3){maxDistance=this$1.tolerance;var maxFace=null;for(j=0;j<4;j++){distance=this$1.faces[j].distanceToPoint(vertex.point);if(distance>maxDistance){maxDistance=distance;maxFace=this$1.faces[j];}}if(maxFace!==null){this$1.addVertexToFace(vertex,maxFace);}}}return this;};}(),// Removes inactive faces
  reindexFaces:function reindexFaces(){var this$1=this;var activeFaces=[];for(var i=0;i<this.faces.length;i++){var face=this$1.faces[i];if(face.mark===Visible){activeFaces.push(face);}}this.faces=activeFaces;return this;},// Finds the next vertex to create faces with the current hull
  nextVertexToAdd:function nextVertexToAdd(){// if the 'assigned' list of vertices is empty, no vertices are left. return with 'undefined'
  if(this.assigned.isEmpty()===false){var eyeVertex,maxDistance=0;// grap the first available face and start with the first visible vertex of that face
  var eyeFace=this.assigned.first().face;var vertex=eyeFace.outside;// now calculate the farthest vertex that face can see
  do{var distance=eyeFace.distanceToPoint(vertex.point);if(distance>maxDistance){maxDistance=distance;eyeVertex=vertex;}vertex=vertex.next;}while(vertex!==null&&vertex.face===eyeFace);return eyeVertex;}},// Computes a chain of half edges in CCW order called the 'horizon'.
  // For an edge to be part of the horizon it must join a face that can see
  // 'eyePoint' and a face that cannot see 'eyePoint'.
  computeHorizon:function computeHorizon(eyePoint,crossEdge,face,horizon){var this$1=this;// moves face's vertices to the 'unassigned' vertex list
  this.deleteFaceVertices(face);face.mark=Deleted;var edge;if(crossEdge===null){edge=crossEdge=face.getEdge(0);}else{// start from the next edge since 'crossEdge' was already analyzed
  // (actually 'crossEdge.twin' was the edge who called this method recursively)
  edge=crossEdge.next;}do{var twinEdge=edge.twin;var oppositeFace=twinEdge.face;if(oppositeFace.mark===Visible){if(oppositeFace.distanceToPoint(eyePoint)>this$1.tolerance){// the opposite face can see the vertex, so proceed with next edge
  this$1.computeHorizon(eyePoint,twinEdge,oppositeFace,horizon);}else{// the opposite face can't see the vertex, so this edge is part of the horizon
  horizon.push(edge);}}edge=edge.next;}while(edge!==crossEdge);return this;},// Creates a face with the vertices 'eyeVertex.point', 'horizonEdge.tail' and 'horizonEdge.head' in CCW order
  addAdjoiningFace:function addAdjoiningFace(eyeVertex,horizonEdge){// all the half edges are created in ccw order thus the face is always pointing outside the hull
  var face=Face.create(eyeVertex,horizonEdge.tail(),horizonEdge.head());this.faces.push(face);// join face.getEdge( - 1 ) with the horizon's opposite edge face.getEdge( - 1 ) = face.getEdge( 2 )
  face.getEdge(-1).setTwin(horizonEdge.twin);return face.getEdge(0);// the half edge whose vertex is the eyeVertex
  },//  Adds 'horizon.length' faces to the hull, each face will be linked with the
  //  horizon opposite face and the face on the left/right
  addNewFaces:function addNewFaces(eyeVertex,horizon){var this$1=this;this.newFaces=[];var firstSideEdge=null;var previousSideEdge=null;for(var i=0;i<horizon.length;i++){var horizonEdge=horizon[i];// returns the right side edge
  var sideEdge=this$1.addAdjoiningFace(eyeVertex,horizonEdge);if(firstSideEdge===null){firstSideEdge=sideEdge;}else{// joins face.getEdge( 1 ) with previousFace.getEdge( 0 )
  sideEdge.next.setTwin(previousSideEdge);}this$1.newFaces.push(sideEdge.face);previousSideEdge=sideEdge;}// perform final join of new faces
  firstSideEdge.next.setTwin(previousSideEdge);return this;},// Adds a vertex to the hull
  addVertexToHull:function addVertexToHull(eyeVertex){var horizon=[];this.unassigned.clear();// remove 'eyeVertex' from 'eyeVertex.face' so that it can't be added to the 'unassigned' vertex list
  this.removeVertexFromFace(eyeVertex,eyeVertex.face);this.computeHorizon(eyeVertex.point,null,eyeVertex.face,horizon);this.addNewFaces(eyeVertex,horizon);// reassign 'unassigned' vertices to the new faces
  this.resolveUnassignedPoints(this.newFaces);return this;},cleanup:function cleanup(){this.assigned.clear();this.unassigned.clear();this.newFaces=[];return this;},compute:function compute(){var this$1=this;var vertex;this.computeInitialHull();// add all available vertices gradually to the hull
  while((vertex=this.nextVertexToAdd())!==undefined){this$1.addVertexToHull(vertex);}this.reindexFaces();this.cleanup();return this;}});//
  function Face(){this.normal=new Vector3$1();this.midpoint=new Vector3$1();this.area=0;this.constant=0;// signed distance from face to the origin
  this.outside=null;// reference to a vertex in a vertex list this face can see
  this.mark=Visible;this.edge=null;}Object.assign(Face,{create:function create(a,b,c){var face=new Face();var e0=new HalfEdge(a,face);var e1=new HalfEdge(b,face);var e2=new HalfEdge(c,face);// join edges
  e0.next=e2.prev=e1;e1.next=e0.prev=e2;e2.next=e1.prev=e0;// main half edge reference
  face.edge=e0;return face.compute();}});Object.assign(Face.prototype,{getEdge:function getEdge(i){var edge=this.edge;while(i>0){edge=edge.next;i--;}while(i<0){edge=edge.prev;i++;}return edge;},compute:function(){var triangle;return function compute(){if(triangle===undefined){triangle=new Triangle();}var a=this.edge.tail();var b=this.edge.head();var c=this.edge.next.head();triangle.set(a.point,b.point,c.point);triangle.normal(this.normal);triangle.midpoint(this.midpoint);this.area=triangle.area();this.constant=this.normal.dot(this.midpoint);return this;};}(),distanceToPoint:function distanceToPoint(point){return this.normal.dot(point)-this.constant;}});// Entity for a Doubly-Connected Edge List (DCEL).
  function HalfEdge(vertex,face){this.vertex=vertex;this.prev=null;this.next=null;this.twin=null;this.face=face;}Object.assign(HalfEdge.prototype,{head:function head(){return this.vertex;},tail:function tail(){return this.prev?this.prev.vertex:null;},length:function length(){var head=this.head();var tail=this.tail();if(tail!==null){return tail.point.distanceTo(head.point);}return-1;},lengthSquared:function lengthSquared(){var head=this.head();var tail=this.tail();if(tail!==null){return tail.point.distanceToSquared(head.point);}return-1;},setTwin:function setTwin(edge){this.twin=edge;edge.twin=this;return this;}});// A vertex as a double linked list node.
  function VertexNode(point){this.point=point;this.prev=null;this.next=null;this.face=null;// the face that is able to see this vertex
  }// A double linked list that contains vertex nodes.
  function VertexList(){this.head=null;this.tail=null;}Object.assign(VertexList.prototype,{first:function first(){return this.head;},last:function last(){return this.tail;},clear:function clear(){this.head=this.tail=null;return this;},// Inserts a vertex before the target vertex
  insertBefore:function insertBefore(target,vertex){vertex.prev=target.prev;vertex.next=target;if(vertex.prev===null){this.head=vertex;}else{vertex.prev.next=vertex;}target.prev=vertex;return this;},// Inserts a vertex after the target vertex
  insertAfter:function insertAfter(target,vertex){vertex.prev=target;vertex.next=target.next;if(vertex.next===null){this.tail=vertex;}else{vertex.next.prev=vertex;}target.next=vertex;return this;},// Appends a vertex to the end of the linked list
  append:function append(vertex){if(this.head===null){this.head=vertex;}else{this.tail.next=vertex;}vertex.prev=this.tail;vertex.next=null;// the tail has no subsequent vertex
  this.tail=vertex;return this;},// Appends a chain of vertices where 'vertex' is the head.
  appendChain:function appendChain(vertex){if(this.head===null){this.head=vertex;}else{this.tail.next=vertex;}vertex.prev=this.tail;// ensure that the 'tail' reference points to the last vertex of the chain
  while(vertex.next!==null){vertex=vertex.next;}this.tail=vertex;return this;},// Removes a vertex from the linked list
  remove:function remove(vertex){if(vertex.prev===null){this.head=vertex.next;}else{vertex.prev.next=vertex.next;}if(vertex.next===null){this.tail=vertex.prev;}else{vertex.next.prev=vertex.prev;}return this;},// Removes a list of vertices whose 'head' is 'a' and whose 'tail' is b
  removeSubList:function removeSubList(a,b){if(a.prev===null){this.head=b.next;}else{a.prev.next=b.next;}if(b.next===null){this.tail=a.prev;}else{b.next.prev=a.prev;}return this;},isEmpty:function isEmpty(){return this.head===null;}});/**
   * @author Mugen87 / https://github.com/Mugen87
   */// ConvexGeometry
  function ConvexGeometry(points){Geometry.call(this);this.type='ConvexGeometry';this.fromBufferGeometry(new ConvexBufferGeometry(points));this.mergeVertices();}ConvexGeometry.prototype=Object.create(Geometry.prototype);ConvexGeometry.prototype.constructor=ConvexGeometry;// ConvexBufferGeometry
  function ConvexBufferGeometry(points){BufferGeometry.call(this);this.type='ConvexBufferGeometry';// buffers
  var vertices=[];var normals=[];// execute QuickHull
  if(QuickHull===undefined){console.error('ConvexBufferGeometry: ConvexBufferGeometry relies on QuickHull');}var quickHull=new QuickHull().setFromPoints(points);// generate vertices and normals
  var faces=quickHull.faces;for(var i=0;i<faces.length;i++){var face=faces[i];var edge=face.edge;// we move along a doubly-connected edge list to access all face points (see HalfEdge docs)
  do{var point=edge.head().point;vertices.push(point.x,point.y,point.z);normals.push(face.normal.x,face.normal.y,face.normal.z);edge=edge.next;}while(edge!==face.edge);}// build geometry
  this.addAttribute('position',new Float32BufferAttribute(vertices,3));this.addAttribute('normal',new Float32BufferAttribute(normals,3));}ConvexBufferGeometry.prototype=Object.create(BufferGeometry.prototype);ConvexBufferGeometry.prototype.constructor=ConvexBufferGeometry;/**
   * @author yomboprime https://github.com/yomboprime
   *
   * @fileoverview This class can be used to subdivide a convex Geometry object into pieces.
   *
   * Usage:
   *
   * Use the function prepareBreakableObject to prepare a Mesh object to be broken.
   *
   * Then, call the various functions to subdivide the object (subdivideByImpact, cutByPlane)
   *
   * Sub-objects that are product of subdivision don't need prepareBreakableObject to be called on them.
   *
   * Requisites for the object:
   *
   *  - Mesh object must have a Geometry (not BufferGeometry) and a Material
   *
   *  - The Geometry must be convex (this is not tested in the library). You can create convex
   *  Geometries with ConvexGeometry. The BoxGeometry, SphereGeometry and other convex primitives
   *  can also be used.
   *
   * Note: This lib adds member variables to object's userData member and to its vertices.
   * (see prepareBreakableObject function)
   * Use with caution and read the code when using with other libs.
   *
   * @param {double} minSizeForBreak Min size a debris can have to break.
   * @param {double} smallDelta Max distance to consider that a point belongs to a plane.
   * 
    */var ConvexObjectBreaker=function ConvexObjectBreaker(minSizeForBreak,smallDelta){var this$1=this;this.minSizeForBreak=minSizeForBreak||1.4;this.smallDelta=smallDelta||0.0001;this.tempLine1=new Line3();this.tempPlane1=new Plane();this.tempPlane2=new Plane();this.tempCM1=new Vector3$1();this.tempCM2=new Vector3$1();this.tempVector3=new Vector3$1();this.tempVector3_2=new Vector3$1();this.tempVector3_3=new Vector3$1();this.tempResultObjects={object1:null,object2:null};this.segments=[];var n=30*30;for(var i=0;i<n;i++){this$1.segments[i]=false;}};ConvexObjectBreaker.prototype={constructor:ConvexObjectBreaker,prepareBreakableObject:function prepareBreakableObject(object,mass,velocity,angularVelocity,breakable){// object is a Object3d (normally a Mesh), must have a Geometry, and it must be convex.
  // Its material property is propagated to its children (sub-pieces)
  // mass must be > 0
  // Create vertices mark
  var vertices=object.geometry.vertices;for(var i=0,il=vertices.length;i<il;i++){vertices[i].mark=0;}var userData=object.userData;userData.mass=mass;userData.velocity=velocity.clone();userData.angularVelocity=angularVelocity.clone();userData.breakable=breakable;},/*
  	 * @param {int} maxRadialIterations Iterations for radial cuts.
  	 * @param {int} maxRandomIterations Max random iterations for not-radial cuts
  	 * @param {double} minSizeForRadialSubdivision Min size a debris can have to break in radial subdivision.
  	 *
  	 * Returns the array of pieces
  	 */subdivideByImpact:function subdivideByImpact(object,pointOfImpact,normal,maxRadialIterations,maxRandomIterations,minSizeForRadialSubdivision){var debris=[];var tempPlane1=this.tempPlane1;var tempPlane2=this.tempPlane2;this.tempVector3.addVectors(pointOfImpact,normal);tempPlane1.setFromCoplanarPoints(pointOfImpact,object.position,this.tempVector3);var maxTotalIterations=maxRandomIterations+maxRadialIterations;var scope=this;function subdivideRadial(subObject,startAngle,endAngle,numIterations){if(Math.random()<numIterations*0.05||numIterations>maxTotalIterations){debris.push(subObject);return;}var angle=Math.PI;if(numIterations===0){tempPlane2.normal.copy(tempPlane1.normal);tempPlane2.constant=tempPlane1.constant;}else{if(numIterations<=maxRadialIterations){angle=(endAngle-startAngle)*(0.2+0.6*Math.random())+startAngle;// Rotate tempPlane2 at impact point around normal axis and the angle
  scope.tempVector3_2.copy(object.position).sub(pointOfImpact).applyAxisAngle(normal,angle).add(pointOfImpact);tempPlane2.setFromCoplanarPoints(pointOfImpact,scope.tempVector3,scope.tempVector3_2);}else{angle=(0.5*(numIterations&1)+0.2*(2-Math.random()))*Math.PI;// Rotate tempPlane2 at object position around normal axis and the angle
  scope.tempVector3_2.copy(pointOfImpact).sub(subObject.position).applyAxisAngle(normal,angle).add(subObject.position);scope.tempVector3_3.copy(normal).add(subObject.position);tempPlane2.setFromCoplanarPoints(subObject.position,scope.tempVector3_3,scope.tempVector3_2);}}// Perform the cut
  scope.cutByPlane(subObject,tempPlane2,scope.tempResultObjects);var obj1=scope.tempResultObjects.object1;var obj2=scope.tempResultObjects.object2;if(obj1){subdivideRadial(obj1,startAngle,angle,numIterations+1);}if(obj2){subdivideRadial(obj2,angle,endAngle,numIterations+1);}}subdivideRadial(object,0,2*Math.PI,0);return debris;},cutByPlane:function cutByPlane(object,plane,output){var this$1=this;// Returns breakable objects in output.object1 and output.object2 members, the resulting 2 pieces of the cut.
  // object2 can be null if the plane doesn't cut the object.
  // object1 can be null only in case of internal error
  // Returned value is number of pieces, 0 for error.
  var geometry=object.geometry;var points=geometry.vertices;var faces=geometry.faces;var numPoints=points.length;var points1=[];var points2=[];var delta=this.smallDelta;// Reset vertices mark
  for(var i=0;i<numPoints;i++){points[i].mark=0;}// Reset segments mark
  var numPointPairs=numPoints*numPoints;for(var i=0;i<numPointPairs;i++){this$1.segments[i]=false;}// Iterate through the faces to mark edges shared by coplanar faces
  for(var i=0,il=faces.length-1;i<il;i++){var face1=faces[i];for(var j=i+1,jl=faces.length;j<jl;j++){var face2=faces[j];var coplanar=1-face1.normal.dot(face2.normal)<delta;if(coplanar){var a1=face1.a;var b1=face1.b;var c1=face1.c;var a2=face2.a;var b2=face2.b;var c2=face2.c;if(a1===a2||a1===b2||a1===c2){if(b1===a2||b1===b2||b1===c2){this$1.segments[a1*numPoints+b1]=true;this$1.segments[b1*numPoints+a1]=true;}else{this$1.segments[c1*numPoints+a1]=true;this$1.segments[a1*numPoints+c1]=true;}}else if(b1===a2||b1===b2||b1===c2){this$1.segments[c1*numPoints+b1]=true;this$1.segments[b1*numPoints+c1]=true;}}}}// Transform the plane to object local space
  var localPlane=this.tempPlane1;object.updateMatrix();ConvexObjectBreaker.transformPlaneToLocalSpace(plane,object.matrix,localPlane);// Iterate through the faces adding points to both pieces
  for(var i=0,il=faces.length;i<il;i++){var face=faces[i];for(var segment=0;segment<3;segment++){var i0=segment===0?face.a:segment===1?face.b:face.c;var i1=segment===0?face.b:segment===1?face.c:face.a;var segmentState=this$1.segments[i0*numPoints+i1];if(segmentState){// The segment already has been processed in another face
  continue;}// Mark segment as processed (also inverted segment)
  this$1.segments[i0*numPoints+i1]=true;this$1.segments[i1*numPoints+i0]=true;var p0=points[i0];var p1=points[i1];if(p0.mark===0){var d=localPlane.distanceToPoint(p0);// mark: 1 for negative side, 2 for positive side, 3 for coplanar point
  if(d>delta){p0.mark=2;points2.push(p0);}else if(d<-delta){p0.mark=1;points1.push(p0);}else{p0.mark=3;points1.push(p0);var p0_2=p0.clone();p0_2.mark=3;points2.push(p0_2);}}if(p1.mark===0){var d=localPlane.distanceToPoint(p1);// mark: 1 for negative side, 2 for positive side, 3 for coplanar point
  if(d>delta){p1.mark=2;points2.push(p1);}else if(d<-delta){p1.mark=1;points1.push(p1);}else{p1.mark=3;points1.push(p1);var p1_2=p1.clone();p1_2.mark=3;points2.push(p1_2);}}var mark0=p0.mark;var mark1=p1.mark;if(mark0===1&&mark1===2||mark0===2&&mark1===1){// Intersection of segment with the plane
  this$1.tempLine1.start.copy(p0);this$1.tempLine1.end.copy(p1);var intersection=localPlane.intersectLine(this$1.tempLine1);if(intersection===undefined){// Shouldn't happen
  console.error("Internal error: segment does not intersect plane.");output.segmentedObject1=null;output.segmentedObject2=null;return 0;}intersection.mark=1;points1.push(intersection);var intersection_2=intersection.clone();intersection_2.mark=2;points2.push(intersection_2);}}}// Calculate debris mass (very fast and imprecise):
  var newMass=object.userData.mass*0.5;// Calculate debris Center of Mass (again fast and imprecise)
  this.tempCM1.set(0,0,0);var radius1=0;var numPoints1=points1.length;if(numPoints1>0){for(var i=0;i<numPoints1;i++){this$1.tempCM1.add(points1[i]);}this.tempCM1.divideScalar(numPoints1);for(var i=0;i<numPoints1;i++){var p=points1[i];p.sub(this$1.tempCM1);radius1=Math.max(radius1,p.x,p.y,p.z);}this.tempCM1.add(object.position);}this.tempCM2.set(0,0,0);var radius2=0;var numPoints2=points2.length;if(numPoints2>0){for(var i=0;i<numPoints2;i++){this$1.tempCM2.add(points2[i]);}this.tempCM2.divideScalar(numPoints2);for(var i=0;i<numPoints2;i++){var p=points2[i];p.sub(this$1.tempCM2);radius2=Math.max(radius2,p.x,p.y,p.z);}this.tempCM2.add(object.position);}var object1=null;var object2=null;var numObjects=0;if(numPoints1>4){object1=new Mesh(new ConvexGeometry(points1),object.material);object1.position.copy(this.tempCM1);object1.quaternion.copy(object.quaternion);this.prepareBreakableObject(object1,newMass,object.userData.velocity,object.userData.angularVelocity,2*radius1>this.minSizeForBreak);numObjects++;}if(numPoints2>4){object2=new Mesh(new ConvexGeometry(points2),object.material);object2.position.copy(this.tempCM2);object2.quaternion.copy(object.quaternion);this.prepareBreakableObject(object2,newMass,object.userData.velocity,object.userData.angularVelocity,2*radius2>this.minSizeForBreak);numObjects++;}output.object1=object1;output.object2=object2;return numObjects;}};ConvexObjectBreaker.transformFreeVector=function(v,m){// input:
  // vector interpreted as a free vector
  // Matrix4 orthogonal matrix (matrix without scale)
  var x=v.x,y=v.y,z=v.z;var e=m.elements;v.x=e[0]*x+e[4]*y+e[8]*z;v.y=e[1]*x+e[5]*y+e[9]*z;v.z=e[2]*x+e[6]*y+e[10]*z;return v;};ConvexObjectBreaker.transformFreeVectorInverse=function(v,m){// input:
  // vector interpreted as a free vector
  // Matrix4 orthogonal matrix (matrix without scale)
  var x=v.x,y=v.y,z=v.z;var e=m.elements;v.x=e[0]*x+e[1]*y+e[2]*z;v.y=e[4]*x+e[5]*y+e[6]*z;v.z=e[8]*x+e[9]*y+e[10]*z;return v;};ConvexObjectBreaker.transformTiedVectorInverse=function(v,m){// input:
  // vector interpreted as a tied (ordinary) vector
  // Matrix4 orthogonal matrix (matrix without scale)
  var x=v.x,y=v.y,z=v.z;var e=m.elements;v.x=e[0]*x+e[1]*y+e[2]*z-e[12];v.y=e[4]*x+e[5]*y+e[6]*z-e[13];v.z=e[8]*x+e[9]*y+e[10]*z-e[14];return v;};ConvexObjectBreaker.transformPlaneToLocalSpace=function(){var v1=new Vector3$1();var m1=new Matrix3$1();return function transformPlaneToLocalSpace(plane,m,resultPlane){resultPlane.normal.copy(plane.normal);resultPlane.constant=plane.constant;var referencePoint=ConvexObjectBreaker.transformTiedVectorInverse(plane.coplanarPoint(v1),m);ConvexObjectBreaker.transformFreeVectorInverse(resultPlane.normal,m);// recalculate constant (like in setFromNormalAndCoplanarPoint)
  resultPlane.constant=-referencePoint.dot(resultPlane.normal);};}();/**
   * @author zz85 / http://www.lab4games.net/zz85/blog
   * Extensible curve object
   *
   * Some common of curve methods:
   * .getPoint( t, optionalTarget ), .getTangent( t )
   * .getPointAt( u, optionalTarget ), .getTangentAt( u )
   * .getPoints(), .getSpacedPoints()
   * .getLength()
   * .updateArcLengths()
   *
   * This following curves inherit from THREE.Curve:
   *
   * -- 2D curves --
   * THREE.ArcCurve
   * THREE.CubicBezierCurve
   * THREE.EllipseCurve
   * THREE.LineCurve
   * THREE.QuadraticBezierCurve
   * THREE.SplineCurve
   *
   * -- 3D curves --
   * THREE.CatmullRomCurve3
   * THREE.CubicBezierCurve3
   * THREE.LineCurve3
   * THREE.QuadraticBezierCurve3
   *
   * A series of curves can be represented as a THREE.CurvePath.
   *
   **//**************************************************************
   *	Abstract Curve base class
   **************************************************************/function Curve(){this.type='Curve';this.arcLengthDivisions=200;}Object.assign(Curve.prototype,{// Virtual base class method to overwrite and implement in subclasses
  //	- t [0 .. 1]
  getPoint:function getPoint()/* t, optionalTarget */{console.warn('THREE.Curve: .getPoint() not implemented.');return null;},// Get point at relative position in curve according to arc length
  // - u [0 .. 1]
  getPointAt:function getPointAt(u,optionalTarget){var t=this.getUtoTmapping(u);return this.getPoint(t,optionalTarget);},// Get sequence of points using getPoint( t )
  getPoints:function getPoints(divisions){var this$1=this;if(divisions===undefined){divisions=5;}var points=[];for(var d=0;d<=divisions;d++){points.push(this$1.getPoint(d/divisions));}return points;},// Get sequence of points using getPointAt( u )
  getSpacedPoints:function getSpacedPoints(divisions){var this$1=this;if(divisions===undefined){divisions=5;}var points=[];for(var d=0;d<=divisions;d++){points.push(this$1.getPointAt(d/divisions));}return points;},// Get total curve arc length
  getLength:function getLength(){var lengths=this.getLengths();return lengths[lengths.length-1];},// Get list of cumulative segment lengths
  getLengths:function getLengths(divisions){var this$1=this;if(divisions===undefined){divisions=this.arcLengthDivisions;}if(this.cacheArcLengths&&this.cacheArcLengths.length===divisions+1&&!this.needsUpdate){return this.cacheArcLengths;}this.needsUpdate=false;var cache=[];var current,last=this.getPoint(0);var p,sum=0;cache.push(0);for(p=1;p<=divisions;p++){current=this$1.getPoint(p/divisions);sum+=current.distanceTo(last);cache.push(sum);last=current;}this.cacheArcLengths=cache;return cache;// { sums: cache, sum: sum }; Sum is in the last element.
  },updateArcLengths:function updateArcLengths(){this.needsUpdate=true;this.getLengths();},// Given u ( 0 .. 1 ), get a t to find p. This gives you points which are equidistant
  getUtoTmapping:function getUtoTmapping(u,distance){var arcLengths=this.getLengths();var i=0,il=arcLengths.length;var targetArcLength;// The targeted u distance value to get
  if(distance){targetArcLength=distance;}else{targetArcLength=u*arcLengths[il-1];}// binary search for the index with largest value smaller than target u distance
  var low=0,high=il-1,comparison;while(low<=high){i=Math.floor(low+(high-low)/2);// less likely to overflow, though probably not issue here, JS doesn't really have integers, all numbers are floats
  comparison=arcLengths[i]-targetArcLength;if(comparison<0){low=i+1;}else if(comparison>0){high=i-1;}else{high=i;break;// DONE
  }}i=high;if(arcLengths[i]===targetArcLength){return i/(il-1);}// we could get finer grain at lengths, or use simple interpolation between two points
  var lengthBefore=arcLengths[i];var lengthAfter=arcLengths[i+1];var segmentLength=lengthAfter-lengthBefore;// determine where we are between the 'before' and 'after' points
  var segmentFraction=(targetArcLength-lengthBefore)/segmentLength;// add that fractional amount to t
  var t=(i+segmentFraction)/(il-1);return t;},// Returns a unit vector tangent at t
  // In case any sub curve does not implement its tangent derivation,
  // 2 points a small delta apart will be used to find its gradient
  // which seems to give a reasonable approximation
  getTangent:function getTangent(t){var delta=0.0001;var t1=t-delta;var t2=t+delta;// Capping in case of danger
  if(t1<0){t1=0;}if(t2>1){t2=1;}var pt1=this.getPoint(t1);var pt2=this.getPoint(t2);var vec=pt2.clone().sub(pt1);return vec.normalize();},getTangentAt:function getTangentAt(u){var t=this.getUtoTmapping(u);return this.getTangent(t);},computeFrenetFrames:function computeFrenetFrames(segments,closed){var this$1=this;// see http://www.cs.indiana.edu/pub/techreports/TR425.pdf
  var normal=new Vector3$1();var tangents=[];var normals=[];var binormals=[];var vec=new Vector3$1();var mat=new Matrix4();var i,u,theta;// compute the tangent vectors for each segment on the curve
  for(i=0;i<=segments;i++){u=i/segments;tangents[i]=this$1.getTangentAt(u);tangents[i].normalize();}// select an initial normal vector perpendicular to the first tangent vector,
  // and in the direction of the minimum tangent xyz component
  normals[0]=new Vector3$1();binormals[0]=new Vector3$1();var min=Number.MAX_VALUE;var tx=Math.abs(tangents[0].x);var ty=Math.abs(tangents[0].y);var tz=Math.abs(tangents[0].z);if(tx<=min){min=tx;normal.set(1,0,0);}if(ty<=min){min=ty;normal.set(0,1,0);}if(tz<=min){normal.set(0,0,1);}vec.crossVectors(tangents[0],normal).normalize();normals[0].crossVectors(tangents[0],vec);binormals[0].crossVectors(tangents[0],normals[0]);// compute the slowly-varying normal and binormal vectors for each segment on the curve
  for(i=1;i<=segments;i++){normals[i]=normals[i-1].clone();binormals[i]=binormals[i-1].clone();vec.crossVectors(tangents[i-1],tangents[i]);if(vec.length()>Number.EPSILON){vec.normalize();theta=Math.acos(_Math$1.clamp(tangents[i-1].dot(tangents[i]),-1,1));// clamp for floating pt errors
  normals[i].applyMatrix4(mat.makeRotationAxis(vec,theta));}binormals[i].crossVectors(tangents[i],normals[i]);}// if the curve is closed, postprocess the vectors so the first and last normal vectors are the same
  if(closed===true){theta=Math.acos(_Math$1.clamp(normals[0].dot(normals[segments]),-1,1));theta/=segments;if(tangents[0].dot(vec.crossVectors(normals[0],normals[segments]))>0){theta=-theta;}for(i=1;i<=segments;i++){// twist a little...
  normals[i].applyMatrix4(mat.makeRotationAxis(tangents[i],theta*i));binormals[i].crossVectors(tangents[i],normals[i]);}}return{tangents:tangents,normals:normals,binormals:binormals};},clone:function clone(){return new this.constructor().copy(this);},copy:function copy(source){this.arcLengthDivisions=source.arcLengthDivisions;return this;},toJSON:function toJSON(){var data={metadata:{version:4.5,type:'Curve',generator:'Curve.toJSON'}};data.arcLengthDivisions=this.arcLengthDivisions;data.type=this.type;return data;},fromJSON:function fromJSON(json){this.arcLengthDivisions=json.arcLengthDivisions;return this;}});/*
   * A bunch of parametric curves
   * @author zz85
   *
   * Formulas collected from various sources
   * http://mathworld.wolfram.com/HeartCurve.html
   * http://mathdl.maa.org/images/upload_library/23/stemkoski/knots/page6.html
   * http://en.wikipedia.org/wiki/Viviani%27s_curve
   * http://mathdl.maa.org/images/upload_library/23/stemkoski/knots/page4.html
   * http://www.mi.sanu.ac.rs/vismath/taylorapril2011/Taylor.pdf
   * http://prideout.net/blog/?p=44
   */// GrannyKnot
  function GrannyKnot(){Curve.call(this);}GrannyKnot.prototype=Object.create(Curve.prototype);GrannyKnot.prototype.constructor=GrannyKnot;GrannyKnot.prototype.getPoint=function(t,optionalTarget){var point=optionalTarget||new Vector3$1();t=2*Math.PI*t;var x=-0.22*Math.cos(t)-1.28*Math.sin(t)-0.44*Math.cos(3*t)-0.78*Math.sin(3*t);var y=-0.1*Math.cos(2*t)-0.27*Math.sin(2*t)+0.38*Math.cos(4*t)+0.46*Math.sin(4*t);var z=0.7*Math.cos(3*t)-0.4*Math.sin(3*t);return point.set(x,y,z).multiplyScalar(20);};// HeartCurve
  function HeartCurve(scale){Curve.call(this);this.scale=scale===undefined?5:scale;}HeartCurve.prototype=Object.create(Curve.prototype);HeartCurve.prototype.constructor=HeartCurve;HeartCurve.prototype.getPoint=function(t,optionalTarget){var point=optionalTarget||new Vector3$1();t*=2*Math.PI;var x=16*Math.pow(Math.sin(t),3);var y=13*Math.cos(t)-5*Math.cos(2*t)-2*Math.cos(3*t)-Math.cos(4*t);var z=0;return point.set(x,y,z).multiplyScalar(this.scale);};// Viviani's Curve
  function VivianiCurve(scale){Curve.call(this);this.scale=scale===undefined?70:scale;}VivianiCurve.prototype=Object.create(Curve.prototype);VivianiCurve.prototype.constructor=VivianiCurve;VivianiCurve.prototype.getPoint=function(t,optionalTarget){var point=optionalTarget||new Vector3$1();t=t*4*Math.PI;// normalized to 0..1
  var a=this.scale/2;var x=a*(1+Math.cos(t));var y=a*Math.sin(t);var z=2*a*Math.sin(t/2);return point.set(x,y,z);};// KnotCurve
  function KnotCurve(){Curve.call(this);}KnotCurve.prototype=Object.create(Curve.prototype);KnotCurve.prototype.constructor=KnotCurve;KnotCurve.prototype.getPoint=function(t,optionalTarget){var point=optionalTarget||new Vector3$1();t*=2*Math.PI;var R=10;var s=50;var x=s*Math.sin(t);var y=Math.cos(t)*(R+s*Math.cos(t));var z=Math.sin(t)*(R+s*Math.cos(t));return point.set(x,y,z);};// HelixCurve
  function HelixCurve(){Curve.call(this);}HelixCurve.prototype=Object.create(Curve.prototype);HelixCurve.prototype.constructor=HelixCurve;HelixCurve.prototype.getPoint=function(t,optionalTarget){var point=optionalTarget||new Vector3$1();var a=30;// radius
  var b=150;// height
  var t2=2*Math.PI*t*b/30;var x=Math.cos(t2)*a;var y=Math.sin(t2)*a;var z=b*t;return point.set(x,y,z);};// TrefoilKnot
  function TrefoilKnot(scale){Curve.call(this);this.scale=scale===undefined?10:scale;}TrefoilKnot.prototype=Object.create(Curve.prototype);TrefoilKnot.prototype.constructor=TrefoilKnot;TrefoilKnot.prototype.getPoint=function(t,optionalTarget){var point=optionalTarget||new Vector3$1();t*=Math.PI*2;var x=(2+Math.cos(3*t))*Math.cos(2*t);var y=(2+Math.cos(3*t))*Math.sin(2*t);var z=Math.sin(3*t);return point.set(x,y,z).multiplyScalar(this.scale);};// TorusKnot
  function TorusKnot(scale){Curve.call(this);this.scale=scale===undefined?10:scale;}TorusKnot.prototype=Object.create(Curve.prototype);TorusKnot.prototype.constructor=TorusKnot;TorusKnot.prototype.getPoint=function(t,optionalTarget){var point=optionalTarget||new Vector3$1();var p=3;var q=4;t*=Math.PI*2;var x=(2+Math.cos(q*t))*Math.cos(p*t);var y=(2+Math.cos(q*t))*Math.sin(p*t);var z=Math.sin(q*t);return point.set(x,y,z).multiplyScalar(this.scale);};// CinquefoilKnot
  function CinquefoilKnot(scale){Curve.call(this);this.scale=scale===undefined?10:scale;}CinquefoilKnot.prototype=Object.create(Curve.prototype);CinquefoilKnot.prototype.constructor=CinquefoilKnot;CinquefoilKnot.prototype.getPoint=function(t,optionalTarget){var point=optionalTarget||new Vector3$1();var p=2;var q=5;t*=Math.PI*2;var x=(2+Math.cos(q*t))*Math.cos(p*t);var y=(2+Math.cos(q*t))*Math.sin(p*t);var z=Math.sin(q*t);return point.set(x,y,z).multiplyScalar(this.scale);};// TrefoilPolynomialKnot
  function TrefoilPolynomialKnot(scale){Curve.call(this);this.scale=scale===undefined?10:scale;}TrefoilPolynomialKnot.prototype=Object.create(Curve.prototype);TrefoilPolynomialKnot.prototype.constructor=TrefoilPolynomialKnot;TrefoilPolynomialKnot.prototype.getPoint=function(t,optionalTarget){var point=optionalTarget||new Vector3$1();t=t*4-2;var x=Math.pow(t,3)-3*t;var y=Math.pow(t,4)-4*t*t;var z=1/5*Math.pow(t,5)-2*t;return point.set(x,y,z).multiplyScalar(this.scale);};var scaleTo=function scaleTo(x,y,t){var r=y-x;return t*r+x;};// FigureEightPolynomialKnot
  function FigureEightPolynomialKnot(scale){Curve.call(this);this.scale=scale===undefined?1:scale;}FigureEightPolynomialKnot.prototype=Object.create(Curve.prototype);FigureEightPolynomialKnot.prototype.constructor=FigureEightPolynomialKnot;FigureEightPolynomialKnot.prototype.getPoint=function(t,optionalTarget){var point=optionalTarget||new Vector3$1();t=scaleTo(-4,4,t);var x=2/5*t*(t*t-7)*(t*t-10);var y=Math.pow(t,4)-13*t*t;var z=1/10*t*(t*t-4)*(t*t-9)*(t*t-12);return point.set(x,y,z).multiplyScalar(this.scale);};// DecoratedTorusKnot4a
  function DecoratedTorusKnot4a(scale){Curve.call(this);this.scale=scale===undefined?40:scale;}DecoratedTorusKnot4a.prototype=Object.create(Curve.prototype);DecoratedTorusKnot4a.prototype.constructor=DecoratedTorusKnot4a;DecoratedTorusKnot4a.prototype.getPoint=function(t,optionalTarget){var point=optionalTarget||new Vector3$1();t*=Math.PI*2;var x=Math.cos(2*t)*(1+0.6*(Math.cos(5*t)+0.75*Math.cos(10*t)));var y=Math.sin(2*t)*(1+0.6*(Math.cos(5*t)+0.75*Math.cos(10*t)));var z=0.35*Math.sin(5*t);return point.set(x,y,z).multiplyScalar(this.scale);};// DecoratedTorusKnot4b
  function DecoratedTorusKnot4b(scale){Curve.call(this);this.scale=scale===undefined?40:scale;}DecoratedTorusKnot4b.prototype=Object.create(Curve.prototype);DecoratedTorusKnot4b.prototype.constructor=DecoratedTorusKnot4b;DecoratedTorusKnot4b.prototype.getPoint=function(t,optionalTarget){var point=optionalTarget||new Vector3$1();var fi=t*Math.PI*2;var x=Math.cos(2*fi)*(1+0.45*Math.cos(3*fi)+0.4*Math.cos(9*fi));var y=Math.sin(2*fi)*(1+0.45*Math.cos(3*fi)+0.4*Math.cos(9*fi));var z=0.2*Math.sin(9*fi);return point.set(x,y,z).multiplyScalar(this.scale);};// DecoratedTorusKnot5a
  function DecoratedTorusKnot5a(scale){Curve.call(this);this.scale=scale===undefined?40:scale;}DecoratedTorusKnot5a.prototype=Object.create(Curve.prototype);DecoratedTorusKnot5a.prototype.constructor=DecoratedTorusKnot5a;DecoratedTorusKnot5a.prototype.getPoint=function(t,optionalTarget){var point=optionalTarget||new Vector3$1();var fi=t*Math.PI*2;var x=Math.cos(3*fi)*(1+0.3*Math.cos(5*fi)+0.5*Math.cos(10*fi));var y=Math.sin(3*fi)*(1+0.3*Math.cos(5*fi)+0.5*Math.cos(10*fi));var z=0.2*Math.sin(20*fi);return point.set(x,y,z).multiplyScalar(this.scale);};// DecoratedTorusKnot5c
  function DecoratedTorusKnot5c(scale){Curve.call(this);this.scale=scale===undefined?40:scale;}DecoratedTorusKnot5c.prototype=Object.create(Curve.prototype);DecoratedTorusKnot5c.prototype.constructor=DecoratedTorusKnot5c;DecoratedTorusKnot5c.prototype.getPoint=function(t,optionalTarget){var point=optionalTarget||new Vector3$1();var fi=t*Math.PI*2;var x=Math.cos(4*fi)*(1+0.5*(Math.cos(5*fi)+0.4*Math.cos(20*fi)));var y=Math.sin(4*fi)*(1+0.5*(Math.cos(5*fi)+0.4*Math.cos(20*fi)));var z=0.35*Math.sin(15*fi);return point.set(x,y,z).multiplyScalar(this.scale);};/**
   * @author renej
   * NURBS utils
   *
   * See NURBSCurve and NURBSSurface.
   *
   **//**************************************************************
   *	NURBS Utils
   **************************************************************/var NURBSUtils={/*
  	Finds knot vector span.

  	p : degree
  	u : parametric value
  	U : knot vector
  	
  	returns the span
  	*/findSpan:function findSpan(p,u,U){var n=U.length-p-1;if(u>=U[n]){return n-1;}if(u<=U[p]){return p;}var low=p;var high=n;var mid=Math.floor((low+high)/2);while(u<U[mid]||u>=U[mid+1]){if(u<U[mid]){high=mid;}else{low=mid;}mid=Math.floor((low+high)/2);}return mid;},/*
  	Calculate basis functions. See The NURBS Book, page 70, algorithm A2.2
     
  	span : span in which u lies
  	u    : parametric point
  	p    : degree
  	U    : knot vector
  	
  	returns array[p+1] with basis functions values.
  	*/calcBasisFunctions:function calcBasisFunctions(span,u,p,U){var N=[];var left=[];var right=[];N[0]=1.0;for(var j=1;j<=p;++j){left[j]=u-U[span+1-j];right[j]=U[span+j]-u;var saved=0.0;for(var r=0;r<j;++r){var rv=right[r+1];var lv=left[j-r];var temp=N[r]/(rv+lv);N[r]=saved+rv*temp;saved=lv*temp;}N[j]=saved;}return N;},/*
  	Calculate B-Spline curve points. See The NURBS Book, page 82, algorithm A3.1.
   
  	p : degree of B-Spline
  	U : knot vector
  	P : control points (x, y, z, w)
  	u : parametric point

  	returns point for given u
  	*/calcBSplinePoint:function calcBSplinePoint(p,U,P,u){var span=this.findSpan(p,u,U);var N=this.calcBasisFunctions(span,u,p,U);var C=new Vector4$1(0,0,0,0);for(var j=0;j<=p;++j){var point=P[span-p+j];var Nj=N[j];var wNj=point.w*Nj;C.x+=point.x*wNj;C.y+=point.y*wNj;C.z+=point.z*wNj;C.w+=point.w*Nj;}return C;},/*
  	Calculate basis functions derivatives. See The NURBS Book, page 72, algorithm A2.3.

  	span : span in which u lies
  	u    : parametric point
  	p    : degree
  	n    : number of derivatives to calculate
  	U    : knot vector

  	returns array[n+1][p+1] with basis functions derivatives
  	*/calcBasisFunctionDerivatives:function calcBasisFunctionDerivatives(span,u,p,n,U){var zeroArr=[];for(var i=0;i<=p;++i){zeroArr[i]=0.0;}var ders=[];for(var i=0;i<=n;++i){ders[i]=zeroArr.slice(0);}var ndu=[];for(var i=0;i<=p;++i){ndu[i]=zeroArr.slice(0);}ndu[0][0]=1.0;var left=zeroArr.slice(0);var right=zeroArr.slice(0);for(var j=1;j<=p;++j){left[j]=u-U[span+1-j];right[j]=U[span+j]-u;var saved=0.0;for(var r=0;r<j;++r){var rv=right[r+1];var lv=left[j-r];ndu[j][r]=rv+lv;var temp=ndu[r][j-1]/ndu[j][r];ndu[r][j]=saved+rv*temp;saved=lv*temp;}ndu[j][j]=saved;}for(var j=0;j<=p;++j){ders[0][j]=ndu[j][p];}for(var r=0;r<=p;++r){var s1=0;var s2=1;var a=[];for(var i=0;i<=p;++i){a[i]=zeroArr.slice(0);}a[0][0]=1.0;for(var k=1;k<=n;++k){var d=0.0;var rk=r-k;var pk=p-k;if(r>=k){a[s2][0]=a[s1][0]/ndu[pk+1][rk];d=a[s2][0]*ndu[rk][pk];}var j1=rk>=-1?1:-rk;var j2=r-1<=pk?k-1:p-r;for(var j=j1;j<=j2;++j){a[s2][j]=(a[s1][j]-a[s1][j-1])/ndu[pk+1][rk+j];d+=a[s2][j]*ndu[rk+j][pk];}if(r<=pk){a[s2][k]=-a[s1][k-1]/ndu[pk+1][r];d+=a[s2][k]*ndu[r][pk];}ders[k][r]=d;var j=s1;s1=s2;s2=j;}}var r=p;for(var k=1;k<=n;++k){for(var j=0;j<=p;++j){ders[k][j]*=r;}r*=p-k;}return ders;},/*
  		Calculate derivatives of a B-Spline. See The NURBS Book, page 93, algorithm A3.2.

  		p  : degree
  		U  : knot vector
  		P  : control points
  		u  : Parametric points
  		nd : number of derivatives

  		returns array[d+1] with derivatives
  		*/calcBSplineDerivatives:function calcBSplineDerivatives(p,U,P,u,nd){var du=nd<p?nd:p;var CK=[];var span=this.findSpan(p,u,U);var nders=this.calcBasisFunctionDerivatives(span,u,p,du,U);var Pw=[];for(var i=0;i<P.length;++i){var point=P[i].clone();var w=point.w;point.x*=w;point.y*=w;point.z*=w;Pw[i]=point;}for(var k=0;k<=du;++k){var point=Pw[span-p].clone().multiplyScalar(nders[k][0]);for(var j=1;j<=p;++j){point.add(Pw[span-p+j].clone().multiplyScalar(nders[k][j]));}CK[k]=point;}for(var k=du+1;k<=nd+1;++k){CK[k]=new Vector4$1(0,0,0);}return CK;},/*
  	Calculate "K over I"

  	returns k!/(i!(k-i)!)
  	*/calcKoverI:function calcKoverI(k,i){var nom=1;for(var j=2;j<=k;++j){nom*=j;}var denom=1;for(var j=2;j<=i;++j){denom*=j;}for(var j=2;j<=k-i;++j){denom*=j;}return nom/denom;},/*
  	Calculate derivatives (0-nd) of rational curve. See The NURBS Book, page 127, algorithm A4.2.

  	Pders : result of function calcBSplineDerivatives

  	returns array with derivatives for rational curve.
  	*/calcRationalCurveDerivatives:function calcRationalCurveDerivatives(Pders){var this$1=this;var nd=Pders.length;var Aders=[];var wders=[];for(var i=0;i<nd;++i){var point=Pders[i];Aders[i]=new Vector3$1(point.x,point.y,point.z);wders[i]=point.w;}var CK=[];for(var k=0;k<nd;++k){var v=Aders[k].clone();for(var i=1;i<=k;++i){v.sub(CK[k-i].clone().multiplyScalar(this$1.calcKoverI(k,i)*wders[i]));}CK[k]=v.divideScalar(wders[0]);}return CK;},/*
  	Calculate NURBS curve derivatives. See The NURBS Book, page 127, algorithm A4.2.

  	p  : degree
  	U  : knot vector
  	P  : control points in homogeneous space
  	u  : parametric points
  	nd : number of derivatives

  	returns array with derivatives.
  	*/calcNURBSDerivatives:function calcNURBSDerivatives(p,U,P,u,nd){var Pders=this.calcBSplineDerivatives(p,U,P,u,nd);return this.calcRationalCurveDerivatives(Pders);},/*
  	Calculate rational B-Spline surface point. See The NURBS Book, page 134, algorithm A4.3.
   
  	p1, p2 : degrees of B-Spline surface
  	U1, U2 : knot vectors
  	P      : control points (x, y, z, w)
  	u, v   : parametric values

  	returns point for given (u, v)
  	*/calcSurfacePoint:function calcSurfacePoint(p,q,U,V,P,u,v){var uspan=this.findSpan(p,u,U);var vspan=this.findSpan(q,v,V);var Nu=this.calcBasisFunctions(uspan,u,p,U);var Nv=this.calcBasisFunctions(vspan,v,q,V);var temp=[];for(var l=0;l<=q;++l){temp[l]=new Vector4$1(0,0,0,0);for(var k=0;k<=p;++k){var point=P[uspan-p+k][vspan-q+l].clone();var w=point.w;point.x*=w;point.y*=w;point.z*=w;temp[l].add(point.multiplyScalar(Nu[k]));}}var Sw=new Vector4$1(0,0,0,0);for(var l=0;l<=q;++l){Sw.add(temp[l].multiplyScalar(Nv[l]));}Sw.divideScalar(Sw.w);return new Vector3$1(Sw.x,Sw.y,Sw.z);}};/**
   * @author renej
   * NURBS curve object
   *
   * Derives from Curve, overriding getPoint and getTangent.
   *
   * Implementation is based on (x, y [, z=0 [, w=1]]) control points with w=weight.
   *
   **//**************************************************************
   *	NURBS curve
   **************************************************************/var NURBSCurve$1=function NURBSCurve(degree,knots/* array of reals */,controlPoints/* array of Vector(2|3|4) */,startKnot/* index in knots */,endKnot/* index in knots */){var this$1=this;Curve.call(this);this.degree=degree;this.knots=knots;this.controlPoints=[];// Used by periodic NURBS to remove hidden spans
  this.startKnot=startKnot||0;this.endKnot=endKnot||this.knots.length-1;for(var i=0;i<controlPoints.length;++i){// ensure Vector4 for control points
  var point=controlPoints[i];this$1.controlPoints[i]=new Vector4$1(point.x,point.y,point.z,point.w);}};NURBSCurve$1.prototype=Object.create(Curve.prototype);NURBSCurve$1.prototype.constructor=NURBSCurve$1;NURBSCurve$1.prototype.getPoint=function(t){var u=this.knots[this.startKnot]+t*(this.knots[this.endKnot]-this.knots[this.startKnot]);// linear mapping t->u
  // following results in (wx, wy, wz, w) homogeneous point
  var hpoint=NURBSUtils.calcBSplinePoint(this.degree,this.knots,this.controlPoints,u);if(hpoint.w!=1.0){// project to 3D space: (wx, wy, wz, w) -> (x, y, z, 1)
  hpoint.divideScalar(hpoint.w);}return new Vector3$1(hpoint.x,hpoint.y,hpoint.z);};NURBSCurve$1.prototype.getTangent=function(t){var u=this.knots[0]+t*(this.knots[this.knots.length-1]-this.knots[0]);var ders=NURBSUtils.calcNURBSDerivatives(this.degree,this.knots,this.controlPoints,u,1);var tangent=ders[1].clone();tangent.normalize();return tangent;};/**
   * @author renej
   * NURBS surface object
   *
   * Implementation is based on (x, y [, z=0 [, w=1]]) control points with w=weight.
   *
   **/var Detector={canvas:!!window.CanvasRenderingContext2D,webgl:function(){try{var canvas=document.createElement('canvas');return!!(window.WebGLRenderingContext&&(canvas.getContext('webgl')||canvas.getContext('experimental-webgl')));}catch(e){return false;}}(),workers:!!window.Worker,fileapi:window.File&&window.FileReader&&window.FileList&&window.Blob,getWebGLErrorMessage:function getWebGLErrorMessage(){var element=document.createElement('div');element.id='webgl-error-message';element.style.fontFamily='monospace';element.style.fontSize='13px';element.style.fontWeight='normal';element.style.textAlign='center';element.style.background='#fff';element.style.color='#000';element.style.padding='1.5em';element.style.width='400px';element.style.margin='5em auto 0';if(!this.webgl){element.innerHTML=window.WebGLRenderingContext?['Your graphics card does not seem to support <a href="http://khronos.org/webgl/wiki/Getting_a_WebGL_Implementation" style="color:#000">WebGL</a>.<br />','Find out how to get it <a href="http://get.webgl.org/" style="color:#000">here</a>.'].join('\n'):['Your browser does not seem to support <a href="http://khronos.org/webgl/wiki/Getting_a_WebGL_Implementation" style="color:#000">WebGL</a>.<br/>','Find out how to get it <a href="http://get.webgl.org/" style="color:#000">here</a>.'].join('\n');}return element;},addGetWebGLMessage:function addGetWebGLMessage(parameters){var parent,id,element;parameters=parameters||{};parent=parameters.parent!==undefined?parameters.parent:document.body;id=parameters.id!==undefined?parameters.id:'oldie';element=Detector.getWebGLErrorMessage();element.id=id;parent.appendChild(element);}};/**
   * @author mrdoob / http://mrdoob.com/
   */function StereoCamera(){this.type='StereoCamera';this.aspect=1;this.eyeSep=0.064;this.cameraL=new PerspectiveCamera();this.cameraL.layers.enable(1);this.cameraL.matrixAutoUpdate=false;this.cameraR=new PerspectiveCamera();this.cameraR.layers.enable(2);this.cameraR.matrixAutoUpdate=false;}Object.assign(StereoCamera.prototype,{update:function(){var instance,focus,fov,aspect,near,far,zoom,eyeSep;var eyeRight=new Matrix4();var eyeLeft=new Matrix4();return function update(camera){var needsUpdate=instance!==this||focus!==camera.focus||fov!==camera.fov||aspect!==camera.aspect*this.aspect||near!==camera.near||far!==camera.far||zoom!==camera.zoom||eyeSep!==this.eyeSep;if(needsUpdate){instance=this;focus=camera.focus;fov=camera.fov;aspect=camera.aspect*this.aspect;near=camera.near;far=camera.far;zoom=camera.zoom;// Off-axis stereoscopic effect based on
  // http://paulbourke.net/stereographics/stereorender/
  var projectionMatrix=camera.projectionMatrix.clone();eyeSep=this.eyeSep/2;var eyeSepOnProjection=eyeSep*near/focus;var ymax=near*Math.tan(_Math$1.DEG2RAD*fov*0.5)/zoom;var xmin,xmax;// translate xOffset
  eyeLeft.elements[12]=-eyeSep;eyeRight.elements[12]=eyeSep;// for left eye
  xmin=-ymax*aspect+eyeSepOnProjection;xmax=ymax*aspect+eyeSepOnProjection;projectionMatrix.elements[0]=2*near/(xmax-xmin);projectionMatrix.elements[8]=(xmax+xmin)/(xmax-xmin);this.cameraL.projectionMatrix.copy(projectionMatrix);// for right eye
  xmin=-ymax*aspect-eyeSepOnProjection;xmax=ymax*aspect-eyeSepOnProjection;projectionMatrix.elements[0]=2*near/(xmax-xmin);projectionMatrix.elements[8]=(xmax+xmin)/(xmax-xmin);this.cameraR.projectionMatrix.copy(projectionMatrix);}this.cameraL.matrixWorld.copy(camera.matrixWorld).multiply(eyeLeft);this.cameraR.matrixWorld.copy(camera.matrixWorld).multiply(eyeRight);};}()});/**
   * @author mrdoob / http://mrdoob.com/
   * @author marklundin / http://mark-lundin.com/
   * @author alteredq / http://alteredqualia.com/
   * @author tschw
   */var AnaglyphEffect=function AnaglyphEffect(renderer,width,height){// Matrices generated with angler.js https://github.com/tschw/angler.js/
  // (in column-major element order, as accepted by WebGL)
  this.colorMatrixLeft=new Matrix3$1().fromArray([1.0671679973602295,-0.0016435992438346148,0.0001777536963345483,// r out
  -0.028107794001698494,-0.00019593400065787137,-0.0002875397040043026,// g out
  -0.04279090091586113,0.000015809757314855233,-0.00024287120322696865// b out
  ]);//		red						green 						blue  						in
  this.colorMatrixRight=new Matrix3$1().fromArray([-0.0355340838432312,-0.06440307199954987,0.018319187685847282,// r out
  -0.10269022732973099,0.8079727292060852,-0.04835830628871918,// g out
  0.0001224992738571018,-0.009558862075209618,0.567823588848114// b out
  ]);var _camera=new OrthographicCamera(-1,1,1,-1,0,1);var _scene=new Scene();var _stereo=new StereoCamera();var _params={minFilter:LinearFilter,magFilter:NearestFilter,format:RGBAFormat};if(width===undefined){width=512;}if(height===undefined){height=512;}var _renderTargetL=new WebGLRenderTarget(width,height,_params);var _renderTargetR=new WebGLRenderTarget(width,height,_params);var _material=new ShaderMaterial({uniforms:{"mapLeft":{value:_renderTargetL.texture},"mapRight":{value:_renderTargetR.texture},"colorMatrixLeft":{value:this.colorMatrixLeft},"colorMatrixRight":{value:this.colorMatrixRight}},vertexShader:["varying vec2 vUv;","void main() {","	vUv = vec2( uv.x, uv.y );","	gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),fragmentShader:["uniform sampler2D mapLeft;","uniform sampler2D mapRight;","varying vec2 vUv;","uniform mat3 colorMatrixLeft;","uniform mat3 colorMatrixRight;",// These functions implement sRGB linearization and gamma correction
  "float lin( float c ) {","	return c <= 0.04045 ? c * 0.0773993808 :","			pow( c * 0.9478672986 + 0.0521327014, 2.4 );","}","vec4 lin( vec4 c ) {","	return vec4( lin( c.r ), lin( c.g ), lin( c.b ), c.a );","}","float dev( float c ) {","	return c <= 0.0031308 ? c * 12.92","			: pow( c, 0.41666 ) * 1.055 - 0.055;","}","void main() {","	vec2 uv = vUv;","	vec4 colorL = lin( texture2D( mapLeft, uv ) );","	vec4 colorR = lin( texture2D( mapRight, uv ) );","	vec3 color = clamp(","			colorMatrixLeft * colorL.rgb +","			colorMatrixRight * colorR.rgb, 0., 1. );","	gl_FragColor = vec4(","			dev( color.r ), dev( color.g ), dev( color.b ),","			max( colorL.a, colorR.a ) );","}"].join("\n")});var mesh=new Mesh(new PlaneBufferGeometry(2,2),_material);_scene.add(mesh);this.setSize=function(width,height){renderer.setSize(width,height);var pixelRatio=renderer.getPixelRatio();_renderTargetL.setSize(width*pixelRatio,height*pixelRatio);_renderTargetR.setSize(width*pixelRatio,height*pixelRatio);};this.render=function(scene,camera){scene.updateMatrixWorld();if(camera.parent===null){camera.updateMatrixWorld();}_stereo.update(camera);renderer.render(scene,_stereo.cameraL,_renderTargetL,true);renderer.render(scene,_stereo.cameraR,_renderTargetR,true);renderer.render(_scene,_camera);};this.dispose=function(){if(_renderTargetL){_renderTargetL.dispose();}if(_renderTargetR){_renderTargetR.dispose();}};};/*
   * @author zz85 / https://github.com/zz85
   *
   * Ascii generation is based on http://www.nihilogic.dk/labs/jsascii/
   * Maybe more about this later with a blog post at http://lab4games.net/zz85/blog
   *
   * 16 April 2012 - @blurspline
   */var alphamap_fragment="#ifdef USE_ALPHAMAP\n\tdiffuseColor.a *= texture2D( alphaMap, vUv ).g;\n#endif\n";var alphamap_pars_fragment="#ifdef USE_ALPHAMAP\n\tuniform sampler2D alphaMap;\n#endif\n";var alphatest_fragment="#ifdef ALPHATEST\n\tif ( diffuseColor.a < ALPHATEST ) discard;\n#endif\n";var aomap_fragment="#ifdef USE_AOMAP\n\tfloat ambientOcclusion = ( texture2D( aoMap, vUv2 ).r - 1.0 ) * aoMapIntensity + 1.0;\n\treflectedLight.indirectDiffuse *= ambientOcclusion;\n\t#if defined( USE_ENVMAP ) && defined( PHYSICAL )\n\t\tfloat dotNV = saturate( dot( geometry.normal, geometry.viewDir ) );\n\t\treflectedLight.indirectSpecular *= computeSpecularOcclusion( dotNV, ambientOcclusion, material.specularRoughness );\n\t#endif\n#endif\n";var aomap_pars_fragment="#ifdef USE_AOMAP\n\tuniform sampler2D aoMap;\n\tuniform float aoMapIntensity;\n#endif";var begin_vertex="\nvec3 transformed = vec3( position );\n";var beginnormal_vertex="\nvec3 objectNormal = vec3( normal );\n";var bsdfs="float punctualLightIntensityToIrradianceFactor( const in float lightDistance, const in float cutoffDistance, const in float decayExponent ) {\n\tif( decayExponent > 0.0 ) {\n#if defined ( PHYSICALLY_CORRECT_LIGHTS )\n\t\tfloat distanceFalloff = 1.0 / max( pow( lightDistance, decayExponent ), 0.01 );\n\t\tfloat maxDistanceCutoffFactor = pow2( saturate( 1.0 - pow4( lightDistance / cutoffDistance ) ) );\n\t\treturn distanceFalloff * maxDistanceCutoffFactor;\n#else\n\t\treturn pow( saturate( -lightDistance / cutoffDistance + 1.0 ), decayExponent );\n#endif\n\t}\n\treturn 1.0;\n}\nvec3 BRDF_Diffuse_Lambert( const in vec3 diffuseColor ) {\n\treturn RECIPROCAL_PI * diffuseColor;\n}\nvec3 F_Schlick( const in vec3 specularColor, const in float dotLH ) {\n\tfloat fresnel = exp2( ( -5.55473 * dotLH - 6.98316 ) * dotLH );\n\treturn ( 1.0 - specularColor ) * fresnel + specularColor;\n}\nfloat G_GGX_Smith( const in float alpha, const in float dotNL, const in float dotNV ) {\n\tfloat a2 = pow2( alpha );\n\tfloat gl = dotNL + sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNL ) );\n\tfloat gv = dotNV + sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNV ) );\n\treturn 1.0 / ( gl * gv );\n}\nfloat G_GGX_SmithCorrelated( const in float alpha, const in float dotNL, const in float dotNV ) {\n\tfloat a2 = pow2( alpha );\n\tfloat gv = dotNL * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNV ) );\n\tfloat gl = dotNV * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNL ) );\n\treturn 0.5 / max( gv + gl, EPSILON );\n}\nfloat D_GGX( const in float alpha, const in float dotNH ) {\n\tfloat a2 = pow2( alpha );\n\tfloat denom = pow2( dotNH ) * ( a2 - 1.0 ) + 1.0;\n\treturn RECIPROCAL_PI * a2 / pow2( denom );\n}\nvec3 BRDF_Specular_GGX( const in IncidentLight incidentLight, const in GeometricContext geometry, const in vec3 specularColor, const in float roughness ) {\n\tfloat alpha = pow2( roughness );\n\tvec3 halfDir = normalize( incidentLight.direction + geometry.viewDir );\n\tfloat dotNL = saturate( dot( geometry.normal, incidentLight.direction ) );\n\tfloat dotNV = saturate( dot( geometry.normal, geometry.viewDir ) );\n\tfloat dotNH = saturate( dot( geometry.normal, halfDir ) );\n\tfloat dotLH = saturate( dot( incidentLight.direction, halfDir ) );\n\tvec3 F = F_Schlick( specularColor, dotLH );\n\tfloat G = G_GGX_SmithCorrelated( alpha, dotNL, dotNV );\n\tfloat D = D_GGX( alpha, dotNH );\n\treturn F * ( G * D );\n}\nvec2 LTC_Uv( const in vec3 N, const in vec3 V, const in float roughness ) {\n\tconst float LUT_SIZE  = 64.0;\n\tconst float LUT_SCALE = ( LUT_SIZE - 1.0 ) / LUT_SIZE;\n\tconst float LUT_BIAS  = 0.5 / LUT_SIZE;\n\tfloat theta = acos( dot( N, V ) );\n\tvec2 uv = vec2(\n\t\tsqrt( saturate( roughness ) ),\n\t\tsaturate( theta / ( 0.5 * PI ) ) );\n\tuv = uv * LUT_SCALE + LUT_BIAS;\n\treturn uv;\n}\nfloat LTC_ClippedSphereFormFactor( const in vec3 f ) {\n\tfloat l = length( f );\n\treturn max( ( l * l + f.z ) / ( l + 1.0 ), 0.0 );\n}\nvec3 LTC_EdgeVectorFormFactor( const in vec3 v1, const in vec3 v2 ) {\n\tfloat x = dot( v1, v2 );\n\tfloat y = abs( x );\n\tfloat a = 0.86267 + (0.49788 + 0.01436 * y ) * y;\n\tfloat b = 3.45068 + (4.18814 + y) * y;\n\tfloat v = a / b;\n\tfloat theta_sintheta = (x > 0.0) ? v : 0.5 * inversesqrt( 1.0 - x * x ) - v;\n\treturn cross( v1, v2 ) * theta_sintheta;\n}\nvec3 LTC_Evaluate( const in vec3 N, const in vec3 V, const in vec3 P, const in mat3 mInv, const in vec3 rectCoords[ 4 ] ) {\n\tvec3 v1 = rectCoords[ 1 ] - rectCoords[ 0 ];\n\tvec3 v2 = rectCoords[ 3 ] - rectCoords[ 0 ];\n\tvec3 lightNormal = cross( v1, v2 );\n\tif( dot( lightNormal, P - rectCoords[ 0 ] ) < 0.0 ) return vec3( 0.0 );\n\tvec3 T1, T2;\n\tT1 = normalize( V - N * dot( V, N ) );\n\tT2 = - cross( N, T1 );\n\tmat3 mat = mInv * transposeMat3( mat3( T1, T2, N ) );\n\tvec3 coords[ 4 ];\n\tcoords[ 0 ] = mat * ( rectCoords[ 0 ] - P );\n\tcoords[ 1 ] = mat * ( rectCoords[ 1 ] - P );\n\tcoords[ 2 ] = mat * ( rectCoords[ 2 ] - P );\n\tcoords[ 3 ] = mat * ( rectCoords[ 3 ] - P );\n\tcoords[ 0 ] = normalize( coords[ 0 ] );\n\tcoords[ 1 ] = normalize( coords[ 1 ] );\n\tcoords[ 2 ] = normalize( coords[ 2 ] );\n\tcoords[ 3 ] = normalize( coords[ 3 ] );\n\tvec3 vectorFormFactor = vec3( 0.0 );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 0 ], coords[ 1 ] );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 1 ], coords[ 2 ] );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 2 ], coords[ 3 ] );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 3 ], coords[ 0 ] );\n\tvec3 result = vec3( LTC_ClippedSphereFormFactor( vectorFormFactor ) );\n\treturn result;\n}\nvec3 BRDF_Specular_GGX_Environment( const in GeometricContext geometry, const in vec3 specularColor, const in float roughness ) {\n\tfloat dotNV = saturate( dot( geometry.normal, geometry.viewDir ) );\n\tconst vec4 c0 = vec4( - 1, - 0.0275, - 0.572, 0.022 );\n\tconst vec4 c1 = vec4( 1, 0.0425, 1.04, - 0.04 );\n\tvec4 r = roughness * c0 + c1;\n\tfloat a004 = min( r.x * r.x, exp2( - 9.28 * dotNV ) ) * r.x + r.y;\n\tvec2 AB = vec2( -1.04, 1.04 ) * a004 + r.zw;\n\treturn specularColor * AB.x + AB.y;\n}\nfloat G_BlinnPhong_Implicit( ) {\n\treturn 0.25;\n}\nfloat D_BlinnPhong( const in float shininess, const in float dotNH ) {\n\treturn RECIPROCAL_PI * ( shininess * 0.5 + 1.0 ) * pow( dotNH, shininess );\n}\nvec3 BRDF_Specular_BlinnPhong( const in IncidentLight incidentLight, const in GeometricContext geometry, const in vec3 specularColor, const in float shininess ) {\n\tvec3 halfDir = normalize( incidentLight.direction + geometry.viewDir );\n\tfloat dotNH = saturate( dot( geometry.normal, halfDir ) );\n\tfloat dotLH = saturate( dot( incidentLight.direction, halfDir ) );\n\tvec3 F = F_Schlick( specularColor, dotLH );\n\tfloat G = G_BlinnPhong_Implicit( );\n\tfloat D = D_BlinnPhong( shininess, dotNH );\n\treturn F * ( G * D );\n}\nfloat GGXRoughnessToBlinnExponent( const in float ggxRoughness ) {\n\treturn ( 2.0 / pow2( ggxRoughness + 0.0001 ) - 2.0 );\n}\nfloat BlinnExponentToGGXRoughness( const in float blinnExponent ) {\n\treturn sqrt( 2.0 / ( blinnExponent + 2.0 ) );\n}\n";var bumpmap_pars_fragment="#ifdef USE_BUMPMAP\n\tuniform sampler2D bumpMap;\n\tuniform float bumpScale;\n\tvec2 dHdxy_fwd() {\n\t\tvec2 dSTdx = dFdx( vUv );\n\t\tvec2 dSTdy = dFdy( vUv );\n\t\tfloat Hll = bumpScale * texture2D( bumpMap, vUv ).x;\n\t\tfloat dBx = bumpScale * texture2D( bumpMap, vUv + dSTdx ).x - Hll;\n\t\tfloat dBy = bumpScale * texture2D( bumpMap, vUv + dSTdy ).x - Hll;\n\t\treturn vec2( dBx, dBy );\n\t}\n\tvec3 perturbNormalArb( vec3 surf_pos, vec3 surf_norm, vec2 dHdxy ) {\n\t\tvec3 vSigmaX = vec3( dFdx( surf_pos.x ), dFdx( surf_pos.y ), dFdx( surf_pos.z ) );\n\t\tvec3 vSigmaY = vec3( dFdy( surf_pos.x ), dFdy( surf_pos.y ), dFdy( surf_pos.z ) );\n\t\tvec3 vN = surf_norm;\n\t\tvec3 R1 = cross( vSigmaY, vN );\n\t\tvec3 R2 = cross( vN, vSigmaX );\n\t\tfloat fDet = dot( vSigmaX, R1 );\n\t\tvec3 vGrad = sign( fDet ) * ( dHdxy.x * R1 + dHdxy.y * R2 );\n\t\treturn normalize( abs( fDet ) * surf_norm - vGrad );\n\t}\n#endif\n";var clipping_planes_fragment="#if NUM_CLIPPING_PLANES > 0\n\tfor ( int i = 0; i < UNION_CLIPPING_PLANES; ++ i ) {\n\t\tvec4 plane = clippingPlanes[ i ];\n\t\tif ( dot( vViewPosition, plane.xyz ) > plane.w ) discard;\n\t}\n\t\t\n\t#if UNION_CLIPPING_PLANES < NUM_CLIPPING_PLANES\n\t\tbool clipped = true;\n\t\tfor ( int i = UNION_CLIPPING_PLANES; i < NUM_CLIPPING_PLANES; ++ i ) {\n\t\t\tvec4 plane = clippingPlanes[ i ];\n\t\t\tclipped = ( dot( vViewPosition, plane.xyz ) > plane.w ) && clipped;\n\t\t}\n\t\tif ( clipped ) discard;\n\t\n\t#endif\n#endif\n";var clipping_planes_pars_fragment="#if NUM_CLIPPING_PLANES > 0\n\t#if ! defined( PHYSICAL ) && ! defined( PHONG )\n\t\tvarying vec3 vViewPosition;\n\t#endif\n\tuniform vec4 clippingPlanes[ NUM_CLIPPING_PLANES ];\n#endif\n";var clipping_planes_pars_vertex="#if NUM_CLIPPING_PLANES > 0 && ! defined( PHYSICAL ) && ! defined( PHONG )\n\tvarying vec3 vViewPosition;\n#endif\n";var clipping_planes_vertex="#if NUM_CLIPPING_PLANES > 0 && ! defined( PHYSICAL ) && ! defined( PHONG )\n\tvViewPosition = - mvPosition.xyz;\n#endif\n";var color_fragment="#ifdef USE_COLOR\n\tdiffuseColor.rgb *= vColor;\n#endif";var color_pars_fragment="#ifdef USE_COLOR\n\tvarying vec3 vColor;\n#endif\n";var color_pars_vertex="#ifdef USE_COLOR\n\tvarying vec3 vColor;\n#endif";var color_vertex="#ifdef USE_COLOR\n\tvColor.xyz = color.xyz;\n#endif";var common="#define PI 3.14159265359\n#define PI2 6.28318530718\n#define PI_HALF 1.5707963267949\n#define RECIPROCAL_PI 0.31830988618\n#define RECIPROCAL_PI2 0.15915494\n#define LOG2 1.442695\n#define EPSILON 1e-6\n#define saturate(a) clamp( a, 0.0, 1.0 )\n#define whiteCompliment(a) ( 1.0 - saturate( a ) )\nfloat pow2( const in float x ) { return x*x; }\nfloat pow3( const in float x ) { return x*x*x; }\nfloat pow4( const in float x ) { float x2 = x*x; return x2*x2; }\nfloat average( const in vec3 color ) { return dot( color, vec3( 0.3333 ) ); }\nhighp float rand( const in vec2 uv ) {\n\tconst highp float a = 12.9898, b = 78.233, c = 43758.5453;\n\thighp float dt = dot( uv.xy, vec2( a,b ) ), sn = mod( dt, PI );\n\treturn fract(sin(sn) * c);\n}\nstruct IncidentLight {\n\tvec3 color;\n\tvec3 direction;\n\tbool visible;\n};\nstruct ReflectedLight {\n\tvec3 directDiffuse;\n\tvec3 directSpecular;\n\tvec3 indirectDiffuse;\n\tvec3 indirectSpecular;\n};\nstruct GeometricContext {\n\tvec3 position;\n\tvec3 normal;\n\tvec3 viewDir;\n};\nvec3 transformDirection( in vec3 dir, in mat4 matrix ) {\n\treturn normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );\n}\nvec3 inverseTransformDirection( in vec3 dir, in mat4 matrix ) {\n\treturn normalize( ( vec4( dir, 0.0 ) * matrix ).xyz );\n}\nvec3 projectOnPlane(in vec3 point, in vec3 pointOnPlane, in vec3 planeNormal ) {\n\tfloat distance = dot( planeNormal, point - pointOnPlane );\n\treturn - distance * planeNormal + point;\n}\nfloat sideOfPlane( in vec3 point, in vec3 pointOnPlane, in vec3 planeNormal ) {\n\treturn sign( dot( point - pointOnPlane, planeNormal ) );\n}\nvec3 linePlaneIntersect( in vec3 pointOnLine, in vec3 lineDirection, in vec3 pointOnPlane, in vec3 planeNormal ) {\n\treturn lineDirection * ( dot( planeNormal, pointOnPlane - pointOnLine ) / dot( planeNormal, lineDirection ) ) + pointOnLine;\n}\nmat3 transposeMat3( const in mat3 m ) {\n\tmat3 tmp;\n\ttmp[ 0 ] = vec3( m[ 0 ].x, m[ 1 ].x, m[ 2 ].x );\n\ttmp[ 1 ] = vec3( m[ 0 ].y, m[ 1 ].y, m[ 2 ].y );\n\ttmp[ 2 ] = vec3( m[ 0 ].z, m[ 1 ].z, m[ 2 ].z );\n\treturn tmp;\n}\nfloat linearToRelativeLuminance( const in vec3 color ) {\n\tvec3 weights = vec3( 0.2126, 0.7152, 0.0722 );\n\treturn dot( weights, color.rgb );\n}\n";var cube_uv_reflection_fragment="#ifdef ENVMAP_TYPE_CUBE_UV\n#define cubeUV_textureSize (1024.0)\nint getFaceFromDirection(vec3 direction) {\n\tvec3 absDirection = abs(direction);\n\tint face = -1;\n\tif( absDirection.x > absDirection.z ) {\n\t\tif(absDirection.x > absDirection.y )\n\t\t\tface = direction.x > 0.0 ? 0 : 3;\n\t\telse\n\t\t\tface = direction.y > 0.0 ? 1 : 4;\n\t}\n\telse {\n\t\tif(absDirection.z > absDirection.y )\n\t\t\tface = direction.z > 0.0 ? 2 : 5;\n\t\telse\n\t\t\tface = direction.y > 0.0 ? 1 : 4;\n\t}\n\treturn face;\n}\n#define cubeUV_maxLods1  (log2(cubeUV_textureSize*0.25) - 1.0)\n#define cubeUV_rangeClamp (exp2((6.0 - 1.0) * 2.0))\nvec2 MipLevelInfo( vec3 vec, float roughnessLevel, float roughness ) {\n\tfloat scale = exp2(cubeUV_maxLods1 - roughnessLevel);\n\tfloat dxRoughness = dFdx(roughness);\n\tfloat dyRoughness = dFdy(roughness);\n\tvec3 dx = dFdx( vec * scale * dxRoughness );\n\tvec3 dy = dFdy( vec * scale * dyRoughness );\n\tfloat d = max( dot( dx, dx ), dot( dy, dy ) );\n\td = clamp(d, 1.0, cubeUV_rangeClamp);\n\tfloat mipLevel = 0.5 * log2(d);\n\treturn vec2(floor(mipLevel), fract(mipLevel));\n}\n#define cubeUV_maxLods2 (log2(cubeUV_textureSize*0.25) - 2.0)\n#define cubeUV_rcpTextureSize (1.0 / cubeUV_textureSize)\nvec2 getCubeUV(vec3 direction, float roughnessLevel, float mipLevel) {\n\tmipLevel = roughnessLevel > cubeUV_maxLods2 - 3.0 ? 0.0 : mipLevel;\n\tfloat a = 16.0 * cubeUV_rcpTextureSize;\n\tvec2 exp2_packed = exp2( vec2( roughnessLevel, mipLevel ) );\n\tvec2 rcp_exp2_packed = vec2( 1.0 ) / exp2_packed;\n\tfloat powScale = exp2_packed.x * exp2_packed.y;\n\tfloat scale = rcp_exp2_packed.x * rcp_exp2_packed.y * 0.25;\n\tfloat mipOffset = 0.75*(1.0 - rcp_exp2_packed.y) * rcp_exp2_packed.x;\n\tbool bRes = mipLevel == 0.0;\n\tscale =  bRes && (scale < a) ? a : scale;\n\tvec3 r;\n\tvec2 offset;\n\tint face = getFaceFromDirection(direction);\n\tfloat rcpPowScale = 1.0 / powScale;\n\tif( face == 0) {\n\t\tr = vec3(direction.x, -direction.z, direction.y);\n\t\toffset = vec2(0.0+mipOffset,0.75 * rcpPowScale);\n\t\toffset.y = bRes && (offset.y < 2.0*a) ? a : offset.y;\n\t}\n\telse if( face == 1) {\n\t\tr = vec3(direction.y, direction.x, direction.z);\n\t\toffset = vec2(scale+mipOffset, 0.75 * rcpPowScale);\n\t\toffset.y = bRes && (offset.y < 2.0*a) ? a : offset.y;\n\t}\n\telse if( face == 2) {\n\t\tr = vec3(direction.z, direction.x, direction.y);\n\t\toffset = vec2(2.0*scale+mipOffset, 0.75 * rcpPowScale);\n\t\toffset.y = bRes && (offset.y < 2.0*a) ? a : offset.y;\n\t}\n\telse if( face == 3) {\n\t\tr = vec3(direction.x, direction.z, direction.y);\n\t\toffset = vec2(0.0+mipOffset,0.5 * rcpPowScale);\n\t\toffset.y = bRes && (offset.y < 2.0*a) ? 0.0 : offset.y;\n\t}\n\telse if( face == 4) {\n\t\tr = vec3(direction.y, direction.x, -direction.z);\n\t\toffset = vec2(scale+mipOffset, 0.5 * rcpPowScale);\n\t\toffset.y = bRes && (offset.y < 2.0*a) ? 0.0 : offset.y;\n\t}\n\telse {\n\t\tr = vec3(direction.z, -direction.x, direction.y);\n\t\toffset = vec2(2.0*scale+mipOffset, 0.5 * rcpPowScale);\n\t\toffset.y = bRes && (offset.y < 2.0*a) ? 0.0 : offset.y;\n\t}\n\tr = normalize(r);\n\tfloat texelOffset = 0.5 * cubeUV_rcpTextureSize;\n\tvec2 s = ( r.yz / abs( r.x ) + vec2( 1.0 ) ) * 0.5;\n\tvec2 base = offset + vec2( texelOffset );\n\treturn base + s * ( scale - 2.0 * texelOffset );\n}\n#define cubeUV_maxLods3 (log2(cubeUV_textureSize*0.25) - 3.0)\nvec4 textureCubeUV(vec3 reflectedDirection, float roughness ) {\n\tfloat roughnessVal = roughness* cubeUV_maxLods3;\n\tfloat r1 = floor(roughnessVal);\n\tfloat r2 = r1 + 1.0;\n\tfloat t = fract(roughnessVal);\n\tvec2 mipInfo = MipLevelInfo(reflectedDirection, r1, roughness);\n\tfloat s = mipInfo.y;\n\tfloat level0 = mipInfo.x;\n\tfloat level1 = level0 + 1.0;\n\tlevel1 = level1 > 5.0 ? 5.0 : level1;\n\tlevel0 += min( floor( s + 0.5 ), 5.0 );\n\tvec2 uv_10 = getCubeUV(reflectedDirection, r1, level0);\n\tvec4 color10 = envMapTexelToLinear(texture2D(envMap, uv_10));\n\tvec2 uv_20 = getCubeUV(reflectedDirection, r2, level0);\n\tvec4 color20 = envMapTexelToLinear(texture2D(envMap, uv_20));\n\tvec4 result = mix(color10, color20, t);\n\treturn vec4(result.rgb, 1.0);\n}\n#endif\n";var defaultnormal_vertex="vec3 transformedNormal = normalMatrix * objectNormal;\n#ifdef FLIP_SIDED\n\ttransformedNormal = - transformedNormal;\n#endif\n";var displacementmap_pars_vertex="#ifdef USE_DISPLACEMENTMAP\n\tuniform sampler2D displacementMap;\n\tuniform float displacementScale;\n\tuniform float displacementBias;\n#endif\n";var displacementmap_vertex="#ifdef USE_DISPLACEMENTMAP\n\ttransformed += normalize( objectNormal ) * ( texture2D( displacementMap, uv ).x * displacementScale + displacementBias );\n#endif\n";var emissivemap_fragment="#ifdef USE_EMISSIVEMAP\n\tvec4 emissiveColor = texture2D( emissiveMap, vUv );\n\temissiveColor.rgb = emissiveMapTexelToLinear( emissiveColor ).rgb;\n\ttotalEmissiveRadiance *= emissiveColor.rgb;\n#endif\n";var emissivemap_pars_fragment="#ifdef USE_EMISSIVEMAP\n\tuniform sampler2D emissiveMap;\n#endif\n";var encodings_fragment="  gl_FragColor = linearToOutputTexel( gl_FragColor );\n";var encodings_pars_fragment="\nvec4 LinearToLinear( in vec4 value ) {\n\treturn value;\n}\nvec4 GammaToLinear( in vec4 value, in float gammaFactor ) {\n\treturn vec4( pow( value.xyz, vec3( gammaFactor ) ), value.w );\n}\nvec4 LinearToGamma( in vec4 value, in float gammaFactor ) {\n\treturn vec4( pow( value.xyz, vec3( 1.0 / gammaFactor ) ), value.w );\n}\nvec4 sRGBToLinear( in vec4 value ) {\n\treturn vec4( mix( pow( value.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), value.rgb * 0.0773993808, vec3( lessThanEqual( value.rgb, vec3( 0.04045 ) ) ) ), value.w );\n}\nvec4 LinearTosRGB( in vec4 value ) {\n\treturn vec4( mix( pow( value.rgb, vec3( 0.41666 ) ) * 1.055 - vec3( 0.055 ), value.rgb * 12.92, vec3( lessThanEqual( value.rgb, vec3( 0.0031308 ) ) ) ), value.w );\n}\nvec4 RGBEToLinear( in vec4 value ) {\n\treturn vec4( value.rgb * exp2( value.a * 255.0 - 128.0 ), 1.0 );\n}\nvec4 LinearToRGBE( in vec4 value ) {\n\tfloat maxComponent = max( max( value.r, value.g ), value.b );\n\tfloat fExp = clamp( ceil( log2( maxComponent ) ), -128.0, 127.0 );\n\treturn vec4( value.rgb / exp2( fExp ), ( fExp + 128.0 ) / 255.0 );\n}\nvec4 RGBMToLinear( in vec4 value, in float maxRange ) {\n\treturn vec4( value.xyz * value.w * maxRange, 1.0 );\n}\nvec4 LinearToRGBM( in vec4 value, in float maxRange ) {\n\tfloat maxRGB = max( value.x, max( value.g, value.b ) );\n\tfloat M      = clamp( maxRGB / maxRange, 0.0, 1.0 );\n\tM            = ceil( M * 255.0 ) / 255.0;\n\treturn vec4( value.rgb / ( M * maxRange ), M );\n}\nvec4 RGBDToLinear( in vec4 value, in float maxRange ) {\n\treturn vec4( value.rgb * ( ( maxRange / 255.0 ) / value.a ), 1.0 );\n}\nvec4 LinearToRGBD( in vec4 value, in float maxRange ) {\n\tfloat maxRGB = max( value.x, max( value.g, value.b ) );\n\tfloat D      = max( maxRange / maxRGB, 1.0 );\n\tD            = min( floor( D ) / 255.0, 1.0 );\n\treturn vec4( value.rgb * ( D * ( 255.0 / maxRange ) ), D );\n}\nconst mat3 cLogLuvM = mat3( 0.2209, 0.3390, 0.4184, 0.1138, 0.6780, 0.7319, 0.0102, 0.1130, 0.2969 );\nvec4 LinearToLogLuv( in vec4 value )  {\n\tvec3 Xp_Y_XYZp = value.rgb * cLogLuvM;\n\tXp_Y_XYZp = max(Xp_Y_XYZp, vec3(1e-6, 1e-6, 1e-6));\n\tvec4 vResult;\n\tvResult.xy = Xp_Y_XYZp.xy / Xp_Y_XYZp.z;\n\tfloat Le = 2.0 * log2(Xp_Y_XYZp.y) + 127.0;\n\tvResult.w = fract(Le);\n\tvResult.z = (Le - (floor(vResult.w*255.0))/255.0)/255.0;\n\treturn vResult;\n}\nconst mat3 cLogLuvInverseM = mat3( 6.0014, -2.7008, -1.7996, -1.3320, 3.1029, -5.7721, 0.3008, -1.0882, 5.6268 );\nvec4 LogLuvToLinear( in vec4 value ) {\n\tfloat Le = value.z * 255.0 + value.w;\n\tvec3 Xp_Y_XYZp;\n\tXp_Y_XYZp.y = exp2((Le - 127.0) / 2.0);\n\tXp_Y_XYZp.z = Xp_Y_XYZp.y / value.y;\n\tXp_Y_XYZp.x = value.x * Xp_Y_XYZp.z;\n\tvec3 vRGB = Xp_Y_XYZp.rgb * cLogLuvInverseM;\n\treturn vec4( max(vRGB, 0.0), 1.0 );\n}\n";var envmap_fragment="#ifdef USE_ENVMAP\n\t#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG )\n\t\tvec3 cameraToVertex = normalize( vWorldPosition - cameraPosition );\n\t\tvec3 worldNormal = inverseTransformDirection( normal, viewMatrix );\n\t\t#ifdef ENVMAP_MODE_REFLECTION\n\t\t\tvec3 reflectVec = reflect( cameraToVertex, worldNormal );\n\t\t#else\n\t\t\tvec3 reflectVec = refract( cameraToVertex, worldNormal, refractionRatio );\n\t\t#endif\n\t#else\n\t\tvec3 reflectVec = vReflect;\n\t#endif\n\t#ifdef ENVMAP_TYPE_CUBE\n\t\tvec4 envColor = textureCube( envMap, vec3( flipEnvMap * reflectVec.x, reflectVec.yz ) );\n\t#elif defined( ENVMAP_TYPE_EQUIREC )\n\t\tvec2 sampleUV;\n\t\treflectVec = normalize( reflectVec );\n\t\tsampleUV.y = asin( clamp( reflectVec.y, - 1.0, 1.0 ) ) * RECIPROCAL_PI + 0.5;\n\t\tsampleUV.x = atan( reflectVec.z, reflectVec.x ) * RECIPROCAL_PI2 + 0.5;\n\t\tvec4 envColor = texture2D( envMap, sampleUV );\n\t#elif defined( ENVMAP_TYPE_SPHERE )\n\t\treflectVec = normalize( reflectVec );\n\t\tvec3 reflectView = normalize( ( viewMatrix * vec4( reflectVec, 0.0 ) ).xyz + vec3( 0.0, 0.0, 1.0 ) );\n\t\tvec4 envColor = texture2D( envMap, reflectView.xy * 0.5 + 0.5 );\n\t#else\n\t\tvec4 envColor = vec4( 0.0 );\n\t#endif\n\tenvColor = envMapTexelToLinear( envColor );\n\t#ifdef ENVMAP_BLENDING_MULTIPLY\n\t\toutgoingLight = mix( outgoingLight, outgoingLight * envColor.xyz, specularStrength * reflectivity );\n\t#elif defined( ENVMAP_BLENDING_MIX )\n\t\toutgoingLight = mix( outgoingLight, envColor.xyz, specularStrength * reflectivity );\n\t#elif defined( ENVMAP_BLENDING_ADD )\n\t\toutgoingLight += envColor.xyz * specularStrength * reflectivity;\n\t#endif\n#endif\n";var envmap_pars_fragment="#if defined( USE_ENVMAP ) || defined( PHYSICAL )\n\tuniform float reflectivity;\n\tuniform float envMapIntensity;\n#endif\n#ifdef USE_ENVMAP\n\t#if ! defined( PHYSICAL ) && ( defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG ) )\n\t\tvarying vec3 vWorldPosition;\n\t#endif\n\t#ifdef ENVMAP_TYPE_CUBE\n\t\tuniform samplerCube envMap;\n\t#else\n\t\tuniform sampler2D envMap;\n\t#endif\n\tuniform float flipEnvMap;\n\t#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG ) || defined( PHYSICAL )\n\t\tuniform float refractionRatio;\n\t#else\n\t\tvarying vec3 vReflect;\n\t#endif\n#endif\n";var envmap_pars_vertex="#ifdef USE_ENVMAP\n\t#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG )\n\t\tvarying vec3 vWorldPosition;\n\t#else\n\t\tvarying vec3 vReflect;\n\t\tuniform float refractionRatio;\n\t#endif\n#endif\n";var envmap_vertex="#ifdef USE_ENVMAP\n\t#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG )\n\t\tvWorldPosition = worldPosition.xyz;\n\t#else\n\t\tvec3 cameraToVertex = normalize( worldPosition.xyz - cameraPosition );\n\t\tvec3 worldNormal = inverseTransformDirection( transformedNormal, viewMatrix );\n\t\t#ifdef ENVMAP_MODE_REFLECTION\n\t\t\tvReflect = reflect( cameraToVertex, worldNormal );\n\t\t#else\n\t\t\tvReflect = refract( cameraToVertex, worldNormal, refractionRatio );\n\t\t#endif\n\t#endif\n#endif\n";var fog_vertex="\n#ifdef USE_FOG\nfogDepth = -mvPosition.z;\n#endif";var fog_pars_vertex="#ifdef USE_FOG\n  varying float fogDepth;\n#endif\n";var fog_fragment="#ifdef USE_FOG\n\t#ifdef FOG_EXP2\n\t\tfloat fogFactor = whiteCompliment( exp2( - fogDensity * fogDensity * fogDepth * fogDepth * LOG2 ) );\n\t#else\n\t\tfloat fogFactor = smoothstep( fogNear, fogFar, fogDepth );\n\t#endif\n\tgl_FragColor.rgb = mix( gl_FragColor.rgb, fogColor, fogFactor );\n#endif\n";var fog_pars_fragment="#ifdef USE_FOG\n\tuniform vec3 fogColor;\n\tvarying float fogDepth;\n\t#ifdef FOG_EXP2\n\t\tuniform float fogDensity;\n\t#else\n\t\tuniform float fogNear;\n\t\tuniform float fogFar;\n\t#endif\n#endif\n";var gradientmap_pars_fragment="#ifdef TOON\n\tuniform sampler2D gradientMap;\n\tvec3 getGradientIrradiance( vec3 normal, vec3 lightDirection ) {\n\t\tfloat dotNL = dot( normal, lightDirection );\n\t\tvec2 coord = vec2( dotNL * 0.5 + 0.5, 0.0 );\n\t\t#ifdef USE_GRADIENTMAP\n\t\t\treturn texture2D( gradientMap, coord ).rgb;\n\t\t#else\n\t\t\treturn ( coord.x < 0.7 ) ? vec3( 0.7 ) : vec3( 1.0 );\n\t\t#endif\n\t}\n#endif\n";var lightmap_fragment="#ifdef USE_LIGHTMAP\n\treflectedLight.indirectDiffuse += PI * texture2D( lightMap, vUv2 ).xyz * lightMapIntensity;\n#endif\n";var lightmap_pars_fragment="#ifdef USE_LIGHTMAP\n\tuniform sampler2D lightMap;\n\tuniform float lightMapIntensity;\n#endif";var lights_lambert_vertex="vec3 diffuse = vec3( 1.0 );\nGeometricContext geometry;\ngeometry.position = mvPosition.xyz;\ngeometry.normal = normalize( transformedNormal );\ngeometry.viewDir = normalize( -mvPosition.xyz );\nGeometricContext backGeometry;\nbackGeometry.position = geometry.position;\nbackGeometry.normal = -geometry.normal;\nbackGeometry.viewDir = geometry.viewDir;\nvLightFront = vec3( 0.0 );\n#ifdef DOUBLE_SIDED\n\tvLightBack = vec3( 0.0 );\n#endif\nIncidentLight directLight;\nfloat dotNL;\nvec3 directLightColor_Diffuse;\n#if NUM_POINT_LIGHTS > 0\n\tfor ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {\n\t\tgetPointDirectLightIrradiance( pointLights[ i ], geometry, directLight );\n\t\tdotNL = dot( geometry.normal, directLight.direction );\n\t\tdirectLightColor_Diffuse = PI * directLight.color;\n\t\tvLightFront += saturate( dotNL ) * directLightColor_Diffuse;\n\t\t#ifdef DOUBLE_SIDED\n\t\t\tvLightBack += saturate( -dotNL ) * directLightColor_Diffuse;\n\t\t#endif\n\t}\n#endif\n#if NUM_SPOT_LIGHTS > 0\n\tfor ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {\n\t\tgetSpotDirectLightIrradiance( spotLights[ i ], geometry, directLight );\n\t\tdotNL = dot( geometry.normal, directLight.direction );\n\t\tdirectLightColor_Diffuse = PI * directLight.color;\n\t\tvLightFront += saturate( dotNL ) * directLightColor_Diffuse;\n\t\t#ifdef DOUBLE_SIDED\n\t\t\tvLightBack += saturate( -dotNL ) * directLightColor_Diffuse;\n\t\t#endif\n\t}\n#endif\n#if NUM_DIR_LIGHTS > 0\n\tfor ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {\n\t\tgetDirectionalDirectLightIrradiance( directionalLights[ i ], geometry, directLight );\n\t\tdotNL = dot( geometry.normal, directLight.direction );\n\t\tdirectLightColor_Diffuse = PI * directLight.color;\n\t\tvLightFront += saturate( dotNL ) * directLightColor_Diffuse;\n\t\t#ifdef DOUBLE_SIDED\n\t\t\tvLightBack += saturate( -dotNL ) * directLightColor_Diffuse;\n\t\t#endif\n\t}\n#endif\n#if NUM_HEMI_LIGHTS > 0\n\tfor ( int i = 0; i < NUM_HEMI_LIGHTS; i ++ ) {\n\t\tvLightFront += getHemisphereLightIrradiance( hemisphereLights[ i ], geometry );\n\t\t#ifdef DOUBLE_SIDED\n\t\t\tvLightBack += getHemisphereLightIrradiance( hemisphereLights[ i ], backGeometry );\n\t\t#endif\n\t}\n#endif\n";var lights_pars="uniform vec3 ambientLightColor;\nvec3 getAmbientLightIrradiance( const in vec3 ambientLightColor ) {\n\tvec3 irradiance = ambientLightColor;\n\t#ifndef PHYSICALLY_CORRECT_LIGHTS\n\t\tirradiance *= PI;\n\t#endif\n\treturn irradiance;\n}\n#if NUM_DIR_LIGHTS > 0\n\tstruct DirectionalLight {\n\t\tvec3 direction;\n\t\tvec3 color;\n\t\tint shadow;\n\t\tfloat shadowBias;\n\t\tfloat shadowRadius;\n\t\tvec2 shadowMapSize;\n\t};\n\tuniform DirectionalLight directionalLights[ NUM_DIR_LIGHTS ];\n\tvoid getDirectionalDirectLightIrradiance( const in DirectionalLight directionalLight, const in GeometricContext geometry, out IncidentLight directLight ) {\n\t\tdirectLight.color = directionalLight.color;\n\t\tdirectLight.direction = directionalLight.direction;\n\t\tdirectLight.visible = true;\n\t}\n#endif\n#if NUM_POINT_LIGHTS > 0\n\tstruct PointLight {\n\t\tvec3 position;\n\t\tvec3 color;\n\t\tfloat distance;\n\t\tfloat decay;\n\t\tint shadow;\n\t\tfloat shadowBias;\n\t\tfloat shadowRadius;\n\t\tvec2 shadowMapSize;\n\t\tfloat shadowCameraNear;\n\t\tfloat shadowCameraFar;\n\t};\n\tuniform PointLight pointLights[ NUM_POINT_LIGHTS ];\n\tvoid getPointDirectLightIrradiance( const in PointLight pointLight, const in GeometricContext geometry, out IncidentLight directLight ) {\n\t\tvec3 lVector = pointLight.position - geometry.position;\n\t\tdirectLight.direction = normalize( lVector );\n\t\tfloat lightDistance = length( lVector );\n\t\tdirectLight.color = pointLight.color;\n\t\tdirectLight.color *= punctualLightIntensityToIrradianceFactor( lightDistance, pointLight.distance, pointLight.decay );\n\t\tdirectLight.visible = ( directLight.color != vec3( 0.0 ) );\n\t}\n#endif\n#if NUM_SPOT_LIGHTS > 0\n\tstruct SpotLight {\n\t\tvec3 position;\n\t\tvec3 direction;\n\t\tvec3 color;\n\t\tfloat distance;\n\t\tfloat decay;\n\t\tfloat coneCos;\n\t\tfloat penumbraCos;\n\t\tint shadow;\n\t\tfloat shadowBias;\n\t\tfloat shadowRadius;\n\t\tvec2 shadowMapSize;\n\t};\n\tuniform SpotLight spotLights[ NUM_SPOT_LIGHTS ];\n\tvoid getSpotDirectLightIrradiance( const in SpotLight spotLight, const in GeometricContext geometry, out IncidentLight directLight  ) {\n\t\tvec3 lVector = spotLight.position - geometry.position;\n\t\tdirectLight.direction = normalize( lVector );\n\t\tfloat lightDistance = length( lVector );\n\t\tfloat angleCos = dot( directLight.direction, spotLight.direction );\n\t\tif ( angleCos > spotLight.coneCos ) {\n\t\t\tfloat spotEffect = smoothstep( spotLight.coneCos, spotLight.penumbraCos, angleCos );\n\t\t\tdirectLight.color = spotLight.color;\n\t\t\tdirectLight.color *= spotEffect * punctualLightIntensityToIrradianceFactor( lightDistance, spotLight.distance, spotLight.decay );\n\t\t\tdirectLight.visible = true;\n\t\t} else {\n\t\t\tdirectLight.color = vec3( 0.0 );\n\t\t\tdirectLight.visible = false;\n\t\t}\n\t}\n#endif\n#if NUM_RECT_AREA_LIGHTS > 0\n\tstruct RectAreaLight {\n\t\tvec3 color;\n\t\tvec3 position;\n\t\tvec3 halfWidth;\n\t\tvec3 halfHeight;\n\t};\n\tuniform sampler2D ltcMat;\tuniform sampler2D ltcMag;\n\tuniform RectAreaLight rectAreaLights[ NUM_RECT_AREA_LIGHTS ];\n#endif\n#if NUM_HEMI_LIGHTS > 0\n\tstruct HemisphereLight {\n\t\tvec3 direction;\n\t\tvec3 skyColor;\n\t\tvec3 groundColor;\n\t};\n\tuniform HemisphereLight hemisphereLights[ NUM_HEMI_LIGHTS ];\n\tvec3 getHemisphereLightIrradiance( const in HemisphereLight hemiLight, const in GeometricContext geometry ) {\n\t\tfloat dotNL = dot( geometry.normal, hemiLight.direction );\n\t\tfloat hemiDiffuseWeight = 0.5 * dotNL + 0.5;\n\t\tvec3 irradiance = mix( hemiLight.groundColor, hemiLight.skyColor, hemiDiffuseWeight );\n\t\t#ifndef PHYSICALLY_CORRECT_LIGHTS\n\t\t\tirradiance *= PI;\n\t\t#endif\n\t\treturn irradiance;\n\t}\n#endif\n#if defined( USE_ENVMAP ) && defined( PHYSICAL )\n\tvec3 getLightProbeIndirectIrradiance( const in GeometricContext geometry, const in int maxMIPLevel ) {\n\t\tvec3 worldNormal = inverseTransformDirection( geometry.normal, viewMatrix );\n\t\t#ifdef ENVMAP_TYPE_CUBE\n\t\t\tvec3 queryVec = vec3( flipEnvMap * worldNormal.x, worldNormal.yz );\n\t\t\t#ifdef TEXTURE_LOD_EXT\n\t\t\t\tvec4 envMapColor = textureCubeLodEXT( envMap, queryVec, float( maxMIPLevel ) );\n\t\t\t#else\n\t\t\t\tvec4 envMapColor = textureCube( envMap, queryVec, float( maxMIPLevel ) );\n\t\t\t#endif\n\t\t\tenvMapColor.rgb = envMapTexelToLinear( envMapColor ).rgb;\n\t\t#elif defined( ENVMAP_TYPE_CUBE_UV )\n\t\t\tvec3 queryVec = vec3( flipEnvMap * worldNormal.x, worldNormal.yz );\n\t\t\tvec4 envMapColor = textureCubeUV( queryVec, 1.0 );\n\t\t#else\n\t\t\tvec4 envMapColor = vec4( 0.0 );\n\t\t#endif\n\t\treturn PI * envMapColor.rgb * envMapIntensity;\n\t}\n\tfloat getSpecularMIPLevel( const in float blinnShininessExponent, const in int maxMIPLevel ) {\n\t\tfloat maxMIPLevelScalar = float( maxMIPLevel );\n\t\tfloat desiredMIPLevel = maxMIPLevelScalar + 0.79248 - 0.5 * log2( pow2( blinnShininessExponent ) + 1.0 );\n\t\treturn clamp( desiredMIPLevel, 0.0, maxMIPLevelScalar );\n\t}\n\tvec3 getLightProbeIndirectRadiance( const in GeometricContext geometry, const in float blinnShininessExponent, const in int maxMIPLevel ) {\n\t\t#ifdef ENVMAP_MODE_REFLECTION\n\t\t\tvec3 reflectVec = reflect( -geometry.viewDir, geometry.normal );\n\t\t#else\n\t\t\tvec3 reflectVec = refract( -geometry.viewDir, geometry.normal, refractionRatio );\n\t\t#endif\n\t\treflectVec = inverseTransformDirection( reflectVec, viewMatrix );\n\t\tfloat specularMIPLevel = getSpecularMIPLevel( blinnShininessExponent, maxMIPLevel );\n\t\t#ifdef ENVMAP_TYPE_CUBE\n\t\t\tvec3 queryReflectVec = vec3( flipEnvMap * reflectVec.x, reflectVec.yz );\n\t\t\t#ifdef TEXTURE_LOD_EXT\n\t\t\t\tvec4 envMapColor = textureCubeLodEXT( envMap, queryReflectVec, specularMIPLevel );\n\t\t\t#else\n\t\t\t\tvec4 envMapColor = textureCube( envMap, queryReflectVec, specularMIPLevel );\n\t\t\t#endif\n\t\t\tenvMapColor.rgb = envMapTexelToLinear( envMapColor ).rgb;\n\t\t#elif defined( ENVMAP_TYPE_CUBE_UV )\n\t\t\tvec3 queryReflectVec = vec3( flipEnvMap * reflectVec.x, reflectVec.yz );\n\t\t\tvec4 envMapColor = textureCubeUV(queryReflectVec, BlinnExponentToGGXRoughness(blinnShininessExponent));\n\t\t#elif defined( ENVMAP_TYPE_EQUIREC )\n\t\t\tvec2 sampleUV;\n\t\t\tsampleUV.y = asin( clamp( reflectVec.y, - 1.0, 1.0 ) ) * RECIPROCAL_PI + 0.5;\n\t\t\tsampleUV.x = atan( reflectVec.z, reflectVec.x ) * RECIPROCAL_PI2 + 0.5;\n\t\t\t#ifdef TEXTURE_LOD_EXT\n\t\t\t\tvec4 envMapColor = texture2DLodEXT( envMap, sampleUV, specularMIPLevel );\n\t\t\t#else\n\t\t\t\tvec4 envMapColor = texture2D( envMap, sampleUV, specularMIPLevel );\n\t\t\t#endif\n\t\t\tenvMapColor.rgb = envMapTexelToLinear( envMapColor ).rgb;\n\t\t#elif defined( ENVMAP_TYPE_SPHERE )\n\t\t\tvec3 reflectView = normalize( ( viewMatrix * vec4( reflectVec, 0.0 ) ).xyz + vec3( 0.0,0.0,1.0 ) );\n\t\t\t#ifdef TEXTURE_LOD_EXT\n\t\t\t\tvec4 envMapColor = texture2DLodEXT( envMap, reflectView.xy * 0.5 + 0.5, specularMIPLevel );\n\t\t\t#else\n\t\t\t\tvec4 envMapColor = texture2D( envMap, reflectView.xy * 0.5 + 0.5, specularMIPLevel );\n\t\t\t#endif\n\t\t\tenvMapColor.rgb = envMapTexelToLinear( envMapColor ).rgb;\n\t\t#endif\n\t\treturn envMapColor.rgb * envMapIntensity;\n\t}\n#endif\n";var lights_phong_fragment="BlinnPhongMaterial material;\nmaterial.diffuseColor = diffuseColor.rgb;\nmaterial.specularColor = specular;\nmaterial.specularShininess = shininess;\nmaterial.specularStrength = specularStrength;\n";var lights_phong_pars_fragment="varying vec3 vViewPosition;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\nstruct BlinnPhongMaterial {\n\tvec3\tdiffuseColor;\n\tvec3\tspecularColor;\n\tfloat\tspecularShininess;\n\tfloat\tspecularStrength;\n};\nvoid RE_Direct_BlinnPhong( const in IncidentLight directLight, const in GeometricContext geometry, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {\n\t#ifdef TOON\n\t\tvec3 irradiance = getGradientIrradiance( geometry.normal, directLight.direction ) * directLight.color;\n\t#else\n\t\tfloat dotNL = saturate( dot( geometry.normal, directLight.direction ) );\n\t\tvec3 irradiance = dotNL * directLight.color;\n\t#endif\n\t#ifndef PHYSICALLY_CORRECT_LIGHTS\n\t\tirradiance *= PI;\n\t#endif\n\treflectedLight.directDiffuse += irradiance * BRDF_Diffuse_Lambert( material.diffuseColor );\n\treflectedLight.directSpecular += irradiance * BRDF_Specular_BlinnPhong( directLight, geometry, material.specularColor, material.specularShininess ) * material.specularStrength;\n}\nvoid RE_IndirectDiffuse_BlinnPhong( const in vec3 irradiance, const in GeometricContext geometry, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {\n\treflectedLight.indirectDiffuse += irradiance * BRDF_Diffuse_Lambert( material.diffuseColor );\n}\n#define RE_Direct\t\t\t\tRE_Direct_BlinnPhong\n#define RE_IndirectDiffuse\t\tRE_IndirectDiffuse_BlinnPhong\n#define Material_LightProbeLOD( material )\t(0)\n";var lights_physical_fragment="PhysicalMaterial material;\nmaterial.diffuseColor = diffuseColor.rgb * ( 1.0 - metalnessFactor );\nmaterial.specularRoughness = clamp( roughnessFactor, 0.04, 1.0 );\n#ifdef STANDARD\n\tmaterial.specularColor = mix( vec3( DEFAULT_SPECULAR_COEFFICIENT ), diffuseColor.rgb, metalnessFactor );\n#else\n\tmaterial.specularColor = mix( vec3( MAXIMUM_SPECULAR_COEFFICIENT * pow2( reflectivity ) ), diffuseColor.rgb, metalnessFactor );\n\tmaterial.clearCoat = saturate( clearCoat );\tmaterial.clearCoatRoughness = clamp( clearCoatRoughness, 0.04, 1.0 );\n#endif\n";var lights_physical_pars_fragment="struct PhysicalMaterial {\n\tvec3\tdiffuseColor;\n\tfloat\tspecularRoughness;\n\tvec3\tspecularColor;\n\t#ifndef STANDARD\n\t\tfloat clearCoat;\n\t\tfloat clearCoatRoughness;\n\t#endif\n};\n#define MAXIMUM_SPECULAR_COEFFICIENT 0.16\n#define DEFAULT_SPECULAR_COEFFICIENT 0.04\nfloat clearCoatDHRApprox( const in float roughness, const in float dotNL ) {\n\treturn DEFAULT_SPECULAR_COEFFICIENT + ( 1.0 - DEFAULT_SPECULAR_COEFFICIENT ) * ( pow( 1.0 - dotNL, 5.0 ) * pow( 1.0 - roughness, 2.0 ) );\n}\n#if NUM_RECT_AREA_LIGHTS > 0\n\tvoid RE_Direct_RectArea_Physical( const in RectAreaLight rectAreaLight, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {\n\t\tvec3 normal = geometry.normal;\n\t\tvec3 viewDir = geometry.viewDir;\n\t\tvec3 position = geometry.position;\n\t\tvec3 lightPos = rectAreaLight.position;\n\t\tvec3 halfWidth = rectAreaLight.halfWidth;\n\t\tvec3 halfHeight = rectAreaLight.halfHeight;\n\t\tvec3 lightColor = rectAreaLight.color;\n\t\tfloat roughness = material.specularRoughness;\n\t\tvec3 rectCoords[ 4 ];\n\t\trectCoords[ 0 ] = lightPos - halfWidth - halfHeight;\t\trectCoords[ 1 ] = lightPos + halfWidth - halfHeight;\n\t\trectCoords[ 2 ] = lightPos + halfWidth + halfHeight;\n\t\trectCoords[ 3 ] = lightPos - halfWidth + halfHeight;\n\t\tvec2 uv = LTC_Uv( normal, viewDir, roughness );\n\t\tfloat norm = texture2D( ltcMag, uv ).a;\n\t\tvec4 t = texture2D( ltcMat, uv );\n\t\tmat3 mInv = mat3(\n\t\t\tvec3(   1,   0, t.y ),\n\t\t\tvec3(   0, t.z,   0 ),\n\t\t\tvec3( t.w,   0, t.x )\n\t\t);\n\t\treflectedLight.directSpecular += lightColor * material.specularColor * norm * LTC_Evaluate( normal, viewDir, position, mInv, rectCoords );\n\t\treflectedLight.directDiffuse += lightColor * material.diffuseColor * LTC_Evaluate( normal, viewDir, position, mat3( 1 ), rectCoords );\n\t}\n#endif\nvoid RE_Direct_Physical( const in IncidentLight directLight, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {\n\tfloat dotNL = saturate( dot( geometry.normal, directLight.direction ) );\n\tvec3 irradiance = dotNL * directLight.color;\n\t#ifndef PHYSICALLY_CORRECT_LIGHTS\n\t\tirradiance *= PI;\n\t#endif\n\t#ifndef STANDARD\n\t\tfloat clearCoatDHR = material.clearCoat * clearCoatDHRApprox( material.clearCoatRoughness, dotNL );\n\t#else\n\t\tfloat clearCoatDHR = 0.0;\n\t#endif\n\treflectedLight.directSpecular += ( 1.0 - clearCoatDHR ) * irradiance * BRDF_Specular_GGX( directLight, geometry, material.specularColor, material.specularRoughness );\n\treflectedLight.directDiffuse += ( 1.0 - clearCoatDHR ) * irradiance * BRDF_Diffuse_Lambert( material.diffuseColor );\n\t#ifndef STANDARD\n\t\treflectedLight.directSpecular += irradiance * material.clearCoat * BRDF_Specular_GGX( directLight, geometry, vec3( DEFAULT_SPECULAR_COEFFICIENT ), material.clearCoatRoughness );\n\t#endif\n}\nvoid RE_IndirectDiffuse_Physical( const in vec3 irradiance, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {\n\treflectedLight.indirectDiffuse += irradiance * BRDF_Diffuse_Lambert( material.diffuseColor );\n}\nvoid RE_IndirectSpecular_Physical( const in vec3 radiance, const in vec3 clearCoatRadiance, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {\n\t#ifndef STANDARD\n\t\tfloat dotNV = saturate( dot( geometry.normal, geometry.viewDir ) );\n\t\tfloat dotNL = dotNV;\n\t\tfloat clearCoatDHR = material.clearCoat * clearCoatDHRApprox( material.clearCoatRoughness, dotNL );\n\t#else\n\t\tfloat clearCoatDHR = 0.0;\n\t#endif\n\treflectedLight.indirectSpecular += ( 1.0 - clearCoatDHR ) * radiance * BRDF_Specular_GGX_Environment( geometry, material.specularColor, material.specularRoughness );\n\t#ifndef STANDARD\n\t\treflectedLight.indirectSpecular += clearCoatRadiance * material.clearCoat * BRDF_Specular_GGX_Environment( geometry, vec3( DEFAULT_SPECULAR_COEFFICIENT ), material.clearCoatRoughness );\n\t#endif\n}\n#define RE_Direct\t\t\t\tRE_Direct_Physical\n#define RE_Direct_RectArea\t\tRE_Direct_RectArea_Physical\n#define RE_IndirectDiffuse\t\tRE_IndirectDiffuse_Physical\n#define RE_IndirectSpecular\t\tRE_IndirectSpecular_Physical\n#define Material_BlinnShininessExponent( material )   GGXRoughnessToBlinnExponent( material.specularRoughness )\n#define Material_ClearCoat_BlinnShininessExponent( material )   GGXRoughnessToBlinnExponent( material.clearCoatRoughness )\nfloat computeSpecularOcclusion( const in float dotNV, const in float ambientOcclusion, const in float roughness ) {\n\treturn saturate( pow( dotNV + ambientOcclusion, exp2( - 16.0 * roughness - 1.0 ) ) - 1.0 + ambientOcclusion );\n}\n";var lights_template="\nGeometricContext geometry;\ngeometry.position = - vViewPosition;\ngeometry.normal = normal;\ngeometry.viewDir = normalize( vViewPosition );\nIncidentLight directLight;\n#if ( NUM_POINT_LIGHTS > 0 ) && defined( RE_Direct )\n\tPointLight pointLight;\n\tfor ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {\n\t\tpointLight = pointLights[ i ];\n\t\tgetPointDirectLightIrradiance( pointLight, geometry, directLight );\n\t\t#ifdef USE_SHADOWMAP\n\t\tdirectLight.color *= all( bvec2( pointLight.shadow, directLight.visible ) ) ? getPointShadow( pointShadowMap[ i ], pointLight.shadowMapSize, pointLight.shadowBias, pointLight.shadowRadius, vPointShadowCoord[ i ], pointLight.shadowCameraNear, pointLight.shadowCameraFar ) : 1.0;\n\t\t#endif\n\t\tRE_Direct( directLight, geometry, material, reflectedLight );\n\t}\n#endif\n#if ( NUM_SPOT_LIGHTS > 0 ) && defined( RE_Direct )\n\tSpotLight spotLight;\n\tfor ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {\n\t\tspotLight = spotLights[ i ];\n\t\tgetSpotDirectLightIrradiance( spotLight, geometry, directLight );\n\t\t#ifdef USE_SHADOWMAP\n\t\tdirectLight.color *= all( bvec2( spotLight.shadow, directLight.visible ) ) ? getShadow( spotShadowMap[ i ], spotLight.shadowMapSize, spotLight.shadowBias, spotLight.shadowRadius, vSpotShadowCoord[ i ] ) : 1.0;\n\t\t#endif\n\t\tRE_Direct( directLight, geometry, material, reflectedLight );\n\t}\n#endif\n#if ( NUM_DIR_LIGHTS > 0 ) && defined( RE_Direct )\n\tDirectionalLight directionalLight;\n\tfor ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {\n\t\tdirectionalLight = directionalLights[ i ];\n\t\tgetDirectionalDirectLightIrradiance( directionalLight, geometry, directLight );\n\t\t#ifdef USE_SHADOWMAP\n\t\tdirectLight.color *= all( bvec2( directionalLight.shadow, directLight.visible ) ) ? getShadow( directionalShadowMap[ i ], directionalLight.shadowMapSize, directionalLight.shadowBias, directionalLight.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;\n\t\t#endif\n\t\tRE_Direct( directLight, geometry, material, reflectedLight );\n\t}\n#endif\n#if ( NUM_RECT_AREA_LIGHTS > 0 ) && defined( RE_Direct_RectArea )\n\tRectAreaLight rectAreaLight;\n\tfor ( int i = 0; i < NUM_RECT_AREA_LIGHTS; i ++ ) {\n\t\trectAreaLight = rectAreaLights[ i ];\n\t\tRE_Direct_RectArea( rectAreaLight, geometry, material, reflectedLight );\n\t}\n#endif\n#if defined( RE_IndirectDiffuse )\n\tvec3 irradiance = getAmbientLightIrradiance( ambientLightColor );\n\t#ifdef USE_LIGHTMAP\n\t\tvec3 lightMapIrradiance = texture2D( lightMap, vUv2 ).xyz * lightMapIntensity;\n\t\t#ifndef PHYSICALLY_CORRECT_LIGHTS\n\t\t\tlightMapIrradiance *= PI;\n\t\t#endif\n\t\tirradiance += lightMapIrradiance;\n\t#endif\n\t#if ( NUM_HEMI_LIGHTS > 0 )\n\t\tfor ( int i = 0; i < NUM_HEMI_LIGHTS; i ++ ) {\n\t\t\tirradiance += getHemisphereLightIrradiance( hemisphereLights[ i ], geometry );\n\t\t}\n\t#endif\n\t#if defined( USE_ENVMAP ) && defined( PHYSICAL ) && defined( ENVMAP_TYPE_CUBE_UV )\n\t\tirradiance += getLightProbeIndirectIrradiance( geometry, 8 );\n\t#endif\n\tRE_IndirectDiffuse( irradiance, geometry, material, reflectedLight );\n#endif\n#if defined( USE_ENVMAP ) && defined( RE_IndirectSpecular )\n\tvec3 radiance = getLightProbeIndirectRadiance( geometry, Material_BlinnShininessExponent( material ), 8 );\n\t#ifndef STANDARD\n\t\tvec3 clearCoatRadiance = getLightProbeIndirectRadiance( geometry, Material_ClearCoat_BlinnShininessExponent( material ), 8 );\n\t#else\n\t\tvec3 clearCoatRadiance = vec3( 0.0 );\n\t#endif\n\tRE_IndirectSpecular( radiance, clearCoatRadiance, geometry, material, reflectedLight );\n#endif\n";var logdepthbuf_fragment="#if defined( USE_LOGDEPTHBUF ) && defined( USE_LOGDEPTHBUF_EXT )\n\tgl_FragDepthEXT = log2( vFragDepth ) * logDepthBufFC * 0.5;\n#endif";var logdepthbuf_pars_fragment="#ifdef USE_LOGDEPTHBUF\n\tuniform float logDepthBufFC;\n\t#ifdef USE_LOGDEPTHBUF_EXT\n\t\tvarying float vFragDepth;\n\t#endif\n#endif\n";var logdepthbuf_pars_vertex="#ifdef USE_LOGDEPTHBUF\n\t#ifdef USE_LOGDEPTHBUF_EXT\n\t\tvarying float vFragDepth;\n\t#endif\n\tuniform float logDepthBufFC;\n#endif";var logdepthbuf_vertex="#ifdef USE_LOGDEPTHBUF\n\t#ifdef USE_LOGDEPTHBUF_EXT\n\t\tvFragDepth = 1.0 + gl_Position.w;\n\t#else\n\t\tgl_Position.z = log2( max( EPSILON, gl_Position.w + 1.0 ) ) * logDepthBufFC - 1.0;\n\t\tgl_Position.z *= gl_Position.w;\n\t#endif\n#endif\n";var map_fragment="#ifdef USE_MAP\n\tvec4 texelColor = texture2D( map, vUv );\n\ttexelColor = mapTexelToLinear( texelColor );\n\tdiffuseColor *= texelColor;\n#endif\n";var map_pars_fragment="#ifdef USE_MAP\n\tuniform sampler2D map;\n#endif\n";var map_particle_fragment="#ifdef USE_MAP\n\tvec2 uv = ( uvTransform * vec3( gl_PointCoord.x, 1.0 - gl_PointCoord.y, 1 ) ).xy;\n\tvec4 mapTexel = texture2D( map, uv );\n\tdiffuseColor *= mapTexelToLinear( mapTexel );\n#endif\n";var map_particle_pars_fragment="#ifdef USE_MAP\n\tuniform mat3 uvTransform;\n\tuniform sampler2D map;\n#endif\n";var metalnessmap_fragment="float metalnessFactor = metalness;\n#ifdef USE_METALNESSMAP\n\tvec4 texelMetalness = texture2D( metalnessMap, vUv );\n\tmetalnessFactor *= texelMetalness.b;\n#endif\n";var metalnessmap_pars_fragment="#ifdef USE_METALNESSMAP\n\tuniform sampler2D metalnessMap;\n#endif";var morphnormal_vertex="#ifdef USE_MORPHNORMALS\n\tobjectNormal += ( morphNormal0 - normal ) * morphTargetInfluences[ 0 ];\n\tobjectNormal += ( morphNormal1 - normal ) * morphTargetInfluences[ 1 ];\n\tobjectNormal += ( morphNormal2 - normal ) * morphTargetInfluences[ 2 ];\n\tobjectNormal += ( morphNormal3 - normal ) * morphTargetInfluences[ 3 ];\n#endif\n";var morphtarget_pars_vertex="#ifdef USE_MORPHTARGETS\n\t#ifndef USE_MORPHNORMALS\n\tuniform float morphTargetInfluences[ 8 ];\n\t#else\n\tuniform float morphTargetInfluences[ 4 ];\n\t#endif\n#endif";var morphtarget_vertex="#ifdef USE_MORPHTARGETS\n\ttransformed += ( morphTarget0 - position ) * morphTargetInfluences[ 0 ];\n\ttransformed += ( morphTarget1 - position ) * morphTargetInfluences[ 1 ];\n\ttransformed += ( morphTarget2 - position ) * morphTargetInfluences[ 2 ];\n\ttransformed += ( morphTarget3 - position ) * morphTargetInfluences[ 3 ];\n\t#ifndef USE_MORPHNORMALS\n\ttransformed += ( morphTarget4 - position ) * morphTargetInfluences[ 4 ];\n\ttransformed += ( morphTarget5 - position ) * morphTargetInfluences[ 5 ];\n\ttransformed += ( morphTarget6 - position ) * morphTargetInfluences[ 6 ];\n\ttransformed += ( morphTarget7 - position ) * morphTargetInfluences[ 7 ];\n\t#endif\n#endif\n";var normal_fragment="#ifdef FLAT_SHADED\n\tvec3 fdx = vec3( dFdx( vViewPosition.x ), dFdx( vViewPosition.y ), dFdx( vViewPosition.z ) );\n\tvec3 fdy = vec3( dFdy( vViewPosition.x ), dFdy( vViewPosition.y ), dFdy( vViewPosition.z ) );\n\tvec3 normal = normalize( cross( fdx, fdy ) );\n#else\n\tvec3 normal = normalize( vNormal );\n\t#ifdef DOUBLE_SIDED\n\t\tnormal = normal * ( float( gl_FrontFacing ) * 2.0 - 1.0 );\n\t#endif\n#endif\n#ifdef USE_NORMALMAP\n\tnormal = perturbNormal2Arb( -vViewPosition, normal );\n#elif defined( USE_BUMPMAP )\n\tnormal = perturbNormalArb( -vViewPosition, normal, dHdxy_fwd() );\n#endif\n";var normalmap_pars_fragment="#ifdef USE_NORMALMAP\n\tuniform sampler2D normalMap;\n\tuniform vec2 normalScale;\n\tvec3 perturbNormal2Arb( vec3 eye_pos, vec3 surf_norm ) {\n\t\tvec3 q0 = vec3( dFdx( eye_pos.x ), dFdx( eye_pos.y ), dFdx( eye_pos.z ) );\n\t\tvec3 q1 = vec3( dFdy( eye_pos.x ), dFdy( eye_pos.y ), dFdy( eye_pos.z ) );\n\t\tvec2 st0 = dFdx( vUv.st );\n\t\tvec2 st1 = dFdy( vUv.st );\n\t\tvec3 S = normalize( q0 * st1.t - q1 * st0.t );\n\t\tvec3 T = normalize( -q0 * st1.s + q1 * st0.s );\n\t\tvec3 N = normalize( surf_norm );\n\t\tvec3 mapN = texture2D( normalMap, vUv ).xyz * 2.0 - 1.0;\n\t\tmapN.xy = normalScale * mapN.xy;\n\t\tmat3 tsn = mat3( S, T, N );\n\t\treturn normalize( tsn * mapN );\n\t}\n#endif\n";var packing="vec3 packNormalToRGB( const in vec3 normal ) {\n\treturn normalize( normal ) * 0.5 + 0.5;\n}\nvec3 unpackRGBToNormal( const in vec3 rgb ) {\n\treturn 2.0 * rgb.xyz - 1.0;\n}\nconst float PackUpscale = 256. / 255.;const float UnpackDownscale = 255. / 256.;\nconst vec3 PackFactors = vec3( 256. * 256. * 256., 256. * 256.,  256. );\nconst vec4 UnpackFactors = UnpackDownscale / vec4( PackFactors, 1. );\nconst float ShiftRight8 = 1. / 256.;\nvec4 packDepthToRGBA( const in float v ) {\n\tvec4 r = vec4( fract( v * PackFactors ), v );\n\tr.yzw -= r.xyz * ShiftRight8;\treturn r * PackUpscale;\n}\nfloat unpackRGBAToDepth( const in vec4 v ) {\n\treturn dot( v, UnpackFactors );\n}\nfloat viewZToOrthographicDepth( const in float viewZ, const in float near, const in float far ) {\n\treturn ( viewZ + near ) / ( near - far );\n}\nfloat orthographicDepthToViewZ( const in float linearClipZ, const in float near, const in float far ) {\n\treturn linearClipZ * ( near - far ) - near;\n}\nfloat viewZToPerspectiveDepth( const in float viewZ, const in float near, const in float far ) {\n\treturn (( near + viewZ ) * far ) / (( far - near ) * viewZ );\n}\nfloat perspectiveDepthToViewZ( const in float invClipZ, const in float near, const in float far ) {\n\treturn ( near * far ) / ( ( far - near ) * invClipZ - far );\n}\n";var premultiplied_alpha_fragment="#ifdef PREMULTIPLIED_ALPHA\n\tgl_FragColor.rgb *= gl_FragColor.a;\n#endif\n";var project_vertex="vec4 mvPosition = modelViewMatrix * vec4( transformed, 1.0 );\ngl_Position = projectionMatrix * mvPosition;\n";var dithering_fragment="#if defined( DITHERING )\n  gl_FragColor.rgb = dithering( gl_FragColor.rgb );\n#endif\n";var dithering_pars_fragment="#if defined( DITHERING )\n\tvec3 dithering( vec3 color ) {\n\t\tfloat grid_position = rand( gl_FragCoord.xy );\n\t\tvec3 dither_shift_RGB = vec3( 0.25 / 255.0, -0.25 / 255.0, 0.25 / 255.0 );\n\t\tdither_shift_RGB = mix( 2.0 * dither_shift_RGB, -2.0 * dither_shift_RGB, grid_position );\n\t\treturn color + dither_shift_RGB;\n\t}\n#endif\n";var roughnessmap_fragment="float roughnessFactor = roughness;\n#ifdef USE_ROUGHNESSMAP\n\tvec4 texelRoughness = texture2D( roughnessMap, vUv );\n\troughnessFactor *= texelRoughness.g;\n#endif\n";var roughnessmap_pars_fragment="#ifdef USE_ROUGHNESSMAP\n\tuniform sampler2D roughnessMap;\n#endif";var shadowmap_pars_fragment="#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHTS > 0\n\t\tuniform sampler2D directionalShadowMap[ NUM_DIR_LIGHTS ];\n\t\tvarying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHTS ];\n\t#endif\n\t#if NUM_SPOT_LIGHTS > 0\n\t\tuniform sampler2D spotShadowMap[ NUM_SPOT_LIGHTS ];\n\t\tvarying vec4 vSpotShadowCoord[ NUM_SPOT_LIGHTS ];\n\t#endif\n\t#if NUM_POINT_LIGHTS > 0\n\t\tuniform sampler2D pointShadowMap[ NUM_POINT_LIGHTS ];\n\t\tvarying vec4 vPointShadowCoord[ NUM_POINT_LIGHTS ];\n\t#endif\n\tfloat texture2DCompare( sampler2D depths, vec2 uv, float compare ) {\n\t\treturn step( compare, unpackRGBAToDepth( texture2D( depths, uv ) ) );\n\t}\n\tfloat texture2DShadowLerp( sampler2D depths, vec2 size, vec2 uv, float compare ) {\n\t\tconst vec2 offset = vec2( 0.0, 1.0 );\n\t\tvec2 texelSize = vec2( 1.0 ) / size;\n\t\tvec2 centroidUV = floor( uv * size + 0.5 ) / size;\n\t\tfloat lb = texture2DCompare( depths, centroidUV + texelSize * offset.xx, compare );\n\t\tfloat lt = texture2DCompare( depths, centroidUV + texelSize * offset.xy, compare );\n\t\tfloat rb = texture2DCompare( depths, centroidUV + texelSize * offset.yx, compare );\n\t\tfloat rt = texture2DCompare( depths, centroidUV + texelSize * offset.yy, compare );\n\t\tvec2 f = fract( uv * size + 0.5 );\n\t\tfloat a = mix( lb, lt, f.y );\n\t\tfloat b = mix( rb, rt, f.y );\n\t\tfloat c = mix( a, b, f.x );\n\t\treturn c;\n\t}\n\tfloat getShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord ) {\n\t\tfloat shadow = 1.0;\n\t\tshadowCoord.xyz /= shadowCoord.w;\n\t\tshadowCoord.z += shadowBias;\n\t\tbvec4 inFrustumVec = bvec4 ( shadowCoord.x >= 0.0, shadowCoord.x <= 1.0, shadowCoord.y >= 0.0, shadowCoord.y <= 1.0 );\n\t\tbool inFrustum = all( inFrustumVec );\n\t\tbvec2 frustumTestVec = bvec2( inFrustum, shadowCoord.z <= 1.0 );\n\t\tbool frustumTest = all( frustumTestVec );\n\t\tif ( frustumTest ) {\n\t\t#if defined( SHADOWMAP_TYPE_PCF )\n\t\t\tvec2 texelSize = vec2( 1.0 ) / shadowMapSize;\n\t\t\tfloat dx0 = - texelSize.x * shadowRadius;\n\t\t\tfloat dy0 = - texelSize.y * shadowRadius;\n\t\t\tfloat dx1 = + texelSize.x * shadowRadius;\n\t\t\tfloat dy1 = + texelSize.y * shadowRadius;\n\t\t\tshadow = (\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy1 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy1 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy1 ), shadowCoord.z )\n\t\t\t) * ( 1.0 / 9.0 );\n\t\t#elif defined( SHADOWMAP_TYPE_PCF_SOFT )\n\t\t\tvec2 texelSize = vec2( 1.0 ) / shadowMapSize;\n\t\t\tfloat dx0 = - texelSize.x * shadowRadius;\n\t\t\tfloat dy0 = - texelSize.y * shadowRadius;\n\t\t\tfloat dx1 = + texelSize.x * shadowRadius;\n\t\t\tfloat dy1 = + texelSize.y * shadowRadius;\n\t\t\tshadow = (\n\t\t\t\ttexture2DShadowLerp( shadowMap, shadowMapSize, shadowCoord.xy + vec2( dx0, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DShadowLerp( shadowMap, shadowMapSize, shadowCoord.xy + vec2( 0.0, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DShadowLerp( shadowMap, shadowMapSize, shadowCoord.xy + vec2( dx1, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DShadowLerp( shadowMap, shadowMapSize, shadowCoord.xy + vec2( dx0, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DShadowLerp( shadowMap, shadowMapSize, shadowCoord.xy, shadowCoord.z ) +\n\t\t\t\ttexture2DShadowLerp( shadowMap, shadowMapSize, shadowCoord.xy + vec2( dx1, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DShadowLerp( shadowMap, shadowMapSize, shadowCoord.xy + vec2( dx0, dy1 ), shadowCoord.z ) +\n\t\t\t\ttexture2DShadowLerp( shadowMap, shadowMapSize, shadowCoord.xy + vec2( 0.0, dy1 ), shadowCoord.z ) +\n\t\t\t\ttexture2DShadowLerp( shadowMap, shadowMapSize, shadowCoord.xy + vec2( dx1, dy1 ), shadowCoord.z )\n\t\t\t) * ( 1.0 / 9.0 );\n\t\t#else\n\t\t\tshadow = texture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z );\n\t\t#endif\n\t\t}\n\t\treturn shadow;\n\t}\n\tvec2 cubeToUV( vec3 v, float texelSizeY ) {\n\t\tvec3 absV = abs( v );\n\t\tfloat scaleToCube = 1.0 / max( absV.x, max( absV.y, absV.z ) );\n\t\tabsV *= scaleToCube;\n\t\tv *= scaleToCube * ( 1.0 - 2.0 * texelSizeY );\n\t\tvec2 planar = v.xy;\n\t\tfloat almostATexel = 1.5 * texelSizeY;\n\t\tfloat almostOne = 1.0 - almostATexel;\n\t\tif ( absV.z >= almostOne ) {\n\t\t\tif ( v.z > 0.0 )\n\t\t\t\tplanar.x = 4.0 - v.x;\n\t\t} else if ( absV.x >= almostOne ) {\n\t\t\tfloat signX = sign( v.x );\n\t\t\tplanar.x = v.z * signX + 2.0 * signX;\n\t\t} else if ( absV.y >= almostOne ) {\n\t\t\tfloat signY = sign( v.y );\n\t\t\tplanar.x = v.x + 2.0 * signY + 2.0;\n\t\t\tplanar.y = v.z * signY - 2.0;\n\t\t}\n\t\treturn vec2( 0.125, 0.25 ) * planar + vec2( 0.375, 0.75 );\n\t}\n\tfloat getPointShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord, float shadowCameraNear, float shadowCameraFar ) {\n\t\tvec2 texelSize = vec2( 1.0 ) / ( shadowMapSize * vec2( 4.0, 2.0 ) );\n\t\tvec3 lightToPosition = shadowCoord.xyz;\n\t\tfloat dp = ( length( lightToPosition ) - shadowCameraNear ) / ( shadowCameraFar - shadowCameraNear );\t\tdp += shadowBias;\n\t\tvec3 bd3D = normalize( lightToPosition );\n\t\t#if defined( SHADOWMAP_TYPE_PCF ) || defined( SHADOWMAP_TYPE_PCF_SOFT )\n\t\t\tvec2 offset = vec2( - 1, 1 ) * shadowRadius * texelSize.y;\n\t\t\treturn (\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyx, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyx, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxx, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxx, texelSize.y ), dp )\n\t\t\t) * ( 1.0 / 9.0 );\n\t\t#else\n\t\t\treturn texture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp );\n\t\t#endif\n\t}\n#endif\n";var shadowmap_pars_vertex="#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHTS > 0\n\t\tuniform mat4 directionalShadowMatrix[ NUM_DIR_LIGHTS ];\n\t\tvarying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHTS ];\n\t#endif\n\t#if NUM_SPOT_LIGHTS > 0\n\t\tuniform mat4 spotShadowMatrix[ NUM_SPOT_LIGHTS ];\n\t\tvarying vec4 vSpotShadowCoord[ NUM_SPOT_LIGHTS ];\n\t#endif\n\t#if NUM_POINT_LIGHTS > 0\n\t\tuniform mat4 pointShadowMatrix[ NUM_POINT_LIGHTS ];\n\t\tvarying vec4 vPointShadowCoord[ NUM_POINT_LIGHTS ];\n\t#endif\n#endif\n";var shadowmap_vertex="#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHTS > 0\n\tfor ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {\n\t\tvDirectionalShadowCoord[ i ] = directionalShadowMatrix[ i ] * worldPosition;\n\t}\n\t#endif\n\t#if NUM_SPOT_LIGHTS > 0\n\tfor ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {\n\t\tvSpotShadowCoord[ i ] = spotShadowMatrix[ i ] * worldPosition;\n\t}\n\t#endif\n\t#if NUM_POINT_LIGHTS > 0\n\tfor ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {\n\t\tvPointShadowCoord[ i ] = pointShadowMatrix[ i ] * worldPosition;\n\t}\n\t#endif\n#endif\n";var shadowmask_pars_fragment="float getShadowMask() {\n\tfloat shadow = 1.0;\n\t#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHTS > 0\n\tDirectionalLight directionalLight;\n\tfor ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {\n\t\tdirectionalLight = directionalLights[ i ];\n\t\tshadow *= bool( directionalLight.shadow ) ? getShadow( directionalShadowMap[ i ], directionalLight.shadowMapSize, directionalLight.shadowBias, directionalLight.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;\n\t}\n\t#endif\n\t#if NUM_SPOT_LIGHTS > 0\n\tSpotLight spotLight;\n\tfor ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {\n\t\tspotLight = spotLights[ i ];\n\t\tshadow *= bool( spotLight.shadow ) ? getShadow( spotShadowMap[ i ], spotLight.shadowMapSize, spotLight.shadowBias, spotLight.shadowRadius, vSpotShadowCoord[ i ] ) : 1.0;\n\t}\n\t#endif\n\t#if NUM_POINT_LIGHTS > 0\n\tPointLight pointLight;\n\tfor ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {\n\t\tpointLight = pointLights[ i ];\n\t\tshadow *= bool( pointLight.shadow ) ? getPointShadow( pointShadowMap[ i ], pointLight.shadowMapSize, pointLight.shadowBias, pointLight.shadowRadius, vPointShadowCoord[ i ], pointLight.shadowCameraNear, pointLight.shadowCameraFar ) : 1.0;\n\t}\n\t#endif\n\t#endif\n\treturn shadow;\n}\n";var skinbase_vertex="#ifdef USE_SKINNING\n\tmat4 boneMatX = getBoneMatrix( skinIndex.x );\n\tmat4 boneMatY = getBoneMatrix( skinIndex.y );\n\tmat4 boneMatZ = getBoneMatrix( skinIndex.z );\n\tmat4 boneMatW = getBoneMatrix( skinIndex.w );\n#endif";var skinning_pars_vertex="#ifdef USE_SKINNING\n\tuniform mat4 bindMatrix;\n\tuniform mat4 bindMatrixInverse;\n\t#ifdef BONE_TEXTURE\n\t\tuniform sampler2D boneTexture;\n\t\tuniform int boneTextureSize;\n\t\tmat4 getBoneMatrix( const in float i ) {\n\t\t\tfloat j = i * 4.0;\n\t\t\tfloat x = mod( j, float( boneTextureSize ) );\n\t\t\tfloat y = floor( j / float( boneTextureSize ) );\n\t\t\tfloat dx = 1.0 / float( boneTextureSize );\n\t\t\tfloat dy = 1.0 / float( boneTextureSize );\n\t\t\ty = dy * ( y + 0.5 );\n\t\t\tvec4 v1 = texture2D( boneTexture, vec2( dx * ( x + 0.5 ), y ) );\n\t\t\tvec4 v2 = texture2D( boneTexture, vec2( dx * ( x + 1.5 ), y ) );\n\t\t\tvec4 v3 = texture2D( boneTexture, vec2( dx * ( x + 2.5 ), y ) );\n\t\t\tvec4 v4 = texture2D( boneTexture, vec2( dx * ( x + 3.5 ), y ) );\n\t\t\tmat4 bone = mat4( v1, v2, v3, v4 );\n\t\t\treturn bone;\n\t\t}\n\t#else\n\t\tuniform mat4 boneMatrices[ MAX_BONES ];\n\t\tmat4 getBoneMatrix( const in float i ) {\n\t\t\tmat4 bone = boneMatrices[ int(i) ];\n\t\t\treturn bone;\n\t\t}\n\t#endif\n#endif\n";var skinning_vertex="#ifdef USE_SKINNING\n\tvec4 skinVertex = bindMatrix * vec4( transformed, 1.0 );\n\tvec4 skinned = vec4( 0.0 );\n\tskinned += boneMatX * skinVertex * skinWeight.x;\n\tskinned += boneMatY * skinVertex * skinWeight.y;\n\tskinned += boneMatZ * skinVertex * skinWeight.z;\n\tskinned += boneMatW * skinVertex * skinWeight.w;\n\ttransformed = ( bindMatrixInverse * skinned ).xyz;\n#endif\n";var skinnormal_vertex="#ifdef USE_SKINNING\n\tmat4 skinMatrix = mat4( 0.0 );\n\tskinMatrix += skinWeight.x * boneMatX;\n\tskinMatrix += skinWeight.y * boneMatY;\n\tskinMatrix += skinWeight.z * boneMatZ;\n\tskinMatrix += skinWeight.w * boneMatW;\n\tskinMatrix  = bindMatrixInverse * skinMatrix * bindMatrix;\n\tobjectNormal = vec4( skinMatrix * vec4( objectNormal, 0.0 ) ).xyz;\n#endif\n";var specularmap_fragment="float specularStrength;\n#ifdef USE_SPECULARMAP\n\tvec4 texelSpecular = texture2D( specularMap, vUv );\n\tspecularStrength = texelSpecular.r;\n#else\n\tspecularStrength = 1.0;\n#endif";var specularmap_pars_fragment="#ifdef USE_SPECULARMAP\n\tuniform sampler2D specularMap;\n#endif";var tonemapping_fragment="#if defined( TONE_MAPPING )\n  gl_FragColor.rgb = toneMapping( gl_FragColor.rgb );\n#endif\n";var tonemapping_pars_fragment="#ifndef saturate\n\t#define saturate(a) clamp( a, 0.0, 1.0 )\n#endif\nuniform float toneMappingExposure;\nuniform float toneMappingWhitePoint;\nvec3 LinearToneMapping( vec3 color ) {\n\treturn toneMappingExposure * color;\n}\nvec3 ReinhardToneMapping( vec3 color ) {\n\tcolor *= toneMappingExposure;\n\treturn saturate( color / ( vec3( 1.0 ) + color ) );\n}\n#define Uncharted2Helper( x ) max( ( ( x * ( 0.15 * x + 0.10 * 0.50 ) + 0.20 * 0.02 ) / ( x * ( 0.15 * x + 0.50 ) + 0.20 * 0.30 ) ) - 0.02 / 0.30, vec3( 0.0 ) )\nvec3 Uncharted2ToneMapping( vec3 color ) {\n\tcolor *= toneMappingExposure;\n\treturn saturate( Uncharted2Helper( color ) / Uncharted2Helper( vec3( toneMappingWhitePoint ) ) );\n}\nvec3 OptimizedCineonToneMapping( vec3 color ) {\n\tcolor *= toneMappingExposure;\n\tcolor = max( vec3( 0.0 ), color - 0.004 );\n\treturn pow( ( color * ( 6.2 * color + 0.5 ) ) / ( color * ( 6.2 * color + 1.7 ) + 0.06 ), vec3( 2.2 ) );\n}\n";var uv_pars_fragment="#if defined( USE_MAP ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( USE_SPECULARMAP ) || defined( USE_ALPHAMAP ) || defined( USE_EMISSIVEMAP ) || defined( USE_ROUGHNESSMAP ) || defined( USE_METALNESSMAP )\n\tvarying vec2 vUv;\n#endif";var uv_pars_vertex="#if defined( USE_MAP ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( USE_SPECULARMAP ) || defined( USE_ALPHAMAP ) || defined( USE_EMISSIVEMAP ) || defined( USE_ROUGHNESSMAP ) || defined( USE_METALNESSMAP )\n\tvarying vec2 vUv;\n\tuniform mat3 uvTransform;\n#endif\n";var uv_vertex="#if defined( USE_MAP ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( USE_SPECULARMAP ) || defined( USE_ALPHAMAP ) || defined( USE_EMISSIVEMAP ) || defined( USE_ROUGHNESSMAP ) || defined( USE_METALNESSMAP )\n\tvUv = ( uvTransform * vec3( uv, 1 ) ).xy;\n#endif";var uv2_pars_fragment="#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )\n\tvarying vec2 vUv2;\n#endif";var uv2_pars_vertex="#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )\n\tattribute vec2 uv2;\n\tvarying vec2 vUv2;\n#endif";var uv2_vertex="#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )\n\tvUv2 = uv2;\n#endif";var worldpos_vertex="#if defined( USE_ENVMAP ) || defined( DISTANCE ) || defined ( USE_SHADOWMAP )\n\tvec4 worldPosition = modelMatrix * vec4( transformed, 1.0 );\n#endif\n";var cube_frag="uniform samplerCube tCube;\nuniform float tFlip;\nuniform float opacity;\nvarying vec3 vWorldPosition;\nvoid main() {\n\tgl_FragColor = textureCube( tCube, vec3( tFlip * vWorldPosition.x, vWorldPosition.yz ) );\n\tgl_FragColor.a *= opacity;\n}\n";var cube_vert="varying vec3 vWorldPosition;\n#include <common>\nvoid main() {\n\tvWorldPosition = transformDirection( position, modelMatrix );\n\t#include <begin_vertex>\n\t#include <project_vertex>\n\tgl_Position.z = gl_Position.w;\n}\n";var depth_frag="#if DEPTH_PACKING == 3200\n\tuniform float opacity;\n#endif\n#include <common>\n#include <packing>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( 1.0 );\n\t#if DEPTH_PACKING == 3200\n\t\tdiffuseColor.a = opacity;\n\t#endif\n\t#include <map_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <logdepthbuf_fragment>\n\t#if DEPTH_PACKING == 3200\n\t\tgl_FragColor = vec4( vec3( gl_FragCoord.z ), opacity );\n\t#elif DEPTH_PACKING == 3201\n\t\tgl_FragColor = packDepthToRGBA( gl_FragCoord.z );\n\t#endif\n}\n";var depth_vert="#include <common>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <skinbase_vertex>\n\t#ifdef USE_DISPLACEMENTMAP\n\t\t#include <beginnormal_vertex>\n\t\t#include <morphnormal_vertex>\n\t\t#include <skinnormal_vertex>\n\t#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n}\n";var distanceRGBA_frag="#define DISTANCE\nuniform vec3 referencePosition;\nuniform float nearDistance;\nuniform float farDistance;\nvarying vec3 vWorldPosition;\n#include <common>\n#include <packing>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main () {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( 1.0 );\n\t#include <map_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\tfloat dist = length( vWorldPosition - referencePosition );\n\tdist = ( dist - nearDistance ) / ( farDistance - nearDistance );\n\tdist = saturate( dist );\n\tgl_FragColor = packDepthToRGBA( dist );\n}\n";var distanceRGBA_vert="#define DISTANCE\nvarying vec3 vWorldPosition;\n#include <common>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <skinbase_vertex>\n\t#ifdef USE_DISPLACEMENTMAP\n\t\t#include <beginnormal_vertex>\n\t\t#include <morphnormal_vertex>\n\t\t#include <skinnormal_vertex>\n\t#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <worldpos_vertex>\n\t#include <clipping_planes_vertex>\n\tvWorldPosition = worldPosition.xyz;\n}\n";var equirect_frag="uniform sampler2D tEquirect;\nvarying vec3 vWorldPosition;\n#include <common>\nvoid main() {\n\tvec3 direction = normalize( vWorldPosition );\n\tvec2 sampleUV;\n\tsampleUV.y = asin( clamp( direction.y, - 1.0, 1.0 ) ) * RECIPROCAL_PI + 0.5;\n\tsampleUV.x = atan( direction.z, direction.x ) * RECIPROCAL_PI2 + 0.5;\n\tgl_FragColor = texture2D( tEquirect, sampleUV );\n}\n";var equirect_vert="varying vec3 vWorldPosition;\n#include <common>\nvoid main() {\n\tvWorldPosition = transformDirection( position, modelMatrix );\n\t#include <begin_vertex>\n\t#include <project_vertex>\n}\n";var linedashed_frag="uniform vec3 diffuse;\nuniform float opacity;\nuniform float dashSize;\nuniform float totalSize;\nvarying float vLineDistance;\n#include <common>\n#include <color_pars_fragment>\n#include <fog_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tif ( mod( vLineDistance, totalSize ) > dashSize ) {\n\t\tdiscard;\n\t}\n\tvec3 outgoingLight = vec3( 0.0 );\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <color_fragment>\n\toutgoingLight = diffuseColor.rgb;\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <premultiplied_alpha_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n}\n";var linedashed_vert="uniform float scale;\nattribute float lineDistance;\nvarying float vLineDistance;\n#include <common>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <color_vertex>\n\tvLineDistance = scale * lineDistance;\n\tvec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );\n\tgl_Position = projectionMatrix * mvPosition;\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <fog_vertex>\n}\n";var meshbasic_frag="uniform vec3 diffuse;\nuniform float opacity;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\n#include <common>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <envmap_pars_fragment>\n#include <fog_pars_fragment>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <specularmap_fragment>\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\t#ifdef USE_LIGHTMAP\n\t\treflectedLight.indirectDiffuse += texture2D( lightMap, vUv2 ).xyz * lightMapIntensity;\n\t#else\n\t\treflectedLight.indirectDiffuse += vec3( 1.0 );\n\t#endif\n\t#include <aomap_fragment>\n\treflectedLight.indirectDiffuse *= diffuseColor.rgb;\n\tvec3 outgoingLight = reflectedLight.indirectDiffuse;\n\t#include <envmap_fragment>\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <premultiplied_alpha_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n}\n";var meshbasic_vert="#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <envmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\t#include <skinbase_vertex>\n\t#ifdef USE_ENVMAP\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <worldpos_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <envmap_vertex>\n\t#include <fog_vertex>\n}\n";var meshlambert_frag="uniform vec3 diffuse;\nuniform vec3 emissive;\nuniform float opacity;\nvarying vec3 vLightFront;\n#ifdef DOUBLE_SIDED\n\tvarying vec3 vLightBack;\n#endif\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <envmap_pars_fragment>\n#include <bsdfs>\n#include <lights_pars>\n#include <fog_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <shadowmask_pars_fragment>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <specularmap_fragment>\n\t#include <emissivemap_fragment>\n\treflectedLight.indirectDiffuse = getAmbientLightIrradiance( ambientLightColor );\n\t#include <lightmap_fragment>\n\treflectedLight.indirectDiffuse *= BRDF_Diffuse_Lambert( diffuseColor.rgb );\n\t#ifdef DOUBLE_SIDED\n\t\treflectedLight.directDiffuse = ( gl_FrontFacing ) ? vLightFront : vLightBack;\n\t#else\n\t\treflectedLight.directDiffuse = vLightFront;\n\t#endif\n\treflectedLight.directDiffuse *= BRDF_Diffuse_Lambert( diffuseColor.rgb ) * getShadowMask();\n\t#include <aomap_fragment>\n\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;\n\t#include <envmap_fragment>\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}\n";var meshlambert_vert="#define LAMBERT\nvarying vec3 vLightFront;\n#ifdef DOUBLE_SIDED\n\tvarying vec3 vLightBack;\n#endif\n#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <envmap_pars_vertex>\n#include <bsdfs>\n#include <lights_pars>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <worldpos_vertex>\n\t#include <envmap_vertex>\n\t#include <lights_lambert_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}\n";var meshphong_frag="#define PHONG\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform vec3 specular;\nuniform float shininess;\nuniform float opacity;\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <envmap_pars_fragment>\n#include <gradientmap_pars_fragment>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <lights_pars>\n#include <lights_phong_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <specularmap_fragment>\n\t#include <normal_fragment>\n\t#include <emissivemap_fragment>\n\t#include <lights_phong_fragment>\n\t#include <lights_template>\n\t#include <aomap_fragment>\n\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + reflectedLight.directSpecular + reflectedLight.indirectSpecular + totalEmissiveRadiance;\n\t#include <envmap_fragment>\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}\n";var meshphong_vert="#define PHONG\nvarying vec3 vViewPosition;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\n#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <envmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n#ifndef FLAT_SHADED\n\tvNormal = normalize( transformedNormal );\n#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvViewPosition = - mvPosition.xyz;\n\t#include <worldpos_vertex>\n\t#include <envmap_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}\n";var meshphysical_frag="#define PHYSICAL\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform float roughness;\nuniform float metalness;\nuniform float opacity;\n#ifndef STANDARD\n\tuniform float clearCoat;\n\tuniform float clearCoatRoughness;\n#endif\nvarying vec3 vViewPosition;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <envmap_pars_fragment>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <cube_uv_reflection_fragment>\n#include <lights_pars>\n#include <lights_physical_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <roughnessmap_pars_fragment>\n#include <metalnessmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <roughnessmap_fragment>\n\t#include <metalnessmap_fragment>\n\t#include <normal_fragment>\n\t#include <emissivemap_fragment>\n\t#include <lights_physical_fragment>\n\t#include <lights_template>\n\t#include <aomap_fragment>\n\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + reflectedLight.directSpecular + reflectedLight.indirectSpecular + totalEmissiveRadiance;\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}\n";var meshphysical_vert="#define PHYSICAL\nvarying vec3 vViewPosition;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\n#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n#ifndef FLAT_SHADED\n\tvNormal = normalize( transformedNormal );\n#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvViewPosition = - mvPosition.xyz;\n\t#include <worldpos_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}\n";var normal_frag="#define NORMAL\nuniform float opacity;\n#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP )\n\tvarying vec3 vViewPosition;\n#endif\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\n#include <packing>\n#include <uv_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\nvoid main() {\n\t#include <logdepthbuf_fragment>\n\t#include <normal_fragment>\n\tgl_FragColor = vec4( packNormalToRGB( normal ), opacity );\n}\n";var normal_vert="#define NORMAL\n#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP )\n\tvarying vec3 vViewPosition;\n#endif\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n#ifndef FLAT_SHADED\n\tvNormal = normalize( transformedNormal );\n#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP )\n\tvViewPosition = - mvPosition.xyz;\n#endif\n}\n";var points_frag="uniform vec3 diffuse;\nuniform float opacity;\n#include <common>\n#include <packing>\n#include <color_pars_fragment>\n#include <map_particle_pars_fragment>\n#include <fog_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec3 outgoingLight = vec3( 0.0 );\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <map_particle_fragment>\n\t#include <color_fragment>\n\t#include <alphatest_fragment>\n\toutgoingLight = diffuseColor.rgb;\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <premultiplied_alpha_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n}\n";var points_vert="uniform float size;\nuniform float scale;\n#include <common>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <color_vertex>\n\t#include <begin_vertex>\n\t#include <project_vertex>\n\t#ifdef USE_SIZEATTENUATION\n\t\tgl_PointSize = size * ( scale / - mvPosition.z );\n\t#else\n\t\tgl_PointSize = size;\n\t#endif\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <worldpos_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}\n";var shadow_frag="uniform vec3 color;\nuniform float opacity;\n#include <common>\n#include <packing>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <lights_pars>\n#include <shadowmap_pars_fragment>\n#include <shadowmask_pars_fragment>\nvoid main() {\n\tgl_FragColor = vec4( color, opacity * ( 1.0 - getShadowMask() ) );\n\t#include <fog_fragment>\n}\n";var shadow_vert="#include <fog_pars_vertex>\n#include <shadowmap_pars_vertex>\nvoid main() {\n\t#include <begin_vertex>\n\t#include <project_vertex>\n\t#include <worldpos_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}\n";var ShaderChunk={alphamap_fragment:alphamap_fragment,alphamap_pars_fragment:alphamap_pars_fragment,alphatest_fragment:alphatest_fragment,aomap_fragment:aomap_fragment,aomap_pars_fragment:aomap_pars_fragment,begin_vertex:begin_vertex,beginnormal_vertex:beginnormal_vertex,bsdfs:bsdfs,bumpmap_pars_fragment:bumpmap_pars_fragment,clipping_planes_fragment:clipping_planes_fragment,clipping_planes_pars_fragment:clipping_planes_pars_fragment,clipping_planes_pars_vertex:clipping_planes_pars_vertex,clipping_planes_vertex:clipping_planes_vertex,color_fragment:color_fragment,color_pars_fragment:color_pars_fragment,color_pars_vertex:color_pars_vertex,color_vertex:color_vertex,common:common,cube_uv_reflection_fragment:cube_uv_reflection_fragment,defaultnormal_vertex:defaultnormal_vertex,displacementmap_pars_vertex:displacementmap_pars_vertex,displacementmap_vertex:displacementmap_vertex,emissivemap_fragment:emissivemap_fragment,emissivemap_pars_fragment:emissivemap_pars_fragment,encodings_fragment:encodings_fragment,encodings_pars_fragment:encodings_pars_fragment,envmap_fragment:envmap_fragment,envmap_pars_fragment:envmap_pars_fragment,envmap_pars_vertex:envmap_pars_vertex,envmap_vertex:envmap_vertex,fog_vertex:fog_vertex,fog_pars_vertex:fog_pars_vertex,fog_fragment:fog_fragment,fog_pars_fragment:fog_pars_fragment,gradientmap_pars_fragment:gradientmap_pars_fragment,lightmap_fragment:lightmap_fragment,lightmap_pars_fragment:lightmap_pars_fragment,lights_lambert_vertex:lights_lambert_vertex,lights_pars:lights_pars,lights_phong_fragment:lights_phong_fragment,lights_phong_pars_fragment:lights_phong_pars_fragment,lights_physical_fragment:lights_physical_fragment,lights_physical_pars_fragment:lights_physical_pars_fragment,lights_template:lights_template,logdepthbuf_fragment:logdepthbuf_fragment,logdepthbuf_pars_fragment:logdepthbuf_pars_fragment,logdepthbuf_pars_vertex:logdepthbuf_pars_vertex,logdepthbuf_vertex:logdepthbuf_vertex,map_fragment:map_fragment,map_pars_fragment:map_pars_fragment,map_particle_fragment:map_particle_fragment,map_particle_pars_fragment:map_particle_pars_fragment,metalnessmap_fragment:metalnessmap_fragment,metalnessmap_pars_fragment:metalnessmap_pars_fragment,morphnormal_vertex:morphnormal_vertex,morphtarget_pars_vertex:morphtarget_pars_vertex,morphtarget_vertex:morphtarget_vertex,normal_fragment:normal_fragment,normalmap_pars_fragment:normalmap_pars_fragment,packing:packing,premultiplied_alpha_fragment:premultiplied_alpha_fragment,project_vertex:project_vertex,dithering_fragment:dithering_fragment,dithering_pars_fragment:dithering_pars_fragment,roughnessmap_fragment:roughnessmap_fragment,roughnessmap_pars_fragment:roughnessmap_pars_fragment,shadowmap_pars_fragment:shadowmap_pars_fragment,shadowmap_pars_vertex:shadowmap_pars_vertex,shadowmap_vertex:shadowmap_vertex,shadowmask_pars_fragment:shadowmask_pars_fragment,skinbase_vertex:skinbase_vertex,skinning_pars_vertex:skinning_pars_vertex,skinning_vertex:skinning_vertex,skinnormal_vertex:skinnormal_vertex,specularmap_fragment:specularmap_fragment,specularmap_pars_fragment:specularmap_pars_fragment,tonemapping_fragment:tonemapping_fragment,tonemapping_pars_fragment:tonemapping_pars_fragment,uv_pars_fragment:uv_pars_fragment,uv_pars_vertex:uv_pars_vertex,uv_vertex:uv_vertex,uv2_pars_fragment:uv2_pars_fragment,uv2_pars_vertex:uv2_pars_vertex,uv2_vertex:uv2_vertex,worldpos_vertex:worldpos_vertex,cube_frag:cube_frag,cube_vert:cube_vert,depth_frag:depth_frag,depth_vert:depth_vert,distanceRGBA_frag:distanceRGBA_frag,distanceRGBA_vert:distanceRGBA_vert,equirect_frag:equirect_frag,equirect_vert:equirect_vert,linedashed_frag:linedashed_frag,linedashed_vert:linedashed_vert,meshbasic_frag:meshbasic_frag,meshbasic_vert:meshbasic_vert,meshlambert_frag:meshlambert_frag,meshlambert_vert:meshlambert_vert,meshphong_frag:meshphong_frag,meshphong_vert:meshphong_vert,meshphysical_frag:meshphysical_frag,meshphysical_vert:meshphysical_vert,normal_frag:normal_frag,normal_vert:normal_vert,points_frag:points_frag,points_vert:points_vert,shadow_frag:shadow_frag,shadow_vert:shadow_vert};/**
   * Uniforms library for shared webgl shaders
   */var UniformsLib={common:{diffuse:{value:new Color$1(0xeeeeee)},opacity:{value:1.0},map:{value:null},uvTransform:{value:new Matrix3$1()},alphaMap:{value:null}},specularmap:{specularMap:{value:null}},envmap:{envMap:{value:null},flipEnvMap:{value:-1},reflectivity:{value:1.0},refractionRatio:{value:0.98}},aomap:{aoMap:{value:null},aoMapIntensity:{value:1}},lightmap:{lightMap:{value:null},lightMapIntensity:{value:1}},emissivemap:{emissiveMap:{value:null}},bumpmap:{bumpMap:{value:null},bumpScale:{value:1}},normalmap:{normalMap:{value:null},normalScale:{value:new Vector2$1(1,1)}},displacementmap:{displacementMap:{value:null},displacementScale:{value:1},displacementBias:{value:0}},roughnessmap:{roughnessMap:{value:null}},metalnessmap:{metalnessMap:{value:null}},gradientmap:{gradientMap:{value:null}},fog:{fogDensity:{value:0.00025},fogNear:{value:1},fogFar:{value:2000},fogColor:{value:new Color$1(0xffffff)}},lights:{ambientLightColor:{value:[]},directionalLights:{value:[],properties:{direction:{},color:{},shadow:{},shadowBias:{},shadowRadius:{},shadowMapSize:{}}},directionalShadowMap:{value:[]},directionalShadowMatrix:{value:[]},spotLights:{value:[],properties:{color:{},position:{},direction:{},distance:{},coneCos:{},penumbraCos:{},decay:{},shadow:{},shadowBias:{},shadowRadius:{},shadowMapSize:{}}},spotShadowMap:{value:[]},spotShadowMatrix:{value:[]},pointLights:{value:[],properties:{color:{},position:{},decay:{},distance:{},shadow:{},shadowBias:{},shadowRadius:{},shadowMapSize:{},shadowCameraNear:{},shadowCameraFar:{}}},pointShadowMap:{value:[]},pointShadowMatrix:{value:[]},hemisphereLights:{value:[],properties:{direction:{},skyColor:{},groundColor:{}}},// TODO (abelnation): RectAreaLight BRDF data needs to be moved from example to main src
  rectAreaLights:{value:[],properties:{color:{},position:{},width:{},height:{}}}},points:{diffuse:{value:new Color$1(0xeeeeee)},opacity:{value:1.0},size:{value:1.0},scale:{value:1.0},map:{value:null},uvTransform:{value:new Matrix3$1()}}};/**
   * @author alteredq / http://alteredqualia.com/
   * @author mrdoob / http://mrdoob.com/
   * @author mikael emtinger / http://gomo.se/
   */var ShaderLib={basic:{uniforms:UniformsUtils.merge([UniformsLib.common,UniformsLib.specularmap,UniformsLib.envmap,UniformsLib.aomap,UniformsLib.lightmap,UniformsLib.fog]),vertexShader:ShaderChunk.meshbasic_vert,fragmentShader:ShaderChunk.meshbasic_frag},lambert:{uniforms:UniformsUtils.merge([UniformsLib.common,UniformsLib.specularmap,UniformsLib.envmap,UniformsLib.aomap,UniformsLib.lightmap,UniformsLib.emissivemap,UniformsLib.fog,UniformsLib.lights,{emissive:{value:new Color$1(0x000000)}}]),vertexShader:ShaderChunk.meshlambert_vert,fragmentShader:ShaderChunk.meshlambert_frag},phong:{uniforms:UniformsUtils.merge([UniformsLib.common,UniformsLib.specularmap,UniformsLib.envmap,UniformsLib.aomap,UniformsLib.lightmap,UniformsLib.emissivemap,UniformsLib.bumpmap,UniformsLib.normalmap,UniformsLib.displacementmap,UniformsLib.gradientmap,UniformsLib.fog,UniformsLib.lights,{emissive:{value:new Color$1(0x000000)},specular:{value:new Color$1(0x111111)},shininess:{value:30}}]),vertexShader:ShaderChunk.meshphong_vert,fragmentShader:ShaderChunk.meshphong_frag},standard:{uniforms:UniformsUtils.merge([UniformsLib.common,UniformsLib.envmap,UniformsLib.aomap,UniformsLib.lightmap,UniformsLib.emissivemap,UniformsLib.bumpmap,UniformsLib.normalmap,UniformsLib.displacementmap,UniformsLib.roughnessmap,UniformsLib.metalnessmap,UniformsLib.fog,UniformsLib.lights,{emissive:{value:new Color$1(0x000000)},roughness:{value:0.5},metalness:{value:0.5},envMapIntensity:{value:1// temporary
  }}]),vertexShader:ShaderChunk.meshphysical_vert,fragmentShader:ShaderChunk.meshphysical_frag},points:{uniforms:UniformsUtils.merge([UniformsLib.points,UniformsLib.fog]),vertexShader:ShaderChunk.points_vert,fragmentShader:ShaderChunk.points_frag},dashed:{uniforms:UniformsUtils.merge([UniformsLib.common,UniformsLib.fog,{scale:{value:1},dashSize:{value:1},totalSize:{value:2}}]),vertexShader:ShaderChunk.linedashed_vert,fragmentShader:ShaderChunk.linedashed_frag},depth:{uniforms:UniformsUtils.merge([UniformsLib.common,UniformsLib.displacementmap]),vertexShader:ShaderChunk.depth_vert,fragmentShader:ShaderChunk.depth_frag},normal:{uniforms:UniformsUtils.merge([UniformsLib.common,UniformsLib.bumpmap,UniformsLib.normalmap,UniformsLib.displacementmap,{opacity:{value:1.0}}]),vertexShader:ShaderChunk.normal_vert,fragmentShader:ShaderChunk.normal_frag},/* -------------------------------------------------------------------------
  	//	Cube map shader
  	 ------------------------------------------------------------------------- */cube:{uniforms:{tCube:{value:null},tFlip:{value:-1},opacity:{value:1.0}},vertexShader:ShaderChunk.cube_vert,fragmentShader:ShaderChunk.cube_frag},equirect:{uniforms:{tEquirect:{value:null}},vertexShader:ShaderChunk.equirect_vert,fragmentShader:ShaderChunk.equirect_frag},distanceRGBA:{uniforms:UniformsUtils.merge([UniformsLib.common,UniformsLib.displacementmap,{referencePosition:{value:new Vector3$1()},nearDistance:{value:1},farDistance:{value:1000}}]),vertexShader:ShaderChunk.distanceRGBA_vert,fragmentShader:ShaderChunk.distanceRGBA_frag},shadow:{uniforms:UniformsUtils.merge([UniformsLib.lights,UniformsLib.fog,{color:{value:new Color$1(0x00000)},opacity:{value:1.0}}]),vertexShader:ShaderChunk.shadow_vert,fragmentShader:ShaderChunk.shadow_frag}};ShaderLib.physical={uniforms:UniformsUtils.merge([ShaderLib.standard.uniforms,{clearCoat:{value:0},clearCoatRoughness:{value:0}}]),vertexShader:ShaderChunk.meshphysical_vert,fragmentShader:ShaderChunk.meshphysical_frag};/**
   * @author takahirox / http://github.com/takahirox/
   *
   * Reference: https://en.wikipedia.org/wiki/Cel_shading
   *
   * // How to set default outline parameters
   * new OutlineEffect( renderer, {
   * 	defaultThickNess: 0.01,
   * 	defaultColor: new Color( 0x888888 ),
   * 	defaultAlpha: 0.8,
   * 	defaultKeepAlive: true // keeps outline material in cache even if material is removed from scene
   * } );
   *
   * // How to set outline parameters for each material
   * material.outlineParameters = {
   * 	thickNess: 0.01,
   * 	color: new Color( 0x888888 ),
   * 	alpha: 0.8,
   * 	visible: true,
   * 	keepAlive: true
   * };
   *
   * TODO
   *  - support shader material without objectNormal in its vertexShader
   */var StereoEffect=function StereoEffect(renderer){var _stereo=new StereoCamera();_stereo.aspect=0.5;this.setEyeSeparation=function(eyeSep){_stereo.eyeSep=eyeSep;};this.setSize=function(width,height){renderer.setSize(width,height);};this.render=function(scene,camera){scene.updateMatrixWorld();if(camera.parent===null){camera.updateMatrixWorld();}_stereo.update(camera);var size=renderer.getSize();if(renderer.autoClear){renderer.clear();}renderer.setScissorTest(true);renderer.setScissor(0,0,size.width/2,size.height);renderer.setViewport(0,0,size.width/2,size.height);renderer.render(scene,_stereo.cameraL);renderer.setScissor(size.width/2,0,size.width/2,size.height);renderer.setViewport(size.width/2,0,size.width/2,size.height);renderer.render(scene,_stereo.cameraR);renderer.setScissorTest(false);};};/**
   * @author dmarcos / https://github.com/dmarcos
   * @author mrdoob / http://mrdoob.com
   *
   * WebVR Spec: http://mozvr.github.io/webvr-spec/webvr.html
   *
   * Firefox: http://mozvr.com/downloads/
   * Chromium: https://webvr.info/get-chrome
   */function LineSegments(geometry,material){Line$1.call(this,geometry,material);this.type='LineSegments';}LineSegments.prototype=Object.assign(Object.create(Line$1.prototype),{constructor:LineSegments,isLineSegments:true});/**
   * @author mgreter / http://github.com/mgreter
   */function LineLoop(geometry,material){Line$1.call(this,geometry,material);this.type='LineLoop';}LineLoop.prototype=Object.assign(Object.create(Line$1.prototype),{constructor:LineLoop,isLineLoop:true});/**
   * @author alteredq / http://alteredqualia.com/
   */function Points(geometry,material){Object3D.call(this);this.type='Points';this.geometry=geometry!==undefined?geometry:new BufferGeometry();this.material=material!==undefined?material:new PointsMaterial({color:Math.random()*0xffffff});}Points.prototype=Object.assign(Object.create(Object3D.prototype),{constructor:Points,isPoints:true,raycast:function(){var inverseMatrix=new Matrix4();var ray=new Ray();var sphere=new Sphere();return function raycast(raycaster,intersects){var object=this;var geometry=this.geometry;var matrixWorld=this.matrixWorld;var threshold=raycaster.params.Points.threshold;// Checking boundingSphere distance to ray
  if(geometry.boundingSphere===null){geometry.computeBoundingSphere();}sphere.copy(geometry.boundingSphere);sphere.applyMatrix4(matrixWorld);sphere.radius+=threshold;if(raycaster.ray.intersectsSphere(sphere)===false){return;}//
  inverseMatrix.getInverse(matrixWorld);ray.copy(raycaster.ray).applyMatrix4(inverseMatrix);var localThreshold=threshold/((this.scale.x+this.scale.y+this.scale.z)/3);var localThresholdSq=localThreshold*localThreshold;var position=new Vector3$1();function testPoint(point,index){var rayPointDistanceSq=ray.distanceSqToPoint(point);if(rayPointDistanceSq<localThresholdSq){var intersectPoint=ray.closestPointToPoint(point);intersectPoint.applyMatrix4(matrixWorld);var distance=raycaster.ray.origin.distanceTo(intersectPoint);if(distance<raycaster.near||distance>raycaster.far){return;}intersects.push({distance:distance,distanceToRay:Math.sqrt(rayPointDistanceSq),point:intersectPoint.clone(),index:index,face:null,object:object});}}if(geometry.isBufferGeometry){var index=geometry.index;var attributes=geometry.attributes;var positions=attributes.position.array;if(index!==null){var indices=index.array;for(var i=0,il=indices.length;i<il;i++){var a=indices[i];position.fromArray(positions,a*3);testPoint(position,a);}}else{for(var i=0,l=positions.length/3;i<l;i++){position.fromArray(positions,i*3);testPoint(position,i);}}}else{var vertices=geometry.vertices;for(var i=0,l=vertices.length;i<l;i++){testPoint(vertices[i],i);}}};}(),clone:function clone(){return new this.constructor(this.geometry,this.material).copy(this);}});/**
   * @author mrdoob / http://mrdoob.com/
   * @author alteredq / http://alteredqualia.com/
   */function Light(color,intensity){Object3D.call(this);this.type='Light';this.color=new Color$1(color);this.intensity=intensity!==undefined?intensity:1;this.receiveShadow=undefined;}Light.prototype=Object.assign(Object.create(Object3D.prototype),{constructor:Light,isLight:true,copy:function copy(source){Object3D.prototype.copy.call(this,source);this.color.copy(source.color);this.intensity=source.intensity;return this;},toJSON:function toJSON(meta){var data=Object3D.prototype.toJSON.call(this,meta);data.object.color=this.color.getHex();data.object.intensity=this.intensity;if(this.groundColor!==undefined){data.object.groundColor=this.groundColor.getHex();}if(this.distance!==undefined){data.object.distance=this.distance;}if(this.angle!==undefined){data.object.angle=this.angle;}if(this.decay!==undefined){data.object.decay=this.decay;}if(this.penumbra!==undefined){data.object.penumbra=this.penumbra;}if(this.shadow!==undefined){data.object.shadow=this.shadow.toJSON();}return data;}});/**
   * @author mikael emtinger / http://gomo.se/
   * @author alteredq / http://alteredqualia.com/
   * @author michael guerrero / http://realitymeltdown.com
   * @author ikerr / http://verold.com
   */function Skeleton$1(bones,boneInverses){var this$1=this;// copy the bone array
  bones=bones||[];this.bones=bones.slice(0);this.boneMatrices=new Float32Array(this.bones.length*16);// use the supplied bone inverses or calculate the inverses
  if(boneInverses===undefined){this.calculateInverses();}else{if(this.bones.length===boneInverses.length){this.boneInverses=boneInverses.slice(0);}else{console.warn('THREE.Skeleton boneInverses is the wrong length.');this.boneInverses=[];for(var i=0,il=this.bones.length;i<il;i++){this$1.boneInverses.push(new Matrix4());}}}}Object.assign(Skeleton$1.prototype,{calculateInverses:function calculateInverses(){var this$1=this;this.boneInverses=[];for(var i=0,il=this.bones.length;i<il;i++){var inverse=new Matrix4();if(this$1.bones[i]){inverse.getInverse(this$1.bones[i].matrixWorld);}this$1.boneInverses.push(inverse);}},pose:function pose(){var this$1=this;var bone,i,il;// recover the bind-time world matrices
  for(i=0, il=this.bones.length;i<il;i++){bone=this$1.bones[i];if(bone){bone.matrixWorld.getInverse(this$1.boneInverses[i]);}}// compute the local matrices, positions, rotations and scales
  for(i=0, il=this.bones.length;i<il;i++){bone=this$1.bones[i];if(bone){if(bone.parent&&bone.parent.isBone){bone.matrix.getInverse(bone.parent.matrixWorld);bone.matrix.multiply(bone.matrixWorld);}else{bone.matrix.copy(bone.matrixWorld);}bone.matrix.decompose(bone.position,bone.quaternion,bone.scale);}}},update:function(){var offsetMatrix=new Matrix4();var identityMatrix=new Matrix4();return function update(){var bones=this.bones;var boneInverses=this.boneInverses;var boneMatrices=this.boneMatrices;var boneTexture=this.boneTexture;// flatten bone matrices to array
  for(var i=0,il=bones.length;i<il;i++){// compute the offset between the current and the original transform
  var matrix=bones[i]?bones[i].matrixWorld:identityMatrix;offsetMatrix.multiplyMatrices(matrix,boneInverses[i]);offsetMatrix.toArray(boneMatrices,i*16);}if(boneTexture!==undefined){boneTexture.needsUpdate=true;}};}(),clone:function clone(){return new Skeleton$1(this.bones,this.boneInverses);}});/**
   * @author mikael emtinger / http://gomo.se/
   * @author alteredq / http://alteredqualia.com/
   * @author ikerr / http://verold.com
   */function SkinnedMesh(geometry,material){Mesh.call(this,geometry,material);this.type='SkinnedMesh';this.bindMode='attached';this.bindMatrix=new Matrix4();this.bindMatrixInverse=new Matrix4();var bones=this.initBones();var skeleton=new Skeleton$1(bones);this.bind(skeleton,this.matrixWorld);this.normalizeSkinWeights();}SkinnedMesh.prototype=Object.assign(Object.create(Mesh.prototype),{constructor:SkinnedMesh,isSkinnedMesh:true,initBones:function initBones(){var this$1=this;var bones=[],bone,gbone;var i,il;if(this.geometry&&this.geometry.bones!==undefined){// first, create array of 'Bone' objects from geometry data
  for(i=0, il=this.geometry.bones.length;i<il;i++){gbone=this$1.geometry.bones[i];// create new 'Bone' object
  bone=new Bone$1();bones.push(bone);// apply values
  bone.name=gbone.name;bone.position.fromArray(gbone.pos);bone.quaternion.fromArray(gbone.rotq);if(gbone.scl!==undefined){bone.scale.fromArray(gbone.scl);}}// second, create bone hierarchy
  for(i=0, il=this.geometry.bones.length;i<il;i++){gbone=this$1.geometry.bones[i];if(gbone.parent!==-1&&gbone.parent!==null&&bones[gbone.parent]!==undefined){// subsequent bones in the hierarchy
  bones[gbone.parent].add(bones[i]);}else{// topmost bone, immediate child of the skinned mesh
  this$1.add(bones[i]);}}}// now the bones are part of the scene graph and children of the skinned mesh.
  // let's update the corresponding matrices
  this.updateMatrixWorld(true);return bones;},bind:function bind(skeleton,bindMatrix){this.skeleton=skeleton;if(bindMatrix===undefined){this.updateMatrixWorld(true);this.skeleton.calculateInverses();bindMatrix=this.matrixWorld;}this.bindMatrix.copy(bindMatrix);this.bindMatrixInverse.getInverse(bindMatrix);},pose:function pose(){this.skeleton.pose();},normalizeSkinWeights:function normalizeSkinWeights(){var this$1=this;var scale,i;if(this.geometry&&this.geometry.isGeometry){for(i=0;i<this.geometry.skinWeights.length;i++){var sw=this$1.geometry.skinWeights[i];scale=1.0/sw.manhattanLength();if(scale!==Infinity){sw.multiplyScalar(scale);}else{sw.set(1,0,0,0);// do something reasonable
  }}}else if(this.geometry&&this.geometry.isBufferGeometry){var vec=new Vector4$1();var skinWeight=this.geometry.attributes.skinWeight;for(i=0;i<skinWeight.count;i++){vec.x=skinWeight.getX(i);vec.y=skinWeight.getY(i);vec.z=skinWeight.getZ(i);vec.w=skinWeight.getW(i);scale=1.0/vec.manhattanLength();if(scale!==Infinity){vec.multiplyScalar(scale);}else{vec.set(1,0,0,0);// do something reasonable
  }skinWeight.setXYZW(i,vec.x,vec.y,vec.z,vec.w);}}},updateMatrixWorld:function updateMatrixWorld(force){Mesh.prototype.updateMatrixWorld.call(this,force);if(this.bindMode==='attached'){this.bindMatrixInverse.getInverse(this.matrixWorld);}else if(this.bindMode==='detached'){this.bindMatrixInverse.getInverse(this.bindMatrix);}else{console.warn('THREE.SkinnedMesh: Unrecognized bindMode: '+this.bindMode);}},clone:function clone(){return new this.constructor(this.geometry,this.material).copy(this);}});/**
   * @author fernandojsg / http://fernandojsg.com
   */var STLBinaryExporter=function STLBinaryExporter(){};STLBinaryExporter.prototype={constructor:STLBinaryExporter,parse:function(){var vector=new Vector3$1();var normalMatrixWorld=new Matrix3$1();return function parse(scene){// We collect objects first, as we may need to convert from BufferGeometry to Geometry
  var objects=[];var triangles=0;scene.traverse(function(object){if(!(object instanceof Mesh)){return;}var geometry=object.geometry;if(geometry instanceof BufferGeometry){geometry=new Geometry().fromBufferGeometry(geometry);}if(!(geometry instanceof Geometry)){return;}triangles+=geometry.faces.length;objects.push({geometry:geometry,matrix:object.matrixWorld});});var offset=80;// skip header
  var bufferLength=triangles*2+triangles*3*4*4+80+4;var arrayBuffer=new ArrayBuffer(bufferLength);var output=new DataView(arrayBuffer);output.setUint32(offset,triangles,true);offset+=4;// Traversing our collected objects
  objects.forEach(function(object){var vertices=object.geometry.vertices;var faces=object.geometry.faces;normalMatrixWorld.getNormalMatrix(object.matrix);for(var i=0,l=faces.length;i<l;i++){var face=faces[i];vector.copy(face.normal).applyMatrix3(normalMatrixWorld).normalize();output.setFloat32(offset,vector.x,true);offset+=4;// normal
  output.setFloat32(offset,vector.y,true);offset+=4;output.setFloat32(offset,vector.z,true);offset+=4;var indices=[face.a,face.b,face.c];for(var j=0;j<3;j++){vector.copy(vertices[indices[j]]).applyMatrix4(object.matrix);output.setFloat32(offset,vector.x,true);offset+=4;// vertices
  output.setFloat32(offset,vector.y,true);offset+=4;output.setFloat32(offset,vector.z,true);offset+=4;}output.setUint16(offset,0,true);offset+=2;// attribute byte count
  }});return output;};}()};/**
   * @author kovacsv / http://kovacsv.hu/
   * @author mrdoob / http://mrdoob.com/
   */var STLExporter=function STLExporter(){};STLExporter.prototype={constructor:STLExporter,parse:function(){var vector=new Vector3$1();var normalMatrixWorld=new Matrix3$1();return function parse(scene){var output='';output+='solid exported\n';scene.traverse(function(object){if(object instanceof Mesh){var geometry=object.geometry;var matrixWorld=object.matrixWorld;if(geometry instanceof BufferGeometry){geometry=new Geometry().fromBufferGeometry(geometry);}if(geometry instanceof Geometry){var vertices=geometry.vertices;var faces=geometry.faces;normalMatrixWorld.getNormalMatrix(matrixWorld);for(var i=0,l=faces.length;i<l;i++){var face=faces[i];vector.copy(face.normal).applyMatrix3(normalMatrixWorld).normalize();output+='\tfacet normal '+vector.x+' '+vector.y+' '+vector.z+'\n';output+='\t\touter loop\n';var indices=[face.a,face.b,face.c];for(var j=0;j<3;j++){vector.copy(vertices[indices[j]]).applyMatrix4(matrixWorld);output+='\t\t\tvertex '+vector.x+' '+vector.y+' '+vector.z+'\n';}output+='\t\tendloop\n';output+='\tendfacet\n';}}}});output+='endsolid exported\n';return output;};}()};/**
   * @author mrdoob / http://mrdoob.com/
   */function DecalGeometry(mesh,position,orientation,size){BufferGeometry.call(this);this.type='DecalGeometry';// buffers
  var vertices=[];var normals=[];var uvs=[];// helpers
  var plane=new Vector3$1();// this matrix represents the transformation of the decal projector
  var projectorMatrix=new Matrix4();projectorMatrix.makeRotationFromEuler(orientation);projectorMatrix.setPosition(position);var projectorMatrixInverse=new Matrix4().getInverse(projectorMatrix);// generate buffers
  generate();// build geometry
  this.addAttribute('position',new Float32BufferAttribute(vertices,3));this.addAttribute('normal',new Float32BufferAttribute(normals,3));this.addAttribute('uv',new Float32BufferAttribute(uvs,2));function generate(){var i;var geometry=new BufferGeometry();var decalVertices=[];var vertex=new Vector3$1();var normal=new Vector3$1();// handle different geometry types
  if(mesh.geometry.isGeometry){geometry.fromGeometry(mesh.geometry);}else{geometry.copy(mesh.geometry);}var positionAttribute=geometry.attributes.position;var normalAttribute=geometry.attributes.normal;// first, create an array of 'DecalVertex' objects
  // three consecutive 'DecalVertex' objects represent a single face
  //
  // this data structure will be later used to perform the clipping
  if(geometry.index!==null){// indexed BufferGeometry
  var index=geometry.index;for(i=0;i<index.count;i++){vertex.fromBufferAttribute(positionAttribute,index.getX(i));normal.fromBufferAttribute(normalAttribute,index.getX(i));pushDecalVertex(decalVertices,vertex,normal);}}else{// non-indexed BufferGeometry
  for(i=0;i<positionAttribute.count;i++){vertex.fromBufferAttribute(positionAttribute,i);normal.fromBufferAttribute(normalAttribute,i);pushDecalVertex(decalVertices,vertex,normal);}}// second, clip the geometry so that it doesn't extend out from the projector
  decalVertices=clipGeometry(decalVertices,plane.set(1,0,0));decalVertices=clipGeometry(decalVertices,plane.set(-1,0,0));decalVertices=clipGeometry(decalVertices,plane.set(0,1,0));decalVertices=clipGeometry(decalVertices,plane.set(0,-1,0));decalVertices=clipGeometry(decalVertices,plane.set(0,0,1));decalVertices=clipGeometry(decalVertices,plane.set(0,0,-1));// third, generate final vertices, normals and uvs
  for(i=0;i<decalVertices.length;i++){var decalVertex=decalVertices[i];// create texture coordinates (we are still in projector space)
  uvs.push(0.5+decalVertex.position.x/size.x,0.5+decalVertex.position.y/size.y);// transform the vertex back to world space
  decalVertex.position.applyMatrix4(projectorMatrix);// now create vertex and normal buffer data
  vertices.push(decalVertex.position.x,decalVertex.position.y,decalVertex.position.z);normals.push(decalVertex.normal.x,decalVertex.normal.y,decalVertex.normal.z);}}function pushDecalVertex(decalVertices,vertex,normal){// transform the vertex to world space, then to projector space
  vertex.applyMatrix4(mesh.matrix);vertex.applyMatrix4(projectorMatrixInverse);decalVertices.push(new DecalVertex(vertex.clone(),normal.clone()));}function clipGeometry(inVertices,plane){var outVertices=[];var s=0.5*Math.abs(size.dot(plane));// a single iteration clips one face,
  // which consists of three consecutive 'DecalVertex' objects
  for(var i=0;i<inVertices.length;i+=3){var v1Out,v2Out,v3Out,total=0;var nV1,nV2,nV3,nV4;var d1=inVertices[i+0].position.dot(plane)-s;var d2=inVertices[i+1].position.dot(plane)-s;var d3=inVertices[i+2].position.dot(plane)-s;v1Out=d1>0;v2Out=d2>0;v3Out=d3>0;// calculate, how many vertices of the face lie outside of the clipping plane
  total=(v1Out?1:0)+(v2Out?1:0)+(v3Out?1:0);switch(total){case 0:{// the entire face lies inside of the plane, no clipping needed
  outVertices.push(inVertices[i]);outVertices.push(inVertices[i+1]);outVertices.push(inVertices[i+2]);break;}case 1:{// one vertex lies outside of the plane, perform clipping
  if(v1Out){nV1=inVertices[i+1];nV2=inVertices[i+2];nV3=clip(inVertices[i],nV1,plane,s);nV4=clip(inVertices[i],nV2,plane,s);}if(v2Out){nV1=inVertices[i];nV2=inVertices[i+2];nV3=clip(inVertices[i+1],nV1,plane,s);nV4=clip(inVertices[i+1],nV2,plane,s);outVertices.push(nV3);outVertices.push(nV2.clone());outVertices.push(nV1.clone());outVertices.push(nV2.clone());outVertices.push(nV3.clone());outVertices.push(nV4);break;}if(v3Out){nV1=inVertices[i];nV2=inVertices[i+1];nV3=clip(inVertices[i+2],nV1,plane,s);nV4=clip(inVertices[i+2],nV2,plane,s);}outVertices.push(nV1.clone());outVertices.push(nV2.clone());outVertices.push(nV3);outVertices.push(nV4);outVertices.push(nV3.clone());outVertices.push(nV2.clone());break;}case 2:{// two vertices lies outside of the plane, perform clipping
  if(!v1Out){nV1=inVertices[i].clone();nV2=clip(nV1,inVertices[i+1],plane,s);nV3=clip(nV1,inVertices[i+2],plane,s);outVertices.push(nV1);outVertices.push(nV2);outVertices.push(nV3);}if(!v2Out){nV1=inVertices[i+1].clone();nV2=clip(nV1,inVertices[i+2],plane,s);nV3=clip(nV1,inVertices[i],plane,s);outVertices.push(nV1);outVertices.push(nV2);outVertices.push(nV3);}if(!v3Out){nV1=inVertices[i+2].clone();nV2=clip(nV1,inVertices[i],plane,s);nV3=clip(nV1,inVertices[i+1],plane,s);outVertices.push(nV1);outVertices.push(nV2);outVertices.push(nV3);}break;}case 3:{// the entire face lies outside of the plane, so let's discard the corresponding vertices
  break;}}}return outVertices;}function clip(v0,v1,p,s){var d0=v0.position.dot(p)-s;var d1=v1.position.dot(p)-s;var s0=d0/(d0-d1);var v=new DecalVertex(new Vector3$1(v0.position.x+s0*(v1.position.x-v0.position.x),v0.position.y+s0*(v1.position.y-v0.position.y),v0.position.z+s0*(v1.position.z-v0.position.z)),new Vector3$1(v0.normal.x+s0*(v1.normal.x-v0.normal.x),v0.normal.y+s0*(v1.normal.y-v0.normal.y),v0.normal.z+s0*(v1.normal.z-v0.normal.z)));// need to clip more values (texture coordinates)? do it this way:
  // intersectpoint.value = a.value + s * ( b.value - a.value );
  return v;}}DecalGeometry.prototype=Object.create(BufferGeometry.prototype);DecalGeometry.prototype.constructor=DecalGeometry;// helper
  function DecalVertex(position,normal){this.position=position;this.normal=normal;}DecalVertex.prototype.clone=function(){return new DecalVertex(this.position.clone(),this.normal.clone());};/**
   * Hilbert Curve: Generates 2D-Coordinates in a very fast way.
   *
   * @author Dylan Grafmyre
   *
   * Based on work by:
   * @author Thomas Diewald
   * @link http://www.openprocessing.org/sketch/15493
   *
   * @param center     Center of Hilbert curve.
   * @param size       Total width of Hilbert curve.
   * @param iterations Number of subdivisions.
   * @param v0         Corner index -X, -Z.
   * @param v1         Corner index -X, +Z.
   * @param v2         Corner index +X, +Z.
   * @param v3         Corner index +X, -Z.
   *//*global THREE */var TeapotBufferGeometry=function TeapotBufferGeometry(size,segments,bottom,lid,body,fitLid,blinn){var teapotPatches=[/*rim*/0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,3,16,17,18,7,19,20,21,11,22,23,24,15,25,26,27,18,28,29,30,21,31,32,33,24,34,35,36,27,37,38,39,30,40,41,0,33,42,43,4,36,44,45,8,39,46,47,12,/*body*/12,13,14,15,48,49,50,51,52,53,54,55,56,57,58,59,15,25,26,27,51,60,61,62,55,63,64,65,59,66,67,68,27,37,38,39,62,69,70,71,65,72,73,74,68,75,76,77,39,46,47,12,71,78,79,48,74,80,81,52,77,82,83,56,56,57,58,59,84,85,86,87,88,89,90,91,92,93,94,95,59,66,67,68,87,96,97,98,91,99,100,101,95,102,103,104,68,75,76,77,98,105,106,107,101,108,109,110,104,111,112,113,77,82,83,56,107,114,115,84,110,116,117,88,113,118,119,92,/*handle*/120,121,122,123,124,125,126,127,128,129,130,131,132,133,134,135,123,136,137,120,127,138,139,124,131,140,141,128,135,142,143,132,132,133,134,135,144,145,146,147,148,149,150,151,68,152,153,154,135,142,143,132,147,155,156,144,151,157,158,148,154,159,160,68,/*spout*/161,162,163,164,165,166,167,168,169,170,171,172,173,174,175,176,164,177,178,161,168,179,180,165,172,181,182,169,176,183,184,173,173,174,175,176,185,186,187,188,189,190,191,192,193,194,195,196,176,183,184,173,188,197,198,185,192,199,200,189,196,201,202,193,/*lid*/203,203,203,203,204,205,206,207,208,208,208,208,209,210,211,212,203,203,203,203,207,213,214,215,208,208,208,208,212,216,217,218,203,203,203,203,215,219,220,221,208,208,208,208,218,222,223,224,203,203,203,203,221,225,226,204,208,208,208,208,224,227,228,209,209,210,211,212,229,230,231,232,233,234,235,236,237,238,239,240,212,216,217,218,232,241,242,243,236,244,245,246,240,247,248,249,218,222,223,224,243,250,251,252,246,253,254,255,249,256,257,258,224,227,228,209,252,259,260,229,255,261,262,233,258,263,264,237,/*bottom*/265,265,265,265,266,267,268,269,270,271,272,273,92,119,118,113,265,265,265,265,269,274,275,276,273,277,278,279,113,112,111,104,265,265,265,265,276,280,281,282,279,283,284,285,104,103,102,95,265,265,265,265,282,286,287,266,285,288,289,270,95,94,93,92];var teapotVertices=[1.4,0,2.4,1.4,-0.784,2.4,0.784,-1.4,2.4,0,-1.4,2.4,1.3375,0,2.53125,1.3375,-0.749,2.53125,0.749,-1.3375,2.53125,0,-1.3375,2.53125,1.4375,0,2.53125,1.4375,-0.805,2.53125,0.805,-1.4375,2.53125,0,-1.4375,2.53125,1.5,0,2.4,1.5,-0.84,2.4,0.84,-1.5,2.4,0,-1.5,2.4,-0.784,-1.4,2.4,-1.4,-0.784,2.4,-1.4,0,2.4,-0.749,-1.3375,2.53125,-1.3375,-0.749,2.53125,-1.3375,0,2.53125,-0.805,-1.4375,2.53125,-1.4375,-0.805,2.53125,-1.4375,0,2.53125,-0.84,-1.5,2.4,-1.5,-0.84,2.4,-1.5,0,2.4,-1.4,0.784,2.4,-0.784,1.4,2.4,0,1.4,2.4,-1.3375,0.749,2.53125,-0.749,1.3375,2.53125,0,1.3375,2.53125,-1.4375,0.805,2.53125,-0.805,1.4375,2.53125,0,1.4375,2.53125,-1.5,0.84,2.4,-0.84,1.5,2.4,0,1.5,2.4,0.784,1.4,2.4,1.4,0.784,2.4,0.749,1.3375,2.53125,1.3375,0.749,2.53125,0.805,1.4375,2.53125,1.4375,0.805,2.53125,0.84,1.5,2.4,1.5,0.84,2.4,1.75,0,1.875,1.75,-0.98,1.875,0.98,-1.75,1.875,0,-1.75,1.875,2,0,1.35,2,-1.12,1.35,1.12,-2,1.35,0,-2,1.35,2,0,0.9,2,-1.12,0.9,1.12,-2,0.9,0,-2,0.9,-0.98,-1.75,1.875,-1.75,-0.98,1.875,-1.75,0,1.875,-1.12,-2,1.35,-2,-1.12,1.35,-2,0,1.35,-1.12,-2,0.9,-2,-1.12,0.9,-2,0,0.9,-1.75,0.98,1.875,-0.98,1.75,1.875,0,1.75,1.875,-2,1.12,1.35,-1.12,2,1.35,0,2,1.35,-2,1.12,0.9,-1.12,2,0.9,0,2,0.9,0.98,1.75,1.875,1.75,0.98,1.875,1.12,2,1.35,2,1.12,1.35,1.12,2,0.9,2,1.12,0.9,2,0,0.45,2,-1.12,0.45,1.12,-2,0.45,0,-2,0.45,1.5,0,0.225,1.5,-0.84,0.225,0.84,-1.5,0.225,0,-1.5,0.225,1.5,0,0.15,1.5,-0.84,0.15,0.84,-1.5,0.15,0,-1.5,0.15,-1.12,-2,0.45,-2,-1.12,0.45,-2,0,0.45,-0.84,-1.5,0.225,-1.5,-0.84,0.225,-1.5,0,0.225,-0.84,-1.5,0.15,-1.5,-0.84,0.15,-1.5,0,0.15,-2,1.12,0.45,-1.12,2,0.45,0,2,0.45,-1.5,0.84,0.225,-0.84,1.5,0.225,0,1.5,0.225,-1.5,0.84,0.15,-0.84,1.5,0.15,0,1.5,0.15,1.12,2,0.45,2,1.12,0.45,0.84,1.5,0.225,1.5,0.84,0.225,0.84,1.5,0.15,1.5,0.84,0.15,-1.6,0,2.025,-1.6,-0.3,2.025,-1.5,-0.3,2.25,-1.5,0,2.25,-2.3,0,2.025,-2.3,-0.3,2.025,-2.5,-0.3,2.25,-2.5,0,2.25,-2.7,0,2.025,-2.7,-0.3,2.025,-3,-0.3,2.25,-3,0,2.25,-2.7,0,1.8,-2.7,-0.3,1.8,-3,-0.3,1.8,-3,0,1.8,-1.5,0.3,2.25,-1.6,0.3,2.025,-2.5,0.3,2.25,-2.3,0.3,2.025,-3,0.3,2.25,-2.7,0.3,2.025,-3,0.3,1.8,-2.7,0.3,1.8,-2.7,0,1.575,-2.7,-0.3,1.575,-3,-0.3,1.35,-3,0,1.35,-2.5,0,1.125,-2.5,-0.3,1.125,-2.65,-0.3,0.9375,-2.65,0,0.9375,-2,-0.3,0.9,-1.9,-0.3,0.6,-1.9,0,0.6,-3,0.3,1.35,-2.7,0.3,1.575,-2.65,0.3,0.9375,-2.5,0.3,1.125,-1.9,0.3,0.6,-2,0.3,0.9,1.7,0,1.425,1.7,-0.66,1.425,1.7,-0.66,0.6,1.7,0,0.6,2.6,0,1.425,2.6,-0.66,1.425,3.1,-0.66,0.825,3.1,0,0.825,2.3,0,2.1,2.3,-0.25,2.1,2.4,-0.25,2.025,2.4,0,2.025,2.7,0,2.4,2.7,-0.25,2.4,3.3,-0.25,2.4,3.3,0,2.4,1.7,0.66,0.6,1.7,0.66,1.425,3.1,0.66,0.825,2.6,0.66,1.425,2.4,0.25,2.025,2.3,0.25,2.1,3.3,0.25,2.4,2.7,0.25,2.4,2.8,0,2.475,2.8,-0.25,2.475,3.525,-0.25,2.49375,3.525,0,2.49375,2.9,0,2.475,2.9,-0.15,2.475,3.45,-0.15,2.5125,3.45,0,2.5125,2.8,0,2.4,2.8,-0.15,2.4,3.2,-0.15,2.4,3.2,0,2.4,3.525,0.25,2.49375,2.8,0.25,2.475,3.45,0.15,2.5125,2.9,0.15,2.475,3.2,0.15,2.4,2.8,0.15,2.4,0,0,3.15,0.8,0,3.15,0.8,-0.45,3.15,0.45,-0.8,3.15,0,-0.8,3.15,0,0,2.85,0.2,0,2.7,0.2,-0.112,2.7,0.112,-0.2,2.7,0,-0.2,2.7,-0.45,-0.8,3.15,-0.8,-0.45,3.15,-0.8,0,3.15,-0.112,-0.2,2.7,-0.2,-0.112,2.7,-0.2,0,2.7,-0.8,0.45,3.15,-0.45,0.8,3.15,0,0.8,3.15,-0.2,0.112,2.7,-0.112,0.2,2.7,0,0.2,2.7,0.45,0.8,3.15,0.8,0.45,3.15,0.112,0.2,2.7,0.2,0.112,2.7,0.4,0,2.55,0.4,-0.224,2.55,0.224,-0.4,2.55,0,-0.4,2.55,1.3,0,2.55,1.3,-0.728,2.55,0.728,-1.3,2.55,0,-1.3,2.55,1.3,0,2.4,1.3,-0.728,2.4,0.728,-1.3,2.4,0,-1.3,2.4,-0.224,-0.4,2.55,-0.4,-0.224,2.55,-0.4,0,2.55,-0.728,-1.3,2.55,-1.3,-0.728,2.55,-1.3,0,2.55,-0.728,-1.3,2.4,-1.3,-0.728,2.4,-1.3,0,2.4,-0.4,0.224,2.55,-0.224,0.4,2.55,0,0.4,2.55,-1.3,0.728,2.55,-0.728,1.3,2.55,0,1.3,2.55,-1.3,0.728,2.4,-0.728,1.3,2.4,0,1.3,2.4,0.224,0.4,2.55,0.4,0.224,2.55,0.728,1.3,2.55,1.3,0.728,2.55,0.728,1.3,2.4,1.3,0.728,2.4,0,0,0,1.425,0,0,1.425,0.798,0,0.798,1.425,0,0,1.425,0,1.5,0,0.075,1.5,0.84,0.075,0.84,1.5,0.075,0,1.5,0.075,-0.798,1.425,0,-1.425,0.798,0,-1.425,0,0,-0.84,1.5,0.075,-1.5,0.84,0.075,-1.5,0,0.075,-1.425,-0.798,0,-0.798,-1.425,0,0,-1.425,0,-1.5,-0.84,0.075,-0.84,-1.5,0.075,0,-1.5,0.075,0.798,-1.425,0,1.425,-0.798,0,0.84,-1.5,0.075,1.5,-0.84,0.075];BufferGeometry.call(this);this.type='TeapotBufferGeometry';this.parameters={size:size,segments:segments,bottom:bottom,lid:lid,body:body,fitLid:fitLid,blinn:blinn};size=size||50;// number of segments per patch
  segments=segments!==undefined?Math.max(2,Math.floor(segments)||10):10;// which parts should be visible
  bottom=bottom===undefined?true:bottom;lid=lid===undefined?true:lid;body=body===undefined?true:body;// Should the lid be snug? It's not traditional, but we make it snug by default
  fitLid=fitLid===undefined?true:fitLid;// Jim Blinn scaled the teapot down in size by about 1.3 for
  // some rendering tests. He liked the new proportions that he kept
  // the data in this form. The model was distributed with these new
  // proportions and became the norm. Trivia: comparing images of the
  // real teapot and the computer model, the ratio for the bowl of the
  // real teapot is more like 1.25, but since 1.3 is the traditional
  // value given, we use it here.
  var blinnScale=1.3;blinn=blinn===undefined?true:blinn;// scale the size to be the real scaling factor
  var maxHeight=3.15*(blinn?1:blinnScale);var maxHeight2=maxHeight/2;var trueSize=size/maxHeight2;// Number of elements depends on what is needed. Subtract degenerate
  // triangles at tip of bottom and lid out in advance.
  var numTriangles=bottom?(8*segments-4)*segments:0;numTriangles+=lid?(16*segments-4)*segments:0;numTriangles+=body?40*segments*segments:0;var indices=new Uint32Array(numTriangles*3);var numVertices=bottom?4:0;numVertices+=lid?8:0;numVertices+=body?20:0;numVertices*=(segments+1)*(segments+1);var vertices=new Float32Array(numVertices*3);var normals=new Float32Array(numVertices*3);var uvs=new Float32Array(numVertices*2);// Bezier form
  var ms=new Matrix4();ms.set(-1.0,3.0,-3.0,1.0,3.0,-6.0,3.0,0.0,-3.0,3.0,0.0,0.0,1.0,0.0,0.0,0.0);var g=[];var i,r,c;var sp=[];var tp=[];var dsp=[];var dtp=[];// M * G * M matrix, sort of see
  // http://www.cs.helsinki.fi/group/goa/mallinnus/curves/surfaces.html
  var mgm=[];var vert=[];var sdir=[];var tdir=[];var norm=new Vector3$1();var tcoord;var sstep,tstep;var vertPerRow;var s,t,sval,tval,p;var dsval=0;var dtval=0;var normOut=new Vector3$1();var v1,v2,v3,v4;var gmx=new Matrix4();var tmtx=new Matrix4();var vsp=new Vector4$1();var vtp=new Vector4$1();var vdsp=new Vector4$1();var vdtp=new Vector4$1();var vsdir=new Vector3$1();var vtdir=new Vector3$1();var mst=ms.clone();mst.transpose();// internal function: test if triangle has any matching vertices;
  // if so, don't save triangle, since it won't display anything.
  var notDegenerate=function notDegenerate(vtx1,vtx2,vtx3){// if any vertex matches, return false
  return!(vertices[vtx1*3]===vertices[vtx2*3]&&vertices[vtx1*3+1]===vertices[vtx2*3+1]&&vertices[vtx1*3+2]===vertices[vtx2*3+2]||vertices[vtx1*3]===vertices[vtx3*3]&&vertices[vtx1*3+1]===vertices[vtx3*3+1]&&vertices[vtx1*3+2]===vertices[vtx3*3+2]||vertices[vtx2*3]===vertices[vtx3*3]&&vertices[vtx2*3+1]===vertices[vtx3*3+1]&&vertices[vtx2*3+2]===vertices[vtx3*3+2]);};for(i=0;i<3;i++){mgm[i]=new Matrix4();}var minPatches=body?0:20;var maxPatches=bottom?32:28;vertPerRow=segments+1;var surfCount=0;var vertCount=0;var normCount=0;var uvCount=0;var indexCount=0;for(var surf=minPatches;surf<maxPatches;surf++){// lid is in the middle of the data, patches 20-27,
  // so ignore it for this part of the loop if the lid is not desired
  if(lid||surf<20||surf>=28){// get M * G * M matrix for x,y,z
  for(i=0;i<3;i++){// get control patches
  for(r=0;r<4;r++){for(c=0;c<4;c++){// transposed
  g[c*4+r]=teapotVertices[teapotPatches[surf*16+r*4+c]*3+i];// is the lid to be made larger, and is this a point on the lid
  // that is X or Y?
  if(fitLid&&surf>=20&&surf<28&&i!==2){// increase XY size by 7.7%, found empirically. I don't
  // increase Z so that the teapot will continue to fit in the
  // space -1 to 1 for Y (Y is up for the final model).
  g[c*4+r]*=1.077;}// Blinn "fixed" the teapot by dividing Z by blinnScale, and that's the
  // data we now use. The original teapot is taller. Fix it:
  if(!blinn&&i===2){g[c*4+r]*=blinnScale;}}}gmx.set(g[0],g[1],g[2],g[3],g[4],g[5],g[6],g[7],g[8],g[9],g[10],g[11],g[12],g[13],g[14],g[15]);tmtx.multiplyMatrices(gmx,ms);mgm[i].multiplyMatrices(mst,tmtx);}// step along, get points, and output
  for(sstep=0;sstep<=segments;sstep++){s=sstep/segments;for(tstep=0;tstep<=segments;tstep++){t=tstep/segments;// point from basis
  // get power vectors and their derivatives
  for(p=4, sval=tval=1.0;p--;){sp[p]=sval;tp[p]=tval;sval*=s;tval*=t;if(p===3){dsp[p]=dtp[p]=0.0;dsval=dtval=1.0;}else{dsp[p]=dsval*(3-p);dtp[p]=dtval*(3-p);dsval*=s;dtval*=t;}}vsp.fromArray(sp);vtp.fromArray(tp);vdsp.fromArray(dsp);vdtp.fromArray(dtp);// do for x,y,z
  for(i=0;i<3;i++){// multiply power vectors times matrix to get value
  tcoord=vsp.clone();tcoord.applyMatrix4(mgm[i]);vert[i]=tcoord.dot(vtp);// get s and t tangent vectors
  tcoord=vdsp.clone();tcoord.applyMatrix4(mgm[i]);sdir[i]=tcoord.dot(vtp);tcoord=vsp.clone();tcoord.applyMatrix4(mgm[i]);tdir[i]=tcoord.dot(vdtp);}// find normal
  vsdir.fromArray(sdir);vtdir.fromArray(tdir);norm.crossVectors(vtdir,vsdir);norm.normalize();// if X and Z length is 0, at the cusp, so point the normal up or down, depending on patch number
  if(vert[0]===0&&vert[1]===0){// if above the middle of the teapot, normal points up, else down
  normOut.set(0,vert[2]>maxHeight2?1:-1,0);}else{// standard output: rotate on X axis
  normOut.set(norm.x,norm.z,-norm.y);}// store it all
  vertices[vertCount++]=trueSize*vert[0];vertices[vertCount++]=trueSize*(vert[2]-maxHeight2);vertices[vertCount++]=-trueSize*vert[1];normals[normCount++]=normOut.x;normals[normCount++]=normOut.y;normals[normCount++]=normOut.z;uvs[uvCount++]=1-t;uvs[uvCount++]=1-s;}}// save the faces
  for(sstep=0;sstep<segments;sstep++){for(tstep=0;tstep<segments;tstep++){v1=surfCount*vertPerRow*vertPerRow+sstep*vertPerRow+tstep;v2=v1+1;v3=v2+vertPerRow;v4=v1+vertPerRow;// Normals and UVs cannot be shared. Without clone(), you can see the consequences
  // of sharing if you call geometry.applyMatrix( matrix ).
  if(notDegenerate(v1,v2,v3)){indices[indexCount++]=v1;indices[indexCount++]=v2;indices[indexCount++]=v3;}if(notDegenerate(v1,v3,v4)){indices[indexCount++]=v1;indices[indexCount++]=v3;indices[indexCount++]=v4;}}}// increment only if a surface was used
  surfCount++;}}this.setIndex(new BufferAttribute(indices,1));this.addAttribute('position',new BufferAttribute(vertices,3));this.addAttribute('normal',new BufferAttribute(normals,3));this.addAttribute('uv',new BufferAttribute(uvs,2));this.computeBoundingSphere();};TeapotBufferGeometry.prototype=Object.create(BufferGeometry.prototype);TeapotBufferGeometry.prototype.constructor=TeapotBufferGeometry;TeapotBufferGeometry.prototype.clone=function(){var bufferGeometry=new TeapotBufferGeometry(this.parameters.size,this.parameters.segments,this.parameters.bottom,this.parameters.lid,this.parameters.body,this.parameters.fitLid,this.parameters.blinn);return bufferGeometry;};/**
   * @author alteredq / http://alteredqualia.com/
   */function DataTexture(data,width,height,format,type,mapping,wrapS,wrapT,magFilter,minFilter,anisotropy,encoding){Texture$1.call(this,null,mapping,wrapS,wrapT,magFilter,minFilter,format,type,anisotropy,encoding);this.image={data:data,width:width,height:height};this.magFilter=magFilter!==undefined?magFilter:NearestFilter;this.minFilter=minFilter!==undefined?minFilter:NearestFilter;this.generateMipmaps=false;this.flipY=false;this.unpackAlignment=1;}DataTexture.prototype=Object.create(Texture$1.prototype);DataTexture.prototype.constructor=DataTexture;DataTexture.prototype.isDataTexture=true;/**
   * @author yomboprime https://github.com/yomboprime
   *
   * GPUComputationRenderer, based on SimulationRenderer by zz85
   *
   * The GPUComputationRenderer uses the concept of variables. These variables are RGBA float textures that hold 4 floats
   * for each compute element (texel)
   *
   * Each variable has a fragment shader that defines the computation made to obtain the variable in question.
   * You can use as many variables you need, and make dependencies so you can use textures of other variables in the shader
   * (the sampler uniforms are added automatically) Most of the variables will need themselves as dependency.
   *
   * The renderer has actually two render targets per variable, to make ping-pong. Textures from the current frame are used
   * as inputs to render the textures of the next frame.
   *
   * The render targets of the variables can be used as input textures for your visualization shaders.
   *
   * Variable names should be valid identifiers and should not collide with THREE GLSL used identifiers.
   * a common approach could be to use 'texture' prefixing the variable name; i.e texturePosition, textureVelocity...
   *
   * The size of the computation (sizeX * sizeY) is defined as 'resolution' automatically in the shader. For example:
   * #DEFINE resolution vec2( 1024.0, 1024.0 )
   *
   * -------------
   *
   * Basic use:
   *
   * // Initialization...
   *
   * // Create computation renderer
   * var gpuCompute = new GPUComputationRenderer( 1024, 1024, renderer );
   *
   * // Create initial state float textures
   * var pos0 = gpuCompute.createTexture();
   * var vel0 = gpuCompute.createTexture();
   * // and fill in here the texture data...
   *
   * // Add texture variables
   * var velVar = gpuCompute.addVariable( "textureVelocity", fragmentShaderVel, pos0 );
   * var posVar = gpuCompute.addVariable( "texturePosition", fragmentShaderPos, vel0 );
   *
   * // Add variable dependencies
   * gpuCompute.setVariableDependencies( velVar, [ velVar, posVar ] );
   * gpuCompute.setVariableDependencies( posVar, [ velVar, posVar ] );
   *
   * // Add custom uniforms
   * velVar.material.uniforms.time = { value: 0.0 };
   *
   * // Check for completeness
   * var error = gpuCompute.init();
   * if ( error !== null ) {
   *		console.error( error );
    * }
   *
   *
   * // In each frame...
   *
   * // Compute!
   * gpuCompute.compute();
   *
   * // Update texture uniforms in your visualization materials with the gpu renderer output
   * myMaterial.uniforms.myTexture.value = gpuCompute.getCurrentRenderTarget( posVar ).texture;
   *
   * // Do your rendering
   * renderer.render( myScene, myCamera );
   *
   * -------------
   *
   * Also, you can use utility functions to create ShaderMaterial and perform computations (rendering between textures)
   * Note that the shaders can have multiple input textures.
   *
   * var myFilter1 = gpuCompute.createShaderMaterial( myFilterFragmentShader1, { theTexture: { value: null } } );
   * var myFilter2 = gpuCompute.createShaderMaterial( myFilterFragmentShader2, { theTexture: { value: null } } );
   *
   * var inputTexture = gpuCompute.createTexture();
   *
   * // Fill in here inputTexture...
   *
   * myFilter1.uniforms.theTexture.value = inputTexture;
   *
   * var myRenderTarget = gpuCompute.createRenderTarget();
   * myFilter2.uniforms.theTexture.value = myRenderTarget.texture;
   *
   * var outputRenderTarget = gpuCompute.createRenderTarget();
   *
   * // Now use the output texture where you want:
   * myMaterial.uniforms.map.value = outputRenderTarget.texture;
   *
   * // And compute each frame, before rendering to screen:
   * gpuCompute.doRenderTarget( myFilter1, myRenderTarget );
   * gpuCompute.doRenderTarget( myFilter2, outputRenderTarget );
   * 
   *
   *
   * @param {int} sizeX Computation problem size is always 2d: sizeX * sizeY elements.
   * @param {int} sizeY Computation problem size is always 2d: sizeX * sizeY elements.
   * @param {WebGLRenderer} renderer The renderer
    */var GPUParticleSystem=function GPUParticleSystem(options){var this$1=this;Object3D.apply(this,arguments);options=options||{};// parse options and use defaults
  this.PARTICLE_COUNT=options.maxParticles||1000000;this.PARTICLE_CONTAINERS=options.containerCount||1;this.PARTICLE_NOISE_TEXTURE=options.particleNoiseTex||null;this.PARTICLE_SPRITE_TEXTURE=options.particleSpriteTex||null;this.PARTICLES_PER_CONTAINER=Math.ceil(this.PARTICLE_COUNT/this.PARTICLE_CONTAINERS);this.PARTICLE_CURSOR=0;this.time=0;this.particleContainers=[];this.rand=[];// custom vertex and fragement shader
  var GPUParticleShader={vertexShader:['uniform float uTime;','uniform float uScale;','uniform sampler2D tNoise;','attribute vec3 positionStart;','attribute float startTime;','attribute vec3 velocity;','attribute float turbulence;','attribute vec3 color;','attribute float size;','attribute float lifeTime;','varying vec4 vColor;','varying float lifeLeft;','void main() {',// unpack things from our attributes'
  '	vColor = vec4( color, 1.0 );',// convert our velocity back into a value we can use'
  '	vec3 newPosition;','	vec3 v;','	float timeElapsed = uTime - startTime;','	lifeLeft = 1.0 - ( timeElapsed / lifeTime );','	gl_PointSize = ( uScale * size ) * lifeLeft;','	v.x = ( velocity.x - 0.5 ) * 3.0;','	v.y = ( velocity.y - 0.5 ) * 3.0;','	v.z = ( velocity.z - 0.5 ) * 3.0;','	newPosition = positionStart + ( v * 10.0 ) * timeElapsed;','	vec3 noise = texture2D( tNoise, vec2( newPosition.x * 0.015 + ( uTime * 0.05 ), newPosition.y * 0.02 + ( uTime * 0.015 ) ) ).rgb;','	vec3 noiseVel = ( noise.rgb - 0.5 ) * 30.0;','	newPosition = mix( newPosition, newPosition + vec3( noiseVel * ( turbulence * 5.0 ) ), ( timeElapsed / lifeTime ) );','	if( v.y > 0. && v.y < .05 ) {','		lifeLeft = 0.0;','	}','	if( v.x < - 1.45 ) {','		lifeLeft = 0.0;','	}','	if( timeElapsed > 0.0 ) {','		gl_Position = projectionMatrix * modelViewMatrix * vec4( newPosition, 1.0 );','	} else {','		gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );','		lifeLeft = 0.0;','		gl_PointSize = 0.;','	}','}'].join('\n'),fragmentShader:['float scaleLinear( float value, vec2 valueDomain ) {','	return ( value - valueDomain.x ) / ( valueDomain.y - valueDomain.x );','}','float scaleLinear( float value, vec2 valueDomain, vec2 valueRange ) {','	return mix( valueRange.x, valueRange.y, scaleLinear( value, valueDomain ) );','}','varying vec4 vColor;','varying float lifeLeft;','uniform sampler2D tSprite;','void main() {','	float alpha = 0.;','	if( lifeLeft > 0.995 ) {','		alpha = scaleLinear( lifeLeft, vec2( 1.0, 0.995 ), vec2( 0.0, 1.0 ) );','	} else {','		alpha = lifeLeft * 0.75;','	}','	vec4 tex = texture2D( tSprite, gl_PointCoord );','	gl_FragColor = vec4( vColor.rgb * tex.a, alpha * tex.a );','}'].join('\n')};// preload a million random numbers
  var i;for(i=1e5;i>0;i--){this$1.rand.push(Math.random()-0.5);}this.random=function(){return++i>=this.rand.length?this.rand[i=1]:this.rand[i];};var textureLoader=new TextureLoader();this.particleNoiseTex=this.PARTICLE_NOISE_TEXTURE||textureLoader.load('textures/perlin-512.png');this.particleNoiseTex.wrapS=this.particleNoiseTex.wrapT=RepeatWrapping;this.particleSpriteTex=this.PARTICLE_SPRITE_TEXTURE||textureLoader.load('textures/particle2.png');this.particleSpriteTex.wrapS=this.particleSpriteTex.wrapT=RepeatWrapping;this.particleShaderMat=new ShaderMaterial({transparent:true,depthWrite:false,uniforms:{'uTime':{value:0.0},'uScale':{value:1.0},'tNoise':{value:this.particleNoiseTex},'tSprite':{value:this.particleSpriteTex}},blending:AdditiveBlending,vertexShader:GPUParticleShader.vertexShader,fragmentShader:GPUParticleShader.fragmentShader});// define defaults for all values
  this.particleShaderMat.defaultAttributeValues.particlePositionsStartTime=[0,0,0,0];this.particleShaderMat.defaultAttributeValues.particleVelColSizeLife=[0,0,0,0];this.init=function(){var this$1=this;for(var i=0;i<this.PARTICLE_CONTAINERS;i++){var c=new GPUParticleContainer(this$1.PARTICLES_PER_CONTAINER,this$1);this$1.particleContainers.push(c);this$1.add(c);}};this.spawnParticle=function(options){this.PARTICLE_CURSOR++;if(this.PARTICLE_CURSOR>=this.PARTICLE_COUNT){this.PARTICLE_CURSOR=1;}var currentContainer=this.particleContainers[Math.floor(this.PARTICLE_CURSOR/this.PARTICLES_PER_CONTAINER)];currentContainer.spawnParticle(options);};this.update=function(time){var this$1=this;for(var i=0;i<this.PARTICLE_CONTAINERS;i++){this$1.particleContainers[i].update(time);}};this.dispose=function(){var this$1=this;this.particleShaderMat.dispose();this.particleNoiseTex.dispose();this.particleSpriteTex.dispose();for(var i=0;i<this.PARTICLE_CONTAINERS;i++){this$1.particleContainers[i].dispose();}};this.init();};GPUParticleSystem.prototype=Object.create(Object3D.prototype);GPUParticleSystem.prototype.constructor=GPUParticleSystem;// Subclass for particle containers, allows for very large arrays to be spread out
  var GPUParticleContainer=function GPUParticleContainer(maxParticles,particleSystem){Object3D.apply(this,arguments);this.PARTICLE_COUNT=maxParticles||100000;this.PARTICLE_CURSOR=0;this.time=0;this.offset=0;this.count=0;this.DPR=window.devicePixelRatio;this.GPUParticleSystem=particleSystem;this.particleUpdate=false;// geometry
  this.particleShaderGeo=new BufferGeometry();this.particleShaderGeo.addAttribute('position',new BufferAttribute(new Float32Array(this.PARTICLE_COUNT*3),3).setDynamic(true));this.particleShaderGeo.addAttribute('positionStart',new BufferAttribute(new Float32Array(this.PARTICLE_COUNT*3),3).setDynamic(true));this.particleShaderGeo.addAttribute('startTime',new BufferAttribute(new Float32Array(this.PARTICLE_COUNT),1).setDynamic(true));this.particleShaderGeo.addAttribute('velocity',new BufferAttribute(new Float32Array(this.PARTICLE_COUNT*3),3).setDynamic(true));this.particleShaderGeo.addAttribute('turbulence',new BufferAttribute(new Float32Array(this.PARTICLE_COUNT),1).setDynamic(true));this.particleShaderGeo.addAttribute('color',new BufferAttribute(new Float32Array(this.PARTICLE_COUNT*3),3).setDynamic(true));this.particleShaderGeo.addAttribute('size',new BufferAttribute(new Float32Array(this.PARTICLE_COUNT),1).setDynamic(true));this.particleShaderGeo.addAttribute('lifeTime',new BufferAttribute(new Float32Array(this.PARTICLE_COUNT),1).setDynamic(true));// material
  this.particleShaderMat=this.GPUParticleSystem.particleShaderMat;var position=new Vector3$1();var velocity=new Vector3$1();var color=new Color$1();this.spawnParticle=function(options){var positionStartAttribute=this.particleShaderGeo.getAttribute('positionStart');var startTimeAttribute=this.particleShaderGeo.getAttribute('startTime');var velocityAttribute=this.particleShaderGeo.getAttribute('velocity');var turbulenceAttribute=this.particleShaderGeo.getAttribute('turbulence');var colorAttribute=this.particleShaderGeo.getAttribute('color');var sizeAttribute=this.particleShaderGeo.getAttribute('size');var lifeTimeAttribute=this.particleShaderGeo.getAttribute('lifeTime');options=options||{};// setup reasonable default values for all arguments
  position=options.position!==undefined?position.copy(options.position):position.set(0,0,0);velocity=options.velocity!==undefined?velocity.copy(options.velocity):velocity.set(0,0,0);color=options.color!==undefined?color.set(options.color):color.set(0xffffff);var positionRandomness=options.positionRandomness!==undefined?options.positionRandomness:0;var velocityRandomness=options.velocityRandomness!==undefined?options.velocityRandomness:0;var colorRandomness=options.colorRandomness!==undefined?options.colorRandomness:1;var turbulence=options.turbulence!==undefined?options.turbulence:1;var lifetime=options.lifetime!==undefined?options.lifetime:5;var size=options.size!==undefined?options.size:10;var sizeRandomness=options.sizeRandomness!==undefined?options.sizeRandomness:0;var smoothPosition=options.smoothPosition!==undefined?options.smoothPosition:false;if(this.DPR!==undefined){size*=this.DPR;}var i=this.PARTICLE_CURSOR;// position
  positionStartAttribute.array[i*3+0]=position.x+particleSystem.random()*positionRandomness;positionStartAttribute.array[i*3+1]=position.y+particleSystem.random()*positionRandomness;positionStartAttribute.array[i*3+2]=position.z+particleSystem.random()*positionRandomness;if(smoothPosition===true){positionStartAttribute.array[i*3+0]+=-(velocity.x*particleSystem.random());positionStartAttribute.array[i*3+1]+=-(velocity.y*particleSystem.random());positionStartAttribute.array[i*3+2]+=-(velocity.z*particleSystem.random());}// velocity
  var maxVel=2;var velX=velocity.x+particleSystem.random()*velocityRandomness;var velY=velocity.y+particleSystem.random()*velocityRandomness;var velZ=velocity.z+particleSystem.random()*velocityRandomness;velX=Math.clamp((velX- -maxVel)/(maxVel- -maxVel),0,1);velY=Math.clamp((velY- -maxVel)/(maxVel- -maxVel),0,1);velZ=Math.clamp((velZ- -maxVel)/(maxVel- -maxVel),0,1);velocityAttribute.array[i*3+0]=velX;velocityAttribute.array[i*3+1]=velY;velocityAttribute.array[i*3+2]=velZ;// color
  color.r=Math.clamp(color.r+particleSystem.random()*colorRandomness,0,1);color.g=Math.clamp(color.g+particleSystem.random()*colorRandomness,0,1);color.b=Math.clamp(color.b+particleSystem.random()*colorRandomness,0,1);colorAttribute.array[i*3+0]=color.r;colorAttribute.array[i*3+1]=color.g;colorAttribute.array[i*3+2]=color.b;// turbulence, size, lifetime and starttime
  turbulenceAttribute.array[i]=turbulence;sizeAttribute.array[i]=size+particleSystem.random()*sizeRandomness;lifeTimeAttribute.array[i]=lifetime;startTimeAttribute.array[i]=this.time+particleSystem.random()*2e-2;// offset
  if(this.offset===0){this.offset=this.PARTICLE_CURSOR;}// counter and cursor
  this.count++;this.PARTICLE_CURSOR++;if(this.PARTICLE_CURSOR>=this.PARTICLE_COUNT){this.PARTICLE_CURSOR=0;}this.particleUpdate=true;};this.init=function(){this.particleSystem=new Points(this.particleShaderGeo,this.particleShaderMat);this.particleSystem.frustumCulled=false;this.add(this.particleSystem);};this.update=function(time){this.time=time;this.particleShaderMat.uniforms.uTime.value=time;this.geometryUpdate();};this.geometryUpdate=function(){if(this.particleUpdate===true){this.particleUpdate=false;var positionStartAttribute=this.particleShaderGeo.getAttribute('positionStart');var startTimeAttribute=this.particleShaderGeo.getAttribute('startTime');var velocityAttribute=this.particleShaderGeo.getAttribute('velocity');var turbulenceAttribute=this.particleShaderGeo.getAttribute('turbulence');var colorAttribute=this.particleShaderGeo.getAttribute('color');var sizeAttribute=this.particleShaderGeo.getAttribute('size');var lifeTimeAttribute=this.particleShaderGeo.getAttribute('lifeTime');if(this.offset+this.count<this.PARTICLE_COUNT){positionStartAttribute.updateRange.offset=this.offset*positionStartAttribute.itemSize;startTimeAttribute.updateRange.offset=this.offset*startTimeAttribute.itemSize;velocityAttribute.updateRange.offset=this.offset*velocityAttribute.itemSize;turbulenceAttribute.updateRange.offset=this.offset*turbulenceAttribute.itemSize;colorAttribute.updateRange.offset=this.offset*colorAttribute.itemSize;sizeAttribute.updateRange.offset=this.offset*sizeAttribute.itemSize;lifeTimeAttribute.updateRange.offset=this.offset*lifeTimeAttribute.itemSize;positionStartAttribute.updateRange.count=this.count*positionStartAttribute.itemSize;startTimeAttribute.updateRange.count=this.count*startTimeAttribute.itemSize;velocityAttribute.updateRange.count=this.count*velocityAttribute.itemSize;turbulenceAttribute.updateRange.count=this.count*turbulenceAttribute.itemSize;colorAttribute.updateRange.count=this.count*colorAttribute.itemSize;sizeAttribute.updateRange.count=this.count*sizeAttribute.itemSize;lifeTimeAttribute.updateRange.count=this.count*lifeTimeAttribute.itemSize;}else{positionStartAttribute.updateRange.offset=0;startTimeAttribute.updateRange.offset=0;velocityAttribute.updateRange.offset=0;turbulenceAttribute.updateRange.offset=0;colorAttribute.updateRange.offset=0;sizeAttribute.updateRange.offset=0;lifeTimeAttribute.updateRange.offset=0;// Use -1 to update the entire buffer, see #11476
  positionStartAttribute.updateRange.count=-1;startTimeAttribute.updateRange.count=-1;velocityAttribute.updateRange.count=-1;turbulenceAttribute.updateRange.count=-1;colorAttribute.updateRange.count=-1;sizeAttribute.updateRange.count=-1;lifeTimeAttribute.updateRange.count=-1;}positionStartAttribute.needsUpdate=true;startTimeAttribute.needsUpdate=true;velocityAttribute.needsUpdate=true;turbulenceAttribute.needsUpdate=true;colorAttribute.needsUpdate=true;sizeAttribute.needsUpdate=true;lifeTimeAttribute.needsUpdate=true;this.offset=0;this.count=0;}};this.dispose=function(){this.particleShaderGeo.dispose();};this.init();};GPUParticleContainer.prototype=Object.create(Object3D.prototype);GPUParticleContainer.prototype.constructor=GPUParticleContainer;/**
   * @author alteredq / http://alteredqualia.com/
   */var Gyroscope=function Gyroscope(){Object3D.call(this);};Gyroscope.prototype=Object.create(Object3D.prototype);Gyroscope.prototype.constructor=Gyroscope;Gyroscope.prototype.updateMatrixWorld=function(){var translationObject=new Vector3$1();var quaternionObject=new Quaternion();var scaleObject=new Vector3$1();var translationWorld=new Vector3$1();var quaternionWorld=new Quaternion();var scaleWorld=new Vector3$1();return function updateMatrixWorld(force){var this$1=this;this.matrixAutoUpdate&&this.updateMatrix();// update matrixWorld
  if(this.matrixWorldNeedsUpdate||force){if(this.parent!==null){this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix);this.matrixWorld.decompose(translationWorld,quaternionWorld,scaleWorld);this.matrix.decompose(translationObject,quaternionObject,scaleObject);this.matrixWorld.compose(translationWorld,quaternionObject,scaleWorld);}else{this.matrixWorld.copy(this.matrix);}this.matrixWorldNeedsUpdate=false;force=true;}// update children
  for(var i=0,l=this.children.length;i<l;i++){this$1.children[i].updateMatrixWorld(force);}};}();// http://mrl.nyu.edu/~perlin/noise/
  function Group(){Object3D.call(this);this.type='Group';}Group.prototype=Object.assign(Object.create(Object3D.prototype),{constructor:Group,isGroup:true});/**
   * @author technohippy / https://github.com/technohippy
   */function LightShadow(camera){this.camera=camera;this.bias=0;this.radius=1;this.mapSize=new Vector2$1(512,512);this.map=null;this.matrix=new Matrix4();}Object.assign(LightShadow.prototype,{copy:function copy(source){this.camera=source.camera.clone();this.bias=source.bias;this.radius=source.radius;this.mapSize.copy(source.mapSize);return this;},clone:function clone(){return new this.constructor().copy(this);},toJSON:function toJSON(){var object={};if(this.bias!==0){object.bias=this.bias;}if(this.radius!==1){object.radius=this.radius;}if(this.mapSize.x!==512||this.mapSize.y!==512){object.mapSize=this.mapSize.toArray();}object.camera=this.camera.toJSON(false).object;delete object.camera.matrix;return object;}});/**
   * @author mrdoob / http://mrdoob.com/
   */function PointLight(color,intensity,distance,decay){Light.call(this,color,intensity);this.type='PointLight';Object.defineProperty(this,'power',{get:function get$$1(){// intensity = power per solid angle.
  // ref: equation (15) from http://www.frostbite.com/wp-content/uploads/2014/11/course_notes_moving_frostbite_to_pbr.pdf
  return this.intensity*4*Math.PI;},set:function set$$1(power){// intensity = power per solid angle.
  // ref: equation (15) from http://www.frostbite.com/wp-content/uploads/2014/11/course_notes_moving_frostbite_to_pbr.pdf
  this.intensity=power/(4*Math.PI);}});this.distance=distance!==undefined?distance:0;this.decay=decay!==undefined?decay:1;// for physically correct lights, should be 2.
  this.shadow=new LightShadow(new PerspectiveCamera(90,1,0.5,500));}PointLight.prototype=Object.assign(Object.create(Light.prototype),{constructor:PointLight,isPointLight:true,copy:function copy(source){Light.prototype.copy.call(this,source);this.distance=source.distance;this.decay=source.decay;this.shadow=source.shadow.clone();return this;}});/**
   * @author mrdoob / http://mrdoob.com/
   */function DirectionalLightShadow(){LightShadow.call(this,new OrthographicCamera(-5,5,5,-5,0.5,500));}DirectionalLightShadow.prototype=Object.assign(Object.create(LightShadow.prototype),{constructor:DirectionalLightShadow});/**
   * @author mrdoob / http://mrdoob.com/
   * @author alteredq / http://alteredqualia.com/
   */function DirectionalLight(color,intensity){Light.call(this,color,intensity);this.type='DirectionalLight';this.position.copy(Object3D.DefaultUp);this.updateMatrix();this.target=new Object3D();this.shadow=new DirectionalLightShadow();}DirectionalLight.prototype=Object.assign(Object.create(Light.prototype),{constructor:DirectionalLight,isDirectionalLight:true,copy:function copy(source){Light.prototype.copy.call(this,source);this.target=source.target.clone();this.shadow=source.shadow.clone();return this;}});/**
   * @author mrdoob / http://mrdoob.com/
   */function SpotLightShadow(){LightShadow.call(this,new PerspectiveCamera(50,1,0.5,500));}SpotLightShadow.prototype=Object.assign(Object.create(LightShadow.prototype),{constructor:SpotLightShadow,isSpotLightShadow:true,update:function update(light){var camera=this.camera;var fov=_Math$1.RAD2DEG*2*light.angle;var aspect=this.mapSize.width/this.mapSize.height;var far=light.distance||camera.far;if(fov!==camera.fov||aspect!==camera.aspect||far!==camera.far){camera.fov=fov;camera.aspect=aspect;camera.far=far;camera.updateProjectionMatrix();}}});/**
   * @author alteredq / http://alteredqualia.com/
   */function SpotLight(color,intensity,distance,angle,penumbra,decay){Light.call(this,color,intensity);this.type='SpotLight';this.position.copy(Object3D.DefaultUp);this.updateMatrix();this.target=new Object3D();Object.defineProperty(this,'power',{get:function get$$1(){// intensity = power per solid angle.
  // ref: equation (17) from http://www.frostbite.com/wp-content/uploads/2014/11/course_notes_moving_frostbite_to_pbr.pdf
  return this.intensity*Math.PI;},set:function set$$1(power){// intensity = power per solid angle.
  // ref: equation (17) from http://www.frostbite.com/wp-content/uploads/2014/11/course_notes_moving_frostbite_to_pbr.pdf
  this.intensity=power/Math.PI;}});this.distance=distance!==undefined?distance:0;this.angle=angle!==undefined?angle:Math.PI/3;this.penumbra=penumbra!==undefined?penumbra:0;this.decay=decay!==undefined?decay:1;// for physically correct lights, should be 2.
  this.shadow=new SpotLightShadow();}SpotLight.prototype=Object.assign(Object.create(Light.prototype),{constructor:SpotLight,isSpotLight:true,copy:function copy(source){Light.prototype.copy.call(this,source);this.distance=source.distance;this.angle=source.angle;this.penumbra=source.penumbra;this.decay=source.decay;this.target=source.target.clone();this.shadow=source.shadow.clone();return this;}});/**
   * @author alteredq / http://alteredqualia.com/
   */function HemisphereLight(skyColor,groundColor,intensity){Light.call(this,skyColor,intensity);this.type='HemisphereLight';this.castShadow=undefined;this.position.copy(Object3D.DefaultUp);this.updateMatrix();this.groundColor=new Color$1(groundColor);}HemisphereLight.prototype=Object.assign(Object.create(Light.prototype),{constructor:HemisphereLight,isHemisphereLight:true,copy:function copy(source){Light.prototype.copy.call(this,source);this.groundColor.copy(source.groundColor);return this;}});/**
   * @author mrdoob / http://mrdoob.com/
   * @author Mugen87 / https://github.com/Mugen87
   */function AmbientLight(color,intensity){Light.call(this,color,intensity);this.type='AmbientLight';this.castShadow=undefined;}AmbientLight.prototype=Object.assign(Object.create(Light.prototype),{constructor:AmbientLight,isAmbientLight:true});/**
   * @author mrdoob / http://mrdoob.com/
   * @author Mugen87 / https://github.com/Mugen87
   */function CompressedTexture(mipmaps,width,height,format,type,mapping,wrapS,wrapT,magFilter,minFilter,anisotropy,encoding){Texture$1.call(this,null,mapping,wrapS,wrapT,magFilter,minFilter,format,type,anisotropy,encoding);this.image={width:width,height:height};this.mipmaps=mipmaps;// no flipping for cube textures
  // (also flipping doesn't work for compressed textures )
  this.flipY=false;// can't generate mipmaps for compressed textures
  // mips must be embedded in DDS files
  this.generateMipmaps=false;}CompressedTexture.prototype=Object.create(Texture$1.prototype);CompressedTexture.prototype.constructor=CompressedTexture;CompressedTexture.prototype.isCompressedTexture=true;/**
   * @author mrdoob / http://mrdoob.com/
   *
   * Abstract Base class to block based textures loader (dds, pvr, ...)
   */function CompressedTextureLoader(manager){this.manager=manager!==undefined?manager:DefaultLoadingManager;// override in sub classes
  this._parser=null;}Object.assign(CompressedTextureLoader.prototype,{load:function load(url,onLoad,onProgress,onError){var scope=this;var images=[];var texture=new CompressedTexture();texture.image=images;var loader=new FileLoader(this.manager);loader.setPath(this.path);loader.setResponseType('arraybuffer');function loadTexture(i){loader.load(url[i],function(buffer){var texDatas=scope._parser(buffer,true);images[i]={width:texDatas.width,height:texDatas.height,format:texDatas.format,mipmaps:texDatas.mipmaps};loaded+=1;if(loaded===6){if(texDatas.mipmapCount===1){texture.minFilter=LinearFilter;}texture.format=texDatas.format;texture.needsUpdate=true;if(onLoad){onLoad(texture);}}},onProgress,onError);}if(Array.isArray(url)){var loaded=0;for(var i=0,il=url.length;i<il;++i){loadTexture(i);}}else{// compressed cubemap texture stored in a single DDS file
  loader.load(url,function(buffer){var texDatas=scope._parser(buffer,true);if(texDatas.isCubemap){var faces=texDatas.mipmaps.length/texDatas.mipmapCount;for(var f=0;f<faces;f++){images[f]={mipmaps:[]};for(var i=0;i<texDatas.mipmapCount;i++){images[f].mipmaps.push(texDatas.mipmaps[f*texDatas.mipmapCount+i]);images[f].format=texDatas.format;images[f].width=texDatas.width;images[f].height=texDatas.height;}}}else{texture.image.width=texDatas.width;texture.image.height=texDatas.height;texture.mipmaps=texDatas.mipmaps;}if(texDatas.mipmapCount===1){texture.minFilter=LinearFilter;}texture.format=texDatas.format;texture.needsUpdate=true;if(onLoad){onLoad(texture);}},onProgress,onError);}return texture;},setPath:function setPath(value){this.path=value;return this;}});/*
   * @author mrdoob / http://mrdoob.com/
   */var DDSLoader=function DDSLoader(){this._parser=DDSLoader.parse;};DDSLoader.prototype=Object.create(CompressedTextureLoader.prototype);DDSLoader.prototype.constructor=DDSLoader;DDSLoader.parse=function(buffer,loadMipmaps){var dds={mipmaps:[],width:0,height:0,format:null,mipmapCount:1};// Adapted from @toji's DDS utils
  // https://github.com/toji/webgl-texture-utils/blob/master/texture-util/dds.js
  // All values and structures referenced from:
  // http://msdn.microsoft.com/en-us/library/bb943991.aspx/
  var DDS_MAGIC=0x20534444;var DDSD_CAPS=0x1,DDSD_HEIGHT=0x2,DDSD_WIDTH=0x4,DDSD_PITCH=0x8,DDSD_PIXELFORMAT=0x1000,DDSD_MIPMAPCOUNT=0x20000;var DDSCAPS2_CUBEMAP=0x200,DDSCAPS2_CUBEMAP_POSITIVEX=0x400,DDSCAPS2_CUBEMAP_NEGATIVEX=0x800,DDSCAPS2_CUBEMAP_POSITIVEY=0x1000,DDSCAPS2_CUBEMAP_NEGATIVEY=0x2000,DDSCAPS2_CUBEMAP_POSITIVEZ=0x4000,DDSCAPS2_CUBEMAP_NEGATIVEZ=0x8000;var DDPF_ALPHAPIXELS=0x1,DDPF_ALPHA=0x2,DDPF_FOURCC=0x4;function fourCCToInt32(value){return value.charCodeAt(0)+(value.charCodeAt(1)<<8)+(value.charCodeAt(2)<<16)+(value.charCodeAt(3)<<24);}function int32ToFourCC(value){return String.fromCharCode(value&0xff,value>>8&0xff,value>>16&0xff,value>>24&0xff);}function loadARGBMip(buffer,dataOffset,width,height){var dataLength=width*height*4;var srcBuffer=new Uint8Array(buffer,dataOffset,dataLength);var byteArray=new Uint8Array(dataLength);var dst=0;var src=0;for(var y=0;y<height;y++){for(var x=0;x<width;x++){var b=srcBuffer[src];src++;var g=srcBuffer[src];src++;var r=srcBuffer[src];src++;var a=srcBuffer[src];src++;byteArray[dst]=r;dst++;//r
  byteArray[dst]=g;dst++;//g
  byteArray[dst]=b;dst++;//b
  byteArray[dst]=a;dst++;//a
  }}return byteArray;}var FOURCC_DXT1=fourCCToInt32("DXT1");var FOURCC_DXT3=fourCCToInt32("DXT3");var FOURCC_DXT5=fourCCToInt32("DXT5");var FOURCC_ETC1=fourCCToInt32("ETC1");var headerLengthInt=31;// The header length in 32 bit ints
  // Offsets into the header array
  var off_magic=0;var off_size=1;var off_flags=2;var off_height=3;var off_width=4;var off_mipmapCount=7;var off_pfFlags=20;var off_pfFourCC=21;var off_RGBBitCount=22;var off_RBitMask=23;var off_GBitMask=24;var off_BBitMask=25;var off_ABitMask=26;var off_caps2=28;var header=new Int32Array(buffer,0,headerLengthInt);if(header[off_magic]!==DDS_MAGIC){console.error('DDSLoader.parse: Invalid magic number in DDS header.');return dds;}if(!header[off_pfFlags]&DDPF_FOURCC){console.error('DDSLoader.parse: Unsupported format, must contain a FourCC code.');return dds;}var blockBytes;var fourCC=header[off_pfFourCC];var isRGBAUncompressed=false;switch(fourCC){case FOURCC_DXT1:blockBytes=8;dds.format=RGB_S3TC_DXT1_Format;break;case FOURCC_DXT3:blockBytes=16;dds.format=RGBA_S3TC_DXT3_Format;break;case FOURCC_DXT5:blockBytes=16;dds.format=RGBA_S3TC_DXT5_Format;break;case FOURCC_ETC1:blockBytes=8;dds.format=RGB_ETC1_Format;break;default:if(header[off_RGBBitCount]===32&&header[off_RBitMask]&0xff0000&&header[off_GBitMask]&0xff00&&header[off_BBitMask]&0xff&&header[off_ABitMask]&0xff000000){isRGBAUncompressed=true;blockBytes=64;dds.format=RGBAFormat;}else{console.error('DDSLoader.parse: Unsupported FourCC code ',int32ToFourCC(fourCC));return dds;}}dds.mipmapCount=1;if(header[off_flags]&DDSD_MIPMAPCOUNT&&loadMipmaps!==false){dds.mipmapCount=Math.max(1,header[off_mipmapCount]);}var caps2=header[off_caps2];dds.isCubemap=caps2&DDSCAPS2_CUBEMAP?true:false;if(dds.isCubemap&&(!(caps2&DDSCAPS2_CUBEMAP_POSITIVEX)||!(caps2&DDSCAPS2_CUBEMAP_NEGATIVEX)||!(caps2&DDSCAPS2_CUBEMAP_POSITIVEY)||!(caps2&DDSCAPS2_CUBEMAP_NEGATIVEY)||!(caps2&DDSCAPS2_CUBEMAP_POSITIVEZ)||!(caps2&DDSCAPS2_CUBEMAP_NEGATIVEZ))){console.error('DDSLoader.parse: Incomplete cubemap faces');return dds;}dds.width=header[off_width];dds.height=header[off_height];var dataOffset=header[off_size]+4;// Extract mipmaps buffers
  var faces=dds.isCubemap?6:1;for(var face=0;face<faces;face++){var width=dds.width;var height=dds.height;for(var i=0;i<dds.mipmapCount;i++){if(isRGBAUncompressed){var byteArray=loadARGBMip(buffer,dataOffset,width,height);var dataLength=byteArray.length;}else{var dataLength=Math.max(4,width)/4*Math.max(4,height)/4*blockBytes;var byteArray=new Uint8Array(buffer,dataOffset,dataLength);}var mipmap={"data":byteArray,"width":width,"height":height};dds.mipmaps.push(mipmap);dataOffset+=dataLength;width=Math.max(width>>1,1);height=Math.max(height>>1,1);}}return dds;};/**
   * @author benaadams / https://twitter.com/ben_a_adams
   */function InterleavedBuffer(array,stride){this.uuid=_Math$1.generateUUID();this.array=array;this.stride=stride;this.count=array!==undefined?array.length/stride:0;this.dynamic=false;this.updateRange={offset:0,count:-1};this.onUploadCallback=function(){};this.version=0;}Object.defineProperty(InterleavedBuffer.prototype,'needsUpdate',{set:function set$$1(value){if(value===true){this.version++;}}});Object.assign(InterleavedBuffer.prototype,{isInterleavedBuffer:true,setArray:function setArray(array){if(Array.isArray(array)){throw new TypeError('THREE.BufferAttribute: array should be a Typed Array.');}this.count=array!==undefined?array.length/this.stride:0;this.array=array;},setDynamic:function setDynamic(value){this.dynamic=value;return this;},copy:function copy(source){this.array=new source.array.constructor(source.array);this.count=source.count;this.stride=source.stride;this.dynamic=source.dynamic;return this;},copyAt:function copyAt(index1,attribute,index2){var this$1=this;index1*=this.stride;index2*=attribute.stride;for(var i=0,l=this.stride;i<l;i++){this$1.array[index1+i]=attribute.array[index2+i];}return this;},set:function set$$1(value,offset){if(offset===undefined){offset=0;}this.array.set(value,offset);return this;},clone:function clone(){return new this.constructor().copy(this);},onUpload:function onUpload(callback){this.onUploadCallback=callback;return this;}});/**
   * @author benaadams / https://twitter.com/ben_a_adams
   */function InterleavedBufferAttribute(interleavedBuffer,itemSize,offset,normalized){this.uuid=_Math$1.generateUUID();this.data=interleavedBuffer;this.itemSize=itemSize;this.offset=offset;this.normalized=normalized===true;}Object.defineProperties(InterleavedBufferAttribute.prototype,{count:{get:function get$$1(){return this.data.count;}},array:{get:function get$$1(){return this.data.array;}}});Object.assign(InterleavedBufferAttribute.prototype,{isInterleavedBufferAttribute:true,setX:function setX(index,x){this.data.array[index*this.data.stride+this.offset]=x;return this;},setY:function setY(index,y){this.data.array[index*this.data.stride+this.offset+1]=y;return this;},setZ:function setZ(index,z){this.data.array[index*this.data.stride+this.offset+2]=z;return this;},setW:function setW(index,w){this.data.array[index*this.data.stride+this.offset+3]=w;return this;},getX:function getX(index){return this.data.array[index*this.data.stride+this.offset];},getY:function getY(index){return this.data.array[index*this.data.stride+this.offset+1];},getZ:function getZ(index){return this.data.array[index*this.data.stride+this.offset+2];},getW:function getW(index){return this.data.array[index*this.data.stride+this.offset+3];},setXY:function setXY(index,x,y){index=index*this.data.stride+this.offset;this.data.array[index+0]=x;this.data.array[index+1]=y;return this;},setXYZ:function setXYZ(index,x,y,z){index=index*this.data.stride+this.offset;this.data.array[index+0]=x;this.data.array[index+1]=y;this.data.array[index+2]=z;return this;},setXYZW:function setXYZW(index,x,y,z,w){index=index*this.data.stride+this.offset;this.data.array[index+0]=x;this.data.array[index+1]=y;this.data.array[index+2]=z;this.data.array[index+3]=w;return this;}});/**
   * @author Rich Tibbett / https://github.com/richtr
   * @author mrdoob / http://mrdoob.com/
   * @author Tony Parisi / http://www.tonyparisi.com/
   * @author Takahiro / https://github.com/takahirox
   */function DataTextureLoader(manager){this.manager=manager!==undefined?manager:DefaultLoadingManager;// override in sub classes
  this._parser=null;}Object.assign(DataTextureLoader.prototype,{load:function load(url,onLoad,onProgress,onError){var scope=this;var texture=new DataTexture();var loader=new FileLoader(this.manager);loader.setResponseType('arraybuffer');loader.load(url,function(buffer){var texData=scope._parser(buffer);if(!texData){return;}if(undefined!==texData.image){texture.image=texData.image;}else if(undefined!==texData.data){texture.image.width=texData.width;texture.image.height=texData.height;texture.image.data=texData.data;}texture.wrapS=undefined!==texData.wrapS?texData.wrapS:ClampToEdgeWrapping;texture.wrapT=undefined!==texData.wrapT?texData.wrapT:ClampToEdgeWrapping;texture.magFilter=undefined!==texData.magFilter?texData.magFilter:LinearFilter;texture.minFilter=undefined!==texData.minFilter?texData.minFilter:LinearMipMapLinearFilter;texture.anisotropy=undefined!==texData.anisotropy?texData.anisotropy:1;if(undefined!==texData.format){texture.format=texData.format;}if(undefined!==texData.type){texture.type=texData.type;}if(undefined!==texData.mipmaps){texture.mipmaps=texData.mipmaps;}if(1===texData.mipmapCount){texture.minFilter=LinearFilter;}texture.needsUpdate=true;if(onLoad){onLoad(texture,texData);}},onProgress,onError);return texture;}});/**
   * @author Richard M. / https://github.com/richardmonette
   */// https://github.com/mrdoob/three.js/issues/10652
  // https://en.wikipedia.org/wiki/OpenEXR
  var EXRLoader=function EXRLoader(manager){this.manager=manager!==undefined?manager:DefaultLoadingManager;};EXRLoader.prototype=Object.create(DataTextureLoader.prototype);EXRLoader.prototype._parser=function(buffer){function parseNullTerminatedString(buffer,offset){var uintBuffer=new Uint8Array(buffer);var endOffset=0;while(uintBuffer[offset.value+endOffset]!=0){endOffset+=1;}var stringValue=new TextDecoder().decode(new Uint8Array(buffer).slice(offset.value,offset.value+endOffset));offset.value=offset.value+endOffset+1;return stringValue;}function parseFixedLengthString(buffer,offset,size){var stringValue=new TextDecoder().decode(new Uint8Array(buffer).slice(offset.value,offset.value+size));offset.value=offset.value+size;return stringValue;}function parseUlong(buffer,offset){var uLong=new DataView(buffer.slice(offset.value,offset.value+4)).getUint32(0,true);offset.value=offset.value+8;return uLong;}function parseUint32(buffer,offset){var Uint32=new DataView(buffer.slice(offset.value,offset.value+4)).getUint32(0,true);offset.value=offset.value+4;return Uint32;}function parseUint8(buffer,offset){var Uint8=new DataView(buffer.slice(offset.value,offset.value+1)).getUint8(0,true);offset.value=offset.value+1;return Uint8;}function parseFloat32(buffer,offset){var float=new DataView(buffer.slice(offset.value,offset.value+4)).getFloat32(0,true);offset.value+=4;return float;}// https://stackoverflow.com/questions/5678432/decompressing-half-precision-floats-in-javascript
  function decodeFloat16(binary){var exponent=(binary&0x7C00)>>10,fraction=binary&0x03FF;return(binary>>15?-1:1)*(exponent?exponent===0x1F?fraction?NaN:Infinity:Math.pow(2,exponent-15)*(1+fraction/0x400):6.103515625e-5*(fraction/0x400));}function parseFloat16(buffer,offset){var float=new DataView(buffer.slice(offset.value,offset.value+2)).getUint16(0,true);offset.value+=2;return decodeFloat16(float);}function parseChlist(buffer,offset,size){var startOffset=offset.value;var channels=[];while(offset.value<startOffset+size-1){var name=parseNullTerminatedString(buffer,offset);var pixelType=parseUint32(buffer,offset);// TODO: Cast this to UINT, HALF or FLOAT
  var pLinear=parseUint8(buffer,offset);offset.value+=3;// reserved, three chars
  var xSampling=parseUint32(buffer,offset);var ySampling=parseUint32(buffer,offset);channels.push({name:name,pixelType:pixelType,pLinear:pLinear,xSampling:xSampling,ySampling:ySampling});}offset.value+=1;return channels;}function parseChromaticities(buffer,offset){var redX=parseFloat32(buffer,offset);var redY=parseFloat32(buffer,offset);var greenX=parseFloat32(buffer,offset);var greenY=parseFloat32(buffer,offset);var blueX=parseFloat32(buffer,offset);var blueY=parseFloat32(buffer,offset);var whiteX=parseFloat32(buffer,offset);var whiteY=parseFloat32(buffer,offset);return{redX:redX,redY:redY,greenX:greenX,greenY:greenY,blueX:blueX,blueY:blueY,whiteX:whiteX,whiteY:whiteY};}function parseCompression(buffer,offset){var compressionCodes=['NO_COMPRESSION','PIZ_COMPRESSION'];var compression=parseUint8(buffer,offset);return compressionCodes[compression];}function parseBox2i(buffer,offset){var xMin=parseUint32(buffer,offset);var yMin=parseUint32(buffer,offset);var xMax=parseUint32(buffer,offset);var yMax=parseUint32(buffer,offset);return{xMin:xMin,yMin:yMin,xMax:xMax,yMax:yMax};}function parseLineOrder(buffer,offset){var lineOrders=['INCREASING_Y'];var lineOrder=parseUint8(buffer,offset);return lineOrders[lineOrder];}function parseV2f(buffer,offset){var x=parseFloat32(buffer,offset);var y=parseFloat32(buffer,offset);return[x,y];}function parseValue(buffer,offset,type,size){if(type=='string'||type=='iccProfile'){return parseFixedLengthString(buffer,offset,size);}else if(type=='chlist'){return parseChlist(buffer,offset,size);}else if(type=='chromaticities'){return parseChromaticities(buffer,offset);}else if(type=='compression'){return parseCompression(buffer,offset);}else if(type=='box2i'){return parseBox2i(buffer,offset);}else if(type=='lineOrder'){return parseLineOrder(buffer,offset);}else if(type=='float'){return parseFloat32(buffer,offset);}else if(type=='v2f'){return parseV2f(buffer,offset);}else{throw'Cannot parse value for unsupported type: '+type;}}var EXRHeader={};var magic=new DataView(buffer).getUint32(0,true);var versionByteZero=new DataView(buffer).getUint8(4,true);var fullMask=new DataView(buffer).getUint8(5,true);// start of header
  var offset={value:8};// start at 8, after magic stuff
  var keepReading=true;while(keepReading){var attributeName=parseNullTerminatedString(buffer,offset);if(attributeName==0){keepReading=false;}else{var attributeType=parseNullTerminatedString(buffer,offset);var attributeSize=parseUint32(buffer,offset);var attributeValue=parseValue(buffer,offset,attributeType,attributeSize);EXRHeader[attributeName]=attributeValue;}}// offsets
  var dataWindowHeight=EXRHeader.dataWindow.yMax+1;var scanlineBlockSize=1;// 1 for no compression, 32 for PIZ
  var numBlocks=dataWindowHeight/scanlineBlockSize;for(var i=0;i<numBlocks;i++){var scanlineOffset=parseUlong(buffer,offset);}// we should be passed the scanline offset table, start reading pixel data
  var width=EXRHeader.dataWindow.xMax-EXRHeader.dataWindow.xMin+1;var height=EXRHeader.dataWindow.yMax-EXRHeader.dataWindow.yMin+1;var numChannels=EXRHeader.channels.length;var byteArray=new Float32Array(width*height*numChannels);var channelOffsets={R:0,G:1,B:2,A:3};for(var y=0;y<height;y++){var y_scanline=parseUint32(buffer,offset);var dataSize=parseUint32(buffer,offset);for(var channelID=0;channelID<EXRHeader.channels.length;channelID++){if(EXRHeader.channels[channelID].pixelType==1){// HALF
  for(var x=0;x<width;x++){var val=parseFloat16(buffer,offset);var cOff=channelOffsets[EXRHeader.channels[channelID].name];byteArray[(width-y_scanline)*(height*numChannels)+x*numChannels+cOff]=val;}}else{throw'Only supported pixel format is HALF';}}}return{header:EXRHeader,width:width,height:height,data:byteArray,format:RGBAFormat,type:FloatType};};/**
   * @author Kyle-Larson https://github.com/Kyle-Larson
   * @author Takahiro https://github.com/takahirox
   * @author Lewy Blue https://github.com/looeee
   *
   * Loader loads FBX file and generates Group representing FBX scene.
   * Requires FBX file to be >= 7.0 and in ASCII or to be any version in Binary format.
   *
   * Supports:
   * 	Mesh Generation (Positional Data)
   * 	Normal Data (Per Vertex Drawing Instance)
   *	UV Data (Per Vertex Drawing Instance)
   *	Skinning
   *	Animation
   * 	- Separated Animations based on stacks.
   * 	- Skeletal & Non-Skeletal Animations
   *	NURBS (Open, Closed and Periodic forms)
   *
   * Needs Support:
   *	Euler rotation order
   *
   *
   * FBX format references:
   * 	https://wiki.blender.org/index.php/User:Mont29/Foundation/FBX_File_Structure
   *
   * 	Binary format specification:
   *		https://code.blender.org/2013/08/fbx-binary-file-format-specification/
   *		https://wiki.rogiken.org/specifications/file-format/fbx/ (more detail but Japanese)
   */var FBXLoader=function FBXLoader(manager){this.manager=manager!==undefined?manager:DefaultLoadingManager;};Object.assign(FBXLoader.prototype,{load:function load(url,onLoad,onProgress,onError){var self=this;var resourceDirectory=LoaderUtils.extractUrlBase(url);var loader=new FileLoader(this.manager);loader.setResponseType('arraybuffer');loader.load(url,function(buffer){try{var scene=self.parse(buffer,resourceDirectory);onLoad(scene);}catch(error){window.setTimeout(function(){if(onError){onError(error);}self.manager.itemError(url);},0);}},onProgress,onError);},parse:function parse(FBXBuffer,resourceDirectory){var FBXTree;if(isFbxFormatBinary(FBXBuffer)){FBXTree=new BinaryParser().parse(FBXBuffer);}else{var FBXText=convertArrayBufferToString(FBXBuffer);if(!isFbxFormatASCII(FBXText)){throw new Error('FBXLoader: Unknown format.');}if(getFbxVersion(FBXText)<7000){throw new Error('FBXLoader: FBX version not supported, FileVersion: '+getFbxVersion(FBXText));}FBXTree=new TextParser().parse(FBXText);}// console.log( FBXTree );
  var connections=parseConnections(FBXTree);var images=parseImages(FBXTree);var textures=parseTextures(FBXTree,new TextureLoader(this.manager).setPath(resourceDirectory),images,connections);var materials=parseMaterials(FBXTree,textures,connections);var skeletons=parseDeformers(FBXTree,connections);var geometryMap=parseGeometries(FBXTree,connections,skeletons);var sceneGraph=parseScene(FBXTree,connections,skeletons,geometryMap,materials);return sceneGraph;}});// Parses FBXTree.Connections which holds parent-child connections between objects (e.g. material -> texture, model->geometry )
  // and details the connection type
  function parseConnections(FBXTree){var connectionMap=new Map();if('Connections'in FBXTree){var rawConnections=FBXTree.Connections.properties.connections;rawConnections.forEach(function(rawConnection){var fromID=rawConnection[0];var toID=rawConnection[1];var relationship=rawConnection[2];if(!connectionMap.has(fromID)){connectionMap.set(fromID,{parents:[],children:[]});}var parentRelationship={ID:toID,relationship:relationship};connectionMap.get(fromID).parents.push(parentRelationship);if(!connectionMap.has(toID)){connectionMap.set(toID,{parents:[],children:[]});}var childRelationship={ID:fromID,relationship:relationship};connectionMap.get(toID).children.push(childRelationship);});}return connectionMap;}// Parse FBXTree.Objects.subNodes.Video for embedded image data
  // These images are connected to textures in FBXTree.Objects.subNodes.Textures
  // via FBXTree.Connections. Note that images can be duplicated here, in which case only one
  // may have a .Content field - we'll check for this and duplicate the data in the imageMap
  function parseImages(FBXTree){var imageMap=new Map();var names={};var duplicates=[];if('Video'in FBXTree.Objects.subNodes){var videoNodes=FBXTree.Objects.subNodes.Video;for(var nodeID in videoNodes){var videoNode=videoNodes[nodeID];var id=parseInt(nodeID);// check whether the file name is used by another videoNode
  // and if so keep a record of both ids as a duplicate pair [ id1, id2 ]
  if(videoNode.properties.fileName in names){duplicates.push([id,names[videoNode.properties.fileName]]);}names[videoNode.properties.fileName]=id;// raw image data is in videoNode.properties.Content
  if('Content'in videoNode.properties&&videoNode.properties.Content!==''){var image=parseImage(videoNodes[nodeID]);imageMap.set(id,image);}}}// check each duplicate pair - if only one is in the image map then
  // create an entry for the other id containing the same image data
  // Note: it seems to be possible for entries to have the same file name but different
  // content, we won't overwrite these
  duplicates.forEach(function(duplicatePair){if(imageMap.has(duplicatePair[0])&&!imageMap.has(duplicatePair[1])){var image=imageMap.get(duplicatePair[0]);imageMap.set(duplicatePair[1],image);}else if(imageMap.has(duplicatePair[1])&&!imageMap.has(duplicatePair[0])){var image=imageMap.get(duplicatePair[1]);imageMap.set(duplicatePair[0],image);}});return imageMap;}// Parse embedded image data in FBXTree.Video.properties.Content
  function parseImage(videoNode){var content=videoNode.properties.Content;var fileName=videoNode.properties.RelativeFilename||videoNode.properties.Filename;var extension=fileName.slice(fileName.lastIndexOf('.')+1).toLowerCase();var type;switch(extension){case'bmp':type='image/bmp';break;case'jpg':case'jpeg':type='image/jpeg';break;case'png':type='image/png';break;case'tif':type='image/tiff';break;default:console.warn('FBXLoader: Image type "'+extension+'" is not supported.');return;}if(typeof content==='string'){// ASCII format
  return'data:'+type+';base64,'+content;}else{// Binary Format
  var array=new Uint8Array(content);return window.URL.createObjectURL(new Blob([array],{type:type}));}}// Parse nodes in FBXTree.Objects.subNodes.Texture
  // These contain details such as UV scaling, cropping, rotation etc and are connected
  // to images in FBXTree.Objects.subNodes.Video
  function parseTextures(FBXTree,loader,imageMap,connections){var textureMap=new Map();if('Texture'in FBXTree.Objects.subNodes){var textureNodes=FBXTree.Objects.subNodes.Texture;for(var nodeID in textureNodes){var texture=parseTexture(textureNodes[nodeID],loader,imageMap,connections);textureMap.set(parseInt(nodeID),texture);}}return textureMap;}// Parse individual node in FBXTree.Objects.subNodes.Texture
  function parseTexture(textureNode,loader,imageMap,connections){var texture=loadTexture(textureNode,loader,imageMap,connections);texture.ID=textureNode.id;texture.name=textureNode.attrName;var wrapModeU=textureNode.properties.WrapModeU;var wrapModeV=textureNode.properties.WrapModeV;var valueU=wrapModeU!==undefined?wrapModeU.value:0;var valueV=wrapModeV!==undefined?wrapModeV.value:0;// http://download.autodesk.com/us/fbx/SDKdocs/FBX_SDK_Help/files/fbxsdkref/class_k_fbx_texture.html#889640e63e2e681259ea81061b85143a
  // 0: repeat(default), 1: clamp
  texture.wrapS=valueU===0?RepeatWrapping:ClampToEdgeWrapping;texture.wrapT=valueV===0?RepeatWrapping:ClampToEdgeWrapping;if('Scaling'in textureNode.properties){var values=textureNode.properties.Scaling.value;texture.repeat.x=values[0];texture.repeat.y=values[1];}return texture;}// load a texture specified as a blob or data URI, or via an external URL using TextureLoader
  function loadTexture(textureNode,loader,imageMap,connections){var fileName;var filePath=textureNode.properties.FileName;var relativeFilePath=textureNode.properties.RelativeFilename;var children=connections.get(textureNode.id).children;if(children!==undefined&&children.length>0&&imageMap.has(children[0].ID)){fileName=imageMap.get(children[0].ID);}// check that relative path is not an actually an absolute path and if so use it to load texture
  else if(relativeFilePath!==undefined&&relativeFilePath[0]!=='/'&&relativeFilePath.match(/^[a-zA-Z]:/)===null){fileName=relativeFilePath;}// texture specified by absolute path
  else{var split=filePath.split(/[\\\/]/);if(split.length>0){fileName=split[split.length-1];}else{fileName=filePath;}}var currentPath=loader.path;if(fileName.indexOf('blob:')===0||fileName.indexOf('data:')===0){loader.setPath(undefined);}var texture=loader.load(fileName);loader.setPath(currentPath);return texture;}// Parse nodes in FBXTree.Objects.subNodes.Material
  function parseMaterials(FBXTree,textureMap,connections){var materialMap=new Map();if('Material'in FBXTree.Objects.subNodes){var materialNodes=FBXTree.Objects.subNodes.Material;for(var nodeID in materialNodes){var material=parseMaterial(FBXTree,materialNodes[nodeID],textureMap,connections);if(material!==null){materialMap.set(parseInt(nodeID),material);}}}return materialMap;}// Parse single node in FBXTree.Objects.subNodes.Material
  // Materials are connected to texture maps in FBXTree.Objects.subNodes.Textures
  // FBX format currently only supports Lambert and Phong shading models
  function parseMaterial(FBXTree,materialNode,textureMap,connections){var ID=materialNode.id;var name=materialNode.attrName;var type=materialNode.properties.ShadingModel;//Case where FBX wraps shading model in property object.
  if((typeof type==='undefined'?'undefined':_typeof(type))==='object'){type=type.value;}// Ignore unused materials which don't have any connections.
  if(!connections.has(ID)){return null;}var parameters=parseParameters(FBXTree,materialNode.properties,textureMap,ID,connections);var material;switch(type.toLowerCase()){case'phong':material=new MeshPhongMaterial();break;case'lambert':material=new MeshLambertMaterial$1();break;default:console.warn('FBXLoader: unknown material type "%s". Defaulting to MeshPhongMaterial.',type);material=new MeshPhongMaterial({color:0x3300ff});break;}material.setValues(parameters);material.name=name;return material;}// Parse FBX material and return parameters suitable for a three.js material
  // Also parse the texture map and return any textures associated with the material
  function parseParameters(FBXTree,properties,textureMap,ID,connections){var parameters={};if(properties.BumpFactor){parameters.bumpScale=properties.BumpFactor.value;}if(properties.Diffuse){parameters.color=parseColor(properties.Diffuse);}if(properties.DisplacementFactor){parameters.displacementScale=properties.DisplacementFactor.value;}if(properties.ReflectionFactor){parameters.reflectivity=properties.ReflectionFactor.value;}if(properties.Specular){parameters.specular=parseColor(properties.Specular);}if(properties.Shininess){parameters.shininess=properties.Shininess.value;}if(properties.Emissive){parameters.emissive=parseColor(properties.Emissive);}if(properties.EmissiveFactor){parameters.emissiveIntensity=parseFloat(properties.EmissiveFactor.value);}if(properties.Opacity){parameters.opacity=parseFloat(properties.Opacity.value);}if(parameters.opacity<1.0){parameters.transparent=true;}connections.get(ID).children.forEach(function(child){var type=child.relationship;switch(type){case'Bump':parameters.bumpMap=textureMap.get(child.ID);break;case'DiffuseColor':parameters.map=getTexture(FBXTree,textureMap,child.ID,connections);break;case'DisplacementColor':parameters.displacementMap=getTexture(FBXTree,textureMap,child.ID,connections);break;case'EmissiveColor':parameters.emissiveMap=getTexture(FBXTree,textureMap,child.ID,connections);break;case'NormalMap':parameters.normalMap=getTexture(FBXTree,textureMap,child.ID,connections);break;case'ReflectionColor':parameters.envMap=getTexture(FBXTree,textureMap,child.ID,connections);parameters.envMap.mapping=EquirectangularReflectionMapping;break;case'SpecularColor':parameters.specularMap=getTexture(FBXTree,textureMap,child.ID,connections);break;case'TransparentColor':parameters.alphaMap=getTexture(FBXTree,textureMap,child.ID,connections);parameters.transparent=true;break;case'AmbientColor':case'ShininessExponent':// AKA glossiness map
  case'SpecularFactor':// AKA specularLevel
  case'VectorDisplacementColor':// NOTE: Seems to be a copy of DisplacementColor
  default:console.warn('FBXLoader: %s map is not supported in three.js, skipping texture.',type);break;}});return parameters;}// get a texture from the textureMap for use by a material.
  function getTexture(FBXTree,textureMap,id,connections){// if the texture is a layered texture, just use the first layer and issue a warning
  if('LayeredTexture'in FBXTree.Objects.subNodes&&id in FBXTree.Objects.subNodes.LayeredTexture){console.warn('FBXLoader: layered textures are not supported in three.js. Discarding all but first layer.');id=connections.get(id).children[0].ID;}return textureMap.get(id);}// Parse nodes in FBXTree.Objects.subNodes.Deformer
  // Deformer node can contain skinning or Vertex Cache animation data, however only skinning is supported here
  // Generates map of Skeleton-like objects for use later when generating and binding skeletons.
  function parseDeformers(FBXTree,connections){var skeletons={};if('Deformer'in FBXTree.Objects.subNodes){var DeformerNodes=FBXTree.Objects.subNodes.Deformer;for(var nodeID in DeformerNodes){var deformerNode=DeformerNodes[nodeID];if(deformerNode.attrType==='Skin'){var relationships=connections.get(parseInt(nodeID));var skeleton=parseSkeleton(relationships,DeformerNodes);skeleton.ID=nodeID;if(relationships.parents.length>1){console.warn('FBXLoader: skeleton attached to more than one geometry is not supported.');}skeleton.geometryID=relationships.parents[0].ID;skeletons[nodeID]=skeleton;}}}return skeletons;}// Parse single nodes in FBXTree.Objects.subNodes.Deformer
  // The top level deformer nodes have type 'Skin' and subDeformer nodes have type 'Cluster'
  // Each skin node represents a skeleton and each cluster node represents a bone
  function parseSkeleton(connections,deformerNodes){var rawBones=[];connections.children.forEach(function(child){var subDeformerNode=deformerNodes[child.ID];if(subDeformerNode.attrType!=='Cluster'){return;}var rawBone={ID:child.ID,indices:[],weights:[],// the global initial transform of the geometry node this bone is connected to
  transform:new Matrix4().fromArray(subDeformerNode.subNodes.Transform.properties.a),// the global initial transform of this bone
  transformLink:new Matrix4().fromArray(subDeformerNode.subNodes.TransformLink.properties.a)};if('Indexes'in subDeformerNode.subNodes){rawBone.indices=subDeformerNode.subNodes.Indexes.properties.a;rawBone.weights=subDeformerNode.subNodes.Weights.properties.a;}rawBones.push(rawBone);});return{rawBones:rawBones,bones:[]};}// Parse nodes in FBXTree.Objects.subNodes.Geometry
  function parseGeometries(FBXTree,connections,skeletons){var geometryMap=new Map();if('Geometry'in FBXTree.Objects.subNodes){var geometryNodes=FBXTree.Objects.subNodes.Geometry;for(var nodeID in geometryNodes){var relationships=connections.get(parseInt(nodeID));var geo=parseGeometry(FBXTree,relationships,geometryNodes[nodeID],skeletons);geometryMap.set(parseInt(nodeID),geo);}}return geometryMap;}// Parse single node in FBXTree.Objects.subNodes.Geometry
  function parseGeometry(FBXTree,relationships,geometryNode,skeletons){switch(geometryNode.attrType){case'Mesh':return parseMeshGeometry(FBXTree,relationships,geometryNode,skeletons);break;case'NurbsCurve':return parseNurbsGeometry(geometryNode);break;}}// Parse single node mesh geometry in FBXTree.Objects.subNodes.Geometry
  function parseMeshGeometry(FBXTree,relationships,geometryNode,skeletons){var modelNodes=relationships.parents.map(function(parent){return FBXTree.Objects.subNodes.Model[parent.ID];});// don't create geometry if it is not associated with any models
  if(modelNodes.length===0){return;}var skeleton=relationships.children.reduce(function(skeleton,child){if(skeletons[child.ID]!==undefined){skeleton=skeletons[child.ID];}return skeleton;},null);var preTransform=new Matrix4();// TODO: if there is more than one model associated with the geometry, AND the models have
  // different geometric transforms, then this will cause problems
  // if ( modelNodes.length > 1 ) { }
  // For now just assume one model and get the preRotations from that
  var modelNode=modelNodes[0];if('GeometricRotation'in modelNode.properties){var array=modelNode.properties.GeometricRotation.value.map(Math.degToRad);array[3]='ZYX';preTransform.makeRotationFromEuler(new Euler().fromArray(array));}if('GeometricTranslation'in modelNode.properties){preTransform.setPosition(new Vector3$1().fromArray(modelNode.properties.GeometricTranslation.value));}return genGeometry(FBXTree,relationships,geometryNode,skeleton,preTransform);}// Generate a BufferGeometry from a node in FBXTree.Objects.subNodes.Geometry
  function genGeometry(FBXTree,relationships,geometryNode,skeleton,preTransform){var subNodes=geometryNode.subNodes;var vertexPositions=subNodes.Vertices.properties.a;var vertexIndices=subNodes.PolygonVertexIndex.properties.a;// create arrays to hold the final data used to build the buffergeometry
  var vertexBuffer=[];var normalBuffer=[];var colorsBuffer=[];var uvsBuffer=[];var materialIndexBuffer=[];var vertexWeightsBuffer=[];var weightsIndicesBuffer=[];if(subNodes.LayerElementColor){var colorInfo=getColors(subNodes.LayerElementColor[0]);}if(subNodes.LayerElementMaterial){var materialInfo=getMaterials(subNodes.LayerElementMaterial[0]);}if(subNodes.LayerElementNormal){var normalInfo=getNormals(subNodes.LayerElementNormal[0]);}if(subNodes.LayerElementUV){var uvInfo=[];var i=0;while(subNodes.LayerElementUV[i]){uvInfo.push(getUVs(subNodes.LayerElementUV[i]));i++;}}var weightTable={};if(skeleton!==null){skeleton.rawBones.forEach(function(rawBone,i){// loop over the bone's vertex indices and weights
  rawBone.indices.forEach(function(index,j){if(weightTable[index]===undefined){weightTable[index]=[];}weightTable[index].push({id:i,weight:rawBone.weights[j]});});});}var polygonIndex=0;var faceLength=0;var displayedWeightsWarning=false;// these will hold data for a single face
  var vertexPositionIndexes=[];var faceNormals=[];var faceColors=[];var faceUVs=[];var faceWeights=[];var faceWeightIndices=[];vertexIndices.forEach(function(vertexIndex,polygonVertexIndex){var endOfFace=false;// Face index and vertex index arrays are combined in a single array
  // A cube with quad faces looks like this:
  // PolygonVertexIndex: *24 {
  //  a: 0, 1, 3, -3, 2, 3, 5, -5, 4, 5, 7, -7, 6, 7, 1, -1, 1, 7, 5, -4, 6, 0, 2, -5
  //  }
  // Negative numbers mark the end of a face - first face here is 0, 1, 3, -3
  // to find index of last vertex multiply by -1 and subtract 1: -3 * - 1 - 1 = 2
  if(vertexIndex<0){vertexIndex=vertexIndex^-1;// equivalent to ( x * -1 ) - 1
  vertexIndices[polygonVertexIndex]=vertexIndex;endOfFace=true;}var weightIndices=[];var weights=[];vertexPositionIndexes.push(vertexIndex*3,vertexIndex*3+1,vertexIndex*3+2);if(colorInfo){var data=getData(polygonVertexIndex,polygonIndex,vertexIndex,colorInfo);faceColors.push(data[0],data[1],data[2]);}if(skeleton){if(weightTable[vertexIndex]!==undefined){weightTable[vertexIndex].forEach(function(wt){weights.push(wt.weight);weightIndices.push(wt.id);});}if(weights.length>4){if(!displayedWeightsWarning){console.warn('FBXLoader: Vertex has more than 4 skinning weights assigned to vertex. Deleting additional weights.');displayedWeightsWarning=true;}var wIndex=[0,0,0,0];var Weight=[0,0,0,0];weights.forEach(function(weight,weightIndex){var currentWeight=weight;var currentIndex=weightIndices[weightIndex];Weight.forEach(function(comparedWeight,comparedWeightIndex,comparedWeightArray){if(currentWeight>comparedWeight){comparedWeightArray[comparedWeightIndex]=currentWeight;currentWeight=comparedWeight;var tmp=wIndex[comparedWeightIndex];wIndex[comparedWeightIndex]=currentIndex;currentIndex=tmp;}});});weightIndices=wIndex;weights=Weight;}// if the weight array is shorter than 4 pad with 0s
  while(weights.length<4){weights.push(0);weightIndices.push(0);}for(var i=0;i<4;++i){faceWeights.push(weights[i]);faceWeightIndices.push(weightIndices[i]);}}if(normalInfo){var data=getData(polygonVertexIndex,polygonIndex,vertexIndex,normalInfo);faceNormals.push(data[0],data[1],data[2]);}if(materialInfo&&materialInfo.mappingType!=='AllSame'){var materialIndex=getData(polygonVertexIndex,polygonIndex,vertexIndex,materialInfo)[0];}if(uvInfo){uvInfo.forEach(function(uv,i){var data=getData(polygonVertexIndex,polygonIndex,vertexIndex,uv);if(faceUVs[i]===undefined){faceUVs[i]=[];}faceUVs[i].push(data[0]);faceUVs[i].push(data[1]);});}faceLength++;// we have reached the end of a face - it may have 4 sides though
  // in which case the data is split to represent two 3 sided faces
  if(endOfFace){for(var i=2;i<faceLength;i++){vertexBuffer.push(vertexPositions[vertexPositionIndexes[0]]);vertexBuffer.push(vertexPositions[vertexPositionIndexes[1]]);vertexBuffer.push(vertexPositions[vertexPositionIndexes[2]]);vertexBuffer.push(vertexPositions[vertexPositionIndexes[(i-1)*3]]);vertexBuffer.push(vertexPositions[vertexPositionIndexes[(i-1)*3+1]]);vertexBuffer.push(vertexPositions[vertexPositionIndexes[(i-1)*3+2]]);vertexBuffer.push(vertexPositions[vertexPositionIndexes[i*3]]);vertexBuffer.push(vertexPositions[vertexPositionIndexes[i*3+1]]);vertexBuffer.push(vertexPositions[vertexPositionIndexes[i*3+2]]);if(skeleton){vertexWeightsBuffer.push(faceWeights[0]);vertexWeightsBuffer.push(faceWeights[1]);vertexWeightsBuffer.push(faceWeights[2]);vertexWeightsBuffer.push(faceWeights[3]);vertexWeightsBuffer.push(faceWeights[(i-1)*4]);vertexWeightsBuffer.push(faceWeights[(i-1)*4+1]);vertexWeightsBuffer.push(faceWeights[(i-1)*4+2]);vertexWeightsBuffer.push(faceWeights[(i-1)*4+3]);vertexWeightsBuffer.push(faceWeights[i*4]);vertexWeightsBuffer.push(faceWeights[i*4+1]);vertexWeightsBuffer.push(faceWeights[i*4+2]);vertexWeightsBuffer.push(faceWeights[i*4+3]);weightsIndicesBuffer.push(faceWeightIndices[0]);weightsIndicesBuffer.push(faceWeightIndices[1]);weightsIndicesBuffer.push(faceWeightIndices[2]);weightsIndicesBuffer.push(faceWeightIndices[3]);weightsIndicesBuffer.push(faceWeightIndices[(i-1)*4]);weightsIndicesBuffer.push(faceWeightIndices[(i-1)*4+1]);weightsIndicesBuffer.push(faceWeightIndices[(i-1)*4+2]);weightsIndicesBuffer.push(faceWeightIndices[(i-1)*4+3]);weightsIndicesBuffer.push(faceWeightIndices[i*4]);weightsIndicesBuffer.push(faceWeightIndices[i*4+1]);weightsIndicesBuffer.push(faceWeightIndices[i*4+2]);weightsIndicesBuffer.push(faceWeightIndices[i*4+3]);}if(colorInfo){colorsBuffer.push(faceColors[0]);colorsBuffer.push(faceColors[1]);colorsBuffer.push(faceColors[2]);colorsBuffer.push(faceColors[(i-1)*3]);colorsBuffer.push(faceColors[(i-1)*3+1]);colorsBuffer.push(faceColors[(i-1)*3+2]);colorsBuffer.push(faceColors[i*3]);colorsBuffer.push(faceColors[i*3+1]);colorsBuffer.push(faceColors[i*3+2]);}if(materialInfo&&materialInfo.mappingType!=='AllSame'){materialIndexBuffer.push(materialIndex);materialIndexBuffer.push(materialIndex);materialIndexBuffer.push(materialIndex);}if(normalInfo){normalBuffer.push(faceNormals[0]);normalBuffer.push(faceNormals[1]);normalBuffer.push(faceNormals[2]);normalBuffer.push(faceNormals[(i-1)*3]);normalBuffer.push(faceNormals[(i-1)*3+1]);normalBuffer.push(faceNormals[(i-1)*3+2]);normalBuffer.push(faceNormals[i*3]);normalBuffer.push(faceNormals[i*3+1]);normalBuffer.push(faceNormals[i*3+2]);}if(uvInfo){uvInfo.forEach(function(uv,j){if(uvsBuffer[j]===undefined){uvsBuffer[j]=[];}uvsBuffer[j].push(faceUVs[j][0]);uvsBuffer[j].push(faceUVs[j][1]);uvsBuffer[j].push(faceUVs[j][(i-1)*2]);uvsBuffer[j].push(faceUVs[j][(i-1)*2+1]);uvsBuffer[j].push(faceUVs[j][i*2]);uvsBuffer[j].push(faceUVs[j][i*2+1]);});}}polygonIndex++;endOfFace=false;faceLength=0;// reset arrays for the next face
  vertexPositionIndexes=[];faceNormals=[];faceColors=[];faceUVs=[];faceWeights=[];faceWeightIndices=[];}});var geo=new BufferGeometry();geo.name=geometryNode.name;var positionAttribute=new Float32BufferAttribute(vertexBuffer,3);preTransform.applyToBufferAttribute(positionAttribute);geo.addAttribute('position',positionAttribute);if(colorsBuffer.length>0){geo.addAttribute('color',new Float32BufferAttribute(colorsBuffer,3));}if(skeleton){geo.addAttribute('skinIndex',new Float32BufferAttribute(weightsIndicesBuffer,4));geo.addAttribute('skinWeight',new Float32BufferAttribute(vertexWeightsBuffer,4));// used later to bind the skeleton to the model
  geo.FBX_Deformer=skeleton;}if(normalBuffer.length>0){geo.addAttribute('normal',new Float32BufferAttribute(normalBuffer,3));}uvsBuffer.forEach(function(uvBuffer,i){// subsequent uv buffers are called 'uv1', 'uv2', ...
  var name='uv'+(i+1).toString();// the first uv buffer is just called 'uv'
  if(i===0){name='uv';}geo.addAttribute(name,new Float32BufferAttribute(uvsBuffer[i],2));});if(materialInfo&&materialInfo.mappingType!=='AllSame'){// Convert the material indices of each vertex into rendering groups on the geometry.
  var prevMaterialIndex=materialIndexBuffer[0];var startIndex=0;materialIndexBuffer.forEach(function(currentIndex,i){if(currentIndex!==prevMaterialIndex){geo.addGroup(startIndex,i-startIndex,prevMaterialIndex);prevMaterialIndex=currentIndex;startIndex=i;}});// the loop above doesn't add the last group, do that here.
  if(geo.groups.length>0){var lastGroup=geo.groups[geo.groups.length-1];var lastIndex=lastGroup.start+lastGroup.count;if(lastIndex!==materialIndexBuffer.length){geo.addGroup(lastIndex,materialIndexBuffer.length-lastIndex,prevMaterialIndex);}}// case where there are multiple materials but the whole geometry is only
  // using one of them
  if(geo.groups.length===0){geo.addGroup(0,materialIndexBuffer.length,materialIndexBuffer[0]);}}return geo;}// Parse normal from FBXTree.Objects.subNodes.Geometry.subNodes.LayerElementNormal if it exists
  function getNormals(NormalNode){var mappingType=NormalNode.properties.MappingInformationType;var referenceType=NormalNode.properties.ReferenceInformationType;var buffer=NormalNode.subNodes.Normals.properties.a;var indexBuffer=[];if(referenceType==='IndexToDirect'){if('NormalIndex'in NormalNode.subNodes){indexBuffer=NormalNode.subNodes.NormalIndex.properties.a;}else if('NormalsIndex'in NormalNode.subNodes){indexBuffer=NormalNode.subNodes.NormalsIndex.properties.a;}}return{dataSize:3,buffer:buffer,indices:indexBuffer,mappingType:mappingType,referenceType:referenceType};}// Parse UVs from FBXTree.Objects.subNodes.Geometry.subNodes.LayerElementUV if it exists
  function getUVs(UVNode){var mappingType=UVNode.properties.MappingInformationType;var referenceType=UVNode.properties.ReferenceInformationType;var buffer=UVNode.subNodes.UV.properties.a;var indexBuffer=[];if(referenceType==='IndexToDirect'){indexBuffer=UVNode.subNodes.UVIndex.properties.a;}return{dataSize:2,buffer:buffer,indices:indexBuffer,mappingType:mappingType,referenceType:referenceType};}// Parse Vertex Colors from FBXTree.Objects.subNodes.Geometry.subNodes.LayerElementColor if it exists
  function getColors(ColorNode){var mappingType=ColorNode.properties.MappingInformationType;var referenceType=ColorNode.properties.ReferenceInformationType;var buffer=ColorNode.subNodes.Colors.properties.a;var indexBuffer=[];if(referenceType==='IndexToDirect'){indexBuffer=ColorNode.subNodes.ColorIndex.properties.a;}return{dataSize:4,buffer:buffer,indices:indexBuffer,mappingType:mappingType,referenceType:referenceType};}// Parse mapping and material data in FBXTree.Objects.subNodes.Geometry.subNodes.LayerElementMaterial if it exists
  function getMaterials(MaterialNode){var mappingType=MaterialNode.properties.MappingInformationType;var referenceType=MaterialNode.properties.ReferenceInformationType;if(mappingType==='NoMappingInformation'){return{dataSize:1,buffer:[0],indices:[0],mappingType:'AllSame',referenceType:referenceType};}var materialIndexBuffer=MaterialNode.subNodes.Materials.properties.a;// Since materials are stored as indices, there's a bit of a mismatch between FBX and what
  // we expect.So we create an intermediate buffer that points to the index in the buffer,
  // for conforming with the other functions we've written for other data.
  var materialIndices=[];for(var i=0;i<materialIndexBuffer.length;++i){materialIndices.push(i);}return{dataSize:1,buffer:materialIndexBuffer,indices:materialIndices,mappingType:mappingType,referenceType:referenceType};}// Functions use the infoObject and given indices to return value array of geometry.
  // Parameters:
  // 	- polygonVertexIndex - Index of vertex in draw order (which index of the index buffer refers to this vertex).
  // 	- polygonIndex - Index of polygon in geometry.
  // 	- vertexIndex - Index of vertex inside vertex buffer (used because some data refers to old index buffer that we don't use anymore).
  // 	- infoObject: can be materialInfo, normalInfo, UVInfo or colorInfo
  // Index type:
  //	- Direct: index is same as polygonVertexIndex
  //	- IndexToDirect: infoObject has it's own set of indices
  var dataArray=[];var GetData={ByPolygonVertex:{Direct:function Direct(polygonVertexIndex,polygonIndex,vertexIndex,infoObject){var from=polygonVertexIndex*infoObject.dataSize;var to=polygonVertexIndex*infoObject.dataSize+infoObject.dataSize;return slice(dataArray,infoObject.buffer,from,to);},IndexToDirect:function IndexToDirect(polygonVertexIndex,polygonIndex,vertexIndex,infoObject){var index=infoObject.indices[polygonVertexIndex];var from=index*infoObject.dataSize;var to=index*infoObject.dataSize+infoObject.dataSize;return slice(dataArray,infoObject.buffer,from,to);}},ByPolygon:{Direct:function Direct(polygonVertexIndex,polygonIndex,vertexIndex,infoObject){var from=polygonIndex*infoObject.dataSize;var to=polygonIndex*infoObject.dataSize+infoObject.dataSize;return slice(dataArray,infoObject.buffer,from,to);},IndexToDirect:function IndexToDirect(polygonVertexIndex,polygonIndex,vertexIndex,infoObject){var index=infoObject.indices[polygonIndex];var from=index*infoObject.dataSize;var to=index*infoObject.dataSize+infoObject.dataSize;return slice(dataArray,infoObject.buffer,from,to);}},ByVertice:{Direct:function Direct(polygonVertexIndex,polygonIndex,vertexIndex,infoObject){var from=vertexIndex*infoObject.dataSize;var to=vertexIndex*infoObject.dataSize+infoObject.dataSize;return slice(dataArray,infoObject.buffer,from,to);}},AllSame:{IndexToDirect:function IndexToDirect(polygonVertexIndex,polygonIndex,vertexIndex,infoObject){var from=infoObject.indices[0]*infoObject.dataSize;var to=infoObject.indices[0]*infoObject.dataSize+infoObject.dataSize;return slice(dataArray,infoObject.buffer,from,to);}}};function getData(polygonVertexIndex,polygonIndex,vertexIndex,infoObject){return GetData[infoObject.mappingType][infoObject.referenceType](polygonVertexIndex,polygonIndex,vertexIndex,infoObject);}// Generate a NurbGeometry from a node in FBXTree.Objects.subNodes.Geometry
  function parseNurbsGeometry(geometryNode){if(NURBSCurve$1===undefined){console.error('FBXLoader: The loader relies on NURBSCurve for any nurbs present in the model. Nurbs will show up as empty geometry.');return new BufferGeometry();}var order=parseInt(geometryNode.properties.Order);if(isNaN(order)){console.error('FBXLoader: Invalid Order %s given for geometry ID: %s',geometryNode.properties.Order,geometryNode.id);return new BufferGeometry();}var degree=order-1;var knots=geometryNode.subNodes.KnotVector.properties.a;var controlPoints=[];var pointsValues=geometryNode.subNodes.Points.properties.a;for(var i=0,l=pointsValues.length;i<l;i+=4){controlPoints.push(new Vector4$1().fromArray(pointsValues,i));}var startKnot,endKnot;if(geometryNode.properties.Form==='Closed'){controlPoints.push(controlPoints[0]);}else if(geometryNode.properties.Form==='Periodic'){startKnot=degree;endKnot=knots.length-1-startKnot;for(var i=0;i<degree;++i){controlPoints.push(controlPoints[i]);}}var curve=new NURBSCurve$1(degree,knots,controlPoints,startKnot,endKnot);var vertices=curve.getPoints(controlPoints.length*7);var positions=new Float32Array(vertices.length*3);vertices.forEach(function(vertex,i){vertex.toArray(positions,i*3);});var geometry=new BufferGeometry();geometry.addAttribute('position',new BufferAttribute(positions,3));return geometry;}// create the main Group() to be returned by the loader
  function parseScene(FBXTree,connections,skeletons,geometryMap,materialMap){var sceneGraph=new Group();var modelMap=parseModels(FBXTree,skeletons,geometryMap,materialMap,connections);var modelNodes=FBXTree.Objects.subNodes.Model;modelMap.forEach(function(model){var modelNode=modelNodes[model.ID];setLookAtProperties(FBXTree,model,modelNode,connections,sceneGraph);var parentConnections=connections.get(model.ID).parents;parentConnections.forEach(function(connection){var parent=modelMap.get(connection.ID);if(parent!==undefined){parent.add(model);}});if(model.parent===null){sceneGraph.add(model);}});bindSkeleton(FBXTree,skeletons,geometryMap,modelMap,connections,sceneGraph);addAnimations(FBXTree,connections,sceneGraph,modelMap);createAmbientLight(FBXTree,sceneGraph);return sceneGraph;}// parse nodes in FBXTree.Objects.subNodes.Model
  function parseModels(FBXTree,skeletons,geometryMap,materialMap,connections){var modelMap=new Map();var modelNodes=FBXTree.Objects.subNodes.Model;for(var nodeID in modelNodes){var id=parseInt(nodeID);var node=modelNodes[nodeID];var relationships=connections.get(id);var model=buildSkeleton(relationships,skeletons,id,node.attrName);if(!model){switch(node.attrType){case'Camera':model=createCamera(FBXTree,relationships);break;case'Light':model=createLight(FBXTree,relationships);break;case'Mesh':model=createMesh(FBXTree,relationships,geometryMap,materialMap);break;case'NurbsCurve':model=createCurve(relationships,geometryMap);break;case'LimbNode':// usually associated with a Bone, however if a Bone was not created we'll make a Group instead
  case'Null':default:model=new Group();break;}model.name=PropertyBinding.sanitizeNodeName(node.attrName);model.ID=id;}setModelTransforms(FBXTree,model,node);modelMap.set(id,model);}return modelMap;}function buildSkeleton(relationships,skeletons,id,name){var bone=null;relationships.parents.forEach(function(parent){for(var ID in skeletons){var skeleton=skeletons[ID];skeleton.rawBones.forEach(function(rawBone,i){if(rawBone.ID===parent.ID){var subBone=bone;bone=new Bone$1();// set name and id here - otherwise in cases where "subBone" is created it will not have a name / id
  bone.name=PropertyBinding.sanitizeNodeName(name);bone.ID=id;skeleton.bones[i]=bone;// In cases where a bone is shared between multiple meshes
  // duplicate the bone here and and it as a child of the first bone
  if(subBone!==null){bone.add(subBone);}}});}});return bone;}// create a PerspectiveCamera or OrthographicCamera
  function createCamera(FBXTree,relationships){var model;var cameraAttribute;relationships.children.forEach(function(child){var attr=FBXTree.Objects.subNodes.NodeAttribute[child.ID];if(attr!==undefined&&attr.properties!==undefined){cameraAttribute=attr.properties;}});if(cameraAttribute===undefined){model=new Object3D();}else{var type=0;if(cameraAttribute.CameraProjectionType!==undefined&&cameraAttribute.CameraProjectionType.value===1){type=1;}var nearClippingPlane=1;if(cameraAttribute.NearPlane!==undefined){nearClippingPlane=cameraAttribute.NearPlane.value/1000;}var farClippingPlane=1000;if(cameraAttribute.FarPlane!==undefined){farClippingPlane=cameraAttribute.FarPlane.value/1000;}var width=window.innerWidth;var height=window.innerHeight;if(cameraAttribute.AspectWidth!==undefined&&cameraAttribute.AspectHeight!==undefined){width=cameraAttribute.AspectWidth.value;height=cameraAttribute.AspectHeight.value;}var aspect=width/height;var fov=45;if(cameraAttribute.FieldOfView!==undefined){fov=cameraAttribute.FieldOfView.value;}switch(type){case 0:// Perspective
  model=new PerspectiveCamera(fov,aspect,nearClippingPlane,farClippingPlane);break;case 1:// Orthographic
  model=new OrthographicCamera(-width/2,width/2,height/2,-height/2,nearClippingPlane,farClippingPlane);break;default:console.warn('FBXLoader: Unknown camera type '+type+'.');model=new Object3D();break;}}return model;}// Create a DirectionalLight, PointLight or SpotLight
  function createLight(FBXTree,relationships){var model;var lightAttribute;relationships.children.forEach(function(child){var attr=FBXTree.Objects.subNodes.NodeAttribute[child.ID];if(attr!==undefined&&attr.properties!==undefined){lightAttribute=attr.properties;}});if(lightAttribute===undefined){model=new Object3D();}else{var type;// LightType can be undefined for Point lights
  if(lightAttribute.LightType===undefined){type=0;}else{type=lightAttribute.LightType.value;}var color=0xffffff;if(lightAttribute.Color!==undefined){color=parseColor(lightAttribute.Color);}var intensity=lightAttribute.Intensity===undefined?1:lightAttribute.Intensity.value/100;// light disabled
  if(lightAttribute.CastLightOnObject!==undefined&&lightAttribute.CastLightOnObject.value===0){intensity=0;}var distance=0;if(lightAttribute.FarAttenuationEnd!==undefined){if(lightAttribute.EnableFarAttenuation!==undefined&&lightAttribute.EnableFarAttenuation.value===0){distance=0;}else{distance=lightAttribute.FarAttenuationEnd.value/1000;}}// TODO: could this be calculated linearly from FarAttenuationStart to FarAttenuationEnd?
  var decay=1;switch(type){case 0:// Point
  model=new PointLight(color,intensity,distance,decay);break;case 1:// Directional
  model=new DirectionalLight(color,intensity);break;case 2:// Spot
  var angle=Math.PI/3;if(lightAttribute.InnerAngle!==undefined){angle=Math.degToRad(lightAttribute.InnerAngle.value);}var penumbra=0;if(lightAttribute.OuterAngle!==undefined){// TODO: this is not correct - FBX calculates outer and inner angle in degrees
  // with OuterAngle > InnerAngle && OuterAngle <= Math.PI
  // while three.js uses a penumbra between (0, 1) to attenuate the inner angle
  penumbra=Math.degToRad(lightAttribute.OuterAngle.value);penumbra=Math.max(penumbra,1);}model=new SpotLight(color,intensity,distance,angle,penumbra,decay);break;default:console.warn('FBXLoader: Unknown light type '+lightAttribute.LightType.value+', defaulting to a PointLight.');model=new PointLight(color,intensity);break;}if(lightAttribute.CastShadows!==undefined&&lightAttribute.CastShadows.value===1){model.castShadow=true;}}return model;}function createMesh(FBXTree,relationships,geometryMap,materialMap){var model;var geometry=null;var material=null;var materials=[];// get geometry and materials(s) from connections
  relationships.children.forEach(function(child){if(geometryMap.has(child.ID)){geometry=geometryMap.get(child.ID);}if(materialMap.has(child.ID)){materials.push(materialMap.get(child.ID));}});if(materials.length>1){material=materials;}else if(materials.length>0){material=materials[0];}else{material=new MeshPhongMaterial({color:0xcccccc});materials.push(material);}if('color'in geometry.attributes){materials.forEach(function(material){material.vertexColors=VertexColors;});}if(geometry.FBX_Deformer){materials.forEach(function(material){material.skinning=true;});model=new SkinnedMesh(geometry,material);}else{model=new Mesh(geometry,material);}return model;}function createCurve(relationships,geometryMap){var geometry=relationships.children.reduce(function(geo,child){if(geometryMap.has(child.ID)){geo=geometryMap.get(child.ID);}return geo;},null);// FBX does not list materials for Nurbs lines, so we'll just put our own in here.
  var material=new LineBasicMaterial$1({color:0x3300ff,linewidth:1});return new Line$1(geometry,material);}// Parse ambient color in FBXTree.GlobalSettings.properties - if it's not set to black (default), create an ambient light
  function createAmbientLight(FBXTree,sceneGraph){if('GlobalSettings'in FBXTree&&'AmbientColor'in FBXTree.GlobalSettings.properties){var ambientColor=FBXTree.GlobalSettings.properties.AmbientColor.value;var r=ambientColor[0];var g=ambientColor[1];var b=ambientColor[2];if(r!==0||g!==0||b!==0){var color=new Color$1(r,g,b);sceneGraph.add(new AmbientLight(color,1));}}}function setLookAtProperties(FBXTree,model,modelNode,connections,sceneGraph){if('LookAtProperty'in modelNode.properties){var children=connections.get(model.ID).children;children.forEach(function(child){if(child.relationship==='LookAtProperty'){var lookAtTarget=FBXTree.Objects.subNodes.Model[child.ID];if('Lcl_Translation'in lookAtTarget.properties){var pos=lookAtTarget.properties.Lcl_Translation.value;// DirectionalLight, SpotLight
  if(model.target!==undefined){model.target.position.fromArray(pos);sceneGraph.add(model.target);}else{// Cameras and other Object3Ds
  model.lookAt(new Vector3$1().fromArray(pos));}}}});}}// parse the model node for transform details and apply them to the model
  function setModelTransforms(FBXTree,model,modelNode){// http://help.autodesk.com/view/FBX/2017/ENU/?guid=__cpp_ref_class_fbx_euler_html
  if('RotationOrder'in modelNode.properties){var enums=['XYZ',// default
  'XZY','YZX','ZXY','YXZ','ZYX','SphericXYZ'];var value=parseInt(modelNode.properties.RotationOrder.value,10);if(value>0&&value<6){// model.rotation.order = enums[ value ];
  // Note: Euler order other than XYZ is currently not supported, so just display a warning for now
  console.warn('FBXLoader: unsupported Euler Order: %s. Currently only XYZ order is supported. Animations and rotations may be incorrect.',enums[value]);}else if(value===6){console.warn('FBXLoader: unsupported Euler Order: Spherical XYZ. Animations and rotations may be incorrect.');}}if('Lcl_Translation'in modelNode.properties){model.position.fromArray(modelNode.properties.Lcl_Translation.value);}if('Lcl_Rotation'in modelNode.properties){var rotation=modelNode.properties.Lcl_Rotation.value.map(Math.degToRad);rotation.push('ZYX');model.rotation.fromArray(rotation);}if('Lcl_Scaling'in modelNode.properties){model.scale.fromArray(modelNode.properties.Lcl_Scaling.value);}if('PreRotation'in modelNode.properties){var array=modelNode.properties.PreRotation.value.map(Math.degToRad);array[3]='ZYX';var preRotations=new Euler().fromArray(array);preRotations=new Quaternion().setFromEuler(preRotations);var currentRotation=new Quaternion().setFromEuler(model.rotation);preRotations.multiply(currentRotation);model.rotation.setFromQuaternion(preRotations,'ZYX');}}function bindSkeleton(FBXTree,skeletons,geometryMap,modelMap,connections,sceneGraph){// Now with the bones created, we can update the skeletons and bind them to the skinned meshes.
  sceneGraph.updateMatrixWorld(true);var worldMatrices=new Map();// Put skeleton into bind pose.
  if('Pose'in FBXTree.Objects.subNodes){var BindPoseNode=FBXTree.Objects.subNodes.Pose;for(var nodeID in BindPoseNode){if(BindPoseNode[nodeID].attrType==='BindPose'){var poseNodes=BindPoseNode[nodeID].subNodes.PoseNode;if(Array.isArray(poseNodes)){poseNodes.forEach(function(node){var rawMatWrd=new Matrix4().fromArray(node.subNodes.Matrix.properties.a);worldMatrices.set(parseInt(node.properties.Node),rawMatWrd);});}else{var rawMatWrd=new Matrix4().fromArray(poseNodes.subNodes.Matrix.properties.a);worldMatrices.set(parseInt(poseNodes.properties.Node),rawMatWrd);}}}}for(var ID in skeletons){var skeleton=skeletons[ID];skeleton.bones.forEach(function(bone,i){// if the bone's initial transform is set in a poseNode, copy that
  if(worldMatrices.has(bone.ID)){var mat=worldMatrices.get(bone.ID);bone.matrixWorld.copy(mat);}// otherwise use the transform from the rawBone
  else{bone.matrixWorld.copy(skeleton.rawBones[i].transformLink);}});// Now that skeleton is in bind pose, bind to model.
  var parents=connections.get(parseInt(skeleton.ID)).parents;parents.forEach(function(parent){if(geometryMap.has(parent.ID)){var geoID=parent.ID;var geoRelationships=connections.get(geoID);geoRelationships.parents.forEach(function(geoConnParent){if(modelMap.has(geoConnParent.ID)){var model=modelMap.get(geoConnParent.ID);model.bind(new Skeleton$1(skeleton.bones),model.matrixWorld);}});}});}//Skeleton is now bound, return objects to starting world positions.
  sceneGraph.updateMatrixWorld(true);}function parseAnimations(FBXTree,connections){// since the actual transformation data is stored in FBXTree.Objects.subNodes.AnimationCurve,
  // if this is undefined we can safely assume there are no animations
  if(FBXTree.Objects.subNodes.AnimationCurve===undefined){return undefined;}var curveNodesMap=parseAnimationCurveNodes(FBXTree);parseAnimationCurves(FBXTree,connections,curveNodesMap);var layersMap=parseAnimationLayers(FBXTree,connections,curveNodesMap);var rawClips=parseAnimStacks(FBXTree,connections,layersMap);return rawClips;}// parse nodes in FBXTree.Objects.subNodes.AnimationCurveNode
  // each AnimationCurveNode holds data for an animation transform for a model (e.g. left arm rotation )
  // and is referenced by an AnimationLayer
  function parseAnimationCurveNodes(FBXTree){var rawCurveNodes=FBXTree.Objects.subNodes.AnimationCurveNode;var curveNodesMap=new Map();for(var nodeID in rawCurveNodes){var rawCurveNode=rawCurveNodes[nodeID];if(rawCurveNode.attrName.match(/S|R|T/)!==null){var curveNode={id:rawCurveNode.id,attr:rawCurveNode.attrName,curves:{}};}curveNodesMap.set(curveNode.id,curveNode);}return curveNodesMap;}// parse nodes in  FBXTree.Objects.subNodes.AnimationCurve and connect them up to
  // previously parsed AnimationCurveNodes. Each AnimationCurve holds data for a single animated
  // axis ( e.g. times and values of x rotation)
  function parseAnimationCurves(FBXTree,connections,curveNodesMap){var rawCurves=FBXTree.Objects.subNodes.AnimationCurve;for(var nodeID in rawCurves){var animationCurve={id:rawCurves[nodeID].id,times:rawCurves[nodeID].subNodes.KeyTime.properties.a.map(convertFBXTimeToSeconds),values:rawCurves[nodeID].subNodes.KeyValueFloat.properties.a};var relationships=connections.get(animationCurve.id);if(relationships!==undefined){var animationCurveID=relationships.parents[0].ID;var animationCurveRelationship=relationships.parents[0].relationship;var axis='';if(animationCurveRelationship.match(/X/)){axis='x';}else if(animationCurveRelationship.match(/Y/)){axis='y';}else if(animationCurveRelationship.match(/Z/)){axis='z';}else{continue;}curveNodesMap.get(animationCurveID).curves[axis]=animationCurve;}}}// parse nodes in FBXTree.Objects.subNodes.AnimationLayer. Each layers holds references
  // to various AnimationCurveNodes and is referenced by an AnimationStack node
  // note: theoretically a stack can multiple layers, however in practice there always seems to be one per stack
  function parseAnimationLayers(FBXTree,connections,curveNodesMap){var rawLayers=FBXTree.Objects.subNodes.AnimationLayer;var layersMap=new Map();for(var nodeID in rawLayers){var layerCurveNodes=[];var connection=connections.get(parseInt(nodeID));if(connection!==undefined){// all the animationCurveNodes used in the layer
  var children=connection.children;children.forEach(function(child,i){if(curveNodesMap.has(child.ID)){var curveNode=curveNodesMap.get(child.ID);if(layerCurveNodes[i]===undefined){var modelID;connections.get(child.ID).parents.forEach(function(parent){if(parent.relationship!==undefined){modelID=parent.ID;}});var rawModel=FBXTree.Objects.subNodes.Model[modelID.toString()];var node={modelName:PropertyBinding.sanitizeNodeName(rawModel.attrName),initialPosition:[0,0,0],initialRotation:[0,0,0],initialScale:[1,1,1]};if('Lcl_Translation'in rawModel.properties){node.initialPosition=rawModel.properties.Lcl_Translation.value;}if('Lcl_Rotation'in rawModel.properties){node.initialRotation=rawModel.properties.Lcl_Rotation.value;}if('Lcl_Scaling'in rawModel.properties){node.initialScale=rawModel.properties.Lcl_Scaling.value;}// if the animated model is pre rotated, we'll have to apply the pre rotations to every
  // animation value as well
  if('PreRotation'in rawModel.properties){node.preRotations=rawModel.properties.PreRotation.value;}layerCurveNodes[i]=node;}layerCurveNodes[i][curveNode.attr]=curveNode;}});layersMap.set(parseInt(nodeID),layerCurveNodes);}}return layersMap;}// parse nodes in FBXTree.Objects.subNodes.AnimationStack. These are the top level node in the animation
  // hierarchy. Each Stack node will be used to create a AnimationClip
  function parseAnimStacks(FBXTree,connections,layersMap){var rawStacks=FBXTree.Objects.subNodes.AnimationStack;// connect the stacks (clips) up to the layers
  var rawClips={};for(var nodeID in rawStacks){var children=connections.get(parseInt(nodeID)).children;if(children.length>1){// it seems like stacks will always be associated with a single layer. But just in case there are files
  // where there are multiple layers per stack, we'll display a warning
  console.warn('FBXLoader: Encountered an animation stack with multiple layers, this is currently not supported. Ignoring subsequent layers.');}var layer=layersMap.get(children[0].ID);rawClips[nodeID]={name:rawStacks[nodeID].attrName,layer:layer};}return rawClips;}// take raw animation data from parseAnimations and connect it up to the loaded models
  function addAnimations(FBXTree,connections,sceneGraph){sceneGraph.animations=[];var rawClips=parseAnimations(FBXTree,connections);if(rawClips===undefined){return;}for(var key in rawClips){var rawClip=rawClips[key];var clip=addClip(rawClip);sceneGraph.animations.push(clip);}}function addClip(rawClip){var tracks=[];rawClip.layer.forEach(function(rawTracks){tracks=tracks.concat(generateTracks(rawTracks));});return new AnimationClip$1(rawClip.name,-1,tracks);}function generateTracks(rawTracks){var tracks=[];if(rawTracks.T!==undefined){var positionTrack=generateVectorTrack(rawTracks.modelName,rawTracks.T.curves,rawTracks.initialPosition,'position');if(positionTrack!==undefined){tracks.push(positionTrack);}}if(rawTracks.R!==undefined){var rotationTrack=generateRotationTrack(rawTracks.modelName,rawTracks.R.curves,rawTracks.initialRotation,rawTracks.preRotations);if(rotationTrack!==undefined){tracks.push(rotationTrack);}}if(rawTracks.S!==undefined){var scaleTrack=generateVectorTrack(rawTracks.modelName,rawTracks.S.curves,rawTracks.initialScale,'scale');if(scaleTrack!==undefined){tracks.push(scaleTrack);}}return tracks;}function generateVectorTrack(modelName,curves,initialValue,type){var times=getTimesForAllAxes(curves);var values=getKeyframeTrackValues(times,curves,initialValue);return new VectorKeyframeTrack$1(modelName+'.'+type,times,values);}function generateRotationTrack(modelName,curves,initialValue,preRotations){if(curves.x!==undefined){curves.x.values=curves.x.values.map(Math.degToRad);}if(curves.y!==undefined){curves.y.values=curves.y.values.map(Math.degToRad);}if(curves.z!==undefined){curves.z.values=curves.z.values.map(Math.degToRad);}var times=getTimesForAllAxes(curves);var values=getKeyframeTrackValues(times,curves,initialValue);if(preRotations!==undefined){preRotations=preRotations.map(Math.degToRad);preRotations.push('ZYX');preRotations=new Euler().fromArray(preRotations);preRotations=new Quaternion().setFromEuler(preRotations);}var quaternion=new Quaternion();var euler=new Euler();var quaternionValues=[];for(var i=0;i<values.length;i+=3){euler.set(values[i],values[i+1],values[i+2],'ZYX');quaternion.setFromEuler(euler);if(preRotations!==undefined){quaternion.premultiply(preRotations);}quaternion.toArray(quaternionValues,i/3*4);}return new QuaternionKeyframeTrack$1(modelName+'.quaternion',times,quaternionValues);}function getKeyframeTrackValues(times,curves,initialValue){var prevValue=initialValue;var values=[];var xIndex=-1;var yIndex=-1;var zIndex=-1;times.forEach(function(time){if(curves.x){xIndex=curves.x.times.indexOf(time);}if(curves.y){yIndex=curves.y.times.indexOf(time);}if(curves.z){zIndex=curves.z.times.indexOf(time);}// if there is an x value defined for this frame, use that
  if(xIndex!==-1){var xValue=curves.x.values[xIndex];values.push(xValue);prevValue[0]=xValue;}else{// otherwise use the x value from the previous frame
  values.push(prevValue[0]);}if(yIndex!==-1){var yValue=curves.y.values[yIndex];values.push(yValue);prevValue[1]=yValue;}else{values.push(prevValue[1]);}if(zIndex!==-1){var zValue=curves.z.values[zIndex];values.push(zValue);prevValue[2]=zValue;}else{values.push(prevValue[2]);}});return values;}// For all animated objects, times are defined separately for each axis
  // Here we'll combine the times into one sorted array without duplicates
  function getTimesForAllAxes(curves){var times=[];// first join together the times for each axis, if defined
  if(curves.x!==undefined){times=times.concat(curves.x.times);}if(curves.y!==undefined){times=times.concat(curves.y.times);}if(curves.z!==undefined){times=times.concat(curves.z.times);}// then sort them and remove duplicates
  times=times.sort(function(a,b){return a-b;}).filter(function(elem,index,array){return array.indexOf(elem)==index;});return times;}// parse an FBX file in ASCII format
  function TextParser(){}Object.assign(TextParser.prototype,{getPrevNode:function getPrevNode(){return this.nodeStack[this.currentIndent-2];},getCurrentNode:function getCurrentNode(){return this.nodeStack[this.currentIndent-1];},getCurrentProp:function getCurrentProp(){return this.currentProp;},pushStack:function pushStack(node){this.nodeStack.push(node);this.currentIndent+=1;},popStack:function popStack(){this.nodeStack.pop();this.currentIndent-=1;},setCurrentProp:function setCurrentProp(val,name){this.currentProp=val;this.currentPropName=name;},parse:function parse(text){this.currentIndent=0;this.allNodes=new FBXTree();this.nodeStack=[];this.currentProp=[];this.currentPropName='';var self=this;var split=text.split('\n');split.forEach(function(line,i){var matchComment=line.match(/^[\s\t]*;/);var matchEmpty=line.match(/^[\s\t]*$/);if(matchComment||matchEmpty){return;}var matchBeginning=line.match('^\\t{'+self.currentIndent+'}(\\w+):(.*){','');var matchProperty=line.match('^\\t{'+self.currentIndent+'}(\\w+):[\\s\\t\\r\\n](.*)');var matchEnd=line.match('^\\t{'+(self.currentIndent-1)+'}}');if(matchBeginning){self.parseNodeBegin(line,matchBeginning);}else if(matchProperty){self.parseNodeProperty(line,matchProperty,split[++i]);}else if(matchEnd){self.nodeEnd();}else if(line.match(/^[^\s\t}]/)){// large arrays are split over multiple lines terminated with a ',' character
  // if this is encountered the line needs to be joined to the previous line
  self.parseNodePropertyContinued(line);}});return this.allNodes;},parseNodeBegin:function parseNodeBegin(line,property){var nodeName=property[1].trim().replace(/^"/,'').replace(/"$/,'');var nodeAttrs=property[2].split(',').map(function(attr){return attr.trim().replace(/^"/,'').replace(/"$/,'');});var node={'name':nodeName,properties:{},'subNodes':{}};var attrs=this.parseNodeAttr(nodeAttrs);var currentNode=this.getCurrentNode();// a top node
  if(this.currentIndent===0){this.allNodes.add(nodeName,node);}else{// a subnode
  // if the subnode already exists, append it
  if(nodeName in currentNode.subNodes){var tmp=currentNode.subNodes[nodeName];if(this.isFlattenNode(currentNode.subNodes[nodeName])){if(attrs.id===''){currentNode.subNodes[nodeName]=[];currentNode.subNodes[nodeName].push(tmp);}else{currentNode.subNodes[nodeName]={};currentNode.subNodes[nodeName][tmp.id]=tmp;}}if(attrs.id===''){currentNode.subNodes[nodeName].push(node);}else{currentNode.subNodes[nodeName][attrs.id]=node;}}else if(typeof attrs.id==='number'||attrs.id.match(/^\d+$/)){currentNode.subNodes[nodeName]={};currentNode.subNodes[nodeName][attrs.id]=node;}else{currentNode.subNodes[nodeName]=node;}}// for this	↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓
  // NodeAttribute: 1001463072, "NodeAttribute::", "LimbNode" {
  if(nodeAttrs){node.id=attrs.id;node.attrName=attrs.name;node.attrType=attrs.type;}this.pushStack(node);},parseNodeAttr:function parseNodeAttr(attrs){var id=attrs[0];if(attrs[0]!==''){id=parseInt(attrs[0]);if(isNaN(id)){id=attrs[0];}}var name='',type='';if(attrs.length>1){name=attrs[1].replace(/^(\w+)::/,'');type=attrs[2];}return{id:id,name:name,type:type};},parseNodeProperty:function parseNodeProperty(line,property,contentLine){var propName=property[1].replace(/^"/,'').replace(/"$/,'').trim();var propValue=property[2].replace(/^"/,'').replace(/"$/,'').trim();// for special case: base64 image data follows "Content: ," line
  //	Content: ,
  //	 "iVB..."
  if(propName==='Content'&&propValue===','){propValue=contentLine.replace(/"/g,'').replace(/,$/,'').trim();}var currentNode=this.getCurrentNode();var parentName=currentNode.name;// special case where the parent node is something like "Properties70"
  // these children nodes must treated carefully
  if(parentName!==undefined){var propMatch=parentName.match(/Properties(\d)+/);if(propMatch){this.parseNodeSpecialProperty(line,propName,propValue);return;}}// Connections
  if(propName==='C'){var connProps=propValue.split(',').slice(1);var from=parseInt(connProps[0]);var to=parseInt(connProps[1]);var rest=propValue.split(',').slice(3);rest=rest.map(function(elem){return elem.trim().replace(/^"/,'');});propName='connections';propValue=[from,to];append(propValue,rest);if(currentNode.properties[propName]===undefined){currentNode.properties[propName]=[];}}// Node
  if(propName==='Node'){var id=parseInt(propValue);currentNode.properties.id=id;currentNode.id=id;}// already exists in properties, then append this
  if(propName in currentNode.properties){if(Array.isArray(currentNode.properties[propName])){currentNode.properties[propName].push(propValue);}else{currentNode.properties[propName]+=propValue;}}else{if(Array.isArray(currentNode.properties[propName])){currentNode.properties[propName].push(propValue);}else{currentNode.properties[propName]=propValue;}}this.setCurrentProp(currentNode.properties,propName);// convert string to array, unless it ends in ',' in which case more will be added to it
  if(propName==='a'&&propValue.slice(-1)!==','){currentNode.properties.a=parseNumberArray(propValue);}},parseNodePropertyContinued:function parseNodePropertyContinued(line){this.currentProp[this.currentPropName]+=line;// if the line doesn't end in ',' we have reached the end of the property value
  // so convert the string to an array
  if(line.slice(-1)!==','){var currentNode=this.getCurrentNode();currentNode.properties.a=parseNumberArray(currentNode.properties.a);}},parseNodeSpecialProperty:function parseNodeSpecialProperty(line,propName,propValue){// split this
  // P: "Lcl Scaling", "Lcl Scaling", "", "A",1,1,1
  // into array like below
  // ["Lcl Scaling", "Lcl Scaling", "", "A", "1,1,1" ]
  var props=propValue.split('",').map(function(prop){return prop.trim().replace(/^\"/,'').replace(/\s/,'_');});var innerPropName=props[0];var innerPropType1=props[1];var innerPropType2=props[2];var innerPropFlag=props[3];var innerPropValue=props[4];// cast value to its type
  switch(innerPropType1){case'int':case'enum':case'bool':case'ULongLong':innerPropValue=parseInt(innerPropValue);break;case'double':case'Number':case'FieldOfView':innerPropValue=parseFloat(innerPropValue);break;case'ColorRGB':case'Vector3D':case'Lcl_Translation':case'Lcl_Rotation':case'Lcl_Scaling':innerPropValue=parseNumberArray(innerPropValue);break;}// CAUTION: these props must append to parent's parent
  this.getPrevNode().properties[innerPropName]={'type':innerPropType1,'type2':innerPropType2,'flag':innerPropFlag,'value':innerPropValue};this.setCurrentProp(this.getPrevNode().properties,innerPropName);},nodeEnd:function nodeEnd(){this.popStack();},isFlattenNode:function isFlattenNode(node){return'subNodes'in node&&'properties'in node?true:false;}});// Parse an FBX file in Binary format
  function BinaryParser(){}Object.assign(BinaryParser.prototype,{parse:function parse(buffer){var this$1=this;var reader=new BinaryReader(buffer);reader.skip(23);// skip magic 23 bytes
  var version=reader.getUint32();console.log('FBXLoader: FBX binary version: '+version);var allNodes=new FBXTree();while(!this.endOfContent(reader)){var node=this$1.parseNode(reader,version);if(node!==null){allNodes.add(node.name,node);}}return allNodes;},// Check if reader has reached the end of content.
  endOfContent:function endOfContent(reader){// footer size: 160bytes + 16-byte alignment padding
  // - 16bytes: magic
  // - padding til 16-byte alignment (at least 1byte?)
  //	(seems like some exporters embed fixed 15 or 16bytes?)
  // - 4bytes: magic
  // - 4bytes: version
  // - 120bytes: zero
  // - 16bytes: magic
  if(reader.size()%16===0){return(reader.getOffset()+160+16&~0xf)>=reader.size();}else{return reader.getOffset()+160+16>=reader.size();}},parseNode:function parseNode(reader,version){var this$1=this;// The first three data sizes depends on version.
  var endOffset=version>=7500?reader.getUint64():reader.getUint32();var numProperties=version>=7500?reader.getUint64():reader.getUint32();// note: do not remove this even if you get a linter warning as it moves the buffer forward
  var propertyListLen=version>=7500?reader.getUint64():reader.getUint32();var nameLen=reader.getUint8();var name=reader.getString(nameLen);// Regards this node as NULL-record if endOffset is zero
  if(endOffset===0){return null;}var propertyList=[];for(var i=0;i<numProperties;i++){propertyList.push(this$1.parseProperty(reader));}// Regards the first three elements in propertyList as id, attrName, and attrType
  var id=propertyList.length>0?propertyList[0]:'';var attrName=propertyList.length>1?propertyList[1]:'';var attrType=propertyList.length>2?propertyList[2]:'';var subNodes={};var properties={};var isSingleProperty=false;// check if this node represents just a single property
  // like (name, 0) set or (name2, [0, 1, 2]) set of {name: 0, name2: [0, 1, 2]}
  if(numProperties===1&&reader.getOffset()===endOffset){isSingleProperty=true;}while(endOffset>reader.getOffset()){var node=this$1.parseNode(reader,version);if(node===null){continue;}// special case: child node is single property
  if(node.singleProperty===true){var value=node.propertyList[0];if(Array.isArray(value)){subNodes[node.name]=node;node.properties.a=value;}else{properties[node.name]=value;}continue;}// parse connections
  if(name==='Connections'&&node.name==='C'){var array=[];node.propertyList.forEach(function(property,i){array[i-1]=property;});if(properties.connections===undefined){properties.connections=[];}properties.connections.push(array);continue;}// special case: child node is Properties\d+
  // move child node's properties to this node.
  if(node.name==='Properties70'){var keys=Object.keys(node.properties);keys.forEach(function(key){properties[key]=node.properties[key];});continue;}// parse 'properties70'
  if(name==='Properties70'&&node.name==='P'){var innerPropName=node.propertyList[0];var innerPropType1=node.propertyList[1];var innerPropType2=node.propertyList[2];var innerPropFlag=node.propertyList[3];var innerPropValue;if(innerPropName.indexOf('Lcl ')===0){innerPropName=innerPropName.replace('Lcl ','Lcl_');}if(innerPropType1.indexOf('Lcl ')===0){innerPropType1=innerPropType1.replace('Lcl ','Lcl_');}if(innerPropType1==='ColorRGB'||innerPropType1==='Vector'||innerPropType1==='Vector3D'||innerPropType1.indexOf('Lcl_')===0){innerPropValue=[node.propertyList[4],node.propertyList[5],node.propertyList[6]];}else{innerPropValue=node.propertyList[4];}// this will be copied to parent, see above
  properties[innerPropName]={'type':innerPropType1,'type2':innerPropType2,'flag':innerPropFlag,'value':innerPropValue};continue;}if(subNodes[node.name]===undefined){if(typeof node.id==='number'){subNodes[node.name]={};subNodes[node.name][node.id]=node;}else{subNodes[node.name]=node;}}else{if(node.id===''){if(!Array.isArray(subNodes[node.name])){subNodes[node.name]=[subNodes[node.name]];}subNodes[node.name].push(node);}else{if(subNodes[node.name][node.id]===undefined){subNodes[node.name][node.id]=node;}else{// conflict id. irregular?
  if(!Array.isArray(subNodes[node.name][node.id])){subNodes[node.name][node.id]=[subNodes[node.name][node.id]];}subNodes[node.name][node.id].push(node);}}}}return{singleProperty:isSingleProperty,id:id,attrName:attrName,attrType:attrType,name:name,properties:properties,propertyList:propertyList,// raw property list used by parent
  subNodes:subNodes};},parseProperty:function parseProperty(reader){var type=reader.getChar();switch(type){case'C':return reader.getBoolean();case'D':return reader.getFloat64();case'F':return reader.getFloat32();case'I':return reader.getInt32();case'L':return reader.getInt64();case'R':var length=reader.getUint32();return reader.getArrayBuffer(length);case'S':var length=reader.getUint32();return reader.getString(length);case'Y':return reader.getInt16();case'b':case'c':case'd':case'f':case'i':case'l':var arrayLength=reader.getUint32();var encoding=reader.getUint32();// 0: non-compressed, 1: compressed
  var compressedLength=reader.getUint32();if(encoding===0){switch(type){case'b':case'c':return reader.getBooleanArray(arrayLength);case'd':return reader.getFloat64Array(arrayLength);case'f':return reader.getFloat32Array(arrayLength);case'i':return reader.getInt32Array(arrayLength);case'l':return reader.getInt64Array(arrayLength);}}if(window.Zlib===undefined){throw new Error('FBXLoader: External library Inflate.min.js required, obtain or import from https://github.com/imaya/zlib.js');}var inflate=new Zlib.Inflate(new Uint8Array(reader.getArrayBuffer(compressedLength)));// eslint-disable-line no-undef
  var reader2=new BinaryReader(inflate.decompress().buffer);switch(type){case'b':case'c':return reader2.getBooleanArray(arrayLength);case'd':return reader2.getFloat64Array(arrayLength);case'f':return reader2.getFloat32Array(arrayLength);case'i':return reader2.getInt32Array(arrayLength);case'l':return reader2.getInt64Array(arrayLength);}default:throw new Error('FBXLoader: Unknown property type '+type);}}});function BinaryReader(buffer,littleEndian){this.dv=new DataView(buffer);this.offset=0;this.littleEndian=littleEndian!==undefined?littleEndian:true;}Object.assign(BinaryReader.prototype,{getOffset:function getOffset(){return this.offset;},size:function size(){return this.dv.buffer.byteLength;},skip:function skip(length){this.offset+=length;},// seems like true/false representation depends on exporter.
  // true: 1 or 'Y'(=0x59), false: 0 or 'T'(=0x54)
  // then sees LSB.
  getBoolean:function getBoolean(){return(this.getUint8()&1)===1;},getBooleanArray:function getBooleanArray(size){var this$1=this;var a=[];for(var i=0;i<size;i++){a.push(this$1.getBoolean());}return a;},getInt8:function getInt8(){var value=this.dv.getInt8(this.offset);this.offset+=1;return value;},getInt8Array:function getInt8Array(size){var this$1=this;var a=[];for(var i=0;i<size;i++){a.push(this$1.getInt8());}return a;},getUint8:function getUint8(){var value=this.dv.getUint8(this.offset);this.offset+=1;return value;},getUint8Array:function getUint8Array(size){var this$1=this;var a=[];for(var i=0;i<size;i++){a.push(this$1.getUint8());}return a;},getInt16:function getInt16(){var value=this.dv.getInt16(this.offset,this.littleEndian);this.offset+=2;return value;},getInt16Array:function getInt16Array(size){var this$1=this;var a=[];for(var i=0;i<size;i++){a.push(this$1.getInt16());}return a;},getUint16:function getUint16(){var value=this.dv.getUint16(this.offset,this.littleEndian);this.offset+=2;return value;},getUint16Array:function getUint16Array(size){var this$1=this;var a=[];for(var i=0;i<size;i++){a.push(this$1.getUint16());}return a;},getInt32:function getInt32(){var value=this.dv.getInt32(this.offset,this.littleEndian);this.offset+=4;return value;},getInt32Array:function getInt32Array(size){var this$1=this;var a=[];for(var i=0;i<size;i++){a.push(this$1.getInt32());}return a;},getUint32:function getUint32(){var value=this.dv.getUint32(this.offset,this.littleEndian);this.offset+=4;return value;},getUint32Array:function getUint32Array(size){var this$1=this;var a=[];for(var i=0;i<size;i++){a.push(this$1.getUint32());}return a;},// JavaScript doesn't support 64-bit integer so calculate this here
  // 1 << 32 will return 1 so using multiply operation instead here.
  // There's a possibility that this method returns wrong value if the value
  // is out of the range between Number.MAX_SAFE_INTEGER and Number.MIN_SAFE_INTEGER.
  // TODO: safely handle 64-bit integer
  getInt64:function getInt64(){var low,high;if(this.littleEndian){low=this.getUint32();high=this.getUint32();}else{high=this.getUint32();low=this.getUint32();}// calculate negative value
  if(high&0x80000000){high=~high&0xFFFFFFFF;low=~low&0xFFFFFFFF;if(low===0xFFFFFFFF){high=high+1&0xFFFFFFFF;}low=low+1&0xFFFFFFFF;return-(high*0x100000000+low);}return high*0x100000000+low;},getInt64Array:function getInt64Array(size){var this$1=this;var a=[];for(var i=0;i<size;i++){a.push(this$1.getInt64());}return a;},// Note: see getInt64() comment
  getUint64:function getUint64(){var low,high;if(this.littleEndian){low=this.getUint32();high=this.getUint32();}else{high=this.getUint32();low=this.getUint32();}return high*0x100000000+low;},getUint64Array:function getUint64Array(size){var this$1=this;var a=[];for(var i=0;i<size;i++){a.push(this$1.getUint64());}return a;},getFloat32:function getFloat32(){var value=this.dv.getFloat32(this.offset,this.littleEndian);this.offset+=4;return value;},getFloat32Array:function getFloat32Array(size){var this$1=this;var a=[];for(var i=0;i<size;i++){a.push(this$1.getFloat32());}return a;},getFloat64:function getFloat64(){var value=this.dv.getFloat64(this.offset,this.littleEndian);this.offset+=8;return value;},getFloat64Array:function getFloat64Array(size){var this$1=this;var a=[];for(var i=0;i<size;i++){a.push(this$1.getFloat64());}return a;},getArrayBuffer:function getArrayBuffer(size){var value=this.dv.buffer.slice(this.offset,this.offset+size);this.offset+=size;return value;},getChar:function getChar(){return String.fromCharCode(this.getUint8());},getString:function getString(size){var s=LoaderUtils.decodeText(this.getUint8Array(size));this.skip(size);return s;}});// FBXTree holds a representation of the FBX data, returned by the TextParser ( FBX ASCII format)
  // and BinaryParser( FBX Binary format)
  function FBXTree(){}Object.assign(FBXTree.prototype,{add:function add(key,val){this[key]=val;}});function isFbxFormatBinary(buffer){var CORRECT='Kaydara FBX Binary  \0';return buffer.byteLength>=CORRECT.length&&CORRECT===convertArrayBufferToString(buffer,0,CORRECT.length);}function isFbxFormatASCII(text){var CORRECT=['K','a','y','d','a','r','a','\\','F','B','X','\\','B','i','n','a','r','y','\\','\\'];var cursor=0;function read(offset){var result=text[offset-1];text=text.slice(cursor+offset);cursor++;return result;}for(var i=0;i<CORRECT.length;++i){var num=read(1);if(num===CORRECT[i]){return false;}}return true;}function getFbxVersion(text){var versionRegExp=/FBXVersion: (\d+)/;var match=text.match(versionRegExp);if(match){var version=parseInt(match[1]);return version;}throw new Error('FBXLoader: Cannot find the version number for the file given.');}// Converts FBX ticks into real time seconds.
  function convertFBXTimeToSeconds(time){return time/46186158000;}// Parses comma separated list of numbers and returns them an array.
  // Used internally by the TextParser
  function parseNumberArray(value){var array=value.split(',').map(function(val){return parseFloat(val);});return array;}function parseColor(property){var color=new Color$1();if(property.type==='Color'){return color.setScalar(property.value);}return color.fromArray(property.value);}// Converts ArrayBuffer to String.
  function convertArrayBufferToString(buffer,from,to){if(from===undefined){from=0;}if(to===undefined){to=buffer.byteLength;}return LoaderUtils.decodeText(new Uint8Array(buffer,from,to));}function append(a,b){for(var i=0,j=a.length,l=b.length;i<l;i++, j++){a[j]=b[i];}}function slice(a,b,from,to){for(var i=from,j=0;i<to;i++, j++){a[j]=b[i];}return a;}/**
   * GCodeLoader is used to load gcode files usually used for 3D printing or CNC applications.
   *
   * Gcode files are composed by commands used by machines to create objects.
   *
   * @class GCodeLoader
   * @param {Manager} manager Loading manager.
   * @author tentone
   * @author joewalnes
   */// https://github.com/mrdoob/three.js/issues/5552
  // http://en.wikipedia.org/wiki/RGBE_image_format
  var RGBELoader=function RGBELoader(manager){this.manager=manager!==undefined?manager:DefaultLoadingManager;};// extend DataTextureLoader
  RGBELoader.prototype=Object.create(DataTextureLoader.prototype);// adapted from http://www.graphics.cornell.edu/~bjw/rgbe.html
  RGBELoader.prototype._parser=function(buffer){var/* return codes for rgbe routines */RGBE_RETURN_SUCCESS=0,RGBE_RETURN_FAILURE=-1,/* default error routine.  change this to change error handling */rgbe_read_error=1,rgbe_write_error=2,rgbe_format_error=3,rgbe_memory_error=4,rgbe_error=function rgbe_error(rgbe_error_code,msg){switch(rgbe_error_code){case rgbe_read_error:console.error("RGBELoader Read Error: "+(msg||''));break;case rgbe_write_error:console.error("RGBELoader Write Error: "+(msg||''));break;case rgbe_format_error:console.error("RGBELoader Bad File Format: "+(msg||''));break;default:case rgbe_memory_error:console.error("RGBELoader: Error: "+(msg||''));}return RGBE_RETURN_FAILURE;},/* offsets to red, green, and blue components in a data (float) pixel */RGBE_DATA_RED=0,RGBE_DATA_GREEN=1,RGBE_DATA_BLUE=2,/* number of floats per pixel, use 4 since stored in rgba image format */RGBE_DATA_SIZE=4,/* flags indicating which fields in an rgbe_header_info are valid */RGBE_VALID_PROGRAMTYPE=1,RGBE_VALID_FORMAT=2,RGBE_VALID_DIMENSIONS=4,NEWLINE="\n",fgets=function fgets(buffer,lineLimit,consume){lineLimit=!lineLimit?1024:lineLimit;var p=buffer.pos,i=-1,len=0,s='',chunkSize=128,chunk=String.fromCharCode.apply(null,new Uint16Array(buffer.subarray(p,p+chunkSize)));while(0>(i=chunk.indexOf(NEWLINE))&&len<lineLimit&&p<buffer.byteLength){s+=chunk;len+=chunk.length;p+=chunkSize;chunk+=String.fromCharCode.apply(null,new Uint16Array(buffer.subarray(p,p+chunkSize)));}if(-1<i){/*for (i=l-1; i>=0; i--) {
  					byteCode = m.charCodeAt(i);
  					if (byteCode > 0x7f && byteCode <= 0x7ff) byteLen++;
  					else if (byteCode > 0x7ff && byteCode <= 0xffff) byteLen += 2;
  					if (byteCode >= 0xDC00 && byteCode <= 0xDFFF) i--; //trail surrogate
  				}*/if(false!==consume){buffer.pos+=len+i+1;}return s+chunk.slice(0,i);}return false;},/* minimal header reading.  modify if you want to parse more information */RGBE_ReadHeader=function RGBE_ReadHeader(buffer){var line,match,// regexes to parse header info fields
  magic_token_re=/^#\?(\S+)$/,gamma_re=/^\s*GAMMA\s*=\s*(\d+(\.\d+)?)\s*$/,exposure_re=/^\s*EXPOSURE\s*=\s*(\d+(\.\d+)?)\s*$/,format_re=/^\s*FORMAT=(\S+)\s*$/,dimensions_re=/^\s*\-Y\s+(\d+)\s+\+X\s+(\d+)\s*$/,// RGBE format header struct
  header={valid:0,/* indicate which fields are valid */string:'',/* the actual header string */comments:'',/* comments found in header */programtype:'RGBE',/* listed at beginning of file to identify it after "#?". defaults to "RGBE" */format:'',/* RGBE format, default 32-bit_rle_rgbe */gamma:1.0,/* image has already been gamma corrected with given gamma. defaults to 1.0 (no correction) */exposure:1.0,/* a value of 1.0 in an image corresponds to <exposure> watts/steradian/m^2. defaults to 1.0 */width:0,height:0/* image dimensions, width/height */};if(buffer.pos>=buffer.byteLength||!(line=fgets(buffer))){return rgbe_error(rgbe_read_error,"no header found");}/* if you want to require the magic token then uncomment the next line */if(!(match=line.match(magic_token_re))){return rgbe_error(rgbe_format_error,"bad initial token");}header.valid|=RGBE_VALID_PROGRAMTYPE;header.programtype=match[1];header.string+=line+"\n";while(true){line=fgets(buffer);if(false===line){break;}header.string+=line+"\n";if('#'===line.charAt(0)){header.comments+=line+"\n";continue;// comment line
  }if(match=line.match(gamma_re)){header.gamma=parseFloat(match[1],10);}if(match=line.match(exposure_re)){header.exposure=parseFloat(match[1],10);}if(match=line.match(format_re)){header.valid|=RGBE_VALID_FORMAT;header.format=match[1];//'32-bit_rle_rgbe';
  }if(match=line.match(dimensions_re)){header.valid|=RGBE_VALID_DIMENSIONS;header.height=parseInt(match[1],10);header.width=parseInt(match[2],10);}if(header.valid&RGBE_VALID_FORMAT&&header.valid&RGBE_VALID_DIMENSIONS){break;}}if(!(header.valid&RGBE_VALID_FORMAT)){return rgbe_error(rgbe_format_error,"missing format specifier");}if(!(header.valid&RGBE_VALID_DIMENSIONS)){return rgbe_error(rgbe_format_error,"missing image size specifier");}return header;},RGBE_ReadPixels_RLE=function RGBE_ReadPixels_RLE(buffer,w,h){var data_rgba,offset,pos,count,byteValue,scanline_buffer,ptr,ptr_end,i,l,off,isEncodedRun,scanline_width=w,num_scanlines=h,rgbeStart;if(// run length encoding is not allowed so read flat
  scanline_width<8||scanline_width>0x7fff||// this file is not run length encoded
  2!==buffer[0]||2!==buffer[1]||buffer[2]&0x80){// return the flat buffer
  return new Uint8Array(buffer);}if(scanline_width!==(buffer[2]<<8|buffer[3])){return rgbe_error(rgbe_format_error,"wrong scanline width");}data_rgba=new Uint8Array(4*w*h);if(!data_rgba||!data_rgba.length){return rgbe_error(rgbe_memory_error,"unable to allocate buffer space");}offset=0;pos=0;ptr_end=4*scanline_width;rgbeStart=new Uint8Array(4);scanline_buffer=new Uint8Array(ptr_end);// read in each successive scanline
  while(num_scanlines>0&&pos<buffer.byteLength){if(pos+4>buffer.byteLength){return rgbe_error(rgbe_read_error);}rgbeStart[0]=buffer[pos++];rgbeStart[1]=buffer[pos++];rgbeStart[2]=buffer[pos++];rgbeStart[3]=buffer[pos++];if(2!=rgbeStart[0]||2!=rgbeStart[1]||(rgbeStart[2]<<8|rgbeStart[3])!=scanline_width){return rgbe_error(rgbe_format_error,"bad rgbe scanline format");}// read each of the four channels for the scanline into the buffer
  // first red, then green, then blue, then exponent
  ptr=0;while(ptr<ptr_end&&pos<buffer.byteLength){count=buffer[pos++];isEncodedRun=count>128;if(isEncodedRun){count-=128;}if(0===count||ptr+count>ptr_end){return rgbe_error(rgbe_format_error,"bad scanline data");}if(isEncodedRun){// a (encoded) run of the same value
  byteValue=buffer[pos++];for(i=0;i<count;i++){scanline_buffer[ptr++]=byteValue;}//ptr += count;
  }else{// a literal-run
  scanline_buffer.set(buffer.subarray(pos,pos+count),ptr);ptr+=count;pos+=count;}}// now convert data from buffer into rgba
  // first red, then green, then blue, then exponent (alpha)
  l=scanline_width;//scanline_buffer.byteLength;
  for(i=0;i<l;i++){off=0;data_rgba[offset]=scanline_buffer[i+off];off+=scanline_width;//1;
  data_rgba[offset+1]=scanline_buffer[i+off];off+=scanline_width;//1;
  data_rgba[offset+2]=scanline_buffer[i+off];off+=scanline_width;//1;
  data_rgba[offset+3]=scanline_buffer[i+off];offset+=4;}num_scanlines--;}return data_rgba;};var byteArray=new Uint8Array(buffer);byteArray.pos=0;var rgbe_header_info=RGBE_ReadHeader(byteArray);if(RGBE_RETURN_FAILURE!==rgbe_header_info){var w=rgbe_header_info.width,h=rgbe_header_info.height,image_rgba_data=RGBE_ReadPixels_RLE(byteArray.subarray(byteArray.pos),w,h);if(RGBE_RETURN_FAILURE!==image_rgba_data){return{width:w,height:h,data:image_rgba_data,header:rgbe_header_info.string,gamma:rgbe_header_info.gamma,exposure:rgbe_header_info.exposure,format:RGBEFormat,// handled as RGBAFormat in shaders
  type:UnsignedByteType};}}return null;};function CubeTexture(images,mapping,wrapS,wrapT,magFilter,minFilter,format,type,anisotropy,encoding){images=images!==undefined?images:[];mapping=mapping!==undefined?mapping:CubeReflectionMapping;Texture$1.call(this,images,mapping,wrapS,wrapT,magFilter,minFilter,format,type,anisotropy,encoding);this.flipY=false;}CubeTexture.prototype=Object.create(Texture$1.prototype);CubeTexture.prototype.constructor=CubeTexture;CubeTexture.prototype.isCubeTexture=true;Object.defineProperty(CubeTexture.prototype,'images',{get:function get$$1(){return this.image;},set:function set$$1(value){this.image=value;}});/**
  * @author Prashant Sharma / spidersharma03
  * @author Ben Houston / http://clara.io / bhouston
  */var LoaderSupport={};/**
   * Validation functions.
   * @class
   */LoaderSupport.Validator={/**
  	 * If given input is null or undefined, false is returned otherwise true.
  	 *
  	 * @param input Can be anything
  	 * @returns {boolean}
  	 */isValid:function isValid(input){return input!==null&&input!==undefined;},/**
  	 * If given input is null or undefined, the defaultValue is returned otherwise the given input.
  	 *
  	 * @param input Can be anything
  	 * @param defaultValue Can be anything
  	 * @returns {*}
  	 */verifyInput:function verifyInput(input,defaultValue){return input===null||input===undefined?defaultValue:input;}};/**
   * Logging wrapper for console.
   * @class
   *
   * @param {boolean} enabled=true Tell if logger is enabled.
   * @param {boolean} debug=false Toggle debug logging.
   */LoaderSupport.ConsoleLogger=function(){function ConsoleLogger(enabled,debug){this.enabled=enabled!==false;this.debug=debug===true;}/**
  	 * Enable or disable debug logging.
  	 * @memberOf LoaderSupport.ConsoleLogger
  	 *
  	 * @param {boolean} debug True or False
  	 */ConsoleLogger.prototype.setDebug=function(debug){this.debug=debug===true;};/**
  	 * Returns if is enabled and debug.
  	 * @memberOf LoaderSupport.ConsoleLogger
  	 *
  	 * @returns {boolean}
  	 */ConsoleLogger.prototype.isDebug=function(){return this.isEnabled()&&this.debug;};/**
  	 * Enable or disable info, debug and time logging.
  	 * @memberOf LoaderSupport.ConsoleLogger
  	 *
  	 * @param {boolean} enabled True or False
  	 */ConsoleLogger.prototype.setEnabled=function(enabled){this.enabled=enabled===true;};/**
  	 * Returns if is enabled.
  	 * @memberOf LoaderSupport.ConsoleLogger
  	 *
  	 * @returns {boolean}
  	 */ConsoleLogger.prototype.isEnabled=function(){return this.enabled;};/**
  	 * Log a debug message if enabled and debug is set.
  	 * @memberOf LoaderSupport.ConsoleLogger
  	 *
  	 * @param {string} message Message to log
  	 */ConsoleLogger.prototype.logDebug=function(message){if(this.enabled&&this.debug){console.info(message);}};/**
  	 * Log an info message if enabled.
  	 * @memberOf LoaderSupport.ConsoleLogger
  	 *
  	 * @param {string} message Message to log
  	 */ConsoleLogger.prototype.logInfo=function(message){if(this.enabled){console.info(message);}};/**
  	 * Log a warn message (always).
  	 * @memberOf LoaderSupport.ConsoleLogger
  	 *
  	 * @param {string} message Message to log
  	 */ConsoleLogger.prototype.logWarn=function(message){console.warn(message);};/**
  	 * Log an error message (always).
  	 * @memberOf LoaderSupport.ConsoleLogger
  	 *
  	 * @param {string} message Message to log
  	 */ConsoleLogger.prototype.logError=function(message){console.error(message);};/**
  	 * Start time measurement with provided id.
  	 * @memberOf LoaderSupport.ConsoleLogger
  	 *
  	 * @param {string} id Time identification
  	 */ConsoleLogger.prototype.logTimeStart=function(id){if(this.enabled){console.time(id);}};/**
  	 * Stop time measurement started with provided id.
  	 * @memberOf LoaderSupport.ConsoleLogger
  	 *
  	 * @param {string} id Time identification
  	 */ConsoleLogger.prototype.logTimeEnd=function(id){if(this.enabled){console.timeEnd(id);}};return ConsoleLogger;}();/**
   * Callbacks utilized by loaders and builder.
   * @class
   */LoaderSupport.Callbacks=function(){var Validator=LoaderSupport.Validator;function Callbacks(){this.onProgress=null;this.onMeshAlter=null;this.onLoad=null;this.onLoadMaterials=null;}/**
  	 * Register callback function that is invoked by internal function "announceProgress" to print feedback.
  	 * @memberOf LoaderSupport.Callbacks
  	 *
  	 * @param {callback} callbackOnProgress Callback function for described functionality
  	 */Callbacks.prototype.setCallbackOnProgress=function(callbackOnProgress){this.onProgress=Validator.verifyInput(callbackOnProgress,this.onProgress);};/**
  	 * Register callback function that is called every time a mesh was loaded.
  	 * Use {@link LoaderSupport.LoadedMeshUserOverride} for alteration instructions (geometry, material or disregard mesh).
  	 * @memberOf LoaderSupport.Callbacks
  	 *
  	 * @param {callback} callbackOnMeshAlter Callback function for described functionality
  	 */Callbacks.prototype.setCallbackOnMeshAlter=function(callbackOnMeshAlter){this.onMeshAlter=Validator.verifyInput(callbackOnMeshAlter,this.onMeshAlter);};/**
  	 * Register callback function that is called once loading of the complete OBJ file is completed.
  	 * @memberOf LoaderSupport.Callbacks
  	 *
  	 * @param {callback} callbackOnLoad Callback function for described functionality
  	 */Callbacks.prototype.setCallbackOnLoad=function(callbackOnLoad){this.onLoad=Validator.verifyInput(callbackOnLoad,this.onLoad);};/**
  	 * Register callback function that is called when materials have been loaded.
  	 * @memberOf LoaderSupport.Callbacks
  	 *
  	 * @param {callback} callbackOnLoadMaterials Callback function for described functionality
  	 */Callbacks.prototype.setCallbackOnLoadMaterials=function(callbackOnLoadMaterials){this.onLoadMaterials=Validator.verifyInput(callbackOnLoadMaterials,this.onLoadMaterials);};return Callbacks;}();/**
   * Object to return by callback onMeshAlter. Used to disregard a certain mesh or to return one to many meshes.
   * @class
   *
   * @param {boolean} disregardMesh=false Tell implementation to completely disregard this mesh
   * @param {boolean} disregardMesh=false Tell implementation that mesh(es) have been altered or added
   */LoaderSupport.LoadedMeshUserOverride=function(){function LoadedMeshUserOverride(disregardMesh,alteredMesh){this.disregardMesh=disregardMesh===true;this.alteredMesh=alteredMesh===true;this.meshes=[];}/**
  	 * Add a mesh created within callback.
  	 *
  	 * @memberOf OBJLoader2.LoadedMeshUserOverride
  	 *
  	 * @param {Mesh} mesh
  	 */LoadedMeshUserOverride.prototype.addMesh=function(mesh){this.meshes.push(mesh);this.alteredMesh=true;};/**
  	 * Answers if mesh shall be disregarded completely.
  	 *
  	 * @returns {boolean}
  	 */LoadedMeshUserOverride.prototype.isDisregardMesh=function(){return this.disregardMesh;};/**
  	 * Answers if new mesh(es) were created.
  	 *
  	 * @returns {boolean}
  	 */LoadedMeshUserOverride.prototype.providesAlteredMeshes=function(){return this.alteredMesh;};return LoadedMeshUserOverride;}();/**
   * A resource description used by {@link LoaderSupport.PrepData} and others.
   * @class
   *
   * @param {string} url URL to the file
   * @param {string} extension The file extension (type)
   */LoaderSupport.ResourceDescriptor=function(){var Validator=LoaderSupport.Validator;function ResourceDescriptor(url,extension){var urlParts=url.split('/');if(urlParts.length<2){this.path=null;this.name=url;this.url=url;}else{this.path=Validator.verifyInput(urlParts.slice(0,urlParts.length-1).join('/')+'/',null);this.name=Validator.verifyInput(urlParts[urlParts.length-1],null);this.url=url;}this.extension=Validator.verifyInput(extension,"default");this.extension=this.extension.trim();this.content=null;}/**
  	 * Set the content of this resource (String)
  	 * @memberOf LoaderSupport.ResourceDescriptor
  	 *
  	 * @param {Object} content The file content as arraybuffer or text
  	 */ResourceDescriptor.prototype.setContent=function(content){this.content=Validator.verifyInput(content,null);};return ResourceDescriptor;}();/**
   * Configuration instructions to be used by run method.
   * @class
   */LoaderSupport.PrepData=function(){var Validator=LoaderSupport.Validator;function PrepData(modelName){this.modelName=Validator.verifyInput(modelName,'');this.resources=[];this.streamMeshesTo=null;this.materialPerSmoothingGroup=false;this.useIndices=false;this.disregardNormals=false;this.callbacks=new LoaderSupport.Callbacks();this.crossOrigin;this.useAsync=false;}/**
  	 * Set the node where the loaded objects will be attached directly.
  	 * @memberOf LoaderSupport.PrepData
  	 *
  	 * @param {Object3D} streamMeshesTo Object already attached to scenegraph where new meshes will be attached to
  	 */PrepData.prototype.setStreamMeshesTo=function(streamMeshesTo){this.streamMeshesTo=Validator.verifyInput(streamMeshesTo,null);};/**
  	 * Tells whether a material shall be created per smoothing group.
  	 * @memberOf LoaderSupport.PrepData
  	 *
  	 * @param {boolean} materialPerSmoothingGroup=false
  	 */PrepData.prototype.setMaterialPerSmoothingGroup=function(materialPerSmoothingGroup){this.materialPerSmoothingGroup=materialPerSmoothingGroup===true;};/**
  	 * Tells whether indices should be used
  	 * @memberOf LoaderSupport.PrepData
  	 *
  	 * @param {boolean} useIndices=false
  	 */PrepData.prototype.setUseIndices=function(useIndices){this.useIndices=useIndices===true;};/**
  	 * Tells whether normals should be completely disregarded and regenerated.
  	 * @memberOf LoaderSupport.PrepData
  	 *
  	 * @param {boolean} disregardNormals=false
  	 */PrepData.prototype.setDisregardNormals=function(disregardNormals){this.disregardNormals=disregardNormals===true;};/**
  	 * Returns all callbacks as {@link LoaderSupport.Callbacks}
  	 * @memberOf LoaderSupport.PrepData
  	 *
  	 * @returns {LoaderSupport.Callbacks}
  	 */PrepData.prototype.getCallbacks=function(){return this.callbacks;};/**
  	 * Sets the CORS string to be used.
  	 * @memberOf LoaderSupport.PrepData
  	 *
  	 * @param {string} crossOrigin CORS value
  	 */PrepData.prototype.setCrossOrigin=function(crossOrigin){this.crossOrigin=crossOrigin;};/**
  	 * Add a resource description.
  	 * @memberOf LoaderSupport.PrepData
  	 *
  	 * @param {LoaderSupport.ResourceDescriptor}
  	 */PrepData.prototype.addResource=function(resource){this.resources.push(resource);};/**
  	 * If true uses async loading with worker, if false loads data synchronously.
  	 * @memberOf LoaderSupport.PrepData
  	 *
  	 * @param {boolean} useAsync
  	 */PrepData.prototype.setUseAsync=function(useAsync){this.useAsync=useAsync===true;};/**
  	 * Clones this object and returns it afterwards.
  	 * @memberOf LoaderSupport.PrepData
  	 *
  	 * @returns {@link LoaderSupport.PrepData}
  	 */PrepData.prototype.clone=function(){var clone=new LoaderSupport.PrepData(this.modelName);clone.resources=this.resources;clone.streamMeshesTo=this.streamMeshesTo;clone.materialPerSmoothingGroup=this.materialPerSmoothingGroup;clone.useIndices=this.useIndices;clone.disregardNormals=this.disregardNormals;clone.callbacks=this.callbacks;clone.crossOrigin=this.crossOrigin;clone.useAsync=this.useAsync;return clone;};return PrepData;}();/**
   * Builds one or many Mesh from one raw set of Arraybuffers, materialGroup descriptions and further parameters.
   * Supports vertex, vertexColor, normal, uv and index buffers.
   * @class
   */LoaderSupport.Builder=function(){var LOADER_BUILDER_VERSION='1.1.1';var Validator=LoaderSupport.Validator;var ConsoleLogger=LoaderSupport.ConsoleLogger;function Builder(logger){this.logger=Validator.verifyInput(logger,new ConsoleLogger());this.logger.logInfo('Using LoaderSupport.Builder version: '+LOADER_BUILDER_VERSION);this.callbacks=new LoaderSupport.Callbacks();this.materials=[];}/**
  	 * Set materials loaded by any supplier of an Array of {@link Material}.
  	 * @memberOf LoaderSupport.Builder
  	 *
  	 * @param {Material[]} materials Array of {@link Material}
  	 */Builder.prototype.setMaterials=function(materials){var payload={cmd:'materialData',materials:{materialCloneInstructions:null,serializedMaterials:null,runtimeMaterials:Validator.isValid(this.callbacks.onLoadMaterials)?this.callbacks.onLoadMaterials(materials):materials}};this.updateMaterials(payload);};Builder.prototype._setCallbacks=function(callbacks){if(Validator.isValid(callbacks.onProgress)){this.callbacks.setCallbackOnProgress(callbacks.onProgress);}if(Validator.isValid(callbacks.onMeshAlter)){this.callbacks.setCallbackOnMeshAlter(callbacks.onMeshAlter);}if(Validator.isValid(callbacks.onLoad)){this.callbacks.setCallbackOnLoad(callbacks.onLoad);}if(Validator.isValid(callbacks.onLoadMaterials)){this.callbacks.setCallbackOnLoadMaterials(callbacks.onLoadMaterials);}};/**
  	 * Delegates processing of the payload (mesh building or material update) to the corresponding functions (BW-compatibility).
  	 * @memberOf LoaderSupport.Builder
  	 *
  	 * @param {Object} payload Raw Mesh or Material descriptions.
  	 * @returns {Mesh[]} mesh Array of {@link Mesh} or null in case of material update
  	 */Builder.prototype.processPayload=function(payload){if(payload.cmd==='meshData'){return this.buildMeshes(payload);}else if(payload.cmd==='materialData'){this.updateMaterials(payload);return null;}};/**
  	 * Builds one or multiple meshes from the data described in the payload (buffers, params, material info).
  	 * @memberOf LoaderSupport.Builder
  	 *
  	 * @param {Object} meshPayload Raw mesh description (buffers, params, materials) used to build one to many meshes.
  	 * @returns {Mesh[]} mesh Array of {@link Mesh}
  	 */Builder.prototype.buildMeshes=function(meshPayload){var this$1=this;var meshName=meshPayload.params.meshName;var bufferGeometry=new BufferGeometry();bufferGeometry.addAttribute('position',new BufferAttribute(new Float32Array(meshPayload.buffers.vertices),3));if(Validator.isValid(meshPayload.buffers.indices)){bufferGeometry.setIndex(new BufferAttribute(new Uint32Array(meshPayload.buffers.indices),1));}var haveVertexColors=Validator.isValid(meshPayload.buffers.colors);if(haveVertexColors){bufferGeometry.addAttribute('color',new BufferAttribute(new Float32Array(meshPayload.buffers.colors),3));}if(Validator.isValid(meshPayload.buffers.normals)){bufferGeometry.addAttribute('normal',new BufferAttribute(new Float32Array(meshPayload.buffers.normals),3));}else{bufferGeometry.computeVertexNormals();}if(Validator.isValid(meshPayload.buffers.uvs)){bufferGeometry.addAttribute('uv',new BufferAttribute(new Float32Array(meshPayload.buffers.uvs),2));}var material,materialName,key;var materialNames=meshPayload.materials.materialNames;var createMultiMaterial=meshPayload.materials.multiMaterial;var multiMaterials=[];for(key in materialNames){materialName=materialNames[key];material=this$1.materials[materialName];if(createMultiMaterial){multiMaterials.push(material);}}if(createMultiMaterial){material=multiMaterials;var materialGroups=meshPayload.materials.materialGroups;var materialGroup;for(key in materialGroups){materialGroup=materialGroups[key];bufferGeometry.addGroup(materialGroup.start,materialGroup.count,materialGroup.index);}}var meshes=[];var mesh;var callbackOnMeshAlter=this.callbacks.onMeshAlter;var callbackOnMeshAlterResult;var useOrgMesh=true;if(Validator.isValid(callbackOnMeshAlter)){callbackOnMeshAlterResult=callbackOnMeshAlter({detail:{meshName:meshName,bufferGeometry:bufferGeometry,material:material}});if(Validator.isValid(callbackOnMeshAlterResult)){if(!callbackOnMeshAlterResult.isDisregardMesh()&&callbackOnMeshAlterResult.providesAlteredMeshes()){for(var i in callbackOnMeshAlterResult.meshes){meshes.push(callbackOnMeshAlterResult.meshes[i]);}}useOrgMesh=false;}}if(useOrgMesh){mesh=new Mesh(bufferGeometry,material);mesh.name=meshName;meshes.push(mesh);}var progressMessage;if(Validator.isValid(meshes)&&meshes.length>0){var meshNames=[];for(var i in meshes){mesh=meshes[i];meshNames[i]=mesh.name;}progressMessage='Adding mesh(es) ('+meshNames.length+': '+meshNames+') from input mesh: '+meshName;progressMessage+=' ('+(meshPayload.progress.numericalValue*100).toFixed(2)+'%)';}else{progressMessage='Not adding mesh: '+meshName;progressMessage+=' ('+(meshPayload.progress.numericalValue*100).toFixed(2)+'%)';}var callbackOnProgress=this.callbacks.onProgress;if(Validator.isValid(callbackOnProgress)){var event=new CustomEvent('BuilderEvent',{detail:{type:'progress',modelName:meshPayload.params.meshName,text:progressMessage,numericalValue:meshPayload.progress.numericalValue}});callbackOnProgress(event);}return meshes;};/**
  	 * Updates the materials with contained material objects (sync) or from alteration instructions (async).
  	 * @memberOf LoaderSupport.Builder
  	 *
  	 * @param {Object} materialPayload Material update instructions
  	 */Builder.prototype.updateMaterials=function(materialPayload){var this$1=this;var material,materialName;var materialCloneInstructions=materialPayload.materials.materialCloneInstructions;if(Validator.isValid(materialCloneInstructions)){var materialNameOrg=materialCloneInstructions.materialNameOrg;var materialOrg=this.materials[materialNameOrg];material=materialOrg.clone();materialName=materialCloneInstructions.materialName;material.name=materialName;var materialProperties=materialCloneInstructions.materialProperties;for(var key in materialProperties){if(material.hasOwnProperty(key)&&materialProperties.hasOwnProperty(key)){material[key]=materialProperties[key];}}this.materials[materialName]=material;}var materials=materialPayload.materials.serializedMaterials;if(Validator.isValid(materials)&&Object.keys(materials).length>0){var loader=new MaterialLoader();var materialJson;for(materialName in materials){materialJson=materials[materialName];if(Validator.isValid(materialJson)){material=loader.parse(materialJson);this$1.logger.logInfo('De-serialized material with name "'+materialName+'" will be added.');this$1.materials[materialName]=material;}}}materials=materialPayload.materials.runtimeMaterials;if(Validator.isValid(materials)&&Object.keys(materials).length>0){for(materialName in materials){material=materials[materialName];this$1.logger.logInfo('Material with name "'+materialName+'" will be added.');this$1.materials[materialName]=material;}}};/**
  	 * Returns the mapping object of material name and corresponding jsonified material.
  	 *
  	 * @returns {Object} Map of Materials in JSON representation
  	 */Builder.prototype.getMaterialsJSON=function(){var this$1=this;var materialsJSON={};var material;for(var materialName in this$1.materials){material=this$1.materials[materialName];materialsJSON[materialName]=material.toJSON();}return materialsJSON;};/**
  	 * Returns the mapping object of material name and corresponding material.
  	 *
  	 * @returns {Object} Map of {@link Material}
  	 */Builder.prototype.getMaterials=function(){return this.materials;};return Builder;}();/**
   * Base class to be used by loaders.
   * @class
   *
   * @param {DefaultLoadingManager} [manager] The loadingManager for the loader to use. Default is {@link DefaultLoadingManager}
   * @param {LoaderSupport.ConsoleLogger} logger logger to be used
   */LoaderSupport.LoaderBase=function(){var Validator=LoaderSupport.Validator;var ConsoleLogger=LoaderSupport.ConsoleLogger;function LoaderBase(manager,logger){this.manager=Validator.verifyInput(manager,DefaultLoadingManager);this.logger=Validator.verifyInput(logger,new ConsoleLogger());this.modelName='';this.instanceNo=0;this.path='';this.useIndices=false;this.disregardNormals=false;this.loaderRootNode=new Group();this.builder=new LoaderSupport.Builder(this.logger);this._createDefaultMaterials();this.callbacks=new LoaderSupport.Callbacks();}LoaderBase.prototype._createDefaultMaterials=function(){var defaultMaterial=new MeshStandardMaterial({color:0xDCF1FF});defaultMaterial.name='defaultMaterial';var vertexColorMaterial=new MeshStandardMaterial({color:0xDCF1FF});vertexColorMaterial.name='vertexColorMaterial';vertexColorMaterial.vertexColors=VertexColors;var runtimeMaterials={};runtimeMaterials[defaultMaterial.name]=defaultMaterial;runtimeMaterials[vertexColorMaterial.name]=vertexColorMaterial;this.builder.updateMaterials({cmd:'materialData',materials:{materialCloneInstructions:null,serializedMaterials:null,runtimeMaterials:runtimeMaterials}});};LoaderBase.prototype._applyPrepData=function(prepData){if(Validator.isValid(prepData)){this.setModelName(prepData.modelName);this.setStreamMeshesTo(prepData.streamMeshesTo);this.builder.setMaterials(prepData.materials);this.setUseIndices(prepData.useIndices);this.setDisregardNormals(prepData.disregardNormals);this._setCallbacks(prepData.getCallbacks());}};LoaderBase.prototype._setCallbacks=function(callbacks){if(Validator.isValid(callbacks.onProgress)){this.callbacks.setCallbackOnProgress(callbacks.onProgress);}if(Validator.isValid(callbacks.onMeshAlter)){this.callbacks.setCallbackOnMeshAlter(callbacks.onMeshAlter);}if(Validator.isValid(callbacks.onLoad)){this.callbacks.setCallbackOnLoad(callbacks.onLoad);}if(Validator.isValid(callbacks.onLoadMaterials)){this.callbacks.setCallbackOnLoadMaterials(callbacks.onLoadMaterials);}this.builder._setCallbacks(this.callbacks);};/**
  	 * Provides access to console logging wrapper.
  	 *
  	 * @returns {LoaderSupport.ConsoleLogger}
  	 */LoaderBase.prototype.getLogger=function(){return this.logger;};/**
  	 * Set the name of the model.
  	 * @memberOf LoaderSupport.LoaderBase
  	 *
  	 * @param {string} modelName
  	 */LoaderBase.prototype.setModelName=function(modelName){this.modelName=Validator.verifyInput(modelName,this.modelName);};/**
  	 * The URL of the base path.
  	 * @memberOf LoaderSupport.LoaderBase
  	 *
  	 * @param {string} path URL
  	 */LoaderBase.prototype.setPath=function(path){this.path=Validator.verifyInput(path,this.path);};/**
  	 * Set the node where the loaded objects will be attached directly.
  	 * @memberOf LoaderSupport.LoaderBase
  	 *
  	 * @param {Object3D} streamMeshesTo Object already attached to scenegraph where new meshes will be attached to
  	 */LoaderBase.prototype.setStreamMeshesTo=function(streamMeshesTo){this.loaderRootNode=Validator.verifyInput(streamMeshesTo,this.loaderRootNode);};/**
  	 * Set materials loaded by MTLLoader or any other supplier of an Array of {@link Material}.
  	 * @memberOf LoaderSupport.LoaderBase
  	 *
  	 * @param {Material[]} materials Array of {@link Material}
  	 */LoaderBase.prototype.setMaterials=function(materials){this.builder.setMaterials(materials);};/**
  	 * Instructs loaders to create indexed {@link BufferGeometry}.
  	 * @memberOf LoaderSupport.LoaderBase
  	 *
  	 * @param {boolean} useIndices=false
  	 */LoaderBase.prototype.setUseIndices=function(useIndices){this.useIndices=useIndices===true;};/**
  	 * Tells whether normals should be completely disregarded and regenerated.
  	 * @memberOf LoaderSupport.LoaderBase
  	 *
  	 * @param {boolean} disregardNormals=false
  	 */LoaderBase.prototype.setDisregardNormals=function(disregardNormals){this.disregardNormals=disregardNormals===true;};/**
  	 * Announce feedback which is give to the registered callbacks.
  	 * @memberOf LoaderSupport.LoaderBase
  	 * @private
  	 *
  	 * @param {string} type The type of event
  	 * @param {string} text Textual description of the event
  	 * @param {number} numericalValue Numerical value describing the progress
  	 */LoaderBase.prototype.onProgress=function(type,text,numericalValue){var content=Validator.isValid(text)?text:'';var event={detail:{type:type,modelName:this.modelName,instanceNo:this.instanceNo,text:content,numericalValue:numericalValue}};if(Validator.isValid(this.callbacks.onProgress)){this.callbacks.onProgress(event);}this.logger.logDebug(content);};return LoaderBase;}();/**
   * Default implementation of the WorkerRunner responsible for creation and configuration of the parser within the worker.
   *
   * @class
   */LoaderSupport.WorkerRunnerRefImpl=function(){function WorkerRunnerRefImpl(){var scope=this;var scopedRunner=function scopedRunner(event){scope.processMessage(event.data);};self.addEventListener('message',scopedRunner,false);}/**
  	 * Applies values from parameter object via set functions or via direct assignment.
  	 * @memberOf LoaderSupport.WorkerRunnerRefImpl
  	 *
  	 * @param {Object} parser The parser instance
  	 * @param {Object} params The parameter object
  	 */WorkerRunnerRefImpl.prototype.applyProperties=function(parser,params){var property,funcName,values;for(property in params){funcName='set'+property.substring(0,1).toLocaleUpperCase()+property.substring(1);values=params[property];if(typeof parser[funcName]==='function'){parser[funcName](values);}else if(parser.hasOwnProperty(property)){parser[property]=values;}}};/**
  	 * Configures the Parser implementation according the supplied configuration object.
  	 * @memberOf LoaderSupport.WorkerRunnerRefImpl
  	 *
  	 * @param {Object} payload Raw mesh description (buffers, params, materials) used to build one to many meshes.
  	 */WorkerRunnerRefImpl.prototype.processMessage=function(payload){var logEnabled=payload.logger.enabled;var logDebug=payload.logger.enabled;if(payload.cmd==='run'){var callbacks={callbackBuilder:function callbackBuilder(payload){self.postMessage(payload);},callbackProgress:function callbackProgress(text){if(logEnabled&&logDebug){console.debug('WorkerRunner: progress: '+text);}}};// Parser is expected to be named as such
  var parser=new Parser();if(typeof parser['setLogConfig']==='function'){parser.setLogConfig(logEnabled,logDebug);}this.applyProperties(parser,payload.params);this.applyProperties(parser,payload.materials);this.applyProperties(parser,callbacks);parser.workerScope=self;parser.parse(payload.data.input,payload.data.options);if(logEnabled){console.log('WorkerRunner: Run complete!');}callbacks.callbackBuilder({cmd:'complete',msg:'WorkerRunner completed run.'});}else{console.error('WorkerRunner: Received unknown command: '+payload.cmd);}};return WorkerRunnerRefImpl;}();/**
   * This class provides means to transform existing parser code into a web worker. It defines a simple communication protocol
   * which allows to configure the worker and receive raw mesh data during execution.
   * @class
   *
   * @param {LoaderSupport.ConsoleLogger} logger logger to be used
   */LoaderSupport.WorkerSupport=function(){var WORKER_SUPPORT_VERSION='2.0.1';var Validator=LoaderSupport.Validator;var LoaderWorker=function(){function LoaderWorker(logger){this.logger=Validator.verifyInput(logger,new LoaderSupport.ConsoleLogger());this._reset();}LoaderWorker.prototype._reset=function(){this.worker=null;this.runnerImplName=null;this.callbacks={builder:null,onLoad:null};this.terminateRequested=false;this.queuedMessage=null;this.started=false;};LoaderWorker.prototype.initWorker=function(code,runnerImplName){this.runnerImplName=runnerImplName;var blob=new Blob([code],{type:'application/javascript'});this.worker=new Worker(window.URL.createObjectURL(blob));this.worker.onmessage=this._receiveWorkerMessage;// set referemce to this, then processing in worker scope within "_receiveWorkerMessage" can access members
  this.worker.runtimeRef=this;// process stored queuedMessage
  this._postMessage();};/**
  		 * Executed in worker scope
   		 */LoaderWorker.prototype._receiveWorkerMessage=function(e){var payload=e.data;switch(payload.cmd){case'meshData':case'materialData':case'imageData':this.runtimeRef.callbacks.builder(payload);break;case'complete':this.runtimeRef.queuedMessage=null;this.started=false;this.runtimeRef.callbacks.onLoad(payload.msg);if(this.runtimeRef.terminateRequested){this.runtimeRef.logger.logInfo('WorkerSupport ['+this.runtimeRef.runnerImplName+']: Run is complete. Terminating application on request!');this.runtimeRef._terminate();}break;case'error':this.runtimeRef.logger.logError('WorkerSupport ['+this.runtimeRef.runnerImplName+']: Reported error: '+payload.msg);this.runtimeRef.queuedMessage=null;this.started=false;this.runtimeRef.callbacks.onLoad(payload.msg);if(this.runtimeRef.terminateRequested){this.runtimeRef.logger.logInfo('WorkerSupport ['+this.runtimeRef.runnerImplName+']: Run reported error. Terminating application on request!');this.runtimeRef._terminate();}break;default:this.runtimeRef.logger.logError('WorkerSupport ['+this.runtimeRef.runnerImplName+']: Received unknown command: '+payload.cmd);break;}};LoaderWorker.prototype.setCallbacks=function(builder,onLoad){this.callbacks.builder=Validator.verifyInput(builder,this.callbacks.builder);this.callbacks.onLoad=Validator.verifyInput(onLoad,this.callbacks.onLoad);};LoaderWorker.prototype.run=function(payload){if(Validator.isValid(this.queuedMessage)){console.warn('Already processing message. Rejecting new run instruction');return;}else{this.queuedMessage=payload;this.started=true;}if(!Validator.isValid(this.callbacks.builder)){throw'Unable to run as no "builder" callback is set.';}if(!Validator.isValid(this.callbacks.onLoad)){throw'Unable to run as no "onLoad" callback is set.';}if(payload.cmd!=='run'){payload.cmd='run';}if(Validator.isValid(payload.logger)){payload.logger.enabled=Validator.verifyInput(payload.logger.enabled,true);payload.logger.debug=Validator.verifyInput(payload.logger.debug,false);}else{payload.logger={enabled:true,debug:false};}this._postMessage();};LoaderWorker.prototype._postMessage=function(){if(Validator.isValid(this.queuedMessage)&&Validator.isValid(this.worker)){if(this.queuedMessage.data.input instanceof ArrayBuffer){this.worker.postMessage(this.queuedMessage,[this.queuedMessage.data.input]);}else{this.worker.postMessage(this.queuedMessage);}}};LoaderWorker.prototype.setTerminateRequested=function(terminateRequested){this.terminateRequested=terminateRequested===true;if(this.terminateRequested&&Validator.isValid(this.worker)&&!Validator.isValid(this.queuedMessage)&&this.started){this.logger.logInfo('Worker is terminated immediately as it is not running!');this._terminate();}};LoaderWorker.prototype._terminate=function(){this.worker.terminate();this._reset();};return LoaderWorker;}();function WorkerSupport(logger){this.logger=Validator.verifyInput(logger,new LoaderSupport.ConsoleLogger());this.logger.logInfo('Using LoaderSupport.WorkerSupport version: '+WORKER_SUPPORT_VERSION);// check worker support first
  if(window.Worker===undefined){throw"This browser does not support web workers!";}if(window.Blob===undefined){throw"This browser does not support Blob!";}if(typeof window.URL.createObjectURL!=='function'){throw"This browser does not support Object creation from URL!";}this.loaderWorker=new LoaderWorker(this.logger);}/**
  	 * Validate the status of worker code and the derived worker.
  	 * @memberOf LoaderSupport.WorkerSupport
  	 *
  	 * @param {Function} functionCodeBuilder Function that is invoked with funcBuildObject and funcBuildSingelton that allows stringification of objects and singletons.
  	 * @param {String[]} libLocations URL of libraries that shall be added to worker code relative to libPath
  	 * @param {String} libPath Base path used for loading libraries
  	 * @param {LoaderSupport.WorkerRunnerRefImpl} runnerImpl The default worker parser wrapper implementation (communication and execution). An extended class could be passed here.
  	 */WorkerSupport.prototype.validate=function(functionCodeBuilder,libLocations,libPath,runnerImpl){if(Validator.isValid(this.loaderWorker.worker)){return;}this.logger.logInfo('WorkerSupport: Building worker code...');this.logger.logTimeStart('buildWebWorkerCode');if(Validator.isValid(runnerImpl)){this.logger.logInfo('WorkerSupport: Using "'+runnerImpl.name+'" as Runncer class for worker.');}else{runnerImpl=LoaderSupport.WorkerRunnerRefImpl;this.logger.logInfo('WorkerSupport: Using DEFAULT "LoaderSupport.WorkerRunnerRefImpl" as Runncer class for worker.');}var userWorkerCode=functionCodeBuilder(buildObject,buildSingelton);userWorkerCode+=buildSingelton(runnerImpl.name,runnerImpl.name,runnerImpl);userWorkerCode+='new '+runnerImpl.name+'();\n\n';var scope=this;if(Validator.isValid(libLocations)&&libLocations.length>0){var libsContent='';var loadAllLibraries=function loadAllLibraries(path,locations){if(locations.length===0){scope.loaderWorker.initWorker(libsContent+userWorkerCode,scope.logger,runnerImpl.name);scope.logger.logTimeEnd('buildWebWorkerCode');}else{var loadedLib=function loadedLib(contentAsString){libsContent+=contentAsString;loadAllLibraries(path,locations);};var fileLoader=new FileLoader();fileLoader.setPath(path);fileLoader.setResponseType('text');fileLoader.load(locations[0],loadedLib);locations.shift();}};loadAllLibraries(libPath,libLocations);}else{this.loaderWorker.initWorker(userWorkerCode,this.logger,runnerImpl.name);this.logger.logTimeEnd('buildWebWorkerCode');}};/**
  	 * Specify functions that should be build when new raw mesh data becomes available and when the parser is finished.
  	 * @memberOf LoaderSupport.WorkerSupport
  	 *
  	 * @param {Function} builder The builder function. Default is {@link LoaderSupport.Builder}.
  	 * @param {Function} onLoad The function that is called when parsing is complete.
  	 */WorkerSupport.prototype.setCallbacks=function(builder,onLoad){this.loaderWorker.setCallbacks(builder,onLoad);};/**
  	 * Runs the parser with the provided configuration.
  	 * @memberOf LoaderSupport.WorkerSupport
  	 *
  	 * @param {Object} payload Raw mesh description (buffers, params, materials) used to build one to many meshes.
  	 */WorkerSupport.prototype.run=function(payload){this.loaderWorker.run(payload);};/**
  	 * Request termination of worker once parser is finished.
  	 * @memberOf LoaderSupport.WorkerSupport
  	 *
  	 * @param {boolean} terminateRequested True or false.
  	 */WorkerSupport.prototype.setTerminateRequested=function(terminateRequested){this.loaderWorker.setTerminateRequested(terminateRequested);};var buildObject=function buildObject(fullName,object){var objectString=fullName+' = {\n';var part;for(var name in object){part=object[name];if(typeof part==='string'||part instanceof String){part=part.replace('\n','\\n');part=part.replace('\r','\\r');objectString+='\t'+name+': "'+part+'",\n';}else if(part instanceof Array){objectString+='\t'+name+': ['+part+'],\n';}else if(Number.isInteger(part)){objectString+='\t'+name+': '+part+',\n';}else if(typeof part==='function'){objectString+='\t'+name+': '+part+',\n';}}objectString+='}\n\n';return objectString;};var buildSingelton=function buildSingelton(fullName,internalName,object){var objectString=fullName+' = (function () {\n\n';objectString+='\t'+object.prototype.constructor.toString()+'\n\n';objectString=objectString.replace(object.name,internalName);var funcString;var objectPart;for(var name in object.prototype){objectPart=object.prototype[name];if(typeof objectPart==='function'){funcString=objectPart.toString();objectString+='\t'+internalName+'.prototype.'+name+' = '+funcString+';\n\n';}}objectString+='\treturn '+internalName+';\n';objectString+='})();\n\n';return objectString;};return WorkerSupport;}();/**
   * Orchestrate loading of multiple OBJ files/data from an instruction queue with a configurable amount of workers (1-16).
   * Workflow:
   *   prepareWorkers
   *   enqueueForRun
   *   processQueue
   *   tearDown (to force stop)
   *
   * @class
   *
   * @param {string} classDef Class definition to be used for construction
   * @param {LoaderSupport.ConsoleLogger} logger logger to be used
   */LoaderSupport.WorkerDirector=function(){var LOADER_WORKER_DIRECTOR_VERSION='2.1.0';var Validator=LoaderSupport.Validator;var MAX_WEB_WORKER=16;var MAX_QUEUE_SIZE=8192;function WorkerDirector(classDef,logger){this.logger=Validator.verifyInput(logger,new LoaderSupport.ConsoleLogger());this.logger.logInfo('Using LoaderSupport.WorkerDirector version: '+LOADER_WORKER_DIRECTOR_VERSION);this.maxQueueSize=MAX_QUEUE_SIZE;this.maxWebWorkers=MAX_WEB_WORKER;this.crossOrigin=null;if(!Validator.isValid(classDef)){throw'Provided invalid classDef: '+classDef;}this.workerDescription={classDef:classDef,globalCallbacks:{},workerSupports:{}};this.objectsCompleted=0;this.instructionQueue=[];this.instructionQueuePointer=0;this.callbackOnFinishedProcessing=null;}/**
  	 * Returns the maximum length of the instruction queue.
  	 * @memberOf LoaderSupport.WorkerDirector
  	 *
  	 * @returns {number}
  	 */WorkerDirector.prototype.getMaxQueueSize=function(){return this.maxQueueSize;};/**
  	 * Returns the maximum number of workers.
  	 * @memberOf LoaderSupport.WorkerDirector
  	 *
  	 * @returns {number}
  	 */WorkerDirector.prototype.getMaxWebWorkers=function(){return this.maxWebWorkers;};/**
  	 * Sets the CORS string to be used.
  	 * @memberOf LoaderSupport.WorkerDirector
  	 *
  	 * @param {string} crossOrigin CORS value
  	 */WorkerDirector.prototype.setCrossOrigin=function(crossOrigin){this.crossOrigin=crossOrigin;};/**
  	 * Create or destroy workers according limits. Set the name and register callbacks for dynamically created web workers.
  	 * @memberOf LoaderSupport.WorkerDirector
  	 *
  	 * @param {OBJLoader2.WWOBJLoader2.PrepDataCallbacks} globalCallbacks  Register global callbacks used by all web workers
  	 * @param {number} maxQueueSize Set the maximum size of the instruction queue (1-1024)
  	 * @param {number} maxWebWorkers Set the maximum amount of workers (1-16)
  	 */WorkerDirector.prototype.prepareWorkers=function(globalCallbacks,maxQueueSize,maxWebWorkers){var this$1=this;if(Validator.isValid(globalCallbacks)){this.workerDescription.globalCallbacks=globalCallbacks;}this.maxQueueSize=Math.min(maxQueueSize,MAX_QUEUE_SIZE);this.maxWebWorkers=Math.min(maxWebWorkers,MAX_WEB_WORKER);this.maxWebWorkers=Math.min(this.maxWebWorkers,this.maxQueueSize);this.objectsCompleted=0;this.instructionQueue=[];this.instructionQueuePointer=0;for(var instanceNo=0;instanceNo<this.maxWebWorkers;instanceNo++){this$1.workerDescription.workerSupports[instanceNo]={instanceNo:instanceNo,inUse:false,terminateRequested:false,workerSupport:new LoaderSupport.WorkerSupport(this$1.logger),loader:null};}};/**
  	 * Store run instructions in internal instructionQueue.
  	 * @memberOf LoaderSupport.WorkerDirector
  	 *
  	 * @param {LoaderSupport.PrepData} prepData
  	 */WorkerDirector.prototype.enqueueForRun=function(prepData){if(this.instructionQueue.length<this.maxQueueSize){this.instructionQueue.push(prepData);}};/**
  	 * Returns if any workers are running.
  	 *
  	 * @memberOf LoaderSupport.WorkerDirector
  	 * @returns {boolean}
  	 */WorkerDirector.prototype.isRunning=function(){var wsKeys=Object.keys(this.workerDescription.workerSupports);return this.instructionQueue.length>0&&this.instructionQueuePointer<this.instructionQueue.length||wsKeys.length>0;};/**
  	 * Process the instructionQueue until it is depleted.
  	 * @memberOf LoaderSupport.WorkerDirector
  	 */WorkerDirector.prototype.processQueue=function(){var this$1=this;var prepData,supportDesc;for(var instanceNo in this$1.workerDescription.workerSupports){supportDesc=this$1.workerDescription.workerSupports[instanceNo];if(!supportDesc.inUse){if(this$1.instructionQueuePointer<this$1.instructionQueue.length){prepData=this$1.instructionQueue[this$1.instructionQueuePointer];this$1._kickWorkerRun(prepData,supportDesc);this$1.instructionQueuePointer++;}else{this$1._deregister(supportDesc);}}}if(!this.isRunning()&&this.callbackOnFinishedProcessing!==null){this.callbackOnFinishedProcessing();this.callbackOnFinishedProcessing=null;}};WorkerDirector.prototype._kickWorkerRun=function(prepData,supportDesc){supportDesc.inUse=true;supportDesc.workerSupport.setTerminateRequested(supportDesc.terminateRequested);this.logger.logInfo('\nAssigning next item from queue to worker (queue length: '+this.instructionQueue.length+')\n\n');var scope=this;var prepDataCallbacks=prepData.getCallbacks();var globalCallbacks=this.workerDescription.globalCallbacks;var wrapperOnLoad=function wrapperOnLoad(event){if(Validator.isValid(globalCallbacks.onLoad)){globalCallbacks.onLoad(event);}if(Validator.isValid(prepDataCallbacks.onLoad)){prepDataCallbacks.onLoad(event);}scope.objectsCompleted++;supportDesc.inUse=false;scope.processQueue();};var wrapperOnProgress=function wrapperOnProgress(event){if(Validator.isValid(globalCallbacks.onProgress)){globalCallbacks.onProgress(event);}if(Validator.isValid(prepDataCallbacks.onProgress)){prepDataCallbacks.onProgress(event);}};var wrapperOnMeshAlter=function wrapperOnMeshAlter(event){if(Validator.isValid(globalCallbacks.onMeshAlter)){globalCallbacks.onMeshAlter(event);}if(Validator.isValid(prepDataCallbacks.onMeshAlter)){prepDataCallbacks.onMeshAlter(event);}};supportDesc.loader=this._buildLoader(supportDesc.instanceNo);var updatedCallbacks=new LoaderSupport.Callbacks();updatedCallbacks.setCallbackOnLoad(wrapperOnLoad);updatedCallbacks.setCallbackOnProgress(wrapperOnProgress);updatedCallbacks.setCallbackOnMeshAlter(wrapperOnMeshAlter);prepData.callbacks=updatedCallbacks;supportDesc.loader.run(prepData,supportDesc.workerSupport);};WorkerDirector.prototype._buildLoader=function(instanceNo){var classDef=this.workerDescription.classDef;var loader=Object.create(classDef.prototype);this.workerDescription.classDef.call(loader,DefaultLoadingManager,this.logger);// verify that all required functions are implemented
  if(!loader.hasOwnProperty('instanceNo')){throw classDef.name+' has no property "instanceNo".';}loader.instanceNo=instanceNo;if(!loader.hasOwnProperty('workerSupport')){throw classDef.name+' has no property "workerSupport".';}if(typeof loader.run!=='function'){throw classDef.name+' has no function "run".';}if(!loader.hasOwnProperty('callbacks')||!Validator.isValid(loader.callbacks)){this.logger.logWarn(classDef.name+' has an invalid property "callbacks". Will change to "LoaderSupport.Callbacks"');loader.callbacks=new LoaderSupport.Callbacks();}return loader;};WorkerDirector.prototype._deregister=function(supportDesc){if(Validator.isValid(supportDesc)){supportDesc.workerSupport.setTerminateRequested(true);this.logger.logInfo('Requested termination of worker #'+supportDesc.instanceNo+'.');var loaderCallbacks=supportDesc.loader.callbacks;if(Validator.isValid(loaderCallbacks.onProgress)){loaderCallbacks.onProgress({detail:{text:''}});}delete this.workerDescription.workerSupports[supportDesc.instanceNo];}};/**
  	 * Terminate all workers.
  	 * @memberOf LoaderSupport.WorkerDirector
  	 *
  	 * @param {callback} callbackOnFinishedProcessing Function called once all workers finished processing.
  	 */WorkerDirector.prototype.tearDown=function(callbackOnFinishedProcessing){var this$1=this;this.logger.logInfo('WorkerDirector received the deregister call. Terminating all workers!');this.instructionQueuePointer=this.instructionQueue.length;this.callbackOnFinishedProcessing=Validator.verifyInput(callbackOnFinishedProcessing,null);for(var name in this$1.workerDescription.workerSupports){this$1.workerDescription.workerSupports[name].terminateRequested=true;}};return WorkerDirector;}();/**
   * @author mrdoob / http://mrdoob.com/
   */var context;var AudioContext={getContext:function getContext(){if(context===undefined){context=new(window.AudioContext||window.webkitAudioContext)();}return context;},setContext:function setContext(value){context=value;}};/**
   * @author mrdoob / http://mrdoob.com/
   */function AudioListener(){Object3D.call(this);this.type='AudioListener';this.context=AudioContext.getContext();this.gain=this.context.createGain();this.gain.connect(this.context.destination);this.filter=null;}AudioListener.prototype=Object.assign(Object.create(Object3D.prototype),{constructor:AudioListener,getInput:function getInput(){return this.gain;},removeFilter:function removeFilter(){if(this.filter!==null){this.gain.disconnect(this.filter);this.filter.disconnect(this.context.destination);this.gain.connect(this.context.destination);this.filter=null;}},getFilter:function getFilter(){return this.filter;},setFilter:function setFilter(value){if(this.filter!==null){this.gain.disconnect(this.filter);this.filter.disconnect(this.context.destination);}else{this.gain.disconnect(this.context.destination);}this.filter=value;this.gain.connect(this.filter);this.filter.connect(this.context.destination);},getMasterVolume:function getMasterVolume(){return this.gain.gain.value;},setMasterVolume:function setMasterVolume(value){this.gain.gain.value=value;},updateMatrixWorld:function(){var position=new Vector3$1();var quaternion=new Quaternion();var scale=new Vector3$1();var orientation=new Vector3$1();return function updateMatrixWorld(force){Object3D.prototype.updateMatrixWorld.call(this,force);var listener=this.context.listener;var up=this.up;this.matrixWorld.decompose(position,quaternion,scale);orientation.set(0,0,-1).applyQuaternion(quaternion);if(listener.positionX){listener.positionX.setValueAtTime(position.x,this.context.currentTime);listener.positionY.setValueAtTime(position.y,this.context.currentTime);listener.positionZ.setValueAtTime(position.z,this.context.currentTime);listener.forwardX.setValueAtTime(orientation.x,this.context.currentTime);listener.forwardY.setValueAtTime(orientation.y,this.context.currentTime);listener.forwardZ.setValueAtTime(orientation.z,this.context.currentTime);listener.upX.setValueAtTime(up.x,this.context.currentTime);listener.upY.setValueAtTime(up.y,this.context.currentTime);listener.upZ.setValueAtTime(up.z,this.context.currentTime);}else{listener.setPosition(position.x,position.y,position.z);listener.setOrientation(orientation.x,orientation.y,orientation.z,up.x,up.y,up.z);}};}()});/**
   * @author mrdoob / http://mrdoob.com/
   * @author Reece Aaron Lecrivain / http://reecenotes.com/
   */function Audio(listener){Object3D.call(this);this.type='Audio';this.context=listener.context;this.gain=this.context.createGain();this.gain.connect(listener.getInput());this.autoplay=false;this.buffer=null;this.loop=false;this.startTime=0;this.offset=0;this.playbackRate=1;this.isPlaying=false;this.hasPlaybackControl=true;this.sourceType='empty';this.filters=[];}Audio.prototype=Object.assign(Object.create(Object3D.prototype),{constructor:Audio,getOutput:function getOutput(){return this.gain;},setNodeSource:function setNodeSource(audioNode){this.hasPlaybackControl=false;this.sourceType='audioNode';this.source=audioNode;this.connect();return this;},setBuffer:function setBuffer(audioBuffer){this.buffer=audioBuffer;this.sourceType='buffer';if(this.autoplay){this.play();}return this;},play:function play(){if(this.isPlaying===true){console.warn('THREE.Audio: Audio is already playing.');return;}if(this.hasPlaybackControl===false){console.warn('THREE.Audio: this Audio has no playback control.');return;}var source=this.context.createBufferSource();source.buffer=this.buffer;source.loop=this.loop;source.onended=this.onEnded.bind(this);source.playbackRate.setValueAtTime(this.playbackRate,this.startTime);this.startTime=this.context.currentTime;source.start(this.startTime,this.offset);this.isPlaying=true;this.source=source;return this.connect();},pause:function pause(){if(this.hasPlaybackControl===false){console.warn('THREE.Audio: this Audio has no playback control.');return;}if(this.isPlaying===true){this.source.stop();this.offset+=(this.context.currentTime-this.startTime)*this.playbackRate;this.isPlaying=false;}return this;},stop:function stop(){if(this.hasPlaybackControl===false){console.warn('THREE.Audio: this Audio has no playback control.');return;}this.source.stop();this.offset=0;this.isPlaying=false;return this;},connect:function connect(){var this$1=this;if(this.filters.length>0){this.source.connect(this.filters[0]);for(var i=1,l=this.filters.length;i<l;i++){this$1.filters[i-1].connect(this$1.filters[i]);}this.filters[this.filters.length-1].connect(this.getOutput());}else{this.source.connect(this.getOutput());}return this;},disconnect:function disconnect(){var this$1=this;if(this.filters.length>0){this.source.disconnect(this.filters[0]);for(var i=1,l=this.filters.length;i<l;i++){this$1.filters[i-1].disconnect(this$1.filters[i]);}this.filters[this.filters.length-1].disconnect(this.getOutput());}else{this.source.disconnect(this.getOutput());}return this;},getFilters:function getFilters(){return this.filters;},setFilters:function setFilters(value){if(!value){value=[];}if(this.isPlaying===true){this.disconnect();this.filters=value;this.connect();}else{this.filters=value;}return this;},getFilter:function getFilter(){return this.getFilters()[0];},setFilter:function setFilter(filter){return this.setFilters(filter?[filter]:[]);},setPlaybackRate:function setPlaybackRate(value){if(this.hasPlaybackControl===false){console.warn('THREE.Audio: this Audio has no playback control.');return;}this.playbackRate=value;if(this.isPlaying===true){this.source.playbackRate.setValueAtTime(this.playbackRate,this.context.currentTime);}return this;},getPlaybackRate:function getPlaybackRate(){return this.playbackRate;},onEnded:function onEnded(){this.isPlaying=false;},getLoop:function getLoop(){if(this.hasPlaybackControl===false){console.warn('THREE.Audio: this Audio has no playback control.');return false;}return this.loop;},setLoop:function setLoop(value){if(this.hasPlaybackControl===false){console.warn('THREE.Audio: this Audio has no playback control.');return;}this.loop=value;if(this.isPlaying===true){this.source.loop=this.loop;}return this;},getVolume:function getVolume(){return this.gain.gain.value;},setVolume:function setVolume(value){this.gain.gain.value=value;return this;}});/**
   * @author Reece Aaron Lecrivain / http://reecenotes.com/
   */function AudioLoader(manager){this.manager=manager!==undefined?manager:DefaultLoadingManager;}Object.assign(AudioLoader.prototype,{load:function load(url,onLoad,onProgress,onError){var loader=new FileLoader(this.manager);loader.setResponseType('arraybuffer');loader.load(url,function(buffer){var context=AudioContext.getContext();context.decodeAudioData(buffer,function(audioBuffer){onLoad(audioBuffer);});},onProgress,onError);}});/*
   * @author Daosheng Mu / https://github.com/DaoshengMu/
   * @author mrdoob / http://mrdoob.com/
   * @author takahirox / https://github.com/takahirox/
   */var TGALoader=function TGALoader(manager){this.manager=manager!==undefined?manager:DefaultLoadingManager;};TGALoader.prototype={constructor:TGALoader,load:function load(url,onLoad,onProgress,onError){var scope=this;var texture=new Texture$1();var loader=new FileLoader(this.manager);loader.setResponseType('arraybuffer');loader.load(url,function(buffer){texture.image=scope.parse(buffer);texture.needsUpdate=true;if(onLoad!==undefined){onLoad(texture);}},onProgress,onError);return texture;},parse:function parse(buffer){// reference from vthibault, https://github.com/vthibault/roBrowser/blob/master/src/Loaders/Targa.js
  function tgaCheckHeader(header){switch(header.image_type){// check indexed type
  case TGA_TYPE_INDEXED:case TGA_TYPE_RLE_INDEXED:if(header.colormap_length>256||header.colormap_size!==24||header.colormap_type!==1){console.error('TGALoader: Invalid type colormap data for indexed type.');}break;// check colormap type
  case TGA_TYPE_RGB:case TGA_TYPE_GREY:case TGA_TYPE_RLE_RGB:case TGA_TYPE_RLE_GREY:if(header.colormap_type){console.error('TGALoader: Invalid type colormap data for colormap type.');}break;// What the need of a file without data ?
  case TGA_TYPE_NO_DATA:console.error('TGALoader: No data.');// Invalid type ?
  default:console.error('TGALoader: Invalid type "%s".',header.image_type);}// check image width and height
  if(header.width<=0||header.height<=0){console.error('TGALoader: Invalid image size.');}// check image pixel size
  if(header.pixel_size!==8&&header.pixel_size!==16&&header.pixel_size!==24&&header.pixel_size!==32){console.error('TGALoader: Invalid pixel size "%s".',header.pixel_size);}}// parse tga image buffer
  function tgaParse(use_rle,use_pal,header,offset,data){var pixel_data,pixel_size,pixel_total,palettes;pixel_size=header.pixel_size>>3;pixel_total=header.width*header.height*pixel_size;// read palettes
  if(use_pal){palettes=data.subarray(offset,offset+=header.colormap_length*(header.colormap_size>>3));}// read RLE
  if(use_rle){pixel_data=new Uint8Array(pixel_total);var c,count,i;var shift=0;var pixels=new Uint8Array(pixel_size);while(shift<pixel_total){c=data[offset++];count=(c&0x7f)+1;// RLE pixels
  if(c&0x80){// bind pixel tmp array
  for(i=0;i<pixel_size;++i){pixels[i]=data[offset++];}// copy pixel array
  for(i=0;i<count;++i){pixel_data.set(pixels,shift+i*pixel_size);}shift+=pixel_size*count;}else{// raw pixels
  count*=pixel_size;for(i=0;i<count;++i){pixel_data[shift+i]=data[offset++];}shift+=count;}}}else{// raw pixels
  pixel_data=data.subarray(offset,offset+=use_pal?header.width*header.height:pixel_total);}return{pixel_data:pixel_data,palettes:palettes};}function tgaGetImageData8bits(imageData,y_start,y_step,y_end,x_start,x_step,x_end,image,palettes){var colormap=palettes;var color,i=0,x,y;var width=header.width;for(y=y_start;y!==y_end;y+=y_step){for(x=x_start;x!==x_end;x+=x_step, i++){color=image[i];imageData[(x+width*y)*4+3]=255;imageData[(x+width*y)*4+2]=colormap[color*3+0];imageData[(x+width*y)*4+1]=colormap[color*3+1];imageData[(x+width*y)*4+0]=colormap[color*3+2];}}return imageData;}function tgaGetImageData16bits(imageData,y_start,y_step,y_end,x_start,x_step,x_end,image){var color,i=0,x,y;var width=header.width;for(y=y_start;y!==y_end;y+=y_step){for(x=x_start;x!==x_end;x+=x_step, i+=2){color=image[i+0]+(image[i+1]<<8);// Inversed ?
  imageData[(x+width*y)*4+0]=(color&0x7C00)>>7;imageData[(x+width*y)*4+1]=(color&0x03E0)>>2;imageData[(x+width*y)*4+2]=(color&0x001F)>>3;imageData[(x+width*y)*4+3]=color&0x8000?0:255;}}return imageData;}function tgaGetImageData24bits(imageData,y_start,y_step,y_end,x_start,x_step,x_end,image){var i=0,x,y;var width=header.width;for(y=y_start;y!==y_end;y+=y_step){for(x=x_start;x!==x_end;x+=x_step, i+=3){imageData[(x+width*y)*4+3]=255;imageData[(x+width*y)*4+2]=image[i+0];imageData[(x+width*y)*4+1]=image[i+1];imageData[(x+width*y)*4+0]=image[i+2];}}return imageData;}function tgaGetImageData32bits(imageData,y_start,y_step,y_end,x_start,x_step,x_end,image){var i=0,x,y;var width=header.width;for(y=y_start;y!==y_end;y+=y_step){for(x=x_start;x!==x_end;x+=x_step, i+=4){imageData[(x+width*y)*4+2]=image[i+0];imageData[(x+width*y)*4+1]=image[i+1];imageData[(x+width*y)*4+0]=image[i+2];imageData[(x+width*y)*4+3]=image[i+3];}}return imageData;}function tgaGetImageDataGrey8bits(imageData,y_start,y_step,y_end,x_start,x_step,x_end,image){var color,i=0,x,y;var width=header.width;for(y=y_start;y!==y_end;y+=y_step){for(x=x_start;x!==x_end;x+=x_step, i++){color=image[i];imageData[(x+width*y)*4+0]=color;imageData[(x+width*y)*4+1]=color;imageData[(x+width*y)*4+2]=color;imageData[(x+width*y)*4+3]=255;}}return imageData;}function tgaGetImageDataGrey16bits(imageData,y_start,y_step,y_end,x_start,x_step,x_end,image){var i=0,x,y;var width=header.width;for(y=y_start;y!==y_end;y+=y_step){for(x=x_start;x!==x_end;x+=x_step, i+=2){imageData[(x+width*y)*4+0]=image[i+0];imageData[(x+width*y)*4+1]=image[i+0];imageData[(x+width*y)*4+2]=image[i+0];imageData[(x+width*y)*4+3]=image[i+1];}}return imageData;}function getTgaRGBA(data,width,height,image,palette){var x_start,y_start,x_step,y_step,x_end,y_end;switch((header.flags&TGA_ORIGIN_MASK)>>TGA_ORIGIN_SHIFT){default:case TGA_ORIGIN_UL:x_start=0;x_step=1;x_end=width;y_start=0;y_step=1;y_end=height;break;case TGA_ORIGIN_BL:x_start=0;x_step=1;x_end=width;y_start=height-1;y_step=-1;y_end=-1;break;case TGA_ORIGIN_UR:x_start=width-1;x_step=-1;x_end=-1;y_start=0;y_step=1;y_end=height;break;case TGA_ORIGIN_BR:x_start=width-1;x_step=-1;x_end=-1;y_start=height-1;y_step=-1;y_end=-1;break;}if(use_grey){switch(header.pixel_size){case 8:tgaGetImageDataGrey8bits(data,y_start,y_step,y_end,x_start,x_step,x_end,image);break;case 16:tgaGetImageDataGrey16bits(data,y_start,y_step,y_end,x_start,x_step,x_end,image);break;default:console.error('TGALoader: Format not supported.');break;}}else{switch(header.pixel_size){case 8:tgaGetImageData8bits(data,y_start,y_step,y_end,x_start,x_step,x_end,image,palette);break;case 16:tgaGetImageData16bits(data,y_start,y_step,y_end,x_start,x_step,x_end,image);break;case 24:tgaGetImageData24bits(data,y_start,y_step,y_end,x_start,x_step,x_end,image);break;case 32:tgaGetImageData32bits(data,y_start,y_step,y_end,x_start,x_step,x_end,image);break;default:console.error('TGALoader: Format not supported.');break;}}// Load image data according to specific method
  // var func = 'tgaGetImageData' + (use_grey ? 'Grey' : '') + (header.pixel_size) + 'bits';
  // func(data, y_start, y_step, y_end, x_start, x_step, x_end, width, image, palette );
  return data;}// TGA constants
  var TGA_TYPE_NO_DATA=0,TGA_TYPE_INDEXED=1,TGA_TYPE_RGB=2,TGA_TYPE_GREY=3,TGA_TYPE_RLE_INDEXED=9,TGA_TYPE_RLE_RGB=10,TGA_TYPE_RLE_GREY=11,TGA_ORIGIN_MASK=0x30,TGA_ORIGIN_SHIFT=0x04,TGA_ORIGIN_BL=0x00,TGA_ORIGIN_BR=0x01,TGA_ORIGIN_UL=0x02,TGA_ORIGIN_UR=0x03;if(buffer.length<19){console.error('TGALoader: Not enough data to contain header.');}var content=new Uint8Array(buffer),offset=0,header={id_length:content[offset++],colormap_type:content[offset++],image_type:content[offset++],colormap_index:content[offset++]|content[offset++]<<8,colormap_length:content[offset++]|content[offset++]<<8,colormap_size:content[offset++],origin:[content[offset++]|content[offset++]<<8,content[offset++]|content[offset++]<<8],width:content[offset++]|content[offset++]<<8,height:content[offset++]|content[offset++]<<8,pixel_size:content[offset++],flags:content[offset++]};// check tga if it is valid format
  tgaCheckHeader(header);if(header.id_length+offset>buffer.length){console.error('TGALoader: No data.');}// skip the needn't data
  offset+=header.id_length;// get targa information about RLE compression and palette
  var use_rle=false,use_pal=false,use_grey=false;switch(header.image_type){case TGA_TYPE_RLE_INDEXED:use_rle=true;use_pal=true;break;case TGA_TYPE_INDEXED:use_pal=true;break;case TGA_TYPE_RLE_RGB:use_rle=true;break;case TGA_TYPE_RGB:break;case TGA_TYPE_RLE_GREY:use_rle=true;use_grey=true;break;case TGA_TYPE_GREY:use_grey=true;break;}//
  var canvas=document.createElement('canvas');canvas.width=header.width;canvas.height=header.height;var context=canvas.getContext('2d');var imageData=context.createImageData(header.width,header.height);var result=tgaParse(use_rle,use_pal,header,offset,content);var rgbaData=getTgaRGBA(imageData.data,header.width,header.height,result.pixel_data,result.palettes);context.putImageData(imageData,0,0);return canvas;}};/**
   *
   * Action provided by AnimationMixer for scheduling clip playback on specific
   * objects.
   *
   * @author Ben Houston / http://clara.io/
   * @author David Sarno / http://lighthaus.us/
   * @author tschw
   *
   */function AnimationAction(mixer,clip,localRoot){this._mixer=mixer;this._clip=clip;this._localRoot=localRoot||null;var tracks=clip.tracks,nTracks=tracks.length,interpolants=new Array(nTracks);var interpolantSettings={endingStart:ZeroCurvatureEnding,endingEnd:ZeroCurvatureEnding};for(var i=0;i!==nTracks;++i){var interpolant=tracks[i].createInterpolant(null);interpolants[i]=interpolant;interpolant.settings=interpolantSettings;}this._interpolantSettings=interpolantSettings;this._interpolants=interpolants;// bound by the mixer
  // inside: PropertyMixer (managed by the mixer)
  this._propertyBindings=new Array(nTracks);this._cacheIndex=null;// for the memory manager
  this._byClipCacheIndex=null;// for the memory manager
  this._timeScaleInterpolant=null;this._weightInterpolant=null;this.loop=LoopRepeat;this._loopCount=-1;// global mixer time when the action is to be started
  // it's set back to 'null' upon start of the action
  this._startTime=null;// scaled local time of the action
  // gets clamped or wrapped to 0..clip.duration according to loop
  this.time=0;this.timeScale=1;this._effectiveTimeScale=1;this.weight=1;this._effectiveWeight=1;this.repetitions=Infinity;// no. of repetitions when looping
  this.paused=false;// true -> zero effective time scale
  this.enabled=true;// false -> zero effective weight
  this.clampWhenFinished=false;// keep feeding the last frame?
  this.zeroSlopeAtStart=true;// for smooth interpolation w/o separate
  this.zeroSlopeAtEnd=true;// clips for start, loop and end
  }Object.assign(AnimationAction.prototype,{// State & Scheduling
  play:function play(){this._mixer._activateAction(this);return this;},stop:function stop(){this._mixer._deactivateAction(this);return this.reset();},reset:function reset(){this.paused=false;this.enabled=true;this.time=0;// restart clip
  this._loopCount=-1;// forget previous loops
  this._startTime=null;// forget scheduling
  return this.stopFading().stopWarping();},isRunning:function isRunning(){return this.enabled&&!this.paused&&this.timeScale!==0&&this._startTime===null&&this._mixer._isActiveAction(this);},// return true when play has been called
  isScheduled:function isScheduled(){return this._mixer._isActiveAction(this);},startAt:function startAt(time){this._startTime=time;return this;},setLoop:function setLoop(mode,repetitions){this.loop=mode;this.repetitions=repetitions;return this;},// Weight
  // set the weight stopping any scheduled fading
  // although .enabled = false yields an effective weight of zero, this
  // method does *not* change .enabled, because it would be confusing
  setEffectiveWeight:function setEffectiveWeight(weight){this.weight=weight;// note: same logic as when updated at runtime
  this._effectiveWeight=this.enabled?weight:0;return this.stopFading();},// return the weight considering fading and .enabled
  getEffectiveWeight:function getEffectiveWeight(){return this._effectiveWeight;},fadeIn:function fadeIn(duration){return this._scheduleFading(duration,0,1);},fadeOut:function fadeOut(duration){return this._scheduleFading(duration,1,0);},crossFadeFrom:function crossFadeFrom(fadeOutAction,duration,warp){fadeOutAction.fadeOut(duration);this.fadeIn(duration);if(warp){var fadeInDuration=this._clip.duration,fadeOutDuration=fadeOutAction._clip.duration,startEndRatio=fadeOutDuration/fadeInDuration,endStartRatio=fadeInDuration/fadeOutDuration;fadeOutAction.warp(1.0,startEndRatio,duration);this.warp(endStartRatio,1.0,duration);}return this;},crossFadeTo:function crossFadeTo(fadeInAction,duration,warp){return fadeInAction.crossFadeFrom(this,duration,warp);},stopFading:function stopFading(){var weightInterpolant=this._weightInterpolant;if(weightInterpolant!==null){this._weightInterpolant=null;this._mixer._takeBackControlInterpolant(weightInterpolant);}return this;},// Time Scale Control
  // set the time scale stopping any scheduled warping
  // although .paused = true yields an effective time scale of zero, this
  // method does *not* change .paused, because it would be confusing
  setEffectiveTimeScale:function setEffectiveTimeScale(timeScale){this.timeScale=timeScale;this._effectiveTimeScale=this.paused?0:timeScale;return this.stopWarping();},// return the time scale considering warping and .paused
  getEffectiveTimeScale:function getEffectiveTimeScale(){return this._effectiveTimeScale;},setDuration:function setDuration(duration){this.timeScale=this._clip.duration/duration;return this.stopWarping();},syncWith:function syncWith(action){this.time=action.time;this.timeScale=action.timeScale;return this.stopWarping();},halt:function halt(duration){return this.warp(this._effectiveTimeScale,0,duration);},warp:function warp(startTimeScale,endTimeScale,duration){var mixer=this._mixer,now=mixer.time,interpolant=this._timeScaleInterpolant,timeScale=this.timeScale;if(interpolant===null){interpolant=mixer._lendControlInterpolant();this._timeScaleInterpolant=interpolant;}var times=interpolant.parameterPositions,values=interpolant.sampleValues;times[0]=now;times[1]=now+duration;values[0]=startTimeScale/timeScale;values[1]=endTimeScale/timeScale;return this;},stopWarping:function stopWarping(){var timeScaleInterpolant=this._timeScaleInterpolant;if(timeScaleInterpolant!==null){this._timeScaleInterpolant=null;this._mixer._takeBackControlInterpolant(timeScaleInterpolant);}return this;},// Object Accessors
  getMixer:function getMixer(){return this._mixer;},getClip:function getClip(){return this._clip;},getRoot:function getRoot(){return this._localRoot||this._mixer._root;},// Interna
  _update:function _update(time,deltaTime,timeDirection,accuIndex){// called by the mixer
  if(!this.enabled){// call ._updateWeight() to update ._effectiveWeight
  this._updateWeight(time);return;}var startTime=this._startTime;if(startTime!==null){// check for scheduled start of action
  var timeRunning=(time-startTime)*timeDirection;if(timeRunning<0||timeDirection===0){return;// yet to come / don't decide when delta = 0
  }// start
  this._startTime=null;// unschedule
  deltaTime=timeDirection*timeRunning;}// apply time scale and advance time
  deltaTime*=this._updateTimeScale(time);var clipTime=this._updateTime(deltaTime);// note: _updateTime may disable the action resulting in
  // an effective weight of 0
  var weight=this._updateWeight(time);if(weight>0){var interpolants=this._interpolants;var propertyMixers=this._propertyBindings;for(var j=0,m=interpolants.length;j!==m;++j){interpolants[j].evaluate(clipTime);propertyMixers[j].accumulate(accuIndex,weight);}}},_updateWeight:function _updateWeight(time){var weight=0;if(this.enabled){weight=this.weight;var interpolant=this._weightInterpolant;if(interpolant!==null){var interpolantValue=interpolant.evaluate(time)[0];weight*=interpolantValue;if(time>interpolant.parameterPositions[1]){this.stopFading();if(interpolantValue===0){// faded out, disable
  this.enabled=false;}}}}this._effectiveWeight=weight;return weight;},_updateTimeScale:function _updateTimeScale(time){var timeScale=0;if(!this.paused){timeScale=this.timeScale;var interpolant=this._timeScaleInterpolant;if(interpolant!==null){var interpolantValue=interpolant.evaluate(time)[0];timeScale*=interpolantValue;if(time>interpolant.parameterPositions[1]){this.stopWarping();if(timeScale===0){// motion has halted, pause
  this.paused=true;}else{// warp done - apply final time scale
  this.timeScale=timeScale;}}}}this._effectiveTimeScale=timeScale;return timeScale;},_updateTime:function _updateTime(deltaTime){var time=this.time+deltaTime;if(deltaTime===0){return time;}var duration=this._clip.duration,loop=this.loop,loopCount=this._loopCount;if(loop===LoopOnce){if(loopCount===-1){// just started
  this._loopCount=0;this._setEndings(true,true,false);}handle_stop:{if(time>=duration){time=duration;}else if(time<0){time=0;}else{break handle_stop;}if(this.clampWhenFinished){this.paused=true;}else{this.enabled=false;}this._mixer.dispatchEvent({type:'finished',action:this,direction:deltaTime<0?-1:1});}}else{// repetitive Repeat or PingPong
  var pingPong=loop===LoopPingPong;if(loopCount===-1){// just started
  if(deltaTime>=0){loopCount=0;this._setEndings(true,this.repetitions===0,pingPong);}else{// when looping in reverse direction, the initial
  // transition through zero counts as a repetition,
  // so leave loopCount at -1
  this._setEndings(this.repetitions===0,true,pingPong);}}if(time>=duration||time<0){// wrap around
  var loopDelta=Math.floor(time/duration);// signed
  time-=duration*loopDelta;loopCount+=Math.abs(loopDelta);var pending=this.repetitions-loopCount;if(pending<0){// have to stop (switch state, clamp time, fire event)
  if(this.clampWhenFinished){this.paused=true;}else{this.enabled=false;}time=deltaTime>0?duration:0;this._mixer.dispatchEvent({type:'finished',action:this,direction:deltaTime>0?1:-1});}else{// keep running
  if(pending===0){// entering the last round
  var atStart=deltaTime<0;this._setEndings(atStart,!atStart,pingPong);}else{this._setEndings(false,false,pingPong);}this._loopCount=loopCount;this._mixer.dispatchEvent({type:'loop',action:this,loopDelta:loopDelta});}}if(pingPong&&(loopCount&1)===1){// invert time for the "pong round"
  this.time=time;return duration-time;}}this.time=time;return time;},_setEndings:function _setEndings(atStart,atEnd,pingPong){var settings=this._interpolantSettings;if(pingPong){settings.endingStart=ZeroSlopeEnding;settings.endingEnd=ZeroSlopeEnding;}else{// assuming for LoopOnce atStart == atEnd == true
  if(atStart){settings.endingStart=this.zeroSlopeAtStart?ZeroSlopeEnding:ZeroCurvatureEnding;}else{settings.endingStart=WrapAroundEnding;}if(atEnd){settings.endingEnd=this.zeroSlopeAtEnd?ZeroSlopeEnding:ZeroCurvatureEnding;}else{settings.endingEnd=WrapAroundEnding;}}},_scheduleFading:function _scheduleFading(duration,weightNow,weightThen){var mixer=this._mixer,now=mixer.time,interpolant=this._weightInterpolant;if(interpolant===null){interpolant=mixer._lendControlInterpolant();this._weightInterpolant=interpolant;}var times=interpolant.parameterPositions,values=interpolant.sampleValues;times[0]=now;values[0]=weightNow;times[1]=now+duration;values[1]=weightThen;return this;}});/**
   *
   * A reference to a real property in the scene graph.
   *
   *
   * @author Ben Houston / http://clara.io/
   * @author David Sarno / http://lighthaus.us/
   * @author tschw
   */function Composite(targetGroup,path,optionalParsedPath){var parsedPath=optionalParsedPath||PropertyBinding$1.parseTrackName(path);this._targetGroup=targetGroup;this._bindings=targetGroup.subscribe_(path,parsedPath);}Object.assign(Composite.prototype,{getValue:function getValue(array,offset){this.bind();// bind all binding
  var firstValidIndex=this._targetGroup.nCachedObjects_,binding=this._bindings[firstValidIndex];// and only call .getValue on the first
  if(binding!==undefined){binding.getValue(array,offset);}},setValue:function setValue(array,offset){var bindings=this._bindings;for(var i=this._targetGroup.nCachedObjects_,n=bindings.length;i!==n;++i){bindings[i].setValue(array,offset);}},bind:function bind(){var bindings=this._bindings;for(var i=this._targetGroup.nCachedObjects_,n=bindings.length;i!==n;++i){bindings[i].bind();}},unbind:function unbind(){var bindings=this._bindings;for(var i=this._targetGroup.nCachedObjects_,n=bindings.length;i!==n;++i){bindings[i].unbind();}}});function PropertyBinding$1(rootNode,path,parsedPath){this.path=path;this.parsedPath=parsedPath||PropertyBinding$1.parseTrackName(path);this.node=PropertyBinding$1.findNode(rootNode,this.parsedPath.nodeName)||rootNode;this.rootNode=rootNode;}Object.assign(PropertyBinding$1,{Composite:Composite,create:function create(root,path,parsedPath){if(!(root&&root.isAnimationObjectGroup)){return new PropertyBinding$1(root,path,parsedPath);}else{return new PropertyBinding$1.Composite(root,path,parsedPath);}},/**
  	 * Replaces spaces with underscores and removes unsupported characters from
  	 * node names, to ensure compatibility with parseTrackName().
  	 *
  	 * @param  {string} name Node name to be sanitized.
  	 * @return {string}
  	 */sanitizeNodeName:function sanitizeNodeName(name){return name.replace(/\s/g,'_').replace(/[^\w-]/g,'');},parseTrackName:function(){// Parent directories, delimited by '/' or ':'. Currently unused, but must
  // be matched to parse the rest of the track name.
  var directoryRe=/((?:[\w-]+[\/:])*)/;// Target node. May contain word characters (a-zA-Z0-9_) and '.' or '-'.
  var nodeRe=/([\w-\.]+)?/;// Object on target node, and accessor. Name may contain only word
  // characters. Accessor may contain any character except closing bracket.
  var objectRe=/(?:\.([\w-]+)(?:\[(.+)\])?)?/;// Property and accessor. May contain only word characters. Accessor may
  // contain any non-bracket characters.
  var propertyRe=/\.([\w-]+)(?:\[(.+)\])?/;var trackRe=new RegExp(''+'^'+directoryRe.source+nodeRe.source+objectRe.source+propertyRe.source+'$');var supportedObjectNames=['material','materials','bones'];return function(trackName){var matches=trackRe.exec(trackName);if(!matches){throw new Error('PropertyBinding: Cannot parse trackName: '+trackName);}var results={// directoryName: matches[ 1 ], // (tschw) currently unused
  nodeName:matches[2],objectName:matches[3],objectIndex:matches[4],propertyName:matches[5],// required
  propertyIndex:matches[6]};var lastDot=results.nodeName&&results.nodeName.lastIndexOf('.');if(lastDot!==undefined&&lastDot!==-1){var objectName=results.nodeName.substring(lastDot+1);// Object names must be checked against a whitelist. Otherwise, there
  // is no way to parse 'foo.bar.baz': 'baz' must be a property, but
  // 'bar' could be the objectName, or part of a nodeName (which can
  // include '.' characters).
  if(supportedObjectNames.indexOf(objectName)!==-1){results.nodeName=results.nodeName.substring(0,lastDot);results.objectName=objectName;}}if(results.propertyName===null||results.propertyName.length===0){throw new Error('PropertyBinding: can not parse propertyName from trackName: '+trackName);}return results;};}(),findNode:function findNode(root,nodeName){if(!nodeName||nodeName===""||nodeName==="root"||nodeName==="."||nodeName===-1||nodeName===root.name||nodeName===root.uuid){return root;}// search into skeleton bones.
  if(root.skeleton){var searchSkeleton=function searchSkeleton(skeleton){for(var i=0;i<skeleton.bones.length;i++){var bone=skeleton.bones[i];if(bone.name===nodeName){return bone;}}return null;};var bone=searchSkeleton(root.skeleton);if(bone){return bone;}}// search into node subtree.
  if(root.children){var searchNodeSubtree=function searchNodeSubtree(children){for(var i=0;i<children.length;i++){var childNode=children[i];if(childNode.name===nodeName||childNode.uuid===nodeName){return childNode;}var result=searchNodeSubtree(childNode.children);if(result){return result;}}return null;};var subTreeNode=searchNodeSubtree(root.children);if(subTreeNode){return subTreeNode;}}return null;}});Object.assign(PropertyBinding$1.prototype,{// prototype, continued
  // these are used to "bind" a nonexistent property
  _getValue_unavailable:function _getValue_unavailable(){},_setValue_unavailable:function _setValue_unavailable(){},BindingType:{Direct:0,EntireArray:1,ArrayElement:2,HasFromToArray:3},Versioning:{None:0,NeedsUpdate:1,MatrixWorldNeedsUpdate:2},GetterByBindingType:[function getValue_direct(buffer,offset){buffer[offset]=this.node[this.propertyName];},function getValue_array(buffer,offset){var source=this.resolvedProperty;for(var i=0,n=source.length;i!==n;++i){buffer[offset++]=source[i];}},function getValue_arrayElement(buffer,offset){buffer[offset]=this.resolvedProperty[this.propertyIndex];},function getValue_toArray(buffer,offset){this.resolvedProperty.toArray(buffer,offset);}],SetterByBindingTypeAndVersioning:[[// Direct
  function setValue_direct(buffer,offset){this.targetObject[this.propertyName]=buffer[offset];},function setValue_direct_setNeedsUpdate(buffer,offset){this.targetObject[this.propertyName]=buffer[offset];this.targetObject.needsUpdate=true;},function setValue_direct_setMatrixWorldNeedsUpdate(buffer,offset){this.targetObject[this.propertyName]=buffer[offset];this.targetObject.matrixWorldNeedsUpdate=true;}],[// EntireArray
  function setValue_array(buffer,offset){var dest=this.resolvedProperty;for(var i=0,n=dest.length;i!==n;++i){dest[i]=buffer[offset++];}},function setValue_array_setNeedsUpdate(buffer,offset){var dest=this.resolvedProperty;for(var i=0,n=dest.length;i!==n;++i){dest[i]=buffer[offset++];}this.targetObject.needsUpdate=true;},function setValue_array_setMatrixWorldNeedsUpdate(buffer,offset){var dest=this.resolvedProperty;for(var i=0,n=dest.length;i!==n;++i){dest[i]=buffer[offset++];}this.targetObject.matrixWorldNeedsUpdate=true;}],[// ArrayElement
  function setValue_arrayElement(buffer,offset){this.resolvedProperty[this.propertyIndex]=buffer[offset];},function setValue_arrayElement_setNeedsUpdate(buffer,offset){this.resolvedProperty[this.propertyIndex]=buffer[offset];this.targetObject.needsUpdate=true;},function setValue_arrayElement_setMatrixWorldNeedsUpdate(buffer,offset){this.resolvedProperty[this.propertyIndex]=buffer[offset];this.targetObject.matrixWorldNeedsUpdate=true;}],[// HasToFromArray
  function setValue_fromArray(buffer,offset){this.resolvedProperty.fromArray(buffer,offset);},function setValue_fromArray_setNeedsUpdate(buffer,offset){this.resolvedProperty.fromArray(buffer,offset);this.targetObject.needsUpdate=true;},function setValue_fromArray_setMatrixWorldNeedsUpdate(buffer,offset){this.resolvedProperty.fromArray(buffer,offset);this.targetObject.matrixWorldNeedsUpdate=true;}]],getValue:function getValue_unbound(targetArray,offset){this.bind();this.getValue(targetArray,offset);// Note: This class uses a State pattern on a per-method basis:
  // 'bind' sets 'this.getValue' / 'setValue' and shadows the
  // prototype version of these methods with one that represents
  // the bound state. When the property is not found, the methods
  // become no-ops.
  },setValue:function getValue_unbound(sourceArray,offset){this.bind();this.setValue(sourceArray,offset);},// create getter / setter pair for a property in the scene graph
  bind:function bind(){var targetObject=this.node,parsedPath=this.parsedPath,objectName=parsedPath.objectName,propertyName=parsedPath.propertyName,propertyIndex=parsedPath.propertyIndex;if(!targetObject){targetObject=PropertyBinding$1.findNode(this.rootNode,parsedPath.nodeName)||this.rootNode;this.node=targetObject;}// set fail state so we can just 'return' on error
  this.getValue=this._getValue_unavailable;this.setValue=this._setValue_unavailable;// ensure there is a value node
  if(!targetObject){console.error('THREE.PropertyBinding: Trying to update node for track: '+this.path+' but it wasn\'t found.');return;}if(objectName){var objectIndex=parsedPath.objectIndex;// special cases were we need to reach deeper into the hierarchy to get the face materials....
  switch(objectName){case'materials':if(!targetObject.material){console.error('THREE.PropertyBinding: Can not bind to material as node does not have a material.',this);return;}if(!targetObject.material.materials){console.error('THREE.PropertyBinding: Can not bind to material.materials as node.material does not have a materials array.',this);return;}targetObject=targetObject.material.materials;break;case'bones':if(!targetObject.skeleton){console.error('THREE.PropertyBinding: Can not bind to bones as node does not have a skeleton.',this);return;}// potential future optimization: skip this if propertyIndex is already an integer
  // and convert the integer string to a true integer.
  targetObject=targetObject.skeleton.bones;// support resolving morphTarget names into indices.
  for(var i=0;i<targetObject.length;i++){if(targetObject[i].name===objectIndex){objectIndex=i;break;}}break;default:if(targetObject[objectName]===undefined){console.error('THREE.PropertyBinding: Can not bind to objectName of node undefined.',this);return;}targetObject=targetObject[objectName];}if(objectIndex!==undefined){if(targetObject[objectIndex]===undefined){console.error('THREE.PropertyBinding: Trying to bind to objectIndex of objectName, but is undefined.',this,targetObject);return;}targetObject=targetObject[objectIndex];}}// resolve property
  var nodeProperty=targetObject[propertyName];if(nodeProperty===undefined){var nodeName=parsedPath.nodeName;console.error('THREE.PropertyBinding: Trying to update property for track: '+nodeName+'.'+propertyName+' but it wasn\'t found.',targetObject);return;}// determine versioning scheme
  var versioning=this.Versioning.None;if(targetObject.needsUpdate!==undefined){// material
  versioning=this.Versioning.NeedsUpdate;this.targetObject=targetObject;}else if(targetObject.matrixWorldNeedsUpdate!==undefined){// node transform
  versioning=this.Versioning.MatrixWorldNeedsUpdate;this.targetObject=targetObject;}// determine how the property gets bound
  var bindingType=this.BindingType.Direct;if(propertyIndex!==undefined){// access a sub element of the property array (only primitives are supported right now)
  if(propertyName==="morphTargetInfluences"){// potential optimization, skip this if propertyIndex is already an integer, and convert the integer string to a true integer.
  // support resolving morphTarget names into indices.
  if(!targetObject.geometry){console.error('THREE.PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.',this);return;}if(targetObject.geometry.isBufferGeometry){if(!targetObject.geometry.morphAttributes){console.error('THREE.PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.morphAttributes.',this);return;}for(var i=0;i<this.node.geometry.morphAttributes.position.length;i++){if(targetObject.geometry.morphAttributes.position[i].name===propertyIndex){propertyIndex=i;break;}}}else{if(!targetObject.geometry.morphTargets){console.error('THREE.PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.morphTargets.',this);return;}for(var i=0;i<this.node.geometry.morphTargets.length;i++){if(targetObject.geometry.morphTargets[i].name===propertyIndex){propertyIndex=i;break;}}}}bindingType=this.BindingType.ArrayElement;this.resolvedProperty=nodeProperty;this.propertyIndex=propertyIndex;}else if(nodeProperty.fromArray!==undefined&&nodeProperty.toArray!==undefined){// must use copy for Object3D.Euler/Quaternion
  bindingType=this.BindingType.HasFromToArray;this.resolvedProperty=nodeProperty;}else if(Array.isArray(nodeProperty)){bindingType=this.BindingType.EntireArray;this.resolvedProperty=nodeProperty;}else{this.propertyName=propertyName;}// select getter / setter
  this.getValue=this.GetterByBindingType[bindingType];this.setValue=this.SetterByBindingTypeAndVersioning[bindingType][versioning];},unbind:function unbind(){this.node=null;// back to the prototype version of getValue / setValue
  // note: avoiding to mutate the shape of 'this' via 'delete'
  this.getValue=this._getValue_unbound;this.setValue=this._setValue_unbound;}});//!\ DECLARE ALIAS AFTER assign prototype !
  Object.assign(PropertyBinding$1.prototype,{// initial state of these methods that calls 'bind'
  _getValue_unbound:PropertyBinding$1.prototype.getValue,_setValue_unbound:PropertyBinding$1.prototype.setValue});/**
   *
   * Buffered scene graph property that allows weighted accumulation.
   *
   *
   * @author Ben Houston / http://clara.io/
   * @author David Sarno / http://lighthaus.us/
   * @author tschw
   */function PropertyMixer(binding,typeName,valueSize){this.binding=binding;this.valueSize=valueSize;var bufferType=Float64Array,mixFunction;switch(typeName){case'quaternion':mixFunction=this._slerp;break;case'string':case'bool':bufferType=Array;mixFunction=this._select;break;default:mixFunction=this._lerp;}this.buffer=new bufferType(valueSize*4);// layout: [ incoming | accu0 | accu1 | orig ]
  //
  // interpolators can use .buffer as their .result
  // the data then goes to 'incoming'
  //
  // 'accu0' and 'accu1' are used frame-interleaved for
  // the cumulative result and are compared to detect
  // changes
  //
  // 'orig' stores the original state of the property
  this._mixBufferRegion=mixFunction;this.cumulativeWeight=0;this.useCount=0;this.referenceCount=0;}Object.assign(PropertyMixer.prototype,{// accumulate data in the 'incoming' region into 'accu<i>'
  accumulate:function accumulate(accuIndex,weight){// note: happily accumulating nothing when weight = 0, the caller knows
  // the weight and shouldn't have made the call in the first place
  var buffer=this.buffer,stride=this.valueSize,offset=accuIndex*stride+stride,currentWeight=this.cumulativeWeight;if(currentWeight===0){// accuN := incoming * weight
  for(var i=0;i!==stride;++i){buffer[offset+i]=buffer[i];}currentWeight=weight;}else{// accuN := accuN + incoming * weight
  currentWeight+=weight;var mix=weight/currentWeight;this._mixBufferRegion(buffer,offset,0,mix,stride);}this.cumulativeWeight=currentWeight;},// apply the state of 'accu<i>' to the binding when accus differ
  apply:function apply(accuIndex){var stride=this.valueSize,buffer=this.buffer,offset=accuIndex*stride+stride,weight=this.cumulativeWeight,binding=this.binding;this.cumulativeWeight=0;if(weight<1){// accuN := accuN + original * ( 1 - cumulativeWeight )
  var originalValueOffset=stride*3;this._mixBufferRegion(buffer,offset,originalValueOffset,1-weight,stride);}for(var i=stride,e=stride+stride;i!==e;++i){if(buffer[i]!==buffer[i+stride]){// value has changed -> update scene graph
  binding.setValue(buffer,offset);break;}}},// remember the state of the bound property and copy it to both accus
  saveOriginalState:function saveOriginalState(){var binding=this.binding;var buffer=this.buffer,stride=this.valueSize,originalValueOffset=stride*3;binding.getValue(buffer,originalValueOffset);// accu[0..1] := orig -- initially detect changes against the original
  for(var i=stride,e=originalValueOffset;i!==e;++i){buffer[i]=buffer[originalValueOffset+i%stride];}this.cumulativeWeight=0;},// apply the state previously taken via 'saveOriginalState' to the binding
  restoreOriginalState:function restoreOriginalState(){var originalValueOffset=this.valueSize*3;this.binding.setValue(this.buffer,originalValueOffset);},// mix functions
  _select:function _select(buffer,dstOffset,srcOffset,t,stride){if(t>=0.5){for(var i=0;i!==stride;++i){buffer[dstOffset+i]=buffer[srcOffset+i];}}},_slerp:function _slerp(buffer,dstOffset,srcOffset,t){Quaternion.slerpFlat(buffer,dstOffset,buffer,dstOffset,buffer,srcOffset,t);},_lerp:function _lerp(buffer,dstOffset,srcOffset,t,stride){var s=1-t;for(var i=0;i!==stride;++i){var j=dstOffset+i;buffer[j]=buffer[j]*s+buffer[srcOffset+i]*t;}}});/**
   *
   * Player for AnimationClips.
   *
   *
   * @author Ben Houston / http://clara.io/
   * @author David Sarno / http://lighthaus.us/
   * @author tschw
   */function AnimationMixer(root){this._root=root;this._initMemoryManager();this._accuIndex=0;this.time=0;this.timeScale=1.0;}AnimationMixer.prototype=Object.assign(Object.create(EventDispatcher.prototype),{constructor:AnimationMixer,_bindAction:function _bindAction(action,prototypeAction){var this$1=this;var root=action._localRoot||this._root,tracks=action._clip.tracks,nTracks=tracks.length,bindings=action._propertyBindings,interpolants=action._interpolants,rootUuid=root.uuid,bindingsByRoot=this._bindingsByRootAndName,bindingsByName=bindingsByRoot[rootUuid];if(bindingsByName===undefined){bindingsByName={};bindingsByRoot[rootUuid]=bindingsByName;}for(var i=0;i!==nTracks;++i){var track=tracks[i],trackName=track.name,binding=bindingsByName[trackName];if(binding!==undefined){bindings[i]=binding;}else{binding=bindings[i];if(binding!==undefined){// existing binding, make sure the cache knows
  if(binding._cacheIndex===null){++binding.referenceCount;this$1._addInactiveBinding(binding,rootUuid,trackName);}continue;}var path=prototypeAction&&prototypeAction._propertyBindings[i].binding.parsedPath;binding=new PropertyMixer(PropertyBinding$1.create(root,trackName,path),track.ValueTypeName,track.getValueSize());++binding.referenceCount;this$1._addInactiveBinding(binding,rootUuid,trackName);bindings[i]=binding;}interpolants[i].resultBuffer=binding.buffer;}},_activateAction:function _activateAction(action){var this$1=this;if(!this._isActiveAction(action)){if(action._cacheIndex===null){// this action has been forgotten by the cache, but the user
  // appears to be still using it -> rebind
  var rootUuid=(action._localRoot||this._root).uuid,clipUuid=action._clip.uuid,actionsForClip=this._actionsByClip[clipUuid];this._bindAction(action,actionsForClip&&actionsForClip.knownActions[0]);this._addInactiveAction(action,clipUuid,rootUuid);}var bindings=action._propertyBindings;// increment reference counts / sort out state
  for(var i=0,n=bindings.length;i!==n;++i){var binding=bindings[i];if(binding.useCount++===0){this$1._lendBinding(binding);binding.saveOriginalState();}}this._lendAction(action);}},_deactivateAction:function _deactivateAction(action){var this$1=this;if(this._isActiveAction(action)){var bindings=action._propertyBindings;// decrement reference counts / sort out state
  for(var i=0,n=bindings.length;i!==n;++i){var binding=bindings[i];if(--binding.useCount===0){binding.restoreOriginalState();this$1._takeBackBinding(binding);}}this._takeBackAction(action);}},// Memory manager
  _initMemoryManager:function _initMemoryManager(){this._actions=[];// 'nActiveActions' followed by inactive ones
  this._nActiveActions=0;this._actionsByClip={};// inside:
  // {
  // 		knownActions: Array< AnimationAction >	- used as prototypes
  // 		actionByRoot: AnimationAction			- lookup
  // }
  this._bindings=[];// 'nActiveBindings' followed by inactive ones
  this._nActiveBindings=0;this._bindingsByRootAndName={};// inside: Map< name, PropertyMixer >
  this._controlInterpolants=[];// same game as above
  this._nActiveControlInterpolants=0;var scope=this;this.stats={actions:{get total(){return scope._actions.length;},get inUse(){return scope._nActiveActions;}},bindings:{get total(){return scope._bindings.length;},get inUse(){return scope._nActiveBindings;}},controlInterpolants:{get total(){return scope._controlInterpolants.length;},get inUse(){return scope._nActiveControlInterpolants;}}};},// Memory management for AnimationAction objects
  _isActiveAction:function _isActiveAction(action){var index=action._cacheIndex;return index!==null&&index<this._nActiveActions;},_addInactiveAction:function _addInactiveAction(action,clipUuid,rootUuid){var actions=this._actions,actionsByClip=this._actionsByClip,actionsForClip=actionsByClip[clipUuid];if(actionsForClip===undefined){actionsForClip={knownActions:[action],actionByRoot:{}};action._byClipCacheIndex=0;actionsByClip[clipUuid]=actionsForClip;}else{var knownActions=actionsForClip.knownActions;action._byClipCacheIndex=knownActions.length;knownActions.push(action);}action._cacheIndex=actions.length;actions.push(action);actionsForClip.actionByRoot[rootUuid]=action;},_removeInactiveAction:function _removeInactiveAction(action){var actions=this._actions,lastInactiveAction=actions[actions.length-1],cacheIndex=action._cacheIndex;lastInactiveAction._cacheIndex=cacheIndex;actions[cacheIndex]=lastInactiveAction;actions.pop();action._cacheIndex=null;var clipUuid=action._clip.uuid,actionsByClip=this._actionsByClip,actionsForClip=actionsByClip[clipUuid],knownActionsForClip=actionsForClip.knownActions,lastKnownAction=knownActionsForClip[knownActionsForClip.length-1],byClipCacheIndex=action._byClipCacheIndex;lastKnownAction._byClipCacheIndex=byClipCacheIndex;knownActionsForClip[byClipCacheIndex]=lastKnownAction;knownActionsForClip.pop();action._byClipCacheIndex=null;var actionByRoot=actionsForClip.actionByRoot,rootUuid=(action._localRoot||this._root).uuid;delete actionByRoot[rootUuid];if(knownActionsForClip.length===0){delete actionsByClip[clipUuid];}this._removeInactiveBindingsForAction(action);},_removeInactiveBindingsForAction:function _removeInactiveBindingsForAction(action){var this$1=this;var bindings=action._propertyBindings;for(var i=0,n=bindings.length;i!==n;++i){var binding=bindings[i];if(--binding.referenceCount===0){this$1._removeInactiveBinding(binding);}}},_lendAction:function _lendAction(action){// [ active actions |  inactive actions  ]
  // [  active actions >| inactive actions ]
  //                 s        a
  //                  <-swap->
  //                 a        s
  var actions=this._actions,prevIndex=action._cacheIndex,lastActiveIndex=this._nActiveActions++,firstInactiveAction=actions[lastActiveIndex];action._cacheIndex=lastActiveIndex;actions[lastActiveIndex]=action;firstInactiveAction._cacheIndex=prevIndex;actions[prevIndex]=firstInactiveAction;},_takeBackAction:function _takeBackAction(action){// [  active actions  | inactive actions ]
  // [ active actions |< inactive actions  ]
  //        a        s
  //         <-swap->
  //        s        a
  var actions=this._actions,prevIndex=action._cacheIndex,firstInactiveIndex=--this._nActiveActions,lastActiveAction=actions[firstInactiveIndex];action._cacheIndex=firstInactiveIndex;actions[firstInactiveIndex]=action;lastActiveAction._cacheIndex=prevIndex;actions[prevIndex]=lastActiveAction;},// Memory management for PropertyMixer objects
  _addInactiveBinding:function _addInactiveBinding(binding,rootUuid,trackName){var bindingsByRoot=this._bindingsByRootAndName,bindingByName=bindingsByRoot[rootUuid],bindings=this._bindings;if(bindingByName===undefined){bindingByName={};bindingsByRoot[rootUuid]=bindingByName;}bindingByName[trackName]=binding;binding._cacheIndex=bindings.length;bindings.push(binding);},_removeInactiveBinding:function _removeInactiveBinding(binding){var bindings=this._bindings,propBinding=binding.binding,rootUuid=propBinding.rootNode.uuid,trackName=propBinding.path,bindingsByRoot=this._bindingsByRootAndName,bindingByName=bindingsByRoot[rootUuid],lastInactiveBinding=bindings[bindings.length-1],cacheIndex=binding._cacheIndex;lastInactiveBinding._cacheIndex=cacheIndex;bindings[cacheIndex]=lastInactiveBinding;bindings.pop();delete bindingByName[trackName];remove_empty_map:{for(var _ in bindingByName){break remove_empty_map;}// eslint-disable-line no-unused-vars
  delete bindingsByRoot[rootUuid];}},_lendBinding:function _lendBinding(binding){var bindings=this._bindings,prevIndex=binding._cacheIndex,lastActiveIndex=this._nActiveBindings++,firstInactiveBinding=bindings[lastActiveIndex];binding._cacheIndex=lastActiveIndex;bindings[lastActiveIndex]=binding;firstInactiveBinding._cacheIndex=prevIndex;bindings[prevIndex]=firstInactiveBinding;},_takeBackBinding:function _takeBackBinding(binding){var bindings=this._bindings,prevIndex=binding._cacheIndex,firstInactiveIndex=--this._nActiveBindings,lastActiveBinding=bindings[firstInactiveIndex];binding._cacheIndex=firstInactiveIndex;bindings[firstInactiveIndex]=binding;lastActiveBinding._cacheIndex=prevIndex;bindings[prevIndex]=lastActiveBinding;},// Memory management of Interpolants for weight and time scale
  _lendControlInterpolant:function _lendControlInterpolant(){var interpolants=this._controlInterpolants,lastActiveIndex=this._nActiveControlInterpolants++,interpolant=interpolants[lastActiveIndex];if(interpolant===undefined){interpolant=new LinearInterpolant(new Float32Array(2),new Float32Array(2),1,this._controlInterpolantsResultBuffer);interpolant.__cacheIndex=lastActiveIndex;interpolants[lastActiveIndex]=interpolant;}return interpolant;},_takeBackControlInterpolant:function _takeBackControlInterpolant(interpolant){var interpolants=this._controlInterpolants,prevIndex=interpolant.__cacheIndex,firstInactiveIndex=--this._nActiveControlInterpolants,lastActiveInterpolant=interpolants[firstInactiveIndex];interpolant.__cacheIndex=firstInactiveIndex;interpolants[firstInactiveIndex]=interpolant;lastActiveInterpolant.__cacheIndex=prevIndex;interpolants[prevIndex]=lastActiveInterpolant;},_controlInterpolantsResultBuffer:new Float32Array(1),// return an action for a clip optionally using a custom root target
  // object (this method allocates a lot of dynamic memory in case a
  // previously unknown clip/root combination is specified)
  clipAction:function clipAction(clip,optionalRoot){var root=optionalRoot||this._root,rootUuid=root.uuid,clipObject=typeof clip==='string'?AnimationClip$1.findByName(root,clip):clip,clipUuid=clipObject!==null?clipObject.uuid:clip,actionsForClip=this._actionsByClip[clipUuid],prototypeAction=null;if(actionsForClip!==undefined){var existingAction=actionsForClip.actionByRoot[rootUuid];if(existingAction!==undefined){return existingAction;}// we know the clip, so we don't have to parse all
  // the bindings again but can just copy
  prototypeAction=actionsForClip.knownActions[0];// also, take the clip from the prototype action
  if(clipObject===null){clipObject=prototypeAction._clip;}}// clip must be known when specified via string
  if(clipObject===null){return null;}// allocate all resources required to run it
  var newAction=new AnimationAction(this,clipObject,optionalRoot);this._bindAction(newAction,prototypeAction);// and make the action known to the memory manager
  this._addInactiveAction(newAction,clipUuid,rootUuid);return newAction;},// get an existing action
  existingAction:function existingAction(clip,optionalRoot){var root=optionalRoot||this._root,rootUuid=root.uuid,clipObject=typeof clip==='string'?AnimationClip$1.findByName(root,clip):clip,clipUuid=clipObject?clipObject.uuid:clip,actionsForClip=this._actionsByClip[clipUuid];if(actionsForClip!==undefined){return actionsForClip.actionByRoot[rootUuid]||null;}return null;},// deactivates all previously scheduled actions
  stopAllAction:function stopAllAction(){var actions=this._actions,nActions=this._nActiveActions,bindings=this._bindings,nBindings=this._nActiveBindings;this._nActiveActions=0;this._nActiveBindings=0;for(var i=0;i!==nActions;++i){actions[i].reset();}for(var i=0;i!==nBindings;++i){bindings[i].useCount=0;}return this;},// advance the time and update apply the animation
  update:function update(deltaTime){deltaTime*=this.timeScale;var actions=this._actions,nActions=this._nActiveActions,time=this.time+=deltaTime,timeDirection=Math.sign(deltaTime),accuIndex=this._accuIndex^=1;// run active actions
  for(var i=0;i!==nActions;++i){var action=actions[i];action._update(time,deltaTime,timeDirection,accuIndex);}// update scene graph
  var bindings=this._bindings,nBindings=this._nActiveBindings;for(var i=0;i!==nBindings;++i){bindings[i].apply(accuIndex);}return this;},// return this mixer's root target object
  getRoot:function getRoot(){return this._root;},// free all resources specific to a particular clip
  uncacheClip:function uncacheClip(clip){var this$1=this;var actions=this._actions,clipUuid=clip.uuid,actionsByClip=this._actionsByClip,actionsForClip=actionsByClip[clipUuid];if(actionsForClip!==undefined){// note: just calling _removeInactiveAction would mess up the
  // iteration state and also require updating the state we can
  // just throw away
  var actionsToRemove=actionsForClip.knownActions;for(var i=0,n=actionsToRemove.length;i!==n;++i){var action=actionsToRemove[i];this$1._deactivateAction(action);var cacheIndex=action._cacheIndex,lastInactiveAction=actions[actions.length-1];action._cacheIndex=null;action._byClipCacheIndex=null;lastInactiveAction._cacheIndex=cacheIndex;actions[cacheIndex]=lastInactiveAction;actions.pop();this$1._removeInactiveBindingsForAction(action);}delete actionsByClip[clipUuid];}},// free all resources specific to a particular root target object
  uncacheRoot:function uncacheRoot(root){var this$1=this;var rootUuid=root.uuid,actionsByClip=this._actionsByClip;for(var clipUuid in actionsByClip){var actionByRoot=actionsByClip[clipUuid].actionByRoot,action=actionByRoot[rootUuid];if(action!==undefined){this$1._deactivateAction(action);this$1._removeInactiveAction(action);}}var bindingsByRoot=this._bindingsByRootAndName,bindingByName=bindingsByRoot[rootUuid];if(bindingByName!==undefined){for(var trackName in bindingByName){var binding=bindingByName[trackName];binding.restoreOriginalState();this$1._removeInactiveBinding(binding);}}},// remove a targeted clip from the cache
  uncacheAction:function uncacheAction(clip,optionalRoot){var action=this.existingAction(clip,optionalRoot);if(action!==null){this._deactivateAction(action);this._removeInactiveAction(action);}}});/**
   * @author takahiro / https://github.com/takahirox
   *
   * Dependencies
   *  - mmd-parser https://github.com/takahirox/mmd-parser
   *  - ammo.js https://github.com/kripken/ammo.js
   *  - TGALoader
   *  - MMDPhysics
   *  - CCDIKSolver
   *  - OutlineEffect
   *
   *
   * This loader loads and parses PMD/PMX and VMD binary files
   * then creates mesh for Three.js.
   *
   * PMD/PMX is a model data format and VMD is a motion data format
   * used in MMD(Miku Miku Dance).
   *
   * MMD is a 3D CG animation tool which is popular in Japan.
   *
   *
   * MMD official site
   *  http://www.geocities.jp/higuchuu4/index_e.htm
   *
   * PMD, VMD format
   *  http://blog.goo.ne.jp/torisu_tetosuki/e/209ad341d3ece2b1b4df24abf619d6e4
   *
   * PMX format
   *  http://gulshan-i-raz.geo.jp/labs/2012/10/17/pmx-format1/
   *
   *
   * TODO
   *  - light motion in vmd support.
   *  - SDEF support.
   *  - uv/material/bone morphing support.
   *  - more precise grant skinning support.
   *  - shadow support.
   */var MMDLoader=function MMDLoader(manager){Loader$1.call(this);this.manager=manager!==undefined?manager:DefaultLoadingManager;this.parser=new MMDParser.Parser();this.textureCrossOrigin=null;};MMDLoader.prototype=Object.create(Loader$1.prototype);MMDLoader.prototype.constructor=MMDLoader;/*
   * base64 encoded defalut toon textures toon00.bmp - toon10.bmp
   * Users don't need to prepare default texture files.
   *
   * This idea is from http://www20.atpages.jp/katwat/three.js_r58/examples/mytest37/mmd.three.js
   */MMDLoader.prototype.defaultToonTextures=['data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAAL0lEQVRYR+3QQREAAAzCsOFfNJPBJ1XQS9r2hsUAAQIECBAgQIAAAQIECBAgsBZ4MUx/ofm2I/kAAAAASUVORK5CYII=','data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAAN0lEQVRYR+3WQREAMBACsZ5/bWiiMvgEBTt5cW37hjsBBAgQIECAwFwgyfYPCCBAgAABAgTWAh8aBHZBl14e8wAAAABJRU5ErkJggg==','data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAAOUlEQVRYR+3WMREAMAwDsYY/yoDI7MLwIiP40+RJklfcCCBAgAABAgTqArfb/QMCCBAgQIAAgbbAB3z/e0F3js2cAAAAAElFTkSuQmCC','data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAAN0lEQVRYR+3WQREAMBACsZ5/B5ilMvgEBTt5cW37hjsBBAgQIECAwFwgyfYPCCBAgAABAgTWAh81dWyx0gFwKAAAAABJRU5ErkJggg==','data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAAOklEQVRYR+3WoREAMAwDsWb/UQtCy9wxTOQJ/oQ8SXKKGwEECBAgQIBAXeDt7f4BAQQIECBAgEBb4AOz8Hzx7WLY4wAAAABJRU5ErkJggg==','data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAABPUlEQVRYR+1XwW7CMAy1+f9fZOMysSEOEweEOPRNdm3HbdOyIhAcklPrOs/PLy9RygBALxzcCDQFmgJNgaZAU6Ap0BR4PwX8gsRMVLssMRH5HcpzJEaWL7EVg9F1IHRlyqQohgVr4FGUlUcMJSjcUlDw0zvjeun70cLWmneoyf7NgBTQSniBTQQSuJAZsOnnaczjIMb5hCiuHKxokCrJfVnrctyZL0PkJAJe1HMil4nxeyi3Ypfn1kX51jpPvo/JeCNC4PhVdHdJw2XjBR8brF8PEIhNVn12AgP7uHsTBguBn53MUZCqv7Lp07Pn5k1Ro+uWmUNn7D+M57rtk7aG0Vo73xyF/fbFf0bPJjDXngnGocDTdFhygZjwUQrMNrDcmZlQT50VJ/g/UwNyHpu778+yW+/ksOz/BFo54P4AsUXMfRq7XWsAAAAASUVORK5CYII=','data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAACMElEQVRYR+2Xv4pTQRTGf2dubhLdICiii2KnYKHVolhauKWPoGAnNr6BD6CvIVaihYuI2i1ia0BY0MZGRHQXjZj/mSPnnskfNWiWZUlzJ5k7M2cm833nO5Mziej2DWWJRUoCpQKlAntSQCqgw39/iUWAGmh37jrRnVsKlgpiqmkoGVABA7E57fvY+pJDdgKqF6HzFCSADkDq+F6AHABtQ+UMVE5D7zXod7fFNhTEckTbj5XQgHzNN+5tQvc5NG7C6BNkp6D3EmpXHDR+dQAjFLchW3VS9rlw3JBh+B7ys5Cf9z0GW1C/7P32AyBAOAz1q4jGliIH3YPuBnSfQX4OGreTIgEYQb/pBDtPnEQ4CivXYPAWBk13oHrB54yA9QuSn2H4AcKRpEILDt0BUzj+RLR1V5EqjD66NPRBVpLcQwjHoHYJOhsQv6U4mnzmrIXJCFr4LDwm/xBUoboG9XX4cc9VKdYoSA2yk5NQLJaKDUjTBoveG3Z2TElTxwjNK4M3LEZgUdDdruvcXzKBpStgp2NPiWi3ks9ZXxIoFVi+AvHLdc9TqtjL3/aYjpPlrzOcEnK62Szhimdd7xX232zFDTgtxezOu3WNMRLjiKgjtOhHVMd1loynVHvOgjuIIJMaELEqhJAV/RCSLbWTcfPFakFgFlALTRRvx+ok6Hlp/Q+v3fmx90bMyUzaEAhmM3KvHlXTL5DxnbGf/1M8RNNACLL5MNtPxP/mypJAqcDSFfgFhpYqWUzhTEAAAAAASUVORK5CYII=','data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAAL0lEQVRYR+3QQREAAAzCsOFfNJPBJ1XQS9r2hsUAAQIECBAgQIAAAQIECBAgsBZ4MUx/ofm2I/kAAAAASUVORK5CYII=','data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAAL0lEQVRYR+3QQREAAAzCsOFfNJPBJ1XQS9r2hsUAAQIECBAgQIAAAQIECBAgsBZ4MUx/ofm2I/kAAAAASUVORK5CYII=','data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAAL0lEQVRYR+3QQREAAAzCsOFfNJPBJ1XQS9r2hsUAAQIECBAgQIAAAQIECBAgsBZ4MUx/ofm2I/kAAAAASUVORK5CYII=','data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAAL0lEQVRYR+3QQREAAAzCsOFfNJPBJ1XQS9r2hsUAAQIECBAgQIAAAQIECBAgsBZ4MUx/ofm2I/kAAAAASUVORK5CYII='];/*
   * Set 'anonymous' for the the texture image file in other domain
   * even if server responds with "Access-Control-Allow-Origin: *"
   * because some image operation fails in MMDLoader.
   */MMDLoader.prototype.setTextureCrossOrigin=function(value){this.textureCrossOrigin=value;};MMDLoader.prototype.load=function(modelUrl,vmdUrls,callback,onProgress,onError){var scope=this;this.loadModel(modelUrl,function(mesh){scope.loadVmds(vmdUrls,function(vmd){scope.pourVmdIntoModel(mesh,vmd);callback(mesh);},onProgress,onError);},onProgress,onError);};MMDLoader.prototype.loadModel=function(url,callback,onProgress,onError){var scope=this;var texturePath=LoaderUtils.extractUrlBase(url);var modelExtension=this.extractExtension(url);this.loadFileAsBuffer(url,function(buffer){callback(scope.createModel(buffer,modelExtension,texturePath,onProgress,onError));},onProgress,onError);};MMDLoader.prototype.createModel=function(buffer,modelExtension,texturePath,onProgress,onError){return this.createMesh(this.parseModel(buffer,modelExtension),texturePath,onProgress,onError);};MMDLoader.prototype.loadVmd=function(url,callback,onProgress,onError){var scope=this;this.loadFileAsBuffer(url,function(buffer){callback(scope.parseVmd(buffer));},onProgress,onError);};MMDLoader.prototype.loadVmds=function(urls,callback,onProgress,onError){var scope=this;var vmds=[];urls=urls.slice();function run(){var url=urls.shift();scope.loadVmd(url,function(vmd){vmds.push(vmd);if(urls.length>0){run();}else{callback(scope.mergeVmds(vmds));}},onProgress,onError);}run();};MMDLoader.prototype.loadAudio=function(url,callback,onProgress,onError){var listener=new AudioListener();var audio=new Audio(listener);var loader=new AudioLoader(this.manager);loader.load(url,function(buffer){audio.setBuffer(buffer);callback(audio,listener);},onProgress,onError);};MMDLoader.prototype.loadVpd=function(url,callback,onProgress,onError,params){var scope=this;var func=(params&&params.charcode==='unicode'?this.loadFileAsText:this.loadFileAsShiftJISText).bind(this);func(url,function(text){callback(scope.parseVpd(text));},onProgress,onError);};MMDLoader.prototype.parseModel=function(buffer,modelExtension){// Should I judge from model data header?
  switch(modelExtension.toLowerCase()){case'pmd':return this.parsePmd(buffer);case'pmx':return this.parsePmx(buffer);default:throw'extension '+modelExtension+' is not supported.';}};MMDLoader.prototype.parsePmd=function(buffer){return this.parser.parsePmd(buffer,true);};MMDLoader.prototype.parsePmx=function(buffer){return this.parser.parsePmx(buffer,true);};MMDLoader.prototype.parseVmd=function(buffer){return this.parser.parseVmd(buffer,true);};MMDLoader.prototype.parseVpd=function(text){return this.parser.parseVpd(text,true);};MMDLoader.prototype.mergeVmds=function(vmds){return this.parser.mergeVmds(vmds);};MMDLoader.prototype.pourVmdIntoModel=function(mesh,vmd,name){this.createAnimation(mesh,vmd,name);};MMDLoader.prototype.pourVmdIntoCamera=function(camera,vmd,name){var helper=new MMDLoader.DataCreationHelper();var initAnimation=function initAnimation(){var orderedMotions=helper.createOrderedMotionArray(vmd.cameras);var times=[];var centers=[];var quaternions=[];var positions=[];var fovs=[];var cInterpolations=[];var qInterpolations=[];var pInterpolations=[];var fInterpolations=[];var quaternion=new Quaternion();var euler=new Euler();var position=new Vector3$1();var center=new Vector3$1();var pushVector3=function pushVector3(array,vec){array.push(vec.x);array.push(vec.y);array.push(vec.z);};var pushQuaternion=function pushQuaternion(array,q){array.push(q.x);array.push(q.y);array.push(q.z);array.push(q.w);};var pushInterpolation=function pushInterpolation(array,interpolation,index){array.push(interpolation[index*4+0]/127);// x1
  array.push(interpolation[index*4+1]/127);// x2
  array.push(interpolation[index*4+2]/127);// y1
  array.push(interpolation[index*4+3]/127);// y2
  };var createTrack=function createTrack(node,type,times,values,interpolations){/*
  			 * optimizes here not to let KeyframeTrackPrototype optimize
  			 * because KeyframeTrackPrototype optimizes times and values but
  			 * doesn't optimize interpolations.
  			 */if(times.length>2){times=times.slice();values=values.slice();interpolations=interpolations.slice();var stride=values.length/times.length;var interpolateStride=stride===3?12:4;// 3: Vector3, others: Quaternion or Number
  var index=1;for(var aheadIndex=2,endIndex=times.length;aheadIndex<endIndex;aheadIndex++){for(var i=0;i<stride;i++){if(values[index*stride+i]!==values[(index-1)*stride+i]||values[index*stride+i]!==values[aheadIndex*stride+i]){index++;break;}}if(aheadIndex>index){times[index]=times[aheadIndex];for(var i=0;i<stride;i++){values[index*stride+i]=values[aheadIndex*stride+i];}for(var i=0;i<interpolateStride;i++){interpolations[index*interpolateStride+i]=interpolations[aheadIndex*interpolateStride+i];}}}times.length=index+1;values.length=(index+1)*stride;interpolations.length=(index+1)*interpolateStride;}return new MMDLoader[type](node,times,values,interpolations);};for(var i=0;i<orderedMotions.length;i++){var m=orderedMotions[i];var time=m.frameNum/30;var pos=m.position;var rot=m.rotation;var distance=m.distance;var fov=m.fov;var interpolation=m.interpolation;position.set(0,0,-distance);center.set(pos[0],pos[1],pos[2]);euler.set(-rot[0],-rot[1],-rot[2]);quaternion.setFromEuler(euler);position.add(center);position.applyQuaternion(quaternion);/*
  			 * Note: This is a workaround not to make Animation system calculate lerp
  			 *       if the diff from the last frame is 1 frame (in 30fps).
  			 */if(times.length>0&&time<times[times.length-1]+1/30*1.5){times[times.length-1]=time-1e-13;}times.push(time);pushVector3(centers,center);pushQuaternion(quaternions,quaternion);pushVector3(positions,position);fovs.push(fov);for(var j=0;j<3;j++){pushInterpolation(cInterpolations,interpolation,j);}pushInterpolation(qInterpolations,interpolation,3);// use same one parameter for x, y, z axis.
  for(var j=0;j<3;j++){pushInterpolation(pInterpolations,interpolation,4);}pushInterpolation(fInterpolations,interpolation,5);}if(times.length===0){return;}var tracks=[];tracks.push(createTrack('.center','VectorKeyframeTrackEx',times,centers,cInterpolations));tracks.push(createTrack('.quaternion','QuaternionKeyframeTrackEx',times,quaternions,qInterpolations));tracks.push(createTrack('.position','VectorKeyframeTrackEx',times,positions,pInterpolations));tracks.push(createTrack('.fov','NumberKeyframeTrackEx',times,fovs,fInterpolations));var clip=new AnimationClip$1(name===undefined?Math.generateUUID():name,-1,tracks);if(camera.center===undefined){camera.center=new Vector3$1(0,0,0);}if(camera.animations===undefined){camera.animations=[];}camera.animations.push(clip);};initAnimation();};MMDLoader.prototype.extractExtension=function(url){var index=url.lastIndexOf('.');if(index<0){return null;}return url.slice(index+1);};MMDLoader.prototype.loadFile=function(url,onLoad,onProgress,onError,responseType,mimeType){var loader=new FileLoader(this.manager);if(mimeType!==undefined){loader.setMimeType(mimeType);}loader.setResponseType(responseType);var request=loader.load(url,function(result){onLoad(result);},onProgress,onError);return request;};MMDLoader.prototype.loadFileAsBuffer=function(url,onLoad,onProgress,onError){this.loadFile(url,onLoad,onProgress,onError,'arraybuffer');};MMDLoader.prototype.loadFileAsText=function(url,onLoad,onProgress,onError){this.loadFile(url,onLoad,onProgress,onError,'text');};MMDLoader.prototype.loadFileAsShiftJISText=function(url,onLoad,onProgress,onError){this.loadFile(url,onLoad,onProgress,onError,'text','text/plain; charset=shift_jis');};MMDLoader.prototype.createMesh=function(model,texturePath,onProgress,onError){var scope=this;var geometry=new BufferGeometry();var materials=[];var buffer={};buffer.vertices=[];buffer.uvs=[];buffer.normals=[];buffer.skinIndices=[];buffer.skinWeights=[];buffer.indices=[];var initVartices=function initVartices(){for(var i=0;i<model.metadata.vertexCount;i++){var v=model.vertices[i];for(var j=0,jl=v.position.length;j<jl;j++){buffer.vertices.push(v.position[j]);}for(var j=0,jl=v.normal.length;j<jl;j++){buffer.normals.push(v.normal[j]);}for(var j=0,jl=v.uv.length;j<jl;j++){buffer.uvs.push(v.uv[j]);}for(var j=0;j<4;j++){buffer.skinIndices.push(v.skinIndices.length-1>=j?v.skinIndices[j]:0.0);}for(var j=0;j<4;j++){buffer.skinWeights.push(v.skinWeights.length-1>=j?v.skinWeights[j]:0.0);}}};var initFaces=function initFaces(){for(var i=0;i<model.metadata.faceCount;i++){var f=model.faces[i];for(var j=0,jl=f.indices.length;j<jl;j++){buffer.indices.push(f.indices[j]);}}};var initBones=function initBones(){var bones=[];var rigidBodies=model.rigidBodies;var dictionary={};for(var i=0,il=rigidBodies.length;i<il;i++){var body=rigidBodies[i];var value=dictionary[body.boneIndex];// keeps greater number if already value is set without any special reasons
  value=value===undefined?body.type:Math.max(body.type,value);dictionary[body.boneIndex]=value;}for(var i=0;i<model.metadata.boneCount;i++){var bone={};var b=model.bones[i];bone.parent=b.parentIndex;bone.name=b.name;bone.pos=[b.position[0],b.position[1],b.position[2]];bone.rotq=[0,0,0,1];bone.scl=[1,1,1];if(bone.parent!==-1){bone.pos[0]-=model.bones[bone.parent].position[0];bone.pos[1]-=model.bones[bone.parent].position[1];bone.pos[2]-=model.bones[bone.parent].position[2];}bone.rigidBodyType=dictionary[i]!==undefined?dictionary[i]:-1;bones.push(bone);}geometry.bones=bones;};var initIKs=function initIKs(){var iks=[];// TODO: remove duplicated codes between PMD and PMX
  if(model.metadata.format==='pmd'){for(var i=0;i<model.metadata.ikCount;i++){var ik=model.iks[i];var param={};param.target=ik.target;param.effector=ik.effector;param.iteration=ik.iteration;param.maxAngle=ik.maxAngle*4;param.links=[];for(var j=0;j<ik.links.length;j++){var link={};link.index=ik.links[j].index;if(model.bones[link.index].name.indexOf('ひざ')>=0){link.limitation=new Vector3$1(1.0,0.0,0.0);}param.links.push(link);}iks.push(param);}}else{for(var i=0;i<model.metadata.boneCount;i++){var b=model.bones[i];var ik=b.ik;if(ik===undefined){continue;}var param={};param.target=i;param.effector=ik.effector;param.iteration=ik.iteration;param.maxAngle=ik.maxAngle;param.links=[];for(var j=0;j<ik.links.length;j++){var link={};link.index=ik.links[j].index;link.enabled=true;if(ik.links[j].angleLimitation===1){link.limitation=new Vector3$1(1.0,0.0,0.0);// TODO: use limitation angles
  // link.lowerLimitationAngle;
  // link.upperLimitationAngle;
  }param.links.push(link);}iks.push(param);}}geometry.iks=iks;};var initGrants=function initGrants(){if(model.metadata.format==='pmd'){return;}var grants=[];for(var i=0;i<model.metadata.boneCount;i++){var b=model.bones[i];var grant=b.grant;if(grant===undefined){continue;}var param={};param.index=i;param.parentIndex=grant.parentIndex;param.ratio=grant.ratio;param.isLocal=grant.isLocal;param.affectRotation=grant.affectRotation;param.affectPosition=grant.affectPosition;param.transformationClass=b.transformationClass;grants.push(param);}grants.sort(function(a,b){return a.transformationClass-b.transformationClass;});geometry.grants=grants;};var initMorphs=function initMorphs(){function updateVertex(attribute,index,v,ratio){attribute.array[index*3+0]+=v.position[0]*ratio;attribute.array[index*3+1]+=v.position[1]*ratio;attribute.array[index*3+2]+=v.position[2]*ratio;}function updateVertices(attribute,m,ratio){for(var i=0;i<m.elementCount;i++){var v=m.elements[i];var index;if(model.metadata.format==='pmd'){index=model.morphs[0].elements[v.index].index;}else{index=v.index;}updateVertex(attribute,index,v,ratio);}}var morphTargets=[];var attributes=[];for(var i=0;i<model.metadata.morphCount;i++){var m=model.morphs[i];var params={name:m.name};var attribute=new Float32BufferAttribute(model.metadata.vertexCount*3,3);attribute.name=m.name;for(var j=0;j<model.metadata.vertexCount*3;j++){attribute.array[j]=buffer.vertices[j];}if(model.metadata.format==='pmd'){if(i!==0){updateVertices(attribute,m,1.0);}}else{if(m.type===0){// group
  for(var j=0;j<m.elementCount;j++){var m2=model.morphs[m.elements[j].index];var ratio=m.elements[j].ratio;if(m2.type===1){updateVertices(attribute,m2,ratio);}else{// TODO: implement
  }}}else if(m.type===1){// vertex
  updateVertices(attribute,m,1.0);}else if(m.type===2){// bone
  // TODO: implement
  }else if(m.type===3){// uv
  // TODO: implement
  }else if(m.type===4){// additional uv1
  // TODO: implement
  }else if(m.type===5){// additional uv2
  // TODO: implement
  }else if(m.type===6){// additional uv3
  // TODO: implement
  }else if(m.type===7){// additional uv4
  // TODO: implement
  }else if(m.type===8){// material
  // TODO: implement
  }}morphTargets.push(params);attributes.push(attribute);}geometry.morphTargets=morphTargets;geometry.morphAttributes.position=attributes;};var initMaterials=function initMaterials(){var textures={};var textureLoader=new TextureLoader(scope.manager);var tgaLoader=new TGALoader(scope.manager);var canvas=document.createElement('canvas');var context=canvas.getContext('2d');var offset=0;var materialParams=[];if(scope.textureCrossOrigin!==null){textureLoader.setCrossOrigin(scope.textureCrossOrigin);}function loadTexture(filePath,params){if(params===undefined){params={};}var fullPath;if(params.defaultTexturePath===true){try{fullPath=scope.defaultToonTextures[parseInt(filePath.match('toon([0-9]{2})\.bmp$')[1])];}catch(e){console.warn('MMDLoader: '+filePath+' seems like not right default texture path. Using toon00.bmp instead.');fullPath=scope.defaultToonTextures[0];}}else{fullPath=texturePath+filePath;}if(textures[fullPath]!==undefined){return fullPath;}var loader=Loader$1.Handlers.get(fullPath);if(loader===null){loader=filePath.indexOf('.tga')>=0?tgaLoader:textureLoader;}var texture=loader.load(fullPath,function(t){// MMD toon texture is Axis-Y oriented
  // but Three.js gradient map is Axis-X oriented.
  // So here replaces the toon texture image with the rotated one.
  if(params.isToonTexture===true){var image=t.image;var width=image.width;var height=image.height;canvas.width=width;canvas.height=height;context.clearRect(0,0,width,height);context.translate(width/2.0,height/2.0);context.rotate(0.5*Math.PI);// 90.0 * Math.PI / 180.0
  context.translate(-width/2.0,-height/2.0);context.drawImage(image,0,0);t.image=context.getImageData(0,0,width,height);}t.flipY=false;t.wrapS=RepeatWrapping;t.wrapT=RepeatWrapping;for(var i=0;i<texture.readyCallbacks.length;i++){texture.readyCallbacks[i](texture);}delete texture.readyCallbacks;},onProgress,onError);if(params.sphericalReflectionMapping===true){texture.mapping=SphericalReflectionMapping;}texture.readyCallbacks=[];textures[fullPath]=texture;return fullPath;}function getTexture(name,textures){if(textures[name]===undefined){console.warn('MMDLoader: Undefined texture',name);}return textures[name];}for(var i=0;i<model.metadata.materialCount;i++){var m=model.materials[i];var params={};params.faceOffset=offset;params.faceNum=m.faceCount;offset+=m.faceCount;params.name=m.name;/*
  			 * Color
  			 *
  			 * MMD         MeshToonMaterial
  			 * diffuse  -  color
  			 * specular -  specular
  			 * ambient  -  emissive * a
  			 *               (a = 1.0 without map texture or 0.2 with map texture)
  			 *
  			 * MeshToonMaterial doesn't have ambient. Set it to emissive instead.
  			 * It'll be too bright if material has map texture so using coef 0.2.
  			 */params.color=new Color$1(m.diffuse[0],m.diffuse[1],m.diffuse[2]);params.opacity=m.diffuse[3];params.specular=new Color$1(m.specular[0],m.specular[1],m.specular[2]);params.shininess=m.shininess;if(params.opacity===1.0){params.side=FrontSide;params.transparent=false;}else{params.side=DoubleSide;params.transparent=true;}if(model.metadata.format==='pmd'){if(m.fileName){var fileName=m.fileName;var fileNames=[];var index=fileName.lastIndexOf('*');if(index>=0){fileNames.push(fileName.slice(0,index));fileNames.push(fileName.slice(index+1));}else{fileNames.push(fileName);}for(var j=0;j<fileNames.length;j++){var n=fileNames[j];if(n.indexOf('.sph')>=0||n.indexOf('.spa')>=0){params.envMap=loadTexture(n,{sphericalReflectionMapping:true});if(n.indexOf('.sph')>=0){params.envMapType=MultiplyOperation;}else{params.envMapType=AddOperation;}}else{params.map=loadTexture(n);}}}}else{if(m.textureIndex!==-1){var n=model.textures[m.textureIndex];params.map=loadTexture(n);}// TODO: support m.envFlag === 3
  if(m.envTextureIndex!==-1&&(m.envFlag===1||m.envFlag==2)){var n=model.textures[m.envTextureIndex];params.envMap=loadTexture(n,{sphericalReflectionMapping:true});if(m.envFlag===1){params.envMapType=MultiplyOperation;}else{params.envMapType=AddOperation;}}}var coef=params.map===undefined?1.0:0.2;params.emissive=new Color$1(m.ambient[0]*coef,m.ambient[1]*coef,m.ambient[2]*coef);materialParams.push(params);}for(var i=0;i<materialParams.length;i++){var p=materialParams[i];var p2=model.materials[i];var m=new MeshToonMaterial();geometry.addGroup(p.faceOffset*3,p.faceNum*3,i);if(p.name!==undefined){m.name=p.name;}m.skinning=geometry.bones.length>0?true:false;m.morphTargets=geometry.morphTargets.length>0?true:false;m.lights=true;m.side=model.metadata.format==='pmx'&&(p2.flag&0x1)===1?DoubleSide:p.side;m.transparent=p.transparent;m.fog=true;m.blending=CustomBlending;m.blendSrc=SrcAlphaFactor;m.blendDst=OneMinusSrcAlphaFactor;m.blendSrcAlpha=SrcAlphaFactor;m.blendDstAlpha=DstAlphaFactor;if(p.map!==undefined){// Check if this part of the texture image the material uses requires transparency
  var checkTextureTransparency=function checkTextureTransparency(m){m.map.readyCallbacks.push(function(t){// Is there any efficient ways?
  function createImageData(image){var c=document.createElement('canvas');c.width=image.width;c.height=image.height;var ctx=c.getContext('2d');ctx.drawImage(image,0,0);return ctx.getImageData(0,0,c.width,c.height);}function detectTextureTransparency(image,uvs,indices){var width=image.width;var height=image.height;var data=image.data;var threshold=253;if(data.length/(width*height)!==4){return false;}for(var i=0;i<indices.length;i+=3){var centerUV={x:0.0,y:0.0};for(var j=0;j<3;j++){var index=indices[i*3+j];var uv={x:uvs[index*2+0],y:uvs[index*2+1]};if(getAlphaByUv(image,uv)<threshold){return true;}centerUV.x+=uv.x;centerUV.y+=uv.y;}centerUV.x/=3;centerUV.y/=3;if(getAlphaByUv(image,centerUV)<threshold){return true;}}return false;}/*
  						 * This method expects
  						 *   t.flipY = false
  						 *   t.wrapS = RepeatWrapping
  						 *   t.wrapT = RepeatWrapping
  						 * TODO: more precise
  						 */function getAlphaByUv(image,uv){var width=image.width;var height=image.height;var x=Math.round(uv.x*width)%width;var y=Math.round(uv.y*height)%height;if(x<0){x+=width;}if(y<0){y+=height;}var index=y*width+x;return image.data[index*4+3];}var imageData=t.image.data!==undefined?t.image:createImageData(t.image);var indices=geometry.index.array.slice(m.faceOffset*3,m.faceOffset*3+m.faceNum*3);if(detectTextureTransparency(imageData,geometry.attributes.uv.array,indices)){m.transparent=true;}delete m.faceOffset;delete m.faceNum;});};m.faceOffset=p.faceOffset;m.faceNum=p.faceNum;m.map=getTexture(p.map,textures);checkTextureTransparency(m);}if(p.envMap!==undefined){m.envMap=getTexture(p.envMap,textures);m.combine=p.envMapType;}m.opacity=p.opacity;m.color=p.color;if(p.emissive!==undefined){m.emissive=p.emissive;}m.specular=p.specular;m.shininess=Math.max(p.shininess,1e-4);// to prevent pow( 0.0, 0.0 )
  if(model.metadata.format==='pmd'){var isDefaultToonTexture=function isDefaultToonTexture(n){if(n.length!==10){return false;}return n.match(/toon(10|0[0-9]).bmp/)===null?false:true;};// parameters for OutlineEffect
  m.outlineParameters={thickness:p2.edgeFlag===1?0.003:0.0,color:new Color$1(0.0,0.0,0.0),alpha:1.0};if(m.outlineParameters.thickness===0.0){m.outlineParameters.visible=false;}var toonFileName=p2.toonIndex===-1?'toon00.bmp':model.toonTextures[p2.toonIndex].fileName;var uuid=loadTexture(toonFileName,{isToonTexture:true,defaultTexturePath:isDefaultToonTexture(toonFileName)});m.gradientMap=getTexture(uuid,textures);}else{// parameters for OutlineEffect
  m.outlineParameters={thickness:p2.edgeSize/300,color:new Color$1(p2.edgeColor[0],p2.edgeColor[1],p2.edgeColor[2]),alpha:p2.edgeColor[3]};if((p2.flag&0x10)===0||m.outlineParameters.thickness===0.0){m.outlineParameters.visible=false;}var toonFileName,isDefaultToon;if(p2.toonIndex===-1||p2.toonFlag!==0){var num=p2.toonIndex+1;toonFileName='toon'+(num<10?'0'+num:num)+'.bmp';isDefaultToon=true;}else{toonFileName=model.textures[p2.toonIndex];isDefaultToon=false;}var uuid=loadTexture(toonFileName,{isToonTexture:true,defaultTexturePath:isDefaultToon});m.gradientMap=getTexture(uuid,textures);}materials.push(m);}if(model.metadata.format==='pmx'){var checkAlphaMorph=function checkAlphaMorph(morph,elements){if(morph.type!==8){return;}for(var i=0;i<elements.length;i++){var e=elements[i];if(e.index===-1){continue;}var m=materials[e.index];if(m.opacity!==e.diffuse[3]){m.transparent=true;}}};for(var i=0;i<model.morphs.length;i++){var morph=model.morphs[i];var elements=morph.elements;if(morph.type===0){for(var j=0;j<elements.length;j++){var morph2=model.morphs[elements[j].index];var elements2=morph2.elements;checkAlphaMorph(morph2,elements2);}}else{checkAlphaMorph(morph,elements);}}}};var initPhysics=function initPhysics(){var rigidBodies=[];var constraints=[];for(var i=0;i<model.metadata.rigidBodyCount;i++){var b=model.rigidBodies[i];var keys=Object.keys(b);var p={};for(var j=0;j<keys.length;j++){var key=keys[j];p[key]=b[key];}/*
  			 * RigidBody position parameter in PMX seems global position
  			 * while the one in PMD seems offset from corresponding bone.
  			 * So unify being offset.
  			 */if(model.metadata.format==='pmx'){if(p.boneIndex!==-1){var bone=model.bones[p.boneIndex];p.position[0]-=bone.position[0];p.position[1]-=bone.position[1];p.position[2]-=bone.position[2];}}rigidBodies.push(p);}for(var i=0;i<model.metadata.constraintCount;i++){var c=model.constraints[i];var keys=Object.keys(c);var p={};for(var j=0;j<keys.length;j++){var key=keys[j];p[key]=c[key];}var bodyA=rigidBodies[p.rigidBodyIndex1];var bodyB=rigidBodies[p.rigidBodyIndex2];/*
  			 * Refer to http://www20.atpages.jp/katwat/wp/?p=4135
  			 */if(bodyA.type!==0&&bodyB.type===2){if(bodyA.boneIndex!==-1&&bodyB.boneIndex!==-1&&model.bones[bodyB.boneIndex].parentIndex===bodyA.boneIndex){bodyB.type=1;}}constraints.push(p);}geometry.rigidBodies=rigidBodies;geometry.constraints=constraints;};var initGeometry=function initGeometry(){geometry.setIndex(buffer.indices);geometry.addAttribute('position',new Float32BufferAttribute(buffer.vertices,3));geometry.addAttribute('normal',new Float32BufferAttribute(buffer.normals,3));geometry.addAttribute('uv',new Float32BufferAttribute(buffer.uvs,2));geometry.addAttribute('skinIndex',new Float32BufferAttribute(buffer.skinIndices,4));geometry.addAttribute('skinWeight',new Float32BufferAttribute(buffer.skinWeights,4));geometry.computeBoundingSphere();geometry.mmdFormat=model.metadata.format;};initVartices();initFaces();initBones();initIKs();initGrants();initMorphs();initMaterials();initPhysics();initGeometry();var mesh=new SkinnedMesh(geometry,materials);// console.log( mesh ); // for console debug
  return mesh;};MMDLoader.prototype.createAnimation=function(mesh,vmd,name){var helper=new MMDLoader.DataCreationHelper();var initMotionAnimations=function initMotionAnimations(){if(vmd.metadata.motionCount===0){return;}var bones=mesh.geometry.bones;var orderedMotions=helper.createOrderedMotionArrays(bones,vmd.motions,'boneName');var tracks=[];var pushInterpolation=function pushInterpolation(array,interpolation,index){array.push(interpolation[index+0]/127);// x1
  array.push(interpolation[index+8]/127);// x2
  array.push(interpolation[index+4]/127);// y1
  array.push(interpolation[index+12]/127);// y2
  };for(var i=0;i<orderedMotions.length;i++){var times=[];var positions=[];var rotations=[];var pInterpolations=[];var rInterpolations=[];var bone=bones[i];var array=orderedMotions[i];for(var j=0;j<array.length;j++){var time=array[j].frameNum/30;var pos=array[j].position;var rot=array[j].rotation;var interpolation=array[j].interpolation;times.push(time);for(var k=0;k<3;k++){positions.push(bone.pos[k]+pos[k]);}for(var k=0;k<4;k++){rotations.push(rot[k]);}for(var k=0;k<3;k++){pushInterpolation(pInterpolations,interpolation,k);}pushInterpolation(rInterpolations,interpolation,3);}if(times.length===0){continue;}var boneName='.bones['+bone.name+']';tracks.push(new MMDLoader.VectorKeyframeTrackEx(boneName+'.position',times,positions,pInterpolations));tracks.push(new MMDLoader.QuaternionKeyframeTrackEx(boneName+'.quaternion',times,rotations,rInterpolations));}var clip=new AnimationClip$1(name===undefined?Math.generateUUID():name,-1,tracks);if(mesh.geometry.animations===undefined){mesh.geometry.animations=[];}mesh.geometry.animations.push(clip);};var initMorphAnimations=function initMorphAnimations(){if(vmd.metadata.morphCount===0){return;}var orderedMorphs=helper.createOrderedMotionArrays(mesh.geometry.morphTargets,vmd.morphs,'morphName');var tracks=[];for(var i=0;i<orderedMorphs.length;i++){var times=[];var values=[];var array=orderedMorphs[i];for(var j=0;j<array.length;j++){times.push(array[j].frameNum/30);values.push(array[j].weight);}if(times.length===0){continue;}tracks.push(new NumberKeyframeTrack$1('.morphTargetInfluences['+i+']',times,values));}var clip=new AnimationClip$1(name===undefined?Math.generateUUID():name+'Morph',-1,tracks);if(mesh.geometry.animations===undefined){mesh.geometry.animations=[];}mesh.geometry.animations.push(clip);};initMotionAnimations();initMorphAnimations();};MMDLoader.DataCreationHelper=function(){};MMDLoader.DataCreationHelper.prototype={constructor:MMDLoader.DataCreationHelper,/*
  	 * Note: Sometimes to use Japanese Unicode characters runs into problems in Three.js.
  	 *       In such a case, use this method to convert it to Unicode hex charcode strings,
  	 *       like 'あいう' -> '0x30420x30440x3046'
  	 */toCharcodeStrings:function toCharcodeStrings(s){var str='';for(var i=0;i<s.length;i++){str+='0x'+('0000'+s[i].charCodeAt().toString(16)).substr(-4);}return str;},createDictionary:function createDictionary(array){var dict={};for(var i=0;i<array.length;i++){dict[array[i].name]=i;}return dict;},initializeMotionArrays:function initializeMotionArrays(array){var result=[];for(var i=0;i<array.length;i++){result[i]=[];}return result;},sortMotionArray:function sortMotionArray(array){array.sort(function(a,b){return a.frameNum-b.frameNum;});},sortMotionArrays:function sortMotionArrays(arrays){var this$1=this;for(var i=0;i<arrays.length;i++){this$1.sortMotionArray(arrays[i]);}},createMotionArray:function createMotionArray(array){var result=[];for(var i=0;i<array.length;i++){result.push(array[i]);}return result;},createMotionArrays:function createMotionArrays(array,result,dict,key){for(var i=0;i<array.length;i++){var a=array[i];var num=dict[a[key]];if(num===undefined){continue;}result[num].push(a);}},createOrderedMotionArray:function createOrderedMotionArray(array){var result=this.createMotionArray(array);this.sortMotionArray(result);return result;},createOrderedMotionArrays:function createOrderedMotionArrays(targetArray,motionArray,key){var dict=this.createDictionary(targetArray);var result=this.initializeMotionArrays(targetArray);this.createMotionArrays(motionArray,result,dict,key);this.sortMotionArrays(result);return result;}};/*
   * extends existing KeyframeTrack for bone and camera animation.
   *   - use Float64Array for times
   *   - use Cubic Bezier curves interpolation
   */MMDLoader.VectorKeyframeTrackEx=function(name,times,values,interpolationParameterArray){this.interpolationParameters=new Float32Array(interpolationParameterArray);VectorKeyframeTrack$1.call(this,name,times,values);};MMDLoader.VectorKeyframeTrackEx.prototype=Object.create(VectorKeyframeTrack$1.prototype);MMDLoader.VectorKeyframeTrackEx.prototype.constructor=MMDLoader.VectorKeyframeTrackEx;MMDLoader.VectorKeyframeTrackEx.prototype.TimeBufferType=Float64Array;MMDLoader.VectorKeyframeTrackEx.prototype.InterpolantFactoryMethodCubicBezier=function(result){return new MMDLoader.CubicBezierInterpolation(this.times,this.values,this.getValueSize(),result,this.interpolationParameters);};MMDLoader.VectorKeyframeTrackEx.prototype.setInterpolation=function(interpolation){this.createInterpolant=this.InterpolantFactoryMethodCubicBezier;};MMDLoader.QuaternionKeyframeTrackEx=function(name,times,values,interpolationParameterArray){this.interpolationParameters=new Float32Array(interpolationParameterArray);QuaternionKeyframeTrack$1.call(this,name,times,values);};MMDLoader.QuaternionKeyframeTrackEx.prototype=Object.create(QuaternionKeyframeTrack$1.prototype);MMDLoader.QuaternionKeyframeTrackEx.prototype.constructor=MMDLoader.QuaternionKeyframeTrackEx;MMDLoader.QuaternionKeyframeTrackEx.prototype.TimeBufferType=Float64Array;MMDLoader.QuaternionKeyframeTrackEx.prototype.InterpolantFactoryMethodCubicBezier=function(result){return new MMDLoader.CubicBezierInterpolation(this.times,this.values,this.getValueSize(),result,this.interpolationParameters);};MMDLoader.QuaternionKeyframeTrackEx.prototype.setInterpolation=function(interpolation){this.createInterpolant=this.InterpolantFactoryMethodCubicBezier;};MMDLoader.NumberKeyframeTrackEx=function(name,times,values,interpolationParameterArray){this.interpolationParameters=new Float32Array(interpolationParameterArray);NumberKeyframeTrack$1.call(this,name,times,values);};MMDLoader.NumberKeyframeTrackEx.prototype=Object.create(NumberKeyframeTrack$1.prototype);MMDLoader.NumberKeyframeTrackEx.prototype.constructor=MMDLoader.NumberKeyframeTrackEx;MMDLoader.NumberKeyframeTrackEx.prototype.TimeBufferType=Float64Array;MMDLoader.NumberKeyframeTrackEx.prototype.InterpolantFactoryMethodCubicBezier=function(result){return new MMDLoader.CubicBezierInterpolation(this.times,this.values,this.getValueSize(),result,this.interpolationParameters);};MMDLoader.NumberKeyframeTrackEx.prototype.setInterpolation=function(interpolation){this.createInterpolant=this.InterpolantFactoryMethodCubicBezier;};MMDLoader.CubicBezierInterpolation=function(parameterPositions,sampleValues,sampleSize,resultBuffer,params){Interpolant.call(this,parameterPositions,sampleValues,sampleSize,resultBuffer);this.params=params;};MMDLoader.CubicBezierInterpolation.prototype=Object.create(LinearInterpolant.prototype);MMDLoader.CubicBezierInterpolation.prototype.constructor=MMDLoader.CubicBezierInterpolation;MMDLoader.CubicBezierInterpolation.prototype.interpolate_=function(i1,t0,t,t1){var this$1=this;var result=this.resultBuffer;var values=this.sampleValues;var stride=this.valueSize;var offset1=i1*stride;var offset0=offset1-stride;var weight1=(t-t0)/(t1-t0);if(stride===4){// Quaternion
  var x1=this.params[i1*4+0];var x2=this.params[i1*4+1];var y1=this.params[i1*4+2];var y2=this.params[i1*4+3];var ratio=this._calculate(x1,x2,y1,y2,weight1);Quaternion.slerpFlat(result,0,values,offset0,values,offset1,ratio);}else if(stride===3){// Vector3
  for(var i=0;i!==stride;++i){var x1=this$1.params[i1*12+i*4+0];var x2=this$1.params[i1*12+i*4+1];var y1=this$1.params[i1*12+i*4+2];var y2=this$1.params[i1*12+i*4+3];var ratio=this$1._calculate(x1,x2,y1,y2,weight1);result[i]=values[offset0+i]*(1-ratio)+values[offset1+i]*ratio;}}else{// Number
  var x1=this.params[i1*4+0];var x2=this.params[i1*4+1];var y1=this.params[i1*4+2];var y2=this.params[i1*4+3];var ratio=this._calculate(x1,x2,y1,y2,weight1);result[0]=values[offset0]*(1-ratio)+values[offset1]*ratio;}return result;};MMDLoader.CubicBezierInterpolation.prototype._calculate=function(x1,x2,y1,y2,x){/*
  	 * Cubic Bezier curves
  	 *   https://en.wikipedia.org/wiki/B%C3%A9zier_curve#Cubic_B.C3.A9zier_curves
  	 *
  	 * B(t) = ( 1 - t ) ^ 3 * P0
  	 *      + 3 * ( 1 - t ) ^ 2 * t * P1
  	 *      + 3 * ( 1 - t ) * t^2 * P2
  	 *      + t ^ 3 * P3
  	 *      ( 0 <= t <= 1 )
  	 *
  	 * MMD uses Cubic Bezier curves for bone and camera animation interpolation.
  	 *   http://d.hatena.ne.jp/edvakf/20111016/1318716097
  	 *
  	 *    x = ( 1 - t ) ^ 3 * x0
  	 *      + 3 * ( 1 - t ) ^ 2 * t * x1
  	 *      + 3 * ( 1 - t ) * t^2 * x2
  	 *      + t ^ 3 * x3
  	 *    y = ( 1 - t ) ^ 3 * y0
  	 *      + 3 * ( 1 - t ) ^ 2 * t * y1
  	 *      + 3 * ( 1 - t ) * t^2 * y2
  	 *      + t ^ 3 * y3
  	 *      ( x0 = 0, y0 = 0 )
  	 *      ( x3 = 1, y3 = 1 )
  	 *      ( 0 <= t, x1, x2, y1, y2 <= 1 )
  	 *
  	 * Here solves this equation with Bisection method,
  	 *   https://en.wikipedia.org/wiki/Bisection_method
  	 * gets t, and then calculate y.
  	 *
  	 * f(t) = 3 * ( 1 - t ) ^ 2 * t * x1
  	 *      + 3 * ( 1 - t ) * t^2 * x2
  	 *      + t ^ 3 - x = 0
  	 *
  	 * (Another option: Newton's method
  	 *    https://en.wikipedia.org/wiki/Newton%27s_method)
  	 */var c=0.5;var t=c;var s=1.0-t;var loop=15;var eps=1e-5;var math=Math;var sst3,stt3,ttt;for(var i=0;i<loop;i++){sst3=3.0*s*s*t;stt3=3.0*s*t*t;ttt=t*t*t;var ft=sst3*x1+stt3*x2+ttt-x;if(math.abs(ft)<eps){break;}c/=2.0;t+=ft<0?c:-c;s=1.0-t;}return sst3*y1+stt3*y2+ttt;};var MTLLoader=function MTLLoader(manager){this.manager=manager!==undefined?manager:DefaultLoadingManager;};MTLLoader.prototype={constructor:MTLLoader,/**
  	 * Loads and parses a MTL asset from a URL.
  	 *
  	 * @param {String} url - URL to the MTL file.
  	 * @param {Function} [onLoad] - Callback invoked with the loaded object.
  	 * @param {Function} [onProgress] - Callback for download progress.
  	 * @param {Function} [onError] - Callback for download errors.
  	 *
  	 * @see setPath setTexturePath
  	 *
  	 * @note In order for relative texture references to resolve correctly
  	 * you must call setPath and/or setTexturePath explicitly prior to load.
  	 */load:function load(url,onLoad,onProgress,onError){var scope=this;var loader=new FileLoader(this.manager);loader.setPath(this.path);loader.load(url,function(text){onLoad(scope.parse(text));},onProgress,onError);},/**
  	 * Set base path for resolving references.
  	 * If set this path will be prepended to each loaded and found reference.
  	 *
  	 * @see setTexturePath
  	 * @param {String} path
  	 *
  	 * @example
  	 *     mtlLoader.setPath( 'assets/obj/' );
  	 *     mtlLoader.load( 'my.mtl', ... );
  	 */setPath:function setPath(path){this.path=path;},/**
  	 * Set base path for resolving texture references.
  	 * If set this path will be prepended found texture reference.
  	 * If not set and setPath is, it will be used as texture base path.
  	 *
  	 * @see setPath
  	 * @param {String} path
  	 *
  	 * @example
  	 *     mtlLoader.setPath( 'assets/obj/' );
  	 *     mtlLoader.setTexturePath( 'assets/textures/' );
  	 *     mtlLoader.load( 'my.mtl', ... );
  	 */setTexturePath:function setTexturePath(path){this.texturePath=path;},setBaseUrl:function setBaseUrl(path){console.warn('MTLLoader: .setBaseUrl() is deprecated. Use .setTexturePath( path ) for texture path or .setPath( path ) for general base path instead.');this.setTexturePath(path);},setCrossOrigin:function setCrossOrigin(value){this.crossOrigin=value;},setMaterialOptions:function setMaterialOptions(value){this.materialOptions=value;},/**
  	 * Parses a MTL file.
  	 *
  	 * @param {String} text - Content of MTL file
  	 * @return {MTLLoader.MaterialCreator}
  	 *
  	 * @see setPath setTexturePath
  	 *
  	 * @note In order for relative texture references to resolve correctly
  	 * you must call setPath and/or setTexturePath explicitly prior to parse.
  	 */parse:function parse(text){var lines=text.split('\n');var info={};var delimiter_pattern=/\s+/;var materialsInfo={};for(var i=0;i<lines.length;i++){var line=lines[i];line=line.trim();if(line.length===0||line.charAt(0)==='#'){// Blank line or comment ignore
  continue;}var pos=line.indexOf(' ');var key=pos>=0?line.substring(0,pos):line;key=key.toLowerCase();var value=pos>=0?line.substring(pos+1):'';value=value.trim();if(key==='newmtl'){// New material
  info={name:value};materialsInfo[value]=info;}else if(info){if(key==='ka'||key==='kd'||key==='ks'){var ss=value.split(delimiter_pattern,3);info[key]=[parseFloat(ss[0]),parseFloat(ss[1]),parseFloat(ss[2])];}else{info[key]=value;}}}var materialCreator=new MTLLoader.MaterialCreator(this.texturePath||this.path,this.materialOptions);materialCreator.setCrossOrigin(this.crossOrigin);materialCreator.setManager(this.manager);materialCreator.setMaterials(materialsInfo);return materialCreator;}};/**
   * Create a new THREE-MTLLoader.MaterialCreator
   * @param baseUrl - Url relative to which textures are loaded
   * @param options - Set of options on how to construct the materials
   *                  side: Which side to apply the material
   *                        FrontSide (default), BackSide, DoubleSide
   *                  wrap: What type of wrapping to apply for textures
   *                        RepeatWrapping (default), ClampToEdgeWrapping, MirroredRepeatWrapping
   *                  normalizeRGB: RGBs need to be normalized to 0-1 from 0-255
   *                                Default: false, assumed to be already normalized
   *                  ignoreZeroRGBs: Ignore values of RGBs (Ka,Kd,Ks) that are all 0's
   *                                  Default: false
   * @constructor
   */MTLLoader.MaterialCreator=function(baseUrl,options){this.baseUrl=baseUrl||'';this.options=options;this.materialsInfo={};this.materials={};this.materialsArray=[];this.nameLookup={};this.side=this.options&&this.options.side?this.options.side:FrontSide;this.wrap=this.options&&this.options.wrap?this.options.wrap:RepeatWrapping;};MTLLoader.MaterialCreator.prototype={constructor:MTLLoader.MaterialCreator,crossOrigin:'Anonymous',setCrossOrigin:function setCrossOrigin(value){this.crossOrigin=value;},setManager:function setManager(value){this.manager=value;},setMaterials:function setMaterials(materialsInfo){this.materialsInfo=this.convert(materialsInfo);this.materials={};this.materialsArray=[];this.nameLookup={};},convert:function convert(materialsInfo){var this$1=this;if(!this.options){return materialsInfo;}var converted={};for(var mn in materialsInfo){// Convert materials info into normalized form based on options
  var mat=materialsInfo[mn];var covmat={};converted[mn]=covmat;for(var prop in mat){var save=true;var value=mat[prop];var lprop=prop.toLowerCase();switch(lprop){case'kd':case'ka':case'ks':// Diffuse color (color under white light) using RGB values
  if(this$1.options&&this$1.options.normalizeRGB){value=[value[0]/255,value[1]/255,value[2]/255];}if(this$1.options&&this$1.options.ignoreZeroRGBs){if(value[0]===0&&value[1]===0&&value[2]===0){// ignore
  save=false;}}break;default:break;}if(save){covmat[lprop]=value;}}}return converted;},preload:function preload(){var this$1=this;for(var mn in this$1.materialsInfo){this$1.create(mn);}},getIndex:function getIndex(materialName){return this.nameLookup[materialName];},getAsArray:function getAsArray(){var this$1=this;var index=0;for(var mn in this$1.materialsInfo){this$1.materialsArray[index]=this$1.create(mn);this$1.nameLookup[mn]=index;index++;}return this.materialsArray;},create:function create(materialName){if(this.materials[materialName]===undefined){this.createMaterial_(materialName);}return this.materials[materialName];},createMaterial_:function createMaterial_(materialName){// Create material
  var scope=this;var mat=this.materialsInfo[materialName];var params={name:materialName,side:this.side};function resolveURL(baseUrl,url){if(typeof url!=='string'||url===''){return'';}// Absolute URL
  if(/^https?:\/\//i.test(url)){return url;}return baseUrl+url;}function setMapForType(mapType,value){if(params[mapType]){return;}// Keep the first encountered texture
  var texParams=scope.getTextureParams(value,params);var map=scope.loadTexture(resolveURL(scope.baseUrl,texParams.url));map.repeat.copy(texParams.scale);map.offset.copy(texParams.offset);map.wrapS=scope.wrap;map.wrapT=scope.wrap;params[mapType]=map;}for(var prop in mat){var value=mat[prop];var n;if(value===''){continue;}switch(prop.toLowerCase()){// Ns is material specular exponent
  case'kd':// Diffuse color (color under white light) using RGB values
  params.color=new Color$1().fromArray(value);break;case'ks':// Specular color (color when light is reflected from shiny surface) using RGB values
  params.specular=new Color$1().fromArray(value);break;case'map_kd':// Diffuse texture map
  setMapForType("map",value);break;case'map_ks':// Specular map
  setMapForType("specularMap",value);break;case'norm':setMapForType("normalMap",value);break;case'map_bump':case'bump':// Bump texture map
  setMapForType("bumpMap",value);break;case'ns':// The specular exponent (defines the focus of the specular highlight)
  // A high exponent results in a tight, concentrated highlight. Ns values normally range from 0 to 1000.
  params.shininess=parseFloat(value);break;case'd':n=parseFloat(value);if(n<1){params.opacity=n;params.transparent=true;}break;case'tr':n=parseFloat(value);if(n>0){params.opacity=1-n;params.transparent=true;}break;default:break;}}this.materials[materialName]=new MeshPhongMaterial(params);return this.materials[materialName];},getTextureParams:function getTextureParams(value,matParams){var texParams={scale:new Vector2$1(1,1),offset:new Vector2$1(0,0)};var items=value.split(/\s+/);var pos;pos=items.indexOf('-bm');if(pos>=0){matParams.bumpScale=parseFloat(items[pos+1]);items.splice(pos,2);}pos=items.indexOf('-s');if(pos>=0){texParams.scale.set(parseFloat(items[pos+1]),parseFloat(items[pos+2]));items.splice(pos,4);// we expect 3 parameters here!
  }pos=items.indexOf('-o');if(pos>=0){texParams.offset.set(parseFloat(items[pos+1]),parseFloat(items[pos+2]));items.splice(pos,4);// we expect 3 parameters here!
  }texParams.url=items.join(' ').trim();return texParams;},loadTexture:function loadTexture(url,mapping,onLoad,onProgress,onError){var texture;var loader=Loader.Handlers.get(url);var manager=this.manager!==undefined?this.manager:DefaultLoadingManager;if(loader===null){loader=new TextureLoader(manager);}if(loader.setCrossOrigin){loader.setCrossOrigin(this.crossOrigin);}texture=loader.load(url,onLoad,onProgress,onError);if(mapping!==undefined){texture.mapping=mapping;}return texture;}};/**
   * @author mrdoob / http://mrdoob.com/
   */var OBJLoader=function(){// o object_name | g group_name
  var object_pattern=/^[og]\s*(.+)?/;// mtllib file_reference
  var material_library_pattern=/^mtllib /;// usemtl material_name
  var material_use_pattern=/^usemtl /;function ParserState(){var state={objects:[],object:{},vertices:[],normals:[],colors:[],uvs:[],materialLibraries:[],startObject:function startObject(name,fromDeclaration){// If the current object (initial from reset) is not from a g/o declaration in the parsed
  // file. We need to use it for the first parsed g/o to keep things in sync.
  if(this.object&&this.object.fromDeclaration===false){this.object.name=name;this.object.fromDeclaration=fromDeclaration!==false;return;}var previousMaterial=this.object&&typeof this.object.currentMaterial==='function'?this.object.currentMaterial():undefined;if(this.object&&typeof this.object._finalize==='function'){this.object._finalize(true);}this.object={name:name||'',fromDeclaration:fromDeclaration!==false,geometry:{vertices:[],normals:[],colors:[],uvs:[]},materials:[],smooth:true,startMaterial:function startMaterial(name,libraries){var previous=this._finalize(false);// New usemtl declaration overwrites an inherited material, except if faces were declared
  // after the material, then it must be preserved for proper MultiMaterial continuation.
  if(previous&&(previous.inherited||previous.groupCount<=0)){this.materials.splice(previous.index,1);}var material={index:this.materials.length,name:name||'',mtllib:Array.isArray(libraries)&&libraries.length>0?libraries[libraries.length-1]:'',smooth:previous!==undefined?previous.smooth:this.smooth,groupStart:previous!==undefined?previous.groupEnd:0,groupEnd:-1,groupCount:-1,inherited:false,clone:function clone(index){var cloned={index:typeof index==='number'?index:this.index,name:this.name,mtllib:this.mtllib,smooth:this.smooth,groupStart:0,groupEnd:-1,groupCount:-1,inherited:false};cloned.clone=this.clone.bind(cloned);return cloned;}};this.materials.push(material);return material;},currentMaterial:function currentMaterial(){if(this.materials.length>0){return this.materials[this.materials.length-1];}return undefined;},_finalize:function _finalize(end){var this$1=this;var lastMultiMaterial=this.currentMaterial();if(lastMultiMaterial&&lastMultiMaterial.groupEnd===-1){lastMultiMaterial.groupEnd=this.geometry.vertices.length/3;lastMultiMaterial.groupCount=lastMultiMaterial.groupEnd-lastMultiMaterial.groupStart;lastMultiMaterial.inherited=false;}// Ignore objects tail materials if no face declarations followed them before a new o/g started.
  if(end&&this.materials.length>1){for(var mi=this.materials.length-1;mi>=0;mi--){if(this$1.materials[mi].groupCount<=0){this$1.materials.splice(mi,1);}}}// Guarantee at least one empty material, this makes the creation later more straight forward.
  if(end&&this.materials.length===0){this.materials.push({name:'',smooth:this.smooth});}return lastMultiMaterial;}};// Inherit previous objects material.
  // Spec tells us that a declared material must be set to all objects until a new material is declared.
  // If a usemtl declaration is encountered while this new object is being parsed, it will
  // overwrite the inherited material. Exception being that there was already face declarations
  // to the inherited material, then it will be preserved for proper MultiMaterial continuation.
  if(previousMaterial&&previousMaterial.name&&typeof previousMaterial.clone==='function'){var declared=previousMaterial.clone(0);declared.inherited=true;this.object.materials.push(declared);}this.objects.push(this.object);},finalize:function finalize(){if(this.object&&typeof this.object._finalize==='function'){this.object._finalize(true);}},parseVertexIndex:function parseVertexIndex(value,len){var index=parseInt(value,10);return(index>=0?index-1:index+len/3)*3;},parseNormalIndex:function parseNormalIndex(value,len){var index=parseInt(value,10);return(index>=0?index-1:index+len/3)*3;},parseUVIndex:function parseUVIndex(value,len){var index=parseInt(value,10);return(index>=0?index-1:index+len/2)*2;},addVertex:function addVertex(a,b,c){var src=this.vertices;var dst=this.object.geometry.vertices;dst.push(src[a+0],src[a+1],src[a+2]);dst.push(src[b+0],src[b+1],src[b+2]);dst.push(src[c+0],src[c+1],src[c+2]);},addVertexLine:function addVertexLine(a){var src=this.vertices;var dst=this.object.geometry.vertices;dst.push(src[a+0],src[a+1],src[a+2]);},addNormal:function addNormal(a,b,c){var src=this.normals;var dst=this.object.geometry.normals;dst.push(src[a+0],src[a+1],src[a+2]);dst.push(src[b+0],src[b+1],src[b+2]);dst.push(src[c+0],src[c+1],src[c+2]);},addColor:function addColor(a,b,c){var src=this.colors;var dst=this.object.geometry.colors;dst.push(src[a+0],src[a+1],src[a+2]);dst.push(src[b+0],src[b+1],src[b+2]);dst.push(src[c+0],src[c+1],src[c+2]);},addUV:function addUV(a,b,c){var src=this.uvs;var dst=this.object.geometry.uvs;dst.push(src[a+0],src[a+1]);dst.push(src[b+0],src[b+1]);dst.push(src[c+0],src[c+1]);},addUVLine:function addUVLine(a){var src=this.uvs;var dst=this.object.geometry.uvs;dst.push(src[a+0],src[a+1]);},addFace:function addFace(a,b,c,ua,ub,uc,na,nb,nc){var vLen=this.vertices.length;var ia=this.parseVertexIndex(a,vLen);var ib=this.parseVertexIndex(b,vLen);var ic=this.parseVertexIndex(c,vLen);this.addVertex(ia,ib,ic);if(ua!==undefined){var uvLen=this.uvs.length;ia=this.parseUVIndex(ua,uvLen);ib=this.parseUVIndex(ub,uvLen);ic=this.parseUVIndex(uc,uvLen);this.addUV(ia,ib,ic);}if(na!==undefined){// Normals are many times the same. If so, skip function call and parseInt.
  var nLen=this.normals.length;ia=this.parseNormalIndex(na,nLen);ib=na===nb?ia:this.parseNormalIndex(nb,nLen);ic=na===nc?ia:this.parseNormalIndex(nc,nLen);this.addNormal(ia,ib,ic);}if(this.colors.length>0){this.addColor(ia,ib,ic);}},addLineGeometry:function addLineGeometry(vertices,uvs){var this$1=this;this.object.geometry.type='Line';var vLen=this.vertices.length;var uvLen=this.uvs.length;for(var vi=0,l=vertices.length;vi<l;vi++){this$1.addVertexLine(this$1.parseVertexIndex(vertices[vi],vLen));}for(var uvi=0,l=uvs.length;uvi<l;uvi++){this$1.addUVLine(this$1.parseUVIndex(uvs[uvi],uvLen));}}};state.startObject('',false);return state;}//
  function OBJLoader(manager){this.manager=manager!==undefined?manager:DefaultLoadingManager;this.materials=null;}OBJLoader.prototype={constructor:OBJLoader,load:function load(url,onLoad,onProgress,onError){var scope=this;var loader=new FileLoader(scope.manager);loader.setPath(this.path);loader.load(url,function(text){onLoad(scope.parse(text));},onProgress,onError);},setPath:function setPath(value){this.path=value;},setMaterials:function setMaterials(materials){this.materials=materials;return this;},parse:function parse(text){var this$1=this;console.time('OBJLoader');var state=new ParserState();if(text.indexOf('\r\n')!==-1){// This is faster than String.split with regex that splits on both
  text=text.replace(/\r\n/g,'\n');}if(text.indexOf('\\\n')!==-1){// join lines separated by a line continuation character (\)
  text=text.replace(/\\\n/g,'');}var lines=text.split('\n');var line='',lineFirstChar='';var lineLength=0;var result=[];// Faster to just trim left side of the line. Use if available.
  var trimLeft=typeof''.trimLeft==='function';for(var i=0,l=lines.length;i<l;i++){line=lines[i];line=trimLeft?line.trimLeft():line.trim();lineLength=line.length;if(lineLength===0){continue;}lineFirstChar=line.charAt(0);// @todo invoke passed in handler if any
  if(lineFirstChar==='#'){continue;}if(lineFirstChar==='v'){var data=line.split(/\s+/);switch(data[0]){case'v':state.vertices.push(parseFloat(data[1]),parseFloat(data[2]),parseFloat(data[3]));if(data.length===8){state.colors.push(parseFloat(data[4]),parseFloat(data[5]),parseFloat(data[6]));}break;case'vn':state.normals.push(parseFloat(data[1]),parseFloat(data[2]),parseFloat(data[3]));break;case'vt':state.uvs.push(parseFloat(data[1]),parseFloat(data[2]));break;}}else if(lineFirstChar==='f'){var lineData=line.substr(1).trim();var vertexData=lineData.split(/\s+/);var faceVertices=[];// Parse the face vertex data into an easy to work with format
  for(var j=0,jl=vertexData.length;j<jl;j++){var vertex=vertexData[j];if(vertex.length>0){var vertexParts=vertex.split('/');faceVertices.push(vertexParts);}}// Draw an edge between the first vertex and all subsequent vertices to form an n-gon
  var v1=faceVertices[0];for(var j=1,jl=faceVertices.length-1;j<jl;j++){var v2=faceVertices[j];var v3=faceVertices[j+1];state.addFace(v1[0],v2[0],v3[0],v1[1],v2[1],v3[1],v1[2],v2[2],v3[2]);}}else if(lineFirstChar==='l'){var lineParts=line.substring(1).trim().split(" ");var lineVertices=[],lineUVs=[];if(line.indexOf("/")===-1){lineVertices=lineParts;}else{for(var li=0,llen=lineParts.length;li<llen;li++){var parts=lineParts[li].split("/");if(parts[0]!==""){lineVertices.push(parts[0]);}if(parts[1]!==""){lineUVs.push(parts[1]);}}}state.addLineGeometry(lineVertices,lineUVs);}else if((result=object_pattern.exec(line))!==null){// o object_name
  // or
  // g group_name
  // WORKAROUND: https://bugs.chromium.org/p/v8/issues/detail?id=2869
  // var name = result[ 0 ].substr( 1 ).trim();
  var name=(" "+result[0].substr(1).trim()).substr(1);state.startObject(name);}else if(material_use_pattern.test(line)){// material
  state.object.startMaterial(line.substring(7).trim(),state.materialLibraries);}else if(material_library_pattern.test(line)){// mtl file
  state.materialLibraries.push(line.substring(7).trim());}else if(lineFirstChar==='s'){result=line.split(' ');// smooth shading
  // @todo Handle files that have varying smooth values for a set of faces inside one geometry,
  // but does not define a usemtl for each face set.
  // This should be detected and a dummy material created (later MultiMaterial and geometry groups).
  // This requires some care to not create extra material on each smooth value for "normal" obj files.
  // where explicit usemtl defines geometry groups.
  // Example asset: examples/models/obj/cerberus/Cerberus.obj
  /*
  					 * http://paulbourke.net/dataformats/obj/
  					 * or
  					 * http://www.cs.utah.edu/~boulos/cs3505/obj_spec.pdf
  					 *
  					 * From chapter "Grouping" Syntax explanation "s group_number":
  					 * "group_number is the smoothing group number. To turn off smoothing groups, use a value of 0 or off.
  					 * Polygonal elements use group numbers to put elements in different smoothing groups. For free-form
  					 * surfaces, smoothing groups are either turned on or off; there is no difference between values greater
  					 * than 0."
  					 */if(result.length>1){var value=result[1].trim().toLowerCase();state.object.smooth=value!=='0'&&value!=='off';}else{// ZBrush can produce "s" lines #11707
  state.object.smooth=true;}var material=state.object.currentMaterial();if(material){material.smooth=state.object.smooth;}}else{// Handle null terminated files without exception
  if(line==='\0'){continue;}throw new Error('OBJLoader: Unexpected line: "'+line+'"');}}state.finalize();var container=new Group();container.materialLibraries=[].concat(state.materialLibraries);for(var i=0,l=state.objects.length;i<l;i++){var object=state.objects[i];var geometry=object.geometry;var materials=object.materials;var isLine=geometry.type==='Line';// Skip o/g line declarations that did not follow with any faces
  if(geometry.vertices.length===0){continue;}var buffergeometry=new BufferGeometry();buffergeometry.addAttribute('position',new Float32BufferAttribute(geometry.vertices,3));if(geometry.normals.length>0){buffergeometry.addAttribute('normal',new Float32BufferAttribute(geometry.normals,3));}else{buffergeometry.computeVertexNormals();}if(geometry.colors.length>0){buffergeometry.addAttribute('color',new Float32BufferAttribute(geometry.colors,3));}if(geometry.uvs.length>0){buffergeometry.addAttribute('uv',new Float32BufferAttribute(geometry.uvs,2));}// Create materials
  var createdMaterials=[];for(var mi=0,miLen=materials.length;mi<miLen;mi++){var sourceMaterial=materials[mi];var material=undefined;if(this$1.materials!==null){material=this$1.materials.create(sourceMaterial.name);// mtl etc. loaders probably can't create line materials correctly, copy properties to a line material.
  if(isLine&&material&&!(material instanceof LineBasicMaterial$1)){var materialLine=new LineBasicMaterial$1();materialLine.copy(material);material=materialLine;}}if(!material){material=!isLine?new MeshPhongMaterial():new LineBasicMaterial$1();material.name=sourceMaterial.name;}material.flatShading=sourceMaterial.smooth?false:true;createdMaterials.push(material);}// Create mesh
  var mesh;if(createdMaterials.length>1){for(var mi=0,miLen=materials.length;mi<miLen;mi++){var sourceMaterial=materials[mi];buffergeometry.addGroup(sourceMaterial.groupStart,sourceMaterial.groupCount,mi);}mesh=!isLine?new Mesh(buffergeometry,createdMaterials):new LineSegments(buffergeometry,createdMaterials);}else{mesh=!isLine?new Mesh(buffergeometry,createdMaterials[0]):new LineSegments(buffergeometry,createdMaterials[0]);}mesh.name=object.name;container.add(mesh);}console.timeEnd('OBJLoader');return container;}};return OBJLoader;}();if(LoaderSupport===undefined){console.error('"LoaderSupport" is not available. "OBJLoader2" requires it. Please include "LoaderSupport.js" in your HTML.');}/**
   * Use this class to load OBJ data from files or to parse OBJ data from an arraybuffer
   * @class
   *
   * @param {DefaultLoadingManager} [manager] The loadingManager for the loader to use. Default is {@link DefaultLoadingManager}
   * @param {LoaderSupport.ConsoleLogger} logger logger to be used
   */var OBJLoader2=function(){var OBJLOADER2_VERSION='2.2.1';var LoaderBase=LoaderSupport.LoaderBase;var Validator=LoaderSupport.Validator;var ConsoleLogger=LoaderSupport.ConsoleLogger;OBJLoader2.prototype=Object.create(LoaderSupport.LoaderBase.prototype);OBJLoader2.prototype.constructor=OBJLoader2;function OBJLoader2(manager,logger){LoaderSupport.LoaderBase.call(this,manager,logger);this.logger.logInfo('Using OBJLoader2 version: '+OBJLOADER2_VERSION);this.materialPerSmoothingGroup=false;this.fileLoader=Validator.verifyInput(this.fileLoader,new FileLoader(this.manager));this.workerSupport=null;this.terminateWorkerOnLoad=true;}/**
  	 * Tells whether a material shall be created per smoothing group.
  	 * @memberOf OBJLoader2
  	 *
  	 * @param {boolean} materialPerSmoothingGroup=false
  	 */OBJLoader2.prototype.setMaterialPerSmoothingGroup=function(materialPerSmoothingGroup){this.materialPerSmoothingGroup=materialPerSmoothingGroup===true;};/**
  	 * Use this convenient method to load an OBJ file at the given URL. By default the fileLoader uses an arraybuffer.
  	 * @memberOf OBJLoader2
  	 *
  	 * @param {string}  url A string containing the path/URL of the .obj file.
  	 * @param {callback} onLoad A function to be called after loading is successfully completed. The function receives loaded Object3D as an argument.
  	 * @param {callback} [onProgress] A function to be called while the loading is in progress. The argument will be the XMLHttpRequest instance, which contains total and Integer bytes.
  	 * @param {callback} [onError] A function to be called if an error occurs during loading. The function receives the error as an argument.
  	 * @param {callback} [onMeshAlter] A function to be called after a new mesh raw data becomes available for alteration.
  	 * @param {boolean} [useAsync] If true, uses async loading with worker, if false loads data synchronously.
  	 */OBJLoader2.prototype.load=function(url,onLoad,onProgress,onError,onMeshAlter,useAsync){var scope=this;if(!Validator.isValid(onProgress)){var numericalValueRef=0;var numericalValue=0;onProgress=function onProgress(event){if(!event.lengthComputable){return;}numericalValue=event.loaded/event.total;if(numericalValue>numericalValueRef){numericalValueRef=numericalValue;var output='Download of "'+url+'": '+(numericalValue*100).toFixed(2)+'%';scope.onProgress('progressLoad',output,numericalValue);}};}if(!Validator.isValid(onError)){onError=function onError(event){var output='Error occurred while downloading "'+url+'"';scope.logger.logError(output+': '+event);scope.onProgress('error',output,-1);};}this.fileLoader.setPath(this.path);this.fileLoader.setResponseType('arraybuffer');this.fileLoader.load(url,function(content){if(useAsync){scope.parseAsync(content,onLoad);}else{var callbacks=new LoaderSupport.Callbacks();callbacks.setCallbackOnMeshAlter(onMeshAlter);scope._setCallbacks(callbacks);onLoad({detail:{loaderRootNode:scope.parse(content),modelName:scope.modelName,instanceNo:scope.instanceNo}});}},onProgress,onError);};/**
  	 * Run the loader according the provided instructions.
  	 * @memberOf OBJLoader2
  	 *
  	 * @param {LoaderSupport.PrepData} prepData All parameters and resources required for execution
  	 * @param {LoaderSupport.WorkerSupport} [workerSupportExternal] Use pre-existing WorkerSupport
  	 */OBJLoader2.prototype.run=function(prepData,workerSupportExternal){this._applyPrepData(prepData);var available=this._checkFiles(prepData.resources);if(Validator.isValid(workerSupportExternal)){this.terminateWorkerOnLoad=false;this.workerSupport=workerSupportExternal;this.logger=workerSupportExternal.logger;}var scope=this;var onMaterialsLoaded=function onMaterialsLoaded(materials){scope.builder.setMaterials(materials);if(Validator.isValid(available.obj.content)){if(prepData.useAsync){scope.parseAsync(available.obj.content,scope.callbacks.onLoad);}else{scope.parse(available.obj.content);}}else{scope.setPath(available.obj.path);scope.load(available.obj.name,scope.callbacks.onLoad,null,null,scope.callbacks.onMeshAlter,prepData.useAsync);}};this._loadMtl(available.mtl,onMaterialsLoaded,prepData.crossOrigin);};OBJLoader2.prototype._applyPrepData=function(prepData){LoaderSupport.LoaderBase.prototype._applyPrepData.call(this,prepData);if(Validator.isValid(prepData)){this.setMaterialPerSmoothingGroup(prepData.materialPerSmoothingGroup);}};/**
  	 * Parses OBJ data synchronously from arraybuffer or string.
  	 * @memberOf OBJLoader2
  	 *
  	 * @param {arraybuffer|string} content OBJ data as Uint8Array or String
  	 */OBJLoader2.prototype.parse=function(content){this.logger.logTimeStart('OBJLoader2 parse: '+this.modelName);var parser=new Parser();parser.setLogConfig(this.logger.enabled,this.logger.debug);parser.setMaterialPerSmoothingGroup(this.materialPerSmoothingGroup);parser.setUseIndices(this.useIndices);parser.setDisregardNormals(this.disregardNormals);// sync code works directly on the material references
  parser.setMaterials(this.builder.getMaterials());var scope=this;var onMeshLoaded=function onMeshLoaded(payload){var meshes=scope.builder.processPayload(payload);var mesh;for(var i in meshes){mesh=meshes[i];scope.loaderRootNode.add(mesh);}};parser.setCallbackBuilder(onMeshLoaded);var onProgressScoped=function onProgressScoped(text,numericalValue){scope.onProgress('progressParse',text,numericalValue);};parser.setCallbackProgress(onProgressScoped);if(content instanceof ArrayBuffer||content instanceof Uint8Array){this.logger.logInfo('Parsing arrayBuffer...');parser.parse(content);}else if(typeof content==='string'||content instanceof String){this.logger.logInfo('Parsing text...');parser.parseText(content);}else{throw'Provided content was neither of type String nor Uint8Array! Aborting...';}this.logger.logTimeEnd('OBJLoader2 parse: '+this.modelName);return this.loaderRootNode;};/**
  	 * Parses OBJ content asynchronously from arraybuffer.
  	 * @memberOf OBJLoader2
  	 *
  	 * @param {arraybuffer} content OBJ data as Uint8Array
  	 * @param {callback} onLoad Called after worker successfully completed loading
  	 */OBJLoader2.prototype.parseAsync=function(content,onLoad){this.logger.logTimeStart('OBJLoader2 parseAsync: '+this.modelName);var scope=this;var scopedOnLoad=function scopedOnLoad(){onLoad({detail:{loaderRootNode:scope.loaderRootNode,modelName:scope.modelName,instanceNo:scope.instanceNo}});scope.logger.logTimeEnd('OBJLoader2 parseAsync: '+scope.modelName);};var scopedOnMeshLoaded=function scopedOnMeshLoaded(payload){var meshes=scope.builder.processPayload(payload);var mesh;for(var i in meshes){mesh=meshes[i];scope.loaderRootNode.add(mesh);}};this.workerSupport=Validator.verifyInput(this.workerSupport,new LoaderSupport.WorkerSupport(this.logger));var buildCode=function buildCode(funcBuildObject,funcBuildSingelton){var workerCode='';workerCode+='/**\n';workerCode+='  * This code was constructed by OBJLoader2 buildCode.\n';workerCode+='  */\n\n';workerCode+=funcBuildObject('Validator',Validator);workerCode+=funcBuildSingelton('ConsoleLogger','ConsoleLogger',ConsoleLogger);workerCode+=funcBuildSingelton('LoaderBase','LoaderBase',LoaderBase);workerCode+=funcBuildObject('Consts',Consts);workerCode+=funcBuildSingelton('Parser','Parser',Parser);workerCode+=funcBuildSingelton('RawMesh','RawMesh',RawMesh);workerCode+=funcBuildSingelton('RawMeshSubGroup','RawMeshSubGroup',RawMeshSubGroup);return workerCode;};this.workerSupport.validate(buildCode,false);this.workerSupport.setCallbacks(scopedOnMeshLoaded,scopedOnLoad);if(scope.terminateWorkerOnLoad){this.workerSupport.setTerminateRequested(true);}var materialNames={};var materials=this.builder.getMaterials();for(var materialName in materials){materialNames[materialName]=materialName;}this.workerSupport.run({params:{useAsync:true,materialPerSmoothingGroup:this.materialPerSmoothingGroup,useIndices:this.useIndices,disregardNormals:this.disregardNormals},logger:{debug:this.logger.debug,enabled:this.logger.enabled},materials:{// in async case only material names are supplied to parser
  materials:materialNames},data:{input:content,options:null}});};/**
  	 * Constants used by OBJLoader2
  	 */var Consts={CODE_LF:10,CODE_CR:13,CODE_SPACE:32,CODE_SLASH:47,STRING_LF:'\n',STRING_CR:'\r',STRING_SPACE:' ',STRING_SLASH:'/',LINE_F:'f',LINE_G:'g',LINE_L:'l',LINE_O:'o',LINE_S:'s',LINE_V:'v',LINE_VT:'vt',LINE_VN:'vn',LINE_MTLLIB:'mtllib',LINE_USEMTL:'usemtl'};/**
  	 * Parse OBJ data either from ArrayBuffer or string
  	 * @class
  	 */var Parser=function(){var ConsoleLogger=LoaderSupport.ConsoleLogger;function Parser(){this.callbackProgress=null;this.callbackBuilder=null;this.materials={};this.rawMesh=null;this.useAsync=false;this.materialPerSmoothingGroup=false;this.useIndices=false;this.disregardNormals=false;this.inputObjectCount=1;this.outputObjectCount=1;this.counts={vertices:0,faces:0,doubleIndicesCount:0};this.logger=new ConsoleLogger();this.totalBytes=0;}Parser.prototype.setUseAsync=function(useAsync){this.useAsync=useAsync;};Parser.prototype.setMaterialPerSmoothingGroup=function(materialPerSmoothingGroup){this.materialPerSmoothingGroup=materialPerSmoothingGroup;};Parser.prototype.setUseIndices=function(useIndices){this.useIndices=useIndices;};Parser.prototype.setDisregardNormals=function(disregardNormals){this.disregardNormals=disregardNormals;};Parser.prototype.setMaterials=function(materials){this.materials=Validator.verifyInput(materials,this.materials);this.materials=Validator.verifyInput(this.materials,{});};Parser.prototype.setCallbackBuilder=function(callbackBuilder){this.callbackBuilder=callbackBuilder;if(!Validator.isValid(this.callbackBuilder)){throw'Unable to run as no "builder" callback is set.';}};Parser.prototype.setCallbackProgress=function(callbackProgress){this.callbackProgress=callbackProgress;};Parser.prototype.setLogConfig=function(enabled,debug){this.logger.setEnabled(enabled);this.logger.setDebug(debug);};Parser.prototype.configure=function(){this.rawMesh=new RawMesh(this.materialPerSmoothingGroup,this.useIndices,this.disregardNormals);if(this.logger.isEnabled()){var matKeys=Object.keys(this.materials);var matNames=matKeys.length>0?'\n\tmaterialNames:\n\t\t- '+matKeys.join('\n\t\t- '):'\n\tmaterialNames: None';var printedConfig='OBJLoader2.Parser configuration:'+matNames+'\n\tuseAsync: '+this.useAsync+'\n\tmaterialPerSmoothingGroup: '+this.materialPerSmoothingGroup+'\n\tuseIndices: '+this.useIndices+'\n\tdisregardNormals: '+this.disregardNormals+'\n\tcallbackBuilderName: '+this.callbackBuilder.name+'\n\tcallbackProgressName: '+this.callbackProgress.name;this.logger.logInfo(printedConfig);}};/**
  		 * Parse the provided arraybuffer
  		 * @memberOf Parser
  		 *
  		 * @param {Uint8Array} arrayBuffer OBJ data as Uint8Array
  		 */Parser.prototype.parse=function(arrayBuffer){var this$1=this;this.logger.logTimeStart('OBJLoader2.Parser.parse');this.configure();var arrayBufferView=new Uint8Array(arrayBuffer);var length=arrayBufferView.byteLength;this.totalBytes=length;var buffer=new Array(128);var bufferPointer=0;var slashSpacePattern=new Array(16);var slashSpacePatternPointer=0;var code;var word='';var i=0;for(;i<length;i++){code=arrayBufferView[i];switch(code){case Consts.CODE_SPACE:if(word.length>0){buffer[bufferPointer++]=word;}slashSpacePattern[slashSpacePatternPointer++]=0;word='';break;case Consts.CODE_SLASH:if(word.length>0){buffer[bufferPointer++]=word;}slashSpacePattern[slashSpacePatternPointer++]=1;word='';break;case Consts.CODE_LF:if(word.length>0){buffer[bufferPointer++]=word;}word='';this$1.processLine(buffer,bufferPointer,slashSpacePattern,slashSpacePatternPointer,i);bufferPointer=0;slashSpacePatternPointer=0;break;case Consts.CODE_CR:break;default:word+=String.fromCharCode(code);break;}}this.finalize(i);this.logger.logTimeEnd('OBJLoader2.Parser.parse');};/**
  		 * Parse the provided text
  		 * @memberOf Parser
  		 *
  		 * @param {string} text OBJ data as string
  		 */Parser.prototype.parseText=function(text){var this$1=this;this.logger.logTimeStart('OBJLoader2.Parser.parseText');this.configure();var length=text.length;this.totalBytes=length;var buffer=new Array(128);var bufferPointer=0;var slashSpacePattern=new Array(16);var slashSpacePatternPointer=0;var char;var word='';var i=0;for(;i<length;i++){char=text[i];switch(char){case Consts.STRING_SPACE:if(word.length>0){buffer[bufferPointer++]=word;}slashSpacePattern[slashSpacePatternPointer++]=0;word='';break;case Consts.STRING_SLASH:if(word.length>0){buffer[bufferPointer++]=word;}slashSpacePattern[slashSpacePatternPointer++]=1;word='';break;case Consts.STRING_LF:if(word.length>0){buffer[bufferPointer++]=word;}word='';this$1.processLine(buffer,bufferPointer,slashSpacePattern,slashSpacePatternPointer,i);bufferPointer=0;slashSpacePatternPointer=0;break;case Consts.STRING_CR:break;default:word+=char;}}this.finalize(i);this.logger.logTimeEnd('OBJLoader2.Parser.parseText');};Parser.prototype.processLine=function(buffer,bufferPointer,slashSpacePattern,slashSpacePatternPointer,currentByte){if(bufferPointer<1){return;}var countSlashes=function countSlashes(slashSpacePattern,slashSpacePatternPointer){var slashesCount=0;for(var i=0;i<slashSpacePatternPointer;i++){slashesCount+=slashSpacePattern[i];}return slashesCount;};var concatStringBuffer=function concatStringBuffer(buffer,bufferPointer,slashSpacePattern){var concatBuffer='';if(bufferPointer===2){concatBuffer=buffer[1];}else{var bufferLength=bufferPointer-1;for(var i=1;i<bufferLength;i++){concatBuffer+=buffer[i]+(slashSpacePattern[i]===0?' ':'/');}concatBuffer+=buffer[bufferLength];}return concatBuffer;};var flushStringBuffer=function flushStringBuffer(buffer,bufferPointer){for(var i=0;i<bufferPointer;i++){buffer[i]='';}};switch(buffer[0]){case Consts.LINE_V:this.rawMesh.pushVertex(buffer,bufferPointer>4);break;case Consts.LINE_VT:this.rawMesh.pushUv(buffer);break;case Consts.LINE_VN:this.rawMesh.pushNormal(buffer);break;case Consts.LINE_F:this.rawMesh.processFaces(buffer,bufferPointer,countSlashes(slashSpacePattern,slashSpacePatternPointer));break;case Consts.LINE_L:this.rawMesh.processLines(buffer,bufferPointer,countSlashes(slashSpacePattern,slashSpacePatternPointer));break;case Consts.LINE_S:this.rawMesh.pushSmoothingGroup(buffer[1]);flushStringBuffer(buffer,bufferPointer);break;case Consts.LINE_G:// 'g' leads to creation of mesh if valid data (faces declaration was done before), otherwise only groupName gets set
  this.processCompletedMesh(currentByte);this.rawMesh.pushGroup(concatStringBuffer(buffer,bufferPointer,slashSpacePattern));flushStringBuffer(buffer,bufferPointer);break;case Consts.LINE_O:// 'o' is pure meta-information and does not result in creation of new meshes
  this.rawMesh.pushObject(concatStringBuffer(buffer,bufferPointer,slashSpacePattern));flushStringBuffer(buffer,bufferPointer);break;case Consts.LINE_MTLLIB:this.rawMesh.pushMtllib(concatStringBuffer(buffer,bufferPointer,slashSpacePattern));flushStringBuffer(buffer,bufferPointer);break;case Consts.LINE_USEMTL:this.rawMesh.pushUsemtl(concatStringBuffer(buffer,bufferPointer,slashSpacePattern));flushStringBuffer(buffer,bufferPointer);break;default:break;}};Parser.prototype.createRawMeshReport=function(rawMesh,inputObjectCount){var report=rawMesh.createReport(inputObjectCount);return'Input Object number: '+inputObjectCount+'\n\tObject name: '+report.objectName+'\n\tGroup name: '+report.groupName+'\n\tMtllib name: '+report.mtllibName+'\n\tVertex count: '+report.vertexCount+'\n\tNormal count: '+report.normalCount+'\n\tUV count: '+report.uvCount+'\n\tSmoothingGroup count: '+report.smoothingGroupCount+'\n\tMaterial count: '+report.mtlCount+'\n\tReal RawMeshSubGroup count: '+report.subGroups;};Parser.prototype.processCompletedMesh=function(currentByte){var result=this.rawMesh.finalize();if(Validator.isValid(result)){if(this.rawMesh.colors.length>0&&this.rawMesh.colors.length!==this.rawMesh.vertices.length){throw'Vertex Colors were detected, but vertex count and color count do not match!';}if(this.logger.isDebug()){this.logger.logDebug(this.createRawMeshReport(this.rawMesh,this.inputObjectCount));}this.inputObjectCount++;this.buildMesh(result,currentByte);var progressBytesPercent=currentByte/this.totalBytes;this.callbackProgress('Completed [o: '+this.rawMesh.objectName+' g:'+this.rawMesh.groupName+'] Total progress: '+(progressBytesPercent*100).toFixed(2)+'%',progressBytesPercent);this.rawMesh.reset(this.rawMesh.smoothingGroup.splitMaterials);return true;}else{return false;}};Parser.prototype.finalize=function(currentByte){this.logger.logInfo('Global output object count: '+this.outputObjectCount);if(this.processCompletedMesh(currentByte)&&this.logger.isEnabled()){var parserFinalReport='Overall counts: '+'\n\tVertices: '+this.counts.vertices+'\n\tFaces: '+this.counts.faces+'\n\tMultiple definitions: '+this.counts.doubleIndicesCount;this.logger.logInfo(parserFinalReport);}};/**
  		 * RawObjectDescriptions are transformed to too intermediate format that is forwarded to the Builder.
  		 * It is ensured that rawObjectDescriptions only contain objects with vertices (no need to check).
  		 *
  		 * @param result
  		 */Parser.prototype.buildMesh=function(result,currentByte){var this$1=this;var rawObjectDescriptions=result.subGroups;var vertexFA=new Float32Array(result.absoluteVertexCount);this.counts.vertices+=result.absoluteVertexCount/3;this.counts.faces+=result.faceCount;this.counts.doubleIndicesCount+=result.doubleIndicesCount;var indexUA=result.absoluteIndexCount>0?new Uint32Array(result.absoluteIndexCount):null;var colorFA=result.absoluteColorCount>0?new Float32Array(result.absoluteColorCount):null;var normalFA=result.absoluteNormalCount>0?new Float32Array(result.absoluteNormalCount):null;var uvFA=result.absoluteUvCount>0?new Float32Array(result.absoluteUvCount):null;var haveVertexColors=Validator.isValid(colorFA);var rawObjectDescription;var materialNames=[];var createMultiMaterial=rawObjectDescriptions.length>1;var materialIndex=0;var materialIndexMapping=[];var selectedMaterialIndex;var materialGroup;var materialGroups=[];var vertexFAOffset=0;var indexUAOffset=0;var colorFAOffset=0;var normalFAOffset=0;var uvFAOffset=0;var materialGroupOffset=0;var materialGroupLength=0;var materialOrg,material,materialName,materialNameOrg;for(var oodIndex in rawObjectDescriptions){if(!rawObjectDescriptions.hasOwnProperty(oodIndex)){continue;}rawObjectDescription=rawObjectDescriptions[oodIndex];materialNameOrg=rawObjectDescription.materialName;materialName=materialNameOrg+(haveVertexColors?'_vertexColor':'')+(rawObjectDescription.smoothingGroup===0?'_flat':'');materialOrg=this$1.materials[materialNameOrg];material=this$1.materials[materialName];// both original and derived names do not lead to an existing material => need to use a default material
  if(!Validator.isValid(materialOrg)&&!Validator.isValid(material)){var defaultMaterialName=haveVertexColors?'vertexColorMaterial':'defaultMaterial';materialOrg=this$1.materials[defaultMaterialName];this$1.logger.logWarn('object_group "'+rawObjectDescription.objectName+'_'+rawObjectDescription.groupName+'" was defined with unresolvable material "'+materialNameOrg+'"! Assigning "'+defaultMaterialName+'".');materialNameOrg=defaultMaterialName;// if names are identical then there is no need for later manipulation
  if(materialNameOrg===materialName){material=materialOrg;materialName=defaultMaterialName;}}if(!Validator.isValid(material)){var materialCloneInstructions={materialNameOrg:materialNameOrg,materialName:materialName,materialProperties:{vertexColors:haveVertexColors?2:0,flatShading:rawObjectDescription.smoothingGroup===0}};var payload={cmd:'materialData',materials:{materialCloneInstructions:materialCloneInstructions}};this$1.callbackBuilder(payload);// fake entry for async; sync Parser always works on material references (Builder update directly visible here)
  if(this$1.useAsync){this$1.materials[materialName]=materialCloneInstructions;}}if(createMultiMaterial){// re-use material if already used before. Reduces materials array size and eliminates duplicates
  selectedMaterialIndex=materialIndexMapping[materialName];if(!selectedMaterialIndex){selectedMaterialIndex=materialIndex;materialIndexMapping[materialName]=materialIndex;materialNames.push(materialName);materialIndex++;}materialGroupLength=this$1.useIndices?rawObjectDescription.indices.length:rawObjectDescription.vertices.length/3;materialGroup={start:materialGroupOffset,count:materialGroupLength,index:selectedMaterialIndex};materialGroups.push(materialGroup);materialGroupOffset+=materialGroupLength;}else{materialNames.push(materialName);}vertexFA.set(rawObjectDescription.vertices,vertexFAOffset);vertexFAOffset+=rawObjectDescription.vertices.length;if(indexUA){indexUA.set(rawObjectDescription.indices,indexUAOffset);indexUAOffset+=rawObjectDescription.indices.length;}if(colorFA){colorFA.set(rawObjectDescription.colors,colorFAOffset);colorFAOffset+=rawObjectDescription.colors.length;}if(normalFA){normalFA.set(rawObjectDescription.normals,normalFAOffset);normalFAOffset+=rawObjectDescription.normals.length;}if(uvFA){uvFA.set(rawObjectDescription.uvs,uvFAOffset);uvFAOffset+=rawObjectDescription.uvs.length;}if(this$1.logger.isDebug()){var materialIndexLine=Validator.isValid(selectedMaterialIndex)?'\n\t\tmaterialIndex: '+selectedMaterialIndex:'';var createdReport='Output Object no.: '+this$1.outputObjectCount+'\n\t\tgroupName: '+rawObjectDescription.groupName+materialIndexLine+'\n\t\tmaterialName: '+rawObjectDescription.materialName+'\n\t\tsmoothingGroup: '+rawObjectDescription.smoothingGroup+'\n\t\tobjectName: '+rawObjectDescription.objectName+'\n\t\t#vertices: '+rawObjectDescription.vertices.length/3+'\n\t\t#indices: '+rawObjectDescription.indices.length+'\n\t\t#colors: '+rawObjectDescription.colors.length/3+'\n\t\t#uvs: '+rawObjectDescription.uvs.length/2+'\n\t\t#normals: '+rawObjectDescription.normals.length/3;this$1.logger.logDebug(createdReport);}}this.outputObjectCount++;this.callbackBuilder({cmd:'meshData',progress:{numericalValue:currentByte/this.totalBytes},params:{meshName:result.name},materials:{multiMaterial:createMultiMaterial,materialNames:materialNames,materialGroups:materialGroups},buffers:{vertices:vertexFA,indices:indexUA,colors:colorFA,normals:normalFA,uvs:uvFA}},[vertexFA.buffer],Validator.isValid(indexUA)?[indexUA.buffer]:null,Validator.isValid(colorFA)?[colorFA.buffer]:null,Validator.isValid(normalFA)?[normalFA.buffer]:null,Validator.isValid(uvFA)?[uvFA.buffer]:null);};return Parser;}();/**
  	 * {@link RawMesh} is only used by {@link Parser}.
  	 * The user of OBJLoader2 does not need to care about this class.
  	 * It is defined publicly for inclusion in web worker based OBJ loader ({@link OBJLoader2.WWOBJLoader2})
  	 */var RawMesh=function(){function RawMesh(materialPerSmoothingGroup,useIndices,disregardNormals){this.vertices=[];this.colors=[];this.normals=[];this.uvs=[];this.useIndices=useIndices===true;this.disregardNormals=disregardNormals===true;this.objectName='';this.groupName='';this.activeMtlName='';this.mtllibName='';this.reset(materialPerSmoothingGroup);}RawMesh.prototype.reset=function(materialPerSmoothingGroup){// faces are stored according combined index of group, material and smoothingGroup (0 or not)
  this.subGroups=[];this.subGroupInUse=null;this.smoothingGroup={splitMaterials:materialPerSmoothingGroup===true,normalized:-1,real:-1};// this default index is required as it is possible to define faces without 'g' or 'usemtl'
  this.pushSmoothingGroup(1);this.doubleIndicesCount=0;this.faceCount=0;this.mtlCount=0;this.smoothingGroupCount=0;};RawMesh.prototype.pushVertex=function(buffer,haveVertexColors){this.vertices.push(parseFloat(buffer[1]));this.vertices.push(parseFloat(buffer[2]));this.vertices.push(parseFloat(buffer[3]));if(haveVertexColors){this.colors.push(parseFloat(buffer[4]));this.colors.push(parseFloat(buffer[5]));this.colors.push(parseFloat(buffer[6]));}};RawMesh.prototype.pushUv=function(buffer){this.uvs.push(parseFloat(buffer[1]));this.uvs.push(parseFloat(buffer[2]));};RawMesh.prototype.pushNormal=function(buffer){this.normals.push(parseFloat(buffer[1]));this.normals.push(parseFloat(buffer[2]));this.normals.push(parseFloat(buffer[3]));};RawMesh.prototype.pushGroup=function(groupName){this.groupName=Validator.verifyInput(groupName,'');};RawMesh.prototype.pushObject=function(objectName){this.objectName=Validator.verifyInput(objectName,'');};RawMesh.prototype.pushMtllib=function(mtllibName){this.mtllibName=Validator.verifyInput(mtllibName,'');};RawMesh.prototype.pushUsemtl=function(mtlName){if(this.activeMtlName===mtlName||!Validator.isValid(mtlName)){return;}this.activeMtlName=mtlName;this.mtlCount++;this.verifyIndex();};RawMesh.prototype.pushSmoothingGroup=function(smoothingGroup){var smoothingGroupInt=parseInt(smoothingGroup);if(isNaN(smoothingGroupInt)){smoothingGroupInt=smoothingGroup==="off"?0:1;}var smoothCheck=this.smoothingGroup.normalized;this.smoothingGroup.normalized=this.smoothingGroup.splitMaterials?smoothingGroupInt:smoothingGroupInt===0?0:1;this.smoothingGroup.real=smoothingGroupInt;if(smoothCheck!==smoothingGroupInt){this.smoothingGroupCount++;this.verifyIndex();}};RawMesh.prototype.verifyIndex=function(){var index=this.activeMtlName+'|'+this.smoothingGroup.normalized;this.subGroupInUse=this.subGroups[index];if(!Validator.isValid(this.subGroupInUse)){this.subGroupInUse=new RawMeshSubGroup(this.objectName,this.groupName,this.activeMtlName,this.smoothingGroup.normalized);this.subGroups[index]=this.subGroupInUse;}};RawMesh.prototype.processFaces=function(buffer,bufferPointer,slashesCount){var this$1=this;var bufferLength=bufferPointer-1;var i,length;// "f vertex ..."
  if(slashesCount===0){for(i=2, length=bufferLength;i<length;i++){this$1.buildFace(buffer[1]);this$1.buildFace(buffer[i]);this$1.buildFace(buffer[i+1]);}// "f vertex/uv ..."
  }else if(bufferLength===slashesCount*2){for(i=3, length=bufferLength-2;i<length;i+=2){this$1.buildFace(buffer[1],buffer[2]);this$1.buildFace(buffer[i],buffer[i+1]);this$1.buildFace(buffer[i+2],buffer[i+3]);}// "f vertex/uv/normal ..."
  }else if(bufferLength*2===slashesCount*3){for(i=4, length=bufferLength-3;i<length;i+=3){this$1.buildFace(buffer[1],buffer[2],buffer[3]);this$1.buildFace(buffer[i],buffer[i+1],buffer[i+2]);this$1.buildFace(buffer[i+3],buffer[i+4],buffer[i+5]);}// "f vertex//normal ..."
  }else{for(i=3, length=bufferLength-2;i<length;i+=2){this$1.buildFace(buffer[1],undefined,buffer[2]);this$1.buildFace(buffer[i],undefined,buffer[i+1]);this$1.buildFace(buffer[i+2],undefined,buffer[i+3]);}}};RawMesh.prototype.buildFace=function(faceIndexV,faceIndexU,faceIndexN){var sgiu=this.subGroupInUse;if(this.disregardNormals){faceIndexN=undefined;}var scope=this;var updateRawObjectDescriptionInUse=function updateRawObjectDescriptionInUse(){var faceIndexVi=parseInt(faceIndexV);var indexPointerV=3*(faceIndexVi>0?faceIndexVi-1:faceIndexVi+scope.vertices.length/3);var vertices=sgiu.vertices;vertices.push(scope.vertices[indexPointerV++]);vertices.push(scope.vertices[indexPointerV++]);vertices.push(scope.vertices[indexPointerV]);var indexPointerC=scope.colors.length>0?indexPointerV:null;if(indexPointerC!==null){var colors=sgiu.colors;colors.push(scope.colors[indexPointerC++]);colors.push(scope.colors[indexPointerC++]);colors.push(scope.colors[indexPointerC]);}if(faceIndexU){var faceIndexUi=parseInt(faceIndexU);var indexPointerU=2*(faceIndexUi>0?faceIndexUi-1:faceIndexUi+scope.uvs.length/2);var uvs=sgiu.uvs;uvs.push(scope.uvs[indexPointerU++]);uvs.push(scope.uvs[indexPointerU]);}if(faceIndexN){var faceIndexNi=parseInt(faceIndexN);var indexPointerN=3*(faceIndexNi>0?faceIndexNi-1:faceIndexNi+scope.normals.length/3);var normals=sgiu.normals;normals.push(scope.normals[indexPointerN++]);normals.push(scope.normals[indexPointerN++]);normals.push(scope.normals[indexPointerN]);}};if(this.useIndices){var mappingName=faceIndexV+(faceIndexU?'_'+faceIndexU:'_n')+(faceIndexN?'_'+faceIndexN:'_n');var indicesPointer=sgiu.indexMappings[mappingName];if(Validator.isValid(indicesPointer)){this.doubleIndicesCount++;}else{indicesPointer=sgiu.vertices.length/3;updateRawObjectDescriptionInUse();sgiu.indexMappings[mappingName]=indicesPointer;sgiu.indexMappingsCount++;}sgiu.indices.push(indicesPointer);}else{updateRawObjectDescriptionInUse();}this.faceCount++;};/*
  		 * Support for lines with or without texture. First element in indexArray is the line identification
  		 * 0: "f vertex/uv		vertex/uv 		..."
  		 * 1: "f vertex			vertex 			..."
  		 */RawMesh.prototype.processLines=function(buffer,bufferPointer,slashCount){var this$1=this;var i=1;var length;var bufferLength=bufferPointer-1;if(bufferLength===slashCount*2){for(length=bufferLength-2;i<length;i+=2){this$1.vertices.push(parseInt(buffer[i]));this$1.uvs.push(parseInt(buffer[i+1]));}}else{for(length=bufferLength-1;i<length;i++){this$1.vertices.push(parseInt(buffer[i]));}}};/**
  		 * Clear any empty rawObjectDescription and calculate absolute vertex, normal and uv counts
  		 */RawMesh.prototype.finalize=function(){var this$1=this;var rawObjectDescriptionsTemp=[];var rawObjectDescription;var absoluteVertexCount=0;var absoluteIndexMappingsCount=0;var absoluteIndexCount=0;var absoluteColorCount=0;var absoluteNormalCount=0;var absoluteUvCount=0;var indices;for(var name in this$1.subGroups){rawObjectDescription=this$1.subGroups[name];if(rawObjectDescription.vertices.length>0){indices=rawObjectDescription.indices;if(indices.length>0&&absoluteIndexMappingsCount>0){for(var i in indices){indices[i]=indices[i]+absoluteIndexMappingsCount;}}rawObjectDescriptionsTemp.push(rawObjectDescription);absoluteVertexCount+=rawObjectDescription.vertices.length;absoluteIndexMappingsCount+=rawObjectDescription.indexMappingsCount;absoluteIndexCount+=rawObjectDescription.indices.length;absoluteColorCount+=rawObjectDescription.colors.length;absoluteUvCount+=rawObjectDescription.uvs.length;absoluteNormalCount+=rawObjectDescription.normals.length;}}// do not continue if no result
  var result=null;if(rawObjectDescriptionsTemp.length>0){result={name:this.groupName!==''?this.groupName:this.objectName,subGroups:rawObjectDescriptionsTemp,absoluteVertexCount:absoluteVertexCount,absoluteIndexCount:absoluteIndexCount,absoluteColorCount:absoluteColorCount,absoluteNormalCount:absoluteNormalCount,absoluteUvCount:absoluteUvCount,faceCount:this.faceCount,doubleIndicesCount:this.doubleIndicesCount};}return result;};RawMesh.prototype.createReport=function(){var report={objectName:this.objectName,groupName:this.groupName,mtllibName:this.mtllibName,vertexCount:this.vertices.length/3,normalCount:this.normals.length/3,uvCount:this.uvs.length/2,smoothingGroupCount:this.smoothingGroupCount,mtlCount:this.mtlCount,subGroups:this.subGroups.length};return report;};return RawMesh;}();/**
  	 * Descriptive information and data (vertices, normals, uvs) to passed on to mesh building function.
  	 * @class
  	 *
  	 * @param {string} objectName Name of the mesh
  	 * @param {string} groupName Name of the group
  	 * @param {string} materialName Name of the material
  	 * @param {number} smoothingGroup Normalized smoothingGroup (0: flat shading, 1: smooth shading)
  	 */var RawMeshSubGroup=function(){function RawMeshSubGroup(objectName,groupName,materialName,smoothingGroup){this.objectName=objectName;this.groupName=groupName;this.materialName=materialName;this.smoothingGroup=smoothingGroup;this._init();}RawMeshSubGroup.prototype._init=function(){this.vertices=[];this.indexMappingsCount=0;this.indexMappings=[];this.indices=[];this.colors=[];this.uvs=[];this.normals=[];};return RawMeshSubGroup;}();OBJLoader2.prototype._checkFiles=function(resources){var resource;var result={mtl:null,obj:null};for(var index in resources){resource=resources[index];if(!Validator.isValid(resource.name)){continue;}if(Validator.isValid(resource.content)){if(resource.extension==='OBJ'){// fast-fail on bad type
  if(!(resource.content instanceof Uint8Array)){throw'Provided content is not of type arraybuffer! Aborting...';}result.obj=resource;}else if(resource.extension==='MTL'&&Validator.isValid(resource.name)){if(!(typeof resource.content==='string'||resource.content instanceof String)){throw'Provided  content is not of type String! Aborting...';}result.mtl=resource;}else if(resource.extension==="ZIP"){// ignore
  }else{throw'Unidentified resource "'+resource.name+'": '+resource.url;}}else{// fast-fail on bad type
  if(!(typeof resource.name==='string'||resource.name instanceof String)){throw'Provided file is not properly defined! Aborting...';}if(resource.extension==='OBJ'){result.obj=resource;}else if(resource.extension==='MTL'){result.mtl=resource;}else if(resource.extension==="ZIP"){// ignore
  }else{throw'Unidentified resource "'+resource.name+'": '+resource.url;}}}return result;};/**
  	 * Utility method for loading an mtl file according resource description.
  	 * @memberOf OBJLoader2
  	 *
  	 * @param {string} url URL to the file
  	 * @param {Object} content The file content as arraybuffer or text
  	 * @param {function} callbackOnLoad
  	 * @param {string} [crossOrigin] CORS value
  	 */OBJLoader2.prototype.loadMtl=function(url,content,callbackOnLoad,crossOrigin){var resource=new LoaderSupport.ResourceDescriptor(url,'MTL');resource.setContent(content);this._loadMtl(resource,callbackOnLoad,crossOrigin);};/**
  	 * Utility method for loading an mtl file according resource description.
  	 * @memberOf OBJLoader2
  	 *
  	 * @param {LoaderSupport.ResourceDescriptor} resource
  	 * @param {function} callbackOnLoad
  	 * @param {string} [crossOrigin] CORS value
  	 */OBJLoader2.prototype._loadMtl=function(resource,callbackOnLoad,crossOrigin){if(MTLLoader===undefined){console.error('"MTLLoader" is not available. "OBJLoader2" requires it for loading MTL files.');}if(Validator.isValid(resource)){this.logger.logTimeStart('Loading MTL: '+resource.name);}var materials=[];var scope=this;var processMaterials=function processMaterials(materialCreator){var materialCreatorMaterials=[];if(Validator.isValid(materialCreator)){materialCreator.preload();materialCreatorMaterials=materialCreator.materials;for(var materialName in materialCreatorMaterials){if(materialCreatorMaterials.hasOwnProperty(materialName)){materials[materialName]=materialCreatorMaterials[materialName];}}}if(Validator.isValid(resource)){scope.logger.logTimeEnd('Loading MTL: '+resource.name);}callbackOnLoad(materials);};var mtlLoader=new MTLLoader();crossOrigin=Validator.verifyInput(crossOrigin,'anonymous');mtlLoader.setCrossOrigin(crossOrigin);// fast-fail
  if(!Validator.isValid(resource)||!Validator.isValid(resource.content)&&!Validator.isValid(resource.url)){processMaterials();}else{mtlLoader.setPath(resource.path);if(Validator.isValid(resource.content)){processMaterials(Validator.isValid(resource.content)?mtlLoader.parse(resource.content):null);}else if(Validator.isValid(resource.url)){var onError=function onError(event){var output='Error occurred while downloading "'+resource.url+'"';scope.logger.logError(output+': '+event);throw output;};mtlLoader.load(resource.name,processMaterials,undefined,onError);}}};return OBJLoader2;}();/**
   * @author Filipe Caixeta / http://filipecaixeta.com.br
   * @author Mugen87 / https://github.com/Mugen87
   *
   * Description: A THREE loader for PCD ascii and binary files.
   *
   * Limitations: Compressed binary files are not supported.
   *
   */var PVRLoader=function PVRLoader(manager){this.manager=manager!==undefined?manager:DefaultLoadingManager;this._parser=PVRLoader.parse;};PVRLoader.prototype=Object.create(CompressedTextureLoader.prototype);PVRLoader.prototype.constructor=PVRLoader;PVRLoader.parse=function(buffer,loadMipmaps){var headerLengthInt=13;var header=new Uint32Array(buffer,0,headerLengthInt);var pvrDatas={buffer:buffer,header:header,loadMipmaps:loadMipmaps};if(header[0]===0x03525650){// PVR v3
  return PVRLoader._parseV3(pvrDatas);}else if(header[11]===0x21525650){// PVR v2
  return PVRLoader._parseV2(pvrDatas);}else{console.error('PVRLoader: Unknown PVR format.');}};PVRLoader._parseV3=function(pvrDatas){var header=pvrDatas.header;var bpp,format;var metaLen=header[12],pixelFormat=header[2],height=header[6],width=header[7],// numSurfs = header[ 9 ],
  numFaces=header[10],numMipmaps=header[11];switch(pixelFormat){case 0:// PVRTC 2bpp RGB
  bpp=2;format=RGB_PVRTC_2BPPV1_Format;break;case 1:// PVRTC 2bpp RGBA
  bpp=2;format=RGBA_PVRTC_2BPPV1_Format;break;case 2:// PVRTC 4bpp RGB
  bpp=4;format=RGB_PVRTC_4BPPV1_Format;break;case 3:// PVRTC 4bpp RGBA
  bpp=4;format=RGBA_PVRTC_4BPPV1_Format;break;default:console.error('PVRLoader: Unsupported PVR format:',pixelFormat);}pvrDatas.dataPtr=52+metaLen;pvrDatas.bpp=bpp;pvrDatas.format=format;pvrDatas.width=width;pvrDatas.height=height;pvrDatas.numSurfaces=numFaces;pvrDatas.numMipmaps=numMipmaps;pvrDatas.isCubemap=numFaces===6;return PVRLoader._extract(pvrDatas);};PVRLoader._parseV2=function(pvrDatas){var header=pvrDatas.header;var headerLength=header[0],height=header[1],width=header[2],numMipmaps=header[3],flags=header[4],// dataLength = header[ 5 ],
  // bpp =  header[ 6 ],
  // bitmaskRed = header[ 7 ],
  // bitmaskGreen = header[ 8 ],
  // bitmaskBlue = header[ 9 ],
  bitmaskAlpha=header[10],// pvrTag = header[ 11 ],
  numSurfs=header[12];var TYPE_MASK=0xff;var PVRTC_2=24,PVRTC_4=25;var formatFlags=flags&TYPE_MASK;var bpp,format;var _hasAlpha=bitmaskAlpha>0;if(formatFlags===PVRTC_4){format=_hasAlpha?RGBA_PVRTC_4BPPV1_Format:RGB_PVRTC_4BPPV1_Format;bpp=4;}else if(formatFlags===PVRTC_2){format=_hasAlpha?RGBA_PVRTC_2BPPV1_Format:RGB_PVRTC_2BPPV1_Format;bpp=2;}else{console.error('PVRLoader: Unknown PVR format:',formatFlags);}pvrDatas.dataPtr=headerLength;pvrDatas.bpp=bpp;pvrDatas.format=format;pvrDatas.width=width;pvrDatas.height=height;pvrDatas.numSurfaces=numSurfs;pvrDatas.numMipmaps=numMipmaps+1;// guess cubemap type seems tricky in v2
  // it juste a pvr containing 6 surface (no explicit cubemap type)
  pvrDatas.isCubemap=numSurfs===6;return PVRLoader._extract(pvrDatas);};PVRLoader._extract=function(pvrDatas){var pvr={mipmaps:[],width:pvrDatas.width,height:pvrDatas.height,format:pvrDatas.format,mipmapCount:pvrDatas.numMipmaps,isCubemap:pvrDatas.isCubemap};var buffer=pvrDatas.buffer;var dataOffset=pvrDatas.dataPtr,bpp=pvrDatas.bpp,numSurfs=pvrDatas.numSurfaces,dataSize=0,blockSize=0,blockWidth=0,blockHeight=0,widthBlocks=0,heightBlocks=0;if(bpp===2){blockWidth=8;blockHeight=4;}else{blockWidth=4;blockHeight=4;}blockSize=blockWidth*blockHeight*bpp/8;pvr.mipmaps.length=pvrDatas.numMipmaps*numSurfs;var mipLevel=0;while(mipLevel<pvrDatas.numMipmaps){var sWidth=pvrDatas.width>>mipLevel,sHeight=pvrDatas.height>>mipLevel;widthBlocks=sWidth/blockWidth;heightBlocks=sHeight/blockHeight;// Clamp to minimum number of blocks
  if(widthBlocks<2){widthBlocks=2;}if(heightBlocks<2){heightBlocks=2;}dataSize=widthBlocks*heightBlocks*blockSize;for(var surfIndex=0;surfIndex<numSurfs;surfIndex++){var byteArray=new Uint8Array(buffer,dataOffset,dataSize);var mipmap={data:byteArray,width:sWidth,height:sHeight};pvr.mipmaps[surfIndex*pvrDatas.numMipmaps+mipLevel]=mipmap;dataOffset+=dataSize;}mipLevel++;}return pvr;};/**
   * @author aleeper / http://adamleeper.com/
   * @author mrdoob / http://mrdoob.com/
   * @author gero3 / https://github.com/gero3
   * @author Mugen87 / https://github.com/Mugen87
   *
   * Description: A THREE loader for STL ASCII files, as created by Solidworks and other CAD programs.
   *
   * Supports both binary and ASCII encoded files, with automatic detection of type.
   *
   * The loader returns a non-indexed buffer geometry.
   *
   * Limitations:
   *  Binary decoding supports "Magics" color format (http://en.wikipedia.org/wiki/STL_(file_format)#Color_in_binary_STL).
   *  There is perhaps some question as to how valid it is to always assume little-endian-ness.
   *  ASCII decoding assumes file is UTF-8.
   *
   * Usage:
   *  var loader = new STLLoader();
   *  loader.load( './models/stl/slotted_disk.stl', function ( geometry ) {
   *    scene.add( new Mesh( geometry ) );
   *  });
   *
   * For binary STLs geometry might contain colors for vertices. To use it:
   *  // use the same code to load STL as above
   *  if (geometry.hasColors) {
   *    material = new MeshPhongMaterial({ opacity: geometry.alpha, vertexColors: VertexColors });
   *  } else { .... }
   *  var mesh = new Mesh( geometry, material );
   */var STLLoader=function STLLoader(manager){this.manager=manager!==undefined?manager:DefaultLoadingManager;};STLLoader.prototype={constructor:STLLoader,load:function load(url,onLoad,onProgress,onError){var scope=this;var loader=new FileLoader(scope.manager);loader.setResponseType('arraybuffer');loader.load(url,function(text){try{onLoad(scope.parse(text));}catch(exception){if(onError){onError(exception);}}},onProgress,onError);},parse:function parse(data){function isBinary(data){var expect,face_size,n_faces,reader;reader=new DataView(data);face_size=32/8*3+32/8*3*3+16/8;n_faces=reader.getUint32(80,true);expect=80+32/8+n_faces*face_size;if(expect===reader.byteLength){return true;}// An ASCII STL data must begin with 'solid ' as the first six bytes.
  // However, ASCII STLs lacking the SPACE after the 'd' are known to be
  // plentiful.  So, check the first 5 bytes for 'solid'.
  // US-ASCII ordinal values for 's', 'o', 'l', 'i', 'd'
  var solid=[115,111,108,105,100];for(var i=0;i<5;i++){// If solid[ i ] does not match the i-th byte, then it is not an
  // ASCII STL; hence, it is binary and return true.
  if(solid[i]!=reader.getUint8(i,false)){return true;}}// First 5 bytes read "solid"; declare it to be an ASCII STL
  return false;}function parseBinary(data){var reader=new DataView(data);var faces=reader.getUint32(80,true);var r,g,b,hasColors=false,colors;var defaultR,defaultG,defaultB,alpha;// process STL header
  // check for default color in header ("COLOR=rgba" sequence).
  for(var index=0;index<80-10;index++){if(reader.getUint32(index,false)==0x434F4C4F/*COLO*/&&reader.getUint8(index+4)==0x52/*'R'*/&&reader.getUint8(index+5)==0x3D/*'='*/){hasColors=true;colors=[];defaultR=reader.getUint8(index+6)/255;defaultG=reader.getUint8(index+7)/255;defaultB=reader.getUint8(index+8)/255;alpha=reader.getUint8(index+9)/255;}}var dataOffset=84;var faceLength=12*4+2;var geometry=new BufferGeometry();var vertices=[];var normals=[];for(var face=0;face<faces;face++){var start=dataOffset+face*faceLength;var normalX=reader.getFloat32(start,true);var normalY=reader.getFloat32(start+4,true);var normalZ=reader.getFloat32(start+8,true);if(hasColors){var packedColor=reader.getUint16(start+48,true);if((packedColor&0x8000)===0){// facet has its own unique color
  r=(packedColor&0x1F)/31;g=(packedColor>>5&0x1F)/31;b=(packedColor>>10&0x1F)/31;}else{r=defaultR;g=defaultG;b=defaultB;}}for(var i=1;i<=3;i++){var vertexstart=start+i*12;vertices.push(reader.getFloat32(vertexstart,true));vertices.push(reader.getFloat32(vertexstart+4,true));vertices.push(reader.getFloat32(vertexstart+8,true));normals.push(normalX,normalY,normalZ);if(hasColors){colors.push(r,g,b);}}}geometry.addAttribute('position',new BufferAttribute(new Float32Array(vertices),3));geometry.addAttribute('normal',new BufferAttribute(new Float32Array(normals),3));if(hasColors){geometry.addAttribute('color',new BufferAttribute(new Float32Array(colors),3));geometry.hasColors=true;geometry.alpha=alpha;}return geometry;}function parseASCII(data){var geometry=new BufferGeometry();var patternFace=/facet([\s\S]*?)endfacet/g;var faceCounter=0;var patternFloat=/[\s]+([+-]?(?:\d+.\d+|\d+.|\d+|.\d+)(?:[eE][+-]?\d+)?)/.source;var patternVertex=new RegExp('vertex'+patternFloat+patternFloat+patternFloat,'g');var patternNormal=new RegExp('normal'+patternFloat+patternFloat+patternFloat,'g');var vertices=[];var normals=[];var normal=new Vector3$1();var result;while((result=patternFace.exec(data))!==null){var vertexCountPerFace=0;var normalCountPerFace=0;var text=result[0];while((result=patternNormal.exec(text))!==null){normal.x=parseFloat(result[1]);normal.y=parseFloat(result[2]);normal.z=parseFloat(result[3]);normalCountPerFace++;}while((result=patternVertex.exec(text))!==null){vertices.push(parseFloat(result[1]),parseFloat(result[2]),parseFloat(result[3]));normals.push(normal.x,normal.y,normal.z);vertexCountPerFace++;}// every face have to own ONE valid normal
  if(normalCountPerFace!==1){console.error('STLLoader: Something isn\'t right with the normal of face number '+faceCounter);}// each face have to own THREE valid vertices
  if(vertexCountPerFace!==3){console.error('STLLoader: Something isn\'t right with the vertices of face number '+faceCounter);}faceCounter++;}geometry.addAttribute('position',new Float32BufferAttribute(vertices,3));geometry.addAttribute('normal',new Float32BufferAttribute(normals,3));return geometry;}function ensureString(buffer){if(typeof buffer!=='string'){return LoaderUtils.decodeText(new Uint8Array(buffer));}return buffer;}function ensureBinary(buffer){if(typeof buffer==='string'){var array_buffer=new Uint8Array(buffer.length);for(var i=0;i<buffer.length;i++){array_buffer[i]=buffer.charCodeAt(i)&0xff;// implicitly assumes little-endian
  }return array_buffer.buffer||array_buffer;}else{return buffer;}}// start
  var binData=ensureBinary(data);return isBinary(binData)?parseBinary(binData):parseASCII(ensureString(data));}};/**
   * @author mrdoob / http://mrdoob.com/
   * @author zz85 / http://joshuakoo.com/
   */var UTF8Loader=function UTF8Loader(){};/**
   * Load UTF8 encoded model
   * @param jsonUrl - URL from which to load json containing information about model
   * @param callback - Callback(Object3D) on successful loading of model
   * @param options - options on how to load model (see MTLLoader.MaterialCreator for basic options)
   *                  Additional options include
   *                   geometryBase: Base url from which to load referenced geometries
   *                   materialBase: Base url from which to load referenced textures
   */UTF8Loader.prototype.load=function(jsonUrl,callback,options){this.downloadModelJson(jsonUrl,callback,options);};// BufferGeometryCreator
  UTF8Loader.BufferGeometryCreator=function(){};UTF8Loader.BufferGeometryCreator.prototype.create=function(attribArray,indices){var ntris=indices.length/3;var geometry=new BufferGeometry();var positions=new Float32Array(ntris*3*3);var normals=new Float32Array(ntris*3*3);var uvs=new Float32Array(ntris*3*2);var i,j,offset;var end=attribArray.length;var stride=8;// extract positions
  j=0;offset=0;for(i=offset;i<end;i+=stride){positions[j++]=attribArray[i];positions[j++]=attribArray[i+1];positions[j++]=attribArray[i+2];}// extract uvs
  j=0;offset=3;for(i=offset;i<end;i+=stride){uvs[j++]=attribArray[i];uvs[j++]=attribArray[i+1];}// extract normals
  j=0;offset=5;for(i=offset;i<end;i+=stride){normals[j++]=attribArray[i];normals[j++]=attribArray[i+1];normals[j++]=attribArray[i+2];}geometry.setIndex(new BufferAttribute(indices,1));geometry.addAttribute('position',new BufferAttribute(positions,3));geometry.addAttribute('normal',new BufferAttribute(normals,3));geometry.addAttribute('uv',new BufferAttribute(uvs,2));geometry.computeBoundingSphere();return geometry;};// UTF-8 decoder from webgl-loader (r100)
  // http://code.google.com/p/webgl-loader/
  // Model manifest description. Contains objects like:
  // name: {
  //   materials: { 'material_name': { ... } ... },
  //   decodeParams: {
  //     decodeOffsets: [ ... ],
  //     decodeScales: [ ... ],
  //   },
  //   urls: {
  //     'url': [
  //       { material: 'material_name',
  //         attribRange: [#, #],
  //         indexRange: [#, #],
  //         names: [ 'object names' ... ],
  //         lengths: [#, #, # ... ]
  //       }
  //     ],
  //     ...
  //   }
  // }
  var DEFAULT_DECODE_PARAMS={decodeOffsets:[-4095,-4095,-4095,0,0,-511,-511,-511],decodeScales:[1/8191,1/8191,1/8191,1/1023,1/1023,1/1023,1/1023,1/1023]// TODO: normal decoding? (see walt.js)
  // needs to know: input, output (from vertex format!)
  //
  // Should split attrib/index.
  // 1) Decode position and non-normal attributes.
  // 2) Decode indices, computing normals
  // 3) Maybe normalize normals? Only necessary for refinement, or fixed?
  // 4) Maybe refine normals? Should this be part of regular refinement?
  // 5) Morphing
  };// Triangle strips!
  // TODO: will it be an optimization to specialize this method at
  // runtime for different combinations of stride, decodeOffset and
  // decodeScale?
  UTF8Loader.prototype.decompressAttribsInner_=function(str,inputStart,inputEnd,output,outputStart,stride,decodeOffset,decodeScale){var prev=0;for(var j=inputStart;j<inputEnd;j++){var code=str.charCodeAt(j);prev+=code>>1^-(code&1);output[outputStart]=decodeScale*(prev+decodeOffset);outputStart+=stride;}};UTF8Loader.prototype.decompressIndices_=function(str,inputStart,numIndices,output,outputStart){var highest=0;for(var i=0;i<numIndices;i++){var code=str.charCodeAt(inputStart++);output[outputStart++]=highest-code;if(code===0){highest++;}}};UTF8Loader.prototype.decompressAABBs_=function(str,inputStart,numBBoxen,decodeOffsets,decodeScales){var numFloats=6*numBBoxen;var inputEnd=inputStart+numFloats;var outputStart=0;var bboxen=new Float32Array(numFloats);for(var i=inputStart;i<inputEnd;i+=6){var minX=str.charCodeAt(i+0)+decodeOffsets[0];var minY=str.charCodeAt(i+1)+decodeOffsets[1];var minZ=str.charCodeAt(i+2)+decodeOffsets[2];var radiusX=str.charCodeAt(i+3)+1>>1;var radiusY=str.charCodeAt(i+4)+1>>1;var radiusZ=str.charCodeAt(i+5)+1>>1;bboxen[outputStart++]=decodeScales[0]*(minX+radiusX);bboxen[outputStart++]=decodeScales[1]*(minY+radiusY);bboxen[outputStart++]=decodeScales[2]*(minZ+radiusZ);bboxen[outputStart++]=decodeScales[0]*radiusX;bboxen[outputStart++]=decodeScales[1]*radiusY;bboxen[outputStart++]=decodeScales[2]*radiusZ;}return bboxen;};UTF8Loader.prototype.decompressMesh=function(str,meshParams,decodeParams,name,idx,callback){var this$1=this;// Extract conversion parameters from attribArrays.
  var stride=decodeParams.decodeScales.length;var decodeOffsets=decodeParams.decodeOffsets;var decodeScales=decodeParams.decodeScales;var attribStart=meshParams.attribRange[0];var numVerts=meshParams.attribRange[1];// Decode attributes.
  var inputOffset=attribStart;var attribsOut=new Float32Array(stride*numVerts);for(var j=0;j<stride;j++){var end=inputOffset+numVerts;var decodeScale=decodeScales[j];if(decodeScale){// Assume if decodeScale is never set, simply ignore the
  // attribute.
  this$1.decompressAttribsInner_(str,inputOffset,end,attribsOut,j,stride,decodeOffsets[j],decodeScale);}inputOffset=end;}var numIndices=3*meshParams.indexRange[1];var indicesOut=new Uint16Array(numIndices);this.decompressIndices_(str,inputOffset,numIndices,indicesOut,0);// Decode bboxen.
  var bboxen=undefined;var bboxOffset=meshParams.bboxes;if(bboxOffset){bboxen=this.decompressAABBs_(str,bboxOffset,meshParams.names.length,decodeOffsets,decodeScales);}callback(name,idx,attribsOut,indicesOut,bboxen,meshParams);};UTF8Loader.prototype.copyAttrib=function(stride,attribsOutFixed,lastAttrib,index){for(var j=0;j<stride;j++){lastAttrib[j]=attribsOutFixed[stride*index+j];}};UTF8Loader.prototype.decodeAttrib2=function(str,stride,decodeOffsets,decodeScales,deltaStart,numVerts,attribsOut,attribsOutFixed,lastAttrib,index){for(var j=0;j<5;j++){var code=str.charCodeAt(deltaStart+numVerts*j+index);var delta=code>>1^-(code&1);lastAttrib[j]+=delta;attribsOutFixed[stride*index+j]=lastAttrib[j];attribsOut[stride*index+j]=decodeScales[j]*(lastAttrib[j]+decodeOffsets[j]);}};UTF8Loader.prototype.accumulateNormal=function(i0,i1,i2,attribsOutFixed,crosses){var p0x=attribsOutFixed[8*i0];var p0y=attribsOutFixed[8*i0+1];var p0z=attribsOutFixed[8*i0+2];var p1x=attribsOutFixed[8*i1];var p1y=attribsOutFixed[8*i1+1];var p1z=attribsOutFixed[8*i1+2];var p2x=attribsOutFixed[8*i2];var p2y=attribsOutFixed[8*i2+1];var p2z=attribsOutFixed[8*i2+2];p1x-=p0x;p1y-=p0y;p1z-=p0z;p2x-=p0x;p2y-=p0y;p2z-=p0z;p0x=p1y*p2z-p1z*p2y;p0y=p1z*p2x-p1x*p2z;p0z=p1x*p2y-p1y*p2x;crosses[3*i0]+=p0x;crosses[3*i0+1]+=p0y;crosses[3*i0+2]+=p0z;crosses[3*i1]+=p0x;crosses[3*i1+1]+=p0y;crosses[3*i1+2]+=p0z;crosses[3*i2]+=p0x;crosses[3*i2+1]+=p0y;crosses[3*i2+2]+=p0z;};UTF8Loader.prototype.decompressMesh2=function(str,meshParams,decodeParams,name,idx,callback){var this$1=this;var MAX_BACKREF=96;// Extract conversion parameters from attribArrays.
  var stride=decodeParams.decodeScales.length;var decodeOffsets=decodeParams.decodeOffsets;var decodeScales=decodeParams.decodeScales;var deltaStart=meshParams.attribRange[0];var numVerts=meshParams.attribRange[1];var codeStart=meshParams.codeRange[0];var numIndices=3*meshParams.codeRange[2];var indicesOut=new Uint16Array(numIndices);var crosses=new Int32Array(3*numVerts);var lastAttrib=new Uint16Array(stride);var attribsOutFixed=new Uint16Array(stride*numVerts);var attribsOut=new Float32Array(stride*numVerts);var highest=0;var outputStart=0;for(var i=0;i<numIndices;i+=3){var code=str.charCodeAt(codeStart++);var max_backref=Math.min(i,MAX_BACKREF);if(code<max_backref){// Parallelogram
  var winding=code%3;var backref=i-(code-winding);var i0,i1,i2;switch(winding){case 0:i0=indicesOut[backref+2];i1=indicesOut[backref+1];i2=indicesOut[backref+0];break;case 1:i0=indicesOut[backref+0];i1=indicesOut[backref+2];i2=indicesOut[backref+1];break;case 2:i0=indicesOut[backref+1];i1=indicesOut[backref+0];i2=indicesOut[backref+2];break;}indicesOut[outputStart++]=i0;indicesOut[outputStart++]=i1;code=str.charCodeAt(codeStart++);var index=highest-code;indicesOut[outputStart++]=index;if(code===0){for(var j=0;j<5;j++){var deltaCode=str.charCodeAt(deltaStart+numVerts*j+highest);var prediction=(deltaCode>>1^-(deltaCode&1))+attribsOutFixed[stride*i0+j]+attribsOutFixed[stride*i1+j]-attribsOutFixed[stride*i2+j];lastAttrib[j]=prediction;attribsOutFixed[stride*highest+j]=prediction;attribsOut[stride*highest+j]=decodeScales[j]*(prediction+decodeOffsets[j]);}highest++;}else{this$1.copyAttrib(stride,attribsOutFixed,lastAttrib,index);}this$1.accumulateNormal(i0,i1,index,attribsOutFixed,crosses);}else{// Simple
  var index0=highest-(code-max_backref);indicesOut[outputStart++]=index0;if(code===max_backref){this$1.decodeAttrib2(str,stride,decodeOffsets,decodeScales,deltaStart,numVerts,attribsOut,attribsOutFixed,lastAttrib,highest++);}else{this$1.copyAttrib(stride,attribsOutFixed,lastAttrib,index0);}code=str.charCodeAt(codeStart++);var index1=highest-code;indicesOut[outputStart++]=index1;if(code===0){this$1.decodeAttrib2(str,stride,decodeOffsets,decodeScales,deltaStart,numVerts,attribsOut,attribsOutFixed,lastAttrib,highest++);}else{this$1.copyAttrib(stride,attribsOutFixed,lastAttrib,index1);}code=str.charCodeAt(codeStart++);var index2=highest-code;indicesOut[outputStart++]=index2;if(code===0){for(var j=0;j<5;j++){lastAttrib[j]=(attribsOutFixed[stride*index0+j]+attribsOutFixed[stride*index1+j])/2;}this$1.decodeAttrib2(str,stride,decodeOffsets,decodeScales,deltaStart,numVerts,attribsOut,attribsOutFixed,lastAttrib,highest++);}else{this$1.copyAttrib(stride,attribsOutFixed,lastAttrib,index2);}this$1.accumulateNormal(index0,index1,index2,attribsOutFixed,crosses);}}for(var i=0;i<numVerts;i++){var nx=crosses[3*i];var ny=crosses[3*i+1];var nz=crosses[3*i+2];var norm=511.0/Math.sqrt(nx*nx+ny*ny+nz*nz);var cx=str.charCodeAt(deltaStart+5*numVerts+i);var cy=str.charCodeAt(deltaStart+6*numVerts+i);var cz=str.charCodeAt(deltaStart+7*numVerts+i);attribsOut[stride*i+5]=norm*nx+(cx>>1^-(cx&1));attribsOut[stride*i+6]=norm*ny+(cy>>1^-(cy&1));attribsOut[stride*i+7]=norm*nz+(cz>>1^-(cz&1));}callback(name,idx,attribsOut,indicesOut,undefined,meshParams);};UTF8Loader.prototype.downloadMesh=function(path,name,meshEntry,decodeParams,callback){var loader=this;var idx=0;function onprogress(data){while(idx<meshEntry.length){var meshParams=meshEntry[idx];var indexRange=meshParams.indexRange;if(indexRange){var meshEnd=indexRange[0]+3*indexRange[1];if(data.length<meshEnd){break;}loader.decompressMesh(data,meshParams,decodeParams,name,idx,callback);}else{var codeRange=meshParams.codeRange;var meshEnd=codeRange[0]+codeRange[1];if(data.length<meshEnd){break;}loader.decompressMesh2(data,meshParams,decodeParams,name,idx,callback);}++idx;}}getHttpRequest(path,function(data){onprogress(data);// TODO: handle errors.
  });};UTF8Loader.prototype.downloadMeshes=function(path,meshUrlMap,decodeParams,callback){var this$1=this;for(var url in meshUrlMap){var meshEntry=meshUrlMap[url];this$1.downloadMesh(path+url,url,meshEntry,decodeParams,callback);}};UTF8Loader.prototype.createMeshCallback=function(materialBaseUrl,loadModelInfo,allDoneCallback){var nCompletedUrls=0;var nExpectedUrls=0;var expectedMeshesPerUrl={};var decodedMeshesPerUrl={};var modelParts={};var meshUrlMap=loadModelInfo.urls;for(var url in meshUrlMap){expectedMeshesPerUrl[url]=meshUrlMap[url].length;decodedMeshesPerUrl[url]=0;nExpectedUrls++;modelParts[url]=new Object3D();}var model=new Object3D();// Prepare materials first...
  var materialCreator=new MTLLoader.MaterialCreator(materialBaseUrl,loadModelInfo.options);materialCreator.setMaterials(loadModelInfo.materials);materialCreator.preload();// Create callback for creating mesh parts
  var bufferGeometryCreator=new UTF8Loader.BufferGeometryCreator();var meshCallback=function meshCallback(name,idx,attribArray,indexArray,bboxen,meshParams){// Got ourselves a new mesh
  // name identifies this part of the model (url)
  // idx is the mesh index of this mesh of the part
  // attribArray defines the vertices
  // indexArray defines the faces
  // bboxen defines the bounding box
  // meshParams contains the material info
  var geometry=bufferGeometryCreator.create(attribArray,indexArray);var material=materialCreator.create(meshParams.material);var mesh=new Mesh(geometry,material);modelParts[name].add(mesh);//model.add(new Mesh(geometry, material));
  decodedMeshesPerUrl[name]++;if(decodedMeshesPerUrl[name]===expectedMeshesPerUrl[name]){nCompletedUrls++;model.add(modelParts[name]);if(nCompletedUrls===nExpectedUrls){// ALL DONE!!!
  allDoneCallback(model);}}};return meshCallback;};UTF8Loader.prototype.downloadModel=function(geometryBase,materialBase,model,callback){var meshCallback=this.createMeshCallback(materialBase,model,callback);this.downloadMeshes(geometryBase,model.urls,model.decodeParams,meshCallback);};UTF8Loader.prototype.downloadModelJson=function(jsonUrl,callback,options){getJsonRequest(jsonUrl,function(loaded){if(!loaded.decodeParams){if(options&&options.decodeParams){loaded.decodeParams=options.decodeParams;}else{loaded.decodeParams=DEFAULT_DECODE_PARAMS;}}loaded.options=options;var geometryBase=jsonUrl.substr(0,jsonUrl.lastIndexOf("/")+1);var materialBase=geometryBase;if(options&&options.geometryBase){geometryBase=options.geometryBase;if(geometryBase.charAt(geometryBase.length-1)!=="/"){geometryBase=geometryBase+"/";}}if(options&&options.materialBase){materialBase=options.materialBase;if(materialBase.charAt(materialBase.length-1)!=="/"){materialBase=materialBase+"/";}}this.downloadModel(geometryBase,materialBase,loaded,callback);}.bind(this));};// XMLHttpRequest stuff
  function getHttpRequest(url,onload,opt_onprogress){var req=new FileLoader();req.load(url,onload,opt_onprogress);}function getJsonRequest(url,onjson){getHttpRequest(url,function(e){onjson(JSON.parse(e));},function(){});}/**
   * @author mrdoob / http://mrdoob.com/
   */var VTKLoader=function VTKLoader(manager){this.manager=manager!==undefined?manager:DefaultLoadingManager;};Object.assign(VTKLoader.prototype,EventDispatcher.prototype,{load:function load(url,onLoad,onProgress,onError){var scope=this;var loader=new FileLoader(scope.manager);loader.setResponseType('arraybuffer');loader.load(url,function(text){onLoad(scope.parse(text));},onProgress,onError);},parse:function parse(data){function parseASCII(data){// connectivity of the triangles
  var indices=[];// triangles vertices
  var positions=[];// red, green, blue colors in the range 0 to 1
  var colors=[];// normal vector, one per vertex
  var normals=[];var result;// pattern for reading vertices, 3 floats or integers
  var pat3Floats=/(\-?\d+\.?[\d\-\+e]*)\s+(\-?\d+\.?[\d\-\+e]*)\s+(\-?\d+\.?[\d\-\+e]*)/g;// pattern for connectivity, an integer followed by any number of ints
  // the first integer is the number of polygon nodes
  var patConnectivity=/^(\d+)\s+([\s\d]*)/;// indicates start of vertex data section
  var patPOINTS=/^POINTS /;// indicates start of polygon connectivity section
  var patPOLYGONS=/^POLYGONS /;// indicates start of triangle strips section
  var patTRIANGLE_STRIPS=/^TRIANGLE_STRIPS /;// POINT_DATA number_of_values
  var patPOINT_DATA=/^POINT_DATA[ ]+(\d+)/;// CELL_DATA number_of_polys
  var patCELL_DATA=/^CELL_DATA[ ]+(\d+)/;// Start of color section
  var patCOLOR_SCALARS=/^COLOR_SCALARS[ ]+(\w+)[ ]+3/;// NORMALS Normals float
  var patNORMALS=/^NORMALS[ ]+(\w+)[ ]+(\w+)/;var inPointsSection=false;var inPolygonsSection=false;var inTriangleStripSection=false;var inPointDataSection=false;var inCellDataSection=false;var inColorSection=false;var inNormalsSection=false;var lines=data.split('\n');for(var i in lines){var line=lines[i];if(inPointsSection){// get the vertices
  while((result=pat3Floats.exec(line))!==null){var x=parseFloat(result[1]);var y=parseFloat(result[2]);var z=parseFloat(result[3]);positions.push(x,y,z);}}else if(inPolygonsSection){if((result=patConnectivity.exec(line))!==null){// numVertices i0 i1 i2 ...
  var numVertices=parseInt(result[1]);var inds=result[2].split(/\s+/);if(numVertices>=3){var i0=parseInt(inds[0]);var i1,i2;var k=1;// split the polygon in numVertices - 2 triangles
  for(var j=0;j<numVertices-2;++j){i1=parseInt(inds[k]);i2=parseInt(inds[k+1]);indices.push(i0,i1,i2);k++;}}}}else if(inTriangleStripSection){if((result=patConnectivity.exec(line))!==null){// numVertices i0 i1 i2 ...
  var numVertices=parseInt(result[1]);var inds=result[2].split(/\s+/);if(numVertices>=3){var i0,i1,i2;// split the polygon in numVertices - 2 triangles
  for(var j=0;j<numVertices-2;j++){if(j%2===1){i0=parseInt(inds[j]);i1=parseInt(inds[j+2]);i2=parseInt(inds[j+1]);indices.push(i0,i1,i2);}else{i0=parseInt(inds[j]);i1=parseInt(inds[j+1]);i2=parseInt(inds[j+2]);indices.push(i0,i1,i2);}}}}}else if(inPointDataSection||inCellDataSection){if(inColorSection){// Get the colors
  while((result=pat3Floats.exec(line))!==null){var r=parseFloat(result[1]);var g=parseFloat(result[2]);var b=parseFloat(result[3]);colors.push(r,g,b);}}else if(inNormalsSection){// Get the normal vectors
  while((result=pat3Floats.exec(line))!==null){var nx=parseFloat(result[1]);var ny=parseFloat(result[2]);var nz=parseFloat(result[3]);normals.push(nx,ny,nz);}}}if(patPOLYGONS.exec(line)!==null){inPolygonsSection=true;inPointsSection=false;inTriangleStripSection=false;}else if(patPOINTS.exec(line)!==null){inPolygonsSection=false;inPointsSection=true;inTriangleStripSection=false;}else if(patTRIANGLE_STRIPS.exec(line)!==null){inPolygonsSection=false;inPointsSection=false;inTriangleStripSection=true;}else if(patPOINT_DATA.exec(line)!==null){inPointDataSection=true;inPointsSection=false;inPolygonsSection=false;inTriangleStripSection=false;}else if(patCELL_DATA.exec(line)!==null){inCellDataSection=true;inPointsSection=false;inPolygonsSection=false;inTriangleStripSection=false;}else if(patCOLOR_SCALARS.exec(line)!==null){inColorSection=true;inNormalsSection=false;inPointsSection=false;inPolygonsSection=false;inTriangleStripSection=false;}else if(patNORMALS.exec(line)!==null){inNormalsSection=true;inColorSection=false;inPointsSection=false;inPolygonsSection=false;inTriangleStripSection=false;}}var geometry;var stagger='point';if(colors.length===indices.length){stagger='cell';}if(stagger==='point'){// Nodal. Use BufferGeometry
  geometry=new BufferGeometry();geometry.setIndex(new BufferAttribute(new Uint32Array(indices),1));geometry.addAttribute('position',new BufferAttribute(new Float32Array(positions),3));if(colors.length===positions.length){geometry.addAttribute('color',new BufferAttribute(new Float32Array(colors),3));}if(normals.length===positions.length){geometry.addAttribute('normal',new BufferAttribute(new Float32Array(normals),3));}}else{// Cell centered colors. The only way to attach a solid color to each triangle
  // is to use Geometry, which is less efficient than BufferGeometry
  geometry=new Geometry();var numTriangles=indices.length/3;var numPoints=positions.length/3;var face;var ia,ib,ic;var x,y,z;var r,g,b;for(var j=0;j<numPoints;++j){x=positions[3*j+0];y=positions[3*j+1];z=positions[3*j+2];geometry.vertices.push(new Vector3$1(x,y,z));}for(var i=0;i<numTriangles;++i){ia=indices[3*i+0];ib=indices[3*i+1];ic=indices[3*i+2];geometry.faces.push(new Face3$1(ia,ib,ic));}if(colors.length===numTriangles*3){for(var i=0;i<numTriangles;++i){face=geometry.faces[i];r=colors[3*i+0];g=colors[3*i+1];b=colors[3*i+2];face.color=new Color$1().setRGB(r,g,b);}}}return geometry;}function parseBinary(data){var count,pointIndex,i,numberOfPoints,s;var buffer=new Uint8Array(data);var dataView=new DataView(data);// Points and normals, by default, are empty
  var points=[];var normals=[];var indices=[];// Going to make a big array of strings
  var vtk=[];var index=0;function findString(buffer,start){var index=start;var c=buffer[index];var s=[];while(c!==10){s.push(String.fromCharCode(c));index++;c=buffer[index];}return{start:start,end:index,next:index+1,parsedString:s.join('')};}var state,line;while(true){// Get a string
  state=findString(buffer,index);line=state.parsedString;if(line.indexOf('POINTS')===0){vtk.push(line);// Add the points
  numberOfPoints=parseInt(line.split(' ')[1],10);// Each point is 3 4-byte floats
  count=numberOfPoints*4*3;points=new Float32Array(numberOfPoints*3);pointIndex=state.next;for(i=0;i<numberOfPoints;i++){points[3*i]=dataView.getFloat32(pointIndex,false);points[3*i+1]=dataView.getFloat32(pointIndex+4,false);points[3*i+2]=dataView.getFloat32(pointIndex+8,false);pointIndex=pointIndex+12;}// increment our next pointer
  state.next=state.next+count+1;}else if(line.indexOf('TRIANGLE_STRIPS')===0){var numberOfStrips=parseInt(line.split(' ')[1],10);var size=parseInt(line.split(' ')[2],10);// 4 byte integers
  count=size*4;indices=new Uint32Array(3*size-9*numberOfStrips);var indicesIndex=0;pointIndex=state.next;for(i=0;i<numberOfStrips;i++){// For each strip, read the first value, then record that many more points
  var indexCount=dataView.getInt32(pointIndex,false);var strip=[];pointIndex+=4;for(s=0;s<indexCount;s++){strip.push(dataView.getInt32(pointIndex,false));pointIndex+=4;}// retrieves the n-2 triangles from the triangle strip
  for(var j=0;j<indexCount-2;j++){if(j%2){indices[indicesIndex++]=strip[j];indices[indicesIndex++]=strip[j+2];indices[indicesIndex++]=strip[j+1];}else{indices[indicesIndex++]=strip[j];indices[indicesIndex++]=strip[j+1];indices[indicesIndex++]=strip[j+2];}}}// increment our next pointer
  state.next=state.next+count+1;}else if(line.indexOf('POLYGONS')===0){var numberOfStrips=parseInt(line.split(' ')[1],10);var size=parseInt(line.split(' ')[2],10);// 4 byte integers
  count=size*4;indices=new Uint32Array(3*size-9*numberOfStrips);var indicesIndex=0;pointIndex=state.next;for(i=0;i<numberOfStrips;i++){// For each strip, read the first value, then record that many more points
  var indexCount=dataView.getInt32(pointIndex,false);var strip=[];pointIndex+=4;for(s=0;s<indexCount;s++){strip.push(dataView.getInt32(pointIndex,false));pointIndex+=4;}// divide the polygon in n-2 triangle
  for(var j=1;j<indexCount-1;j++){indices[indicesIndex++]=strip[0];indices[indicesIndex++]=strip[j];indices[indicesIndex++]=strip[j+1];}}// increment our next pointer
  state.next=state.next+count+1;}else if(line.indexOf('POINT_DATA')===0){numberOfPoints=parseInt(line.split(' ')[1],10);// Grab the next line
  state=findString(buffer,state.next);// Now grab the binary data
  count=numberOfPoints*4*3;normals=new Float32Array(numberOfPoints*3);pointIndex=state.next;for(i=0;i<numberOfPoints;i++){normals[3*i]=dataView.getFloat32(pointIndex,false);normals[3*i+1]=dataView.getFloat32(pointIndex+4,false);normals[3*i+2]=dataView.getFloat32(pointIndex+8,false);pointIndex+=12;}// Increment past our data
  state.next=state.next+count;}// Increment index
  index=state.next;if(index>=buffer.byteLength){break;}}var geometry=new BufferGeometry();geometry.setIndex(new BufferAttribute(indices,1));geometry.addAttribute('position',new BufferAttribute(points,3));if(normals.length===points.length){geometry.addAttribute('normal',new BufferAttribute(normals,3));}return geometry;}function Float32Concat(first,second){var firstLength=first.length,result=new Float32Array(firstLength+second.length);result.set(first);result.set(second,firstLength);return result;}function Int32Concat(first,second){var firstLength=first.length,result=new Int32Array(firstLength+second.length);result.set(first);result.set(second,firstLength);return result;}function parseXML(stringFile){// Changes XML to JSON, based on https://davidwalsh.name/convert-xml-json
  function xmlToJson(xml){// Create the return object
  var obj={};if(xml.nodeType===1){// element
  // do attributes
  if(xml.attributes){if(xml.attributes.length>0){obj['attributes']={};for(var j=0;j<xml.attributes.length;j++){var attribute=xml.attributes.item(j);obj['attributes'][attribute.nodeName]=attribute.nodeValue.trim();}}}}else if(xml.nodeType===3){// text
  obj=xml.nodeValue.trim();}// do children
  if(xml.hasChildNodes()){for(var i=0;i<xml.childNodes.length;i++){var item=xml.childNodes.item(i);var nodeName=item.nodeName;if(typeof obj[nodeName]==='undefined'){var tmp=xmlToJson(item);if(tmp!==''){obj[nodeName]=tmp;}}else{if(typeof obj[nodeName].push==='undefined'){var old=obj[nodeName];obj[nodeName]=[old];}var tmp=xmlToJson(item);if(tmp!==''){obj[nodeName].push(tmp);}}}}return obj;}// Taken from Base64-js
  function Base64toByteArray(b64){var Arr=typeof Uint8Array!=='undefined'?Uint8Array:Array;var i;var lookup=[];var revLookup=[];var code='ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/';var len=code.length;for(i=0;i<len;i++){lookup[i]=code[i];}for(i=0;i<len;++i){revLookup[code.charCodeAt(i)]=i;}revLookup['-'.charCodeAt(0)]=62;revLookup['_'.charCodeAt(0)]=63;var j,l,tmp,placeHolders,arr;var len=b64.length;if(len%4>0){throw new Error('Invalid string. Length must be a multiple of 4');}placeHolders=b64[len-2]==='='?2:b64[len-1]==='='?1:0;arr=new Arr(len*3/4-placeHolders);l=placeHolders>0?len-4:len;var L=0;for(i=0, j=0;i<l;i+=4, j+=3){tmp=revLookup[b64.charCodeAt(i)]<<18|revLookup[b64.charCodeAt(i+1)]<<12|revLookup[b64.charCodeAt(i+2)]<<6|revLookup[b64.charCodeAt(i+3)];arr[L++]=(tmp&0xFF0000)>>16;arr[L++]=(tmp&0xFF00)>>8;arr[L++]=tmp&0xFF;}if(placeHolders===2){tmp=revLookup[b64.charCodeAt(i)]<<2|revLookup[b64.charCodeAt(i+1)]>>4;arr[L++]=tmp&0xFF;}else if(placeHolders===1){tmp=revLookup[b64.charCodeAt(i)]<<10|revLookup[b64.charCodeAt(i+1)]<<4|revLookup[b64.charCodeAt(i+2)]>>2;arr[L++]=tmp>>8&0xFF;arr[L++]=tmp&0xFF;}return arr;}function parseDataArray(ele,compressed){var numBytes=0;if(json.attributes.header_type==='UInt64'){numBytes=8;}else if(json.attributes.header_type==='UInt32'){numBytes=4;}// Check the format
  if(ele.attributes.format==='binary'&&compressed){var rawData,content,byteData,blocks,cSizeStart,headerSize,padding,dataOffsets,currentOffset;if(ele.attributes.type==='Float32'){var txt=new Float32Array();}else if(ele.attributes.type==='Int64'){var txt=new Int32Array();}// VTP data with the header has the following structure:
  // [#blocks][#u-size][#p-size][#c-size-1][#c-size-2]...[#c-size-#blocks][DATA]
  //
  // Each token is an integer value whose type is specified by "header_type" at the top of the file (UInt32 if no type specified). The token meanings are:
  // [#blocks] = Number of blocks
  // [#u-size] = Block size before compression
  // [#p-size] = Size of last partial block (zero if it not needed)
  // [#c-size-i] = Size in bytes of block i after compression
  //
  // The [DATA] portion stores contiguously every block appended together. The offset from the beginning of the data section to the beginning of a block is
  // computed by summing the compressed block sizes from preceding blocks according to the header.
  rawData=ele['#text'];byteData=Base64toByteArray(rawData);blocks=byteData[0];for(var i=1;i<numBytes-1;i++){blocks=blocks|byteData[i]<<i*numBytes;}headerSize=(blocks+3)*numBytes;padding=headerSize%3>0?3-headerSize%3:0;headerSize=headerSize+padding;dataOffsets=[];currentOffset=headerSize;dataOffsets.push(currentOffset);// Get the blocks sizes after the compression.
  // There are three blocks before c-size-i, so we skip 3*numBytes
  cSizeStart=3*numBytes;for(var i=0;i<blocks;i++){var currentBlockSize=byteData[i*numBytes+cSizeStart];for(var j=1;j<numBytes-1;j++){// Each data point consists of 8 bytes regardless of the header type
  currentBlockSize=currentBlockSize|byteData[i*numBytes+cSizeStart+j]<<j*8;}currentOffset=currentOffset+currentBlockSize;dataOffsets.push(currentOffset);}for(var i=0;i<dataOffsets.length-1;i++){var inflate=new Zlib.Inflate(byteData.slice(dataOffsets[i],dataOffsets[i+1]),{resize:true,verify:true});// eslint-disable-line no-undef
  content=inflate.decompress();content=content.buffer;if(ele.attributes.type==='Float32'){content=new Float32Array(content);txt=Float32Concat(txt,content);}else if(ele.attributes.type==='Int64'){content=new Int32Array(content);txt=Int32Concat(txt,content);}}delete ele['#text'];// Get the content and optimize it
  if(ele.attributes.type==='Float32'){if(ele.attributes.format==='binary'){if(!compressed){txt=txt.filter(function(el,idx){if(idx!==0){return true;}});}}}else if(ele.attributes.type==='Int64'){if(ele.attributes.format==='binary'){if(!compressed){txt=txt.filter(function(el,idx){if(idx!==0){return true;}});}txt=txt.filter(function(el,idx){if(idx%2!==1){return true;}});}}}else{if(ele.attributes.format==='binary'&&!compressed){var content=Base64toByteArray(ele['#text']);//  VTP data for the uncompressed case has the following structure:
  // [#bytes][DATA]
  // where "[#bytes]" is an integer value specifying the number of bytes in the block of data following it.
  content=content.slice(numBytes).buffer;}else{if(ele['#text']){var content=ele['#text'].split(/\s+/).filter(function(el){if(el!==''){return el;}});}else{var content=new Int32Array(0).buffer;}}delete ele['#text'];// Get the content and optimize it
  if(ele.attributes.type==='Float32'){var txt=new Float32Array(content);}else if(ele.attributes.type==='Int32'){var txt=new Int32Array(content);}else if(ele.attributes.type==='Int64'){var txt=new Int32Array(content);if(ele.attributes.format==='binary'){txt=txt.filter(function(el,idx){if(idx%2!==1){return true;}});}}}// endif ( ele.attributes.format === 'binary' && compressed )
  return txt;}// Main part
  // Get Dom
  var dom=null;if(window.DOMParser){try{dom=new DOMParser().parseFromString(stringFile,'text/xml');}catch(e){dom=null;}}else if(window.ActiveXObject){try{dom=new ActiveXObject('Microsoft.XMLDOM');// eslint-disable-line no-undef
  dom.async=false;if(!dom.loadXML()){throw new Error(dom.parseError.reason+dom.parseError.srcText);}}catch(e){dom=null;}}else{throw new Error('Cannot parse xml string!');}// Get the doc
  var doc=dom.documentElement;// Convert to json
  var json=xmlToJson(doc);var points=[];var normals=[];var indices=[];if(json.PolyData){var piece=json.PolyData.Piece;var compressed=json.attributes.hasOwnProperty('compressor');// Can be optimized
  // Loop through the sections
  var sections=['PointData','Points','Strips','Polys'];// +['CellData', 'Verts', 'Lines'];
  var sectionIndex=0,numberOfSections=sections.length;while(sectionIndex<numberOfSections){var section=piece[sections[sectionIndex]];// If it has a DataArray in it
  if(section&&section.DataArray){// Depending on the number of DataArrays
  if(Object.prototype.toString.call(section.DataArray)==='[object Array]'){var arr=section.DataArray;}else{var arr=[section.DataArray];}var dataArrayIndex=0,numberOfDataArrays=arr.length;while(dataArrayIndex<numberOfDataArrays){// Parse the DataArray
  if('#text'in arr[dataArrayIndex]&&arr[dataArrayIndex]['#text'].length>0){arr[dataArrayIndex].text=parseDataArray(arr[dataArrayIndex],compressed);}dataArrayIndex++;}switch(sections[sectionIndex]){// if iti is point data
  case'PointData':var numberOfPoints=parseInt(piece.attributes.NumberOfPoints);var normalsName=section.attributes.Normals;if(numberOfPoints>0){for(var i=0,len=arr.length;i<len;i++){if(normalsName===arr[i].attributes.Name){var components=arr[i].attributes.NumberOfComponents;normals=new Float32Array(numberOfPoints*components);normals.set(arr[i].text,0);}}}break;// if it is points
  case'Points':var numberOfPoints=parseInt(piece.attributes.NumberOfPoints);if(numberOfPoints>0){var components=section.DataArray.attributes.NumberOfComponents;points=new Float32Array(numberOfPoints*components);points.set(section.DataArray.text,0);}break;// if it is strips
  case'Strips':var numberOfStrips=parseInt(piece.attributes.NumberOfStrips);if(numberOfStrips>0){var connectivity=new Int32Array(section.DataArray[0].text.length);var offset=new Int32Array(section.DataArray[1].text.length);connectivity.set(section.DataArray[0].text,0);offset.set(section.DataArray[1].text,0);var size=numberOfStrips+connectivity.length;indices=new Uint32Array(3*size-9*numberOfStrips);var indicesIndex=0;for(var i=0,len=numberOfStrips;i<len;i++){var strip=[];for(var s=0,len1=offset[i],len0=0;s<len1-len0;s++){strip.push(connectivity[s]);if(i>0){len0=offset[i-1];}}for(var j=0,len1=offset[i],len0=0;j<len1-len0-2;j++){if(j%2){indices[indicesIndex++]=strip[j];indices[indicesIndex++]=strip[j+2];indices[indicesIndex++]=strip[j+1];}else{indices[indicesIndex++]=strip[j];indices[indicesIndex++]=strip[j+1];indices[indicesIndex++]=strip[j+2];}if(i>0){len0=offset[i-1];}}}}break;// if it is polys
  case'Polys':var numberOfPolys=parseInt(piece.attributes.NumberOfPolys);if(numberOfPolys>0){var connectivity=new Int32Array(section.DataArray[0].text.length);var offset=new Int32Array(section.DataArray[1].text.length);connectivity.set(section.DataArray[0].text,0);offset.set(section.DataArray[1].text,0);var size=numberOfPolys+connectivity.length;indices=new Uint32Array(3*size-9*numberOfPolys);var indicesIndex=0,connectivityIndex=0;var i=0,len=numberOfPolys,len0=0;while(i<len){var poly=[];var s=0,len1=offset[i];while(s<len1-len0){poly.push(connectivity[connectivityIndex++]);s++;}var j=1;while(j<len1-len0-1){indices[indicesIndex++]=poly[0];indices[indicesIndex++]=poly[j];indices[indicesIndex++]=poly[j+1];j++;}i++;len0=offset[i-1];}}break;default:break;}}sectionIndex++;}var geometry=new BufferGeometry();geometry.setIndex(new BufferAttribute(indices,1));geometry.addAttribute('position',new BufferAttribute(points,3));if(normals.length===points.length){geometry.addAttribute('normal',new BufferAttribute(normals,3));}return geometry;}else{// TODO for vtu,vti,and other xml formats
  }}function getStringFile(data){var stringFile='';var charArray=new Uint8Array(data);var i=0;var len=charArray.length;while(len--){stringFile+=String.fromCharCode(charArray[i++]);}return stringFile;}// get the 5 first lines of the files to check if there is the key word binary
  var meta=LoaderUtils.decodeText(new Uint8Array(data,0,250)).split('\n');if(meta[0].indexOf('xml')!==-1){return parseXML(getStringFile(data));}else if(meta[2].includes('ASCII')){return parseASCII(getStringFile(data));}else{return parseBinary(data);}}});/**
   * @author alteredq / http://alteredqualia.com/
   */function ImmediateRenderObject(material){Object3D.call(this);this.material=material;this.render=function()/* renderCallback */{};}ImmediateRenderObject.prototype=Object.create(Object3D.prototype);ImmediateRenderObject.prototype.constructor=ImmediateRenderObject;ImmediateRenderObject.prototype.isImmediateRenderObject=true;/**
   * @author alteredq / http://alteredqualia.com/
   * @author mrdoob / http://mrdoob.com
   * Port of http://webglsamples.org/blob/blob.html
   */var MarchingCubes=function MarchingCubes(resolution,material,enableUvs,enableColors){ImmediateRenderObject.call(this,material);var scope=this;// temp buffers used in polygonize
  var vlist=new Float32Array(12*3);var nlist=new Float32Array(12*3);this.enableUvs=enableUvs!==undefined?enableUvs:false;this.enableColors=enableColors!==undefined?enableColors:false;// functions have to be object properties
  // prototype functions kill performance
  // (tested and it was 4x slower !!!)
  this.init=function(resolution){this.resolution=resolution;// parameters
  this.isolation=80.0;// size of field, 32 is pushing it in Javascript :)
  this.size=resolution;this.size2=this.size*this.size;this.size3=this.size2*this.size;this.halfsize=this.size/2.0;// deltas
  this.delta=2.0/this.size;this.yd=this.size;this.zd=this.size2;this.field=new Float32Array(this.size3);this.normal_cache=new Float32Array(this.size3*3);// immediate render mode simulator
  this.maxCount=4096;// TODO: find the fastest size for this buffer
  this.count=0;this.hasPositions=false;this.hasNormals=false;this.hasColors=false;this.hasUvs=false;this.positionArray=new Float32Array(this.maxCount*3);this.normalArray=new Float32Array(this.maxCount*3);if(this.enableUvs){this.uvArray=new Float32Array(this.maxCount*2);}if(this.enableColors){this.colorArray=new Float32Array(this.maxCount*3);}};///////////////////////
  // Polygonization
  ///////////////////////
  function lerp(a,b,t){return a+(b-a)*t;}function VIntX(q,offset,isol,x,y,z,valp1,valp2){var mu=(isol-valp1)/(valp2-valp1),nc=scope.normal_cache;vlist[offset+0]=x+mu*scope.delta;vlist[offset+1]=y;vlist[offset+2]=z;nlist[offset+0]=lerp(nc[q+0],nc[q+3],mu);nlist[offset+1]=lerp(nc[q+1],nc[q+4],mu);nlist[offset+2]=lerp(nc[q+2],nc[q+5],mu);}function VIntY(q,offset,isol,x,y,z,valp1,valp2){var mu=(isol-valp1)/(valp2-valp1),nc=scope.normal_cache;vlist[offset+0]=x;vlist[offset+1]=y+mu*scope.delta;vlist[offset+2]=z;var q2=q+scope.yd*3;nlist[offset+0]=lerp(nc[q+0],nc[q2+0],mu);nlist[offset+1]=lerp(nc[q+1],nc[q2+1],mu);nlist[offset+2]=lerp(nc[q+2],nc[q2+2],mu);}function VIntZ(q,offset,isol,x,y,z,valp1,valp2){var mu=(isol-valp1)/(valp2-valp1),nc=scope.normal_cache;vlist[offset+0]=x;vlist[offset+1]=y;vlist[offset+2]=z+mu*scope.delta;var q2=q+scope.zd*3;nlist[offset+0]=lerp(nc[q+0],nc[q2+0],mu);nlist[offset+1]=lerp(nc[q+1],nc[q2+1],mu);nlist[offset+2]=lerp(nc[q+2],nc[q2+2],mu);}function compNorm(q){var q3=q*3;if(scope.normal_cache[q3]===0.0){scope.normal_cache[q3+0]=scope.field[q-1]-scope.field[q+1];scope.normal_cache[q3+1]=scope.field[q-scope.yd]-scope.field[q+scope.yd];scope.normal_cache[q3+2]=scope.field[q-scope.zd]-scope.field[q+scope.zd];}}// Returns total number of triangles. Fills triangles.
  // (this is where most of time is spent - it's inner work of O(n3) loop )
  function polygonize(fx,fy,fz,q,isol,renderCallback){// cache indices
  var q1=q+1,qy=q+scope.yd,qz=q+scope.zd,q1y=q1+scope.yd,q1z=q1+scope.zd,qyz=q+scope.yd+scope.zd,q1yz=q1+scope.yd+scope.zd;var cubeindex=0,field0=scope.field[q],field1=scope.field[q1],field2=scope.field[qy],field3=scope.field[q1y],field4=scope.field[qz],field5=scope.field[q1z],field6=scope.field[qyz],field7=scope.field[q1yz];if(field0<isol){cubeindex|=1;}if(field1<isol){cubeindex|=2;}if(field2<isol){cubeindex|=8;}if(field3<isol){cubeindex|=4;}if(field4<isol){cubeindex|=16;}if(field5<isol){cubeindex|=32;}if(field6<isol){cubeindex|=128;}if(field7<isol){cubeindex|=64;}// if cube is entirely in/out of the surface - bail, nothing to draw
  var bits=edgeTable[cubeindex];if(bits===0){return 0;}var d=scope.delta,fx2=fx+d,fy2=fy+d,fz2=fz+d;// top of the cube
  if(bits&1){compNorm(q);compNorm(q1);VIntX(q*3,0,isol,fx,fy,fz,field0,field1);}if(bits&2){compNorm(q1);compNorm(q1y);VIntY(q1*3,3,isol,fx2,fy,fz,field1,field3);}if(bits&4){compNorm(qy);compNorm(q1y);VIntX(qy*3,6,isol,fx,fy2,fz,field2,field3);}if(bits&8){compNorm(q);compNorm(qy);VIntY(q*3,9,isol,fx,fy,fz,field0,field2);}// bottom of the cube
  if(bits&16){compNorm(qz);compNorm(q1z);VIntX(qz*3,12,isol,fx,fy,fz2,field4,field5);}if(bits&32){compNorm(q1z);compNorm(q1yz);VIntY(q1z*3,15,isol,fx2,fy,fz2,field5,field7);}if(bits&64){compNorm(qyz);compNorm(q1yz);VIntX(qyz*3,18,isol,fx,fy2,fz2,field6,field7);}if(bits&128){compNorm(qz);compNorm(qyz);VIntY(qz*3,21,isol,fx,fy,fz2,field4,field6);}// vertical lines of the cube
  if(bits&256){compNorm(q);compNorm(qz);VIntZ(q*3,24,isol,fx,fy,fz,field0,field4);}if(bits&512){compNorm(q1);compNorm(q1z);VIntZ(q1*3,27,isol,fx2,fy,fz,field1,field5);}if(bits&1024){compNorm(q1y);compNorm(q1yz);VIntZ(q1y*3,30,isol,fx2,fy2,fz,field3,field7);}if(bits&2048){compNorm(qy);compNorm(qyz);VIntZ(qy*3,33,isol,fx,fy2,fz,field2,field6);}cubeindex<<=4;// re-purpose cubeindex into an offset into triTable
  var o1,o2,o3,numtris=0,i=0;// here is where triangles are created
  while(triTable[cubeindex+i]!=-1){o1=cubeindex+i;o2=o1+1;o3=o1+2;posnormtriv(vlist,nlist,3*triTable[o1],3*triTable[o2],3*triTable[o3],renderCallback);i+=3;numtris++;}return numtris;}/////////////////////////////////////
  // Immediate render mode simulator
  /////////////////////////////////////
  function posnormtriv(pos,norm,o1,o2,o3,renderCallback){var c=scope.count*3;// positions
  scope.positionArray[c+0]=pos[o1];scope.positionArray[c+1]=pos[o1+1];scope.positionArray[c+2]=pos[o1+2];scope.positionArray[c+3]=pos[o2];scope.positionArray[c+4]=pos[o2+1];scope.positionArray[c+5]=pos[o2+2];scope.positionArray[c+6]=pos[o3];scope.positionArray[c+7]=pos[o3+1];scope.positionArray[c+8]=pos[o3+2];// normals
  scope.normalArray[c+0]=norm[o1];scope.normalArray[c+1]=norm[o1+1];scope.normalArray[c+2]=norm[o1+2];scope.normalArray[c+3]=norm[o2];scope.normalArray[c+4]=norm[o2+1];scope.normalArray[c+5]=norm[o2+2];scope.normalArray[c+6]=norm[o3];scope.normalArray[c+7]=norm[o3+1];scope.normalArray[c+8]=norm[o3+2];// uvs
  if(scope.enableUvs){var d=scope.count*2;scope.uvArray[d+0]=pos[o1];scope.uvArray[d+1]=pos[o1+2];scope.uvArray[d+2]=pos[o2];scope.uvArray[d+3]=pos[o2+2];scope.uvArray[d+4]=pos[o3];scope.uvArray[d+5]=pos[o3+2];}// colors
  if(scope.enableColors){scope.colorArray[c+0]=pos[o1];scope.colorArray[c+1]=pos[o1+1];scope.colorArray[c+2]=pos[o1+2];scope.colorArray[c+3]=pos[o2];scope.colorArray[c+4]=pos[o2+1];scope.colorArray[c+5]=pos[o2+2];scope.colorArray[c+6]=pos[o3];scope.colorArray[c+7]=pos[o3+1];scope.colorArray[c+8]=pos[o3+2];}scope.count+=3;if(scope.count>=scope.maxCount-3){scope.hasPositions=true;scope.hasNormals=true;if(scope.enableUvs){scope.hasUvs=true;}if(scope.enableColors){scope.hasColors=true;}renderCallback(scope);}}this.begin=function(){this.count=0;this.hasPositions=false;this.hasNormals=false;this.hasUvs=false;this.hasColors=false;};this.end=function(renderCallback){var this$1=this;if(this.count===0){return;}for(var i=this.count*3;i<this.positionArray.length;i++){this$1.positionArray[i]=0.0;}this.hasPositions=true;this.hasNormals=true;if(this.enableUvs){this.hasUvs=true;}if(this.enableColors){this.hasColors=true;}renderCallback(this);};/////////////////////////////////////
  // Metaballs
  /////////////////////////////////////
  // Adds a reciprocal ball (nice and blobby) that, to be fast, fades to zero after
  // a fixed distance, determined by strength and subtract.
  this.addBall=function(ballx,bally,ballz,strength,subtract){var this$1=this;var sign=Math.sign(strength);strength=Math.abs(strength);// Let's solve the equation to find the radius:
  // 1.0 / (0.000001 + radius^2) * strength - subtract = 0
  // strength / (radius^2) = subtract
  // strength = subtract * radius^2
  // radius^2 = strength / subtract
  // radius = sqrt(strength / subtract)
  var radius=this.size*Math.sqrt(strength/subtract),zs=ballz*this.size,ys=bally*this.size,xs=ballx*this.size;var min_z=Math.floor(zs-radius);if(min_z<1){min_z=1;}var max_z=Math.floor(zs+radius);if(max_z>this.size-1){max_z=this.size-1;}var min_y=Math.floor(ys-radius);if(min_y<1){min_y=1;}var max_y=Math.floor(ys+radius);if(max_y>this.size-1){max_y=this.size-1;}var min_x=Math.floor(xs-radius);if(min_x<1){min_x=1;}var max_x=Math.floor(xs+radius);if(max_x>this.size-1){max_x=this.size-1;}// Don't polygonize in the outer layer because normals aren't
  // well-defined there.
  var x,y,z,y_offset,z_offset,fx,fy,fz,fz2,fy2,val;for(z=min_z;z<max_z;z++){z_offset=this$1.size2*z;fz=z/this$1.size-ballz;fz2=fz*fz;for(y=min_y;y<max_y;y++){y_offset=z_offset+this$1.size*y;fy=y/this$1.size-bally;fy2=fy*fy;for(x=min_x;x<max_x;x++){fx=x/this$1.size-ballx;val=strength/(0.000001+fx*fx+fy2+fz2)-subtract;if(val>0.0){this$1.field[y_offset+x]+=val*sign;}}}}};this.addPlaneX=function(strength,subtract){var x,y,z,xx,val,xdiv,cxy,// cache attribute lookups
  size=this.size,yd=this.yd,zd=this.zd,field=this.field,dist=size*Math.sqrt(strength/subtract);if(dist>size){dist=size;}for(x=0;x<dist;x++){xdiv=x/size;xx=xdiv*xdiv;val=strength/(0.0001+xx)-subtract;if(val>0.0){for(y=0;y<size;y++){cxy=x+y*yd;for(z=0;z<size;z++){field[zd*z+cxy]+=val;}}}}};this.addPlaneY=function(strength,subtract){var x,y,z,yy,val,ydiv,cy,cxy,// cache attribute lookups
  size=this.size,yd=this.yd,zd=this.zd,field=this.field,dist=size*Math.sqrt(strength/subtract);if(dist>size){dist=size;}for(y=0;y<dist;y++){ydiv=y/size;yy=ydiv*ydiv;val=strength/(0.0001+yy)-subtract;if(val>0.0){cy=y*yd;for(x=0;x<size;x++){cxy=cy+x;for(z=0;z<size;z++){field[zd*z+cxy]+=val;}}}}};this.addPlaneZ=function(strength,subtract){var x,y,z,zz,val,zdiv,cz,cyz,// cache attribute lookups
  size=this.size,yd=this.yd,zd=this.zd,field=this.field,dist=size*Math.sqrt(strength/subtract);if(dist>size){dist=size;}for(z=0;z<dist;z++){zdiv=z/size;zz=zdiv*zdiv;val=strength/(0.0001+zz)-subtract;if(val>0.0){cz=zd*z;for(y=0;y<size;y++){cyz=cz+y*yd;for(x=0;x<size;x++){field[cyz+x]+=val;}}}}};/////////////////////////////////////
  // Updates
  /////////////////////////////////////
  this.reset=function(){var this$1=this;var i;// wipe the normal cache
  for(i=0;i<this.size3;i++){this$1.normal_cache[i*3]=0.0;this$1.field[i]=0.0;}};this.render=function(renderCallback){var this$1=this;this.begin();// Triangulate. Yeah, this is slow.
  var smin2=this.size-2;for(var z=1;z<smin2;z++){var z_offset=this$1.size2*z;var fz=(z-this$1.halfsize)/this$1.halfsize;//+ 1
  for(var y=1;y<smin2;y++){var y_offset=z_offset+this$1.size*y;var fy=(y-this$1.halfsize)/this$1.halfsize;//+ 1
  for(var x=1;x<smin2;x++){var fx=(x-this$1.halfsize)/this$1.halfsize;//+ 1
  var q=y_offset+x;polygonize(fx,fy,fz,q,this$1.isolation,renderCallback);}}}this.end(renderCallback);};this.generateGeometry=function(){var start=0,geo=new Geometry();var normals=[];var geo_callback=function geo_callback(object){for(var i=0;i<object.count;i++){var vertex=new Vector3$1().fromArray(object.positionArray,i*3);var normal=new Vector3$1().fromArray(object.normalArray,i*3);geo.vertices.push(vertex);normals.push(normal);}var nfaces=object.count/3;for(i=0;i<nfaces;i++){var a=(start+i)*3;var b=a+1;var c=a+2;var na=normals[a];var nb=normals[b];var nc=normals[c];var face=new Face3$1(a,b,c,[na,nb,nc]);geo.faces.push(face);}start+=nfaces;object.count=0;};this.render(geo_callback);// console.log( "generated " + geo.faces.length + " triangles" );
  return geo;};this.init(resolution);};MarchingCubes.prototype=Object.create(ImmediateRenderObject.prototype);MarchingCubes.prototype.constructor=MarchingCubes;/////////////////////////////////////
  // Marching cubes lookup tables
  /////////////////////////////////////
  // These tables are straight from Paul Bourke's page:
  // http://local.wasp.uwa.edu.au/~pbourke/geometry/polygonise/
  // who in turn got them from Cory Gene Bloyd.
  var edgeTable=new Int32Array([0x0,0x109,0x203,0x30a,0x406,0x50f,0x605,0x70c,0x80c,0x905,0xa0f,0xb06,0xc0a,0xd03,0xe09,0xf00,0x190,0x99,0x393,0x29a,0x596,0x49f,0x795,0x69c,0x99c,0x895,0xb9f,0xa96,0xd9a,0xc93,0xf99,0xe90,0x230,0x339,0x33,0x13a,0x636,0x73f,0x435,0x53c,0xa3c,0xb35,0x83f,0x936,0xe3a,0xf33,0xc39,0xd30,0x3a0,0x2a9,0x1a3,0xaa,0x7a6,0x6af,0x5a5,0x4ac,0xbac,0xaa5,0x9af,0x8a6,0xfaa,0xea3,0xda9,0xca0,0x460,0x569,0x663,0x76a,0x66,0x16f,0x265,0x36c,0xc6c,0xd65,0xe6f,0xf66,0x86a,0x963,0xa69,0xb60,0x5f0,0x4f9,0x7f3,0x6fa,0x1f6,0xff,0x3f5,0x2fc,0xdfc,0xcf5,0xfff,0xef6,0x9fa,0x8f3,0xbf9,0xaf0,0x650,0x759,0x453,0x55a,0x256,0x35f,0x55,0x15c,0xe5c,0xf55,0xc5f,0xd56,0xa5a,0xb53,0x859,0x950,0x7c0,0x6c9,0x5c3,0x4ca,0x3c6,0x2cf,0x1c5,0xcc,0xfcc,0xec5,0xdcf,0xcc6,0xbca,0xac3,0x9c9,0x8c0,0x8c0,0x9c9,0xac3,0xbca,0xcc6,0xdcf,0xec5,0xfcc,0xcc,0x1c5,0x2cf,0x3c6,0x4ca,0x5c3,0x6c9,0x7c0,0x950,0x859,0xb53,0xa5a,0xd56,0xc5f,0xf55,0xe5c,0x15c,0x55,0x35f,0x256,0x55a,0x453,0x759,0x650,0xaf0,0xbf9,0x8f3,0x9fa,0xef6,0xfff,0xcf5,0xdfc,0x2fc,0x3f5,0xff,0x1f6,0x6fa,0x7f3,0x4f9,0x5f0,0xb60,0xa69,0x963,0x86a,0xf66,0xe6f,0xd65,0xc6c,0x36c,0x265,0x16f,0x66,0x76a,0x663,0x569,0x460,0xca0,0xda9,0xea3,0xfaa,0x8a6,0x9af,0xaa5,0xbac,0x4ac,0x5a5,0x6af,0x7a6,0xaa,0x1a3,0x2a9,0x3a0,0xd30,0xc39,0xf33,0xe3a,0x936,0x83f,0xb35,0xa3c,0x53c,0x435,0x73f,0x636,0x13a,0x33,0x339,0x230,0xe90,0xf99,0xc93,0xd9a,0xa96,0xb9f,0x895,0x99c,0x69c,0x795,0x49f,0x596,0x29a,0x393,0x99,0x190,0xf00,0xe09,0xd03,0xc0a,0xb06,0xa0f,0x905,0x80c,0x70c,0x605,0x50f,0x406,0x30a,0x203,0x109,0x0]);var triTable=new Int32Array([-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,8,3,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,1,9,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,1,8,3,9,8,1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,1,2,10,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,8,3,1,2,10,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,9,2,10,0,2,9,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,2,8,3,2,10,8,10,9,8,-1,-1,-1,-1,-1,-1,-1,3,11,2,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,11,2,8,11,0,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,1,9,0,2,3,11,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,1,11,2,1,9,11,9,8,11,-1,-1,-1,-1,-1,-1,-1,3,10,1,11,10,3,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,10,1,0,8,10,8,11,10,-1,-1,-1,-1,-1,-1,-1,3,9,0,3,11,9,11,10,9,-1,-1,-1,-1,-1,-1,-1,9,8,10,10,8,11,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,4,7,8,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,4,3,0,7,3,4,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,1,9,8,4,7,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,4,1,9,4,7,1,7,3,1,-1,-1,-1,-1,-1,-1,-1,1,2,10,8,4,7,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,3,4,7,3,0,4,1,2,10,-1,-1,-1,-1,-1,-1,-1,9,2,10,9,0,2,8,4,7,-1,-1,-1,-1,-1,-1,-1,2,10,9,2,9,7,2,7,3,7,9,4,-1,-1,-1,-1,8,4,7,3,11,2,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,11,4,7,11,2,4,2,0,4,-1,-1,-1,-1,-1,-1,-1,9,0,1,8,4,7,2,3,11,-1,-1,-1,-1,-1,-1,-1,4,7,11,9,4,11,9,11,2,9,2,1,-1,-1,-1,-1,3,10,1,3,11,10,7,8,4,-1,-1,-1,-1,-1,-1,-1,1,11,10,1,4,11,1,0,4,7,11,4,-1,-1,-1,-1,4,7,8,9,0,11,9,11,10,11,0,3,-1,-1,-1,-1,4,7,11,4,11,9,9,11,10,-1,-1,-1,-1,-1,-1,-1,9,5,4,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,9,5,4,0,8,3,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,5,4,1,5,0,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,8,5,4,8,3,5,3,1,5,-1,-1,-1,-1,-1,-1,-1,1,2,10,9,5,4,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,3,0,8,1,2,10,4,9,5,-1,-1,-1,-1,-1,-1,-1,5,2,10,5,4,2,4,0,2,-1,-1,-1,-1,-1,-1,-1,2,10,5,3,2,5,3,5,4,3,4,8,-1,-1,-1,-1,9,5,4,2,3,11,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,11,2,0,8,11,4,9,5,-1,-1,-1,-1,-1,-1,-1,0,5,4,0,1,5,2,3,11,-1,-1,-1,-1,-1,-1,-1,2,1,5,2,5,8,2,8,11,4,8,5,-1,-1,-1,-1,10,3,11,10,1,3,9,5,4,-1,-1,-1,-1,-1,-1,-1,4,9,5,0,8,1,8,10,1,8,11,10,-1,-1,-1,-1,5,4,0,5,0,11,5,11,10,11,0,3,-1,-1,-1,-1,5,4,8,5,8,10,10,8,11,-1,-1,-1,-1,-1,-1,-1,9,7,8,5,7,9,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,9,3,0,9,5,3,5,7,3,-1,-1,-1,-1,-1,-1,-1,0,7,8,0,1,7,1,5,7,-1,-1,-1,-1,-1,-1,-1,1,5,3,3,5,7,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,9,7,8,9,5,7,10,1,2,-1,-1,-1,-1,-1,-1,-1,10,1,2,9,5,0,5,3,0,5,7,3,-1,-1,-1,-1,8,0,2,8,2,5,8,5,7,10,5,2,-1,-1,-1,-1,2,10,5,2,5,3,3,5,7,-1,-1,-1,-1,-1,-1,-1,7,9,5,7,8,9,3,11,2,-1,-1,-1,-1,-1,-1,-1,9,5,7,9,7,2,9,2,0,2,7,11,-1,-1,-1,-1,2,3,11,0,1,8,1,7,8,1,5,7,-1,-1,-1,-1,11,2,1,11,1,7,7,1,5,-1,-1,-1,-1,-1,-1,-1,9,5,8,8,5,7,10,1,3,10,3,11,-1,-1,-1,-1,5,7,0,5,0,9,7,11,0,1,0,10,11,10,0,-1,11,10,0,11,0,3,10,5,0,8,0,7,5,7,0,-1,11,10,5,7,11,5,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,10,6,5,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,8,3,5,10,6,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,9,0,1,5,10,6,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,1,8,3,1,9,8,5,10,6,-1,-1,-1,-1,-1,-1,-1,1,6,5,2,6,1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,1,6,5,1,2,6,3,0,8,-1,-1,-1,-1,-1,-1,-1,9,6,5,9,0,6,0,2,6,-1,-1,-1,-1,-1,-1,-1,5,9,8,5,8,2,5,2,6,3,2,8,-1,-1,-1,-1,2,3,11,10,6,5,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,11,0,8,11,2,0,10,6,5,-1,-1,-1,-1,-1,-1,-1,0,1,9,2,3,11,5,10,6,-1,-1,-1,-1,-1,-1,-1,5,10,6,1,9,2,9,11,2,9,8,11,-1,-1,-1,-1,6,3,11,6,5,3,5,1,3,-1,-1,-1,-1,-1,-1,-1,0,8,11,0,11,5,0,5,1,5,11,6,-1,-1,-1,-1,3,11,6,0,3,6,0,6,5,0,5,9,-1,-1,-1,-1,6,5,9,6,9,11,11,9,8,-1,-1,-1,-1,-1,-1,-1,5,10,6,4,7,8,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,4,3,0,4,7,3,6,5,10,-1,-1,-1,-1,-1,-1,-1,1,9,0,5,10,6,8,4,7,-1,-1,-1,-1,-1,-1,-1,10,6,5,1,9,7,1,7,3,7,9,4,-1,-1,-1,-1,6,1,2,6,5,1,4,7,8,-1,-1,-1,-1,-1,-1,-1,1,2,5,5,2,6,3,0,4,3,4,7,-1,-1,-1,-1,8,4,7,9,0,5,0,6,5,0,2,6,-1,-1,-1,-1,7,3,9,7,9,4,3,2,9,5,9,6,2,6,9,-1,3,11,2,7,8,4,10,6,5,-1,-1,-1,-1,-1,-1,-1,5,10,6,4,7,2,4,2,0,2,7,11,-1,-1,-1,-1,0,1,9,4,7,8,2,3,11,5,10,6,-1,-1,-1,-1,9,2,1,9,11,2,9,4,11,7,11,4,5,10,6,-1,8,4,7,3,11,5,3,5,1,5,11,6,-1,-1,-1,-1,5,1,11,5,11,6,1,0,11,7,11,4,0,4,11,-1,0,5,9,0,6,5,0,3,6,11,6,3,8,4,7,-1,6,5,9,6,9,11,4,7,9,7,11,9,-1,-1,-1,-1,10,4,9,6,4,10,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,4,10,6,4,9,10,0,8,3,-1,-1,-1,-1,-1,-1,-1,10,0,1,10,6,0,6,4,0,-1,-1,-1,-1,-1,-1,-1,8,3,1,8,1,6,8,6,4,6,1,10,-1,-1,-1,-1,1,4,9,1,2,4,2,6,4,-1,-1,-1,-1,-1,-1,-1,3,0,8,1,2,9,2,4,9,2,6,4,-1,-1,-1,-1,0,2,4,4,2,6,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,8,3,2,8,2,4,4,2,6,-1,-1,-1,-1,-1,-1,-1,10,4,9,10,6,4,11,2,3,-1,-1,-1,-1,-1,-1,-1,0,8,2,2,8,11,4,9,10,4,10,6,-1,-1,-1,-1,3,11,2,0,1,6,0,6,4,6,1,10,-1,-1,-1,-1,6,4,1,6,1,10,4,8,1,2,1,11,8,11,1,-1,9,6,4,9,3,6,9,1,3,11,6,3,-1,-1,-1,-1,8,11,1,8,1,0,11,6,1,9,1,4,6,4,1,-1,3,11,6,3,6,0,0,6,4,-1,-1,-1,-1,-1,-1,-1,6,4,8,11,6,8,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,7,10,6,7,8,10,8,9,10,-1,-1,-1,-1,-1,-1,-1,0,7,3,0,10,7,0,9,10,6,7,10,-1,-1,-1,-1,10,6,7,1,10,7,1,7,8,1,8,0,-1,-1,-1,-1,10,6,7,10,7,1,1,7,3,-1,-1,-1,-1,-1,-1,-1,1,2,6,1,6,8,1,8,9,8,6,7,-1,-1,-1,-1,2,6,9,2,9,1,6,7,9,0,9,3,7,3,9,-1,7,8,0,7,0,6,6,0,2,-1,-1,-1,-1,-1,-1,-1,7,3,2,6,7,2,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,2,3,11,10,6,8,10,8,9,8,6,7,-1,-1,-1,-1,2,0,7,2,7,11,0,9,7,6,7,10,9,10,7,-1,1,8,0,1,7,8,1,10,7,6,7,10,2,3,11,-1,11,2,1,11,1,7,10,6,1,6,7,1,-1,-1,-1,-1,8,9,6,8,6,7,9,1,6,11,6,3,1,3,6,-1,0,9,1,11,6,7,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,7,8,0,7,0,6,3,11,0,11,6,0,-1,-1,-1,-1,7,11,6,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,7,6,11,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,3,0,8,11,7,6,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,1,9,11,7,6,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,8,1,9,8,3,1,11,7,6,-1,-1,-1,-1,-1,-1,-1,10,1,2,6,11,7,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,1,2,10,3,0,8,6,11,7,-1,-1,-1,-1,-1,-1,-1,2,9,0,2,10,9,6,11,7,-1,-1,-1,-1,-1,-1,-1,6,11,7,2,10,3,10,8,3,10,9,8,-1,-1,-1,-1,7,2,3,6,2,7,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,7,0,8,7,6,0,6,2,0,-1,-1,-1,-1,-1,-1,-1,2,7,6,2,3,7,0,1,9,-1,-1,-1,-1,-1,-1,-1,1,6,2,1,8,6,1,9,8,8,7,6,-1,-1,-1,-1,10,7,6,10,1,7,1,3,7,-1,-1,-1,-1,-1,-1,-1,10,7,6,1,7,10,1,8,7,1,0,8,-1,-1,-1,-1,0,3,7,0,7,10,0,10,9,6,10,7,-1,-1,-1,-1,7,6,10,7,10,8,8,10,9,-1,-1,-1,-1,-1,-1,-1,6,8,4,11,8,6,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,3,6,11,3,0,6,0,4,6,-1,-1,-1,-1,-1,-1,-1,8,6,11,8,4,6,9,0,1,-1,-1,-1,-1,-1,-1,-1,9,4,6,9,6,3,9,3,1,11,3,6,-1,-1,-1,-1,6,8,4,6,11,8,2,10,1,-1,-1,-1,-1,-1,-1,-1,1,2,10,3,0,11,0,6,11,0,4,6,-1,-1,-1,-1,4,11,8,4,6,11,0,2,9,2,10,9,-1,-1,-1,-1,10,9,3,10,3,2,9,4,3,11,3,6,4,6,3,-1,8,2,3,8,4,2,4,6,2,-1,-1,-1,-1,-1,-1,-1,0,4,2,4,6,2,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,1,9,0,2,3,4,2,4,6,4,3,8,-1,-1,-1,-1,1,9,4,1,4,2,2,4,6,-1,-1,-1,-1,-1,-1,-1,8,1,3,8,6,1,8,4,6,6,10,1,-1,-1,-1,-1,10,1,0,10,0,6,6,0,4,-1,-1,-1,-1,-1,-1,-1,4,6,3,4,3,8,6,10,3,0,3,9,10,9,3,-1,10,9,4,6,10,4,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,4,9,5,7,6,11,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,8,3,4,9,5,11,7,6,-1,-1,-1,-1,-1,-1,-1,5,0,1,5,4,0,7,6,11,-1,-1,-1,-1,-1,-1,-1,11,7,6,8,3,4,3,5,4,3,1,5,-1,-1,-1,-1,9,5,4,10,1,2,7,6,11,-1,-1,-1,-1,-1,-1,-1,6,11,7,1,2,10,0,8,3,4,9,5,-1,-1,-1,-1,7,6,11,5,4,10,4,2,10,4,0,2,-1,-1,-1,-1,3,4,8,3,5,4,3,2,5,10,5,2,11,7,6,-1,7,2,3,7,6,2,5,4,9,-1,-1,-1,-1,-1,-1,-1,9,5,4,0,8,6,0,6,2,6,8,7,-1,-1,-1,-1,3,6,2,3,7,6,1,5,0,5,4,0,-1,-1,-1,-1,6,2,8,6,8,7,2,1,8,4,8,5,1,5,8,-1,9,5,4,10,1,6,1,7,6,1,3,7,-1,-1,-1,-1,1,6,10,1,7,6,1,0,7,8,7,0,9,5,4,-1,4,0,10,4,10,5,0,3,10,6,10,7,3,7,10,-1,7,6,10,7,10,8,5,4,10,4,8,10,-1,-1,-1,-1,6,9,5,6,11,9,11,8,9,-1,-1,-1,-1,-1,-1,-1,3,6,11,0,6,3,0,5,6,0,9,5,-1,-1,-1,-1,0,11,8,0,5,11,0,1,5,5,6,11,-1,-1,-1,-1,6,11,3,6,3,5,5,3,1,-1,-1,-1,-1,-1,-1,-1,1,2,10,9,5,11,9,11,8,11,5,6,-1,-1,-1,-1,0,11,3,0,6,11,0,9,6,5,6,9,1,2,10,-1,11,8,5,11,5,6,8,0,5,10,5,2,0,2,5,-1,6,11,3,6,3,5,2,10,3,10,5,3,-1,-1,-1,-1,5,8,9,5,2,8,5,6,2,3,8,2,-1,-1,-1,-1,9,5,6,9,6,0,0,6,2,-1,-1,-1,-1,-1,-1,-1,1,5,8,1,8,0,5,6,8,3,8,2,6,2,8,-1,1,5,6,2,1,6,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,1,3,6,1,6,10,3,8,6,5,6,9,8,9,6,-1,10,1,0,10,0,6,9,5,0,5,6,0,-1,-1,-1,-1,0,3,8,5,6,10,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,10,5,6,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,11,5,10,7,5,11,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,11,5,10,11,7,5,8,3,0,-1,-1,-1,-1,-1,-1,-1,5,11,7,5,10,11,1,9,0,-1,-1,-1,-1,-1,-1,-1,10,7,5,10,11,7,9,8,1,8,3,1,-1,-1,-1,-1,11,1,2,11,7,1,7,5,1,-1,-1,-1,-1,-1,-1,-1,0,8,3,1,2,7,1,7,5,7,2,11,-1,-1,-1,-1,9,7,5,9,2,7,9,0,2,2,11,7,-1,-1,-1,-1,7,5,2,7,2,11,5,9,2,3,2,8,9,8,2,-1,2,5,10,2,3,5,3,7,5,-1,-1,-1,-1,-1,-1,-1,8,2,0,8,5,2,8,7,5,10,2,5,-1,-1,-1,-1,9,0,1,5,10,3,5,3,7,3,10,2,-1,-1,-1,-1,9,8,2,9,2,1,8,7,2,10,2,5,7,5,2,-1,1,3,5,3,7,5,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,8,7,0,7,1,1,7,5,-1,-1,-1,-1,-1,-1,-1,9,0,3,9,3,5,5,3,7,-1,-1,-1,-1,-1,-1,-1,9,8,7,5,9,7,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,5,8,4,5,10,8,10,11,8,-1,-1,-1,-1,-1,-1,-1,5,0,4,5,11,0,5,10,11,11,3,0,-1,-1,-1,-1,0,1,9,8,4,10,8,10,11,10,4,5,-1,-1,-1,-1,10,11,4,10,4,5,11,3,4,9,4,1,3,1,4,-1,2,5,1,2,8,5,2,11,8,4,5,8,-1,-1,-1,-1,0,4,11,0,11,3,4,5,11,2,11,1,5,1,11,-1,0,2,5,0,5,9,2,11,5,4,5,8,11,8,5,-1,9,4,5,2,11,3,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,2,5,10,3,5,2,3,4,5,3,8,4,-1,-1,-1,-1,5,10,2,5,2,4,4,2,0,-1,-1,-1,-1,-1,-1,-1,3,10,2,3,5,10,3,8,5,4,5,8,0,1,9,-1,5,10,2,5,2,4,1,9,2,9,4,2,-1,-1,-1,-1,8,4,5,8,5,3,3,5,1,-1,-1,-1,-1,-1,-1,-1,0,4,5,1,0,5,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,8,4,5,8,5,3,9,0,5,0,3,5,-1,-1,-1,-1,9,4,5,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,4,11,7,4,9,11,9,10,11,-1,-1,-1,-1,-1,-1,-1,0,8,3,4,9,7,9,11,7,9,10,11,-1,-1,-1,-1,1,10,11,1,11,4,1,4,0,7,4,11,-1,-1,-1,-1,3,1,4,3,4,8,1,10,4,7,4,11,10,11,4,-1,4,11,7,9,11,4,9,2,11,9,1,2,-1,-1,-1,-1,9,7,4,9,11,7,9,1,11,2,11,1,0,8,3,-1,11,7,4,11,4,2,2,4,0,-1,-1,-1,-1,-1,-1,-1,11,7,4,11,4,2,8,3,4,3,2,4,-1,-1,-1,-1,2,9,10,2,7,9,2,3,7,7,4,9,-1,-1,-1,-1,9,10,7,9,7,4,10,2,7,8,7,0,2,0,7,-1,3,7,10,3,10,2,7,4,10,1,10,0,4,0,10,-1,1,10,2,8,7,4,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,4,9,1,4,1,7,7,1,3,-1,-1,-1,-1,-1,-1,-1,4,9,1,4,1,7,0,8,1,8,7,1,-1,-1,-1,-1,4,0,3,7,4,3,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,4,8,7,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,9,10,8,10,11,8,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,3,0,9,3,9,11,11,9,10,-1,-1,-1,-1,-1,-1,-1,0,1,10,0,10,8,8,10,11,-1,-1,-1,-1,-1,-1,-1,3,1,10,11,3,10,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,1,2,11,1,11,9,9,11,8,-1,-1,-1,-1,-1,-1,-1,3,0,9,3,9,11,1,2,9,2,11,9,-1,-1,-1,-1,0,2,11,8,0,11,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,3,2,11,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,2,3,8,2,8,10,10,8,9,-1,-1,-1,-1,-1,-1,-1,9,10,2,0,9,2,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,2,3,8,2,8,10,0,1,8,1,10,8,-1,-1,-1,-1,1,10,2,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,1,3,8,9,1,8,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,9,1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,3,8,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1]);/**
   * @author bhouston / http://exocortex.com/
   * @author zz85 / http://github.com/zz85
   */function CanvasTexture(canvas,mapping,wrapS,wrapT,magFilter,minFilter,format,type,anisotropy){Texture$1.call(this,canvas,mapping,wrapS,wrapT,magFilter,minFilter,format,type,anisotropy);this.needsUpdate=true;}CanvasTexture.prototype=Object.create(Texture$1.prototype);CanvasTexture.prototype.constructor=CanvasTexture;/**
   * @author mikael emtinger / http://gomo.se/
   * @author alteredq / http://alteredqualia.com/
   */function Sprite(material){Object3D.call(this);this.type='Sprite';this.material=material!==undefined?material:new SpriteMaterial();}Sprite.prototype=Object.assign(Object.create(Object3D.prototype),{constructor:Sprite,isSprite:true,raycast:function(){var intersectPoint=new Vector3$1();var worldPosition=new Vector3$1();var worldScale=new Vector3$1();return function raycast(raycaster,intersects){worldPosition.setFromMatrixPosition(this.matrixWorld);raycaster.ray.closestPointToPoint(worldPosition,intersectPoint);worldScale.setFromMatrixScale(this.matrixWorld);var guessSizeSq=worldScale.x*worldScale.y/4;if(worldPosition.distanceToSquared(intersectPoint)>guessSizeSq){return;}var distance=raycaster.ray.origin.distanceTo(intersectPoint);if(distance<raycaster.near||distance>raycaster.far){return;}intersects.push({distance:distance,point:intersectPoint.clone(),face:null,object:this});};}(),clone:function clone(){return new this.constructor(this.material).copy(this);}});/**
   * @author daron1337 / http://daron1337.github.io/
   */var MorphBlendMesh=function MorphBlendMesh(geometry,material){Mesh.call(this,geometry,material);this.animationsMap={};this.animationsList=[];// prepare default animation
  // (all frames played together in 1 second)
  var numFrames=this.geometry.morphTargets.length;var name="__default";var startFrame=0;var endFrame=numFrames-1;var fps=numFrames/1;this.createAnimation(name,startFrame,endFrame,fps);this.setAnimationWeight(name,1);};MorphBlendMesh.prototype=Object.assign(Object.create(Mesh.prototype),{constructor:MorphBlendMesh,createAnimation:function createAnimation(name,start,end,fps){var animation={start:start,end:end,length:end-start+1,fps:fps,duration:(end-start)/fps,lastFrame:0,currentFrame:0,active:false,time:0,direction:1,weight:1,directionBackwards:false,mirroredLoop:false};this.animationsMap[name]=animation;this.animationsList.push(animation);},autoCreateAnimations:function autoCreateAnimations(fps){var this$1=this;var pattern=/([a-z]+)_?(\d+)/i;var firstAnimation,frameRanges={};var geometry=this.geometry;for(var i=0,il=geometry.morphTargets.length;i<il;i++){var morph=geometry.morphTargets[i];var chunks=morph.name.match(pattern);if(chunks&&chunks.length>1){var name=chunks[1];if(!frameRanges[name]){frameRanges[name]={start:Infinity,end:-Infinity};}var range=frameRanges[name];if(i<range.start){range.start=i;}if(i>range.end){range.end=i;}if(!firstAnimation){firstAnimation=name;}}}for(var name in frameRanges){var range=frameRanges[name];this$1.createAnimation(name,range.start,range.end,fps);}this.firstAnimation=firstAnimation;},setAnimationDirectionForward:function setAnimationDirectionForward(name){var animation=this.animationsMap[name];if(animation){animation.direction=1;animation.directionBackwards=false;}},setAnimationDirectionBackward:function setAnimationDirectionBackward(name){var animation=this.animationsMap[name];if(animation){animation.direction=-1;animation.directionBackwards=true;}},setAnimationFPS:function setAnimationFPS(name,fps){var animation=this.animationsMap[name];if(animation){animation.fps=fps;animation.duration=(animation.end-animation.start)/animation.fps;}},setAnimationDuration:function setAnimationDuration(name,duration){var animation=this.animationsMap[name];if(animation){animation.duration=duration;animation.fps=(animation.end-animation.start)/animation.duration;}},setAnimationWeight:function setAnimationWeight(name,weight){var animation=this.animationsMap[name];if(animation){animation.weight=weight;}},setAnimationTime:function setAnimationTime(name,time){var animation=this.animationsMap[name];if(animation){animation.time=time;}},getAnimationTime:function getAnimationTime(name){var time=0;var animation=this.animationsMap[name];if(animation){time=animation.time;}return time;},getAnimationDuration:function getAnimationDuration(name){var duration=-1;var animation=this.animationsMap[name];if(animation){duration=animation.duration;}return duration;},playAnimation:function playAnimation(name){var animation=this.animationsMap[name];if(animation){animation.time=0;animation.active=true;}else{console.warn("MorphBlendMesh: animation["+name+"] undefined in .playAnimation()");}},stopAnimation:function stopAnimation(name){var animation=this.animationsMap[name];if(animation){animation.active=false;}},update:function update(delta){var this$1=this;for(var i=0,il=this.animationsList.length;i<il;i++){var animation=this$1.animationsList[i];if(!animation.active){continue;}var frameTime=animation.duration/animation.length;animation.time+=animation.direction*delta;if(animation.mirroredLoop){if(animation.time>animation.duration||animation.time<0){animation.direction*=-1;if(animation.time>animation.duration){animation.time=animation.duration;animation.directionBackwards=true;}if(animation.time<0){animation.time=0;animation.directionBackwards=false;}}}else{animation.time=animation.time%animation.duration;if(animation.time<0){animation.time+=animation.duration;}}var keyframe=animation.start+Math.clamp(Math.floor(animation.time/frameTime),0,animation.length-1);var weight=animation.weight;if(keyframe!==animation.currentFrame){this$1.morphTargetInfluences[animation.lastFrame]=0;this$1.morphTargetInfluences[animation.currentFrame]=1*weight;this$1.morphTargetInfluences[keyframe]=0;animation.lastFrame=animation.currentFrame;animation.currentFrame=keyframe;}var mix=animation.time%frameTime/frameTime;if(animation.directionBackwards){mix=1-mix;}if(animation.currentFrame!==animation.lastFrame){this$1.morphTargetInfluences[animation.currentFrame]=mix*weight;this$1.morphTargetInfluences[animation.lastFrame]=(1-mix)*weight;}else{this$1.morphTargetInfluences[animation.currentFrame]=weight;}}}});/**
   * @author alteredq / http://alteredqualia.com/
   */Face3$1.prototype.set=function(a,b,c){this.a=a;this.b=b;this.c=c;};var MorphAnimMesh=function MorphAnimMesh(geometry,material){Mesh.call(this,geometry,material);this.type='MorphAnimMesh';this.mixer=new AnimationMixer(this);this.activeAction=null;};MorphAnimMesh.prototype=Object.create(Mesh.prototype);MorphAnimMesh.prototype.constructor=MorphAnimMesh;MorphAnimMesh.prototype.setDirectionForward=function(){this.mixer.timeScale=1.0;};MorphAnimMesh.prototype.setDirectionBackward=function(){this.mixer.timeScale=-1.0;};MorphAnimMesh.prototype.playAnimation=function(label,fps){if(this.activeAction){this.activeAction.stop();this.activeAction=null;}var clip=AnimationClip.findByName(this,label);if(clip){var action=this.mixer.clipAction(clip);action.timeScale=clip.tracks.length*fps/clip.duration;this.activeAction=action.play();}else{throw new Error('MorphAnimMesh: animations['+label+'] undefined in .playAnimation()');}};MorphAnimMesh.prototype.updateAnimation=function(delta){this.mixer.update(delta);};MorphAnimMesh.prototype.copy=function(source){Mesh.prototype.copy.call(this,source);this.mixer=new AnimationMixer(this);return this;};/**
   * @author sunag / http://www.sunag.com.br/
   */var GLNode=function GLNode(type){this.uuid=_Math$1.generateUUID();this.allows={};this.requestUpdate=false;this.type=type;};GLNode.prototype.parse=function(builder,context){context=context||{};builder.parsing=true;var material=builder.material;this.build(builder.addCache(context.cache,context.requires).addSlot(context.slot),'v4');material.clearVertexNode();material.clearFragmentNode();builder.removeCache().removeSlot();builder.parsing=false;};GLNode.prototype.parseAndBuildCode=function(builder,output,context){context=context||{};this.parse(builder,context);return this.buildCode(builder,output,context);};GLNode.prototype.buildCode=function(builder,output,context){context=context||{};var material=builder.material;var data={result:this.build(builder.addCache(context.cache,context.requires).addSlot(context.slot),output)};if(builder.isShader('vertex')){data.code=material.clearVertexNode();}else{data.code=material.clearFragmentNode();}builder.removeCache().removeSlot();return data;};GLNode.prototype.build=function(builder,output,uuid){output=output||this.getType(builder,output);var material=builder.material,data=material.getDataNode(uuid||this.uuid);if(builder.parsing){this.appendDepsNode(builder,data,output);}if(this.allows[builder.shader]===false){throw new Error('Shader '+shader+' is not compatible with this node.');}if(this.requestUpdate&&material.requestUpdate.indexOf(this)===-1){material.requestUpdate.push(this);}return this.generate(builder,output,uuid);};GLNode.prototype.appendDepsNode=function(builder,data,output){data.deps=(data.deps||0)+1;var outputLen=builder.getFormatLength(output);if(outputLen>(data.outputMax||0)||this.getType(builder,output)){data.outputMax=outputLen;data.output=output;}};GLNode.prototype.getType=function(builder,output){return output==='sampler2D'||output==='samplerCube'?output:this.type;};/**
   * Automatic node cache
   * @author sunag / http://www.sunag.com.br/
   */var TempNode=function TempNode(type,params){GLNode.call(this,type);params=params||{};this.shared=params.shared!==undefined?params.shared:true;this.unique=params.unique!==undefined?params.unique:false;};TempNode.prototype=Object.create(GLNode.prototype);TempNode.prototype.constructor=TempNode;TempNode.prototype.build=function(builder,output,uuid,ns){output=output||this.getType(builder);var material=builder.material;if(this.isShared(builder,output)){var isUnique=this.isUnique(builder,output);if(isUnique&&this.constructor.uuid===undefined){this.constructor.uuid=Math.generateUUID();}uuid=builder.getUuid(uuid||this.getUuid(),!isUnique);var data=material.getDataNode(uuid);if(builder.parsing){if(data.deps||0>0){this.appendDepsNode(builder,data,output);return this.generate(builder,type,uuid);}return GLNode.prototype.build.call(this,builder,output,uuid);}else if(isUnique){data.name=data.name||GLNode.prototype.build.call(this,builder,output,uuid);return data.name;}else if(!builder.optimize||data.deps==1){return GLNode.prototype.build.call(this,builder,output,uuid);}uuid=this.getUuid(false);var name=this.getTemp(builder,uuid);var type=data.output||this.getType(builder);if(name){return builder.format(name,type,output);}else{name=TempNode.prototype.generate.call(this,builder,output,uuid,data.output,ns);var code=this.generate(builder,type,uuid);if(builder.isShader('vertex')){material.addVertexNode(name+'='+code+';');}else{material.addFragmentNode(name+'='+code+';');}return builder.format(name,type,output);}}return GLNode.prototype.build.call(this,builder,output,uuid);};TempNode.prototype.isShared=function(builder,output){return output!=='sampler2D'&&output!=='samplerCube'&&this.shared;};TempNode.prototype.isUnique=function(builder,output){return this.unique;};TempNode.prototype.getUuid=function(unique){var uuid=unique||unique==undefined?this.constructor.uuid||this.uuid:this.uuid;if(typeof this.scope=="string"){uuid=this.scope+'-'+uuid;}return uuid;};TempNode.prototype.getTemp=function(builder,uuid){uuid=uuid||this.uuid;var material=builder.material;if(builder.isShader('vertex')&&material.vertexTemps[uuid]){return material.vertexTemps[uuid].name;}else if(material.fragmentTemps[uuid]){return material.fragmentTemps[uuid].name;}};TempNode.prototype.generate=function(builder,output,uuid,type,ns){if(!this.isShared(builder,output)){console.error("TempNode is not shared!");}uuid=uuid||this.uuid;if(builder.isShader('vertex')){return builder.material.getVertexTemp(uuid,type||this.getType(builder),ns).name;}else{return builder.material.getFragmentTemp(uuid,type||this.getType(builder),ns).name;}};/**
   * @author [Tristan Valcke]{@link https://github.com/Itee}
   * @author sunag / http://www.sunag.com.br/
   * @thanks bhouston / https://clara.io/
   */var FunctionNode=function FunctionNode(src,includesOrType,extensionsOrIncludes,keywordsOrExtensions){src=src||'';this.isMethod=typeof includesOrType!=="string";this.useKeywords=true;TempNode.call(this,this.isMethod?null:includesOrType);if(this.isMethod){this.eval(src,includesOrType,extensionsOrIncludes,keywordsOrExtensions);}else{this.eval(src,extensionsOrIncludes,keywordsOrExtensions);}};FunctionNode.rDeclaration=/^([a-z_0-9]+)\s([a-z_0-9]+)\s?\((.*?)\)/i;FunctionNode.rProperties=/[a-z_0-9]+/ig;FunctionNode.prototype=Object.create(TempNode.prototype);FunctionNode.prototype.constructor=FunctionNode;FunctionNode.prototype.eval=function(src,includes,extensions,keywords){var this$1=this;src=(src||'').trim();this.includes=includes||[];this.extensions=extensions||{};this.keywords=keywords||{};if(this.isMethod){var match=src.match(FunctionNode.rDeclaration);this.inputs=[];if(match&&match.length==4){this.type=match[1];this.name=match[2];var inputs=match[3].match(FunctionNode.rProperties);if(inputs){var i=0;while(i<inputs.length){var qualifier=inputs[i++];var type,name;if(qualifier=='in'||qualifier=='out'||qualifier=='inout'){type=inputs[i++];}else{type=qualifier;qualifier='';}name=inputs[i++];this$1.inputs.push({name:name,type:type,qualifier:qualifier});}}}else{this.type='';this.name='';}}this.value=src;};/**
   * @author [Tristan Valcke]{@link https://github.com/Itee}
   * @author sunag / http://www.sunag.com.br/
   */var NodeLib={nodes:{},keywords:{},add:function add(node){this.nodes[node.name]=node;},addKeyword:function addKeyword(name,callback,cache){cache=cache!==undefined?cache:true;this.keywords[name]={callback:callback,cache:cache};},remove:function remove(node){delete this.nodes[node.name];},removeKeyword:function removeKeyword(name){delete this.keywords[name];},get:function get$$1(name){return this.nodes[name];},getKeyword:function getKeyword(name,material){return this.keywords[name].callback.call(this,material);},getKeywordData:function getKeywordData(name){return this.keywords[name];},contains:function contains(name){return this.nodes[name]!=undefined;},containsKeyword:function containsKeyword(name){return this.keywords[name]!=undefined;}};/**
   * @author sunag / http://www.sunag.com.br/
   */var UVNode=function UVNode(index){TempNode.call(this,'v2',{shared:false});this.index=index||0;};UVNode.vertexDict=['uv','uv2'];UVNode.fragmentDict=['vUv','vUv2'];UVNode.prototype=Object.create(TempNode.prototype);UVNode.prototype.constructor=UVNode;UVNode.prototype.generate=function(builder,output){var material=builder.material;var result;material.requestAttribs.uv[this.index]=true;if(builder.isShader('vertex')){result=UVNode.vertexDict[this.index];}else{result=UVNode.fragmentDict[this.index];}return builder.format(result,this.getType(builder),output);};/**
   * @author sunag / http://www.sunag.com.br/
   */var PositionNode=function PositionNode(scope){TempNode.call(this,'v3');this.scope=scope||PositionNode.LOCAL;};PositionNode.LOCAL='local';PositionNode.WORLD='world';PositionNode.VIEW='view';PositionNode.PROJECTION='projection';PositionNode.prototype=Object.create(TempNode.prototype);PositionNode.prototype.constructor=PositionNode;PositionNode.prototype.getType=function(builder){switch(this.scope){case PositionNode.PROJECTION:return'v4';}return this.type;};PositionNode.prototype.isShared=function(builder){switch(this.scope){case PositionNode.LOCAL:case PositionNode.WORLD:return false;}return true;};PositionNode.prototype.generate=function(builder,output){var material=builder.material;var result;switch(this.scope){case PositionNode.LOCAL:material.requestAttribs.position=true;if(builder.isShader('vertex')){result='transformed';}else{result='vPosition';}break;case PositionNode.WORLD:material.requestAttribs.worldPosition=true;if(builder.isShader('vertex')){result='vWPosition';}else{result='vWPosition';}break;case PositionNode.VIEW:if(builder.isShader('vertex')){result='-mvPosition.xyz';}else{result='vViewPosition';}break;case PositionNode.PROJECTION:if(builder.isShader('vertex')){result='(projectionMatrix * modelViewMatrix * vec4( position, 1.0 ))';}else{result='vec4( 0.0 )';}break;}return builder.format(result,this.getType(builder),output);};/**
   * @author sunag / http://www.sunag.com.br/
   */var NormalNode=function NormalNode(scope){TempNode.call(this,'v3');this.scope=scope||NormalNode.LOCAL;};NormalNode.LOCAL='local';NormalNode.WORLD='world';NormalNode.VIEW='view';NormalNode.prototype=Object.create(TempNode.prototype);NormalNode.prototype.constructor=NormalNode;NormalNode.prototype.isShared=function(builder){switch(this.scope){case NormalNode.WORLD:return true;}return false;};NormalNode.prototype.generate=function(builder,output){var material=builder.material;var result;switch(this.scope){case NormalNode.LOCAL:material.requestAttribs.normal=true;if(builder.isShader('vertex')){result='normal';}else{result='vObjectNormal';}break;case NormalNode.WORLD:material.requestAttribs.worldNormal=true;if(builder.isShader('vertex')){result='( modelMatrix * vec4( objectNormal, 0.0 ) ).xyz';}else{result='vWNormal';}break;case NormalNode.VIEW:result='vNormal';break;}return builder.format(result,this.getType(builder),output);};/**
   * @author sunag / http://www.sunag.com.br/
   */var InputNode=function InputNode(type,params){params=params||{};params.shared=params.shared!==undefined?params.shared:false;TempNode.call(this,type,params);};InputNode.prototype=Object.create(TempNode.prototype);InputNode.prototype.constructor=InputNode;InputNode.prototype.generate=function(builder,output,uuid,type,ns,needsUpdate){var material=builder.material;uuid=builder.getUuid(uuid||this.getUuid());type=type||this.getType(builder);var data=material.getDataNode(uuid);if(builder.isShader('vertex')){if(!data.vertex){data.vertex=material.createVertexUniform(type,this.value,ns,needsUpdate);}return builder.format(data.vertex.name,type,output);}else{if(!data.fragment){data.fragment=material.createFragmentUniform(type,this.value,ns,needsUpdate);}return builder.format(data.fragment.name,type,output);}};/**
   * @author sunag / http://www.sunag.com.br/
   */var FloatNode=function FloatNode(value){InputNode.call(this,'fv1');this.value=[value||0];};FloatNode.prototype=Object.create(InputNode.prototype);FloatNode.prototype.constructor=FloatNode;Object.defineProperties(FloatNode.prototype,{number:{get:function get$$1(){return this.value[0];},set:function set$$1(val){this.value[0]=val;}}});/**
   * @author sunag / http://www.sunag.com.br/
   */var TimerNode=function TimerNode(value,scale){FloatNode.call(this,value);this.requestUpdate=true;this.scale=scale!==undefined?scale:1;};TimerNode.prototype=Object.create(FloatNode.prototype);TimerNode.prototype.constructor=TimerNode;TimerNode.prototype.updateFrame=function(delta){this.number+=delta*this.scale;};/**
   * @author sunag / http://www.sunag.com.br/
   */var ConstNode=function ConstNode(src,useDefine){TempNode.call(this);this.eval(src||ConstNode.PI,useDefine);};ConstNode.PI='PI';ConstNode.PI2='PI2';ConstNode.RECIPROCAL_PI='RECIPROCAL_PI';ConstNode.RECIPROCAL_PI2='RECIPROCAL_PI2';ConstNode.LOG2='LOG2';ConstNode.EPSILON='EPSILON';ConstNode.prototype=Object.create(TempNode.prototype);ConstNode.prototype.constructor=ConstNode;ConstNode.prototype.getType=function(builder){return builder.getTypeByFormat(this.type);};ConstNode.prototype.eval=function(src,useDefine){src=(src||'').trim();var name,type,value;var rDeclaration=/^([a-z_0-9]+)\s([a-z_0-9]+)\s?\=?\s?(.*?)(\;|$)/i;var match=src.match(rDeclaration);this.useDefine=useDefine;if(match&&match.length>1){type=match[1];name=match[2];value=match[3];}else{name=src;type='fv1';}this.name=name;this.type=type;this.value=value;};ConstNode.prototype.build=function(builder,output){if(output==='source'){if(this.value){if(this.useDefine){return'#define '+this.name+' '+this.value;}return'const '+this.type+' '+this.name+' = '+this.value+';';}}else{builder.include(this);return builder.format(this.name,this.getType(builder),output);}};ConstNode.prototype.generate=function(builder,output){return builder.format(this.name,this.getType(builder),output);};/**
   * @author [Tristan Valcke]{@link https://github.com/Itee}
   * @author sunag / http://www.sunag.com.br/
   */// Fix circular dependency, see #2
  //
  //	Keywords
  //
  NodeLib.addKeyword('uv',function(){return new UVNode();});NodeLib.addKeyword('uv2',function(){return new UVNode(1);});NodeLib.addKeyword('position',function(){return new PositionNode();});NodeLib.addKeyword('worldPosition',function(){return new PositionNode(PositionNode.WORLD);});NodeLib.addKeyword('normal',function(){return new NormalNode();});NodeLib.addKeyword('worldNormal',function(){return new NormalNode(NormalNode.WORLD);});NodeLib.addKeyword('viewPosition',function(){return new PositionNode(NormalNode.VIEW);});NodeLib.addKeyword('viewNormal',function(){return new NormalNode(NormalNode.VIEW);});NodeLib.addKeyword('time',function(){return new TimerNode();});//
  //	Luma
  //
  NodeLib.add(new ConstNode("vec3 LUMA vec3(0.2125, 0.7154, 0.0721)"));//
  //	NormalMap
  //
  NodeLib.add(new FunctionNode([// Per-Pixel Tangent Space Normal Mapping
  // http://hacksoflife.blogspot.ch/2009/11/per-pixel-tangent-space-normal-mapping.html
  "vec3 perturbNormal2Arb( vec3 eye_pos, vec3 surf_norm, vec3 map, vec2 mUv, vec2 scale ) {","	vec3 q0 = dFdx( eye_pos );","	vec3 q1 = dFdy( eye_pos );","	vec2 st0 = dFdx( mUv.st );","	vec2 st1 = dFdy( mUv.st );","	vec3 S = normalize( q0 * st1.t - q1 * st0.t );","	vec3 T = normalize( -q0 * st1.s + q1 * st0.s );","	vec3 N = normalize( surf_norm );","	vec3 mapN = map * 2.0 - 1.0;","	mapN.xy = scale * mapN.xy;","	mat3 tsn = mat3( S, T, N );","	return normalize( tsn * mapN );","}"].join("\n"),null,{derivatives:true}));//
  //	Noise
  //
  NodeLib.add(new FunctionNode(["float snoise(vec2 co) {","	return fract( sin( dot(co.xy, vec2(12.9898,78.233) ) ) * 43758.5453 );","}"].join("\n")));//
  //	Hue
  //
  NodeLib.add(new FunctionNode(["vec3 hue_rgb(vec3 rgb, float adjustment) {","	const mat3 RGBtoYIQ = mat3(0.299, 0.587, 0.114, 0.595716, -0.274453, -0.321263, 0.211456, -0.522591, 0.311135);","	const mat3 YIQtoRGB = mat3(1.0, 0.9563, 0.6210, 1.0, -0.2721, -0.6474, 1.0, -1.107, 1.7046);","	vec3 yiq = RGBtoYIQ * rgb;","	float hue = atan(yiq.z, yiq.y) + adjustment;","	float chroma = sqrt(yiq.z * yiq.z + yiq.y * yiq.y);","	return YIQtoRGB * vec3(yiq.x, chroma * cos(hue), chroma * sin(hue));","}"].join("\n")));//
  //	Saturation
  //
  NodeLib.add(new FunctionNode([// Algorithm from Chapter 16 of OpenGL Shading Language
  "vec3 saturation_rgb(vec3 rgb, float adjustment) {","	vec3 intensity = vec3(dot(rgb, LUMA));","	return mix(intensity, rgb, adjustment);","}"].join("\n")));//
  //	Luminance
  //
  NodeLib.add(new FunctionNode([// Algorithm from Chapter 10 of Graphics Shaders
  "float luminance_rgb(vec3 rgb) {","	return dot(rgb, LUMA);","}"].join("\n")));//
  //	Vibrance
  //
  NodeLib.add(new FunctionNode([// Shader by Evan Wallace adapted by @lo-th
  "vec3 vibrance_rgb(vec3 rgb, float adjustment) {","	float average = (rgb.r + rgb.g + rgb.b) / 3.0;","	float mx = max(rgb.r, max(rgb.g, rgb.b));","	float amt = (mx - average) * (-3.0 * adjustment);","	return mix(rgb.rgb, vec3(mx), amt);","}"].join("\n")));/**
   * @author [Tristan Valcke]{@link https://github.com/Itee}
   * @author sunag / http://www.sunag.com.br/
   *//**
   * @author [Tristan Valcke]{@link https://github.com/Itee}
   * @author sunag / http://www.sunag.com.br/
   * @thanks bhouston / https://clara.io/
   */// Fix circular dependency, see #2
  FunctionNode.prototype.isShared=function(builder,output){return!this.isMethod;};FunctionNode.prototype.getType=function(builder){return builder.getTypeByFormat(this.type);};FunctionNode.prototype.getInputByName=function(name){var this$1=this;var i=this.inputs.length;while(i--){if(this$1.inputs[i].name===name){return this$1.inputs[i];}}};FunctionNode.prototype.getIncludeByName=function(name){var this$1=this;var i=this.includes.length;while(i--){if(this$1.includes[i].name===name){return this$1.includes[i];}}};FunctionNode.prototype.generate=function(builder,output){var this$1=this;var match,offset=0,src=this.value;for(var i=0;i<this.includes.length;i++){builder.include(this$1.includes[i],this$1);}for(var ext in this$1.extensions){builder.material.extensions[ext]=true;}while(match=FunctionNode.rProperties.exec(this.value)){var prop=match[0],isGlobal=this$1.isMethod?!this$1.getInputByName(prop):true;var reference=prop;if(this$1.keywords[prop]||this$1.useKeywords&&isGlobal&&NodeLib.containsKeyword(prop)){var node=this$1.keywords[prop];if(!node){var keyword=NodeLib.getKeywordData(prop);if(keyword.cache){node=builder.keywords[prop];}node=node||NodeLib.getKeyword(prop,builder);if(keyword.cache){builder.keywords[prop]=node;}}reference=node.build(builder);}if(prop!=reference){src=src.substring(0,match.index+offset)+reference+src.substring(match.index+prop.length+offset);offset+=reference.length-prop.length;}if(this$1.getIncludeByName(reference)===undefined&&NodeLib.contains(reference)){builder.include(NodeLib.get(reference));}}if(output==='source'){return src;}else if(this.isMethod){builder.include(this,false,src);return this.name;}else{return builder.format("("+src+")",this.getType(builder),output);}};/**
   * @author [Tristan Valcke]{@link https://github.com/Itee}
   * @author sunag / http://www.sunag.com.br/
   * @thanks bhouston / https://clara.io/
   *//**
   * @author sunag / http://www.sunag.com.br/
   */var CameraNode=function CameraNode(scope,camera){TempNode.call(this,'v3');this.setScope(scope||CameraNode.POSITION);this.setCamera(camera);};CameraNode.fDepthColor=new FunctionNode(["float depthColor( float mNear, float mFar ) {","	#ifdef USE_LOGDEPTHBUF_EXT","		float depth = gl_FragDepthEXT / gl_FragCoord.w;","	#else","		float depth = gl_FragCoord.z / gl_FragCoord.w;","	#endif","	return 1.0 - smoothstep( mNear, mFar, depth );","}"].join("\n"));CameraNode.POSITION='position';CameraNode.DEPTH='depth';CameraNode.TO_VERTEX='toVertex';CameraNode.prototype=Object.create(TempNode.prototype);CameraNode.prototype.constructor=CameraNode;CameraNode.prototype.setCamera=function(camera){this.camera=camera;this.requestUpdate=camera!==undefined;};CameraNode.prototype.setScope=function(scope){switch(this.scope){case CameraNode.DEPTH:delete this.near;delete this.far;break;}this.scope=scope;switch(scope){case CameraNode.DEPTH:this.near=new FloatNode(this.camera?this.camera.near:1);this.far=new FloatNode(this.camera?this.camera.far:1200);break;}};CameraNode.prototype.getType=function(builder){switch(this.scope){case CameraNode.DEPTH:return'fv1';}return this.type;};CameraNode.prototype.isUnique=function(builder){switch(this.scope){case CameraNode.DEPTH:case CameraNode.TO_VERTEX:return true;}return false;};CameraNode.prototype.isShared=function(builder){switch(this.scope){case CameraNode.POSITION:return false;}return true;};CameraNode.prototype.generate=function(builder,output){var material=builder.material;var result;switch(this.scope){case CameraNode.POSITION:result='cameraPosition';break;case CameraNode.DEPTH:var func=CameraNode.fDepthColor;builder.include(func);result=func.name+'('+this.near.build(builder,'fv1')+','+this.far.build(builder,'fv1')+')';break;case CameraNode.TO_VERTEX:result='normalize( '+new PositionNode(PositionNode.WORLD).build(builder,'v3')+' - cameraPosition )';break;}return builder.format(result,this.getType(builder),output);};CameraNode.prototype.updateFrame=function(delta){switch(this.scope){case CameraNode.DEPTH:this.near.number=this.camera.near;this.far.number=this.camera.far;break;}};/**
   * @author sunag / http://www.sunag.com.br/
   */var ColorsNode=function ColorsNode(index){TempNode.call(this,'v4',{shared:false});this.index=index||0;};ColorsNode.vertexDict=['color','color2'];ColorsNode.fragmentDict=['vColor','vColor2'];ColorsNode.prototype=Object.create(TempNode.prototype);ColorsNode.prototype.constructor=ColorsNode;ColorsNode.prototype.generate=function(builder,output){var material=builder.material;var result;material.requestAttribs.color[this.index]=true;if(builder.isShader('vertex')){result=ColorsNode.vertexDict[this.index];}else{result=ColorsNode.fragmentDict[this.index];}return builder.format(result,this.getType(builder),output);};/**
   * @author sunag / http://www.sunag.com.br/
   */var LightNode=function LightNode(){TempNode.call(this,'v3',{shared:false});};LightNode.prototype=Object.create(TempNode.prototype);LightNode.prototype.constructor=LightNode;LightNode.prototype.generate=function(builder,output){if(builder.isCache('light')){return builder.format('reflectedLight.directDiffuse',this.getType(builder),output);}else{console.warn("LightNode is only compatible in \"light\" channel.");return builder.format('vec3( 0.0 )',this.getType(builder),output);}};/**
   * @author sunag / http://www.sunag.com.br/
   */var ReflectNode=function ReflectNode(scope){TempNode.call(this,'v3',{unique:true});this.scope=scope||ReflectNode.CUBE;};ReflectNode.CUBE='cube';ReflectNode.SPHERE='sphere';ReflectNode.VECTOR='vector';ReflectNode.prototype=Object.create(TempNode.prototype);ReflectNode.prototype.constructor=ReflectNode;ReflectNode.prototype.getType=function(builder){switch(this.scope){case ReflectNode.SPHERE:return'v2';}return this.type;};ReflectNode.prototype.generate=function(builder,output){var result;switch(this.scope){case ReflectNode.VECTOR:builder.material.addFragmentNode('vec3 reflectVec = inverseTransformDirection( reflect( -normalize( vViewPosition ), normal ), viewMatrix );');result='reflectVec';break;case ReflectNode.CUBE:var reflectVec=new ReflectNode(ReflectNode.VECTOR).build(builder,'v3');builder.material.addFragmentNode('vec3 reflectCubeVec = vec3( -1.0 * '+reflectVec+'.x, '+reflectVec+'.yz );');result='reflectCubeVec';break;case ReflectNode.SPHERE:var reflectVec=new ReflectNode(ReflectNode.VECTOR).build(builder,'v3');builder.material.addFragmentNode('vec2 reflectSphereVec = normalize((viewMatrix * vec4('+reflectVec+', 0.0 )).xyz + vec3(0.0,0.0,1.0)).xy * 0.5 + 0.5;');result='reflectSphereVec';break;}return builder.format(result,this.getType(this.type),output);};/**
   * @author sunag / http://www.sunag.com.br/
   */var ScreenUVNode=function ScreenUVNode(resolution){TempNode.call(this,'v2');this.resolution=resolution;};ScreenUVNode.prototype=Object.create(TempNode.prototype);ScreenUVNode.prototype.constructor=ScreenUVNode;ScreenUVNode.prototype.generate=function(builder,output){var material=builder.material;var result;if(builder.isShader('fragment')){result='(gl_FragCoord.xy/'+this.resolution.build(builder,'v2')+')';}else{console.warn("ScreenUVNode is not compatible with "+builder.shader+" shader.");result='vec2( 0.0 )';}return builder.format(result,this.getType(builder),output);};/**
   * @author sunag / http://www.sunag.com.br/
   */var AttributeNode=function AttributeNode(name,type){GLNode.call(this,type);this.name=name;};AttributeNode.prototype=Object.create(GLNode.prototype);AttributeNode.prototype.constructor=AttributeNode;AttributeNode.prototype.getAttributeType=function(builder){return typeof this.type==='number'?builder.getConstructorFromLength(this.type):this.type;};AttributeNode.prototype.getType=function(builder){var type=this.getAttributeType(builder);return builder.getTypeByFormat(type);};AttributeNode.prototype.generate=function(builder,output){var type=this.getAttributeType(builder);var attribute=builder.material.getAttribute(this.name,type);return builder.format(builder.isShader('vertex')?this.name:attribute.varying.name,this.getType(builder),output);};/**
   * @author sunag / http://www.sunag.com.br/
   */var FunctionCallNode=function FunctionCallNode(func,inputs){TempNode.call(this);this.setFunction(func,inputs);};FunctionCallNode.prototype=Object.create(TempNode.prototype);FunctionCallNode.prototype.constructor=FunctionCallNode;FunctionCallNode.prototype.setFunction=function(func,inputs){this.value=func;this.inputs=inputs||[];};FunctionCallNode.prototype.getFunction=function(){return this.value;};FunctionCallNode.prototype.getType=function(builder){return this.value.getType(builder);};FunctionCallNode.prototype.generate=function(builder,output){var this$1=this;var material=builder.material;var type=this.getType(builder);var func=this.value;var code=func.build(builder,output)+'(';var params=[];for(var i=0;i<func.inputs.length;i++){var inpt=func.inputs[i];var param=this$1.inputs[i]||this$1.inputs[inpt.name];params.push(param.build(builder,builder.getTypeByFormat(inpt.type)));}code+=params.join(',')+')';return builder.format(code,type,output);};/**
   * @author sunag / http://www.sunag.com.br/
   */var RawNode=function RawNode(value){GLNode.call(this,'v4');this.value=value;};RawNode.prototype=Object.create(GLNode.prototype);RawNode.prototype.constructor=RawNode;GLNode.prototype.generate=function(builder){var material=builder.material;var data=this.value.parseAndBuildCode(builder,this.type);var code=data.code+'\n';if(builder.shader=='vertex'){code+='gl_Position = '+data.result+';';}else{code+='gl_FragColor = '+data.result+';';}return code;};/**
   * @author sunag / http://www.sunag.com.br/
   */var NodeBuilder=function NodeBuilder(material){this.material=material;this.caches=[];this.slots=[];this.keywords={};this.parsing=false;this.optimize=true;this.update();};NodeBuilder.type={float:'fv1',vec2:'v2',vec3:'v3',vec4:'v4',mat4:'v4',int:'iv1'};NodeBuilder.constructors=['float','vec2','vec3','vec4'];NodeBuilder.elements=['x','y','z','w'];NodeBuilder.prototype={constructor:NodeBuilder,addCache:function addCache(name,requires){this.caches.push({name:name||'',requires:requires||{}});return this.update();},removeCache:function removeCache(){this.caches.pop();return this.update();},addSlot:function addSlot(name){this.slots.push({name:name||''});return this.update();},removeSlot:function removeSlot(){this.slots.pop();return this.update();},isCache:function isCache(name){var this$1=this;var i=this.caches.length;while(i--){if(this$1.caches[i].name==name){return true;}}return false;},isSlot:function isSlot(name){var this$1=this;var i=this.slots.length;while(i--){if(this$1.slots[i].name==name){return true;}}return false;},update:function update(){var cache=this.caches[this.caches.length-1];var slot=this.slots[this.slots.length-1];this.slot=slot?slot.name:'';this.cache=cache?cache.name:'';this.requires=cache?cache.requires:{};return this;},require:function require(name,node){this.requires[name]=node;return this;},include:function include(node,parent,source){this.material.include(this,node,parent,source);return this;},colorToVector:function colorToVector(color){return color.replace('r','x').replace('g','y').replace('b','z').replace('a','w');},getConstructorFromLength:function getConstructorFromLength(len){return NodeBuilder.constructors[len-1];},getFormatName:function getFormatName(format){return format.replace(/c/g,'v3').replace(/fv1/g,'v1').replace(/iv1/g,'i');},isFormatMatrix:function isFormatMatrix(format){return /^m/.test(format);},getFormatLength:function getFormatLength(format){return parseInt(this.getFormatName(format).substr(1));},getFormatFromLength:function getFormatFromLength(len){if(len==1){return'fv1';}return'v'+len;},format:function format(code,from,to){var format=this.getFormatName(to+'='+from);switch(format){case'v1=v2':return code+'.x';case'v1=v3':return code+'.x';case'v1=v4':return code+'.x';case'v1=i':return'float('+code+')';case'v2=v1':return'vec2('+code+')';case'v2=v3':return code+'.xy';case'v2=v4':return code+'.xy';case'v2=i':return'vec2(float('+code+'))';case'v3=v1':return'vec3('+code+')';case'v3=v2':return'vec3('+code+',0.0)';case'v3=v4':return code+'.xyz';case'v3=i':return'vec2(float('+code+'))';case'v4=v1':return'vec4('+code+')';case'v4=v2':return'vec4('+code+',0.0,1.0)';case'v4=v3':return'vec4('+code+',1.0)';case'v4=i':return'vec4(float('+code+'))';case'i=v1':return'int('+code+')';case'i=v2':return'int('+code+'.x)';case'i=v3':return'int('+code+'.x)';case'i=v4':return'int('+code+'.x)';}return code;},getTypeByFormat:function getTypeByFormat(format){return NodeBuilder.type[format]||format;},getUuid:function getUuid(uuid,useCache){useCache=useCache!==undefined?useCache:true;if(useCache&&this.cache){uuid=this.cache+'-'+uuid;}return uuid;},getElementByIndex:function getElementByIndex(index){return NodeBuilder.elements[index];},getIndexByElement:function getIndexByElement(elm){return NodeBuilder.elements.indexOf(elm);},isShader:function isShader(shader){return this.shader==shader;},setShader:function setShader(shader){this.shader=shader;return this;}};/**
   * @author sunag / http://www.sunag.com.br/
   */var NodeMaterial=function NodeMaterial(vertex,fragment){ShaderMaterial.call(this);this.vertex=vertex||new RawNode(new PositionNode(PositionNode.PROJECTION));this.fragment=fragment||new RawNode(new ColorNode(0xFF0000));};NodeMaterial.types={t:'sampler2D',tc:'samplerCube',bv1:'bool',iv1:'int',fv1:'float',c:'vec3',v2:'vec2',v3:'vec3',v4:'vec4',m4:'mat4'};NodeMaterial.addShortcuts=function(proto,prop,list){function applyShortcut(prop,name){return{get:function get$$1(){return this[prop][name];},set:function set$$1(val){this[prop][name]=val;}};}return function(){var shortcuts={};for(var i=0;i<list.length;++i){var name=list[i];shortcuts[name]=applyShortcut(prop,name);}Object.defineProperties(proto,shortcuts);}();};NodeMaterial.prototype=Object.create(ShaderMaterial.prototype);NodeMaterial.prototype.constructor=NodeMaterial;NodeMaterial.prototype.updateFrame=function(delta){var this$1=this;for(var i=0;i<this.requestUpdate.length;++i){this$1.requestUpdate[i].updateFrame(delta);}};NodeMaterial.prototype.build=function(){var vertex,fragment;this.defines={};this.uniforms={};this.attributes={};this.extensions={};this.nodeData={};this.vertexUniform=[];this.fragmentUniform=[];this.vars=[];this.vertexTemps=[];this.fragmentTemps=[];this.uniformList=[];this.consts=[];this.functions=[];this.requestUpdate=[];this.requestAttribs={uv:[],color:[]};this.vertexPars='';this.fragmentPars='';this.vertexCode='';this.fragmentCode='';this.vertexNode='';this.fragmentNode='';this.prefixCode=["#ifdef GL_EXT_shader_texture_lod","	#define texCube(a, b) textureCube(a, b)","	#define texCubeBias(a, b, c) textureCubeLodEXT(a, b, c)","	#define tex2D(a, b) texture2D(a, b)","	#define tex2DBias(a, b, c) texture2DLodEXT(a, b, c)","#else","	#define texCube(a, b) textureCube(a, b)","	#define texCubeBias(a, b, c) textureCube(a, b, c)","	#define tex2D(a, b) texture2D(a, b)","	#define tex2DBias(a, b, c) texture2D(a, b, c)","#endif","#include <packing>"].join("\n");var builder=new NodeBuilder(this);vertex=this.vertex.build(builder.setShader('vertex'),'v4');fragment=this.fragment.build(builder.setShader('fragment'),'v4');if(this.requestAttribs.uv[0]){this.addVertexPars('varying vec2 vUv;');this.addFragmentPars('varying vec2 vUv;');this.addVertexCode('vUv = uv;');}if(this.requestAttribs.uv[1]){this.addVertexPars('varying vec2 vUv2; attribute vec2 uv2;');this.addFragmentPars('varying vec2 vUv2;');this.addVertexCode('vUv2 = uv2;');}if(this.requestAttribs.color[0]){this.addVertexPars('varying vec4 vColor; attribute vec4 color;');this.addFragmentPars('varying vec4 vColor;');this.addVertexCode('vColor = color;');}if(this.requestAttribs.color[1]){this.addVertexPars('varying vec4 vColor2; attribute vec4 color2;');this.addFragmentPars('varying vec4 vColor2;');this.addVertexCode('vColor2 = color2;');}if(this.requestAttribs.position){this.addVertexPars('varying vec3 vPosition;');this.addFragmentPars('varying vec3 vPosition;');this.addVertexCode('vPosition = transformed;');}if(this.requestAttribs.worldPosition){// for future update replace from the native "varying vec3 vWorldPosition" for optimization
  this.addVertexPars('varying vec3 vWPosition;');this.addFragmentPars('varying vec3 vWPosition;');this.addVertexCode('vWPosition = worldPosition.xyz;');}if(this.requestAttribs.normal){this.addVertexPars('varying vec3 vObjectNormal;');this.addFragmentPars('varying vec3 vObjectNormal;');this.addVertexCode('vObjectNormal = normal;');}if(this.requestAttribs.worldNormal){this.addVertexPars('varying vec3 vWNormal;');this.addFragmentPars('varying vec3 vWNormal;');this.addVertexCode('vWNormal = ( modelMatrix * vec4( objectNormal, 0.0 ) ).xyz;');}this.lights=this.requestAttribs.light;this.transparent=this.requestAttribs.transparent||this.blending>NormalBlending;this.vertexShader=[this.prefixCode,this.vertexPars,this.getCodePars(this.vertexUniform,'uniform'),this.getIncludes(this.consts['vertex']),this.getIncludes(this.functions['vertex']),'void main(){',this.getCodePars(this.vertexTemps),vertex,this.vertexCode,'}'].join("\n");this.fragmentShader=[this.prefixCode,this.fragmentPars,this.getCodePars(this.fragmentUniform,'uniform'),this.getIncludes(this.consts['fragment']),this.getIncludes(this.functions['fragment']),'void main(){',this.getCodePars(this.fragmentTemps),this.fragmentCode,fragment,'}'].join("\n");this.needsUpdate=true;this.dispose();// force update
  return this;};NodeMaterial.prototype.define=function(name,value){this.defines[name]=value==undefined?1:value;};NodeMaterial.prototype.isDefined=function(name){return this.defines[name]!=undefined;};NodeMaterial.prototype.mergeUniform=function(uniforms){var this$1=this;for(var name in uniforms){this$1.uniforms[name]=uniforms[name];}};NodeMaterial.prototype.createUniform=function(type,value,ns,needsUpdate){var index=this.uniformList.length;var uniform={type:type,value:value,name:ns?ns:'nVu'+index,needsUpdate:needsUpdate};this.uniformList.push(uniform);return uniform;};NodeMaterial.prototype.getVertexTemp=function(uuid,type,ns){var data=this.vertexTemps[uuid];if(!data){var index=this.vertexTemps.length,name=ns?ns:'nVt'+index;data={name:name,type:type};this.vertexTemps.push(data);this.vertexTemps[uuid]=data;}return data;};NodeMaterial.prototype.getFragmentTemp=function(uuid,type,ns){var data=this.fragmentTemps[uuid];if(!data){var index=this.fragmentTemps.length,name=ns?ns:'nVt'+index;data={name:name,type:type};this.fragmentTemps.push(data);this.fragmentTemps[uuid]=data;}return data;};NodeMaterial.prototype.getVar=function(uuid,type,ns){var data=this.vars[uuid];if(!data){var index=this.vars.length,name=ns?ns:'nVv'+index;data={name:name,type:type};this.vars.push(data);this.vars[uuid]=data;this.addVertexPars('varying '+type+' '+name+';');this.addFragmentPars('varying '+type+' '+name+';');}return data;};NodeMaterial.prototype.getAttribute=function(name,type){if(!this.attributes[name]){var varying=this.getVar(name,type);this.addVertexPars('attribute '+type+' '+name+';');this.addVertexCode(varying.name+' = '+name+';');this.attributes[name]={varying:varying,name:name,type:type};}return this.attributes[name];};NodeMaterial.prototype.getIncludes=function(){function sortByPosition(a,b){return a.deps.length-b.deps.length;}return function(incs){if(!incs){return'';}var code='',incs=incs.sort(sortByPosition);for(var i=0;i<incs.length;i++){if(incs[i].src){code+=incs[i].src+'\n';}}return code;};}();NodeMaterial.prototype.addVertexPars=function(code){this.vertexPars+=code+'\n';};NodeMaterial.prototype.addFragmentPars=function(code){this.fragmentPars+=code+'\n';};NodeMaterial.prototype.addVertexCode=function(code){this.vertexCode+=code+'\n';};NodeMaterial.prototype.addFragmentCode=function(code){this.fragmentCode+=code+'\n';};NodeMaterial.prototype.addVertexNode=function(code){this.vertexNode+=code+'\n';};NodeMaterial.prototype.clearVertexNode=function(){var code=this.vertexNode;this.vertexNode='';return code;};NodeMaterial.prototype.addFragmentNode=function(code){this.fragmentNode+=code+'\n';};NodeMaterial.prototype.clearFragmentNode=function(){var code=this.fragmentNode;this.fragmentNode='';return code;};NodeMaterial.prototype.getCodePars=function(pars,prefix){prefix=prefix||'';var code='';for(var i=0,l=pars.length;i<l;++i){var parsType=pars[i].type;var parsName=pars[i].name;var parsValue=pars[i].value;if(parsType=='t'&&parsValue instanceof CubeTexture){parsType='tc';}var type=NodeMaterial.types[parsType];if(type==undefined){throw new Error("Node pars "+parsType+" not found.");}code+=prefix+' '+type+' '+parsName+';\n';}return code;};NodeMaterial.prototype.createVertexUniform=function(type,value,ns,needsUpdate){var uniform=this.createUniform(type,value,ns,needsUpdate);this.vertexUniform.push(uniform);this.vertexUniform[uniform.name]=uniform;this.uniforms[uniform.name]=uniform;return uniform;};NodeMaterial.prototype.createFragmentUniform=function(type,value,ns,needsUpdate){var uniform=this.createUniform(type,value,ns,needsUpdate);this.fragmentUniform.push(uniform);this.fragmentUniform[uniform.name]=uniform;this.uniforms[uniform.name]=uniform;return uniform;};NodeMaterial.prototype.getDataNode=function(uuid){return this.nodeData[uuid]=this.nodeData[uuid]||{};};NodeMaterial.prototype.include=function(builder,node,parent,source){var this$1=this;var includes;node=typeof node==='string'?NodeLib.get(node):node;if(node instanceof FunctionNode){includes=this.functions[builder.shader]=this.functions[builder.shader]||[];}else if(node instanceof ConstNode){includes=this.consts[builder.shader]=this.consts[builder.shader]||[];}var included=includes[node.name];if(!included){included=includes[node.name]={node:node,deps:[]};includes.push(included);included.src=node.build(builder,'source');}if(node instanceof FunctionNode&&parent&&includes[parent.name]&&includes[parent.name].deps.indexOf(node)==-1){includes[parent.name].deps.push(node);if(node.includes&&node.includes.length){var i=0;do{this$1.include(builder,node.includes[i++],parent);}while(i<node.includes.length);}}if(source){included.src=source;}};/**
   * @author sunag / http://www.sunag.com.br/
   */var ColorNode=function ColorNode(color){InputNode.call(this,'c');this.value=new Color$1(color||0);};ColorNode.prototype=Object.create(InputNode.prototype);ColorNode.prototype.constructor=ColorNode;NodeMaterial.addShortcuts(ColorNode.prototype,'value',['r','g','b']);/**
   * @author sunag / http://www.sunag.com.br/
   */var CubeTextureNode=function CubeTextureNode(value,coord,bias){InputNode.call(this,'v4',{shared:true});this.value=value;this.coord=coord||new ReflectNode();this.bias=bias;};CubeTextureNode.prototype=Object.create(InputNode.prototype);CubeTextureNode.prototype.constructor=CubeTextureNode;CubeTextureNode.prototype.getTexture=function(builder,output){return InputNode.prototype.generate.call(this,builder,output,this.value.uuid,'t');};CubeTextureNode.prototype.generate=function(builder,output){if(output==='samplerCube'){return this.getTexture(builder,output);}var cubetex=this.getTexture(builder,output);var coord=this.coord.build(builder,'v3');var bias=this.bias?this.bias.build(builder,'fv1'):undefined;if(bias==undefined&&builder.requires.bias){bias=builder.requires.bias.build(builder,'fv1');}var code;if(bias){code='texCubeBias('+cubetex+','+coord+','+bias+')';}else{code='texCube('+cubetex+','+coord+')';}if(builder.isSlot('color')){code='mapTexelToLinear('+code+')';}else if(builder.isSlot('emissive')){code='emissiveMapTexelToLinear('+code+')';}else if(builder.isSlot('environment')){code='envMapTexelToLinear('+code+')';}return builder.format(code,this.type,output);};/**
   * @author sunag / http://www.sunag.com.br/
   */var IntNode=function IntNode(value){InputNode.call(this,'iv1');this.value=[Math.floor(value||0)];};IntNode.prototype=Object.create(InputNode.prototype);IntNode.prototype.constructor=IntNode;Object.defineProperties(IntNode.prototype,{number:{get:function get$$1(){return this.value[0];},set:function set$$1(val){this.value[0]=Math.floor(val);}}});/**
   * @author sunag / http://www.sunag.com.br/
   */var Matrix4Node=function Matrix4Node(matrix){InputNode.call(this,'m4');this.value=matrix||new Matrix4();};Matrix4Node.prototype=Object.create(InputNode.prototype);Matrix4Node.prototype.constructor=Matrix4Node;/**
   * @author sunag / http://www.sunag.com.br/
   */var OperatorNode=function OperatorNode(a,b,op){TempNode.call(this);this.a=a;this.b=b;this.op=op||OperatorNode.ADD;};OperatorNode.ADD='+';OperatorNode.SUB='-';OperatorNode.MUL='*';OperatorNode.DIV='/';OperatorNode.prototype=Object.create(TempNode.prototype);OperatorNode.prototype.constructor=OperatorNode;OperatorNode.prototype.getType=function(builder){var a=this.a.getType(builder);var b=this.b.getType(builder);if(builder.isFormatMatrix(a)){return'v4';}else if(builder.getFormatLength(b)>builder.getFormatLength(a)){// use the greater length vector
  return b;}return a;};OperatorNode.prototype.generate=function(builder,output){var material=builder.material,data=material.getDataNode(this.uuid);var type=this.getType(builder);var a=this.a.build(builder,type);var b=this.b.build(builder,type);return builder.format('('+a+this.op+b+')',type,output);};/**
   * @author sunag / http://www.sunag.com.br/
   */var TextureNode=function TextureNode(value,coord,bias,project){InputNode.call(this,'v4',{shared:true});this.value=value;this.coord=coord||new UVNode();this.bias=bias;this.project=project!==undefined?project:false;};TextureNode.prototype=Object.create(InputNode.prototype);TextureNode.prototype.constructor=TextureNode;TextureNode.prototype.getTexture=function(builder,output){return InputNode.prototype.generate.call(this,builder,output,this.value.uuid,'t');};TextureNode.prototype.generate=function(builder,output){if(output==='sampler2D'){return this.getTexture(builder,output);}var tex=this.getTexture(builder,output);var coord=this.coord.build(builder,this.project?'v4':'v2');var bias=this.bias?this.bias.build(builder,'fv1'):undefined;if(bias==undefined&&builder.requires.bias){bias=builder.requires.bias.build(builder,'fv1');}var method,code;if(this.project){method='texture2DProj';}else{method=bias?'tex2DBias':'tex2D';}if(bias){code=method+'('+tex+','+coord+','+bias+')';}else{code=method+'('+tex+','+coord+')';}if(builder.isSlot('color')){code='mapTexelToLinear('+code+')';}else if(builder.isSlot('emissive')){code='emissiveMapTexelToLinear('+code+')';}else if(builder.isSlot('environment')){code='envMapTexelToLinear('+code+')';}return builder.format(code,this.type,output);};var ReflectorNode=function ReflectorNode(mirror,camera,options){TempNode.call(this,'v4');this.mirror=mirror;this.textureMatrix=new Matrix4Node(this.mirror.material.uniforms.textureMatrix.value);this.localPosition=new PositionNode(PositionNode.LOCAL);this.coord=new OperatorNode(this.textureMatrix,this.localPosition,OperatorNode.MUL);this.coordResult=new OperatorNode(null,this.coord,OperatorNode.ADD);this.texture=new TextureNode(this.mirror.material.uniforms.tDiffuse.value,this.coord,null,true);};ReflectorNode.prototype=Object.create(TempNode.prototype);ReflectorNode.prototype.constructor=ReflectorNode;ReflectorNode.prototype.generate=function(builder,output){var material=builder.material;if(builder.isShader('fragment')){this.coordResult.a=this.offset;this.texture.coord=this.offset?this.coordResult:this.coord;if(output==='sampler2D'){return this.texture.build(builder,output);}return builder.format(this.texture.build(builder,this.type),this.type,output);}else{console.warn("ReflectorNode is not compatible with "+builder.shader+" shader.");return builder.format('vec4(0.0)',this.type,output);}};/**
   * @author sunag / http://www.sunag.com.br/
   */var ScreenNode=function ScreenNode(coord){TextureNode.call(this,undefined,coord);};ScreenNode.prototype=Object.create(TextureNode.prototype);ScreenNode.prototype.constructor=ScreenNode;ScreenNode.prototype.isUnique=function(){return true;};ScreenNode.prototype.getTexture=function(builder,output){return InputNode.prototype.generate.call(this,builder,output,this.getUuid(),'t','renderTexture');};/**
   * @author sunag / http://www.sunag.com.br/
   */var Vector2Node=function Vector2Node(x,y){InputNode.call(this,'v2');this.value=new Vector2$1(x,y);};Vector2Node.prototype=Object.create(InputNode.prototype);Vector2Node.prototype.constructor=Vector2Node;NodeMaterial.addShortcuts(Vector2Node.prototype,'value',['x','y']);/**
   * @author sunag / http://www.sunag.com.br/
   */var Vector3Node=function Vector3Node(x,y,z){InputNode.call(this,'v3');this.type='v3';this.value=new Vector3$1(x,y,z);};Vector3Node.prototype=Object.create(InputNode.prototype);Vector3Node.prototype.constructor=Vector3Node;NodeMaterial.addShortcuts(Vector3Node.prototype,'value',['x','y','z']);/**
   * @author sunag / http://www.sunag.com.br/
   */var Vector4Node=function Vector4Node(x,y,z,w){InputNode.call(this,'v4');this.value=new Vector4$1(x,y,z,w);};Vector4Node.prototype=Object.create(InputNode.prototype);Vector4Node.prototype.constructor=Vector4Node;NodeMaterial.addShortcuts(Vector4Node.prototype,'value',['x','y','z','w']);/**
   * @author sunag / http://www.sunag.com.br/
   */var PhongNode=function PhongNode(){GLNode.call(this);this.color=new ColorNode(0xEEEEEE);this.specular=new ColorNode(0x111111);this.shininess=new FloatNode(30);};PhongNode.prototype=Object.create(GLNode.prototype);PhongNode.prototype.constructor=PhongNode;PhongNode.prototype.build=function(builder){var material=builder.material;var code;material.define('PHONG');material.define('ALPHATEST','0.0');material.requestAttribs.light=true;if(builder.isShader('vertex')){var transform=this.transform?this.transform.parseAndBuildCode(builder,'v3',{cache:'transform'}):undefined;material.mergeUniform(UniformsUtils.merge([UniformsLib["fog"],UniformsLib["lights"]]));material.addVertexPars(["varying vec3 vViewPosition;","#ifndef FLAT_SHADED","	varying vec3 vNormal;","#endif","#include <common>","#include <fog_pars_vertex>","#include <morphtarget_pars_vertex>","#include <skinning_pars_vertex>","#include <shadowmap_pars_vertex>","#include <logdepthbuf_pars_vertex>"].join("\n"));var output=["#include <beginnormal_vertex>","#include <morphnormal_vertex>","#include <skinbase_vertex>","#include <skinnormal_vertex>","#include <defaultnormal_vertex>","#ifndef FLAT_SHADED",// Normal computed with derivatives when FLAT_SHADED
  "	vNormal = normalize( transformedNormal );","#endif","#include <begin_vertex>"];if(transform){output.push(transform.code,"transformed = "+transform.result+";");}output.push("	#include <morphtarget_vertex>","	#include <skinning_vertex>","	#include <project_vertex>","	#include <fog_vertex>","	#include <logdepthbuf_vertex>","	vViewPosition = - mvPosition.xyz;","	#include <worldpos_vertex>","	#include <shadowmap_vertex>");code=output.join("\n");}else{// parse all nodes to reuse generate codes
  this.color.parse(builder,{slot:'color'});this.specular.parse(builder);this.shininess.parse(builder);if(this.alpha){this.alpha.parse(builder);}if(this.normal){this.normal.parse(builder);}if(this.normalScale&&this.normal){this.normalScale.parse(builder);}if(this.light){this.light.parse(builder,{cache:'light'});}if(this.ao){this.ao.parse(builder);}if(this.ambient){this.ambient.parse(builder);}if(this.shadow){this.shadow.parse(builder);}if(this.emissive){this.emissive.parse(builder,{slot:'emissive'});}if(this.environment){this.environment.parse(builder,{slot:'environment'});}if(this.environmentAlpha&&this.environment){this.environmentAlpha.parse(builder);}// build code
  var color=this.color.buildCode(builder,'c',{slot:'color'});var specular=this.specular.buildCode(builder,'c');var shininess=this.shininess.buildCode(builder,'fv1');var alpha=this.alpha?this.alpha.buildCode(builder,'fv1'):undefined;var normal=this.normal?this.normal.buildCode(builder,'v3'):undefined;var normalScale=this.normalScale&&this.normal?this.normalScale.buildCode(builder,'v2'):undefined;var light=this.light?this.light.buildCode(builder,'v3',{cache:'light'}):undefined;var ao=this.ao?this.ao.buildCode(builder,'fv1'):undefined;var ambient=this.ambient?this.ambient.buildCode(builder,'c'):undefined;var shadow=this.shadow?this.shadow.buildCode(builder,'c'):undefined;var emissive=this.emissive?this.emissive.buildCode(builder,'c',{slot:'emissive'}):undefined;var environment=this.environment?this.environment.buildCode(builder,'c',{slot:'environment'}):undefined;var environmentAlpha=this.environmentAlpha&&this.environment?this.environmentAlpha.buildCode(builder,'fv1'):undefined;material.requestAttribs.transparent=alpha!=undefined;material.addFragmentPars(["#include <common>","#include <fog_pars_fragment>","#include <bsdfs>","#include <lights_pars>","#include <lights_phong_pars_fragment>","#include <shadowmap_pars_fragment>","#include <logdepthbuf_pars_fragment>"].join("\n"));var output=[// prevent undeclared normal
  "#include <normal_fragment>",// prevent undeclared material
  "	BlinnPhongMaterial material;",color.code,"	vec3 diffuseColor = "+color.result+";","	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );","#include <logdepthbuf_fragment>",specular.code,"	vec3 specular = "+specular.result+";",shininess.code,"	float shininess = max(0.0001,"+shininess.result+");","	float specularStrength = 1.0;"// Ignored in MaterialNode ( replace to specular )
  ];if(alpha){output.push(alpha.code,'if ( '+alpha.result+' <= ALPHATEST ) discard;');}if(normal){builder.include('perturbNormal2Arb');output.push(normal.code);if(normalScale){output.push(normalScale.code);}output.push('normal = perturbNormal2Arb(-vViewPosition,normal,'+normal.result+','+new UVNode().build(builder,'v2')+','+(normalScale?normalScale.result:'vec2( 1.0 )')+');');}// optimization for now
  output.push('material.diffuseColor = '+(light?'vec3( 1.0 )':'diffuseColor')+';');output.push(// accumulation
  'material.specularColor = specular;','material.specularShininess = shininess;','material.specularStrength = specularStrength;',"#include <lights_template>");if(light){output.push(light.code,"reflectedLight.directDiffuse = "+light.result+";");// apply color
  output.push("reflectedLight.directDiffuse *= diffuseColor;","reflectedLight.indirectDiffuse *= diffuseColor;");}if(ao){output.push(ao.code,"reflectedLight.indirectDiffuse *= "+ao.result+";");}if(ambient){output.push(ambient.code,"reflectedLight.indirectDiffuse += "+ambient.result+";");}if(shadow){output.push(shadow.code,"reflectedLight.directDiffuse *= "+shadow.result+";","reflectedLight.directSpecular *= "+shadow.result+";");}if(emissive){output.push(emissive.code,"reflectedLight.directDiffuse += "+emissive.result+";");}output.push("vec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + reflectedLight.directSpecular;");if(environment){output.push(environment.code);if(environmentAlpha){output.push(environmentAlpha.code,"outgoingLight = mix( outgoingLight, "+environment.result+", "+environmentAlpha.result+" );");}else{output.push("outgoingLight = "+environment.result+";");}}if(alpha){output.push("gl_FragColor = vec4( outgoingLight, "+alpha.result+" );");}else{output.push("gl_FragColor = vec4( outgoingLight, 1.0 );");}output.push("#include <premultiplied_alpha_fragment>","#include <tonemapping_fragment>","#include <encodings_fragment>","#include <fog_fragment>");code=output.join("\n");}return code;};/**
   * @author sunag / http://www.sunag.com.br/
   */var PhongNodeMaterial=function PhongNodeMaterial(){this.node=new PhongNode();NodeMaterial.call(this,this.node,this.node);};PhongNodeMaterial.prototype=Object.create(NodeMaterial.prototype);PhongNodeMaterial.prototype.constructor=PhongNodeMaterial;NodeMaterial.addShortcuts(PhongNodeMaterial.prototype,'node',['color','alpha','specular','shininess','normal','normalScale','emissive','ambient','light','shadow','ao','environment','environmentAlpha','transform']);/**
   * @author sunag / http://www.sunag.com.br/
   */var SpriteNode=function SpriteNode(){GLNode.call(this);this.color=new ColorNode(0xEEEEEE);this.spherical=true;};SpriteNode.prototype=Object.create(GLNode.prototype);SpriteNode.prototype.constructor=SpriteNode;SpriteNode.prototype.build=function(builder){var material=builder.material;var output;material.define('SPRITE');material.requestAttribs.light=false;material.requestAttribs.transparent=this.alpha!=undefined;if(builder.isShader('vertex')){var transform=this.transform?this.transform.parseAndBuildCode(builder,'v3',{cache:'transform'}):undefined;material.mergeUniform(UniformsUtils.merge([UniformsLib["fog"]]));material.addVertexPars(["#include <fog_pars_vertex>"].join("\n"));output=["#include <begin_vertex>"];if(transform){output.push(transform.code,"transformed = "+transform.result+";");}output.push("#include <project_vertex>","#include <fog_vertex>",'mat4 modelViewMtx = modelViewMatrix;','mat4 modelMtx = modelMatrix;',// ignore position from modelMatrix (use vary position)
  'modelMtx[3][0] = 0.0;','modelMtx[3][1] = 0.0;','modelMtx[3][2] = 0.0;');if(!this.spherical){output.push('modelMtx[1][1] = 1.0;');}output.push(// http://www.geeks3d.com/20140807/billboarding-vertex-shader-glsl/
  // First colunm.
  'modelViewMtx[0][0] = 1.0;','modelViewMtx[0][1] = 0.0;','modelViewMtx[0][2] = 0.0;');if(this.spherical){output.push(// Second colunm.
  'modelViewMtx[1][0] = 0.0;','modelViewMtx[1][1] = 1.0;','modelViewMtx[1][2] = 0.0;');}output.push(// Thrid colunm.
  'modelViewMtx[2][0] = 0.0;','modelViewMtx[2][1] = 0.0;','modelViewMtx[2][2] = 1.0;',// apply
  'gl_Position = projectionMatrix * modelViewMtx * modelMtx * vec4( transformed, 1.0 );');}else{material.addFragmentPars(["#include <fog_pars_fragment>"].join("\n"));// parse all nodes to reuse generate codes
  this.color.parse(builder,{slot:'color'});if(this.alpha){this.alpha.parse(builder);}// build code
  var color=this.color.buildCode(builder,'c',{slot:'color'});var alpha=this.alpha?this.alpha.buildCode(builder,'fv1'):undefined;output=[color.code];if(alpha){output.push(alpha.code,"gl_FragColor = vec4( "+color.result+", "+alpha.result+" );");}else{output.push("gl_FragColor = vec4( "+color.result+", 1.0 );");}output.push("#include <fog_fragment>");}return output.join("\n");};/**
   * @author sunag / http://www.sunag.com.br/
   */var SpriteNodeMaterial=function SpriteNodeMaterial(){this.node=new SpriteNode();NodeMaterial.call(this,this.node,this.node);};SpriteNodeMaterial.prototype=Object.create(NodeMaterial.prototype);SpriteNodeMaterial.prototype.constructor=SpriteNodeMaterial;NodeMaterial.addShortcuts(SpriteNodeMaterial.prototype,'node',['color','alpha','transform','spherical']);/**
   * @author sunag / http://www.sunag.com.br/
   */var RoughnessToBlinnExponentNode=function RoughnessToBlinnExponentNode(){TempNode.call(this,'fv1');};RoughnessToBlinnExponentNode.getSpecularMIPLevel=new FunctionNode([// taken from here: http://casual-effects.blogspot.ca/2011/08/plausible-environment-lighting-in-two.html
  "float getSpecularMIPLevel( const in float blinnShininessExponent, const in int maxMIPLevel ) {",//float envMapWidth = pow( 2.0, maxMIPLevelScalar );
  //float desiredMIPLevel = log2( envMapWidth * sqrt( 3.0 ) ) - 0.5 * log2( pow2( blinnShininessExponent ) + 1.0 );
  "float maxMIPLevelScalar = float( maxMIPLevel );","float desiredMIPLevel = maxMIPLevelScalar - 0.79248 - 0.5 * log2( pow2( blinnShininessExponent ) + 1.0 );",// clamp to allowable LOD ranges.
  "return clamp( desiredMIPLevel, 0.0, maxMIPLevelScalar );","}"].join("\n"));RoughnessToBlinnExponentNode.prototype=Object.create(TempNode.prototype);RoughnessToBlinnExponentNode.prototype.constructor=RoughnessToBlinnExponentNode;RoughnessToBlinnExponentNode.prototype.generate=function(builder,output){var material=builder.material;if(builder.isShader('fragment')){if(material.isDefined('PHYSICAL')){builder.include(RoughnessToBlinnExponentNode.getSpecularMIPLevel);if(builder.isCache('clearCoat')){return builder.format('getSpecularMIPLevel( Material_ClearCoat_BlinnShininessExponent( material ), 8 )',this.type,output);}else{return builder.format('getSpecularMIPLevel( Material_BlinnShininessExponent( material ), 8 )',this.type,output);}}else{console.warn("RoughnessToBlinnExponentNode is only compatible with PhysicalMaterial.");return builder.format('0.0',this.type,output);}}else{console.warn("RoughnessToBlinnExponentNode is not compatible with "+builder.shader+" shader.");return builder.format('0.0',this.type,output);}};/**
   * @author sunag / http://www.sunag.com.br/
   */var StandardNode=function StandardNode(){GLNode.call(this);this.color=new ColorNode(0xEEEEEE);this.roughness=new FloatNode(0.5);this.metalness=new FloatNode(0.5);};StandardNode.prototype=Object.create(GLNode.prototype);StandardNode.prototype.constructor=StandardNode;StandardNode.prototype.build=function(builder){var material=builder.material;var code;material.define('PHYSICAL');if(!this.clearCoat&&!this.clearCoatRoughness){material.define('STANDARD');}material.define('ALPHATEST','0.0');material.requestAttribs.light=true;material.extensions.shaderTextureLOD=true;if(builder.isShader('vertex')){var transform=this.transform?this.transform.parseAndBuildCode(builder,'v3',{cache:'transform'}):undefined;material.mergeUniform(UniformsUtils.merge([UniformsLib["fog"],UniformsLib["lights"]]));material.addVertexPars(["varying vec3 vViewPosition;","#ifndef FLAT_SHADED","	varying vec3 vNormal;","#endif","#include <common>","#include <fog_pars_vertex>","#include <morphtarget_pars_vertex>","#include <skinning_pars_vertex>","#include <shadowmap_pars_vertex>","#include <logdepthbuf_pars_vertex>"].join("\n"));var output=["#include <beginnormal_vertex>","#include <morphnormal_vertex>","#include <skinbase_vertex>","#include <skinnormal_vertex>","#include <defaultnormal_vertex>","#include <logdepthbuf_pars_vertex>","#include <logdepthbuf_pars_vertex>","#include <logdepthbuf_pars_vertex>","#ifndef FLAT_SHADED",// Normal computed with derivatives when FLAT_SHADED
  "	vNormal = normalize( transformedNormal );","#endif","#include <begin_vertex>"];if(transform){output.push(transform.code,"transformed = "+transform.result+";");}output.push("#include <morphtarget_vertex>","#include <skinning_vertex>","#include <project_vertex>","#include <fog_vertex>","#include <logdepthbuf_vertex>","	vViewPosition = - mvPosition.xyz;","#include <worldpos_vertex>","#include <shadowmap_vertex>");code=output.join("\n");}else{// blur textures for PBR effect
  var requires={bias:new RoughnessToBlinnExponentNode(),offsetU:0,offsetV:0};var useClearCoat=!material.isDefined('STANDARD');// parse all nodes to reuse generate codes
  this.color.parse(builder,{slot:'color'});this.roughness.parse(builder);this.metalness.parse(builder);if(this.alpha){this.alpha.parse(builder);}if(this.normal){this.normal.parse(builder);}if(this.normalScale&&this.normal){this.normalScale.parse(builder);}if(this.clearCoat){this.clearCoat.parse(builder);}if(this.clearCoatRoughness){this.clearCoatRoughness.parse(builder);}if(this.reflectivity){this.reflectivity.parse(builder);}if(this.light){this.light.parse(builder,{cache:'light'});}if(this.ao){this.ao.parse(builder);}if(this.ambient){this.ambient.parse(builder);}if(this.shadow){this.shadow.parse(builder);}if(this.emissive){this.emissive.parse(builder,{slot:'emissive'});}if(this.environment){this.environment.parse(builder,{cache:'env',requires:requires,slot:'environment'});}// isolate environment from others inputs ( see TextureNode, CubeTextureNode )
  // build code
  var color=this.color.buildCode(builder,'c',{slot:'color'});var roughness=this.roughness.buildCode(builder,'fv1');var metalness=this.metalness.buildCode(builder,'fv1');var alpha=this.alpha?this.alpha.buildCode(builder,'fv1'):undefined;var normal=this.normal?this.normal.buildCode(builder,'v3'):undefined;var normalScale=this.normalScale&&this.normal?this.normalScale.buildCode(builder,'v2'):undefined;var clearCoat=this.clearCoat?this.clearCoat.buildCode(builder,'fv1'):undefined;var clearCoatRoughness=this.clearCoatRoughness?this.clearCoatRoughness.buildCode(builder,'fv1'):undefined;var reflectivity=this.reflectivity?this.reflectivity.buildCode(builder,'fv1'):undefined;var light=this.light?this.light.buildCode(builder,'v3',{cache:'light'}):undefined;var ao=this.ao?this.ao.buildCode(builder,'fv1'):undefined;var ambient=this.ambient?this.ambient.buildCode(builder,'c'):undefined;var shadow=this.shadow?this.shadow.buildCode(builder,'c'):undefined;var emissive=this.emissive?this.emissive.buildCode(builder,'c',{slot:'emissive'}):undefined;var environment=this.environment?this.environment.buildCode(builder,'c',{cache:'env',requires:requires,slot:'environment'}):undefined;var clearCoatEnv=useClearCoat&&environment?this.environment.buildCode(builder,'c',{cache:'clearCoat',requires:requires,slot:'environment'}):undefined;material.requestAttribs.transparent=alpha!=undefined;material.addFragmentPars(["varying vec3 vViewPosition;","#ifndef FLAT_SHADED","	varying vec3 vNormal;","#endif","#include <common>","#include <fog_pars_fragment>","#include <bsdfs>","#include <lights_pars>","#include <lights_physical_pars_fragment>","#include <shadowmap_pars_fragment>","#include <logdepthbuf_pars_fragment>","#include <logdepthbuf_vertex>"].join("\n"));var output=[// prevent undeclared normal
  "	#include <normal_fragment>",// prevent undeclared material
  "	PhysicalMaterial material;","	material.diffuseColor = vec3( 1.0 );",color.code,"	vec3 diffuseColor = "+color.result+";","	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );","#include <logdepthbuf_fragment>",roughness.code,"	float roughnessFactor = "+roughness.result+";",metalness.code,"	float metalnessFactor = "+metalness.result+";"];if(alpha){output.push(alpha.code,'if ( '+alpha.result+' <= ALPHATEST ) discard;');}if(normal){builder.include('perturbNormal2Arb');output.push(normal.code);if(normalScale){output.push(normalScale.code);}output.push('normal = perturbNormal2Arb(-vViewPosition,normal,'+normal.result+','+new UVNode().build(builder,'v2')+','+(normalScale?normalScale.result:'vec2( 1.0 )')+');');}// optimization for now
  output.push('material.diffuseColor = '+(light?'vec3( 1.0 )':'diffuseColor * (1.0 - metalnessFactor)')+';');output.push(// accumulation
  'material.specularRoughness = clamp( roughnessFactor, DEFAULT_SPECULAR_COEFFICIENT, 1.0 );'// disney's remapping of [ 0 1 ] roughness to [ 0.001, 1 ]
  );if(clearCoat){output.push(clearCoat.code,'material.clearCoat = saturate( '+clearCoat.result+' );');}else if(useClearCoat){output.push('material.clearCoat = 0.0;');}if(clearCoatRoughness){output.push(clearCoatRoughness.code,'material.clearCoatRoughness = clamp( '+clearCoatRoughness.result+', DEFAULT_SPECULAR_COEFFICIENT, 1.0 );');}else if(useClearCoat){output.push('material.clearCoatRoughness = 0.0;');}if(reflectivity){output.push(reflectivity.code,'material.specularColor = mix( vec3( MAXIMUM_SPECULAR_COEFFICIENT * pow2( '+reflectivity.result+' ) ), diffuseColor, metalnessFactor );');}else{output.push('material.specularColor = mix( vec3( DEFAULT_SPECULAR_COEFFICIENT ), diffuseColor, metalnessFactor );');}output.push("#include <lights_template>");if(light){output.push(light.code,"reflectedLight.directDiffuse = "+light.result+";");// apply color
  output.push("diffuseColor *= 1.0 - metalnessFactor;","reflectedLight.directDiffuse *= diffuseColor;","reflectedLight.indirectDiffuse *= diffuseColor;");}if(ao){output.push(ao.code,"reflectedLight.indirectDiffuse *= "+ao.result+";","float dotNV = saturate( dot( geometry.normal, geometry.viewDir ) );","reflectedLight.indirectSpecular *= computeSpecularOcclusion( dotNV, "+ao.result+", material.specularRoughness );");}if(ambient){output.push(ambient.code,"reflectedLight.indirectDiffuse += "+ambient.result+";");}if(shadow){output.push(shadow.code,"reflectedLight.directDiffuse *= "+shadow.result+";","reflectedLight.directSpecular *= "+shadow.result+";");}if(emissive){output.push(emissive.code,"reflectedLight.directDiffuse += "+emissive.result+";");}if(environment){output.push(environment.code);if(clearCoatEnv){output.push(clearCoatEnv.code,"vec3 clearCoatRadiance = "+clearCoatEnv.result+";");}else{output.push("vec3 clearCoatRadiance = vec3( 0.0 );");}output.push("RE_IndirectSpecular("+environment.result+", clearCoatRadiance, geometry, material, reflectedLight );");}output.push("vec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + reflectedLight.directSpecular + reflectedLight.indirectSpecular;");if(alpha){output.push("gl_FragColor = vec4( outgoingLight, "+alpha.result+" );");}else{output.push("gl_FragColor = vec4( outgoingLight, 1.0 );");}output.push("#include <premultiplied_alpha_fragment>","#include <tonemapping_fragment>","#include <encodings_fragment>","#include <fog_fragment>");code=output.join("\n");}return code;};/**
   * @author sunag / http://www.sunag.com.br/
   */var StandardNodeMaterial=function StandardNodeMaterial(){this.node=new StandardNode();NodeMaterial.call(this,this.node,this.node);};StandardNodeMaterial.prototype=Object.create(NodeMaterial.prototype);StandardNodeMaterial.prototype.constructor=StandardNodeMaterial;NodeMaterial.addShortcuts(StandardNodeMaterial.prototype,'node',['color','alpha','roughness','metalness','reflectivity','clearCoat','clearCoatRoughness','normal','normalScale','emissive','ambient','light','shadow','ao','environment','transform']);/**
   * @author sunag / http://www.sunag.com.br/
   */var Math1Node=function Math1Node(a,method){TempNode.call(this);this.a=a;this.method=method||Math1Node.SIN;};Math1Node.RAD='radians';Math1Node.DEG='degrees';Math1Node.EXP='exp';Math1Node.EXP2='exp2';Math1Node.LOG='log';Math1Node.LOG2='log2';Math1Node.SQRT='sqrt';Math1Node.INV_SQRT='inversesqrt';Math1Node.FLOOR='floor';Math1Node.CEIL='ceil';Math1Node.NORMALIZE='normalize';Math1Node.FRACT='fract';Math1Node.SAT='saturate';Math1Node.SIN='sin';Math1Node.COS='cos';Math1Node.TAN='tan';Math1Node.ASIN='asin';Math1Node.ACOS='acos';Math1Node.ARCTAN='atan';Math1Node.ABS='abs';Math1Node.SIGN='sign';Math1Node.LENGTH='length';Math1Node.NEGATE='negate';Math1Node.INVERT='invert';Math1Node.prototype=Object.create(TempNode.prototype);Math1Node.prototype.constructor=Math1Node;Math1Node.prototype.getType=function(builder){switch(this.method){case Math1Node.LENGTH:return'fv1';}return this.a.getType(builder);};Math1Node.prototype.generate=function(builder,output){var material=builder.material;var type=this.getType(builder);var result=this.a.build(builder,type);switch(this.method){case Math1Node.NEGATE:result='(-'+result+')';break;case Math1Node.INVERT:result='(1.0-'+result+')';break;default:result=this.method+'('+result+')';break;}return builder.format(result,type,output);};/**
   * @author sunag / http://www.sunag.com.br/
   */var Math2Node=function Math2Node(a,b,method){TempNode.call(this);this.a=a;this.b=b;this.method=method||Math2Node.DISTANCE;};Math2Node.MIN='min';Math2Node.MAX='max';Math2Node.MOD='mod';Math2Node.STEP='step';Math2Node.REFLECT='reflect';Math2Node.DISTANCE='distance';Math2Node.DOT='dot';Math2Node.CROSS='cross';Math2Node.POW='pow';Math2Node.prototype=Object.create(TempNode.prototype);Math2Node.prototype.constructor=Math2Node;Math2Node.prototype.getInputType=function(builder){// use the greater length vector
  if(builder.getFormatLength(this.b.getType(builder))>builder.getFormatLength(this.a.getType(builder))){return this.b.getType(builder);}return this.a.getType(builder);};Math2Node.prototype.getType=function(builder){switch(this.method){case Math2Node.DISTANCE:case Math2Node.DOT:return'fv1';case Math2Node.CROSS:return'v3';}return this.getInputType(builder);};Math2Node.prototype.generate=function(builder,output){var material=builder.material;var type=this.getInputType(builder);var a,b,al=builder.getFormatLength(this.a.getType(builder)),bl=builder.getFormatLength(this.b.getType(builder));// optimzer
  switch(this.method){case Math2Node.CROSS:a=this.a.build(builder,'v3');b=this.b.build(builder,'v3');break;case Math2Node.STEP:a=this.a.build(builder,al==1?'fv1':type);b=this.b.build(builder,type);break;case Math2Node.MIN:case Math2Node.MAX:case Math2Node.MOD:a=this.a.build(builder,type);b=this.b.build(builder,bl==1?'fv1':type);break;default:a=this.a.build(builder,type);b=this.b.build(builder,type);break;}return builder.format(this.method+'('+a+','+b+')',this.getType(builder),output);};/**
   * @author sunag / http://www.sunag.com.br/
   */var Math3Node=function Math3Node(a,b,c,method){TempNode.call(this);this.a=a;this.b=b;this.c=c;this.method=method||Math3Node.MIX;};Math3Node.MIX='mix';Math3Node.REFRACT='refract';Math3Node.SMOOTHSTEP='smoothstep';Math3Node.FACEFORWARD='faceforward';Math3Node.prototype=Object.create(TempNode.prototype);Math3Node.prototype.constructor=Math3Node;Math3Node.prototype.getType=function(builder){var a=builder.getFormatLength(this.a.getType(builder));var b=builder.getFormatLength(this.b.getType(builder));var c=builder.getFormatLength(this.c.getType(builder));if(a>b&&a>c){return this.a.getType(builder);}else if(b>c){return this.b.getType(builder);}return this.c.getType(builder);};Math3Node.prototype.generate=function(builder,output){var material=builder.material;var type=this.getType(builder);var a,b,c,al=builder.getFormatLength(this.a.getType(builder)),bl=builder.getFormatLength(this.b.getType(builder)),cl=builder.getFormatLength(this.c.getType(builder));// optimzer
  switch(this.method){case Math3Node.REFRACT:a=this.a.build(builder,type);b=this.b.build(builder,type);c=this.c.build(builder,'fv1');break;case Math3Node.MIX:a=this.a.build(builder,type);b=this.b.build(builder,type);c=this.c.build(builder,cl==1?'fv1':type);break;default:a=this.a.build(builder,type);b=this.b.build(builder,type);c=this.c.build(builder,type);break;}return builder.format(this.method+'('+a+','+b+','+c+')',type,output);};var Pass=function Pass(){this.enabled=true;this.needsSwap=true;this.clear=false;this.renderToScreen=false;};Object.assign(Pass.prototype,{setSize:function setSize(width,height){},render:function render(renderer,writeBuffer,readBuffer,delta,maskActive){console.error('Pass: .render() must be implemented in derived pass.');}});/**
   * @author alteredq / http://alteredqualia.com/
   */var ShaderPass=function ShaderPass(shader,textureID){Pass.call(this);this.textureID=textureID!==undefined?textureID:"tDiffuse";if(shader instanceof ShaderMaterial){this.uniforms=shader.uniforms;this.material=shader;}else if(shader){this.uniforms=UniformsUtils.clone(shader.uniforms);this.material=new ShaderMaterial({defines:shader.defines||{},uniforms:this.uniforms,vertexShader:shader.vertexShader,fragmentShader:shader.fragmentShader});}this.camera=new OrthographicCamera(-1,1,1,-1,0,1);this.scene=new Scene();this.quad=new Mesh(new PlaneBufferGeometry(2,2),null);this.quad.frustumCulled=false;// Avoid getting clipped
  this.scene.add(this.quad);};ShaderPass.prototype=Object.assign(Object.create(Pass.prototype),{constructor:ShaderPass,render:function render(renderer,writeBuffer,readBuffer,delta,maskActive){if(this.uniforms[this.textureID]){this.uniforms[this.textureID].value=readBuffer.texture;}this.quad.material=this.material;if(this.renderToScreen){renderer.render(this.scene,this.camera);}else{renderer.render(this.scene,this.camera,writeBuffer,this.clear);}}});/**
   * @author sunag / http://www.sunag.com.br/
   */var NodePass=function NodePass(){ShaderPass.call(this);this.textureID='renderTexture';this.fragment=new RawNode(new ScreenNode());this.node=new NodeMaterial();this.node.fragment=this.fragment;this.build();};NodePass.prototype=Object.create(ShaderPass.prototype);NodePass.prototype.constructor=NodePass;NodeMaterial.addShortcuts(NodePass.prototype,'fragment',['value']);NodePass.prototype.build=function(){this.node.build();this.uniforms=this.node.uniforms;this.material=this.node;};/**
   * @author sunag / http://www.sunag.com.br/
   */var BlurNode=function BlurNode(value,coord,radius,size){TempNode.call(this,'v4');this.requestUpdate=true;this.value=value;this.coord=coord||new UVNode();this.radius=new Vector2Node(1,1);this.size=size;this.blurX=true;this.blurY=true;this.horizontal=new FloatNode(1/64);this.vertical=new FloatNode(1/64);};BlurNode.fBlurX=new FunctionNode(["vec4 blurX( sampler2D texture, vec2 uv, float s ) {","	vec4 sum = vec4( 0.0 );","	sum += texture2D( texture, vec2( uv.x - 4.0 * s, uv.y ) ) * 0.051;","	sum += texture2D( texture, vec2( uv.x - 3.0 * s, uv.y ) ) * 0.0918;","	sum += texture2D( texture, vec2( uv.x - 2.0 * s, uv.y ) ) * 0.12245;","	sum += texture2D( texture, vec2( uv.x - 1.0 * s, uv.y ) ) * 0.1531;","	sum += texture2D( texture, vec2( uv.x, uv.y ) ) * 0.1633;","	sum += texture2D( texture, vec2( uv.x + 1.0 * s, uv.y ) ) * 0.1531;","	sum += texture2D( texture, vec2( uv.x + 2.0 * s, uv.y ) ) * 0.12245;","	sum += texture2D( texture, vec2( uv.x + 3.0 * s, uv.y ) ) * 0.0918;","	sum += texture2D( texture, vec2( uv.x + 4.0 * s, uv.y ) ) * 0.051;","	return sum;","}"].join("\n"));BlurNode.fBlurY=new FunctionNode(["vec4 blurY( sampler2D texture, vec2 uv, float s ) {","	vec4 sum = vec4( 0.0 );","	sum += texture2D( texture, vec2( uv.x, uv.y - 4.0 * s ) ) * 0.051;","	sum += texture2D( texture, vec2( uv.x, uv.y - 3.0 * s ) ) * 0.0918;","	sum += texture2D( texture, vec2( uv.x, uv.y - 2.0 * s ) ) * 0.12245;","	sum += texture2D( texture, vec2( uv.x, uv.y - 1.0 * s ) ) * 0.1531;","	sum += texture2D( texture, vec2( uv.x, uv.y ) ) * 0.1633;","	sum += texture2D( texture, vec2( uv.x, uv.y + 1.0 * s ) ) * 0.1531;","	sum += texture2D( texture, vec2( uv.x, uv.y + 2.0 * s ) ) * 0.12245;","	sum += texture2D( texture, vec2( uv.x, uv.y + 3.0 * s ) ) * 0.0918;","	sum += texture2D( texture, vec2( uv.x, uv.y + 4.0 * s ) ) * 0.051;","	return sum;","}"].join("\n"));BlurNode.prototype=Object.create(TempNode.prototype);BlurNode.prototype.constructor=BlurNode;BlurNode.prototype.updateFrame=function(delta){if(this.size){this.horizontal.number=this.radius.x/this.size.x;this.vertical.number=this.radius.y/this.size.y;}else if(this.value.value&&this.value.value.image){var image=this.value.value.image;this.horizontal.number=this.radius.x/image.width;this.vertical.number=this.radius.y/image.height;}};BlurNode.prototype.generate=function(builder,output){var material=builder.material,blurX=BlurNode.fBlurX,blurY=BlurNode.fBlurY;builder.include(blurX);builder.include(blurY);if(builder.isShader('fragment')){var blurCode=[],code;if(this.blurX){blurCode.push(blurX.name+'('+this.value.build(builder,'sampler2D')+','+this.coord.build(builder,'v2')+','+this.horizontal.build(builder,'fv1')+')');}if(this.blurY){blurCode.push(blurY.name+'('+this.value.build(builder,'sampler2D')+','+this.coord.build(builder,'v2')+','+this.vertical.build(builder,'fv1')+')');}if(blurCode.length==2){code='('+blurCode.join('+')+'/2.0)';}else if(blurCode.length){code='('+blurCode[0]+')';}else{code='vec4( 0.0 )';}return builder.format(code,this.getType(builder),output);}else{console.warn("BlurNode is not compatible with "+builder.shader+" shader.");return builder.format('vec4( 0.0 )',this.getType(builder),output);}};/**
   * @author sunag / http://www.sunag.com.br/
   */var BumpNode=function BumpNode(value,coord,scale){TempNode.call(this,'v3');this.value=value;this.coord=coord||new UVNode();this.scale=scale||new Vector2Node(1,1);};BumpNode.fBumpToNormal=new FunctionNode(["vec3 bumpToNormal( sampler2D bumpMap, vec2 uv, vec2 scale ) {","	vec2 dSTdx = dFdx( uv );","	vec2 dSTdy = dFdy( uv );","	float Hll = texture2D( bumpMap, uv ).x;","	float dBx = texture2D( bumpMap, uv + dSTdx ).x - Hll;","	float dBy = texture2D( bumpMap, uv + dSTdy ).x - Hll;","	return vec3( .5 + ( dBx * scale.x ), .5 + ( dBy * scale.y ), 1.0 );","}"].join("\n"),null,{derivatives:true});BumpNode.prototype=Object.create(TempNode.prototype);BumpNode.prototype.constructor=BumpNode;BumpNode.prototype.generate=function(builder,output){var material=builder.material,func=BumpNode.fBumpToNormal;builder.include(func);if(builder.isShader('fragment')){return builder.format(func.name+'('+this.value.build(builder,'sampler2D')+','+this.coord.build(builder,'v2')+','+this.scale.build(builder,'v2')+')',this.getType(builder),output);}else{console.warn("BumpNode is not compatible with "+builder.shader+" shader.");return builder.format('vec3( 0.0 )',this.getType(builder),output);}};/**
   * @author sunag / http://www.sunag.com.br/
   */var ColorAdjustmentNode=function ColorAdjustmentNode(rgb,adjustment,method){TempNode.call(this,'v3');this.rgb=rgb;this.adjustment=adjustment;this.method=method||ColorAdjustmentNode.SATURATION;};ColorAdjustmentNode.SATURATION='saturation';ColorAdjustmentNode.HUE='hue';ColorAdjustmentNode.VIBRANCE='vibrance';ColorAdjustmentNode.BRIGHTNESS='brightness';ColorAdjustmentNode.CONTRAST='contrast';ColorAdjustmentNode.prototype=Object.create(TempNode.prototype);ColorAdjustmentNode.prototype.constructor=ColorAdjustmentNode;ColorAdjustmentNode.prototype.generate=function(builder,output){var rgb=this.rgb.build(builder,'v3');var adjustment=this.adjustment.build(builder,'fv1');var name;switch(this.method){case ColorAdjustmentNode.SATURATION:name='saturation_rgb';break;case ColorAdjustmentNode.HUE:name='hue_rgb';break;case ColorAdjustmentNode.VIBRANCE:name='vibrance_rgb';break;case ColorAdjustmentNode.BRIGHTNESS:return builder.format('('+rgb+'+'+adjustment+')',this.getType(builder),output);break;case ColorAdjustmentNode.CONTRAST:return builder.format('('+rgb+'*'+adjustment+')',this.getType(builder),output);break;}builder.include(name);return builder.format(name+'('+rgb+','+adjustment+')',this.getType(builder),output);};/**
   * @author sunag / http://www.sunag.com.br/
   */var JoinNode=function JoinNode(x,y,z,w){TempNode.call(this,'fv1');this.x=x;this.y=y;this.z=z;this.w=w;};JoinNode.inputs=['x','y','z','w'];JoinNode.prototype=Object.create(TempNode.prototype);JoinNode.prototype.constructor=JoinNode;JoinNode.prototype.getNumElements=function(){var this$1=this;var inputs=JoinNode.inputs;var i=inputs.length;while(i--){if(this$1[inputs[i]]!==undefined){++i;break;}}return Math.max(i,2);};JoinNode.prototype.getType=function(builder){return builder.getFormatFromLength(this.getNumElements());};JoinNode.prototype.generate=function(builder,output){var this$1=this;var material=builder.material;var type=this.getType(builder);var length=this.getNumElements();var inputs=JoinNode.inputs;var outputs=[];for(var i=0;i<length;i++){var elm=this$1[inputs[i]];outputs.push(elm?elm.build(builder,'fv1'):'0.');}var code=(length>1?builder.getConstructorFromLength(length):'')+'('+outputs.join(',')+')';return builder.format(code,type,output);};/**
   * @author sunag / http://www.sunag.com.br/
   */var LuminanceNode=function LuminanceNode(rgb){TempNode.call(this,'fv1');this.rgb=rgb;};LuminanceNode.prototype=Object.create(TempNode.prototype);LuminanceNode.prototype.constructor=LuminanceNode;LuminanceNode.prototype.generate=function(builder,output){builder.include('luminance_rgb');return builder.format('luminance_rgb('+this.rgb.build(builder,'v3')+')',this.getType(builder),output);};/**
   * @author sunag / http://www.sunag.com.br/
   */var NoiseNode=function NoiseNode(coord){TempNode.call(this,'fv1');this.coord=coord;};NoiseNode.prototype=Object.create(TempNode.prototype);NoiseNode.prototype.constructor=NoiseNode;NoiseNode.prototype.generate=function(builder,output){builder.include('snoise');return builder.format('snoise('+this.coord.build(builder,'v2')+')',this.getType(builder),output);};/**
   * @author sunag / http://www.sunag.com.br/
   */var NormalMapNode=function NormalMapNode(value,uv,scale,normal,position){TempNode.call(this,'v3');this.value=value;this.scale=scale||new FloatNode(1);this.normal=normal||new NormalNode(NormalNode.LOCAL);this.position=position||new PositionNode(NormalNode.VIEW);};NormalMapNode.prototype=Object.create(TempNode.prototype);NormalMapNode.prototype.constructor=NormalMapNode;NormalMapNode.prototype.generate=function(builder,output){var material=builder.material;builder.include('perturbNormal2Arb');if(builder.isShader('fragment')){return builder.format('perturbNormal2Arb(-'+this.position.build(builder,'v3')+','+this.normal.build(builder,'v3')+','+this.value.build(builder,'v3')+','+this.value.coord.build(builder,'v2')+','+this.scale.build(builder,'v2')+')',this.getType(builder),output);}else{console.warn("NormalMapNode is not compatible with "+builder.shader+" shader.");return builder.format('vec3( 0.0 )',this.getType(builder),output);}};/**
   * @author sunag / http://www.sunag.com.br/
   */var ResolutionNode=function ResolutionNode(renderer){Vector2Node.call(this);this.requestUpdate=true;this.renderer=renderer;};ResolutionNode.prototype=Object.create(Vector2Node.prototype);ResolutionNode.prototype.constructor=ResolutionNode;ResolutionNode.prototype.updateFrame=function(delta){var size=this.renderer.getSize(),pixelRatio=this.renderer.getPixelRatio();this.x=size.width*pixelRatio;this.y=size.height*pixelRatio;};/**
   * @author sunag / http://www.sunag.com.br/
   */var SwitchNode=function SwitchNode(node,components){GLNode.call(this);this.node=node;this.components=components||'x';};SwitchNode.prototype=Object.create(GLNode.prototype);SwitchNode.prototype.constructor=SwitchNode;SwitchNode.prototype.getType=function(builder){return builder.getFormatFromLength(this.components.length);};SwitchNode.prototype.generate=function(builder,output){var type=this.node.getType(builder);var inputLength=builder.getFormatLength(type)-1;var node=this.node.build(builder,type);if(inputLength>0){// get max length
  var outputLength=0;var components=builder.colorToVector(this.components);var i,len=components.length;for(i=0;i<len;i++){outputLength=Math.max(outputLength,builder.getIndexByElement(components.charAt(i)));}if(outputLength>inputLength){outputLength=inputLength;}// split
  node+='.';for(i=0;i<len;i++){var elm=components.charAt(i);var idx=builder.getIndexByElement(components.charAt(i));if(idx>outputLength){idx=outputLength;}node+=builder.getElementByIndex(idx);}return builder.format(node,this.getType(builder),output);}else{// join
  return builder.format(node,type,output);}};/**
   * @author sunag / http://www.sunag.com.br/
   */var UVTransformNode=function UVTransformNode(){FunctionNode.call(this,"( uvTransform * vec4( uvNode, 0, 1 ) ).xy","vec2");this.uv=new UVNode();this.transform=new Matrix4Node();};UVTransformNode.prototype=Object.create(FunctionNode.prototype);UVTransformNode.prototype.constructor=UVTransformNode;UVTransformNode.prototype.generate=function(builder,output){this.keywords["uvNode"]=this.uv;this.keywords["uvTransform"]=this.transform;return FunctionNode.prototype.generate.call(this,builder,output);};UVTransformNode.prototype.compose=function(){var defaultPivot=new Vector2$1(.5,.5),tempVector=new Vector3$1(),tempMatrix=new Matrix4();return function compose(translate,rotate,scale,optionalCenter){optionalCenter=optionalCenter!==undefined?optionalCenter:defaultPivot;var matrix=this.transform.value;matrix.identity().setPosition(tempVector.set(-optionalCenter.x,-optionalCenter.y,0)).premultiply(tempMatrix.makeRotationZ(rotate)).multiply(tempMatrix.makeScale(scale.x,scale.y,0)).multiply(tempMatrix.makeTranslation(translate.x,translate.y,0));return this;};}();/**
   * @author sunag / http://www.sunag.com.br/
   */var VelocityNode=function VelocityNode(target,params){Vector3Node.call(this);this.requestUpdate=true;this.target=target;this.params=params||{};this.position=this.target.position.clone();this.velocity=new Vector3$1();switch(this.params.type){case"elastic":this.moment=new Vector3$1();this.speed=new Vector3$1();this.springVelocity=new Vector3$1();this.lastVelocity=new Vector3$1();break;}};VelocityNode.prototype=Object.create(Vector3Node.prototype);VelocityNode.prototype.constructor=VelocityNode;VelocityNode.prototype.updateFrame=function(delta){this.velocity.subVectors(this.target.position,this.position);this.position.copy(this.target.position);switch(this.params.type){case"elastic":// convert to real scale: 0 at 1 values
  var deltaFps=delta*(this.params.fps||60);var spring=Math.pow(this.params.spring,deltaFps),damping=Math.pow(this.params.damping,deltaFps);// fix relative frame-rate
  this.velocity.multiplyScalar(Math.exp(-this.params.damping*deltaFps));// elastic
  this.velocity.add(this.springVelocity);this.velocity.add(this.speed.multiplyScalar(damping).multiplyScalar(1-spring));// speed
  this.speed.subVectors(this.velocity,this.lastVelocity);// spring velocity
  this.springVelocity.add(this.speed);this.springVelocity.multiplyScalar(spring);// moment
  this.moment.add(this.springVelocity);// damping
  this.moment.multiplyScalar(damping);this.lastVelocity.copy(this.velocity);this.value.copy(this.moment);break;default:this.value.copy(this.velocity);}};/**
   * @author sunag / http://www.sunag.com.br/
   */var VarNode=function VarNode(type){GLNode.call(this,type);};VarNode.prototype=Object.create(GLNode.prototype);VarNode.prototype.constructor=VarNode;VarNode.prototype.getType=function(builder){return builder.getTypeByFormat(this.type);};VarNode.prototype.generate=function(builder,output){var varying=builder.material.getVar(this.uuid,this.type);return builder.format(varying.name,this.getType(builder),output);};/**
   * @author Slayvin / http://slayvin.net
   */var Reflector=function Reflector(geometry,options){Mesh.call(this,geometry);this.type='Reflector';var scope=this;options=options||{};var color=options.color!==undefined?new Color$1(options.color):new Color$1(0x7F7F7F);var textureWidth=options.textureWidth||512;var textureHeight=options.textureHeight||512;var clipBias=options.clipBias||0;var shader=options.shader||Reflector.ReflectorShader;var recursion=options.recursion!==undefined?options.recursion:0;//
  var reflectorPlane=new Plane();var normal=new Vector3$1();var reflectorWorldPosition=new Vector3$1();var cameraWorldPosition=new Vector3$1();var rotationMatrix=new Matrix4();var lookAtPosition=new Vector3$1(0,0,-1);var clipPlane=new Vector4$1();var viewport=new Vector4$1();var view=new Vector3$1();var target=new Vector3$1();var q=new Vector4$1();var textureMatrix=new Matrix4();var virtualCamera=new PerspectiveCamera();var parameters={minFilter:LinearFilter,magFilter:LinearFilter,format:RGBFormat,stencilBuffer:false};var renderTarget=new WebGLRenderTarget(textureWidth,textureHeight,parameters);if(!Math.isPowerOfTwo(textureWidth)||!Math.isPowerOfTwo(textureHeight)){renderTarget.texture.generateMipmaps=false;}var material=new ShaderMaterial({uniforms:UniformsUtils.clone(shader.uniforms),fragmentShader:shader.fragmentShader,vertexShader:shader.vertexShader});material.uniforms.tDiffuse.value=renderTarget.texture;material.uniforms.color.value=color;material.uniforms.textureMatrix.value=textureMatrix;this.material=material;this.onBeforeRender=function(renderer,scene,camera){if('recursion'in camera.userData){if(camera.userData.recursion===recursion){return;}camera.userData.recursion++;}reflectorWorldPosition.setFromMatrixPosition(scope.matrixWorld);cameraWorldPosition.setFromMatrixPosition(camera.matrixWorld);rotationMatrix.extractRotation(scope.matrixWorld);normal.set(0,0,1);normal.applyMatrix4(rotationMatrix);view.subVectors(reflectorWorldPosition,cameraWorldPosition);// Avoid rendering when reflector is facing away
  if(view.dot(normal)>0){return;}view.reflect(normal).negate();view.add(reflectorWorldPosition);rotationMatrix.extractRotation(camera.matrixWorld);lookAtPosition.set(0,0,-1);lookAtPosition.applyMatrix4(rotationMatrix);lookAtPosition.add(cameraWorldPosition);target.subVectors(reflectorWorldPosition,lookAtPosition);target.reflect(normal).negate();target.add(reflectorWorldPosition);virtualCamera.position.copy(view);virtualCamera.up.set(0,1,0);virtualCamera.up.applyMatrix4(rotationMatrix);virtualCamera.up.reflect(normal);virtualCamera.lookAt(target);virtualCamera.far=camera.far;// Used in WebGLBackground
  virtualCamera.updateMatrixWorld();virtualCamera.projectionMatrix.copy(camera.projectionMatrix);virtualCamera.userData.recursion=0;// Update the texture matrix
  textureMatrix.set(0.5,0.0,0.0,0.5,0.0,0.5,0.0,0.5,0.0,0.0,0.5,0.5,0.0,0.0,0.0,1.0);textureMatrix.multiply(virtualCamera.projectionMatrix);textureMatrix.multiply(virtualCamera.matrixWorldInverse);textureMatrix.multiply(scope.matrixWorld);// Now update projection matrix with new clip plane, implementing code from: http://www.terathon.com/code/oblique.html
  // Paper explaining this technique: http://www.terathon.com/lengyel/Lengyel-Oblique.pdf
  reflectorPlane.setFromNormalAndCoplanarPoint(normal,reflectorWorldPosition);reflectorPlane.applyMatrix4(virtualCamera.matrixWorldInverse);clipPlane.set(reflectorPlane.normal.x,reflectorPlane.normal.y,reflectorPlane.normal.z,reflectorPlane.constant);var projectionMatrix=virtualCamera.projectionMatrix;q.x=(Math.sign(clipPlane.x)+projectionMatrix.elements[8])/projectionMatrix.elements[0];q.y=(Math.sign(clipPlane.y)+projectionMatrix.elements[9])/projectionMatrix.elements[5];q.z=-1.0;q.w=(1.0+projectionMatrix.elements[10])/projectionMatrix.elements[14];// Calculate the scaled plane vector
  clipPlane.multiplyScalar(2.0/clipPlane.dot(q));// Replacing the third row of the projection matrix
  projectionMatrix.elements[2]=clipPlane.x;projectionMatrix.elements[6]=clipPlane.y;projectionMatrix.elements[10]=clipPlane.z+1.0-clipBias;projectionMatrix.elements[14]=clipPlane.w;// Render
  scope.visible=false;var currentRenderTarget=renderer.getRenderTarget();var currentVrEnabled=renderer.vr.enabled;var currentShadowAutoUpdate=renderer.shadowMap.autoUpdate;renderer.vr.enabled=false;// Avoid camera modification and recursion
  renderer.shadowMap.autoUpdate=false;// Avoid re-computing shadows
  renderer.render(scene,virtualCamera,renderTarget,true);renderer.vr.enabled=currentVrEnabled;renderer.shadowMap.autoUpdate=currentShadowAutoUpdate;renderer.setRenderTarget(currentRenderTarget);// Restore viewport
  var bounds=camera.bounds;if(bounds!==undefined){var size=renderer.getSize();var pixelRatio=renderer.getPixelRatio();viewport.x=bounds.x*size.width*pixelRatio;viewport.y=bounds.y*size.height*pixelRatio;viewport.z=bounds.z*size.width*pixelRatio;viewport.w=bounds.w*size.height*pixelRatio;renderer.state.viewport(viewport);}scope.visible=true;};this.getRenderTarget=function(){return renderTarget;};};Reflector.prototype=Object.create(Mesh.prototype);Reflector.prototype.constructor=Reflector;Reflector.ReflectorShader={uniforms:{'color':{type:'c',value:null},'tDiffuse':{type:'t',value:null},'textureMatrix':{type:'m4',value:null}},vertexShader:['uniform mat4 textureMatrix;','varying vec4 vUv;','void main() {','	vUv = textureMatrix * vec4( position, 1.0 );','	gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );','}'].join('\n'),fragmentShader:['uniform vec3 color;','uniform sampler2D tDiffuse;','varying vec4 vUv;','float blendOverlay( float base, float blend ) {','	return( base < 0.5 ? ( 2.0 * base * blend ) : ( 1.0 - 2.0 * ( 1.0 - base ) * ( 1.0 - blend ) ) );','}','vec3 blendOverlay( vec3 base, vec3 blend ) {','	return vec3( blendOverlay( base.r, blend.r ), blendOverlay( base.g, blend.g ), blendOverlay( base.b, blend.b ) );','}','void main() {','	vec4 base = texture2DProj( tDiffuse, vUv );','	gl_FragColor = vec4( blendOverlay( base.rgb, color ), 1.0 );','}'].join('\n')};var Refractor=function Refractor(geometry,options){Mesh.call(this,geometry);this.type='Refractor';var scope=this;options=options||{};var color=options.color!==undefined?new Color$1(options.color):new Color$1(0x7F7F7F);var textureWidth=options.textureWidth||512;var textureHeight=options.textureHeight||512;var clipBias=options.clipBias||0;var shader=options.shader||Refractor.RefractorShader;//
  var virtualCamera=new PerspectiveCamera();virtualCamera.matrixAutoUpdate=false;virtualCamera.userData.refractor=true;//
  var refractorPlane=new Plane();var textureMatrix=new Matrix4();// render target
  var parameters={minFilter:LinearFilter,magFilter:LinearFilter,format:RGBFormat,stencilBuffer:false};var renderTarget=new WebGLRenderTarget(textureWidth,textureHeight,parameters);if(!Math.isPowerOfTwo(textureWidth)||!Math.isPowerOfTwo(textureHeight)){renderTarget.texture.generateMipmaps=false;}// material
  this.material=new ShaderMaterial({uniforms:UniformsUtils.clone(shader.uniforms),vertexShader:shader.vertexShader,fragmentShader:shader.fragmentShader,transparent:true// ensures, refractors are drawn from farthest to closest
  });this.material.uniforms.color.value=color;this.material.uniforms.tDiffuse.value=renderTarget.texture;this.material.uniforms.textureMatrix.value=textureMatrix;// functions
  var visible=function(){var refractorWorldPosition=new Vector3$1();var cameraWorldPosition=new Vector3$1();var rotationMatrix=new Matrix4();var view=new Vector3$1();var normal=new Vector3$1();return function visible(camera){refractorWorldPosition.setFromMatrixPosition(scope.matrixWorld);cameraWorldPosition.setFromMatrixPosition(camera.matrixWorld);view.subVectors(refractorWorldPosition,cameraWorldPosition);rotationMatrix.extractRotation(scope.matrixWorld);normal.set(0,0,1);normal.applyMatrix4(rotationMatrix);return view.dot(normal)<0;};}();var updateRefractorPlane=function(){var normal=new Vector3$1();var position=new Vector3$1();var quaternion=new Quaternion();var scale=new Vector3$1();return function updateRefractorPlane(){scope.matrixWorld.decompose(position,quaternion,scale);normal.set(0,0,1).applyQuaternion(quaternion).normalize();// flip the normal because we want to cull everything above the plane
  normal.negate();refractorPlane.setFromNormalAndCoplanarPoint(normal,position);};}();var updateVirtualCamera=function(){var clipPlane=new Plane();var clipVector=new Vector4$1();var q=new Vector4$1();return function updateVirtualCamera(camera){virtualCamera.matrixWorld.copy(camera.matrixWorld);virtualCamera.matrixWorldInverse.getInverse(virtualCamera.matrixWorld);virtualCamera.projectionMatrix.copy(camera.projectionMatrix);virtualCamera.far=camera.far;// used in WebGLBackground
  // The following code creates an oblique view frustum for clipping.
  // see: Lengyel, Eric. “Oblique View Frustum Depth Projection and Clipping”.
  // Journal of Game Development, Vol. 1, No. 2 (2005), Charles River Media, pp. 5–16
  clipPlane.copy(refractorPlane);clipPlane.applyMatrix4(virtualCamera.matrixWorldInverse);clipVector.set(clipPlane.normal.x,clipPlane.normal.y,clipPlane.normal.z,clipPlane.constant);// calculate the clip-space corner point opposite the clipping plane and
  // transform it into camera space by multiplying it by the inverse of the projection matrix
  var projectionMatrix=virtualCamera.projectionMatrix;q.x=(Math.sign(clipVector.x)+projectionMatrix.elements[8])/projectionMatrix.elements[0];q.y=(Math.sign(clipVector.y)+projectionMatrix.elements[9])/projectionMatrix.elements[5];q.z=-1.0;q.w=(1.0+projectionMatrix.elements[10])/projectionMatrix.elements[14];// calculate the scaled plane vector
  clipVector.multiplyScalar(2.0/clipVector.dot(q));// replacing the third row of the projection matrix
  projectionMatrix.elements[2]=clipVector.x;projectionMatrix.elements[6]=clipVector.y;projectionMatrix.elements[10]=clipVector.z+1.0-clipBias;projectionMatrix.elements[14]=clipVector.w;};}();// This will update the texture matrix that is used for projective texture mapping in the shader.
  // see: http://developer.download.nvidia.com/assets/gamedev/docs/projective_texture_mapping.pdf
  function updateTextureMatrix(camera){// this matrix does range mapping to [ 0, 1 ]
  textureMatrix.set(0.5,0.0,0.0,0.5,0.0,0.5,0.0,0.5,0.0,0.0,0.5,0.5,0.0,0.0,0.0,1.0);// we use "Object Linear Texgen", so we need to multiply the texture matrix T
  // (matrix above) with the projection and view matrix of the virtual camera
  // and the model matrix of the refractor
  textureMatrix.multiply(camera.projectionMatrix);textureMatrix.multiply(camera.matrixWorldInverse);textureMatrix.multiply(scope.matrixWorld);}//
  var render=function(){var viewport=new Vector4$1();return function render(renderer,scene,camera){scope.visible=false;var currentRenderTarget=renderer.getRenderTarget();var currentVrEnabled=renderer.vr.enabled;var currentShadowAutoUpdate=renderer.shadowMap.autoUpdate;renderer.vr.enabled=false;// avoid camera modification
  renderer.shadowMap.autoUpdate=false;// avoid re-computing shadows
  renderer.render(scene,virtualCamera,renderTarget,true);renderer.vr.enabled=currentVrEnabled;renderer.shadowMap.autoUpdate=currentShadowAutoUpdate;renderer.setRenderTarget(currentRenderTarget);// restore viewport
  var bounds=camera.bounds;if(bounds!==undefined){var size=renderer.getSize();var pixelRatio=renderer.getPixelRatio();viewport.x=bounds.x*size.width*pixelRatio;viewport.y=bounds.y*size.height*pixelRatio;viewport.z=bounds.z*size.width*pixelRatio;viewport.w=bounds.w*size.height*pixelRatio;renderer.state.viewport(viewport);}scope.visible=true;};}();//
  this.onBeforeRender=function(renderer,scene,camera){// ensure refractors are rendered only once per frame
  if(camera.userData.refractor===true){return;}// avoid rendering when the refractor is viewed from behind
  if(!visible(camera)===true){return;}// update
  updateRefractorPlane();updateTextureMatrix(camera);updateVirtualCamera(camera);render(renderer,scene,camera);};this.getRenderTarget=function(){return renderTarget;};};Refractor.prototype=Object.create(Mesh.prototype);Refractor.prototype.constructor=Refractor;Refractor.RefractorShader={uniforms:{'color':{type:'c',value:null},'tDiffuse':{type:'t',value:null},'textureMatrix':{type:'m4',value:null}},vertexShader:['uniform mat4 textureMatrix;','varying vec4 vUv;','void main() {','	vUv = textureMatrix * vec4( position, 1.0 );','	gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );','}'].join('\n'),fragmentShader:['uniform vec3 color;','uniform sampler2D tDiffuse;','varying vec4 vUv;','float blendOverlay( float base, float blend ) {','	return( base < 0.5 ? ( 2.0 * base * blend ) : ( 1.0 - 2.0 * ( 1.0 - base ) * ( 1.0 - blend ) ) );','}','vec3 blendOverlay( vec3 base, vec3 blend ) {','	return vec3( blendOverlay( base.r, blend.r ), blendOverlay( base.g, blend.g ), blendOverlay( base.b, blend.b ) );','}','void main() {','	vec4 base = texture2DProj( tDiffuse, vUv );','	gl_FragColor = vec4( blendOverlay( base.rgb, color ), 1.0 );','}'].join('\n')};/**
   * @author erichlof /  http://github.com/erichlof
   *
   * A shadow Mesh that follows a shadow-casting Mesh in the scene, but is confined to a single plane.
   */var ShadowMesh=function ShadowMesh(mesh){var shadowMaterial=new MeshBasicMaterial({color:0x000000,transparent:true,opacity:0.6,depthWrite:false});Mesh.call(this,mesh.geometry,shadowMaterial);this.meshMatrix=mesh.matrixWorld;this.frustumCulled=false;this.matrixAutoUpdate=false;};ShadowMesh.prototype=Object.create(Mesh.prototype);ShadowMesh.prototype.constructor=ShadowMesh;ShadowMesh.prototype.update=function(){var shadowMatrix=new Matrix4();return function(plane,lightPosition4D){// based on https://www.opengl.org/archives/resources/features/StencilTalk/tsld021.htm
  var dot=plane.normal.x*lightPosition4D.x+plane.normal.y*lightPosition4D.y+plane.normal.z*lightPosition4D.z+-plane.constant*lightPosition4D.w;var sme=shadowMatrix.elements;sme[0]=dot-lightPosition4D.x*plane.normal.x;sme[4]=-lightPosition4D.x*plane.normal.y;sme[8]=-lightPosition4D.x*plane.normal.z;sme[12]=-lightPosition4D.x*-plane.constant;sme[1]=-lightPosition4D.y*plane.normal.x;sme[5]=dot-lightPosition4D.y*plane.normal.y;sme[9]=-lightPosition4D.y*plane.normal.z;sme[13]=-lightPosition4D.y*-plane.constant;sme[2]=-lightPosition4D.z*plane.normal.x;sme[6]=-lightPosition4D.z*plane.normal.y;sme[10]=dot-lightPosition4D.z*plane.normal.z;sme[14]=-lightPosition4D.z*-plane.constant;sme[3]=-lightPosition4D.w*plane.normal.x;sme[7]=-lightPosition4D.w*plane.normal.y;sme[11]=-lightPosition4D.w*plane.normal.z;sme[15]=dot-lightPosition4D.w*-plane.constant;this.matrix.multiplyMatrices(shadowMatrix,this.meshMatrix);};}();/**
   * @author zz85 / https://github.com/zz85
   *
   * Based on "A Practical Analytic Model for Daylight"
   * aka The Preetham Model, the de facto standard analytic skydome model
   * http://www.cs.utah.edu/~shirley/papers/sunsky/sunsky.pdf
   *
   * First implemented by Simon Wallner
   * http://www.simonwallner.at/projects/atmospheric-scattering
   *
   * Improved by Martin Upitis
   * http://blenderartists.org/forum/showthread.php?245954-preethams-sky-impementation-HDR
   *
   * Three.js integration by zz85 http://twitter.com/blurspline
  */var Sky=function Sky(){var shader=Sky.SkyShader;var material=new ShaderMaterial({fragmentShader:shader.fragmentShader,vertexShader:shader.vertexShader,uniforms:UniformsUtils.clone(shader.uniforms),side:BackSide});Mesh.call(this,new SphereBufferGeometry(1,32,15),material);};Sky.prototype=Object.create(Mesh.prototype);Sky.SkyShader={uniforms:{luminance:{value:1},turbidity:{value:2},rayleigh:{value:1},mieCoefficient:{value:0.005},mieDirectionalG:{value:0.8},sunPosition:{value:new Vector3$1()}},vertexShader:['uniform vec3 sunPosition;','uniform float rayleigh;','uniform float turbidity;','uniform float mieCoefficient;','varying vec3 vWorldPosition;','varying vec3 vSunDirection;','varying float vSunfade;','varying vec3 vBetaR;','varying vec3 vBetaM;','varying float vSunE;','const vec3 up = vec3( 0.0, 1.0, 0.0 );',// constants for atmospheric scattering
  'const float e = 2.71828182845904523536028747135266249775724709369995957;','const float pi = 3.141592653589793238462643383279502884197169;',// wavelength of used primaries, according to preetham
  'const vec3 lambda = vec3( 680E-9, 550E-9, 450E-9 );',// this pre-calcuation replaces older TotalRayleigh(vec3 lambda) function:
  // (8.0 * pow(pi, 3.0) * pow(pow(n, 2.0) - 1.0, 2.0) * (6.0 + 3.0 * pn)) / (3.0 * N * pow(lambda, vec3(4.0)) * (6.0 - 7.0 * pn))
  'const vec3 totalRayleigh = vec3( 5.804542996261093E-6, 1.3562911419845635E-5, 3.0265902468824876E-5 );',// mie stuff
  // K coefficient for the primaries
  'const float v = 4.0;','const vec3 K = vec3( 0.686, 0.678, 0.666 );',// MieConst = pi * pow( ( 2.0 * pi ) / lambda, vec3( v - 2.0 ) ) * K
  'const vec3 MieConst = vec3( 1.8399918514433978E14, 2.7798023919660528E14, 4.0790479543861094E14 );',// earth shadow hack
  // cutoffAngle = pi / 1.95;
  'const float cutoffAngle = 1.6110731556870734;','const float steepness = 1.5;','const float EE = 1000.0;','float sunIntensity( float zenithAngleCos ) {','	zenithAngleCos = clamp( zenithAngleCos, -1.0, 1.0 );','	return EE * max( 0.0, 1.0 - pow( e, -( ( cutoffAngle - acos( zenithAngleCos ) ) / steepness ) ) );','}','vec3 totalMie( float T ) {','	float c = ( 0.2 * T ) * 10E-18;','	return 0.434 * c * MieConst;','}','void main() {','	vec4 worldPosition = modelMatrix * vec4( position, 1.0 );','	vWorldPosition = worldPosition.xyz;','	gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );','	vSunDirection = normalize( sunPosition );','	vSunE = sunIntensity( dot( vSunDirection, up ) );','	vSunfade = 1.0 - clamp( 1.0 - exp( ( sunPosition.y / 450000.0 ) ), 0.0, 1.0 );','	float rayleighCoefficient = rayleigh - ( 1.0 * ( 1.0 - vSunfade ) );',// extinction (absorbtion + out scattering)
  // rayleigh coefficients
  '	vBetaR = totalRayleigh * rayleighCoefficient;',// mie coefficients
  '	vBetaM = totalMie( turbidity ) * mieCoefficient;','}'].join('\n'),fragmentShader:['varying vec3 vWorldPosition;','varying vec3 vSunDirection;','varying float vSunfade;','varying vec3 vBetaR;','varying vec3 vBetaM;','varying float vSunE;','uniform float luminance;','uniform float mieDirectionalG;','const vec3 cameraPos = vec3( 0.0, 0.0, 0.0 );',// constants for atmospheric scattering
  'const float pi = 3.141592653589793238462643383279502884197169;','const float n = 1.0003;',// refractive index of air
  'const float N = 2.545E25;',// number of molecules per unit volume for air at
  // 288.15K and 1013mb (sea level -45 celsius)
  // optical length at zenith for molecules
  'const float rayleighZenithLength = 8.4E3;','const float mieZenithLength = 1.25E3;','const vec3 up = vec3( 0.0, 1.0, 0.0 );',// 66 arc seconds -> degrees, and the cosine of that
  'const float sunAngularDiameterCos = 0.999956676946448443553574619906976478926848692873900859324;',// 3.0 / ( 16.0 * pi )
  'const float THREE_OVER_SIXTEENPI = 0.05968310365946075;',// 1.0 / ( 4.0 * pi )
  'const float ONE_OVER_FOURPI = 0.07957747154594767;','float rayleighPhase( float cosTheta ) {','	return THREE_OVER_SIXTEENPI * ( 1.0 + pow( cosTheta, 2.0 ) );','}','float hgPhase( float cosTheta, float g ) {','	float g2 = pow( g, 2.0 );','	float inverse = 1.0 / pow( 1.0 - 2.0 * g * cosTheta + g2, 1.5 );','	return ONE_OVER_FOURPI * ( ( 1.0 - g2 ) * inverse );','}',// Filmic ToneMapping http://filmicgames.com/archives/75
  'const float A = 0.15;','const float B = 0.50;','const float C = 0.10;','const float D = 0.20;','const float E = 0.02;','const float F = 0.30;','const float whiteScale = 1.0748724675633854;',// 1.0 / Uncharted2Tonemap(1000.0)
  'vec3 Uncharted2Tonemap( vec3 x ) {','	return ( ( x * ( A * x + C * B ) + D * E ) / ( x * ( A * x + B ) + D * F ) ) - E / F;','}','void main() {',// optical length
  // cutoff angle at 90 to avoid singularity in next formula.
  '	float zenithAngle = acos( max( 0.0, dot( up, normalize( vWorldPosition - cameraPos ) ) ) );','	float inverse = 1.0 / ( cos( zenithAngle ) + 0.15 * pow( 93.885 - ( ( zenithAngle * 180.0 ) / pi ), -1.253 ) );','	float sR = rayleighZenithLength * inverse;','	float sM = mieZenithLength * inverse;',// combined extinction factor
  '	vec3 Fex = exp( -( vBetaR * sR + vBetaM * sM ) );',// in scattering
  '	float cosTheta = dot( normalize( vWorldPosition - cameraPos ), vSunDirection );','	float rPhase = rayleighPhase( cosTheta * 0.5 + 0.5 );','	vec3 betaRTheta = vBetaR * rPhase;','	float mPhase = hgPhase( cosTheta, mieDirectionalG );','	vec3 betaMTheta = vBetaM * mPhase;','	vec3 Lin = pow( vSunE * ( ( betaRTheta + betaMTheta ) / ( vBetaR + vBetaM ) ) * ( 1.0 - Fex ), vec3( 1.5 ) );','	Lin *= mix( vec3( 1.0 ), pow( vSunE * ( ( betaRTheta + betaMTheta ) / ( vBetaR + vBetaM ) ) * Fex, vec3( 1.0 / 2.0 ) ), clamp( pow( 1.0 - dot( up, vSunDirection ), 5.0 ), 0.0, 1.0 ) );',// nightsky
  '	vec3 direction = normalize( vWorldPosition - cameraPos );','	float theta = acos( direction.y ); // elevation --> y-axis, [-pi/2, pi/2]','	float phi = atan( direction.z, direction.x ); // azimuth --> x-axis [-pi/2, pi/2]','	vec2 uv = vec2( phi, theta ) / vec2( 2.0 * pi, pi ) + vec2( 0.5, 0.0 );','	vec3 L0 = vec3( 0.1 ) * Fex;',// composition + solar disc
  '	float sundisk = smoothstep( sunAngularDiameterCos, sunAngularDiameterCos + 0.00002, cosTheta );','	L0 += ( vSunE * 19000.0 * Fex ) * sundisk;','	vec3 texColor = ( Lin + L0 ) * 0.04 + vec3( 0.0, 0.0003, 0.00075 );','	vec3 curr = Uncharted2Tonemap( ( log2( 2.0 / pow( luminance, 4.0 ) ) ) * texColor );','	vec3 color = curr * whiteScale;','	vec3 retColor = pow( color, vec3( 1.0 / ( 1.2 + ( 1.2 * vSunfade ) ) ) );','	gl_FragColor = vec4( retColor, 1.0 );','}'].join('\n')};/**
   * @author jbouny / https://github.com/jbouny
   *
   * Work based on :
   * @author Slayvin / http://slayvin.net : Flat mirror for three.js
   * @author Stemkoski / http://www.adelphi.edu/~stemkoski : An implementation of water shader based on the flat mirror
   * @author Jonas Wagner / http://29a.ch/ && http://29a.ch/slides/2012/webglwater/ : Water shader explanations in WebGL
   */var Water=function Water(geometry,options){Mesh.call(this,geometry);var scope=this;options=options||{};var textureWidth=options.textureWidth!==undefined?options.textureWidth:512;var textureHeight=options.textureHeight!==undefined?options.textureHeight:512;var clipBias=options.clipBias!==undefined?options.clipBias:0.0;var alpha=options.alpha!==undefined?options.alpha:1.0;var time=options.time!==undefined?options.time:0.0;var normalSampler=options.waterNormals!==undefined?options.waterNormals:null;var sunDirection=options.sunDirection!==undefined?options.sunDirection:new Vector3$1(0.70707,0.70707,0.0);var sunColor=new Color$1(options.sunColor!==undefined?options.sunColor:0xffffff);var waterColor=new Color$1(options.waterColor!==undefined?options.waterColor:0x7F7F7F);var eye=options.eye!==undefined?options.eye:new Vector3$1(0,0,0);var distortionScale=options.distortionScale!==undefined?options.distortionScale:20.0;var side=options.side!==undefined?options.side:FrontSide;var fog=options.fog!==undefined?options.fog:false;//
  var mirrorPlane=new Plane();var normal=new Vector3$1();var mirrorWorldPosition=new Vector3$1();var cameraWorldPosition=new Vector3$1();var rotationMatrix=new Matrix4();var lookAtPosition=new Vector3$1(0,0,-1);var clipPlane=new Vector4$1();var view=new Vector3$1();var target=new Vector3$1();var q=new Vector4$1();var textureMatrix=new Matrix4();var mirrorCamera=new PerspectiveCamera();var parameters={minFilter:LinearFilter,magFilter:LinearFilter,format:RGBFormat,stencilBuffer:false};var renderTarget=new WebGLRenderTarget(textureWidth,textureHeight,parameters);if(!Math.isPowerOfTwo(textureWidth)||!Math.isPowerOfTwo(textureHeight)){renderTarget.texture.generateMipmaps=false;}var mirrorShader={uniforms:UniformsUtils.merge([UniformsLib['fog'],UniformsLib['lights'],{normalSampler:{value:null},mirrorSampler:{value:null},alpha:{value:1.0},time:{value:0.0},size:{value:1.0},distortionScale:{value:20.0},textureMatrix:{value:new Matrix4()},sunColor:{value:new Color$1(0x7F7F7F)},sunDirection:{value:new Vector3$1(0.70707,0.70707,0)},eye:{value:new Vector3$1()},waterColor:{value:new Color$1(0x555555)}}]),vertexShader:['uniform mat4 textureMatrix;','uniform float time;','varying vec4 mirrorCoord;','varying vec4 worldPosition;',ShaderChunk['fog_pars_vertex'],ShaderChunk['shadowmap_pars_vertex'],'void main() {','	mirrorCoord = modelMatrix * vec4( position, 1.0 );','	worldPosition = mirrorCoord.xyzw;','	mirrorCoord = textureMatrix * mirrorCoord;','	vec4 mvPosition =  modelViewMatrix * vec4( position, 1.0 );','	gl_Position = projectionMatrix * mvPosition;',ShaderChunk['fog_vertex'],ShaderChunk['shadowmap_vertex'],'}'].join('\n'),fragmentShader:['uniform sampler2D mirrorSampler;','uniform float alpha;','uniform float time;','uniform float size;','uniform float distortionScale;','uniform sampler2D normalSampler;','uniform vec3 sunColor;','uniform vec3 sunDirection;','uniform vec3 eye;','uniform vec3 waterColor;','varying vec4 mirrorCoord;','varying vec4 worldPosition;','vec4 getNoise( vec2 uv ) {','	vec2 uv0 = ( uv / 103.0 ) + vec2(time / 17.0, time / 29.0);','	vec2 uv1 = uv / 107.0-vec2( time / -19.0, time / 31.0 );','	vec2 uv2 = uv / vec2( 8907.0, 9803.0 ) + vec2( time / 101.0, time / 97.0 );','	vec2 uv3 = uv / vec2( 1091.0, 1027.0 ) - vec2( time / 109.0, time / -113.0 );','	vec4 noise = texture2D( normalSampler, uv0 ) +','		texture2D( normalSampler, uv1 ) +','		texture2D( normalSampler, uv2 ) +','		texture2D( normalSampler, uv3 );','	return noise * 0.5 - 1.0;','}','void sunLight( const vec3 surfaceNormal, const vec3 eyeDirection, float shiny, float spec, float diffuse, inout vec3 diffuseColor, inout vec3 specularColor ) {','	vec3 reflection = normalize( reflect( -sunDirection, surfaceNormal ) );','	float direction = max( 0.0, dot( eyeDirection, reflection ) );','	specularColor += pow( direction, shiny ) * sunColor * spec;','	diffuseColor += max( dot( sunDirection, surfaceNormal ), 0.0 ) * sunColor * diffuse;','}',ShaderChunk['common'],ShaderChunk['packing'],ShaderChunk['bsdfs'],ShaderChunk['fog_pars_fragment'],ShaderChunk['lights_pars'],ShaderChunk['shadowmap_pars_fragment'],ShaderChunk['shadowmask_pars_fragment'],'void main() {','	vec4 noise = getNoise( worldPosition.xz * size );','	vec3 surfaceNormal = normalize( noise.xzy * vec3( 1.5, 1.0, 1.5 ) );','	vec3 diffuseLight = vec3(0.0);','	vec3 specularLight = vec3(0.0);','	vec3 worldToEye = eye-worldPosition.xyz;','	vec3 eyeDirection = normalize( worldToEye );','	sunLight( surfaceNormal, eyeDirection, 100.0, 2.0, 0.5, diffuseLight, specularLight );','	float distance = length(worldToEye);','	vec2 distortion = surfaceNormal.xz * ( 0.001 + 1.0 / distance ) * distortionScale;','	vec3 reflectionSample = vec3( texture2D( mirrorSampler, mirrorCoord.xy / mirrorCoord.z + distortion ) );','	float theta = max( dot( eyeDirection, surfaceNormal ), 0.0 );','	float rf0 = 0.3;','	float reflectance = rf0 + ( 1.0 - rf0 ) * pow( ( 1.0 - theta ), 5.0 );','	vec3 scatter = max( 0.0, dot( surfaceNormal, eyeDirection ) ) * waterColor;','	vec3 albedo = mix( ( sunColor * diffuseLight * 0.3 + scatter ) * getShadowMask(), ( vec3( 0.1 ) + reflectionSample * 0.9 + reflectionSample * specularLight ), reflectance);','	vec3 outgoingLight = albedo;','	gl_FragColor = vec4( outgoingLight, alpha );',ShaderChunk['tonemapping_fragment'],ShaderChunk['fog_fragment'],'}'].join('\n')};var material=new ShaderMaterial({fragmentShader:mirrorShader.fragmentShader,vertexShader:mirrorShader.vertexShader,uniforms:UniformsUtils.clone(mirrorShader.uniforms),transparent:true,lights:true,side:side,fog:fog});material.uniforms.mirrorSampler.value=renderTarget.texture;material.uniforms.textureMatrix.value=textureMatrix;material.uniforms.alpha.value=alpha;material.uniforms.time.value=time;material.uniforms.normalSampler.value=normalSampler;material.uniforms.sunColor.value=sunColor;material.uniforms.waterColor.value=waterColor;material.uniforms.sunDirection.value=sunDirection;material.uniforms.distortionScale.value=distortionScale;material.uniforms.eye.value=eye;scope.material=material;scope.onBeforeRender=function(renderer,scene,camera){mirrorWorldPosition.setFromMatrixPosition(scope.matrixWorld);cameraWorldPosition.setFromMatrixPosition(camera.matrixWorld);rotationMatrix.extractRotation(scope.matrixWorld);normal.set(0,0,1);normal.applyMatrix4(rotationMatrix);view.subVectors(mirrorWorldPosition,cameraWorldPosition);// Avoid rendering when mirror is facing away
  if(view.dot(normal)>0){return;}view.reflect(normal).negate();view.add(mirrorWorldPosition);rotationMatrix.extractRotation(camera.matrixWorld);lookAtPosition.set(0,0,-1);lookAtPosition.applyMatrix4(rotationMatrix);lookAtPosition.add(cameraWorldPosition);target.subVectors(mirrorWorldPosition,lookAtPosition);target.reflect(normal).negate();target.add(mirrorWorldPosition);mirrorCamera.position.copy(view);mirrorCamera.up.set(0,1,0);mirrorCamera.up.applyMatrix4(rotationMatrix);mirrorCamera.up.reflect(normal);mirrorCamera.lookAt(target);mirrorCamera.far=camera.far;// Used in WebGLBackground
  mirrorCamera.updateMatrixWorld();mirrorCamera.projectionMatrix.copy(camera.projectionMatrix);// Update the texture matrix
  textureMatrix.set(0.5,0.0,0.0,0.5,0.0,0.5,0.0,0.5,0.0,0.0,0.5,0.5,0.0,0.0,0.0,1.0);textureMatrix.multiply(mirrorCamera.projectionMatrix);textureMatrix.multiply(mirrorCamera.matrixWorldInverse);// Now update projection matrix with new clip plane, implementing code from: http://www.terathon.com/code/oblique.html
  // Paper explaining this technique: http://www.terathon.com/lengyel/Lengyel-Oblique.pdf
  mirrorPlane.setFromNormalAndCoplanarPoint(normal,mirrorWorldPosition);mirrorPlane.applyMatrix4(mirrorCamera.matrixWorldInverse);clipPlane.set(mirrorPlane.normal.x,mirrorPlane.normal.y,mirrorPlane.normal.z,mirrorPlane.constant);var projectionMatrix=mirrorCamera.projectionMatrix;q.x=(Math.sign(clipPlane.x)+projectionMatrix.elements[8])/projectionMatrix.elements[0];q.y=(Math.sign(clipPlane.y)+projectionMatrix.elements[9])/projectionMatrix.elements[5];q.z=-1.0;q.w=(1.0+projectionMatrix.elements[10])/projectionMatrix.elements[14];// Calculate the scaled plane vector
  clipPlane.multiplyScalar(2.0/clipPlane.dot(q));// Replacing the third row of the projection matrix
  projectionMatrix.elements[2]=clipPlane.x;projectionMatrix.elements[6]=clipPlane.y;projectionMatrix.elements[10]=clipPlane.z+1.0-clipBias;projectionMatrix.elements[14]=clipPlane.w;eye.setFromMatrixPosition(camera.matrixWorld);//
  var currentRenderTarget=renderer.getRenderTarget();var currentVrEnabled=renderer.vr.enabled;var currentShadowAutoUpdate=renderer.shadowMap.autoUpdate;scope.visible=false;renderer.vr.enabled=false;// Avoid camera modification and recursion
  renderer.shadowMap.autoUpdate=false;// Avoid re-computing shadows
  renderer.render(scene,mirrorCamera,renderTarget,true);scope.visible=true;renderer.vr.enabled=currentVrEnabled;renderer.shadowMap.autoUpdate=currentShadowAutoUpdate;renderer.setRenderTarget(currentRenderTarget);};};Water.prototype=Object.create(Mesh.prototype);Water.prototype.constructor=Water;function BoxHelper(object,color){this.object=object;if(color===undefined){color=0xffff00;}var indices=new Uint16Array([0,1,1,2,2,3,3,0,4,5,5,6,6,7,7,4,0,4,1,5,2,6,3,7]);var positions=new Float32Array(8*3);var geometry=new BufferGeometry();geometry.setIndex(new BufferAttribute(indices,1));geometry.addAttribute('position',new BufferAttribute(positions,3));LineSegments.call(this,geometry,new LineBasicMaterial$1({color:color}));this.matrixAutoUpdate=false;this.update();}BoxHelper.prototype=Object.create(LineSegments.prototype);BoxHelper.prototype.constructor=BoxHelper;BoxHelper.prototype.update=function(){var box=new Box3();return function update(object){if(object!==undefined){console.warn('THREE.BoxHelper: .update() has no longer arguments.');}if(this.object!==undefined){box.setFromObject(this.object);}if(box.isEmpty()){return;}var min=box.min;var max=box.max;/*
  		  5____4
  		1/___0/|
  		| 6__|_7
  		2/___3/

  		0: max.x, max.y, max.z
  		1: min.x, max.y, max.z
  		2: min.x, min.y, max.z
  		3: max.x, min.y, max.z
  		4: max.x, max.y, min.z
  		5: min.x, max.y, min.z
  		6: min.x, min.y, min.z
  		7: max.x, min.y, min.z
  		*/var position=this.geometry.attributes.position;var array=position.array;array[0]=max.x;array[1]=max.y;array[2]=max.z;array[3]=min.x;array[4]=max.y;array[5]=max.z;array[6]=min.x;array[7]=min.y;array[8]=max.z;array[9]=max.x;array[10]=min.y;array[11]=max.z;array[12]=max.x;array[13]=max.y;array[14]=min.z;array[15]=min.x;array[16]=max.y;array[17]=min.z;array[18]=min.x;array[19]=min.y;array[20]=min.z;array[21]=max.x;array[22]=min.y;array[23]=min.z;position.needsUpdate=true;this.geometry.computeBoundingSphere();};}();BoxHelper.prototype.setFromObject=function(object){this.object=object;this.update();return this;};/*===================================================

  	utility

  	=====================================================*/Raycaster.prototype.intersectOctreeObject=function(object,recursive){var intersects,octreeObject,facesAll,facesSearch;if(object.object instanceof Object3D){octreeObject=object;object=octreeObject.object;// temporarily replace object geometry's faces with octree object faces
  facesSearch=octreeObject.faces;facesAll=object.geometry.faces;if(facesSearch.length>0){object.geometry.faces=facesSearch;}// intersect
  intersects=this.intersectObject(object,recursive);// revert object geometry's faces
  if(facesSearch.length>0){object.geometry.faces=facesAll;}}else{intersects=this.intersectObject(object,recursive);}return intersects;};Raycaster.prototype.intersectOctreeObjects=function(objects,recursive){var this$1=this;var i,il,intersects=[];for(i=0, il=objects.length;i<il;i++){intersects=intersects.concat(this$1.intersectOctreeObject(objects[i],recursive));}return intersects;};/**
   * @author Prashant Sharma / spidersharma03
   * @author Ben Houston / bhouston, https://clara.io
   *
   * This class takes the cube lods(corresponding to different roughness values), and creates a single cubeUV
   * Texture. The format for a given roughness set of faces is simply::
   * +X+Y+Z
   * -X-Y-Z
   * For every roughness a mip map chain is also saved, which is essential to remove the texture artifacts due to
   * minification.
   * Right now for every face a PlaneMesh is drawn, which leads to a lot of geometry draw calls, but can be replaced
   * later by drawing a single buffer and by sending the appropriate faceIndex via vertex attributes.
   * The arrangement of the faces is fixed, as assuming this arrangement, the sampling function has been written.
   */function WebGLRenderTargetCube(width,height,options){WebGLRenderTarget.call(this,width,height,options);this.activeCubeFace=0;// PX 0, NX 1, PY 2, NY 3, PZ 4, NZ 5
  this.activeMipMapLevel=0;}WebGLRenderTargetCube.prototype=Object.create(WebGLRenderTarget.prototype);WebGLRenderTargetCube.prototype.constructor=WebGLRenderTargetCube;WebGLRenderTargetCube.prototype.isWebGLRenderTargetCube=true;/**
   * @author Prashant Sharma / spidersharma03
   * @author Ben Houston / bhouston, https://clara.io
   *
   * To avoid cube map seams, I create an extra pixel around each face. This way when the cube map is
   * sampled by an application later(with a little care by sampling the centre of the texel), the extra 1 border
   *	of pixels makes sure that there is no seams artifacts present. This works perfectly for cubeUV format as
   *	well where the 6 faces can be arranged in any manner whatsoever.
   * Code in the beginning of fragment shader's main function does this job for a given resolution.
   *	Run Scene_PMREM_Test.html in the examples directory to see the sampling from the cube lods generated
   *	by this class.
   */var CopyShader={uniforms:{"tDiffuse":{value:null},"opacity":{value:1.0}},vertexShader:["varying vec2 vUv;","void main() {","vUv = uv;","gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),fragmentShader:["uniform float opacity;","uniform sampler2D tDiffuse;","varying vec2 vUv;","void main() {","vec4 texel = texture2D( tDiffuse, vUv );","gl_FragColor = opacity * texel;","}"].join("\n")};/**
   * @author alteredq / http://alteredqualia.com/
   *
   * Luminosity
   * http://en.wikipedia.org/wiki/Luminosity
   */var LuminosityShader={uniforms:{"tDiffuse":{value:null}},vertexShader:["varying vec2 vUv;","void main() {","vUv = uv;","gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),fragmentShader:["#include <common>","uniform sampler2D tDiffuse;","varying vec2 vUv;","void main() {","vec4 texel = texture2D( tDiffuse, vUv );","float l = linearToRelativeLuminance( texel.rgb );","gl_FragColor = vec4( l, l, l, texel.w );","}"].join("\n")};/**
   * @author miibond
   *
   * Full-screen tone-mapping shader based on http://www.cis.rit.edu/people/faculty/ferwerda/publications/sig02_paper.pdf
   */var ToneMapShader={uniforms:{"tDiffuse":{value:null},"averageLuminance":{value:1.0},"luminanceMap":{value:null},"maxLuminance":{value:16.0},"minLuminance":{value:0.01},"middleGrey":{value:0.6}},vertexShader:["varying vec2 vUv;","void main() {","vUv = uv;","gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),fragmentShader:["#include <common>","uniform sampler2D tDiffuse;","varying vec2 vUv;","uniform float middleGrey;","uniform float minLuminance;","uniform float maxLuminance;","#ifdef ADAPTED_LUMINANCE","uniform sampler2D luminanceMap;","#else","uniform float averageLuminance;","#endif","vec3 ToneMap( vec3 vColor ) {","#ifdef ADAPTED_LUMINANCE",// Get the calculated average luminance
  "float fLumAvg = texture2D(luminanceMap, vec2(0.5, 0.5)).r;","#else","float fLumAvg = averageLuminance;","#endif",// Calculate the luminance of the current pixel
  "float fLumPixel = linearToRelativeLuminance( vColor );",// Apply the modified operator (Eq. 4)
  "float fLumScaled = (fLumPixel * middleGrey) / max( minLuminance, fLumAvg );","float fLumCompressed = (fLumScaled * (1.0 + (fLumScaled / (maxLuminance * maxLuminance)))) / (1.0 + fLumScaled);","return fLumCompressed * vColor;","}","void main() {","vec4 texel = texture2D( tDiffuse, vUv );","gl_FragColor = vec4( ToneMap( texel.xyz ), texel.w );","}"].join("\n")};/**
   * @author miibond
   * Generate a texture that represents the luminosity of the current scene, adapted over time
   * to simulate the optic nerve responding to the amount of light it is receiving.
   * Based on a GDC2007 presentation by Wolfgang Engel titled "Post-Processing Pipeline"
   *
   * Full-screen tone-mapping shader based on http://www.graphics.cornell.edu/~jaf/publications/sig02_paper.pdf
   */var AdaptiveToneMappingPass=function AdaptiveToneMappingPass(adaptive,resolution){Pass.call(this);this.resolution=resolution!==undefined?resolution:256;this.needsInit=true;this.adaptive=adaptive!==undefined?!!adaptive:true;this.luminanceRT=null;this.previousLuminanceRT=null;this.currentLuminanceRT=null;if(CopyShader===undefined){console.error("AdaptiveToneMappingPass relies on CopyShader");}var copyShader=CopyShader;this.copyUniforms=UniformsUtils.clone(copyShader.uniforms);this.materialCopy=new ShaderMaterial({uniforms:this.copyUniforms,vertexShader:copyShader.vertexShader,fragmentShader:copyShader.fragmentShader,blending:NoBlending,depthTest:false});if(LuminosityShader===undefined){console.error("AdaptiveToneMappingPass relies on LuminosityShader");}this.materialLuminance=new ShaderMaterial({uniforms:UniformsUtils.clone(LuminosityShader.uniforms),vertexShader:LuminosityShader.vertexShader,fragmentShader:LuminosityShader.fragmentShader,blending:NoBlending});this.adaptLuminanceShader={defines:{"MIP_LEVEL_1X1":(Math.log(this.resolution)/Math.log(2.0)).toFixed(1)},uniforms:{"lastLum":{value:null},"currentLum":{value:null},"minLuminance":{value:0.01},"delta":{value:0.016},"tau":{value:1.0}},vertexShader:["varying vec2 vUv;","void main() {","vUv = uv;","gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join('\n'),fragmentShader:["varying vec2 vUv;","uniform sampler2D lastLum;","uniform sampler2D currentLum;","uniform float minLuminance;","uniform float delta;","uniform float tau;","void main() {","vec4 lastLum = texture2D( lastLum, vUv, MIP_LEVEL_1X1 );","vec4 currentLum = texture2D( currentLum, vUv, MIP_LEVEL_1X1 );","float fLastLum = max( minLuminance, lastLum.r );","float fCurrentLum = max( minLuminance, currentLum.r );",//The adaption seems to work better in extreme lighting differences
  //if the input luminance is squared.
  "fCurrentLum *= fCurrentLum;",// Adapt the luminance using Pattanaik's technique
  "float fAdaptedLum = fLastLum + (fCurrentLum - fLastLum) * (1.0 - exp(-delta * tau));",// "fAdaptedLum = sqrt(fAdaptedLum);",
  "gl_FragColor.r = fAdaptedLum;","}"].join('\n')};this.materialAdaptiveLum=new ShaderMaterial({uniforms:UniformsUtils.clone(this.adaptLuminanceShader.uniforms),vertexShader:this.adaptLuminanceShader.vertexShader,fragmentShader:this.adaptLuminanceShader.fragmentShader,defines:this.adaptLuminanceShader.defines,blending:NoBlending});if(ToneMapShader===undefined){console.error("AdaptiveToneMappingPass relies on ToneMapShader");}this.materialToneMap=new ShaderMaterial({uniforms:UniformsUtils.clone(ToneMapShader.uniforms),vertexShader:ToneMapShader.vertexShader,fragmentShader:ToneMapShader.fragmentShader,blending:NoBlending});this.camera=new OrthographicCamera(-1,1,1,-1,0,1);this.scene=new Scene();this.quad=new Mesh(new PlaneBufferGeometry(2,2),null);this.quad.frustumCulled=false;// Avoid getting clipped
  this.scene.add(this.quad);};AdaptiveToneMappingPass.prototype=Object.assign(Object.create(Pass.prototype),{constructor:AdaptiveToneMappingPass,render:function render(renderer,writeBuffer,readBuffer,delta,maskActive){if(this.needsInit){this.reset(renderer);this.luminanceRT.texture.type=readBuffer.texture.type;this.previousLuminanceRT.texture.type=readBuffer.texture.type;this.currentLuminanceRT.texture.type=readBuffer.texture.type;this.needsInit=false;}if(this.adaptive){//Render the luminance of the current scene into a render target with mipmapping enabled
  this.quad.material=this.materialLuminance;this.materialLuminance.uniforms.tDiffuse.value=readBuffer.texture;renderer.render(this.scene,this.camera,this.currentLuminanceRT);//Use the new luminance values, the previous luminance and the frame delta to
  //adapt the luminance over time.
  this.quad.material=this.materialAdaptiveLum;this.materialAdaptiveLum.uniforms.delta.value=delta;this.materialAdaptiveLum.uniforms.lastLum.value=this.previousLuminanceRT.texture;this.materialAdaptiveLum.uniforms.currentLum.value=this.currentLuminanceRT.texture;renderer.render(this.scene,this.camera,this.luminanceRT);//Copy the new adapted luminance value so that it can be used by the next frame.
  this.quad.material=this.materialCopy;this.copyUniforms.tDiffuse.value=this.luminanceRT.texture;renderer.render(this.scene,this.camera,this.previousLuminanceRT);}this.quad.material=this.materialToneMap;this.materialToneMap.uniforms.tDiffuse.value=readBuffer.texture;if(this.renderToScreen){renderer.render(this.scene,this.camera);}else{renderer.render(this.scene,this.camera,writeBuffer,this.clear);}},reset:function reset(renderer){// render targets
  if(this.luminanceRT){this.luminanceRT.dispose();}if(this.currentLuminanceRT){this.currentLuminanceRT.dispose();}if(this.previousLuminanceRT){this.previousLuminanceRT.dispose();}var pars={minFilter:LinearFilter,magFilter:LinearFilter,format:RGBAFormat};// was RGB format. changed to RGBA format. see discussion in #8415 / #8450
  this.luminanceRT=new WebGLRenderTarget(this.resolution,this.resolution,pars);this.luminanceRT.texture.name="AdaptiveToneMappingPass.l";this.luminanceRT.texture.generateMipmaps=false;this.previousLuminanceRT=new WebGLRenderTarget(this.resolution,this.resolution,pars);this.previousLuminanceRT.texture.name="AdaptiveToneMappingPass.pl";this.previousLuminanceRT.texture.generateMipmaps=false;// We only need mipmapping for the current luminosity because we want a down-sampled version to sample in our adaptive shader
  pars.minFilter=LinearMipMapLinearFilter;this.currentLuminanceRT=new WebGLRenderTarget(this.resolution,this.resolution,pars);this.currentLuminanceRT.texture.name="AdaptiveToneMappingPass.cl";if(this.adaptive){this.materialToneMap.defines["ADAPTED_LUMINANCE"]="";this.materialToneMap.uniforms.luminanceMap.value=this.luminanceRT.texture;}//Put something in the adaptive luminance texture so that the scene can render initially
  this.quad.material=new MeshBasicMaterial({color:0x777777});this.materialLuminance.needsUpdate=true;this.materialAdaptiveLum.needsUpdate=true;this.materialToneMap.needsUpdate=true;// renderer.render( this.scene, this.camera, this.luminanceRT );
  // renderer.render( this.scene, this.camera, this.previousLuminanceRT );
  // renderer.render( this.scene, this.camera, this.currentLuminanceRT );
  },setAdaptive:function setAdaptive(adaptive){if(adaptive){this.adaptive=true;this.materialToneMap.defines["ADAPTED_LUMINANCE"]="";this.materialToneMap.uniforms.luminanceMap.value=this.luminanceRT.texture;}else{this.adaptive=false;delete this.materialToneMap.defines["ADAPTED_LUMINANCE"];this.materialToneMap.uniforms.luminanceMap.value=null;}this.materialToneMap.needsUpdate=true;},setAdaptionRate:function setAdaptionRate(rate){if(rate){this.materialAdaptiveLum.uniforms.tau.value=Math.abs(rate);}},setMinLuminance:function setMinLuminance(minLum){if(minLum){this.materialToneMap.uniforms.minLuminance.value=minLum;this.materialAdaptiveLum.uniforms.minLuminance.value=minLum;}},setMaxLuminance:function setMaxLuminance(maxLum){if(maxLum){this.materialToneMap.uniforms.maxLuminance.value=maxLum;}},setAverageLuminance:function setAverageLuminance(avgLum){if(avgLum){this.materialToneMap.uniforms.averageLuminance.value=avgLum;}},setMiddleGrey:function setMiddleGrey(middleGrey){if(middleGrey){this.materialToneMap.uniforms.middleGrey.value=middleGrey;}},dispose:function dispose(){if(this.luminanceRT){this.luminanceRT.dispose();}if(this.previousLuminanceRT){this.previousLuminanceRT.dispose();}if(this.currentLuminanceRT){this.currentLuminanceRT.dispose();}if(this.materialLuminance){this.materialLuminance.dispose();}if(this.materialAdaptiveLum){this.materialAdaptiveLum.dispose();}if(this.materialCopy){this.materialCopy.dispose();}if(this.materialToneMap){this.materialToneMap.dispose();}}});/**
   * @author alteredq / http://alteredqualia.com/
   *
   * Convolution shader
   * ported from o3d sample to WebGL / GLSL
   * http://o3d.googlecode.com/svn/trunk/samples/convolution.html
   */var ConvolutionShader={defines:{"KERNEL_SIZE_FLOAT":"25.0","KERNEL_SIZE_INT":"25"},uniforms:{"tDiffuse":{value:null},"uImageIncrement":{value:new Vector2$1(0.001953125,0.0)},"cKernel":{value:[]}},vertexShader:["uniform vec2 uImageIncrement;","varying vec2 vUv;","void main() {","vUv = uv - ( ( KERNEL_SIZE_FLOAT - 1.0 ) / 2.0 ) * uImageIncrement;","gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),fragmentShader:["uniform float cKernel[ KERNEL_SIZE_INT ];","uniform sampler2D tDiffuse;","uniform vec2 uImageIncrement;","varying vec2 vUv;","void main() {","vec2 imageCoord = vUv;","vec4 sum = vec4( 0.0, 0.0, 0.0, 0.0 );","for( int i = 0; i < KERNEL_SIZE_INT; i ++ ) {","sum += texture2D( tDiffuse, imageCoord ) * cKernel[ i ];","imageCoord += uImageIncrement;","}","gl_FragColor = sum;","}"].join("\n"),buildKernel:function buildKernel(sigma){// We lop off the sqrt(2 * pi) * sigma term, since we're going to normalize anyway.
  function gauss(x,sigma){return Math.exp(-(x*x)/(2.0*sigma*sigma));}var i,values,sum,halfWidth,kMaxKernelSize=25,kernelSize=2*Math.ceil(sigma*3.0)+1;if(kernelSize>kMaxKernelSize){kernelSize=kMaxKernelSize;}halfWidth=(kernelSize-1)*0.5;values=new Array(kernelSize);sum=0.0;for(i=0;i<kernelSize;++i){values[i]=gauss(i-halfWidth,sigma);sum+=values[i];}// normalize the kernel
  for(i=0;i<kernelSize;++i){values[i]/=sum;}return values;}};/**
   * @author alteredq / http://alteredqualia.com/
   */var BloomPass=function BloomPass(strength,kernelSize,sigma,resolution){Pass.call(this);strength=strength!==undefined?strength:1;kernelSize=kernelSize!==undefined?kernelSize:25;sigma=sigma!==undefined?sigma:4.0;resolution=resolution!==undefined?resolution:256;// render targets
  var pars={minFilter:LinearFilter,magFilter:LinearFilter,format:RGBAFormat};this.renderTargetX=new WebGLRenderTarget(resolution,resolution,pars);this.renderTargetX.texture.name="BloomPass.x";this.renderTargetY=new WebGLRenderTarget(resolution,resolution,pars);this.renderTargetY.texture.name="BloomPass.y";// copy material
  if(CopyShader===undefined){console.error("BloomPass relies on CopyShader");}var copyShader=CopyShader;this.copyUniforms=UniformsUtils.clone(copyShader.uniforms);this.copyUniforms["opacity"].value=strength;this.materialCopy=new ShaderMaterial({uniforms:this.copyUniforms,vertexShader:copyShader.vertexShader,fragmentShader:copyShader.fragmentShader,blending:AdditiveBlending,transparent:true});// convolution material
  if(ConvolutionShader===undefined){console.error("BloomPass relies on ConvolutionShader");}var convolutionShader=ConvolutionShader;this.convolutionUniforms=UniformsUtils.clone(convolutionShader.uniforms);this.convolutionUniforms["uImageIncrement"].value=BloomPass.blurX;this.convolutionUniforms["cKernel"].value=ConvolutionShader.buildKernel(sigma);this.materialConvolution=new ShaderMaterial({uniforms:this.convolutionUniforms,vertexShader:convolutionShader.vertexShader,fragmentShader:convolutionShader.fragmentShader,defines:{"KERNEL_SIZE_FLOAT":kernelSize.toFixed(1),"KERNEL_SIZE_INT":kernelSize.toFixed(0)}});this.needsSwap=false;this.camera=new OrthographicCamera(-1,1,1,-1,0,1);this.scene=new Scene();this.quad=new Mesh(new PlaneBufferGeometry(2,2),null);this.quad.frustumCulled=false;// Avoid getting clipped
  this.scene.add(this.quad);};BloomPass.prototype=Object.assign(Object.create(Pass.prototype),{constructor:BloomPass,render:function render(renderer,writeBuffer,readBuffer,delta,maskActive){if(maskActive){renderer.context.disable(renderer.context.STENCIL_TEST);}// Render quad with blured scene into texture (convolution pass 1)
  this.quad.material=this.materialConvolution;this.convolutionUniforms["tDiffuse"].value=readBuffer.texture;this.convolutionUniforms["uImageIncrement"].value=BloomPass.blurX;renderer.render(this.scene,this.camera,this.renderTargetX,true);// Render quad with blured scene into texture (convolution pass 2)
  this.convolutionUniforms["tDiffuse"].value=this.renderTargetX.texture;this.convolutionUniforms["uImageIncrement"].value=BloomPass.blurY;renderer.render(this.scene,this.camera,this.renderTargetY,true);// Render original scene with superimposed blur to texture
  this.quad.material=this.materialCopy;this.copyUniforms["tDiffuse"].value=this.renderTargetY.texture;if(maskActive){renderer.context.enable(renderer.context.STENCIL_TEST);}renderer.render(this.scene,this.camera,readBuffer,this.clear);}});BloomPass.blurX=new Vector2$1(0.001953125,0.0);BloomPass.blurY=new Vector2$1(0.0,0.001953125);/**
   * Depth-of-field post-process with bokeh shader
   */var BokehPass=function BokehPass(scene,camera,params){Pass.call(this);this.scene=scene;this.camera=camera;var focus=params.focus!==undefined?params.focus:1.0;var aspect=params.aspect!==undefined?params.aspect:camera.aspect;var aperture=params.aperture!==undefined?params.aperture:0.025;var maxblur=params.maxblur!==undefined?params.maxblur:1.0;// render targets
  var width=params.width||window.innerWidth||1;var height=params.height||window.innerHeight||1;this.renderTargetColor=new WebGLRenderTarget(width,height,{minFilter:LinearFilter,magFilter:LinearFilter,format:RGBFormat});this.renderTargetColor.texture.name="BokehPass.color";this.renderTargetDepth=this.renderTargetColor.clone();this.renderTargetDepth.texture.name="BokehPass.depth";// depth material
  this.materialDepth=new MeshDepthMaterial();this.materialDepth.depthPacking=RGBADepthPacking;this.materialDepth.blending=NoBlending;// bokeh material
  if(BokehShader===undefined){console.error("BokehPass relies on BokehShader");}var bokehShader=BokehShader;var bokehUniforms=UniformsUtils.clone(bokehShader.uniforms);bokehUniforms["tDepth"].value=this.renderTargetDepth.texture;bokehUniforms["focus"].value=focus;bokehUniforms["aspect"].value=aspect;bokehUniforms["aperture"].value=aperture;bokehUniforms["maxblur"].value=maxblur;bokehUniforms["nearClip"].value=camera.near;bokehUniforms["farClip"].value=camera.far;this.materialBokeh=new ShaderMaterial({defines:bokehShader.defines,uniforms:bokehUniforms,vertexShader:bokehShader.vertexShader,fragmentShader:bokehShader.fragmentShader});this.uniforms=bokehUniforms;this.needsSwap=false;this.camera2=new OrthographicCamera(-1,1,1,-1,0,1);this.scene2=new Scene();this.quad2=new Mesh(new PlaneBufferGeometry(2,2),null);this.quad2.frustumCulled=false;// Avoid getting clipped
  this.scene2.add(this.quad2);this.oldClearColor=new Color$1();this.oldClearAlpha=1;};BokehPass.prototype=Object.assign(Object.create(Pass.prototype),{constructor:BokehPass,render:function render(renderer,writeBuffer,readBuffer,delta,maskActive){this.quad2.material=this.materialBokeh;// Render depth into texture
  this.scene.overrideMaterial=this.materialDepth;this.oldClearColor.copy(renderer.getClearColor());this.oldClearAlpha=renderer.getClearAlpha();var oldAutoClear=renderer.autoClear;renderer.autoClear=false;renderer.setClearColor(0xffffff);renderer.setClearAlpha(1.0);renderer.render(this.scene,this.camera,this.renderTargetDepth,true);// Render bokeh composite
  this.uniforms["tColor"].value=readBuffer.texture;this.uniforms["nearClip"].value=this.camera.near;this.uniforms["farClip"].value=this.camera.far;if(this.renderToScreen){renderer.render(this.scene2,this.camera2);}else{renderer.render(this.scene2,this.camera2,writeBuffer,this.clear);}this.scene.overrideMaterial=null;renderer.setClearColor(this.oldClearColor);renderer.setClearAlpha(this.oldClearAlpha);renderer.autoClear=this.oldAutoClear;}});/**
   * @author mrdoob / http://mrdoob.com/
   */var ClearPass=function ClearPass(clearColor,clearAlpha){Pass.call(this);this.needsSwap=false;this.clearColor=clearColor!==undefined?clearColor:0x000000;this.clearAlpha=clearAlpha!==undefined?clearAlpha:0;};ClearPass.prototype=Object.assign(Object.create(Pass.prototype),{constructor:ClearPass,render:function render(renderer,writeBuffer,readBuffer,delta,maskActive){var oldClearColor,oldClearAlpha;if(this.clearColor){oldClearColor=renderer.getClearColor().getHex();oldClearAlpha=renderer.getClearAlpha();renderer.setClearColor(this.clearColor,this.clearAlpha);}renderer.setRenderTarget(this.renderToScreen?null:readBuffer);renderer.clear();if(this.clearColor){renderer.setClearColor(oldClearColor,oldClearAlpha);}}});/**
   * @author bhouston / http://clara.io/
   */var CubeTexturePass=function CubeTexturePass(camera,envMap,opacity){Pass.call(this);this.camera=camera;this.needsSwap=false;this.cubeShader=ShaderLib['cube'];this.cubeMesh=new Mesh(new BoxBufferGeometry(10,10,10),new ShaderMaterial({uniforms:this.cubeShader.uniforms,vertexShader:this.cubeShader.vertexShader,fragmentShader:this.cubeShader.fragmentShader,depthTest:false,depthWrite:false,side:BackSide}));this.envMap=envMap;this.opacity=opacity!==undefined?opacity:1.0;this.cubeScene=new Scene();this.cubeCamera=new PerspectiveCamera();this.cubeScene.add(this.cubeMesh);};CubeTexturePass.prototype=Object.assign(Object.create(Pass.prototype),{constructor:CubeTexturePass,render:function render(renderer,writeBuffer,readBuffer,delta,maskActive){var oldAutoClear=renderer.autoClear;renderer.autoClear=false;this.cubeCamera.projectionMatrix.copy(this.camera.projectionMatrix);this.cubeCamera.quaternion.setFromRotationMatrix(this.camera.matrixWorld);this.cubeMesh.material.uniforms["tCube"].value=this.envMap;this.cubeMesh.material.uniforms["opacity"].value=this.opacity;this.cubeMesh.material.transparent=this.opacity<1.0;renderer.render(this.cubeScene,this.cubeCamera,this.renderToScreen?null:readBuffer,this.clear);renderer.autoClear=oldAutoClear;}});/**
   * @author alteredq / http://alteredqualia.com/
   *
   * Dot screen shader
   * based on glfx.js sepia shader
   * https://github.com/evanw/glfx.js
   */var DotScreenShader={uniforms:{"tDiffuse":{value:null},"tSize":{value:new Vector2$1(256,256)},"center":{value:new Vector2$1(0.5,0.5)},"angle":{value:1.57},"scale":{value:1.0}},vertexShader:["varying vec2 vUv;","void main() {","vUv = uv;","gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),fragmentShader:["uniform vec2 center;","uniform float angle;","uniform float scale;","uniform vec2 tSize;","uniform sampler2D tDiffuse;","varying vec2 vUv;","float pattern() {","float s = sin( angle ), c = cos( angle );","vec2 tex = vUv * tSize - center;","vec2 point = vec2( c * tex.x - s * tex.y, s * tex.x + c * tex.y ) * scale;","return ( sin( point.x ) * sin( point.y ) ) * 4.0;","}","void main() {","vec4 color = texture2D( tDiffuse, vUv );","float average = ( color.r + color.g + color.b ) / 3.0;","gl_FragColor = vec4( vec3( average * 10.0 - 5.0 + pattern() ), color.a );","}"].join("\n")};/**
   * @author alteredq / http://alteredqualia.com/
   */var DotScreenPass=function DotScreenPass(center,angle,scale){Pass.call(this);if(DotScreenShader===undefined){console.error("DotScreenPass relies on DotScreenShader");}var shader=DotScreenShader;this.uniforms=UniformsUtils.clone(shader.uniforms);if(center!==undefined){this.uniforms["center"].value.copy(center);}if(angle!==undefined){this.uniforms["angle"].value=angle;}if(scale!==undefined){this.uniforms["scale"].value=scale;}this.material=new ShaderMaterial({uniforms:this.uniforms,vertexShader:shader.vertexShader,fragmentShader:shader.fragmentShader});this.camera=new OrthographicCamera(-1,1,1,-1,0,1);this.scene=new Scene();this.quad=new Mesh(new PlaneBufferGeometry(2,2),null);this.quad.frustumCulled=false;// Avoid getting clipped
  this.scene.add(this.quad);};DotScreenPass.prototype=Object.assign(Object.create(Pass.prototype),{constructor:DotScreenPass,render:function render(renderer,writeBuffer,readBuffer,delta,maskActive){this.uniforms["tDiffuse"].value=readBuffer.texture;this.uniforms["tSize"].value.set(readBuffer.width,readBuffer.height);this.quad.material=this.material;if(this.renderToScreen){renderer.render(this.scene,this.camera);}else{renderer.render(this.scene,this.camera,writeBuffer,this.clear);}}});/**
   * @author alteredq / http://alteredqualia.com/
   */var MaskPass=function MaskPass(scene,camera){Pass.call(this);this.scene=scene;this.camera=camera;this.clear=true;this.needsSwap=false;this.inverse=false;};MaskPass.prototype=Object.assign(Object.create(Pass.prototype),{constructor:MaskPass,render:function render(renderer,writeBuffer,readBuffer,delta,maskActive){var context=renderer.context;var state=renderer.state;// don't update color or depth
  state.buffers.color.setMask(false);state.buffers.depth.setMask(false);// lock buffers
  state.buffers.color.setLocked(true);state.buffers.depth.setLocked(true);// set up stencil
  var writeValue,clearValue;if(this.inverse){writeValue=0;clearValue=1;}else{writeValue=1;clearValue=0;}state.buffers.stencil.setTest(true);state.buffers.stencil.setOp(context.REPLACE,context.REPLACE,context.REPLACE);state.buffers.stencil.setFunc(context.ALWAYS,writeValue,0xffffffff);state.buffers.stencil.setClear(clearValue);// draw into the stencil buffer
  renderer.render(this.scene,this.camera,readBuffer,this.clear);renderer.render(this.scene,this.camera,writeBuffer,this.clear);// unlock color and depth buffer for subsequent rendering
  state.buffers.color.setLocked(false);state.buffers.depth.setLocked(false);// only render where stencil is set to 1
  state.buffers.stencil.setFunc(context.EQUAL,1,0xffffffff);// draw if == 1
  state.buffers.stencil.setOp(context.KEEP,context.KEEP,context.KEEP);}});var ClearMaskPass=function ClearMaskPass(){Pass.call(this);this.needsSwap=false;};ClearMaskPass.prototype=Object.create(Pass.prototype);Object.assign(ClearMaskPass.prototype,{render:function render(renderer,writeBuffer,readBuffer,delta,maskActive){renderer.state.buffers.stencil.setTest(false);}});/**
   * @author alteredq / http://alteredqualia.com/
   */var EffectComposer=function EffectComposer(renderer,renderTarget){this.renderer=renderer;if(renderTarget===undefined){var parameters={minFilter:LinearFilter,magFilter:LinearFilter,format:RGBAFormat,stencilBuffer:false};var size=renderer.getDrawingBufferSize();renderTarget=new WebGLRenderTarget(size.width,size.height,parameters);renderTarget.texture.name='EffectComposer.rt1';}this.renderTarget1=renderTarget;this.renderTarget2=renderTarget.clone();this.renderTarget2.texture.name='EffectComposer.rt2';this.writeBuffer=this.renderTarget1;this.readBuffer=this.renderTarget2;this.passes=[];// dependencies
  if(CopyShader===undefined){console.error('EffectComposer relies on CopyShader');}if(ShaderPass===undefined){console.error('EffectComposer relies on ShaderPass');}this.copyPass=new ShaderPass(CopyShader);};Object.assign(EffectComposer.prototype,{swapBuffers:function swapBuffers(){var tmp=this.readBuffer;this.readBuffer=this.writeBuffer;this.writeBuffer=tmp;},addPass:function addPass(pass){this.passes.push(pass);var size=this.renderer.getDrawingBufferSize();pass.setSize(size.width,size.height);},insertPass:function insertPass(pass,index){this.passes.splice(index,0,pass);},render:function render(delta){var this$1=this;var maskActive=false;var pass,i,il=this.passes.length;for(i=0;i<il;i++){pass=this$1.passes[i];if(pass.enabled===false){continue;}pass.render(this$1.renderer,this$1.writeBuffer,this$1.readBuffer,delta,maskActive);if(pass.needsSwap){if(maskActive){var context=this$1.renderer.context;context.stencilFunc(context.NOTEQUAL,1,0xffffffff);this$1.copyPass.render(this$1.renderer,this$1.writeBuffer,this$1.readBuffer,delta);context.stencilFunc(context.EQUAL,1,0xffffffff);}this$1.swapBuffers();}if(MaskPass!==undefined){if(pass instanceof MaskPass){maskActive=true;}else if(pass instanceof ClearMaskPass){maskActive=false;}}}},reset:function reset(renderTarget){if(renderTarget===undefined){var size=this.renderer.getDrawingBufferSize();renderTarget=this.renderTarget1.clone();renderTarget.setSize(size.width,size.height);}this.renderTarget1.dispose();this.renderTarget2.dispose();this.renderTarget1=renderTarget;this.renderTarget2=renderTarget.clone();this.writeBuffer=this.renderTarget1;this.readBuffer=this.renderTarget2;},setSize:function setSize(width,height){var this$1=this;this.renderTarget1.setSize(width,height);this.renderTarget2.setSize(width,height);for(var i=0;i<this.passes.length;i++){this$1.passes[i].setSize(width,height);}}});/**
   * @author alteredq / http://alteredqualia.com/
   *
   * Film grain & scanlines shader
   *
   * - ported from HLSL to WebGL / GLSL
   * http://www.truevision3d.com/forums/showcase/staticnoise_colorblackwhite_scanline_shaders-t18698.0.html
   *
   * Screen Space Static Postprocessor
   *
   * Produces an analogue noise overlay similar to a film grain / TV static
   *
   * Original implementation and noise algorithm
   * Pat 'Hawthorne' Shearon
   *
   * Optimized scanlines + noise version with intensity scaling
   * Georg 'Leviathan' Steinrohder
   *
   * This version is provided under a Creative Commons Attribution 3.0 License
   * http://creativecommons.org/licenses/by/3.0/
   */var FilmShader={uniforms:{"tDiffuse":{value:null},"time":{value:0.0},"nIntensity":{value:0.5},"sIntensity":{value:0.05},"sCount":{value:4096},"grayscale":{value:1}},vertexShader:["varying vec2 vUv;","void main() {","vUv = uv;","gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),fragmentShader:["#include <common>",// control parameter
  "uniform float time;","uniform bool grayscale;",// noise effect intensity value (0 = no effect, 1 = full effect)
  "uniform float nIntensity;",// scanlines effect intensity value (0 = no effect, 1 = full effect)
  "uniform float sIntensity;",// scanlines effect count value (0 = no effect, 4096 = full effect)
  "uniform float sCount;","uniform sampler2D tDiffuse;","varying vec2 vUv;","void main() {",// sample the source
  "vec4 cTextureScreen = texture2D( tDiffuse, vUv );",// make some noise
  "float dx = rand( vUv + time );",// add noise
  "vec3 cResult = cTextureScreen.rgb + cTextureScreen.rgb * clamp( 0.1 + dx, 0.0, 1.0 );",// get us a sine and cosine
  "vec2 sc = vec2( sin( vUv.y * sCount ), cos( vUv.y * sCount ) );",// add scanlines
  "cResult += cTextureScreen.rgb * vec3( sc.x, sc.y, sc.x ) * sIntensity;",// interpolate between source and result by intensity
  "cResult = cTextureScreen.rgb + clamp( nIntensity, 0.0,1.0 ) * ( cResult - cTextureScreen.rgb );",// convert to grayscale if desired
  "if( grayscale ) {","cResult = vec3( cResult.r * 0.3 + cResult.g * 0.59 + cResult.b * 0.11 );","}","gl_FragColor =  vec4( cResult, cTextureScreen.a );","}"].join("\n")};/**
   * @author alteredq / http://alteredqualia.com/
   */var FilmPass=function FilmPass(noiseIntensity,scanlinesIntensity,scanlinesCount,grayscale){Pass.call(this);if(FilmShader===undefined){console.error("FilmPass relies on FilmShader");}var shader=FilmShader;this.uniforms=UniformsUtils.clone(shader.uniforms);this.material=new ShaderMaterial({uniforms:this.uniforms,vertexShader:shader.vertexShader,fragmentShader:shader.fragmentShader});if(grayscale!==undefined){this.uniforms.grayscale.value=grayscale;}if(noiseIntensity!==undefined){this.uniforms.nIntensity.value=noiseIntensity;}if(scanlinesIntensity!==undefined){this.uniforms.sIntensity.value=scanlinesIntensity;}if(scanlinesCount!==undefined){this.uniforms.sCount.value=scanlinesCount;}this.camera=new OrthographicCamera(-1,1,1,-1,0,1);this.scene=new Scene();this.quad=new Mesh(new PlaneBufferGeometry(2,2),null);this.quad.frustumCulled=false;// Avoid getting clipped
  this.scene.add(this.quad);};FilmPass.prototype=Object.assign(Object.create(Pass.prototype),{constructor:FilmPass,render:function render(renderer,writeBuffer,readBuffer,delta,maskActive){this.uniforms["tDiffuse"].value=readBuffer.texture;this.uniforms["time"].value+=delta;this.quad.material=this.material;if(this.renderToScreen){renderer.render(this.scene,this.camera);}else{renderer.render(this.scene,this.camera,writeBuffer,this.clear);}}});/**
   * @author felixturner / http://airtight.cc/
   *
   * RGB Shift Shader
   * Shifts red and blue channels from center in opposite directions
   * Ported from http://kriss.cx/tom/2009/05/rgb-shift/
   * by Tom Butterworth / http://kriss.cx/tom/
   *
   * amount: shift distance (1 is width of input)
   * angle: shift angle in radians
   */var DigitalGlitch={uniforms:{"tDiffuse":{value:null},//diffuse texture
  "tDisp":{value:null},//displacement texture for digital glitch squares
  "byp":{value:0},//apply the glitch ?
  "amount":{value:0.08},"angle":{value:0.02},"seed":{value:0.02},"seed_x":{value:0.02},//-1,1
  "seed_y":{value:0.02},//-1,1
  "distortion_x":{value:0.5},"distortion_y":{value:0.6},"col_s":{value:0.05}},vertexShader:["varying vec2 vUv;","void main() {","vUv = uv;","gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),fragmentShader:["uniform int byp;",//should we apply the glitch ?
  "uniform sampler2D tDiffuse;","uniform sampler2D tDisp;","uniform float amount;","uniform float angle;","uniform float seed;","uniform float seed_x;","uniform float seed_y;","uniform float distortion_x;","uniform float distortion_y;","uniform float col_s;","varying vec2 vUv;","float rand(vec2 co){","return fract(sin(dot(co.xy ,vec2(12.9898,78.233))) * 43758.5453);","}","void main() {","if(byp<1) {","vec2 p = vUv;","float xs = floor(gl_FragCoord.x / 0.5);","float ys = floor(gl_FragCoord.y / 0.5);",//based on staffantans glitch shader for unity https://github.com/staffantan/unityglitch
  "vec4 normal = texture2D (tDisp, p*seed*seed);","if(p.y<distortion_x+col_s && p.y>distortion_x-col_s*seed) {","if(seed_x>0.){","p.y = 1. - (p.y + distortion_y);","}","else {","p.y = distortion_y;","}","}","if(p.x<distortion_y+col_s && p.x>distortion_y-col_s*seed) {","if(seed_y>0.){","p.x=distortion_x;","}","else {","p.x = 1. - (p.x + distortion_x);","}","}","p.x+=normal.x*seed_x*(seed/5.);","p.y+=normal.y*seed_y*(seed/5.);",//base from RGB shift shader
  "vec2 offset = amount * vec2( cos(angle), sin(angle));","vec4 cr = texture2D(tDiffuse, p + offset);","vec4 cga = texture2D(tDiffuse, p);","vec4 cb = texture2D(tDiffuse, p - offset);","gl_FragColor = vec4(cr.r, cga.g, cb.b, cga.a);",//add noise
  "vec4 snow = 200.*amount*vec4(rand(vec2(xs * seed,ys * seed*50.))*0.2);","gl_FragColor = gl_FragColor+ snow;","}","else {","gl_FragColor=texture2D (tDiffuse, vUv);","}","}"].join("\n")};/**
   * @author alteredq / http://alteredqualia.com/
   */var GlitchPass=function GlitchPass(dt_size){Pass.call(this);if(DigitalGlitch===undefined){console.error("GlitchPass relies on DigitalGlitch");}var shader=DigitalGlitch;this.uniforms=UniformsUtils.clone(shader.uniforms);if(dt_size==undefined){dt_size=64;}this.uniforms["tDisp"].value=this.generateHeightmap(dt_size);this.material=new ShaderMaterial({uniforms:this.uniforms,vertexShader:shader.vertexShader,fragmentShader:shader.fragmentShader});this.camera=new OrthographicCamera(-1,1,1,-1,0,1);this.scene=new Scene();this.quad=new Mesh(new PlaneBufferGeometry(2,2),null);this.quad.frustumCulled=false;// Avoid getting clipped
  this.scene.add(this.quad);this.goWild=false;this.curF=0;this.generateTrigger();};GlitchPass.prototype=Object.assign(Object.create(Pass.prototype),{constructor:GlitchPass,render:function render(renderer,writeBuffer,readBuffer,delta,maskActive){this.uniforms["tDiffuse"].value=readBuffer.texture;this.uniforms['seed'].value=Math.random();//default seeding
  this.uniforms['byp'].value=0;if(this.curF%this.randX==0||this.goWild==true){this.uniforms['amount'].value=Math.random()/30;this.uniforms['angle'].value=Math.randFloat(-Math.PI,Math.PI);this.uniforms['seed_x'].value=Math.randFloat(-1,1);this.uniforms['seed_y'].value=Math.randFloat(-1,1);this.uniforms['distortion_x'].value=Math.randFloat(0,1);this.uniforms['distortion_y'].value=Math.randFloat(0,1);this.curF=0;this.generateTrigger();}else if(this.curF%this.randX<this.randX/5){this.uniforms['amount'].value=Math.random()/90;this.uniforms['angle'].value=Math.randFloat(-Math.PI,Math.PI);this.uniforms['distortion_x'].value=Math.randFloat(0,1);this.uniforms['distortion_y'].value=Math.randFloat(0,1);this.uniforms['seed_x'].value=Math.randFloat(-0.3,0.3);this.uniforms['seed_y'].value=Math.randFloat(-0.3,0.3);}else if(this.goWild==false){this.uniforms['byp'].value=1;}this.curF++;this.quad.material=this.material;if(this.renderToScreen){renderer.render(this.scene,this.camera);}else{renderer.render(this.scene,this.camera,writeBuffer,this.clear);}},generateTrigger:function generateTrigger(){this.randX=Math.randInt(120,240);},generateHeightmap:function generateHeightmap(dt_size){var data_arr=new Float32Array(dt_size*dt_size*3);var length=dt_size*dt_size;for(var i=0;i<length;i++){var val=Math.randFloat(0,1);data_arr[i*3+0]=val;data_arr[i*3+1]=val;data_arr[i*3+2]=val;}var texture=new DataTexture(data_arr,dt_size,dt_size,RGBFormat,FloatType);texture.needsUpdate=true;return texture;}});/**
   * @author spidersharma / http://eduperiment.com/
   */var OutlinePass=function OutlinePass(resolution,scene,camera,selectedObjects){this.renderScene=scene;this.renderCamera=camera;this.selectedObjects=selectedObjects!==undefined?selectedObjects:[];this.visibleEdgeColor=new Color$1(1,1,1);this.hiddenEdgeColor=new Color$1(0.1,0.04,0.02);this.edgeGlow=0.0;this.usePatternTexture=false;this.edgeThickness=1.0;this.edgeStrength=3.0;this.downSampleRatio=2;this.pulsePeriod=0;Pass.call(this);this.resolution=resolution!==undefined?new Vector2$1(resolution.x,resolution.y):new Vector2$1(256,256);var pars={minFilter:LinearFilter,magFilter:LinearFilter,format:RGBAFormat};var resx=Math.round(this.resolution.x/this.downSampleRatio);var resy=Math.round(this.resolution.y/this.downSampleRatio);this.maskBufferMaterial=new MeshBasicMaterial({color:0xffffff});this.maskBufferMaterial.side=DoubleSide;this.renderTargetMaskBuffer=new WebGLRenderTarget(this.resolution.x,this.resolution.y,pars);this.renderTargetMaskBuffer.texture.name="OutlinePass.mask";this.renderTargetMaskBuffer.texture.generateMipmaps=false;this.depthMaterial=new MeshDepthMaterial();this.depthMaterial.side=DoubleSide;this.depthMaterial.depthPacking=RGBADepthPacking;this.depthMaterial.blending=NoBlending;this.prepareMaskMaterial=this.getPrepareMaskMaterial();this.prepareMaskMaterial.side=DoubleSide;this.renderTargetDepthBuffer=new WebGLRenderTarget(this.resolution.x,this.resolution.y,pars);this.renderTargetDepthBuffer.texture.name="OutlinePass.depth";this.renderTargetDepthBuffer.texture.generateMipmaps=false;this.renderTargetMaskDownSampleBuffer=new WebGLRenderTarget(resx,resy,pars);this.renderTargetMaskDownSampleBuffer.texture.name="OutlinePass.depthDownSample";this.renderTargetMaskDownSampleBuffer.texture.generateMipmaps=false;this.renderTargetBlurBuffer1=new WebGLRenderTarget(resx,resy,pars);this.renderTargetBlurBuffer1.texture.name="OutlinePass.blur1";this.renderTargetBlurBuffer1.texture.generateMipmaps=false;this.renderTargetBlurBuffer2=new WebGLRenderTarget(Math.round(resx/2),Math.round(resy/2),pars);this.renderTargetBlurBuffer2.texture.name="OutlinePass.blur2";this.renderTargetBlurBuffer2.texture.generateMipmaps=false;this.edgeDetectionMaterial=this.getEdgeDetectionMaterial();this.renderTargetEdgeBuffer1=new WebGLRenderTarget(resx,resy,pars);this.renderTargetEdgeBuffer1.texture.name="OutlinePass.edge1";this.renderTargetEdgeBuffer1.texture.generateMipmaps=false;this.renderTargetEdgeBuffer2=new WebGLRenderTarget(Math.round(resx/2),Math.round(resy/2),pars);this.renderTargetEdgeBuffer2.texture.name="OutlinePass.edge2";this.renderTargetEdgeBuffer2.texture.generateMipmaps=false;var MAX_EDGE_THICKNESS=4;var MAX_EDGE_GLOW=4;this.separableBlurMaterial1=this.getSeperableBlurMaterial(MAX_EDGE_THICKNESS);this.separableBlurMaterial1.uniforms["texSize"].value=new Vector2$1(resx,resy);this.separableBlurMaterial1.uniforms["kernelRadius"].value=1;this.separableBlurMaterial2=this.getSeperableBlurMaterial(MAX_EDGE_GLOW);this.separableBlurMaterial2.uniforms["texSize"].value=new Vector2$1(Math.round(resx/2),Math.round(resy/2));this.separableBlurMaterial2.uniforms["kernelRadius"].value=MAX_EDGE_GLOW;// Overlay material
  this.overlayMaterial=this.getOverlayMaterial();// copy material
  if(CopyShader===undefined){console.error("OutlinePass relies on CopyShader");}var copyShader=CopyShader;this.copyUniforms=UniformsUtils.clone(copyShader.uniforms);this.copyUniforms["opacity"].value=1.0;this.materialCopy=new ShaderMaterial({uniforms:this.copyUniforms,vertexShader:copyShader.vertexShader,fragmentShader:copyShader.fragmentShader,blending:NoBlending,depthTest:false,depthWrite:false,transparent:true});this.enabled=true;this.needsSwap=false;this.oldClearColor=new Color$1();this.oldClearAlpha=1;this.camera=new OrthographicCamera(-1,1,1,-1,0,1);this.scene=new Scene();this.quad=new Mesh(new PlaneBufferGeometry(2,2),null);this.quad.frustumCulled=false;// Avoid getting clipped
  this.scene.add(this.quad);this.tempPulseColor1=new Color$1();this.tempPulseColor2=new Color$1();this.textureMatrix=new Matrix4();};OutlinePass.prototype=Object.assign(Object.create(Pass.prototype),{constructor:OutlinePass,dispose:function dispose(){this.renderTargetMaskBuffer.dispose();this.renderTargetDepthBuffer.dispose();this.renderTargetMaskDownSampleBuffer.dispose();this.renderTargetBlurBuffer1.dispose();this.renderTargetBlurBuffer2.dispose();this.renderTargetEdgeBuffer1.dispose();this.renderTargetEdgeBuffer2.dispose();},setSize:function setSize(width,height){this.renderTargetMaskBuffer.setSize(width,height);var resx=Math.round(width/this.downSampleRatio);var resy=Math.round(height/this.downSampleRatio);this.renderTargetMaskDownSampleBuffer.setSize(resx,resy);this.renderTargetBlurBuffer1.setSize(resx,resy);this.renderTargetEdgeBuffer1.setSize(resx,resy);this.separableBlurMaterial1.uniforms["texSize"].value=new Vector2$1(resx,resy);resx=Math.round(resx/2);resy=Math.round(resy/2);this.renderTargetBlurBuffer2.setSize(resx,resy);this.renderTargetEdgeBuffer2.setSize(resx,resy);this.separableBlurMaterial2.uniforms["texSize"].value=new Vector2$1(resx,resy);},changeVisibilityOfSelectedObjects:function changeVisibilityOfSelectedObjects(bVisible){var this$1=this;function gatherSelectedMeshesCallBack(object){if(object instanceof Mesh){object.visible=bVisible;}}for(var i=0;i<this.selectedObjects.length;i++){var selectedObject=this$1.selectedObjects[i];selectedObject.traverse(gatherSelectedMeshesCallBack);}},changeVisibilityOfNonSelectedObjects:function changeVisibilityOfNonSelectedObjects(bVisible){var this$1=this;var selectedMeshes=[];function gatherSelectedMeshesCallBack(object){if(object instanceof Mesh){selectedMeshes.push(object);}}for(var i=0;i<this.selectedObjects.length;i++){var selectedObject=this$1.selectedObjects[i];selectedObject.traverse(gatherSelectedMeshesCallBack);}function VisibilityChangeCallBack(object){if(object instanceof Mesh||object instanceof Line$1||object instanceof Sprite){var bFound=false;for(var i=0;i<selectedMeshes.length;i++){var selectedObjectId=selectedMeshes[i].id;if(selectedObjectId===object.id){bFound=true;break;}}if(!bFound){var visibility=object.visible;if(!bVisible||object.bVisible){object.visible=bVisible;}object.bVisible=visibility;}}}this.renderScene.traverse(VisibilityChangeCallBack);},updateTextureMatrix:function updateTextureMatrix(){this.textureMatrix.set(0.5,0.0,0.0,0.5,0.0,0.5,0.0,0.5,0.0,0.0,0.5,0.5,0.0,0.0,0.0,1.0);this.textureMatrix.multiply(this.renderCamera.projectionMatrix);this.textureMatrix.multiply(this.renderCamera.matrixWorldInverse);},render:function render(renderer,writeBuffer,readBuffer,delta,maskActive){if(this.selectedObjects.length===0){return;}this.oldClearColor.copy(renderer.getClearColor());this.oldClearAlpha=renderer.getClearAlpha();var oldAutoClear=renderer.autoClear;renderer.autoClear=false;if(maskActive){renderer.context.disable(renderer.context.STENCIL_TEST);}renderer.setClearColor(0xffffff,1);// Make selected objects invisible
  this.changeVisibilityOfSelectedObjects(false);var currentBackground=this.renderScene.background;this.renderScene.background=null;// 1. Draw Non Selected objects in the depth buffer
  this.renderScene.overrideMaterial=this.depthMaterial;renderer.render(this.renderScene,this.renderCamera,this.renderTargetDepthBuffer,true);// Make selected objects visible
  this.changeVisibilityOfSelectedObjects(true);// Update Texture Matrix for Depth compare
  this.updateTextureMatrix();// Make non selected objects invisible, and draw only the selected objects, by comparing the depth buffer of non selected objects
  this.changeVisibilityOfNonSelectedObjects(false);this.renderScene.overrideMaterial=this.prepareMaskMaterial;this.prepareMaskMaterial.uniforms["cameraNearFar"].value=new Vector2$1(this.renderCamera.near,this.renderCamera.far);this.prepareMaskMaterial.uniforms["depthTexture"].value=this.renderTargetDepthBuffer.texture;this.prepareMaskMaterial.uniforms["textureMatrix"].value=this.textureMatrix;renderer.render(this.renderScene,this.renderCamera,this.renderTargetMaskBuffer,true);this.renderScene.overrideMaterial=null;this.changeVisibilityOfNonSelectedObjects(true);this.renderScene.background=currentBackground;// 2. Downsample to Half resolution
  this.quad.material=this.materialCopy;this.copyUniforms["tDiffuse"].value=this.renderTargetMaskBuffer.texture;renderer.render(this.scene,this.camera,this.renderTargetMaskDownSampleBuffer,true);this.tempPulseColor1.copy(this.visibleEdgeColor);this.tempPulseColor2.copy(this.hiddenEdgeColor);if(this.pulsePeriod>0){var scalar=(1+0.25)/2+Math.cos(performance.now()*0.01/this.pulsePeriod)*(1.0-0.25)/2;this.tempPulseColor1.multiplyScalar(scalar);this.tempPulseColor2.multiplyScalar(scalar);}// 3. Apply Edge Detection Pass
  this.quad.material=this.edgeDetectionMaterial;this.edgeDetectionMaterial.uniforms["maskTexture"].value=this.renderTargetMaskDownSampleBuffer.texture;this.edgeDetectionMaterial.uniforms["texSize"].value=new Vector2$1(this.renderTargetMaskDownSampleBuffer.width,this.renderTargetMaskDownSampleBuffer.height);this.edgeDetectionMaterial.uniforms["visibleEdgeColor"].value=this.tempPulseColor1;this.edgeDetectionMaterial.uniforms["hiddenEdgeColor"].value=this.tempPulseColor2;renderer.render(this.scene,this.camera,this.renderTargetEdgeBuffer1,true);// 4. Apply Blur on Half res
  this.quad.material=this.separableBlurMaterial1;this.separableBlurMaterial1.uniforms["colorTexture"].value=this.renderTargetEdgeBuffer1.texture;this.separableBlurMaterial1.uniforms["direction"].value=OutlinePass.BlurDirectionX;this.separableBlurMaterial1.uniforms["kernelRadius"].value=this.edgeThickness;renderer.render(this.scene,this.camera,this.renderTargetBlurBuffer1,true);this.separableBlurMaterial1.uniforms["colorTexture"].value=this.renderTargetBlurBuffer1.texture;this.separableBlurMaterial1.uniforms["direction"].value=OutlinePass.BlurDirectionY;renderer.render(this.scene,this.camera,this.renderTargetEdgeBuffer1,true);// Apply Blur on quarter res
  this.quad.material=this.separableBlurMaterial2;this.separableBlurMaterial2.uniforms["colorTexture"].value=this.renderTargetEdgeBuffer1.texture;this.separableBlurMaterial2.uniforms["direction"].value=OutlinePass.BlurDirectionX;renderer.render(this.scene,this.camera,this.renderTargetBlurBuffer2,true);this.separableBlurMaterial2.uniforms["colorTexture"].value=this.renderTargetBlurBuffer2.texture;this.separableBlurMaterial2.uniforms["direction"].value=OutlinePass.BlurDirectionY;renderer.render(this.scene,this.camera,this.renderTargetEdgeBuffer2,true);// Blend it additively over the input texture
  this.quad.material=this.overlayMaterial;this.overlayMaterial.uniforms["maskTexture"].value=this.renderTargetMaskBuffer.texture;this.overlayMaterial.uniforms["edgeTexture1"].value=this.renderTargetEdgeBuffer1.texture;this.overlayMaterial.uniforms["edgeTexture2"].value=this.renderTargetEdgeBuffer2.texture;this.overlayMaterial.uniforms["patternTexture"].value=this.patternTexture;this.overlayMaterial.uniforms["edgeStrength"].value=this.edgeStrength;this.overlayMaterial.uniforms["edgeGlow"].value=this.edgeGlow;this.overlayMaterial.uniforms["usePatternTexture"].value=this.usePatternTexture;if(maskActive){renderer.context.enable(renderer.context.STENCIL_TEST);}renderer.render(this.scene,this.camera,readBuffer,false);renderer.setClearColor(this.oldClearColor,this.oldClearAlpha);renderer.autoClear=oldAutoClear;},getPrepareMaskMaterial:function getPrepareMaskMaterial(){return new ShaderMaterial({uniforms:{"depthTexture":{value:null},"cameraNearFar":{value:new Vector2$1(0.5,0.5)},"textureMatrix":{value:new Matrix4()}},vertexShader:"varying vec2 vUv;\
				varying vec4 projTexCoord;\
				varying vec4 vPosition;\
				uniform mat4 textureMatrix;\
				void main() {\
					vUv = uv;\
					vPosition = modelViewMatrix * vec4( position, 1.0 );\
					vec4 worldPosition = modelMatrix * vec4( position, 1.0 );\
					projTexCoord = textureMatrix * worldPosition;\
					gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n\
				}",fragmentShader:"#include <packing>\
				varying vec2 vUv;\
				varying vec4 vPosition;\
				varying vec4 projTexCoord;\
				uniform sampler2D depthTexture;\
				uniform vec2 cameraNearFar;\
				\
				void main() {\
					float depth = unpackRGBAToDepth(texture2DProj( depthTexture, projTexCoord ));\
					float viewZ = -perspectiveDepthToViewZ( depth, cameraNearFar.x, cameraNearFar.y );\
					float depthTest = (-vPosition.z > viewZ) ? 1.0 : 0.0;\
					gl_FragColor = vec4(0.0, depthTest, 1.0, 1.0);\
				}"});},getEdgeDetectionMaterial:function getEdgeDetectionMaterial(){return new ShaderMaterial({uniforms:{"maskTexture":{value:null},"texSize":{value:new Vector2$1(0.5,0.5)},"visibleEdgeColor":{value:new Vector3$1(1.0,1.0,1.0)},"hiddenEdgeColor":{value:new Vector3$1(1.0,1.0,1.0)}},vertexShader:"varying vec2 vUv;\n\
				void main() {\n\
					vUv = uv;\n\
					gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n\
				}",fragmentShader:"varying vec2 vUv;\
				uniform sampler2D maskTexture;\
				uniform vec2 texSize;\
				uniform vec3 visibleEdgeColor;\
				uniform vec3 hiddenEdgeColor;\
				\
				void main() {\n\
					vec2 invSize = 1.0 / texSize;\
					vec4 uvOffset = vec4(1.0, 0.0, 0.0, 1.0) * vec4(invSize, invSize);\
					vec4 c1 = texture2D( maskTexture, vUv + uvOffset.xy);\
					vec4 c2 = texture2D( maskTexture, vUv - uvOffset.xy);\
					vec4 c3 = texture2D( maskTexture, vUv + uvOffset.yw);\
					vec4 c4 = texture2D( maskTexture, vUv - uvOffset.yw);\
					float diff1 = (c1.r - c2.r)*0.5;\
					float diff2 = (c3.r - c4.r)*0.5;\
					float d = length( vec2(diff1, diff2) );\
					float a1 = min(c1.g, c2.g);\
					float a2 = min(c3.g, c4.g);\
					float visibilityFactor = min(a1, a2);\
					vec3 edgeColor = 1.0 - visibilityFactor > 0.001 ? visibleEdgeColor : hiddenEdgeColor;\
					gl_FragColor = vec4(edgeColor, 1.0) * vec4(d);\
				}"});},getSeperableBlurMaterial:function getSeperableBlurMaterial(maxRadius){return new ShaderMaterial({defines:{"MAX_RADIUS":maxRadius},uniforms:{"colorTexture":{value:null},"texSize":{value:new Vector2$1(0.5,0.5)},"direction":{value:new Vector2$1(0.5,0.5)},"kernelRadius":{value:1.0}},vertexShader:"varying vec2 vUv;\n\
				void main() {\n\
					vUv = uv;\n\
					gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n\
				}",fragmentShader:"#include <common>\
				varying vec2 vUv;\
				uniform sampler2D colorTexture;\
				uniform vec2 texSize;\
				uniform vec2 direction;\
				uniform float kernelRadius;\
				\
				float gaussianPdf(in float x, in float sigma) {\
					return 0.39894 * exp( -0.5 * x * x/( sigma * sigma))/sigma;\
				}\
				void main() {\
					vec2 invSize = 1.0 / texSize;\
					float weightSum = gaussianPdf(0.0, kernelRadius);\
					vec3 diffuseSum = texture2D( colorTexture, vUv).rgb * weightSum;\
					vec2 delta = direction * invSize * kernelRadius/float(MAX_RADIUS);\
					vec2 uvOffset = delta;\
					for( int i = 1; i <= MAX_RADIUS; i ++ ) {\
						float w = gaussianPdf(uvOffset.x, kernelRadius);\
						vec3 sample1 = texture2D( colorTexture, vUv + uvOffset).rgb;\
						vec3 sample2 = texture2D( colorTexture, vUv - uvOffset).rgb;\
						diffuseSum += ((sample1 + sample2) * w);\
						weightSum += (2.0 * w);\
						uvOffset += delta;\
					}\
					gl_FragColor = vec4(diffuseSum/weightSum, 1.0);\
				}"});},getOverlayMaterial:function getOverlayMaterial(){return new ShaderMaterial({uniforms:{"maskTexture":{value:null},"edgeTexture1":{value:null},"edgeTexture2":{value:null},"patternTexture":{value:null},"edgeStrength":{value:1.0},"edgeGlow":{value:1.0},"usePatternTexture":{value:0.0}},vertexShader:"varying vec2 vUv;\n\
				void main() {\n\
					vUv = uv;\n\
					gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n\
				}",fragmentShader:"varying vec2 vUv;\
				uniform sampler2D maskTexture;\
				uniform sampler2D edgeTexture1;\
				uniform sampler2D edgeTexture2;\
				uniform sampler2D patternTexture;\
				uniform float edgeStrength;\
				uniform float edgeGlow;\
				uniform bool usePatternTexture;\
				\
				void main() {\
					vec4 edgeValue1 = texture2D(edgeTexture1, vUv);\
					vec4 edgeValue2 = texture2D(edgeTexture2, vUv);\
					vec4 maskColor = texture2D(maskTexture, vUv);\
					vec4 patternColor = texture2D(patternTexture, 6.0 * vUv);\
					float visibilityFactor = 1.0 - maskColor.g > 0.0 ? 1.0 : 0.5;\
					vec4 edgeValue = edgeValue1 + edgeValue2 * edgeGlow;\
					vec4 finalColor = edgeStrength * maskColor.r * edgeValue;\
					if(usePatternTexture)\
						finalColor += + visibilityFactor * (1.0 - maskColor.r) * (1.0 - patternColor.r);\
					gl_FragColor = finalColor;\
				}",blending:AdditiveBlending,depthTest:false,depthWrite:false,transparent:true});}});OutlinePass.BlurDirectionX=new Vector2$1(1.0,0.0);OutlinePass.BlurDirectionY=new Vector2$1(0.0,1.0);/**
   * @author alteredq / http://alteredqualia.com/
   */var RenderPass=function RenderPass(scene,camera,overrideMaterial,clearColor,clearAlpha){Pass.call(this);this.scene=scene;this.camera=camera;this.overrideMaterial=overrideMaterial;this.clearColor=clearColor;this.clearAlpha=clearAlpha!==undefined?clearAlpha:0;this.clear=true;this.clearDepth=false;this.needsSwap=false;};RenderPass.prototype=Object.assign(Object.create(Pass.prototype),{constructor:RenderPass,render:function render(renderer,writeBuffer,readBuffer,delta,maskActive){var oldAutoClear=renderer.autoClear;renderer.autoClear=false;this.scene.overrideMaterial=this.overrideMaterial;var oldClearColor,oldClearAlpha;if(this.clearColor){oldClearColor=renderer.getClearColor().getHex();oldClearAlpha=renderer.getClearAlpha();renderer.setClearColor(this.clearColor,this.clearAlpha);}if(this.clearDepth){renderer.clearDepth();}renderer.render(this.scene,this.camera,this.renderToScreen?null:readBuffer,this.clear);if(this.clearColor){renderer.setClearColor(oldClearColor,oldClearAlpha);}this.scene.overrideMaterial=null;renderer.autoClear=oldAutoClear;}});/**
   * @author Matt DesLauriers / @mattdesl
   * @author atix / arthursilber.de
   */function DepthTexture(width,height,type,mapping,wrapS,wrapT,magFilter,minFilter,anisotropy,format){format=format!==undefined?format:DepthFormat;if(format!==DepthFormat&&format!==DepthStencilFormat){throw new Error('DepthTexture format must be either THREE.DepthFormat or THREE.DepthStencilFormat');}if(type===undefined&&format===DepthFormat){type=UnsignedShortType;}if(type===undefined&&format===DepthStencilFormat){type=UnsignedInt248Type;}Texture$1.call(this,null,mapping,wrapS,wrapT,magFilter,minFilter,format,type,anisotropy);this.image={width:width,height:height};this.magFilter=magFilter!==undefined?magFilter:NearestFilter;this.minFilter=minFilter!==undefined?minFilter:NearestFilter;this.flipY=false;this.generateMipmaps=false;}DepthTexture.prototype=Object.create(Texture$1.prototype);DepthTexture.prototype.constructor=DepthTexture;DepthTexture.prototype.isDepthTexture=true;var SAOShader={defines:{'NUM_SAMPLES':7,'NUM_RINGS':4,'NORMAL_TEXTURE':0,'DIFFUSE_TEXTURE':0,'DEPTH_PACKING':1,'PERSPECTIVE_CAMERA':1},uniforms:{'tDepth':{type:'t',value:null},'tDiffuse':{type:'t',value:null},'tNormal':{type:'t',value:null},'size':{type:'v2',value:new Vector2$1(512,512)},'cameraNear':{type:'f',value:1},'cameraFar':{type:'f',value:100},'cameraProjectionMatrix':{type:'m4',value:new Matrix4()},'cameraInverseProjectionMatrix':{type:'m4',value:new Matrix4()},'scale':{type:'f',value:1.0},'intensity':{type:'f',value:0.1},'bias':{type:'f',value:0.5},'minResolution':{type:'f',value:0.0},'kernelRadius':{type:'f',value:100.0},'randomSeed':{type:'f',value:0.0}},vertexShader:["varying vec2 vUv;","void main() {","	vUv = uv;","	gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),fragmentShader:["#include <common>","varying vec2 vUv;","#if DIFFUSE_TEXTURE == 1","uniform sampler2D tDiffuse;","#endif","uniform sampler2D tDepth;","#if NORMAL_TEXTURE == 1","uniform sampler2D tNormal;","#endif","uniform float cameraNear;","uniform float cameraFar;","uniform mat4 cameraProjectionMatrix;","uniform mat4 cameraInverseProjectionMatrix;","uniform float scale;","uniform float intensity;","uniform float bias;","uniform float kernelRadius;","uniform float minResolution;","uniform vec2 size;","uniform float randomSeed;","// RGBA depth","#include <packing>","vec4 getDefaultColor( const in vec2 screenPosition ) {","	#if DIFFUSE_TEXTURE == 1","	return texture2D( tDiffuse, vUv );","	#else","	return vec4( 1.0 );","	#endif","}","float getDepth( const in vec2 screenPosition ) {","	#if DEPTH_PACKING == 1","	return unpackRGBAToDepth( texture2D( tDepth, screenPosition ) );","	#else","	return texture2D( tDepth, screenPosition ).x;","	#endif","}","float getViewZ( const in float depth ) {","	#if PERSPECTIVE_CAMERA == 1","	return perspectiveDepthToViewZ( depth, cameraNear, cameraFar );","	#else","	return orthoDepthToViewZ( depth, cameraNear, cameraFar );","	#endif","}","vec3 getViewPosition( const in vec2 screenPosition, const in float depth, const in float viewZ ) {","	float clipW = cameraProjectionMatrix[2][3] * viewZ + cameraProjectionMatrix[3][3];","	vec4 clipPosition = vec4( ( vec3( screenPosition, depth ) - 0.5 ) * 2.0, 1.0 );","	clipPosition *= clipW; // unprojection.","	return ( cameraInverseProjectionMatrix * clipPosition ).xyz;","}","vec3 getViewNormal( const in vec3 viewPosition, const in vec2 screenPosition ) {","	#if NORMAL_TEXTURE == 1","	return unpackRGBToNormal( texture2D( tNormal, screenPosition ).xyz );","	#else","	return normalize( cross( dFdx( viewPosition ), dFdy( viewPosition ) ) );","	#endif","}","float scaleDividedByCameraFar;","float minResolutionMultipliedByCameraFar;","float getOcclusion( const in vec3 centerViewPosition, const in vec3 centerViewNormal, const in vec3 sampleViewPosition ) {","	vec3 viewDelta = sampleViewPosition - centerViewPosition;","	float viewDistance = length( viewDelta );","	float scaledScreenDistance = scaleDividedByCameraFar * viewDistance;","	return max(0.0, (dot(centerViewNormal, viewDelta) - minResolutionMultipliedByCameraFar) / scaledScreenDistance - bias) / (1.0 + pow2( scaledScreenDistance ) );","}","// moving costly divides into consts","const float ANGLE_STEP = PI2 * float( NUM_RINGS ) / float( NUM_SAMPLES );","const float INV_NUM_SAMPLES = 1.0 / float( NUM_SAMPLES );","float getAmbientOcclusion( const in vec3 centerViewPosition ) {","	// precompute some variables require in getOcclusion.","	scaleDividedByCameraFar = scale / cameraFar;","	minResolutionMultipliedByCameraFar = minResolution * cameraFar;","	vec3 centerViewNormal = getViewNormal( centerViewPosition, vUv );","	// jsfiddle that shows sample pattern: https://jsfiddle.net/a16ff1p7/","	float angle = rand( vUv + randomSeed ) * PI2;","	vec2 radius = vec2( kernelRadius * INV_NUM_SAMPLES ) / size;","	vec2 radiusStep = radius;","	float occlusionSum = 0.0;","	float weightSum = 0.0;","	for( int i = 0; i < NUM_SAMPLES; i ++ ) {","		vec2 sampleUv = vUv + vec2( cos( angle ), sin( angle ) ) * radius;","		radius += radiusStep;","		angle += ANGLE_STEP;","		float sampleDepth = getDepth( sampleUv );","		if( sampleDepth >= ( 1.0 - EPSILON ) ) {","			continue;","		}","		float sampleViewZ = getViewZ( sampleDepth );","		vec3 sampleViewPosition = getViewPosition( sampleUv, sampleDepth, sampleViewZ );","		occlusionSum += getOcclusion( centerViewPosition, centerViewNormal, sampleViewPosition );","		weightSum += 1.0;","	}","	if( weightSum == 0.0 ) discard;","	return occlusionSum * ( intensity / weightSum );","}","void main() {","	float centerDepth = getDepth( vUv );","	if( centerDepth >= ( 1.0 - EPSILON ) ) {","		discard;","	}","	float centerViewZ = getViewZ( centerDepth );","	vec3 viewPosition = getViewPosition( vUv, centerDepth, centerViewZ );","	float ambientOcclusion = getAmbientOcclusion( viewPosition );","	gl_FragColor = getDefaultColor( vUv );","	gl_FragColor.xyz *=  1.0 - ambientOcclusion;","}"].join("\n")};var DepthLimitedBlurShader={defines:{'KERNEL_RADIUS':4,'DEPTH_PACKING':1,'PERSPECTIVE_CAMERA':1},uniforms:{'tDiffuse':{type:'t',value:null},'size':{type:'v2',value:new Vector2$1(512,512)},'sampleUvOffsets':{type:'v2v',value:[new Vector2$1(0,0)]},'sampleWeights':{type:'1fv',value:[1.0]},'tDepth':{type:'t',value:null},'cameraNear':{type:'f',value:10},'cameraFar':{type:'f',value:1000},'depthCutoff':{type:'f',value:10}},vertexShader:["#include <common>","uniform vec2 size;","varying vec2 vUv;","varying vec2 vInvSize;","void main() {","	vUv = uv;","	vInvSize = 1.0 / size;","	gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),fragmentShader:["#include <common>","#include <packing>","uniform sampler2D tDiffuse;","uniform sampler2D tDepth;","uniform float cameraNear;","uniform float cameraFar;","uniform float depthCutoff;","uniform vec2 sampleUvOffsets[ KERNEL_RADIUS + 1 ];","uniform float sampleWeights[ KERNEL_RADIUS + 1 ];","varying vec2 vUv;","varying vec2 vInvSize;","float getDepth( const in vec2 screenPosition ) {","	#if DEPTH_PACKING == 1","	return unpackRGBAToDepth( texture2D( tDepth, screenPosition ) );","	#else","	return texture2D( tDepth, screenPosition ).x;","	#endif","}","float getViewZ( const in float depth ) {","	#if PERSPECTIVE_CAMERA == 1","	return perspectiveDepthToViewZ( depth, cameraNear, cameraFar );","	#else","	return orthoDepthToViewZ( depth, cameraNear, cameraFar );","	#endif","}","void main() {","	float depth = getDepth( vUv );","	if( depth >= ( 1.0 - EPSILON ) ) {","		discard;","	}","	float centerViewZ = -getViewZ( depth );","	bool rBreak = false, lBreak = false;","	float weightSum = sampleWeights[0];","	vec4 diffuseSum = texture2D( tDiffuse, vUv ) * weightSum;","	for( int i = 1; i <= KERNEL_RADIUS; i ++ ) {","		float sampleWeight = sampleWeights[i];","		vec2 sampleUvOffset = sampleUvOffsets[i] * vInvSize;","		vec2 sampleUv = vUv + sampleUvOffset;","		float viewZ = -getViewZ( getDepth( sampleUv ) );","		if( abs( viewZ - centerViewZ ) > depthCutoff ) rBreak = true;","		if( ! rBreak ) {","			diffuseSum += texture2D( tDiffuse, sampleUv ) * sampleWeight;","			weightSum += sampleWeight;","		}","		sampleUv = vUv - sampleUvOffset;","		viewZ = -getViewZ( getDepth( sampleUv ) );","		if( abs( viewZ - centerViewZ ) > depthCutoff ) lBreak = true;","		if( ! lBreak ) {","			diffuseSum += texture2D( tDiffuse, sampleUv ) * sampleWeight;","			weightSum += sampleWeight;","		}","	}","	gl_FragColor = diffuseSum / weightSum;","}"].join("\n")};var BlurShaderUtils={createSampleWeights:function createSampleWeights(kernelRadius,stdDev){var gaussian=function gaussian(x,stdDev){return Math.exp(-(x*x)/(2.0*(stdDev*stdDev)))/(Math.sqrt(2.0*Math.PI)*stdDev);};var weights=[];for(var i=0;i<=kernelRadius;i++){weights.push(gaussian(i,stdDev));}return weights;},createSampleOffsets:function createSampleOffsets(kernelRadius,uvIncrement){var offsets=[];for(var i=0;i<=kernelRadius;i++){offsets.push(uvIncrement.clone().multiplyScalar(i));}return offsets;},configure:function configure(material,kernelRadius,stdDev,uvIncrement){material.defines['KERNEL_RADIUS']=kernelRadius;material.uniforms['sampleUvOffsets'].value=BlurShaderUtils.createSampleOffsets(kernelRadius,uvIncrement);material.uniforms['sampleWeights'].value=BlurShaderUtils.createSampleWeights(kernelRadius,stdDev);material.needsUpdate=true;}};/**
   * @author alteredq / http://alteredqualia.com/
   *
   * Unpack RGBA depth shader
   * - show RGBA encoded depth as monochrome color
   */var UnpackDepthRGBAShader={uniforms:{"tDiffuse":{value:null},"opacity":{value:1.0}},vertexShader:["varying vec2 vUv;","void main() {","vUv = uv;","gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),fragmentShader:["uniform float opacity;","uniform sampler2D tDiffuse;","varying vec2 vUv;","#include <packing>","void main() {","float depth = 1.0 - unpackRGBAToDepth( texture2D( tDiffuse, vUv ) );","gl_FragColor = opacity * vec4( vec3( depth ), 1.0 );","}"].join("\n")};/**
   * @author ludobaka / ludobaka.github.io
   * SAO implementation inspired from bhouston previous SAO work
   */var SAOPass=function SAOPass(scene,camera,depthTexture,useNormals,resolution){Pass.call(this);this.scene=scene;this.camera=camera;this.clear=true;this.needsSwap=false;this.supportsDepthTextureExtension=depthTexture!==undefined?depthTexture:false;this.supportsNormalTexture=useNormals!==undefined?useNormals:false;this.oldClearColor=new Color$1();this.oldClearAlpha=1;this.params={output:0,saoBias:0.5,saoIntensity:0.18,saoScale:1,saoKernelRadius:100,saoMinResolution:0,saoBlur:true,saoBlurRadius:8,saoBlurStdDev:4,saoBlurDepthCutoff:0.01};this.resolution=resolution!==undefined?new Vector2$1(resolution.x,resolution.y):new Vector2$1(256,256);this.saoRenderTarget=new WebGLRenderTarget(this.resolution.x,this.resolution.y,{minFilter:LinearFilter,magFilter:LinearFilter,format:RGBAFormat});this.blurIntermediateRenderTarget=this.saoRenderTarget.clone();this.beautyRenderTarget=this.saoRenderTarget.clone();this.normalRenderTarget=new WebGLRenderTarget(this.resolution.x,this.resolution.y,{minFilter:NearestFilter,magFilter:NearestFilter,format:RGBAFormat});this.depthRenderTarget=this.normalRenderTarget.clone();if(this.supportsDepthTextureExtension){var depthTexture=new DepthTexture();depthTexture.type=UnsignedShortType;depthTexture.minFilter=NearestFilter;depthTexture.maxFilter=NearestFilter;this.beautyRenderTarget.depthTexture=depthTexture;this.beautyRenderTarget.depthBuffer=true;}this.depthMaterial=new MeshDepthMaterial();this.depthMaterial.depthPacking=RGBADepthPacking;this.depthMaterial.blending=NoBlending;this.normalMaterial=new MeshNormalMaterial();this.normalMaterial.blending=NoBlending;if(SAOShader===undefined){console.error('SAOPass relies on SAOShader');}this.saoMaterial=new ShaderMaterial(SAOShader);this.saoMaterial.extensions.derivatives=true;this.saoMaterial.extensions.drawBuffers=true;this.saoMaterial.defines['DEPTH_PACKING']=this.supportsDepthTextureExtension?0:1;this.saoMaterial.defines['NORMAL_TEXTURE']=this.supportsNormalTexture?1:0;this.saoMaterial.uniforms['tDepth'].value=this.supportsDepthTextureExtension?depthTexture:this.depthRenderTarget.texture;this.saoMaterial.uniforms['tNormal'].value=this.normalRenderTarget.texture;this.saoMaterial.uniforms['size'].value.set(this.resolution.x,this.resolution.y);this.saoMaterial.uniforms['cameraNear'].value=this.camera.near;this.saoMaterial.uniforms['cameraFar'].value=this.camera.far;this.saoMaterial.uniforms['cameraInverseProjectionMatrix'].value.getInverse(this.camera.projectionMatrix);this.saoMaterial.uniforms['cameraProjectionMatrix'].value=this.camera.projectionMatrix;this.saoMaterial.blending=NoBlending;if(DepthLimitedBlurShader===undefined){console.error('SAOPass relies on DepthLimitedBlurShader');}this.vBlurMaterial=new ShaderMaterial({uniforms:UniformsUtils.clone(DepthLimitedBlurShader.uniforms),defines:DepthLimitedBlurShader.defines,vertexShader:DepthLimitedBlurShader.vertexShader,fragmentShader:DepthLimitedBlurShader.fragmentShader});this.vBlurMaterial.defines['DEPTH_PACKING']=this.supportsDepthTextureExtension?0:1;this.vBlurMaterial.uniforms['tDiffuse'].value=this.saoRenderTarget.texture;this.vBlurMaterial.uniforms['tDepth'].value=this.supportsDepthTextureExtension?depthTexture:this.depthRenderTarget.texture;this.vBlurMaterial.uniforms['cameraNear'].value=this.camera.near;this.vBlurMaterial.uniforms['cameraFar'].value=this.camera.far;this.vBlurMaterial.uniforms['size'].value.set(this.resolution.x,this.resolution.y);this.vBlurMaterial.blending=NoBlending;this.hBlurMaterial=new ShaderMaterial({uniforms:UniformsUtils.clone(DepthLimitedBlurShader.uniforms),defines:DepthLimitedBlurShader.defines,vertexShader:DepthLimitedBlurShader.vertexShader,fragmentShader:DepthLimitedBlurShader.fragmentShader});this.hBlurMaterial.defines['DEPTH_PACKING']=this.supportsDepthTextureExtension?0:1;this.hBlurMaterial.uniforms['tDiffuse'].value=this.blurIntermediateRenderTarget.texture;this.hBlurMaterial.uniforms['tDepth'].value=this.supportsDepthTextureExtension?depthTexture:this.depthRenderTarget.texture;this.hBlurMaterial.uniforms['cameraNear'].value=this.camera.near;this.hBlurMaterial.uniforms['cameraFar'].value=this.camera.far;this.hBlurMaterial.uniforms['size'].value.set(this.resolution.x,this.resolution.y);this.hBlurMaterial.blending=NoBlending;if(CopyShader===undefined){console.error('SAOPass relies on CopyShader');}this.materialCopy=new ShaderMaterial({uniforms:UniformsUtils.clone(CopyShader.uniforms),vertexShader:CopyShader.vertexShader,fragmentShader:CopyShader.fragmentShader,blending:NoBlending});this.materialCopy.transparent=true;this.materialCopy.depthTest=false;this.materialCopy.depthWrite=false;this.materialCopy.blending=CustomBlending;this.materialCopy.blendSrc=DstColorFactor;this.materialCopy.blendDst=ZeroFactor;this.materialCopy.blendEquation=AddEquation;this.materialCopy.blendSrcAlpha=DstAlphaFactor;this.materialCopy.blendDstAlpha=ZeroFactor;this.materialCopy.blendEquationAlpha=AddEquation;if(CopyShader===undefined){console.error('SAOPass relies on UnpackDepthRGBAShader');}this.depthCopy=new ShaderMaterial({uniforms:UniformsUtils.clone(UnpackDepthRGBAShader.uniforms),vertexShader:UnpackDepthRGBAShader.vertexShader,fragmentShader:UnpackDepthRGBAShader.fragmentShader,blending:NoBlending});this.quadCamera=new OrthographicCamera(-1,1,1,-1,0,1);this.quadScene=new Scene();this.quad=new Mesh(new PlaneGeometry(2,2),null);this.quadScene.add(this.quad);};SAOPass.OUTPUT={'Beauty':1,'Default':0,'SAO':2,'Depth':3,'Normal':4};SAOPass.prototype=Object.assign(Object.create(Pass.prototype),{constructor:SAOPass,render:function render(renderer,writeBuffer,readBuffer,delta,maskActive){// Rendering readBuffer first when rendering to screen
  if(this.renderToScreen){this.materialCopy.blending=NoBlending;this.materialCopy.uniforms['tDiffuse'].value=readBuffer.texture;this.materialCopy.needsUpdate=true;this.renderPass(renderer,this.materialCopy,null);}if(this.params.output==1){return;}this.oldClearColor.copy(renderer.getClearColor());this.oldClearAlpha=renderer.getClearAlpha();var oldAutoClear=renderer.autoClear;renderer.autoClear=false;renderer.clearTarget(this.depthRenderTarget);this.saoMaterial.uniforms['bias'].value=this.params.saoBias;this.saoMaterial.uniforms['intensity'].value=this.params.saoIntensity;this.saoMaterial.uniforms['scale'].value=this.params.saoScale;this.saoMaterial.uniforms['kernelRadius'].value=this.params.saoKernelRadius;this.saoMaterial.uniforms['minResolution'].value=this.params.saoMinResolution;// this.saoMaterial.uniforms['randomSeed'].value = Math.random();
  var depthCutoff=this.params.saoBlurDepthCutoff*(this.camera.far-this.camera.near);this.vBlurMaterial.uniforms['depthCutoff'].value=depthCutoff;this.hBlurMaterial.uniforms['depthCutoff'].value=depthCutoff;this.params.saoBlurRadius=Math.floor(this.params.saoBlurRadius);if(this.prevStdDev!==this.params.saoBlurStdDev||this.prevNumSamples!==this.params.saoBlurRadius){BlurShaderUtils.configure(this.vBlurMaterial,this.params.saoBlurRadius,this.params.saoBlurStdDev,new Vector2$1(0,1));BlurShaderUtils.configure(this.hBlurMaterial,this.params.saoBlurRadius,this.params.saoBlurStdDev,new Vector2$1(1,0));this.prevStdDev=this.params.saoBlurStdDev;this.prevNumSamples=this.params.saoBlurRadius;}// Rendering scene to depth texture
  renderer.setClearColor(0x000000);renderer.render(this.scene,this.camera,this.beautyRenderTarget,true);// Re-render scene if depth texture extension is not supported
  if(!this.supportsDepthTextureExtension){// Clear rule : far clipping plane in both RGBA and Basic encoding
  this.renderOverride(renderer,this.depthMaterial,this.depthRenderTarget,0xffffff,1.0);}if(this.supportsNormalTexture){// Clear rule : default normal is facing the camera
  this.renderOverride(renderer,this.normalMaterial,this.normalRenderTarget,0x7777ff,1.0);}// Rendering SAO texture
  this.renderPass(renderer,this.saoMaterial,this.saoRenderTarget,0xffffff,1.0);// Blurring SAO texture
  if(this.params.saoBlur){this.renderPass(renderer,this.vBlurMaterial,this.blurIntermediateRenderTarget,0xffffff,1.0);this.renderPass(renderer,this.hBlurMaterial,this.saoRenderTarget,0xffffff,1.0);}var outputMaterial=this.materialCopy;// Setting up SAO rendering
  if(this.params.output==3){if(this.supportsDepthTextureExtension){this.materialCopy.uniforms['tDiffuse'].value=this.beautyRenderTarget.depthTexture;this.materialCopy.needsUpdate=true;}else{this.depthCopy.uniforms['tDiffuse'].value=this.depthRenderTarget.texture;this.depthCopy.needsUpdate=true;outputMaterial=this.depthCopy;}}else if(this.params.output==4){this.materialCopy.uniforms['tDiffuse'].value=this.normalRenderTarget.texture;this.materialCopy.needsUpdate=true;}else{this.materialCopy.uniforms['tDiffuse'].value=this.saoRenderTarget.texture;this.materialCopy.needsUpdate=true;}// Blending depends on output, only want a CustomBlending when showing SAO
  if(this.params.output==0){outputMaterial.blending=CustomBlending;}else{outputMaterial.blending=NoBlending;}// Rendering SAOPass result on top of previous pass
  this.renderPass(renderer,outputMaterial,this.renderToScreen?null:readBuffer);renderer.setClearColor(this.oldClearColor,this.oldClearAlpha);renderer.autoClear=oldAutoClear;},renderPass:function renderPass(renderer,passMaterial,renderTarget,clearColor,clearAlpha){// save original state
  var originalClearColor=renderer.getClearColor();var originalClearAlpha=renderer.getClearAlpha();var originalAutoClear=renderer.autoClear;// setup pass state
  renderer.autoClear=false;var clearNeeded=clearColor!==undefined&&clearColor!==null;if(clearNeeded){renderer.setClearColor(clearColor);renderer.setClearAlpha(clearAlpha||0.0);}this.quad.material=passMaterial;renderer.render(this.quadScene,this.quadCamera,renderTarget,clearNeeded);// restore original state
  renderer.autoClear=originalAutoClear;renderer.setClearColor(originalClearColor);renderer.setClearAlpha(originalClearAlpha);},renderOverride:function renderOverride(renderer,overrideMaterial,renderTarget,clearColor,clearAlpha){var originalClearColor=renderer.getClearColor();var originalClearAlpha=renderer.getClearAlpha();var originalAutoClear=renderer.autoClear;renderer.autoClear=false;clearColor=overrideMaterial.clearColor||clearColor;clearAlpha=overrideMaterial.clearAlpha||clearAlpha;var clearNeeded=clearColor!==undefined&&clearColor!==null;if(clearNeeded){renderer.setClearColor(clearColor);renderer.setClearAlpha(clearAlpha||0.0);}this.scene.overrideMaterial=overrideMaterial;renderer.render(this.scene,this.camera,renderTarget,clearNeeded);this.scene.overrideMaterial=null;// restore original state
  renderer.autoClear=originalAutoClear;renderer.setClearColor(originalClearColor);renderer.setClearAlpha(originalClearAlpha);},setSize:function setSize(width,height){this.beautyRenderTarget.setSize(width,height);this.saoRenderTarget.setSize(width,height);this.blurIntermediateRenderTarget.setSize(width,height);this.normalRenderTarget.setSize(width,height);this.depthRenderTarget.setSize(width,height);this.saoMaterial.uniforms['size'].value.set(width,height);this.saoMaterial.uniforms['cameraInverseProjectionMatrix'].value.getInverse(this.camera.projectionMatrix);this.saoMaterial.uniforms['cameraProjectionMatrix'].value=this.camera.projectionMatrix;this.saoMaterial.needsUpdate=true;this.vBlurMaterial.uniforms['size'].value.set(width,height);this.vBlurMaterial.needsUpdate=true;this.hBlurMaterial.uniforms['size'].value.set(width,height);this.hBlurMaterial.needsUpdate=true;}});/**
   * @author alteredq / http://alteredqualia.com/
   */var SavePass=function SavePass(renderTarget){Pass.call(this);if(CopyShader===undefined){console.error("SavePass relies on CopyShader");}var shader=CopyShader;this.textureID="tDiffuse";this.uniforms=UniformsUtils.clone(shader.uniforms);this.material=new ShaderMaterial({uniforms:this.uniforms,vertexShader:shader.vertexShader,fragmentShader:shader.fragmentShader});this.renderTarget=renderTarget;if(this.renderTarget===undefined){this.renderTarget=new WebGLRenderTarget(window.innerWidth,window.innerHeight,{minFilter:LinearFilter,magFilter:LinearFilter,format:RGBFormat,stencilBuffer:false});this.renderTarget.texture.name="SavePass.rt";}this.needsSwap=false;this.camera=new OrthographicCamera(-1,1,1,-1,0,1);this.scene=new Scene();this.quad=new Mesh(new PlaneBufferGeometry(2,2),null);this.quad.frustumCulled=false;// Avoid getting clipped
  this.scene.add(this.quad);};SavePass.prototype=Object.assign(Object.create(Pass.prototype),{constructor:SavePass,render:function render(renderer,writeBuffer,readBuffer){if(this.uniforms[this.textureID]){this.uniforms[this.textureID].value=readBuffer.texture;}this.quad.material=this.material;renderer.render(this.scene,this.camera,this.renderTarget,this.clear);}});/**
   * @author mpk / http://polko.me/
   *
   * WebGL port of Subpixel Morphological Antialiasing (SMAA) v2.8
   * Preset: SMAA 1x Medium (with color edge detection)
   * https://github.com/iryoku/smaa/releases/tag/v2.8
   */var SMAAShader=[{defines:{"SMAA_THRESHOLD":"0.1"},uniforms:{"tDiffuse":{value:null},"resolution":{value:new Vector2$1(1/1024,1/512)}},vertexShader:["uniform vec2 resolution;","varying vec2 vUv;","varying vec4 vOffset[ 3 ];","void SMAAEdgeDetectionVS( vec2 texcoord ) {","vOffset[ 0 ] = texcoord.xyxy + resolution.xyxy * vec4( -1.0, 0.0, 0.0,  1.0 );",// WebGL port note: Changed sign in W component
  "vOffset[ 1 ] = texcoord.xyxy + resolution.xyxy * vec4(  1.0, 0.0, 0.0, -1.0 );",// WebGL port note: Changed sign in W component
  "vOffset[ 2 ] = texcoord.xyxy + resolution.xyxy * vec4( -2.0, 0.0, 0.0,  2.0 );",// WebGL port note: Changed sign in W component
  "}","void main() {","vUv = uv;","SMAAEdgeDetectionVS( vUv );","gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),fragmentShader:["uniform sampler2D tDiffuse;","varying vec2 vUv;","varying vec4 vOffset[ 3 ];","vec4 SMAAColorEdgeDetectionPS( vec2 texcoord, vec4 offset[3], sampler2D colorTex ) {","vec2 threshold = vec2( SMAA_THRESHOLD, SMAA_THRESHOLD );",// Calculate color deltas:
  "vec4 delta;","vec3 C = texture2D( colorTex, texcoord ).rgb;","vec3 Cleft = texture2D( colorTex, offset[0].xy ).rgb;","vec3 t = abs( C - Cleft );","delta.x = max( max( t.r, t.g ), t.b );","vec3 Ctop = texture2D( colorTex, offset[0].zw ).rgb;","t = abs( C - Ctop );","delta.y = max( max( t.r, t.g ), t.b );",// We do the usual threshold:
  "vec2 edges = step( threshold, delta.xy );",// Then discard if there is no edge:
  "if ( dot( edges, vec2( 1.0, 1.0 ) ) == 0.0 )","discard;",// Calculate right and bottom deltas:
  "vec3 Cright = texture2D( colorTex, offset[1].xy ).rgb;","t = abs( C - Cright );","delta.z = max( max( t.r, t.g ), t.b );","vec3 Cbottom  = texture2D( colorTex, offset[1].zw ).rgb;","t = abs( C - Cbottom );","delta.w = max( max( t.r, t.g ), t.b );",// Calculate the maximum delta in the direct neighborhood:
  "float maxDelta = max( max( max( delta.x, delta.y ), delta.z ), delta.w );",// Calculate left-left and top-top deltas:
  "vec3 Cleftleft  = texture2D( colorTex, offset[2].xy ).rgb;","t = abs( C - Cleftleft );","delta.z = max( max( t.r, t.g ), t.b );","vec3 Ctoptop = texture2D( colorTex, offset[2].zw ).rgb;","t = abs( C - Ctoptop );","delta.w = max( max( t.r, t.g ), t.b );",// Calculate the final maximum delta:
  "maxDelta = max( max( maxDelta, delta.z ), delta.w );",// Local contrast adaptation in action:
  "edges.xy *= step( 0.5 * maxDelta, delta.xy );","return vec4( edges, 0.0, 0.0 );","}","void main() {","gl_FragColor = SMAAColorEdgeDetectionPS( vUv, vOffset, tDiffuse );","}"].join("\n")},{defines:{"SMAA_MAX_SEARCH_STEPS":"8","SMAA_AREATEX_MAX_DISTANCE":"16","SMAA_AREATEX_PIXEL_SIZE":"( 1.0 / vec2( 160.0, 560.0 ) )","SMAA_AREATEX_SUBTEX_SIZE":"( 1.0 / 7.0 )"},uniforms:{"tDiffuse":{value:null},"tArea":{value:null},"tSearch":{value:null},"resolution":{value:new Vector2$1(1/1024,1/512)}},vertexShader:["uniform vec2 resolution;","varying vec2 vUv;","varying vec4 vOffset[ 3 ];","varying vec2 vPixcoord;","void SMAABlendingWeightCalculationVS( vec2 texcoord ) {","vPixcoord = texcoord / resolution;",// We will use these offsets for the searches later on (see @PSEUDO_GATHER4):
  "vOffset[ 0 ] = texcoord.xyxy + resolution.xyxy * vec4( -0.25, 0.125, 1.25, 0.125 );",// WebGL port note: Changed sign in Y and W components
  "vOffset[ 1 ] = texcoord.xyxy + resolution.xyxy * vec4( -0.125, 0.25, -0.125, -1.25 );",// WebGL port note: Changed sign in Y and W components
  // And these for the searches, they indicate the ends of the loops:
  "vOffset[ 2 ] = vec4( vOffset[ 0 ].xz, vOffset[ 1 ].yw ) + vec4( -2.0, 2.0, -2.0, 2.0 ) * resolution.xxyy * float( SMAA_MAX_SEARCH_STEPS );","}","void main() {","vUv = uv;","SMAABlendingWeightCalculationVS( vUv );","gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),fragmentShader:["#define SMAASampleLevelZeroOffset( tex, coord, offset ) texture2D( tex, coord + float( offset ) * resolution, 0.0 )","uniform sampler2D tDiffuse;","uniform sampler2D tArea;","uniform sampler2D tSearch;","uniform vec2 resolution;","varying vec2 vUv;","varying vec4 vOffset[3];","varying vec2 vPixcoord;","vec2 round( vec2 x ) {","return sign( x ) * floor( abs( x ) + 0.5 );","}","float SMAASearchLength( sampler2D searchTex, vec2 e, float bias, float scale ) {",// Not required if searchTex accesses are set to point:
  // float2 SEARCH_TEX_PIXEL_SIZE = 1.0 / float2(66.0, 33.0);
  // e = float2(bias, 0.0) + 0.5 * SEARCH_TEX_PIXEL_SIZE +
  //     e * float2(scale, 1.0) * float2(64.0, 32.0) * SEARCH_TEX_PIXEL_SIZE;
  "e.r = bias + e.r * scale;","return 255.0 * texture2D( searchTex, e, 0.0 ).r;","}","float SMAASearchXLeft( sampler2D edgesTex, sampler2D searchTex, vec2 texcoord, float end ) {",/**
  			* @PSEUDO_GATHER4
  			* This texcoord has been offset by (-0.25, -0.125) in the vertex shader to
  			* sample between edge, thus fetching four edges in a row.
  			* Sampling with different offsets in each direction allows to disambiguate
  			* which edges are active from the four fetched ones.
  			*/"vec2 e = vec2( 0.0, 1.0 );","for ( int i = 0; i < SMAA_MAX_SEARCH_STEPS; i ++ ) {",// WebGL port note: Changed while to for
  "e = texture2D( edgesTex, texcoord, 0.0 ).rg;","texcoord -= vec2( 2.0, 0.0 ) * resolution;","if ( ! ( texcoord.x > end && e.g > 0.8281 && e.r == 0.0 ) ) break;","}",// We correct the previous (-0.25, -0.125) offset we applied:
  "texcoord.x += 0.25 * resolution.x;",// The searches are bias by 1, so adjust the coords accordingly:
  "texcoord.x += resolution.x;",// Disambiguate the length added by the last step:
  "texcoord.x += 2.0 * resolution.x;",// Undo last step
  "texcoord.x -= resolution.x * SMAASearchLength(searchTex, e, 0.0, 0.5);","return texcoord.x;","}","float SMAASearchXRight( sampler2D edgesTex, sampler2D searchTex, vec2 texcoord, float end ) {","vec2 e = vec2( 0.0, 1.0 );","for ( int i = 0; i < SMAA_MAX_SEARCH_STEPS; i ++ ) {",// WebGL port note: Changed while to for
  "e = texture2D( edgesTex, texcoord, 0.0 ).rg;","texcoord += vec2( 2.0, 0.0 ) * resolution;","if ( ! ( texcoord.x < end && e.g > 0.8281 && e.r == 0.0 ) ) break;","}","texcoord.x -= 0.25 * resolution.x;","texcoord.x -= resolution.x;","texcoord.x -= 2.0 * resolution.x;","texcoord.x += resolution.x * SMAASearchLength( searchTex, e, 0.5, 0.5 );","return texcoord.x;","}","float SMAASearchYUp( sampler2D edgesTex, sampler2D searchTex, vec2 texcoord, float end ) {","vec2 e = vec2( 1.0, 0.0 );","for ( int i = 0; i < SMAA_MAX_SEARCH_STEPS; i ++ ) {",// WebGL port note: Changed while to for
  "e = texture2D( edgesTex, texcoord, 0.0 ).rg;","texcoord += vec2( 0.0, 2.0 ) * resolution;",// WebGL port note: Changed sign
  "if ( ! ( texcoord.y > end && e.r > 0.8281 && e.g == 0.0 ) ) break;","}","texcoord.y -= 0.25 * resolution.y;",// WebGL port note: Changed sign
  "texcoord.y -= resolution.y;",// WebGL port note: Changed sign
  "texcoord.y -= 2.0 * resolution.y;",// WebGL port note: Changed sign
  "texcoord.y += resolution.y * SMAASearchLength( searchTex, e.gr, 0.0, 0.5 );",// WebGL port note: Changed sign
  "return texcoord.y;","}","float SMAASearchYDown( sampler2D edgesTex, sampler2D searchTex, vec2 texcoord, float end ) {","vec2 e = vec2( 1.0, 0.0 );","for ( int i = 0; i < SMAA_MAX_SEARCH_STEPS; i ++ ) {",// WebGL port note: Changed while to for
  "e = texture2D( edgesTex, texcoord, 0.0 ).rg;","texcoord -= vec2( 0.0, 2.0 ) * resolution;",// WebGL port note: Changed sign
  "if ( ! ( texcoord.y < end && e.r > 0.8281 && e.g == 0.0 ) ) break;","}","texcoord.y += 0.25 * resolution.y;",// WebGL port note: Changed sign
  "texcoord.y += resolution.y;",// WebGL port note: Changed sign
  "texcoord.y += 2.0 * resolution.y;",// WebGL port note: Changed sign
  "texcoord.y -= resolution.y * SMAASearchLength( searchTex, e.gr, 0.5, 0.5 );",// WebGL port note: Changed sign
  "return texcoord.y;","}","vec2 SMAAArea( sampler2D areaTex, vec2 dist, float e1, float e2, float offset ) {",// Rounding prevents precision errors of bilinear filtering:
  "vec2 texcoord = float( SMAA_AREATEX_MAX_DISTANCE ) * round( 4.0 * vec2( e1, e2 ) ) + dist;",// We do a scale and bias for mapping to texel space:
  "texcoord = SMAA_AREATEX_PIXEL_SIZE * texcoord + ( 0.5 * SMAA_AREATEX_PIXEL_SIZE );",// Move to proper place, according to the subpixel offset:
  "texcoord.y += SMAA_AREATEX_SUBTEX_SIZE * offset;","return texture2D( areaTex, texcoord, 0.0 ).rg;","}","vec4 SMAABlendingWeightCalculationPS( vec2 texcoord, vec2 pixcoord, vec4 offset[ 3 ], sampler2D edgesTex, sampler2D areaTex, sampler2D searchTex, ivec4 subsampleIndices ) {","vec4 weights = vec4( 0.0, 0.0, 0.0, 0.0 );","vec2 e = texture2D( edgesTex, texcoord ).rg;","if ( e.g > 0.0 ) {",// Edge at north
  "vec2 d;",// Find the distance to the left:
  "vec2 coords;","coords.x = SMAASearchXLeft( edgesTex, searchTex, offset[ 0 ].xy, offset[ 2 ].x );","coords.y = offset[ 1 ].y;",// offset[1].y = texcoord.y - 0.25 * resolution.y (@CROSSING_OFFSET)
  "d.x = coords.x;",// Now fetch the left crossing edges, two at a time using bilinear
  // filtering. Sampling at -0.25 (see @CROSSING_OFFSET) enables to
  // discern what value each edge has:
  "float e1 = texture2D( edgesTex, coords, 0.0 ).r;",// Find the distance to the right:
  "coords.x = SMAASearchXRight( edgesTex, searchTex, offset[ 0 ].zw, offset[ 2 ].y );","d.y = coords.x;",// We want the distances to be in pixel units (doing this here allow to
  // better interleave arithmetic and memory accesses):
  "d = d / resolution.x - pixcoord.x;",// SMAAArea below needs a sqrt, as the areas texture is compressed
  // quadratically:
  "vec2 sqrt_d = sqrt( abs( d ) );",// Fetch the right crossing edges:
  "coords.y -= 1.0 * resolution.y;",// WebGL port note: Added
  "float e2 = SMAASampleLevelZeroOffset( edgesTex, coords, ivec2( 1, 0 ) ).r;",// Ok, we know how this pattern looks like, now it is time for getting
  // the actual area:
  "weights.rg = SMAAArea( areaTex, sqrt_d, e1, e2, float( subsampleIndices.y ) );","}","if ( e.r > 0.0 ) {",// Edge at west
  "vec2 d;",// Find the distance to the top:
  "vec2 coords;","coords.y = SMAASearchYUp( edgesTex, searchTex, offset[ 1 ].xy, offset[ 2 ].z );","coords.x = offset[ 0 ].x;",// offset[1].x = texcoord.x - 0.25 * resolution.x;
  "d.x = coords.y;",// Fetch the top crossing edges:
  "float e1 = texture2D( edgesTex, coords, 0.0 ).g;",// Find the distance to the bottom:
  "coords.y = SMAASearchYDown( edgesTex, searchTex, offset[ 1 ].zw, offset[ 2 ].w );","d.y = coords.y;",// We want the distances to be in pixel units:
  "d = d / resolution.y - pixcoord.y;",// SMAAArea below needs a sqrt, as the areas texture is compressed
  // quadratically:
  "vec2 sqrt_d = sqrt( abs( d ) );",// Fetch the bottom crossing edges:
  "coords.y -= 1.0 * resolution.y;",// WebGL port note: Added
  "float e2 = SMAASampleLevelZeroOffset( edgesTex, coords, ivec2( 0, 1 ) ).g;",// Get the area for this direction:
  "weights.ba = SMAAArea( areaTex, sqrt_d, e1, e2, float( subsampleIndices.x ) );","}","return weights;","}","void main() {","gl_FragColor = SMAABlendingWeightCalculationPS( vUv, vPixcoord, vOffset, tDiffuse, tArea, tSearch, ivec4( 0.0 ) );","}"].join("\n")},{uniforms:{"tDiffuse":{value:null},"tColor":{value:null},"resolution":{value:new Vector2$1(1/1024,1/512)}},vertexShader:["uniform vec2 resolution;","varying vec2 vUv;","varying vec4 vOffset[ 2 ];","void SMAANeighborhoodBlendingVS( vec2 texcoord ) {","vOffset[ 0 ] = texcoord.xyxy + resolution.xyxy * vec4( -1.0, 0.0, 0.0, 1.0 );",// WebGL port note: Changed sign in W component
  "vOffset[ 1 ] = texcoord.xyxy + resolution.xyxy * vec4( 1.0, 0.0, 0.0, -1.0 );",// WebGL port note: Changed sign in W component
  "}","void main() {","vUv = uv;","SMAANeighborhoodBlendingVS( vUv );","gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),fragmentShader:["uniform sampler2D tDiffuse;","uniform sampler2D tColor;","uniform vec2 resolution;","varying vec2 vUv;","varying vec4 vOffset[ 2 ];","vec4 SMAANeighborhoodBlendingPS( vec2 texcoord, vec4 offset[ 2 ], sampler2D colorTex, sampler2D blendTex ) {",// Fetch the blending weights for current pixel:
  "vec4 a;","a.xz = texture2D( blendTex, texcoord ).xz;","a.y = texture2D( blendTex, offset[ 1 ].zw ).g;","a.w = texture2D( blendTex, offset[ 1 ].xy ).a;",// Is there any blending weight with a value greater than 0.0?
  "if ( dot(a, vec4( 1.0, 1.0, 1.0, 1.0 )) < 1e-5 ) {","return texture2D( colorTex, texcoord, 0.0 );","} else {",// Up to 4 lines can be crossing a pixel (one through each edge). We
  // favor blending by choosing the line with the maximum weight for each
  // direction:
  "vec2 offset;","offset.x = a.a > a.b ? a.a : -a.b;",// left vs. right
  "offset.y = a.g > a.r ? -a.g : a.r;",// top vs. bottom // WebGL port note: Changed signs
  // Then we go in the direction that has the maximum weight:
  "if ( abs( offset.x ) > abs( offset.y )) {",// horizontal vs. vertical
  "offset.y = 0.0;","} else {","offset.x = 0.0;","}",// Fetch the opposite color and lerp by hand:
  "vec4 C = texture2D( colorTex, texcoord, 0.0 );","texcoord += sign( offset ) * resolution;","vec4 Cop = texture2D( colorTex, texcoord, 0.0 );","float s = abs( offset.x ) > abs( offset.y ) ? abs( offset.x ) : abs( offset.y );",// WebGL port note: Added gamma correction
  "C.xyz = pow(C.xyz, vec3(2.2));","Cop.xyz = pow(Cop.xyz, vec3(2.2));","vec4 mixed = mix(C, Cop, s);","mixed.xyz = pow(mixed.xyz, vec3(1.0 / 2.2));","return mixed;","}","}","void main() {","gl_FragColor = SMAANeighborhoodBlendingPS( vUv, vOffset, tColor, tDiffuse );","}"].join("\n")}];/**
   * @author mpk / http://polko.me/
   */var SMAAPass=function SMAAPass(width,height){Pass.call(this);// render targets
  this.edgesRT=new WebGLRenderTarget(width,height,{depthBuffer:false,stencilBuffer:false,generateMipmaps:false,minFilter:LinearFilter,format:RGBFormat});this.edgesRT.texture.name="SMAAPass.edges";this.weightsRT=new WebGLRenderTarget(width,height,{depthBuffer:false,stencilBuffer:false,generateMipmaps:false,minFilter:LinearFilter,format:RGBAFormat});this.weightsRT.texture.name="SMAAPass.weights";// textures
  var areaTextureImage=new Image();areaTextureImage.src=this.getAreaTexture();this.areaTexture=new Texture$1();this.areaTexture.name="SMAAPass.area";this.areaTexture.image=areaTextureImage;this.areaTexture.format=RGBFormat;this.areaTexture.minFilter=LinearFilter;this.areaTexture.generateMipmaps=false;this.areaTexture.needsUpdate=true;this.areaTexture.flipY=false;var searchTextureImage=new Image();searchTextureImage.src=this.getSearchTexture();this.searchTexture=new Texture$1();this.searchTexture.name="SMAAPass.search";this.searchTexture.image=searchTextureImage;this.searchTexture.magFilter=NearestFilter;this.searchTexture.minFilter=NearestFilter;this.searchTexture.generateMipmaps=false;this.searchTexture.needsUpdate=true;this.searchTexture.flipY=false;// materials - pass 1
  if(SMAAShader===undefined){console.error("SMAAPass relies on SMAAShader");}this.uniformsEdges=UniformsUtils.clone(SMAAShader[0].uniforms);this.uniformsEdges["resolution"].value.set(1/width,1/height);this.materialEdges=new ShaderMaterial({defines:SMAAShader[0].defines,uniforms:this.uniformsEdges,vertexShader:SMAAShader[0].vertexShader,fragmentShader:SMAAShader[0].fragmentShader});// materials - pass 2
  this.uniformsWeights=UniformsUtils.clone(SMAAShader[1].uniforms);this.uniformsWeights["resolution"].value.set(1/width,1/height);this.uniformsWeights["tDiffuse"].value=this.edgesRT.texture;this.uniformsWeights["tArea"].value=this.areaTexture;this.uniformsWeights["tSearch"].value=this.searchTexture;this.materialWeights=new ShaderMaterial({defines:SMAAShader[1].defines,uniforms:this.uniformsWeights,vertexShader:SMAAShader[1].vertexShader,fragmentShader:SMAAShader[1].fragmentShader});// materials - pass 3
  this.uniformsBlend=UniformsUtils.clone(SMAAShader[2].uniforms);this.uniformsBlend["resolution"].value.set(1/width,1/height);this.uniformsBlend["tDiffuse"].value=this.weightsRT.texture;this.materialBlend=new ShaderMaterial({uniforms:this.uniformsBlend,vertexShader:SMAAShader[2].vertexShader,fragmentShader:SMAAShader[2].fragmentShader});this.needsSwap=false;this.camera=new OrthographicCamera(-1,1,1,-1,0,1);this.scene=new Scene();this.quad=new Mesh(new PlaneBufferGeometry(2,2),null);this.quad.frustumCulled=false;// Avoid getting clipped
  this.scene.add(this.quad);};SMAAPass.prototype=Object.assign(Object.create(Pass.prototype),{constructor:SMAAPass,render:function render(renderer,writeBuffer,readBuffer,delta,maskActive){// pass 1
  this.uniformsEdges["tDiffuse"].value=readBuffer.texture;this.quad.material=this.materialEdges;renderer.render(this.scene,this.camera,this.edgesRT,this.clear);// pass 2
  this.quad.material=this.materialWeights;renderer.render(this.scene,this.camera,this.weightsRT,this.clear);// pass 3
  this.uniformsBlend["tColor"].value=readBuffer.texture;this.quad.material=this.materialBlend;if(this.renderToScreen){renderer.render(this.scene,this.camera);}else{renderer.render(this.scene,this.camera,writeBuffer,this.clear);}},setSize:function setSize(width,height){this.edgesRT.setSize(width,height);this.weightsRT.setSize(width,height);this.materialEdges.uniforms['resolution'].value.set(1/width,1/height);this.materialWeights.uniforms['resolution'].value.set(1/width,1/height);this.materialBlend.uniforms['resolution'].value.set(1/width,1/height);},getAreaTexture:function getAreaTexture(){return'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAKAAAAIwCAIAAACOVPcQAACBeklEQVR42u39W4xlWXrnh/3WWvuciIzMrKxrV8/0rWbY0+SQFKcb4owIkSIFCjY9AC1BT/LYBozRi+EX+cV+8IMsYAaCwRcBwjzMiw2jAWtgwC8WR5Q8mDFHZLNHTarZGrLJJllt1W2qKrsumZWZcTvn7L3W54e1vrXX3vuciLPPORFR1XE2EomorB0nVuz//r71re/y/1eMvb4Cb3N11xV/PP/2v4UBAwJG/7H8urx6/25/Gf8O5hypMQ0EEEQwAqLfoN/Z+97f/SW+/NvcgQk4sGBJK6H7N4PFVL+K+e0N11yNfkKvwUdwdlUAXPHHL38oa15f/i/46Ih6SuMSPmLAYAwyRKn7dfMGH97jaMFBYCJUgotIC2YAdu+LyW9vvubxAP8kAL8H/koAuOKP3+q6+xGnd5kdYCeECnGIJViwGJMAkQKfDvB3WZxjLKGh8VSCCzhwEWBpMc5/kBbjawT4HnwJfhr+pPBIu7uu+OOTo9vsmtQcniMBGkKFd4jDWMSCRUpLjJYNJkM+IRzQ+PQvIeAMTrBS2LEiaiR9b/5PuT6Ap/AcfAFO4Y3dA3DFH7/VS+M8k4baEAQfMI4QfbVDDGIRg7GKaIY52qAjTAgTvGBAPGIIghOCYAUrGFNgzA7Q3QhgCwfwAnwe5vDejgG44o/fbm1C5ZlYQvQDARPAIQGxCWBM+wWl37ZQESb4gImexGMDouhGLx1Cst0Saa4b4AqO4Hk4gxo+3DHAV/nx27p3JziPM2pVgoiia5MdEzCGULprIN7gEEeQ5IQxEBBBQnxhsDb5auGmAAYcHMA9eAAz8PBol8/xij9+C4Djlim4gJjWcwZBhCBgMIIYxGAVIkH3ZtcBuLdtRFMWsPGoY9rN+HoBji9VBYdwD2ZQg4cnO7OSq/z4rU5KKdwVbFAjNojCQzTlCLPFSxtamwh2jMUcEgg2Wm/6XgErIBhBckQtGN3CzbVacERgCnfgLswhnvqf7QyAq/z4rRZm1YglYE3affGITaZsdIe2FmMIpnOCap25I6jt2kCwCW0D1uAD9sZctNGXcQIHCkINDQgc78aCr+zjtw3BU/ijdpw3zhCwcaONwBvdeS2YZKkJNJsMPf2JKEvC28RXxxI0ASJyzQCjCEQrO4Q7sFArEzjZhaFc4cdv+/JFdKULM4px0DfUBI2hIsy06BqLhGTQEVdbfAIZXYMPesq6VoCHICzUyjwInO4Y411//LYLs6TDa9wvg2CC2rElgAnpTBziThxaL22MYhzfkghz6GAs2VHbbdM91VZu1MEEpupMMwKyVTb5ij9+u4VJG/5EgEMMmFF01cFai3isRbKbzb+YaU/MQbAm2XSMoUPAmvZzbuKYRIFApbtlrfFuUGd6vq2hXNnH78ZLh/iFhsQG3T4D1ib7k5CC6vY0DCbtrohgLEIClXiGtl10zc0CnEGIhhatLBva7NP58Tvw0qE8yWhARLQ8h4+AhQSP+I4F5xoU+VilGRJs6wnS7ruti/4KvAY/CfdgqjsMy4pf8fodQO8/gnuX3f/3xi3om1/h7THr+co3x93PP9+FBUfbNUjcjEmhcrkT+8K7ml7V10Jo05mpIEFy1NmCJWx9SIKKt+EjAL4Ez8EBVOB6havuT/rByPvHXK+9zUcfcbb254+9fydJknYnRr1oGfdaiAgpxu1Rx/Rek8KISftx3L+DfsLWAANn8Hvw0/AFeAGO9DFV3c6D+CcWbL8Dj9e7f+T1k8AZv/d7+PXWM/Z+VvdCrIvuAKO09RpEEQJM0Ci6+B4xhTWr4cZNOvhktabw0ta0rSJmqz3Yw5/AKXwenod7cAhTmBSPKf6JBdvH8IP17h95pXqw50/+BFnj88fev4NchyaK47OPhhtI8RFSvAfDSNh0Ck0p2gLxGkib5NJj/JWCr90EWQJvwBzO4AHcgztwAFN1evHPUVGwfXON+0debT1YeGON9Yy9/63X+OguiwmhIhQhD7l4sMqlG3D86Suc3qWZ4rWjI1X7u0Ytw6x3rIMeIOPDprfe2XzNgyj6PahhBjO4C3e6puDgXrdg+/5l948vF3bqwZetZ+z9Rx9zdIY5pInPK4Nk0t+l52xdK2B45Qd87nM8fsD5EfUhIcJcERw4RdqqH7Yde5V7m1vhNmtedkz6EDzUMF/2jJYWbC+4fzzA/Y+/8PPH3j9dcBAPIRP8JLXd5BpAu03aziOL3VVHZzz3CXWDPWd+SH2AnxIqQoTZpo9Ckc6HIrFbAbzNmlcg8Ag8NFDDAhbJvTBZXbC94P7t68EXfv6o+21gUtPETU7bbkLxvNKRFG2+KXzvtObonPP4rBvsgmaKj404DlshFole1Glfh02fE7bYR7dZ82oTewIBGn1Md6CG6YUF26X376oevOLzx95vhUmgblI6LBZwTCDY7vMq0op5WVXgsObOXJ+1x3qaBl9j1FeLxbhU9w1F+Wiba6s1X/TBz1LnUfuYDi4r2C69f1f14BWfP+p+W2GFKuC9phcELMYRRLur9DEZTUdEH+iEqWdaM7X4WOoPGI+ZYD2+wcQ+y+ioHUZ9dTDbArzxmi/bJI9BND0Ynd6lBdve/butBw8+f/T9D3ABa3AG8W3VPX4hBin+bj8dMMmSpp5pg7fJ6xrBFE2WQQEWnV8Qg3FbAWzYfM1rREEnmvkN2o1+acG2d/9u68GDzx91v3mAjb1zkpqT21OipPKO0b9TO5W0nTdOmAQm0TObts3aBKgwARtoPDiCT0gHgwnbArzxmtcLc08HgF1asN0C4Ms/fvD5I+7PhfqyXE/b7RbbrGyRQRT9ARZcwAUmgdoz0ehJ9Fn7QAhUjhDAQSw0bV3T3WbNa59jzmiP6GsWbGXDX2ytjy8+f9T97fiBPq9YeLdBmyuizZHaqXITnXiMUEEVcJ7K4j3BFPurtB4bixW8wTpweL8DC95szWMOqucFYGsWbGU7p3TxxxefP+r+oTVktxY0v5hbq3KiOKYnY8ddJVSBxuMMVffNbxwIOERShst73HZ78DZrHpmJmH3K6sGz0fe3UUj0eyRrSCGTTc+rjVNoGzNSv05srAxUBh8IhqChiQgVNIIBH3AVPnrsnXQZbLTm8ammv8eVXn/vWpaTem5IXRlt+U/LA21zhSb9cye6jcOfCnOwhIAYXAMVTUNV0QhVha9xjgA27ODJbLbmitt3tRN80lqG6N/khgot4ZVlOyO4WNg3OIMzhIZQpUEHieg2im6F91hB3I2tubql6BYNN9Hj5S7G0G2tahslBWKDnOiIvuAEDzakDQKDNFQT6gbn8E2y4BBubM230YIpBnDbMa+y3dx0n1S0BtuG62lCCXwcY0F72T1VRR3t2ONcsmDjbmzNt9RFs2LO2hQNyb022JisaI8rAWuw4HI3FuAIhZdOGIcdjLJvvObqlpqvWTJnnQbyi/1M9O8UxWhBs//H42I0q1Yb/XPGONzcmm+ri172mHKvZBpHkJaNJz6v9jxqiklDj3U4CA2ugpAaYMWqNXsdXbmJNd9egCnJEsphXNM+MnK3m0FCJ5S1kmJpa3DgPVbnQnPGWIDspW9ozbcO4K/9LkfaQO2KHuqlfFXSbdNzcEcwoqNEFE9zcIXu9/6n/ym/BC/C3aJLzEKPuYVlbFnfhZ8kcWxV3dbv4bKl28566wD+8C53aw49lTABp9PWbsB+knfc/Li3eVizf5vv/xmvnPKg5ihwKEwlrcHqucuVcVOxEv8aH37E3ZqpZypUulrHEtIWKUr+txHg+ojZDGlwnqmkGlzcVi1dLiNSJiHjfbRNOPwKpx9TVdTn3K05DBx4psIk4Ei8aCkJahRgffk4YnEXe07T4H2RR1u27E6wfQsBDofUgjFUFnwC2AiVtA+05J2zpiDK2Oa0c5fmAecN1iJzmpqFZxqYBCYhFTCsUNEmUnIcZ6aEA5rQVhEywG6w7HSW02XfOoBlQmjwulOFQAg66SvJblrTEX1YtJ3uG15T/BH1OfOQeuR8g/c0gdpT5fx2SKbs9EfHTKdM8A1GaJRHLVIwhcGyydZsbifAFVKl5EMKNU2Hryo+06BeTgqnxzYjThVySDikbtJPieco75lYfKAJOMEZBTjoITuWHXXZVhcUDIS2hpiXHV9Ku4u44bN5OYLDOkJo8w+xJSMbhBRHEdEs9JZUCkQrPMAvaHyLkxgkEHxiNkx/x2YB0mGsQ8EUWj/stW5YLhtS5SMu+/YBbNPDCkGTUybN8krRLBGPlZkVOA0j+a1+rkyQKWGaPHPLZOkJhioQYnVZ2hS3zVxMtgC46KuRwbJNd9nV2PHgb36F194ecf/Yeu2vAFe5nm/bRBFrnY4BauE8ERmZRFUn0k8hbftiVYSKMEme2dJCJSCGYAlNqh87bXOPdUkGy24P6d1ll21MBqqx48Fvv8ZHH8HZFY7j/uAq1xMJUFqCSUlJPmNbIiNsmwuMs/q9CMtsZsFO6SprzCS1Z7QL8xCQClEelpjTduDMsmWD8S1PT152BtvmIGvUeDA/yRn83u/x0/4qxoPHjx+PXY9pqX9bgMvh/Nz9kpP4pOe1/fYf3axUiMdHLlPpZCNjgtNFAhcHEDxTumNONhHrBduW+vOyY++70WWnPXj98eA4kOt/mj/5E05l9+O4o8ePx67HFqyC+qSSnyselqjZGaVK2TadbFLPWAQ4NBhHqDCCV7OTpo34AlSSylPtIdd2AJZlyzYQrDJ5lcWGNceD80CunPLGGzsfD+7wRb95NevJI5docQ3tgCyr5bGnyaPRlmwNsFELViOOx9loebGNq2moDOKpHLVP5al2cymWHbkfzGXL7kfRl44H9wZy33tvt+PB/Xnf93e+nh5ZlU18wCiRUa9m7kib9LYuOk+hudQNbxwm0AQqbfloimaB2lM5fChex+ylMwuTbfmXQtmWlenZljbdXTLuOxjI/fDDHY4Hjx8/Hrse0zXfPFxbUN1kKqSCCSk50m0Ajtx3ub9XHBKHXESb8iO6E+qGytF4nO0OG3SXzbJlhxBnKtKyl0NwybjvYCD30aMdjgePHz8eu56SVTBbgxJMliQ3Oauwg0QHxXE2Ez/EIReLdQj42Gzb4CLS0YJD9xUx7bsi0vJi5mUbW1QzL0h0PFk17rtiIPfJk52MB48fPx67npJJwyrBa2RCCQRTbGZSPCxTPOiND4G2pYyOQ4h4jINIJh5wFU1NFZt+IsZ59LSnDqBjZ2awbOku+yInunLcd8VA7rNnOxkPHj9+PGY9B0MWJJNozOJmlglvDMXDEozdhQWbgs/U6oBanGzLrdSNNnZFjOkmbi5bNt1lX7JLLhn3vXAg9/h4y/Hg8ePHI9dzQMEkWCgdRfYykYKnkP7D4rIujsujaKPBsB54vE2TS00ccvFY/Tth7JXeq1hz+qgVy04sAJawTsvOknHfCwdyT062HA8eP348Zj0vdoXF4pilKa2BROed+9fyw9rWRXeTFXESMOanvDZfJuJaSXouQdMdDJZtekZcLLvEeK04d8m474UDuaenW44Hjx8/Xns9YYqZpszGWB3AN/4VHw+k7WSFtJ3Qicuqb/NlVmgXWsxh570xg2UwxUw3WfO6B5nOuO8aA7lnZxuPB48fPx6znm1i4bsfcbaptF3zNT78eFPtwi1OaCNOqp1x3zUGcs/PN++AGD1+fMXrSVm2baTtPhPahbPhA71wIHd2bXzRa69nG+3CraTtPivahV/55tXWg8fyRY/9AdsY8VbSdp8V7cKrrgdfM//z6ILQFtJ2nxHtwmuoB4/kf74+gLeRtvvMaBdeSz34+vifx0YG20jbfTa0C6+tHrwe//NmOG0L8EbSdp8R7cLrrQe/996O+ai3ujQOskpTNULa7jOjXXj99eCd8lHvoFiwsbTdZ0a78PrrwTvlo966pLuRtB2fFe3Cm6oHP9kNH/W2FryxtN1nTLvwRurBO+Kj3pWXHidtx2dFu/Bm68Fb81HvykuPlrb7LGkX3mw9eGs+6h1Y8MbSdjegXcguQLjmevDpTQLMxtJ2N6NdyBZu9AbrwVvwUW+LbteULUpCdqm0HTelXbhNPe8G68Gb8lFvVfYfSNuxvrTdTWoXbozAzdaDZzfkorOj1oxVxlIMlpSIlpLrt8D4hrQL17z+c3h6hU/wv4Q/utps4+bm+6P/hIcf0JwQ5oQGPBL0eKPTYEXTW+eL/2DKn73J9BTXYANG57hz1cEMviVf/4tf5b/6C5pTQkMIWoAq7hTpOJjtAM4pxKu5vg5vXeUrtI09/Mo/5H+4z+Mp5xULh7cEm2QbRP2tFIKR7WM3fPf/jZ3SWCqLM2l4NxID5zB72HQXv3jj/8mLR5xXNA5v8EbFQEz7PpRfl1+MB/hlAN65qgDn3wTgH13hK7T59bmP+NIx1SHHU84nLOITt3iVz8mNO+lPrjGAnBFqmioNn1mTyk1ta47R6d4MrX7tjrnjYUpdUbv2rVr6YpVfsGG58AG8Ah9eyUN8CX4WfgV+G8LVWPDGb+Zd4cU584CtqSbMKxauxTg+dyn/LkVgA+IR8KHtejeFKRtTmLLpxN6mYVLjYxwXf5x2VofiZcp/lwKk4wGOpYDnoIZPdg/AAbwMfx0+ge9dgZvYjuqKe4HnGnykYo5TvJbG0Vj12JagRhwKa44H95ShkZa5RyLGGdfYvG7aw1TsF6iapPAS29mNS3NmsTQZCmgTzFwgL3upCTgtBTRwvGMAKrgLn4evwin8+afJRcff+8izUGUM63GOOuAs3tJkw7J4kyoNreqrpO6cYLQeFUd7TTpr5YOTLc9RUUogUOVJQ1GYJaFLAW0oTmKyYS46ZooP4S4EON3xQ5zC8/CX4CnM4c1PE8ApexpoYuzqlP3d4S3OJP8ZDK7cKWNaTlqmgDiiHwl1YsE41w1zT4iRTm3DBqxvOUsbMKKDa/EHxagtnta072ejc3DOIh5ojvh8l3tk1JF/AV6FU6jh3U8HwEazLgdCLYSQ+MYiAI2ltomkzttUb0gGHdSUUgsIYjTzLG3mObX4FBRaYtpDVNZrih9TgTeYOBxsEnN1gOCTM8Bsw/ieMc75w9kuAT6A+/AiHGvN/+Gn4KRkiuzpNNDYhDGFndWRpE6SVfm8U5bxnSgVV2jrg6JCKmneqey8VMFgq2+AM/i4L4RUbfSi27lNXZ7R7W9RTcq/q9fk4Xw3AMQd4I5ifAZz8FcVtm9SAom/dyN4lczJQW/kC42ZrHgcCoIf1oVMKkVItmMBi9cOeNHGLqOZk+QqQmrbc5YmYgxELUUN35z2iohstgfLIFmcMV7s4CFmI74L9+EFmGsi+tGnAOD4Yk9gIpo01Y4cA43BWGygMdr4YZekG3OBIUXXNukvJS8tqa06e+lSDCtnqqMFu6hWHXCF+WaYt64m9QBmNxi7Ioy7D+fa1yHw+FMAcPt7SysFLtoG4PXAk7JOA3aAxBRqUiAdU9Yp5lK3HLSRFtOim0sa8euEt08xvKjYjzeJ2GU7YawexrnKI9tmobInjFXCewpwriY9+RR4aaezFhMhGCppKwom0ChrgFlKzyPKkGlTW1YQrE9HJqu8hKGgMc6hVi5QRq0PZxNfrYNgE64utmRv6KKHRpxf6VDUaOvNP5jCEx5q185My/7RKz69UQu2im5k4/eownpxZxNLwiZ1AZTO2ZjWjkU9uaB2HFn6Q3u0JcsSx/qV9hTEApRzeBLDJQXxYmTnq7bdLa3+uqFrxLJ5w1TehnNHx5ECvCh2g2c3hHH5YsfdaSKddztfjQ6imKFGSyFwlLzxEGPp6r5IevVjk1AMx3wMqi1NxDVjLBiPs9tbsCkIY5we5/ML22zrCScFxnNtzsr9Wcc3CnD+pYO+4VXXiDE0oc/vQQ/fDK3oPESJMYXNmJa/DuloJZkcTpcYE8lIH8Dz8DJMiynNC86Mb2lNaaqP/+L7f2fcE/yP7/Lde8xfgSOdMxvOixZf/9p3+M4hT1+F+zApxg9XfUvYjc8qX2lfOOpK2gNRtB4flpFu9FTKCp2XJRgXnX6olp1zyYjTKJSkGmLE2NjUr1bxFM4AeAAHBUFIeSLqXR+NvH/M9fOnfHzOD2vCSyQJKzfgsCh+yi/Mmc35F2fUrw7miW33W9hBD1vpuUojFphIyvg7aTeoymDkIkeW3XLHmguMzbIAJejN6B5MDrhipE2y6SoFRO/AK/AcHHZHNIfiWrEe/C6cr3f/yOvrQKB+zMM55/GQdLDsR+ifr5Fiuu+/y+M78LzOE5dsNuXC3PYvYWd8NXvphLSkJIasrlD2/HOqQ+RjcRdjKTGWYhhVUm4yxlyiGPuMsZR7sMCHUBeTuNWA7if+ifXgc/hovftHXs/DV+Fvwe+f8shzMiMcweFgBly3//vwJfg5AN4450fn1Hd1Rm1aBLu22Dy3y3H2+OqMemkbGZ4jozcDjJf6596xOLpC0eMTHbKnxLxH27uZ/bMTGs2jOaMOY4m87CfQwF0dw53oa1k80JRuz/XgS+8fX3N9Af4qPIMfzKgCp4H5TDGe9GGeFPzSsZz80SlPTxXjgwJmC45njzgt2vbQ4b4OAdUK4/vWhO8d8v6EE8fMUsfakXbPpFJeLs2ubM/qdm/la3WP91uWhxXHjoWhyRUq2iJ/+5mA73zwIIo+LoZ/SgvIRjAd1IMvvn98PfgOvAJfhhm8scAKVWDuaRaK8aQ9f7vuPDH6Bj47ZXau7rqYJ66mTDwEDU6lLbCjCK0qTXyl5mnDoeNRxanj3FJbaksTk0faXxHxLrssgPkWB9LnA/MFleXcJozzjwsUvUG0X/QCve51qkMDXp9mtcyOy3rwBfdvVJK7D6/ACSzg3RoruIq5UDeESfEmVclDxnniU82vxMLtceD0hGZWzBNPMM/jSPne2OVatiTKUpY5vY7gc0LdUAWeWM5tH+O2I66AOWw9xT2BuyRVLGdoDHUsVRXOo/c+ZdRXvFfnxWyIV4upFLCl9eAL7h8Zv0QH8Ry8pA2cHzQpGesctVA37ZtklBTgHjyvdSeKY/RZw/kJMk0Y25cSNRWSigQtlULPTw+kzuJPeYEkXjQRpoGZobYsLF79pyd1dMRHInbgFTZqNLhDqiIsTNpoex2WLcy0/X6rHcdMMQvFSd5dWA++4P7xv89deACnmr36uGlL69bRCL6BSZsS6c0TU2TKK5gtWCzgAOOwQcurqk9j8whvziZSMLcq5hbuwBEsYjopUBkqw1yYBGpLA97SRElEmx5MCInBY5vgLk94iKqSWmhIGmkJ4Bi9m4L645J68LyY4wsFYBfUg5feP/6gWWm58IEmKQM89hq7KsZNaKtP5TxxrUZZVkNmMJtjbKrGxLNEbHPJxhqy7lAmbC32ZqeF6lTaknRWcYaFpfLUBh/rwaQycCCJmW15Kstv6jRHyJFry2C1ahkkIW0LO75s61+owxK1y3XqweX9m5YLM2DPFeOjn/iiqCKJ+yKXF8t5Yl/kNsqaSCryxPq5xWTFIaP8KSW0RYxqupaUf0RcTNSSdJZGcKYdYA6kdtrtmyBckfKXwqk0pHpUHlwWaffjNRBYFPUDWa8e3Lt/o0R0CdisKDM89cX0pvRHEfM8ca4t0s2Xx4kgo91MPQJ/0c9MQYq0co8MBh7bz1fio0UUHLR4aAIOvOmoYO6kwlEVODSSTliWtOtH6sPkrtctF9ZtJ9GIerBskvhdVS5cFNv9s1BU0AbdUgdK4FG+dRnjFmDTzniRMdZO1QhzMK355vigbdkpz9P6qjUGE5J2qAcXmwJ20cZUiAD0z+pGMx6xkzJkmEf40Hr4qZfVg2XzF9YOyoV5BjzVkUJngKf8lgNYwKECEHrCNDrWZzMlflS3yBhr/InyoUgBc/lKT4pxVrrC6g1YwcceK3BmNxZcAtz3j5EIpqguh9H6wc011YN75cKDLpFDxuwkrPQmUwW4KTbj9mZTwBwLq4aQMUZbHm1rylJ46dzR0dua2n3RYCWZsiHROeywyJGR7mXKlpryyCiouY56sFkBWEnkEB/raeh/Sw4162KeuAxMQpEkzy5alMY5wamMsWKKrtW2WpEWNnReZWONKWjrdsKZarpFjqCslq773PLmEhM448Pc3+FKr1+94vv/rfw4tEcu+lKTBe4kZSdijBrykwv9vbCMPcLQTygBjzVckSLPRVGslqdunwJ4oegtFOYb4SwxNgWLCmD7T9kVjTv5YDgpo0XBmN34Z/rEHp0sgyz7lngsrm4lvMm2Mr1zNOJYJ5cuxuQxwMGJq/TP5emlb8fsQBZviK4t8hFL+zbhtlpwaRSxQRWfeETjuauPsdGxsBVdO7nmP4xvzSoT29pRl7kGqz+k26B3Oy0YNV+SXbbQas1ctC/GarskRdFpKczVAF1ZXnLcpaMuzVe6lZ2g/1ndcvOVgRG3sdUAY1bKD6achijMPdMxV4muKVorSpiDHituH7rSTs7n/4y5DhRXo4FVBN4vO/zbAcxhENzGbHCzU/98Mcx5e7a31kWjw9FCe/zNeYyQjZsWb1uc7U33pN4Mji6hCLhivqfa9Ss6xLg031AgfesA/l99m9fgvnaF9JoE6bYKmkGNK3aPbHB96w3+DnxFm4hs0drLsk7U8kf/N/CvwQNtllna0rjq61sH8L80HAuvwH1tvBy2ChqWSCaYTaGN19sTvlfzFD6n+iKTbvtayfrfe9ueWh6GJFoxLdr7V72a5ZpvHcCPDzma0wTO4EgbLyedxstO81n57LYBOBzyfsOhUKsW1J1BB5vr/tz8RyqOFylQP9Tvst2JALsC5lsH8PyQ40DV4ANzYa4dedNiKNR1s+x2wwbR7q4/4cTxqEk4LWDebfisuo36JXLiWFjOtLrlNWh3K1rRS4xvHcDNlFnNmWBBAl5SWaL3oPOfnvbr5pdjVnEaeBJSYjuLEkyLLsWhKccadmOphZkOPgVdalj2QpSmfOsADhMWE2ZBu4+EEJI4wKTAuCoC4xwQbWXBltpxbjkXJtKxxabo9e7tyhlgb6gNlSbUpMh+l/FaqzVwewGu8BW1Zx7pTpQDJUjb8tsUTW6+GDXbMn3mLbXlXJiGdggxFAoUrtPS3wE4Nk02UZG2OOzlk7fRs7i95QCLo3E0jtrjnM7SR3uS1p4qtS2nJ5OwtQVHgOvArLBFijZUV9QtSl8dAY5d0E0hM0w3HS2DpIeB6m/A1+HfhJcGUq4sOxH+x3f5+VO+Ds9rYNI7zPXOYWPrtf8bYMx6fuOAX5jzNR0PdsuON+X1f7EERxMJJoU6GkTEWBvVolVlb5lh3tKCg6Wx1IbaMDdJ+9sUCc5KC46hKGCk3IVOS4TCqdBNfUs7Kd4iXf2RjnT/LLysJy3XDcHLh/vde3x8DoGvwgsa67vBk91G5Pe/HbOe7xwym0NXbtiuuDkGO2IJDh9oQvJ4cY4vdoqLDuoH9Zl2F/ofsekn8lkuhIlhQcffUtSjytFyp++p6NiE7Rqx/lodgKVoceEp/CP4FfjrquZaTtj2AvH5K/ywpn7M34K/SsoYDAdIN448I1/0/wveW289T1/lX5xBzc8N5IaHr0XMOQdHsIkDuJFifj20pBm5jzwUv9e2FhwRsvhAbalCIuIw3bhJihY3p6nTFFIZgiSYjfTf3aXuOjmeGn4bPoGvwl+CFzTRczBIuHBEeImHc37/lGfwZR0cXzVDOvaKfNHvwe+suZ771K/y/XcBlsoN996JpBhoE2toYxOznNEOS5TJc6Id5GEXLjrWo+LEWGNpPDU4WAwsIRROu+1vM+0oW37z/MBN9kqHnSArwPfgFJ7Cq/Ai3Ie7g7ncmI09v8sjzw9mzOAEXoIHxURueaAce5V80f/DOuuZwHM8vsMb5wBzOFWM7wymTXPAEvm4vcFpZ2ut0VZRjkiP2MlmLd6DIpbGSiHOjdnUHN90hRYmhTnmvhzp1iKDNj+b7t5hi79lWGwQ+HN9RsfFMy0FXbEwhfuczKgCbyxYwBmcFhhvo/7a44v+i3XWcwDP86PzpGQYdWh7csP5dBvZ1jNzdxC8pBGuxqSW5vw40nBpj5JhMwvOzN0RWqERHMr4Lv1kWX84xLR830G3j6yqZ1a8UstTlW+qJPOZ+sZ7xZPKTJLhiNOAFd6tk+jrTH31ncLOxid8+nzRb128HhUcru/y0Wn6iT254YPC6FtVSIMoW2sk727AhvTtrWKZTvgsmckfXYZWeNRXx/3YQ2OUxLDrbHtN11IwrgXT6c8dATDwLniYwxzO4RzuQqTKSC5gAofMZ1QBK3zQ4JWobFbcvJm87FK+6JXrKahLn54m3p+McXzzYtP8VF/QpJuh1OwieElEoI1pRxPS09FBrkq2tWCU59+HdhNtTIqKm8EBrw2RTOEDpG3IKo2Y7mFdLm3ZeVjYwVw11o/oznceMve4CgMfNym/utA/d/ILMR7gpXzRy9eDsgLcgbs8O2Va1L0zzIdwGGemTBuwROHeoMShkUc7P+ISY3KH5ZZeWqO8mFTxQYeXTNuzvvK5FGPdQfuu00DwYFY9dyhctEt+OJDdnucfpmyhzUJzfsJjr29l8S0bXBfwRS9ZT26tmMIdZucch5ZboMz3Nio3nIOsYHCGoDT4kUA9MiXEp9Xsui1S8th/kbWIrMBxDGLodWUQIWcvnXy+9M23xPiSMOiRPqM+YMXkUN3gXFrZJwXGzUaMpJfyRS9ZT0lPe8TpScuRlbMHeUmlaKDoNuy62iWNTWNFYjoxFzuJs8oR+RhRx7O4SVNSXpa0ZJQ0K1LAHDQ+D9IepkMXpcsq5EVCvClBUIzDhDoyKwDw1Lc59GbTeORivugw1IcuaEOaGWdNm+Ps5fQ7/tm0DjMegq3yM3vb5j12qUId5UZD2oxDSEWOZMSqFl/W+5oynWDa/aI04tJRQ2eTXusg86SQVu/nwSYwpW6wLjlqIzwLuxGIvoAvul0PS+ZNz0/akp/pniO/8JDnGyaCkzbhl6YcqmK/69prxPqtpx2+Km9al9sjL+rwMgHw4jE/C8/HQ3m1vBuL1fldbzd8mOueVJ92syqdEY4KJjSCde3mcRw2TA6szxedn+zwhZMps0XrqEsiUjnC1hw0TELC2Ek7uAAdzcheXv1BYLagspxpzSAoZZUsIzIq35MnFQ9DOrlNB30jq3L4pkhccKUAA8/ocvN1Rzx9QyOtERs4CVsJRK/DF71kPYrxYsGsm6RMh4cps5g1DOmM54Ly1ii0Hd3Y/BMk8VWFgBVmhqrkJCPBHAolwZaWzLR9Vb7bcWdX9NyUYE+uB2BKfuaeBUcjDljbYVY4DdtsVWvzRZdWnyUzDpjNl1Du3aloAjVJTNDpcIOVVhrHFF66lLfJL1zJr9PQ2nFJSBaKoDe+sAvLufZVHVzYh7W0h/c6AAZ+7Tvj6q9j68G/cTCS/3n1vLKHZwNi+P+pS0WkZNMBMUl+LDLuiE4omZy71r3UFMwNJV+VJ/GC5ixVUkBStsT4gGKh0Gm4Oy3qvq7Lbmq24nPdDuDR9deR11XzP4vFu3TYzfnIyiSVmgizUYGqkIXNdKTY9pgb9D2Ix5t0+NHkVzCdU03suWkkVZAoCONCn0T35gAeW38de43mf97sMOpSvj4aa1KYUm58USI7Wxxes03bAZdRzk6UtbzMaCQ6IxO0dy7X+XsjoD16hpsBeGz9dfzHj+R/Hp8nCxZRqkEDTaCKCSywjiaoMJ1TITE9eg7Jqnq8HL6gDwiZb0u0V0Rr/rmvqjxKuaLCX7ZWXTvAY+uvm3z8CP7nzVpngqrJpZKwWnCUjIviYVlirlGOzPLI3SMVyp/elvBUjjDkNhrtufFFErQ8pmdSlbK16toBHlt/HV8uHMX/vEGALkV3RJREiSlopxwdMXOZPLZ+ix+kAHpMKIk8UtE1ygtquttwxNhphrIZ1IBzjGF3IIGxGcBj6q8bHJBG8T9vdsoWrTFEuebEZuVxhhClH6P5Zo89OG9fwHNjtNQTpD0TG9PJLEYqvEY6Rlxy+ZZGfL0Aj62/bnQCXp//eeM4KzfQVJbgMQbUjlMFIm6TpcfWlZje7NBSV6IsEVmumWIbjiloUzQX9OzYdo8L1wjw2PrrpimONfmfNyzKklrgnEkSzT5QWYQW40YShyzqsRmMXbvVxKtGuYyMKaU1ugenLDm5Ily4iT14fP11Mx+xJv+zZ3MvnfdFqxU3a1W/FTB4m3Qfsyc1XUcdVhDeUDZXSFHHLQj/Y5jtC7ZqM0CXGwB4bP11i3LhOvzPGygYtiUBiwQV/4wFO0majijGsafHyRLu0yG6q35cL1rOpVxr2s5cM2jJYMCdc10Aj6q/blRpWJ//+dmm5psMl0KA2+AFRx9jMe2WbC4jQxnikd4DU8TwUjRVacgdlhmr3bpddzuJ9zXqr2xnxJfzP29RexdtjDVZqzkqa6PyvcojGrfkXiJ8SEtml/nYskicv0ivlxbqjemwUjMw5evdg8fUX9nOiC/lf94Q2i7MURk9nW1MSj5j8eAyV6y5CN2S6qbnw3vdA1Iwq+XOSCl663udN3IzLnrt+us25cI1+Z83SXQUldqQq0b5XOT17bGpLd6ssN1VMPf8c+jG8L3NeCnMdF+Ra3fRa9dft39/LuZ/3vwHoHrqGmQFafmiQw6eyzMxS05K4bL9uA+SKUQzCnSDkqOGokXyJvbgJ/BHI+qvY69//4rl20NsmK2ou2dTsyIALv/91/8n3P2Aao71WFGi8KKv1fRC5+J67Q/507/E/SOshqN5TsmYIjVt+kcjAx98iz/4SaojbIV1rexE7/C29HcYD/DX4a0rBOF5VTu7omsb11L/AWcVlcVZHSsqGuXLLp9ha8I//w3Mv+T4Ew7nTBsmgapoCrNFObIcN4pf/Ob/mrvHTGqqgAupL8qWjWPS9m/31jAe4DjA+4+uCoQoT/zOzlrNd3qd4SdphFxsUvYwGWbTWtISc3wNOWH+kHBMfc6kpmpwPgHWwqaSUG2ZWWheYOGQGaHB+eQ/kn6b3pOgLV+ODSn94wDvr8Bvb70/LLuiPPEr8OGVWfDmr45PZyccEmsVXZGe1pRNX9SU5+AVQkNTIVPCHF/jGmyDC9j4R9LfWcQvfiETmgMMUCMN1uNCakkweZsowdYobiMSlnKA93u7NzTXlSfe+SVbfnPQXmg9LpYAQxpwEtONyEyaueWM4FPjjyjG3uOaFmBTWDNgBXGEiQpsaWhnAqIijB07Dlsy3fUGeP989xbWkyf+FF2SNEtT1E0f4DYYVlxFlbaSMPIRMk/3iMU5pME2SIWJvjckciebkQuIRRyhUvkHg/iUljG5kzVog5hV7vIlCuBrmlhvgPfNHQM8lCf+FEGsYbMIBC0qC9a0uuy2wLXVbLBaP5kjHokCRxapkQyzI4QEcwgYHRZBp+XEFTqXFuNVzMtjXLJgX4gAid24Hjwc4N3dtVSe+NNiwTrzH4WVUOlDobUqr1FuAgYllc8pmzoVrELRHSIW8ViPxNy4xwjBpyR55I6J220qQTZYR4guvUICJiSpr9gFFle4RcF/OMB7BRiX8sSfhpNSO3lvEZCQfLUVTKT78Ek1LRLhWN+yLyTnp8qWUZ46b6vxdRGXfHVqx3eI75YaLa4iNNiK4NOW7wPW6lhbSOF9/M9qw8e/aoB3d156qTzxp8pXx5BKAsYSTOIIiPkp68GmTq7sZtvyzBQaRLNxIZ+paozHWoLFeExIhRBrWitHCAHrCF7/thhD8JhYz84wg93QRV88wLuLY8zF8sQ36qF1J455bOlgnELfshKVxYOXKVuKx0jaj22sczTQqPqtV/XDgpswmGTWWMSDw3ssyUunLLrVPGjYRsH5ggHeHSWiV8kT33ycFSfMgkoOK8apCye0J6VW6GOYvffgU9RWsukEi2kUV2nl4dOYUzRik9p7bcA4ggdJ53LxKcEe17B1R8eqAd7dOepV8sTXf5lhejoL85hUdhDdknPtKHFhljOT+bdq0hxbm35p2nc8+Ja1Iw+tJykgp0EWuAAZYwMVwac5KzYMslhvgHdHRrxKnvhTYcfKsxTxtTETkjHO7rr3zjoV25lAQHrqpV7bTiy2aXMmUhTBnKS91jhtR3GEoF0oLnWhWNnYgtcc4N0FxlcgT7yz3TgNIKkscx9jtV1ZKpWW+Ub1tc1eOv5ucdgpx+FJy9pgbLE7xDyXb/f+hLHVGeitHOi6A7ybo3sF8sS7w7cgdk0nJaOn3hLj3uyD0Zp5pazFIUXUpuTTU18d1EPkDoX8SkmWTnVIozEdbTcZjoqxhNHf1JrSS/AcvHjZ/SMHhL/7i5z+POsTUh/8BvNfYMTA8n+yU/MlTZxSJDRStqvEuLQKWwDctMTQogUDyQRoTQG5Kc6oQRE1yV1jCA7ri7jdZyK0sYTRjCR0Hnnd+y7nHxNgTULqw+8wj0mQKxpYvhjm9uSUxg+TTy7s2GtLUGcywhXSKZN275GsqlclX90J6bRI1aouxmgL7Q0Nen5ziM80SqMIo8cSOo+8XplT/5DHNWsSUr/6lLN/QQ3rDyzLruEW5enpf7KqZoShEduuSFOV7DLX7Ye+GmXb6/hnNNqKsVXuMDFpb9Y9eH3C6NGEzuOuI3gpMH/I6e+zDiH1fXi15t3vA1czsLws0TGEtmPEJdiiFPwlwKbgLHAFk4P6ZyPdymYYHGE0dutsChQBl2JcBFlrEkY/N5bQeXQ18gjunuMfMfsBlxJSx3niO485fwO4fGD5T/+3fPQqkneWVdwnw/3bMPkW9Wbqg+iC765Zk+xcT98ibKZc2EdgHcLoF8cSOo/Oc8fS+OyEULF4g4sJqXVcmfMfsc7A8v1/yfGXmL9I6Fn5pRwZhsPv0TxFNlAfZCvG+Oohi82UC5f/2IsJo0cTOm9YrDoKhFPEUr/LBYTUNht9zelHXDqwfPCIw4owp3mOcIQcLttWXFe3VZ/j5H3cIc0G6oPbCR+6Y2xF2EC5cGUm6wKC5tGEzhsWqw5hNidUiKX5gFWE1GXh4/Qplw4sVzOmx9QxU78g3EF6wnZlEN4FzJ1QPSLEZz1KfXC7vd8ssGdIbNUYpVx4UapyFUHzJoTOo1McSkeNn1M5MDQfs4qQuhhX5vQZFw8suwWTcyYTgioISk2YdmkhehG4PkE7w51inyAGGaU+uCXADabGzJR1fn3lwkty0asIo8cROm9Vy1g0yDxxtPvHDAmpu+PKnM8Ix1wwsGw91YJqhteaWgjYBmmQiebmSpwKKzE19hx7jkzSWOm66oPbzZ8Yj6kxVSpYjVAuvLzYMCRo3oTQecOOjjgi3NQ4l9K5/hOGhNTdcWVOTrlgYNkEXINbpCkBRyqhp+LdRB3g0OU6rMfW2HPCFFMV9nSp+uB2woepdbLBuJQyaw/ZFysXrlXwHxI0b0LovEkiOpXGA1Ijagf+KUNC6rKNa9bQnLFqYNkEnMc1uJrg2u64ELPBHpkgWbmwKpJoDhMwNbbGzAp7Yg31wS2T5rGtzit59PrKhesWG550CZpHEzpv2NGRaxlNjbMqpmEIzygJqQfjypycs2pg2cS2RY9r8HUqkqdEgKTWtWTKoRvOBPDYBltja2SO0RGjy9UHtxwRjA11ujbKF+ti5cIR9eCnxUg6owidtyoU5tK4NLji5Q3HCtiyF2IqLGYsHViOXTXOYxucDqG0HyttqYAKqYo3KTY1ekyDXRAm2AWh9JmsVh/ccg9WJ2E8YjG201sPq5ULxxX8n3XLXuMInbft2mk80rRGjCGctJ8/GFdmEQ9Ug4FlE1ll1Y7jtiraqm5Fe04VV8lvSVBL8hiPrfFVd8+7QH3Qbu2ipTVi8cvSGivc9cj8yvH11YMHdNSERtuOslM97feYFOPKzGcsI4zW0YGAbTAOaxCnxdfiYUmVWslxiIblCeAYr9VYR1gM7GmoPrilunSxxeT3DN/2eBQ9H11+nk1adn6VK71+5+Jfct4/el10/7KBZfNryUunWSCPxPECk1rdOv1WVSrQmpC+Tl46YD3ikQYcpunSQgzVB2VHFhxHVGKDgMEY5GLlQnP7FMDzw7IacAWnO6sBr12u+XanW2AO0wQ8pknnFhsL7KYIqhkEPmEXFkwaN5KQphbkUmG72wgw7WSm9RiL9QT925hkjiVIIhphFS9HKI6/8QAjlpXqg9W2C0apyaVDwKQwrwLY3j6ADR13ZyUNByQXHQu6RY09Hu6zMqXRaNZGS/KEJs0cJEe9VH1QdvBSJv9h09eiRmy0V2uJcqHcShcdvbSNg5fxkenkVprXM9rDVnX24/y9MVtncvbKY706anNl3ASll9a43UiacVquXGhvq4s2FP62NGKfQLIQYu9q1WmdMfmUrDGt8eDS0cXozH/fjmUH6Jruvm50hBDSaEU/2Ru2LEN/dl006TSc/g7tfJERxGMsgDUEr104pfWH9lQaN+M4KWQjwZbVc2rZVNHsyHal23wZtIs2JJqtIc/WLXXRFCpJkfE9jvWlfFbsNQ9pP5ZBS0zKh4R0aMFj1IjTcTnvi0Zz2rt7NdvQb2mgbju1plsH8MmbnEk7KbK0b+wC2iy3aX3szW8xeZvDwET6hWZYwqTXSSG+wMETKum0Dq/q+x62gt2ua2ppAo309TRk9TPazfV3qL9H8z7uhGqGqxNVg/FKx0HBl9OVUORn8Q8Jx9gFttGQUDr3tzcXX9xGgN0EpzN9mdZ3GATtPhL+CjxFDmkeEU6x56kqZRusLzALXVqkCN7zMEcqwjmywDQ6OhyUe0Xao1Qpyncrg6wKp9XfWDsaZplElvQ/b3sdweeghorwBDlHzgk1JmMc/wiERICVy2VJFdMjFuLQSp3S0W3+sngt2njwNgLssFGVQdJ0tu0KH4ky1LW4yrbkuaA6Iy9oz/qEMMXMMDWyIHhsAyFZc2peV9hc7kiKvfULxCl9iddfRK1f8kk9qvbdOoBtOg7ZkOZ5MsGrSHsokgLXUp9y88smniwWyuFSIRVmjplga3yD8Uij5QS1ZiM4U3Qw5QlSm2bXjFe6jzzBFtpg+/YBbLAWG7OPynNjlCw65fukGNdkJRf7yM1fOxVzbxOJVocFoYIaGwH22mIQkrvu1E2nGuebxIgW9U9TSiukPGU+Lt++c3DJPKhyhEEbXCQLUpae2exiKy6tMPe9mDRBFCEMTWrtwxN8qvuGnt6MoihKWS5NSyBhbH8StXoAz8PLOrRgLtOT/+4vcu+7vDLnqNvztOq7fmd8sMmY9Xzn1zj8Dq8+XVdu2Nv0IIySgEdQo3xVHps3Q5i3fLFsV4aiqzAiBhbgMDEd1uh8qZZ+lwhjkgokkOIv4xNJmyncdfUUzgB4oFMBtiu71Xumpz/P+cfUP+SlwFExwWW62r7b+LSPxqxn/gvMZ5z9C16t15UbNlq+jbGJtco7p8wbYlL4alSyfWdeuu0j7JA3JFNuVAwtst7F7FhWBbPFNKIUORndWtLraFLmMu7KFVDDOzqkeaiN33YAW/r76wR4XDN/yN1z7hejPau06EddkS/6XThfcz1fI/4K736fO48vlxt2PXJYFaeUkFS8U15XE3428xdtn2kc8GQlf1vkIaNRRnOMvLTWrZbElEHeLWi1o0dlKPAh1MVgbbVquPJ5+Cr8LU5/H/+I2QlHIU2ClXM9G8v7Rr7oc/hozfUUgsPnb3D+I+7WF8kNO92GY0SNvuxiE+2Bt8prVJTkzE64sfOstxuwfxUUoyk8VjcTlsqe2qITSFoSj6Epd4KsT6BZOWmtgE3hBfir8IzZDwgV4ZTZvD8VvPHERo8v+vL1DASHTz/i9OlKueHDjK5Rnx/JB1Vb1ioXdBra16dmt7dgik10yA/FwJSVY6XjA3oy4SqM2frqDPPSRMex9qs3XQtoWxMj7/Er8GWYsXgjaVz4OYumP2+9kbxvny/6kvWsEBw+fcb5bInc8APdhpOSs01tEqIkoiZjbAqKMruLbJYddHuHFRIyJcbdEdbl2sVLaySygunutBg96Y2/JjKRCdyHV+AEFtTvIpbKIXOamknYSiB6KV/0JetZITgcjjk5ZdaskBtWO86UF0ap6ozGXJk2WNiRUlCPFir66lzdm/SLSuK7EUdPz8f1z29Skq6F1fXg8+5UVR6bszncP4Tn4KUkkdJ8UFCY1zR1i8RmL/qQL3rlei4THG7OODlnKko4oI01kd3CaM08Ia18kC3GNoVaO9iDh+hWxSyTXFABXoau7Q6q9OxYg/OVEMw6jdbtSrJ9cBcewGmaZmg+bvkUnUUaGr+ZfnMH45Ivevl61hMcXsxYLFTu1hTm2zViCp7u0o5l+2PSUh9bDj6FgYypufBDhqK2+oXkiuHFHR3zfj+9PtA8oR0xnqX8qn+sx3bFODSbbF0X8EUvWQ8jBIcjo5bRmLOljDNtcqNtOe756h3l0VhKa9hDd2l1eqmsnh0MNMT/Cqnx6BInumhLT8luljzQ53RiJeA/0dxe5NK0o2fA1+GLXr6eNQWHNUOJssQaTRlGpLHKL9fD+IrQzTOMZS9fNQD4AnRNVxvTdjC+fJdcDDWQcyB00B0t9BDwTxXgaAfzDZ/DBXzRnfWMFRwuNqocOmX6OKNkY63h5n/fFcB28McVHqnXZVI27K0i4rDLNE9lDKV/rT+udVbD8dFFu2GGZ8mOt0kAXcoX3ZkIWVtw+MNf5NjR2FbivROHmhV1/pj2egv/fMGIOWTIWrV3Av8N9imV9IWml36H6cUjqEWNv9aNc+veb2sH46PRaHSuMBxvtW+twxctq0z+QsHhux8Q7rCY4Ct8lqsx7c6Sy0dl5T89rIeEuZKoVctIk1hNpfavER6yyH1Vvm3MbsUHy4ab4hWr/OZPcsRBphnaV65/ZcdYPNNwsjN/djlf9NqCw9U5ExCPcdhKxUgLSmfROpLp4WSUr8ojdwbncbvCf+a/YzRaEc6QOvXcGO256TXc5Lab9POvB+AWY7PigWYjzhifbovuunzRawsO24ZqQQAqguBtmpmPB7ysXJfyDDaV/aPGillgz1MdQg4u5MYaEtBNNHFjkRlSpd65lp4hd2AVPTfbV7FGpyIOfmNc/XVsPfg7vzaS/3nkvLL593ANLvMuRMGpQIhiF7kUEW9QDpAUbTWYBcbp4WpacHHY1aacqQyjGZS9HI3yCBT9kUZJhVOD+zUDvEH9ddR11fzPcTDQ5TlgB0KwqdXSavk9BC0pKp0WmcuowSw07VXmXC5guzSa4p0UvRw2lbDiYUx0ExJJRzWzi6Gm8cnEkfXXsdcG/M/jAJa0+bmCgdmQ9CYlNlSYZOKixmRsgiFxkrmW4l3KdFKv1DM8tk6WxPYJZhUUzcd8Kdtgrw/gkfXXDT7+avmfVak32qhtkg6NVdUS5wgkru1YzIkSduTW1FDwVWV3JQVJVuieTc0y4iDpFwc7/BvSalvKdQM8sv662cevz/+8sQVnjVAT0W2wLllw1JiMhJRxgDjCjLQsOzSFSgZqx7lAW1JW0e03yAD3asC+GD3NbQhbe+mN5GXH1F83KDOM4n/e5JIuH4NpdQARrFPBVptUNcjj4cVMcFSRTE2NpR1LEYbYMmfWpXgP9KejaPsLUhuvLCsVXznAG9dfx9SR1ud/3hZdCLHb1GMdPqRJgqDmm76mHbvOXDtiO2QPUcKo/TWkQ0i2JFXpBoo7vij1i1Lp3ADAo+qvG3V0rM//vFnnTE4hxd5Ka/Cor5YEdsLVJyKtDgVoHgtW11pWSjolPNMnrlrVj9Fv2Qn60twMwKPqr+N/wvr8z5tZcDsDrv06tkqyzESM85Ycv6XBWA2birlNCXrI6VbD2lx2L0vQO0QVTVVLH4SE67fgsfVXv8n7sz7/85Z7cMtbE6f088wSaR4kCkCm10s6pKbJhfqiUNGLq+0gLWC6eUAZFPnLjwqtKd8EwGvWX59t7iPW4X/eAN1svgRVSY990YZg06BD1ohLMtyFTI4pKTJsS9xREq9EOaPWiO2gpms7397x6nQJkbh+Fz2q/rqRROX6/M8bJrqlVW4l6JEptKeUFuMYUbtCQ7CIttpGc6MY93x1r1vgAnRXvY5cvwWPqb9uWQm+lP95QxdNMeWhOq1x0Db55C7GcUv2ZUuN6n8iKzsvOxibC//Yfs9Na8r2Rlz02vXXDT57FP/zJi66/EJSmsJKa8QxnoqW3VLQ+jZVUtJwJ8PNX1NQCwfNgdhhHD9on7PdRdrdGPF28rJr1F+3LBdeyv+8yYfLoMYet1vX4upNAjVvwOUWnlNXJXlkzk5Il6kqeoiL0C07qno+/CYBXq/+utlnsz7/Mzvy0tmI4zm4ag23PRN3t/CWryoUVJGm+5+K8RJ0V8Hc88/XHUX/HfiAq7t+BH+x6v8t438enWmdJwFA6ZINriLGKv/95f8lT9/FnyA1NMVEvQyaXuu+gz36f/DD73E4pwqpLcvm/o0Vle78n//+L/NPvoefp1pTJye6e4A/D082FERa5/opeH9zpvh13cNm19/4v/LDe5xMWTi8I0Ta0qKlK27AS/v3/r+/x/2GO9K2c7kVMonDpq7//jc5PKCxeNPpFVzaRr01wF8C4Pu76hXuX18H4LduTr79guuFD3n5BHfI+ZRFhY8w29TYhbbLi/bvBdqKE4fUgg1pBKnV3FEaCWOWyA+m3WpORZr/j+9TKJtW8yBTF2/ZEODI9/QavHkVdGFp/Pjn4Q+u5hXapsP5sOH+OXXA1LiKuqJxiMNbhTkbdJTCy4llEt6NnqRT4dhg1V3nbdrm6dYMecA1yTOL4PWTE9L5VzPFlLBCvlG58AhehnN4uHsAYinyJ+AZ/NkVvELbfOBUuOO5syBIEtiqHU1k9XeISX5bsimrkUUhnGDxourN8SgUsCZVtKyGbyGzHXdjOhsAvOAswSRyIBddRdEZWP6GZhNK/yjwew9ehBo+3jEADu7Ay2n8mDc+TS7awUHg0OMzR0LABhqLD4hJEh/BEGyBdGlSJoXYXtr+3HS4ijzVpgi0paWXtdruGTknXBz+11qT1Q2inxaTzQCO46P3lfLpyS4fou2PH/PupwZgCxNhGlj4IvUuWEsTkqMWm6i4xCSMc9N1RDQoCVcuGItJ/MRWefais+3synowi/dESgJjkilnWnBTGvRWmaw8oR15257t7CHmCf8HOn7cwI8+NQBXMBEmAa8PMRemrNCEhLGEhDQKcGZWS319BX9PFBEwGTbRBhLbDcaV3drFcDqk5kCTd2JF1Wp0HraqBx8U0wwBTnbpCadwBA/gTH/CDrcCs93LV8E0YlmmcyQRQnjBa8JESmGUfIjK/7fkaDJpmD2QptFNVJU1bbtIAjjWQizepOKptRjbzR9Kag6xZmMLLjHOtcLT3Tx9o/0EcTT1XN3E45u24AiwEypDJXihKjQxjLprEwcmRKclaDNZCVqr/V8mYWyFADbusiY5hvgFoU2vio49RgJLn5OsReRFN6tabeetiiy0V7KFHT3HyZLx491u95sn4K1QQSPKM9hNT0wMVvAWbzDSVdrKw4zRjZMyJIHkfq1VAVCDl/bUhNKlGq0zGr05+YAceXVPCttVk0oqjVwMPt+BBefx4yPtGVkUsqY3CHDPiCM5ngupUwCdbkpd8kbPrCWHhkmtIKLEetF2499eS1jZlIPGYnlcPXeM2KD9vLS0bW3ktYNqUllpKLn5ZrsxlIzxvDu5eHxzGLctkZLEY4PgSOg2IUVVcUONzUDBEpRaMoXNmUc0tFZrTZquiLyKxrSm3DvIW9Fil+AkhXu5PhEPx9mUNwqypDvZWdKlhIJQY7vn2OsnmBeOWnYZ0m1iwbbw1U60by5om47iHRV6fOgzjMf/DAZrlP40Z7syxpLK0lJ0gqaAK1c2KQKu7tabTXkLFz0sCftuwX++MyNeNn68k5Buq23YQhUh0SNTJa1ioQ0p4nUG2y0XilF1JqODqdImloPS4Bp111DEWT0jJjVv95uX9BBV7eB3bUWcu0acSVM23YZdd8R8UbQUxJ9wdu3oMuhdt929ME+mh6JXJ8di2RxbTi6TbrDquqV4aUKR2iwT6aZbyOwEXN3DUsWr8Hn4EhwNyHuXHh7/pdaUjtR7vnDh/d8c9xD/s5f501eQ1+CuDiCvGhk1AN/4Tf74RfxPwD3toLarR0zNtsnPzmS64KIRk861dMWCU8ArasG9T9H0ZBpsDGnjtAOM2+/LuIb2iIUGXNgl5ZmKD/Tw8TlaAuihaFP5yrw18v4x1898zIdP+DDAX1bM3GAMvPgRP/cJn3zCW013nrhHkrITyvYuwOUkcHuKlRSW5C6rzIdY4ppnF7J8aAJbQepgbJYBjCY9usGXDKQxq7RZfh9eg5d1UHMVATRaD/4BHK93/1iAgYZ/+jqPn8Dn4UExmWrpa3+ZOK6MvM3bjwfzxNWA2dhs8+51XHSPJiaAhGSpWevEs5xHLXcEGFXYiCONySH3fPWq93JIsBiSWvWyc3CAN+EcXoT7rCSANloPPoa31rt/5PUA/gp8Q/jDD3hyrjzlR8VkanfOvB1XPubt17vzxAfdSVbD1pzAnfgyF3ycadOTOTXhpEUoLC1HZyNGW3dtmjeXgr2r56JNmRwdNNWaQVBddd6rh4MhviEB9EFRD/7RGvePvCbwAL4Mx/D6M541hHO4D3e7g6PafdcZVw689z7NGTwo5om7A8sPhccT6qKcl9NJl9aM/9kX+e59Hh1yPqGuCCZxuITcsmNaJ5F7d0q6J3H48TO1/+M57085q2icdu2U+W36Ldllz9Agiv4YGljoEN908EzvDOrBF98/vtJwCC/BF2AG75xxEmjmMIcjxbjoaxqOK3/4hPOZzhMPBpYPG44CM0dTVm1LjLtUWWVz1Bcf8tEx0zs8O2A2YVHRxKYOiy/aOVoAaMu0i7ubu43njjmd4ibMHU1sIDHaQNKrZND/FZYdk54oCXetjq7E7IVl9eAL7t+oHnwXXtLx44czzoRFHBztYVwtH1d+NOMkupZ5MTM+gUmq90X+Bh9zjRlmaQ+m7YMqUL/veemcecAtOJ0yq1JnVlN27di2E0+Klp1tAJ4KRw1eMI7aJjsO3R8kPSI3fUFXnIOfdQe86sIIVtWDL7h//Ok6vj8vwDk08NEcI8zz7OhBy+WwalzZeZ4+0XniRfst9pAJqQHDGLzVQ2pheZnnv1OWhwO43/AgcvAEXEVVpa4db9sGvNK8wjaENHkfFQ4Ci5i7dqnQlPoLQrHXZDvO3BIXZbJOBrOaEbML6sFL798I4FhKihjHMsPjBUZYCMFr6nvaArxqXPn4lCa+cHfSa2cP27g3Z3ziYTRrcbQNGLQmGF3F3cBdzzzX7AILx0IB9rbwn9kx2G1FW3Inic+ZLIsVvKR8Zwfj0l1fkqo8LWY1M3IX14OX3r9RKTIO+d9XzAI8qRPGPn/4NC2n6o4rN8XJ82TOIvuVA8zLKUHRFgBCetlDZlqR1gLKjS39xoE7Bt8UvA6BxuEDjU3tFsEijgA+615tmZkXKqiEENrh41iLDDZNq4pKTWR3LZfnos81LOuNa15cD956vLMsJd1rqYp51gDUQqMYm2XsxnUhD2jg1DM7SeuJxxgrmpfISSXVIJIS5qJJSvJPEQ49DQTVIbYWJ9QWa/E2+c/oPK1drmC7WSfJRNKBO5Yjvcp7Gc3dmmI/Xh1kDTEuiSnWqQf37h+fTMhGnDf6dsS8SQfQWlqqwXXGlc/PEZ/SC5mtzIV0nAshlQdM/LvUtYutrEZ/Y+EAFtq1k28zQhOwLr1AIeANzhF8t9qzTdZf2qRKO6MWE9ohBYwibbOmrFtNmg3mcS+tB28xv2uKd/agYCvOP+GkSc+0lr7RXzyufL7QbkUpjLjEWFLqOIkAGu2B0tNlO9Eau2W1qcOUvVRgKzypKIQZ5KI3q0MLzqTNRYqiZOqmtqloIRlmkBHVpHmRYV6/HixbO6UC47KOFJnoMrVyr7wYz+SlW6GUaghYbY1I6kkxA2W1fSJokUdSh2LQ1GAimRGm0MT+uu57H5l7QgOWxERpO9moLRPgTtquWCfFlGlIjQaRly9odmzMOWY+IBO5tB4sW/0+VWGUh32qYk79EidWKrjWuiLpiVNGFWFRJVktyeXWmbgBBzVl8anPuXyNJlBJOlKLTgAbi/EYHVHxWiDaVR06GnHQNpJcWcK2jJtiCfG2sEHLzuI66sGrMK47nPIInPnu799935aOK2cvmvubrE38ZzZjrELCmXM2hM7UcpXD2oC3+ECVp7xtIuxptJ0jUr3sBmBS47TVxlvJ1Sqb/E0uLdvLj0lLr29ypdd/eMX3f6lrxGlKwKQxEGvw0qHbkbwrF3uHKwVENbIV2wZ13kNEF6zD+x24aLNMfDTCbDPnEikZFyTNttxWBXDaBuM8KtI2rmaMdUY7cXcUPstqTGvBGSrFWIpNMfbdea990bvAOC1YX0qbc6smDS1mPxSJoW4fwEXvjMmhlijDRq6qale6aJEuFGoppYDoBELQzLBuh/mZNx7jkinv0EtnUp50lO9hbNK57lZaMAWuWR5Yo9/kYwcYI0t4gWM47Umnl3YmpeBPqSyNp3K7s2DSAS/39KRuEN2bS4xvowV3dFRMx/VFcp2Yp8w2nTO9hCXtHG1kF1L4KlrJr2wKfyq77R7MKpFKzWlY9UkhYxyHWW6nBWPaudvEAl3CGcNpSXPZ6R9BbBtIl6cHL3gIBi+42CYXqCx1gfGWe7Ap0h3luyXdt1MKy4YUT9xSF01G16YEdWsouW9mgDHd3veyA97H+Ya47ZmEbqMY72oPztCGvK0onL44AvgC49saZKkWRz4veWljE1FHjbRJaWv6ZKKtl875h4CziFCZhG5rx7tefsl0aRT1bMHZjm8dwL/6u7wCRysaQblQoG5yAQN5zpatMNY/+yf8z+GLcH/Qn0iX2W2oEfXP4GvwQHuIL9AYGnaO3zqAX6946nkgqZNnUhx43DIdQtMFeOPrgy/y3Yd85HlJWwjLFkU3kFwq28xPnuPhMWeS+tDLV9Otllq7pQCf3uXJDN9wFDiUTgefHaiYbdfi3b3u8+iY6TnzhgehI1LTe8lcd7s1wJSzKbahCRxKKztTLXstGAiu3a6rPuQs5pk9TWAan5f0BZmGf7Ylxzzk/A7PAs4QPPPAHeFQ2hbFHszlgZuKZsJcUmbDC40sEU403cEjczstOEypa+YxevL4QBC8oRYqWdK6b7sK25tfE+oDZgtOQ2Jg8T41HGcBE6fTWHn4JtHcu9S7uYgU5KSCkl/mcnq+5/YBXOEr6lCUCwOTOM1taOI8mSxx1NsCXBEmLKbMAg5MkwbLmpBaFOPrNSlO2HnLiEqW3tHEwd8AeiQLmn+2gxjC3k6AxREqvKcJbTEzlpLiw4rNZK6oJdidbMMGX9FULKr0AkW+2qDEPBNNm5QAt2Ik2nftNWHetubosHLo2nG4vQA7GkcVCgVCgaDixHqo9UUn1A6OshapaNR/LPRYFV8siT1cCtJE0k/3WtaNSuUZYKPnsVIW0xXWnMUxq5+En4Kvw/MqQmVXnAXj9Z+9zM98zM/Agy7F/qqj2Nh67b8HjFnPP3iBn/tkpdzwEJX/whIcQUXOaikeliCRGUk7tiwF0rItwMEhjkZ309hikFoRAmLTpEXWuHS6y+am/KB/fM50aLEhGnSMwkpxzOov4H0AvgovwJ1iGzDLtJn/9BU+fAINfwUe6FHSLhu83viV/+/HrOePX+STT2B9uWGbrMHHLldRBlhS/CJQmcRxJFqZica01XixAZsYiH1uolZxLrR/SgxVIJjkpQP4PE9sE59LKLr7kltSBogS5tyszzH8Fvw8/AS8rNOg0xUS9fIaHwb+6et8Q/gyvKRjf5OusOzGx8evA/BP4IP11uN/grca5O0lcsPLJ5YjwI4QkJBOHa0WdMZYGxPbh2W2nR9v3WxEWqgp/G3+6VZbRLSAAZ3BhdhAaUL33VUSw9yjEsvbaQ9u4A/gGXwZXoEHOuU1GSj2chf+Mo+f8IcfcAxfIKVmyunRbYQVnoevwgfw3TXXcw++xNuP4fhyueEUNttEduRVaDttddoP0eSxLe2LENk6itYxlrxBNBYrNNKSQmeaLcm9c8UsaB5WyO6675yyQIAWSDpBVoA/gxmcwEvwoDv0m58UE7gHn+fJOa8/Ywan8EKRfjsopF83eCglX/Sfr7OeaRoQfvt1CGvIDccH5BCvw1sWIzRGC/66t0VTcLZQZtm6PlAasbOJ9iwWtUo7biktTSIPxnR24jxP1ZKaqq+2RcXM9OrBAm/AAs7hDJ5bNmGb+KIfwCs8a3jnjBrOFeMjHSCdbKr+2uOLfnOd9eiA8Hvvwwq54VbP2OqwkB48Ytc4YEOiH2vTXqodabfWEOzso4qxdbqD5L6tbtNPECqbhnA708DZH4QOJUXqScmUlks7Ot6FBuZw3n2mEbaUX7kDzxHOOQk8nKWMzAzu6ZZ8sOFw4RK+6PcuXo9tB4SbMz58ApfKDXf3szjNIIbGpD5TKTRxGkEMLjLl+K3wlWXBsCUxIDU+jbOiysESqAy1MGUJpXgwbTWzNOVEziIXZrJ+VIztl1PUBxTSo0dwn2bOmfDRPD3TRTGlfbCJvO9KvuhL1hMHhB9wPuPRLGHcdOWG2xc0U+5bQtAJT0nRTewXL1pgk2+rZAdeWmz3jxAqfNQQdzTlbF8uJ5ecEIWvTkevAHpwz7w78QujlD/Lr491bD8/1vhM2yrUQRrWXNQY4fGilfctMWYjL72UL/qS9eiA8EmN88nbNdour+PBbbAjOjIa4iBhfFg6rxeKdEGcL6p3EWR1Qq2Qkhs2DrnkRnmN9tG2EAqmgPw6hoL7Oza7B+3SCrR9tRftko+Lsf2F/mkTndN2LmzuMcKTuj/mX2+4Va3ki16+nnJY+S7MefpkidxwnV+4wkXH8TKnX0tsYzYp29DOOoSW1nf7nTh2akYiWmcJOuTidSaqESrTYpwjJJNVGQr+rLI7WsqerHW6Kp/oM2pKuV7T1QY9gjqlZp41/WfKpl56FV/0kvXQFRyeQ83xaTu5E8p5dNP3dUF34ihyI3GSpeCsywSh22ZJdWto9winhqifb7VRvgktxp13vyjrS0EjvrRfZ62uyqddSWaWYlwTPAtJZ2oZ3j/Sgi/mi+6vpzesfAcWNA0n8xVyw90GVFGuZjTXEQy+6GfLGLMLL523f5E0OmxVjDoOuRiH91RKU+vtoCtH7TgmvBLvtFXWLW15H9GTdVw8ow4IlRLeHECN9ym1e9K0I+Cbnhgv4Yu+aD2HaQJ80XDqOzSGAV4+4yCqBxrsJAX6ZTIoX36QnvzhhzzMfFW2dZVLOJfo0zbce5OvwXMFaZ81mOnlTVXpDZsQNuoYWveketKb5+6JOOsgX+NTm7H49fUTlx+WLuWL7qxnOFh4BxpmJx0p2gDzA/BUARuS6phR+pUsY7MMboAHx5xNsSVfVZcYSwqCKrqon7zM+8ecCkeS4nm3rINuaWvVNnMRI1IRpxTqx8PZUZ0Br/UEduo3B3hNvmgZfs9gQPj8vIOxd2kndir3awvJ6BLvoUuOfFWNYB0LR1OQJoUySKb9IlOBx74q1+ADC2G6rOdmFdJcD8BkfualA+BdjOOzP9uUhGUEX/TwhZsUduwRr8wNuXKurCixLBgpQI0mDbJr9dIqUuV+92ngkJZ7xduCk2yZKbfWrH1VBiTg9VdzsgRjW3CVXCvAwDd+c1z9dWw9+B+8MJL/eY15ZQ/HqvTwVdsZn5WQsgRRnMaWaecu3jFvMBEmgg+FJFZsnSl0zjB9OqPYaBD7qmoVyImFvzi41usesV0julaAR9dfR15Xzv9sEruRDyk1nb+QaLU67T885GTls6YgcY+UiMa25M/pwGrbCfzkvR3e0jjtuaFtnwuagHTSb5y7boBH119HXhvwP487jJLsLJ4XnUkHX5sLbS61dpiAXRoZSCrFJ+EjpeU3puVfitngYNo6PJrAigKktmwjyQdZpfq30mmtulaAx9Zfx15Xzv+cyeuiBFUs9zq8Kq+XB9a4PVvph3GV4E3y8HENJrN55H1X2p8VyqSKwVusJDKzXOZzplWdzBUFK9e+B4+uv468xvI/b5xtSAkBHQaPvtqWzllVvEOxPbuiE6+j2pvjcKsbvI7txnRErgfH7LdXqjq0IokKzga14GzQ23SSbCQvO6r+Or7SMIr/efOkkqSdMnj9mBx2DRsiY29Uj6+qK9ZrssCKaptR6HKURdwUYeUWA2kPzVKQO8ku2nU3Anhs/XWkBx3F/7wJtCTTTIKftthue1ty9xvNYLY/zo5KSbIuKbXpbEdSyeRyYdAIwKY2neyoc3+k1XUaufYga3T9daMUx/r8z1s10ITknIO0kuoMt+TB8jK0lpayqqjsJ2qtXAYwBU932zinimgmd6mTRDnQfr88q36NAI+tv24E8Pr8zxtasBqx0+xHH9HhlrwsxxNUfKOHQaZBITNf0uccj8GXiVmXAuPEAKSdN/4GLHhs/XWj92dN/uetNuBMnVR+XWDc25JLjo5Mg5IZIq226tmCsip2zZliL213YrTlL2hcFjpCduyim3M7/eB16q/blQsv5X/esDRbtJeabLIosWy3ycavwLhtxdWzbMmHiBTiVjJo6lCLjXZsi7p9PEPnsq6X6wd4bP11i0rD5fzPm/0A6brrIsllenZs0lCJlU4abakR59enZKrKe3BZihbTxlyZ2zl1+g0wvgmA166/bhwDrcn/7Ddz0eWZuJvfSESug6NzZsox3Z04FIxz0mUjMwVOOVTq1CQ0AhdbBGVdjG/CgsfUX7esJl3K/7ytWHRv683praW/8iDOCqWLLhpljDY1ZpzK75QiaZoOTpLKl60auHS/97oBXrv+umU9+FL+5+NtLFgjqVLCdbmj7pY5zPCPLOHNCwXGOcLquOhi8CmCWvbcuO73XmMUPab+ug3A6/A/78Bwe0bcS2+tgHn4J5pyS2WbOck0F51Vq3LcjhLvZ67p1ABbaL2H67bg78BfjKi/jr3+T/ABV3ilLmNXTI2SpvxWBtt6/Z//D0z/FXaGbSBgylzlsEGp+5//xrd4/ae4d8DUUjlslfIYS3t06HZpvfQtvv0N7AHWqtjP2pW08QD/FLy//da38vo8PNlKHf5y37Dxdfe/oj4kVIgFq3koLReSR76W/bx//n9k8jonZxzWTANVwEniDsg87sOSd/z7//PvMp3jQiptGVWFX2caezzAXwfgtzYUvbr0iozs32c3Uge7varH+CNE6cvEYmzbPZ9hMaYDdjK4V2iecf6EcEbdUDVUARda2KzO/JtCuDbNQB/iTeL0EG1JSO1jbXS+nLxtPMDPw1fh5+EPrgSEKE/8Gry5A73ui87AmxwdatyMEBCPNOCSKUeRZ2P6Myb5MRvgCHmA9ywsMifU+AYXcB6Xa5GibUC5TSyerxyh0j6QgLVpdyhfArRTTLqQjwe4HOD9s92D4Ap54odXAPBWLAwB02igG5Kkc+piN4lvODIFGAZgT+EO4Si1s7fjSR7vcQETUkRm9O+MXyo9OYhfe4xt9STQ2pcZRLayCV90b4D3jR0DYAfyxJ+eywg2IL7NTMXna7S/RpQ63JhWEM8U41ZyQGjwsVS0QBrEKLu8xwZsbi4wLcCT+OGidPIOCe1PiSc9Qt+go+vYqB7cG+B9d8cAD+WJPz0Am2gxXgU9IneOqDpAAXOsOltVuMzpdakJXrdPCzXiNVUpCeOos5cxnpQT39G+XVLhs1osQVvJKPZyNq8HDwd4d7pNDuWJPxVX7MSzqUDU6gfadKiNlUFTzLeFHHDlzO4kpa7aiKhBPGKwOqxsBAmYkOIpipyXcQSPlRTf+Tii0U3EJGaZsDER2qoB3h2hu0qe+NNwUooYU8y5mILbJe6OuX+2FTKy7bieTDAemaQyQ0CPthljSWO+xmFDIYiESjM5xKd6Ik5lvLq5GrQ3aCMLvmCA9wowLuWJb9xF59hVVP6O0CrBi3ZjZSNOvRy+I6klNVRJYRBaEzdN+imiUXQ8iVF8fsp+W4JXw7WISW7fDh7lptWkCwZ4d7QTXyBPfJMYK7SijjFppGnlIVJBJBYj7eUwtiP1IBXGI1XCsjNpbjENVpSAJ2hq2LTywEly3hUYazt31J8w2+aiLx3g3fohXixPfOMYm6zCGs9LVo9MoW3MCJE7R5u/WsOIjrqBoHUO0bJE9vxBpbhsd3+Nb4/vtPCZ4oZYCitNeYuC/8UDvDvy0qvkiW/cgqNqRyzqSZa/s0mqNGjtKOoTm14zZpUauiQgVfqtQiZjq7Q27JNaSK5ExRcrGCXO1FJYh6jR6CFqK7bZdQZ4t8g0rSlPfP1RdBtqaa9diqtzJkQ9duSryi2brQXbxDwbRUpFMBHjRj8+Nt7GDKgvph9okW7LX47gu0SpGnnFQ1S1lYldOsC7hYteR574ZuKs7Ei1lBsfdz7IZoxzzCVmmVqaSySzQbBVAWDek+N4jh9E/4VqZrJjPwiv9BC1XcvOWgO8275CVyBPvAtTVlDJfZkaZGU7NpqBogAj/xEHkeAuJihWYCxGN6e8+9JtSegFXF1TrhhLGP1fak3pebgPz192/8gB4d/6WT7+GdYnpH7hH/DJzzFiYPn/vjW0SgNpTNuPIZoAEZv8tlGw4+RLxy+ZjnKa5NdFoC7UaW0aduoYse6+bXg1DLg6UfRYwmhGEjqPvF75U558SANrElK/+MdpXvmqBpaXOa/MTZaa1DOcSiLaw9j0NNNst3c+63c7EKTpkvKHzu6bPbP0RkuHAVcbRY8ijP46MIbQeeT1mhA+5PV/inyDdQipf8LTvMXbwvoDy7IruDNVZKTfV4CTSRUYdybUCnGU7KUTDxLgCknqUm5aAW6/1p6eMsOYsphLzsHrE0Y/P5bQedx1F/4yPHnMB3/IOoTU9+BL8PhtjuFKBpZXnYNJxTuv+2XqolKR2UQgHhS5novuxVySJhBNRF3SoKK1XZbbXjVwWNyOjlqWJjrWJIy+P5bQedyldNScP+HZ61xKSK3jyrz+NiHG1hcOLL/+P+PDF2gOkekKGiNWKgJ+8Z/x8Iv4DdQHzcpZyF4v19I27w9/yPGDFQvmEpKtqv/TLiWMfn4sofMm9eAH8Ao0zzh7h4sJqYtxZd5/D7hkYPneDzl5idlzNHcIB0jVlQ+8ULzw/nc5/ojzl2juE0apD7LRnJxe04dMz2iOCFNtGFpTuXA5AhcTRo8mdN4kz30nVjEC4YTZQy4gpC7GlTlrePKhGsKKgeXpCYeO0MAd/GH7yKQUlXPLOasOH3FnSphjHuDvEu4gB8g66oNbtr6eMbFIA4fIBJkgayoXriw2XEDQPJrQeROAlY6aeYOcMf+IVYTU3XFlZufMHinGywaW3YLpObVBAsbjF4QJMsVUSayjk4voPsHJOQfPWDhCgDnmDl6XIRerD24HsGtw86RMHOLvVSHrKBdeVE26gKB5NKHzaIwLOmrqBWJYZDLhASG16c0Tn+CdRhWDgWXnqRZUTnPIHuMJTfLVpkoYy5CzylHVTGZMTwkGAo2HBlkQplrJX6U+uF1wZz2uwS1SQ12IqWaPuO4baZaEFBdukksJmkcTOm+YJSvoqPFzxFA/YUhIvWxcmSdPWTWwbAKVp6rxTtPFUZfKIwpzm4IoMfaYQLWgmlG5FME2gdBgm+J7J+rtS/XBbaVLsR7bpPQnpMFlo2doWaVceHk9+MkyguZNCJ1He+kuHTWyQAzNM5YSUg/GlTk9ZunAsg1qELVOhUSAK0LABIJHLKbqaEbHZLL1VA3VgqoiOKXYiS+HRyaEKgsfIqX64HYWbLRXy/qWoylIV9gudL1OWBNgBgTNmxA6b4txDT4gi3Ri7xFSLxtXpmmYnzAcWDZgY8d503LFogz5sbonDgkKcxGsWsE1OI+rcQtlgBBCSOKD1mtqYpIU8cTvBmAT0yZe+zUzeY92fYjTtGipXLhuR0ePoHk0ofNWBX+lo8Z7pAZDk8mEw5L7dVyZZoE/pTewbI6SNbiAL5xeygW4xPRuLCGbhcO4RIeTMFYHEJkYyEO9HmJfXMDEj/LaH781wHHZEtqSQ/69UnGpzH7LKIAZEDSPJnTesJTUa+rwTepI9dLJEawYV+ZkRn9g+QirD8vF8Mq0jFQ29js6kCS3E1+jZIhgPNanHdHFqFvPJLHqFwQqbIA4jhDxcNsOCCQLDomaL/dr5lyJaJU6FxPFjO3JOh3kVMcROo8u+C+jo05GjMF3P3/FuDLn5x2M04xXULPwaS6hBYki+MrMdZJSgPHlcB7nCR5bJ9Kr5ACUn9jk5kivdd8tk95SOGrtqu9lr2IhK65ZtEl7ZKrp7DrqwZfRUSN1el7+7NJxZbywOC8neNKTch5vsTEMNsoCCqHBCqIPRjIPkm0BjvFODGtto99rCl+d3wmHkW0FPdpZtC7MMcVtGFQjJLX5bdQ2+x9ypdc313uj8xlsrfuLgWXz1cRhZvJYX0iNVBRcVcmCXZs6aEf3RQF2WI/TcCbKmGU3IOoDJGDdDub0+hYckt6PlGu2BcxmhbTdj/klhccLGJMcqRjMJP1jW2ETqLSWJ/29MAoORluJ+6LPffBZbi5gqi5h6catQpmOT7/OFf5UorRpLzCqcMltBLhwd1are3kztrSzXO0LUbXRQcdLh/RdSZ+swRm819REDrtqzC4es6Gw4JCKlSnjYVpo0xeq33PrADbFLL3RuCmObVmPN+24kfa+AojDuM4umKe2QwCf6EN906HwjujaitDs5o0s1y+k3lgbT2W2i7FJdnwbLXhJUBq/9liTctSmFC/0OqUinb0QddTWamtjbHRFuWJJ6NpqZ8vO3fZJ37Db+2GkaPYLGHs7XTTdiFQJ68SkVJFVmY6McR5UycflNCsccHFaV9FNbR4NttLxw4pQ7wJd066Z0ohVbzihaxHVExd/ay04oxUKWt+AsdiQ9OUyZ2krzN19IZIwafSTFgIBnMV73ADj7V/K8u1MaY2sJp2HWm0f41tqwajEvdHWOJs510MaAqN4aoSiPCXtN2KSi46dUxHdaMquar82O1x5jqhDGvqmoE9LfxcY3zqA7/x3HA67r9ZG4O6Cuxu12/+TP+eLP+I+HErqDDCDVmBDO4larujNe7x8om2rMug0MX0rL1+IWwdwfR+p1TNTyNmVJ85ljWzbWuGv8/C7HD/izjkHNZNYlhZcUOKVzKFUxsxxN/kax+8zPWPSFKw80rJr9Tizyj3o1gEsdwgWGoxPezDdZ1TSENE1dLdNvuKL+I84nxKesZgxXVA1VA1OcL49dFlpFV5yJMhzyCmNQ+a4BqusPJ2bB+xo8V9u3x48VVIEPS/mc3DvAbXyoYr6VgDfh5do5hhHOCXMqBZUPhWYbWZECwVJljLgMUWOCB4MUuMaxGNUQDVI50TQ+S3kFgIcu2qKkNSHVoM0SHsgoZxP2d5HH8B9woOk4x5bPkKtAHucZsdykjxuIpbUrSILgrT8G7G5oCW+K0990o7E3T6AdW4TilH5kDjds+H64kS0mz24grtwlzDHBJqI8YJQExotPvoC4JBq0lEjjQkyBZ8oH2LnRsQ4Hu1QsgDTJbO8fQDnllitkxuVskoiKbRF9VwzMDvxHAdwB7mD9yCplhHFEyUWHx3WtwCbSMMTCUCcEmSGlg4gTXkHpZXWQ7kpznK3EmCHiXInqndkQjunG5kxTKEeGye7jWz9cyMR2mGiFQ15ENRBTbCp+Gh86vAyASdgmJq2MC6hoADQ3GosP0QHbnMHjyBQvQqfhy/BUbeHd5WY/G/9LK/8Ka8Jd7UFeNWEZvzPb458Dn8DGLOe3/wGL/4xP+HXlRt+M1PE2iLhR8t+lfgxsuh7AfO2AOf+owWhSZRYQbd622hbpKWKuU+XuvNzP0OseRDa+mObgDHJUSc/pKx31QdKffQ5OIJpt8GWjlgTwMc/w5MPCR/yl1XC2a2Yut54SvOtMev55Of45BOat9aWG27p2ZVORRvnEk1hqWMVUmqa7S2YtvlIpspuF1pt0syuZS2NV14mUidCSfzQzg+KqvIYCMljIx2YK2AO34fX4GWdu5xcIAb8MzTw+j/lyWM+Dw/gjs4GD6ehNgA48kX/AI7XXM/XAN4WHr+9ntywqoCakCqmKP0rmQrJJEErG2Upg1JObr01lKQy4jskWalKYfJ/EDLMpjNSHFEUAde2fltaDgmrNaWQ9+AAb8I5vKjz3L1n1LriB/BXkG/wwR9y/oRX4LlioHA4LzP2inzRx/DWmutRweFjeP3tNeSGlaE1Fde0OS11yOpmbIp2u/jF1n2RRZviJM0yBT3IZl2HWImKjQOxIyeU325b/qWyU9Moj1o07tS0G7qJDoGHg5m8yeCxMoEH8GU45tnrNM84D2l297DQ9t1YP7jki/7RmutRweEA77/HWXOh3HCxkRgldDQkAjNTMl2Iloc1qN5JfJeeTlyTRzxURTdn1Ixv2uKjs12AbdEWlBtmVdk2k7FFwj07PCZ9XAwW3dG+8xKzNFr4EnwBZpy9Qzhh3jDXebBpYcpuo4fQ44u+fD1dweEnHzI7v0xuuOALRUV8rXpFyfSTQYkhd7IHm07jpyhlkCmI0ALYqPTpUxXS+z4jgDj1Pflvmz5ecuItpIBxyTHpSTGWd9g1ApfD/bvwUhL4nT1EzqgX7cxfCcNmb3mPL/qi9SwTHJ49oj5ZLjccbTG3pRmlYi6JCG0mQrAt1+i2UXTZ2dv9IlQpN5naMYtviaXlTrFpoMsl3bOAFEa8sqPj2WCMrx3Yjx99qFwO59Aw/wgx+HlqNz8oZvA3exRDvuhL1jMQHPaOJ0+XyA3fp1OfM3qObEVdhxjvynxNMXQV4+GJyvOEFqeQBaIbbO7i63rpxCltdZShPFxkjM2FPVkn3TG+Rp9pO3l2RzFegGfxGDHIAh8SteR0C4HopXzRF61nheDw6TFN05Ebvq8M3VKKpGjjO6r7nhudTEGMtYM92HTDaR1FDMXJ1eThsbKfywyoWwrzRSXkc51flG3vIid62h29bIcFbTGhfV+faaB+ohj7dPN0C2e2lC96+XouFByen9AsunLDJZ9z7NExiUc0OuoYW6UZkIyx2YUR2z6/TiRjyKMx5GbbjLHvHuf7YmtKghf34LJfx63Yg8vrvN2zC7lY0x0tvKezo4HmGYDU+Gab6dFL+KI761lDcNifcjLrrr9LWZJctG1FfU1uwhoQE22ObjdfkSzY63CbU5hzs21WeTddH2BaL11Gi7lVdlxP1nkxqhnKhVY6knS3EPgVGg1JpN5cP/hivujOelhXcPj8HC/LyI6MkteVjlolBdMmF3a3DbsuAYhL44dxzthWSN065xxUd55Lmf0wRbOYOqH09/o9WbO2VtFdaMb4qBgtFJoT1SqoN8wPXMoXLb3p1PUEhxfnnLzGzBI0Ku7FxrKsNJj/8bn/H8fPIVOd3rfrklUB/DOeO+nkghgSPzrlPxluCMtOnDL4Yml6dK1r3vsgMxgtPOrMFUZbEUbTdIzii5beq72G4PD0DKnwjmBULUVFmy8t+k7fZ3pKc0Q4UC6jpVRqS9Umv8bxw35flZVOU1X7qkjnhZlsMbk24qQ6Hz7QcuL6sDC0iHHki96Uh2UdvmgZnjIvExy2TeJdMDZNSbdZyAHe/Yd1xsQhHiKzjh7GxQ4yqMPaywPkjMamvqrYpmO7Knad+ZQC5msCuAPWUoxrxVhrGv7a+KLXFhyONdTMrZ7ke23qiO40ZJUyzgYyX5XyL0mV7NiUzEs9mjtbMN0dERqwyAJpigad0B3/zRV7s4PIfXSu6YV/MK7+OrYe/JvfGMn/PHJe2fyUdtnFrKRNpXV0Y2559aWPt/G4BlvjTMtXlVIWCnNyA3YQBDmYIodFz41PvXPSa6rq9lWZawZ4dP115HXV/M/tnFkkrBOdzg6aP4pID+MZnTJ1SuuB6iZlyiox4HT2y3YBtkUKWooacBQUDTpjwaDt5poBHl1/HXltwP887lKKXxNUEyPqpGTyA699UqY/lt9yGdlUKra0fFWS+36iylVWrAyd7Uw0CZM0z7xKTOduznLIjG2Hx8cDPLb+OvK6Bv7n1DYci4CxUuRxrjBc0bb4vD3rN5Zz36ntLb83eVJIB8LiIzCmn6SMPjlX+yNlTjvIGjs+QzHPf60Aj62/jrzG8j9vYMFtm1VoRWCJdmw7z9N0t+c8cxZpPeK4aTRicS25QhrVtUp7U578chk4q04Wx4YoQSjFryUlpcQ1AbxZ/XVMknIU//OGl7Q6z9Zpxi0+3yFhSkjUDpnCIUhLWVX23KQ+L9vKvFKI0ZWFQgkDLvBoylrHNVmaw10zwCPrr5tlodfnf94EWnQ0lFRWy8pW9LbkLsyUVDc2NSTHGDtnD1uMtchjbCeb1mpxFP0YbcClhzdLu6lfO8Bj6q+bdT2sz/+8SZCV7VIxtt0DUn9L7r4cLYWDSXnseEpOGFuty0qbOVlS7NNzs5FOGJUqQpl2Q64/yBpZf90sxbE+//PGdZ02HSipCbmD6NItmQ4Lk5XUrGpDMkhbMm2ZVheNYV+VbUWTcv99+2NyX1VoafSuC+AN6q9bFIMv5X/eagNWXZxEa9JjlMwNWb00akGUkSoepp1/yRuuqHGbUn3UdBSTxBU6SEVklzWRUkPndVvw2PrrpjvxOvzPmwHc0hpmq82npi7GRro8dXp0KXnUQmhZbRL7NEVp1uuZmO45vuzKsHrktS3GLWXODVjw+vXXLYx4Hf7njRPd0i3aoAGX6W29GnaV5YdyDj9TFkakje7GHYzDoObfddHtOSpoi2SmzJHrB3hM/XUDDEbxP2/oosszcRlehWXUvzHv4TpBVktHqwenFo8uLVmy4DKLa5d3RtLrmrM3aMFr1183E4sewf+85VWeg1c5ag276NZrM9IJVNcmLEvDNaV62aq+14IAOGFsBt973Ra8Xv11YzXwNfmft7Jg2oS+XOyoC8/cwzi66Dhmgk38kUmP1CUiYWOX1bpD2zWXt2FCp7uq8703APAa9dfNdscR/M/bZLIyouVxqJfeWvG9Je+JVckHQ9+CI9NWxz+blX/KYYvO5n2tAP/vrlZ7+8/h9y+9qeB/Hnt967e5mevX10rALDWK//FaAT5MXdBXdP0C/BAes792c40H+AiAp1e1oH8HgH94g/Lttx1gp63op1eyoM/Bvw5/G/7xFbqJPcCXnmBiwDPb/YKO4FX4OjyCb289db2/Noqicw4i7N6TVtoz8tNwDH+8x/i6Ae7lmaQVENzJFb3Di/BFeAwz+Is9SjeQySpPqbLFlNmyz47z5a/AF+AYFvDmHqibSXTEzoT4Gc3OALaqAP4KPFUJ6n+1x+rGAM6Zd78bgJ0a8QN4GU614vxwD9e1Amy6CcskNrczLx1JIp6HE5UZD/DBHrFr2oNlgG4Odv226BodoryjGJ9q2T/AR3vQrsOCS0ctXZi3ruLlhpFDJYl4HmYtjQCP9rhdn4suySLKDt6wLcC52h8xPlcjju1fn+yhuw4LZsAGUuo2b4Fx2UwQu77uqRHXGtg92aN3tQCbFexc0uk93vhTXbct6y7MulLycoUljx8ngDMBg1tvJjAazpEmOtxlzclvj1vQf1Tx7QlPDpGpqgtdSKz/d9/hdy1vTfFHSmC9dGDZbLiezz7Ac801HirGZsWjydfZyPvHXL/Y8Mjzg8BxTZiuwKz4Eb8sBE9zznszmjvFwHKPIWUnwhqfVRcd4Ck0K6ate48m1oOfrX3/yOtvAsJ8zsPAM89sjnddmuLuDPjX9Bu/L7x7xpMzFk6nWtyQfPg278Gn4Aekz2ZgOmU9eJ37R14vwE/BL8G3aibCiWMWWDQ0ZtkPMnlcGeAu/Ag+8ZyecU5BPuy2ILD+sQqyZhAKmn7XZd+jIMTN9eBL7x95xVLSX4On8EcNlXDqmBlqS13jG4LpmGbkF/0CnOi3H8ETOIXzmnmtb0a16Tzxj1sUvQCBiXZGDtmB3KAefPH94xcUa/6vwRn80GOFyjEXFpba4A1e8KQfFF+259tx5XS4egYn8fQsLGrqGrHbztr+uByTahWuL1NUGbDpsnrwBfePPwHHIf9X4RnM4Z2ABWdxUBlqQ2PwhuDxoS0vvqB1JzS0P4h2nA/QgTrsJFn+Y3AOjs9JFC07CGWX1oNX3T/yHOzgDjwPn1PM3g9Jk9lZrMEpxnlPmBbjyo2+KFXRU52TJM/2ALcY57RUzjObbjqxVw++4P6RAOf58pcVsw9Daje3htriYrpDOonre3CudSe6bfkTEgHBHuDiyu5MCsc7BHhYDx7ePxLjqigXZsw+ijMHFhuwBmtoTPtOxOrTvYJDnC75dnUbhfwu/ZW9AgYd+peL68HD+0emKquiXHhWjJg/UrkJYzuiaL3E9aI/ytrCvAd4GcYZMCkSQxfUg3v3j8c4e90j5ZTPdvmJJGHnOCI2nHS8081X013pHuBlV1gB2MX1YNmWLHqqGN/TWmG0y6clJWthxNUl48q38Bi8vtMKyzzpFdSDhxZ5WBA5ZLt8Jv3895DduBlgbPYAj8C4B8hO68FDkoh5lydC4FiWvBOVqjYdqjiLv92t8yPDjrDaiHdUD15qkSURSGmXJwOMSxWAXYwr3zaAufJ66l+94vv3AO+vPcD7aw/w/toDvL/2AO+vPcD7aw/wHuD9tQd4f+0B3l97gPfXHuD9tQd4f+0B3l97gG8LwP8G/AL8O/A5OCq0Ys2KIdv/qOIXG/4mvFAMF16gZD+2Xvu/B8as5+8bfllWyg0zaNO5bfXj6vfhhwD86/Aq3NfRS9t9WPnhfnvCIw/CT8GLcFTMnpntdF/z9V+PWc/vWoIH+FL3Znv57PitcdGP4R/C34avw5fgRVUInCwbsn1yyA8C8zm/BH8NXoXnVE6wVPjdeCI38kX/3+Ct9dbz1pTmHFRu+Hm4O9Ch3clr99negxfwj+ER/DR8EV6B5+DuQOnTgUw5rnkY+FbNU3gNXh0o/JYTuWOvyBf9FvzX663HH/HejO8LwAl8Hl5YLTd8q7sqA3wbjuExfAFegQdwfyDoSkWY8swzEf6o4Qyewefg+cHNbqMQruSL/u/WWc+E5g7vnnEXgDmcDeSGb/F4cBcCgT+GGRzDU3hZYburAt9TEtHgbM6JoxJ+6NMzzTcf6c2bycv2+KK/f+l6LBzw5IwfqZJhA3M472pWT/ajKxnjv4AFnMEpnBTPND6s2J7qHbPAqcMK74T2mZ4VGB9uJA465It+/eL1WKhYOD7xHOkr1ajK7d0C4+ke4Hy9qXZwpgLr+Znm/uNFw8xQOSy8H9IzjUrd9+BIfenYaylf9FsXr8fBAadnPIEDna8IBcwlxnuA0/Wv6GAWPd7dDIKjMdSWueAsBj4M7TOd06qBbwDwKr7oleuxMOEcTuEZTHWvDYUO7aHqAe0Bbq+HEFRzOz7WVoTDQkVds7A4sIIxfCQdCefFRoIOF/NFL1mPab/nvOakSL/Q1aFtNpUb/nFOVX6gzyg/1nISyDfUhsokIzaBR9Kxm80s5mK+6P56il1jXic7nhQxsxSm3OwBHl4fFdLqi64nDQZvqE2at7cWAp/IVvrN6/BFL1mPhYrGMBfOi4PyjuSGf6wBBh7p/FZTghCNWGgMzlBbrNJoPJX2mW5mwZfyRffXo7OFi5pZcS4qZUrlViptrXtw+GQoyhDPS+ANjcGBNRiLCQDPZPMHuiZfdFpPSTcQwwKYdRNqpkjm7AFeeT0pJzALgo7g8YYGrMHS0iocy+YTm2vyRUvvpXCIpQ5pe666TJrcygnScUf/p0NDs/iAI/nqDHC8TmQT8x3NF91l76oDdQGwu61Z6E0ABv7uO1dbf/37Zlv+Zw/Pbh8f1s4Avur6657/+YYBvur6657/+YYBvur6657/+YYBvur6657/+aYBvuL6657/+VMA8FXWX/f8zzcN8BXXX/f8zzcNMFdbf93zP38KLPiK6697/uebtuArrr/u+Z9vGmCusP6653/+1FjwVdZf9/zPN7oHX339dc//fNMu+irrr3v+50+Bi+Zq6697/uebA/jz8Pudf9ht/fWv517J/XUzAP8C/BAeX9WCDrUpZ3/dEMBxgPcfbtTVvsYV5Yn32u03B3Ac4P3b8I+vxNBKeeL9dRMAlwO83959qGO78sT769oB7g3w/vGVYFzKE++v6wV4OMD7F7tckFkmT7y/rhHgpQO8b+4Y46XyxPvrugBeNcB7BRiX8sT767oAvmCA9woAHsoT76+rBJjLBnh3txOvkifeX1dswZcO8G6N7sXyxPvr6i340gHe3TnqVfLE++uKAb50gHcXLnrX8sR7gNdPRqwzwLu7Y/FO5Yn3AK9jXCMGeHdgxDuVJ75VAI8ljP7PAb3/RfjcZfePHBB+79dpfpH1CanN30d+mT1h9GqAxxJGM5LQeeQ1+Tb+EQJrElLb38VHQ94TRq900aMIo8cSOo+8Dp8QfsB8zpqE1NO3OI9Zrj1h9EV78PqE0WMJnUdeU6E+Jjyk/hbrEFIfeWbvId8H9oTRFwdZaxJGvziW0Hn0gqYB/wyZ0PwRlxJST+BOw9m77Amj14ii1yGM/txYQudN0qDzGe4EqfA/5GJCagsHcPaEPWH0esekSwmjRxM6b5JEcZ4ww50ilvAOFxBSx4yLW+A/YU8YvfY5+ALC6NGEzhtmyZoFZoarwBLeZxUhtY4rc3bKnjB6TKJjFUHzJoTOozF2YBpsjcyxDgzhQ1YRUse8+J4wenwmaylB82hC5w0zoRXUNXaRBmSMQUqiWSWkLsaVqc/ZE0aPTFUuJWgeTei8SfLZQeMxNaZSIzbII4aE1Nmr13P2hNHjc9E9guYNCZ032YlNwESMLcZiLQHkE4aE1BFg0yAR4z1h9AiAGRA0jyZ03tyIxWMajMPWBIsxYJCnlITU5ShiHYdZ94TR4wCmSxg9jtB5KyPGYzymAYexWEMwAPIsAdYdV6aObmNPGD0aYLoEzaMJnTc0Ygs+YDw0GAtqxBjkuP38bMRWCHn73xNGjz75P73WenCEJnhwyVe3AEe8TtKdJcYhBl97wuhNAObK66lvD/9J9NS75v17wuitAN5fe4D31x7g/bUHeH/tAd5fe4D3AO+vPcD7aw/w/toDvL/2AO+vPcD7aw/w/toDvAd4f/24ABzZ8o+KLsSLS+Pv/TqTb3P4hKlQrTGh+fbIBT0Axqznnb+L/V2mb3HkN5Mb/nEHeK7d4IcDld6lmDW/iH9E+AH1MdOw/Jlu2T1xNmY98sv4wHnD7D3uNHu54WUuOsBTbQuvBsPT/UfzNxGYzwkP8c+Yz3C+r/i6DcyRL/rZ+utRwWH5PmfvcvYEt9jLDS/bg0/B64DWKrQM8AL8FPwS9beQCe6EMKNZYJol37jBMy35otdaz0Bw2H/C2Smc7+WGB0HWDELBmOByA3r5QONo4V+DpzR/hFS4U8wMW1PXNB4TOqYz9urxRV++ntWCw/U59Ty9ebdWbrgfRS9AYKKN63ZokZVygr8GZ/gfIhZXIXPsAlNjPOLBby5c1eOLvmQ9lwkOy5x6QV1j5TYqpS05JtUgUHUp5toHGsVfn4NX4RnMCe+AxTpwmApTYxqMxwfCeJGjpXzRF61nbcHhUBPqWze9svwcHJ+S6NPscKrEjug78Dx8Lj3T8D4YxGIdxmJcwhi34fzZUr7olevZCw5vkOhoClq5zBPZAnygD/Tl9EzDh6kl3VhsHYcDEb+hCtJSvuiV69kLDm+WycrOTArHmB5/VYyP6jOVjwgGawk2zQOaTcc1L+aLXrKeveDwZqlKrw8U9Y1p66uK8dEzdYwBeUQAY7DbyYNezBfdWQ97weEtAKYQg2xJIkuveAT3dYeLGH+ShrWNwZgN0b2YL7qznr3g8JYAo5bQBziPjx7BPZ0d9RCQp4UZbnFdzBddor4XHN4KYMrB2qHFRIzzcLAHQZ5the5ovui94PCWAPefaYnxIdzRwdHCbuR4B+tbiy96Lzi8E4D7z7S0mEPd+eqO3cT53Z0Y8SV80XvB4Z0ADJi/f7X113f+7p7/+UYBvur6657/+YYBvur6657/+aYBvuL6657/+aYBvuL6657/+aYBvuL6657/+aYBvuL6657/+VMA8FXWX/f8z58OgK+y/rrnf75RgLna+uue//lTA/CV1V/3/M837aKvvv6653++UQvmauuve/7nTwfAV1N/3fM/fzr24Cuuv+75nz8FFnxl9dc9//MOr/8/glixwRuUfM4AAAAASUVORK5CYII=';},getSearchTexture:function getSearchTexture(){return'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEIAAAAhCAAAAABIXyLAAAAAOElEQVRIx2NgGAWjYBSMglEwEICREYRgFBZBqDCSLA2MGPUIVQETE9iNUAqLR5gIeoQKRgwXjwAAGn4AtaFeYLEAAAAASUVORK5CYII=';}});/**
  *
  * Supersample Anti-Aliasing Render Pass
  *
  * @author bhouston / http://clara.io/
  *
  * This manual approach to SSAA re-renders the scene ones for each sample with camera jitter and accumulates the results.
  *
  * References: https://en.wikipedia.org/wiki/Supersampling
  *
  */var SSAARenderPass=function SSAARenderPass(scene,camera,clearColor,clearAlpha){Pass.call(this);this.scene=scene;this.camera=camera;this.sampleLevel=4;// specified as n, where the number of samples is 2^n, so sampleLevel = 4, is 2^4 samples, 16.
  this.unbiased=true;// as we need to clear the buffer in this pass, clearColor must be set to something, defaults to black.
  this.clearColor=clearColor!==undefined?clearColor:0x000000;this.clearAlpha=clearAlpha!==undefined?clearAlpha:0;if(CopyShader===undefined){console.error("SSAARenderPass relies on CopyShader");}var copyShader=CopyShader;this.copyUniforms=UniformsUtils.clone(copyShader.uniforms);this.copyMaterial=new ShaderMaterial({uniforms:this.copyUniforms,vertexShader:copyShader.vertexShader,fragmentShader:copyShader.fragmentShader,premultipliedAlpha:true,transparent:true,blending:AdditiveBlending,depthTest:false,depthWrite:false});this.camera2=new OrthographicCamera(-1,1,1,-1,0,1);this.scene2=new Scene();this.quad2=new Mesh(new PlaneGeometry(2,2),this.copyMaterial);this.quad2.frustumCulled=false;// Avoid getting clipped
  this.scene2.add(this.quad2);};SSAARenderPass.prototype=Object.assign(Object.create(Pass.prototype),{constructor:SSAARenderPass,dispose:function dispose(){if(this.sampleRenderTarget){this.sampleRenderTarget.dispose();this.sampleRenderTarget=null;}},setSize:function setSize(width,height){if(this.sampleRenderTarget){this.sampleRenderTarget.setSize(width,height);}},render:function render(renderer,writeBuffer,readBuffer){var this$1=this;if(!this.sampleRenderTarget){this.sampleRenderTarget=new WebGLRenderTarget(readBuffer.width,readBuffer.height,{minFilter:LinearFilter,magFilter:LinearFilter,format:RGBAFormat});this.sampleRenderTarget.texture.name="SSAARenderPass.sample";}var jitterOffsets=SSAARenderPass.JitterVectors[Math.max(0,Math.min(this.sampleLevel,5))];var autoClear=renderer.autoClear;renderer.autoClear=false;var oldClearColor=renderer.getClearColor().getHex();var oldClearAlpha=renderer.getClearAlpha();var baseSampleWeight=1.0/jitterOffsets.length;var roundingRange=1/32;this.copyUniforms["tDiffuse"].value=this.sampleRenderTarget.texture;var width=readBuffer.width,height=readBuffer.height;// render the scene multiple times, each slightly jitter offset from the last and accumulate the results.
  for(var i=0;i<jitterOffsets.length;i++){var jitterOffset=jitterOffsets[i];if(this$1.camera.setViewOffset){this$1.camera.setViewOffset(width,height,jitterOffset[0]*0.0625,jitterOffset[1]*0.0625,// 0.0625 = 1 / 16
  width,height);}var sampleWeight=baseSampleWeight;if(this$1.unbiased){// the theory is that equal weights for each sample lead to an accumulation of rounding errors.
  // The following equation varies the sampleWeight per sample so that it is uniformly distributed
  // across a range of values whose rounding errors cancel each other out.
  var uniformCenteredDistribution=-0.5+(i+0.5)/jitterOffsets.length;sampleWeight+=roundingRange*uniformCenteredDistribution;}this$1.copyUniforms["opacity"].value=sampleWeight;renderer.setClearColor(this$1.clearColor,this$1.clearAlpha);renderer.render(this$1.scene,this$1.camera,this$1.sampleRenderTarget,true);if(i===0){renderer.setClearColor(0x000000,0.0);}renderer.render(this$1.scene2,this$1.camera2,this$1.renderToScreen?null:writeBuffer,i===0);}if(this.camera.clearViewOffset){this.camera.clearViewOffset();}renderer.autoClear=autoClear;renderer.setClearColor(oldClearColor,oldClearAlpha);}});// These jitter vectors are specified in integers because it is easier.
  // I am assuming a [-8,8) integer grid, but it needs to be mapped onto [-0.5,0.5)
  // before being used, thus these integers need to be scaled by 1/16.
  //
  // Sample patterns reference: https://msdn.microsoft.com/en-us/library/windows/desktop/ff476218%28v=vs.85%29.aspx?f=255&MSPPError=-2147217396
  SSAARenderPass.JitterVectors=[[[0,0]],[[4,4],[-4,-4]],[[-2,-6],[6,-2],[-6,2],[2,6]],[[1,-3],[-1,3],[5,1],[-3,-5],[-5,5],[-7,-1],[3,7],[7,-7]],[[1,1],[-1,-3],[-3,2],[4,-1],[-5,-2],[2,5],[5,3],[3,-5],[-2,6],[0,-7],[-4,-6],[-6,4],[-8,0],[7,-4],[6,7],[-7,-8]],[[-4,-7],[-7,-5],[-3,-5],[-5,-4],[-1,-4],[-2,-2],[-6,-1],[-4,0],[-7,1],[-1,2],[-6,3],[-3,3],[-7,6],[-3,6],[-5,7],[-1,7],[5,-7],[1,-6],[6,-5],[4,-4],[2,-3],[7,-2],[1,-1],[4,-1],[2,1],[6,2],[0,4],[4,4],[2,5],[7,5],[5,6],[3,7]]];/**
   * @author alteredq / http://alteredqualia.com/
   *
   * Screen-space ambient occlusion shader
   * - ported from
   *   SSAO GLSL shader v1.2
   *   assembled by Martins Upitis (martinsh) (http://devlog-martinsh.blogspot.com)
   *   original technique is made by ArKano22 (http://www.gamedev.net/topic/550699-ssao-no-halo-artifacts/)
   * - modifications
   * - modified to use RGBA packed depth texture (use clear color 1,1,1,1 for depth pass)
   * - refactoring and optimizations
   */var SSAOShader={uniforms:{"tDiffuse":{value:null},"tDepth":{value:null},"size":{value:new Vector2$1(512,512)},"cameraNear":{value:1},"cameraFar":{value:100},"radius":{value:32},"onlyAO":{value:0},"aoClamp":{value:0.25},"lumInfluence":{value:0.7}},vertexShader:["varying vec2 vUv;","void main() {","vUv = uv;","gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),fragmentShader:["uniform float cameraNear;","uniform float cameraFar;","#ifdef USE_LOGDEPTHBUF","uniform float logDepthBufFC;","#endif","uniform float radius;",// ao radius
  "uniform bool onlyAO;",// use only ambient occlusion pass?
  "uniform vec2 size;",// texture width, height
  "uniform float aoClamp;",// depth clamp - reduces haloing at screen edges
  "uniform float lumInfluence;",// how much luminance affects occlusion
  "uniform sampler2D tDiffuse;","uniform sampler2D tDepth;","varying vec2 vUv;",// "#define PI 3.14159265",
  "#define DL 2.399963229728653",// PI * ( 3.0 - sqrt( 5.0 ) )
  "#define EULER 2.718281828459045",// user variables
  "const int samples = 64;",// ao sample count
  "const bool useNoise = true;",// use noise instead of pattern for sample dithering
  "const float noiseAmount = 0.0004;",// dithering amount
  "const float diffArea = 0.4;",// self-shadowing reduction
  "const float gDisplace = 0.4;",// gauss bell center
  // RGBA depth
  "#include <packing>",// generating noise / pattern texture for dithering
  "vec2 rand( const vec2 coord ) {","vec2 noise;","if ( useNoise ) {","float nx = dot ( coord, vec2( 12.9898, 78.233 ) );","float ny = dot ( coord, vec2( 12.9898, 78.233 ) * 2.0 );","noise = clamp( fract ( 43758.5453 * sin( vec2( nx, ny ) ) ), 0.0, 1.0 );","} else {","float ff = fract( 1.0 - coord.s * ( size.x / 2.0 ) );","float gg = fract( coord.t * ( size.y / 2.0 ) );","noise = vec2( 0.25, 0.75 ) * vec2( ff ) + vec2( 0.75, 0.25 ) * gg;","}","return ( noise * 2.0  - 1.0 ) * noiseAmount;","}","float readDepth( const in vec2 coord ) {","float cameraFarPlusNear = cameraFar + cameraNear;","float cameraFarMinusNear = cameraFar - cameraNear;","float cameraCoef = 2.0 * cameraNear;","#ifdef USE_LOGDEPTHBUF","float logz = unpackRGBAToDepth( texture2D( tDepth, coord ) );","float w = pow(2.0, (logz / logDepthBufFC)) - 1.0;","float z = (logz / w) + 1.0;","#else","float z = unpackRGBAToDepth( texture2D( tDepth, coord ) );","#endif","return cameraCoef / ( cameraFarPlusNear - z * cameraFarMinusNear );","}","float compareDepths( const in float depth1, const in float depth2, inout int far ) {","float garea = 8.0;",// gauss bell width
  "float diff = ( depth1 - depth2 ) * 100.0;",// depth difference (0-100)
  // reduce left bell width to avoid self-shadowing
  "if ( diff < gDisplace ) {","garea = diffArea;","} else {","far = 1;","}","float dd = diff - gDisplace;","float gauss = pow( EULER, -2.0 * ( dd * dd ) / ( garea * garea ) );","return gauss;","}","float calcAO( float depth, float dw, float dh ) {","vec2 vv = vec2( dw, dh );","vec2 coord1 = vUv + radius * vv;","vec2 coord2 = vUv - radius * vv;","float temp1 = 0.0;","float temp2 = 0.0;","int far = 0;","temp1 = compareDepths( depth, readDepth( coord1 ), far );",// DEPTH EXTRAPOLATION
  "if ( far > 0 ) {","temp2 = compareDepths( readDepth( coord2 ), depth, far );","temp1 += ( 1.0 - temp1 ) * temp2;","}","return temp1;","}","void main() {","vec2 noise = rand( vUv );","float depth = readDepth( vUv );","float tt = clamp( depth, aoClamp, 1.0 );","float w = ( 1.0 / size.x ) / tt + ( noise.x * ( 1.0 - noise.x ) );","float h = ( 1.0 / size.y ) / tt + ( noise.y * ( 1.0 - noise.y ) );","float ao = 0.0;","float dz = 1.0 / float( samples );","float l = 0.0;","float z = 1.0 - dz / 2.0;","for ( int i = 0; i <= samples; i ++ ) {","float r = sqrt( 1.0 - z );","float pw = cos( l ) * r;","float ph = sin( l ) * r;","ao += calcAO( depth, pw * w, ph * h );","z = z - dz;","l = l + DL;","}","ao /= float( samples );","ao = 1.0 - ao;","vec3 color = texture2D( tDiffuse, vUv ).rgb;","vec3 lumcoeff = vec3( 0.299, 0.587, 0.114 );","float lum = dot( color.rgb, lumcoeff );","vec3 luminance = vec3( lum );","vec3 final = vec3( color * mix( vec3( ao ), vec3( 1.0 ), luminance * lumInfluence ) );",// mix( color * ao, white, luminance )
  "if ( onlyAO ) {","final = vec3( mix( vec3( ao ), vec3( 1.0 ), luminance * lumInfluence ) );",// ambient occlusion only
  "}","gl_FragColor = vec4( final, 1.0 );","}"].join("\n")};/**
   * Screen-space ambient occlusion pass.
   *
   * Has the following parameters
   *  - radius
   *  	- Ambient occlusion shadow radius (numeric value).
   *  - onlyAO
   *  	- Display only ambient occlusion result (boolean value).
   *  - aoClamp
   *  	- Ambient occlusion clamp (numeric value).
   *  - lumInfluence
   *  	- Pixel luminosity influence in AO calculation (numeric value).
   * 
   * To output to screen set renderToScreens true
   *
   * @author alteredq / http://alteredqualia.com/
   * @author tentone
   * @class SSAOPass
   */var SSAOPass=function SSAOPass(scene,camera,width,height){if(SSAOShader===undefined){console.warn('SSAOPass depends on SSAOShader');return new ShaderPass();}ShaderPass.call(this,SSAOShader);this.width=width!==undefined?width:512;this.height=height!==undefined?height:256;this.renderToScreen=false;this.camera2=camera;this.scene2=scene;//Depth material
  this.depthMaterial=new MeshDepthMaterial();this.depthMaterial.depthPacking=RGBADepthPacking;this.depthMaterial.blending=NoBlending;//Depth render target
  this.depthRenderTarget=new WebGLRenderTarget(this.width,this.height,{minFilter:LinearFilter,magFilter:LinearFilter});//this.depthRenderTarget.texture.name = 'SSAOShader.rt';
  //Shader uniforms
  this.uniforms['tDepth'].value=this.depthRenderTarget.texture;this.uniforms['size'].value.set(this.width,this.height);this.uniforms['cameraNear'].value=this.camera2.near;this.uniforms['cameraFar'].value=this.camera2.far;this.uniforms['radius'].value=4;this.uniforms['onlyAO'].value=false;this.uniforms['aoClamp'].value=0.25;this.uniforms['lumInfluence'].value=0.7;//Setters and getters for uniforms
  Object.defineProperties(this,{radius:{get:function get$$1(){return this.uniforms['radius'].value;},set:function set$$1(value){this.uniforms['radius'].value=value;}},onlyAO:{get:function get$$1(){return this.uniforms['onlyAO'].value;},set:function set$$1(value){this.uniforms['onlyAO'].value=value;}},aoClamp:{get:function get$$1(){return this.uniforms['aoClamp'].value;},set:function set$$1(value){this.uniforms['aoClamp'].value=value;}},lumInfluence:{get:function get$$1(){return this.uniforms['lumInfluence'].value;},set:function set$$1(value){this.uniforms['lumInfluence'].value=value;}}});};SSAOPass.prototype=Object.create(ShaderPass.prototype);/**
   * Render using this pass.
   * 
   * @method render
   * @param {WebGLRenderer} renderer
   * @param {WebGLRenderTarget} writeBuffer Buffer to write output.
   * @param {WebGLRenderTarget} readBuffer Input buffer.
   * @param {Number} delta Delta time in milliseconds.
   * @param {Boolean} maskActive Not used in this pass.
   */SSAOPass.prototype.render=function(renderer,writeBuffer,readBuffer,delta,maskActive){//Render depth into depthRenderTarget
  this.scene2.overrideMaterial=this.depthMaterial;renderer.render(this.scene2,this.camera2,this.depthRenderTarget,true);this.scene2.overrideMaterial=null;//SSAO shaderPass
  ShaderPass.prototype.render.call(this,renderer,writeBuffer,readBuffer,delta,maskActive);};/**
   * Change scene to be renderer by this render pass.
   *
   * @method setScene
   * @param {Scene} scene
   */SSAOPass.prototype.setScene=function(scene){this.scene2=scene;};/**
   * Set camera used by this render pass.
   *
   * @method setCamera
   * @param {Camera} camera
   */SSAOPass.prototype.setCamera=function(camera){this.camera2=camera;this.uniforms['cameraNear'].value=this.camera2.near;this.uniforms['cameraFar'].value=this.camera2.far;};/**
   * Set resolution of this render pass.
   * 
   * @method setSize
   * @param {Number} width
   * @param {Number} height
   */SSAOPass.prototype.setSize=function(width,height){this.width=width;this.height=height;this.uniforms['size'].value.set(this.width,this.height);this.depthRenderTarget.setSize(this.width,this.height);};/**
   *
   * Temporal Anti-Aliasing Render Pass
   *
   * @author bhouston / http://clara.io/
   *
   * When there is no motion in the scene, the TAA render pass accumulates jittered camera samples across frames to create a high quality anti-aliased result.
   *
   * References:
   *
   * TODO: Add support for motion vector pas so that accumulation of samples across frames can occur on dynamics scenes.
   *
   */var TAARenderPass=function TAARenderPass(scene,camera,params){if(SSAARenderPass===undefined){console.error("TAARenderPass relies on SSAARenderPass");}SSAARenderPass.call(this,scene,camera,params);this.sampleLevel=0;this.accumulate=false;};TAARenderPass.JitterVectors=SSAARenderPass.JitterVectors;TAARenderPass.prototype=Object.assign(Object.create(SSAARenderPass.prototype),{constructor:TAARenderPass,render:function render(renderer,writeBuffer,readBuffer,delta){var this$1=this;if(!this.accumulate){SSAARenderPass.prototype.render.call(this,renderer,writeBuffer,readBuffer,delta);this.accumulateIndex=-1;return;}var jitterOffsets=TAARenderPass.JitterVectors[5];if(!this.sampleRenderTarget){this.sampleRenderTarget=new WebGLRenderTarget(readBuffer.width,readBuffer.height,this.params);this.sampleRenderTarget.texture.name="TAARenderPass.sample";}if(!this.holdRenderTarget){this.holdRenderTarget=new WebGLRenderTarget(readBuffer.width,readBuffer.height,this.params);this.holdRenderTarget.texture.name="TAARenderPass.hold";}if(this.accumulate&&this.accumulateIndex===-1){SSAARenderPass.prototype.render.call(this,renderer,this.holdRenderTarget,readBuffer,delta);this.accumulateIndex=0;}var autoClear=renderer.autoClear;renderer.autoClear=false;var sampleWeight=1.0/jitterOffsets.length;if(this.accumulateIndex>=0&&this.accumulateIndex<jitterOffsets.length){this.copyUniforms["opacity"].value=sampleWeight;this.copyUniforms["tDiffuse"].value=writeBuffer.texture;// render the scene multiple times, each slightly jitter offset from the last and accumulate the results.
  var numSamplesPerFrame=Math.pow(2,this.sampleLevel);for(var i=0;i<numSamplesPerFrame;i++){var j=this$1.accumulateIndex;var jitterOffset=jitterOffsets[j];if(this$1.camera.setViewOffset){this$1.camera.setViewOffset(readBuffer.width,readBuffer.height,jitterOffset[0]*0.0625,jitterOffset[1]*0.0625,// 0.0625 = 1 / 16
  readBuffer.width,readBuffer.height);}renderer.render(this$1.scene,this$1.camera,writeBuffer,true);renderer.render(this$1.scene2,this$1.camera2,this$1.sampleRenderTarget,this$1.accumulateIndex===0);this$1.accumulateIndex++;if(this$1.accumulateIndex>=jitterOffsets.length){break;}}if(this.camera.clearViewOffset){this.camera.clearViewOffset();}}var accumulationWeight=this.accumulateIndex*sampleWeight;if(accumulationWeight>0){this.copyUniforms["opacity"].value=1.0;this.copyUniforms["tDiffuse"].value=this.sampleRenderTarget.texture;renderer.render(this.scene2,this.camera2,writeBuffer,true);}if(accumulationWeight<1.0){this.copyUniforms["opacity"].value=1.0-accumulationWeight;this.copyUniforms["tDiffuse"].value=this.holdRenderTarget.texture;renderer.render(this.scene2,this.camera2,writeBuffer,accumulationWeight===0);}renderer.autoClear=autoClear;}});/**
   * @author alteredq / http://alteredqualia.com/
   */var TexturePass=function TexturePass(map,opacity){Pass.call(this);if(CopyShader===undefined){console.error("TexturePass relies on CopyShader");}var shader=CopyShader;this.map=map;this.opacity=opacity!==undefined?opacity:1.0;this.uniforms=UniformsUtils.clone(shader.uniforms);this.material=new ShaderMaterial({uniforms:this.uniforms,vertexShader:shader.vertexShader,fragmentShader:shader.fragmentShader,depthTest:false,depthWrite:false});this.needsSwap=false;this.camera=new OrthographicCamera(-1,1,1,-1,0,1);this.scene=new Scene();this.quad=new Mesh(new PlaneBufferGeometry(2,2),null);this.quad.frustumCulled=false;// Avoid getting clipped
  this.scene.add(this.quad);};TexturePass.prototype=Object.assign(Object.create(Pass.prototype),{constructor:TexturePass,render:function render(renderer,writeBuffer,readBuffer,delta,maskActive){var oldAutoClear=renderer.autoClear;renderer.autoClear=false;this.quad.material=this.material;this.uniforms["opacity"].value=this.opacity;this.uniforms["tDiffuse"].value=this.map;this.material.transparent=this.opacity<1.0;renderer.render(this.scene,this.camera,this.renderToScreen?null:readBuffer,this.clear);renderer.autoClear=oldAutoClear;}});/**
   * @author bhouston / http://clara.io/
   *
   * Luminosity
   * http://en.wikipedia.org/wiki/Luminosity
   */var LuminosityHighPassShader={shaderID:"luminosityHighPass",uniforms:{"tDiffuse":{type:"t",value:null},"luminosityThreshold":{type:"f",value:1.0},"smoothWidth":{type:"f",value:1.0},"defaultColor":{type:"c",value:new Color$1(0x000000)},"defaultOpacity":{type:"f",value:0.0}},vertexShader:["varying vec2 vUv;","void main() {","vUv = uv;","gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),fragmentShader:["uniform sampler2D tDiffuse;","uniform vec3 defaultColor;","uniform float defaultOpacity;","uniform float luminosityThreshold;","uniform float smoothWidth;","varying vec2 vUv;","void main() {","vec4 texel = texture2D( tDiffuse, vUv );","vec3 luma = vec3( 0.299, 0.587, 0.114 );","float v = dot( texel.xyz, luma );","vec4 outputColor = vec4( defaultColor.rgb, defaultOpacity );","float alpha = smoothstep( luminosityThreshold, luminosityThreshold + smoothWidth, v );","gl_FragColor = mix( outputColor, texel, alpha );","}"].join("\n")};/**
   * @author spidersharma / http://eduperiment.com/
   * 
   * Inspired from Unreal Engine
   * https://docs.unrealengine.com/latest/INT/Engine/Rendering/PostProcessEffects/Bloom/
   */var UnrealBloomPass=function UnrealBloomPass(resolution,strength,radius,threshold){var this$1=this;Pass.call(this);this.strength=strength!==undefined?strength:1;this.radius=radius;this.threshold=threshold;this.resolution=resolution!==undefined?new Vector2$1(resolution.x,resolution.y):new Vector2$1(256,256);// render targets
  var pars={minFilter:LinearFilter,magFilter:LinearFilter,format:RGBAFormat};this.renderTargetsHorizontal=[];this.renderTargetsVertical=[];this.nMips=5;var resx=Math.round(this.resolution.x/2);var resy=Math.round(this.resolution.y/2);this.renderTargetBright=new WebGLRenderTarget(resx,resy,pars);this.renderTargetBright.texture.name="UnrealBloomPass.bright";this.renderTargetBright.texture.generateMipmaps=false;for(var i=0;i<this.nMips;i++){var renderTarget=new WebGLRenderTarget(resx,resy,pars);renderTarget.texture.name="UnrealBloomPass.h"+i;renderTarget.texture.generateMipmaps=false;this$1.renderTargetsHorizontal.push(renderTarget);var renderTarget=new WebGLRenderTarget(resx,resy,pars);renderTarget.texture.name="UnrealBloomPass.v"+i;renderTarget.texture.generateMipmaps=false;this$1.renderTargetsVertical.push(renderTarget);resx=Math.round(resx/2);resy=Math.round(resy/2);}// luminosity high pass material
  if(LuminosityHighPassShader===undefined){console.error("UnrealBloomPass relies on LuminosityHighPassShader");}var highPassShader=LuminosityHighPassShader;this.highPassUniforms=UniformsUtils.clone(highPassShader.uniforms);this.highPassUniforms["luminosityThreshold"].value=threshold;this.highPassUniforms["smoothWidth"].value=0.01;this.materialHighPassFilter=new ShaderMaterial({uniforms:this.highPassUniforms,vertexShader:highPassShader.vertexShader,fragmentShader:highPassShader.fragmentShader,defines:{}});// Gaussian Blur Materials
  this.separableBlurMaterials=[];var kernelSizeArray=[3,5,7,9,11];var resx=Math.round(this.resolution.x/2);var resy=Math.round(this.resolution.y/2);for(var i=0;i<this.nMips;i++){this$1.separableBlurMaterials.push(this$1.getSeperableBlurMaterial(kernelSizeArray[i]));this$1.separableBlurMaterials[i].uniforms["texSize"].value=new Vector2$1(resx,resy);resx=Math.round(resx/2);resy=Math.round(resy/2);}// Composite material
  this.compositeMaterial=this.getCompositeMaterial(this.nMips);this.compositeMaterial.uniforms["blurTexture1"].value=this.renderTargetsVertical[0].texture;this.compositeMaterial.uniforms["blurTexture2"].value=this.renderTargetsVertical[1].texture;this.compositeMaterial.uniforms["blurTexture3"].value=this.renderTargetsVertical[2].texture;this.compositeMaterial.uniforms["blurTexture4"].value=this.renderTargetsVertical[3].texture;this.compositeMaterial.uniforms["blurTexture5"].value=this.renderTargetsVertical[4].texture;this.compositeMaterial.uniforms["bloomStrength"].value=strength;this.compositeMaterial.uniforms["bloomRadius"].value=0.1;this.compositeMaterial.needsUpdate=true;var bloomFactors=[1.0,0.8,0.6,0.4,0.2];this.compositeMaterial.uniforms["bloomFactors"].value=bloomFactors;this.bloomTintColors=[new Vector3$1(1,1,1),new Vector3$1(1,1,1),new Vector3$1(1,1,1),new Vector3$1(1,1,1),new Vector3$1(1,1,1)];this.compositeMaterial.uniforms["bloomTintColors"].value=this.bloomTintColors;// copy material
  if(CopyShader===undefined){console.error("BloomPass relies on CopyShader");}var copyShader=CopyShader;this.copyUniforms=UniformsUtils.clone(copyShader.uniforms);this.copyUniforms["opacity"].value=1.0;this.materialCopy=new ShaderMaterial({uniforms:this.copyUniforms,vertexShader:copyShader.vertexShader,fragmentShader:copyShader.fragmentShader,blending:AdditiveBlending,depthTest:false,depthWrite:false,transparent:true});this.enabled=true;this.needsSwap=false;this.oldClearColor=new Color$1();this.oldClearAlpha=1;this.camera=new OrthographicCamera(-1,1,1,-1,0,1);this.scene=new Scene();this.basic=new MeshBasicMaterial();this.quad=new Mesh(new PlaneBufferGeometry(2,2),null);this.quad.frustumCulled=false;// Avoid getting clipped
  this.scene.add(this.quad);};UnrealBloomPass.prototype=Object.assign(Object.create(Pass.prototype),{constructor:UnrealBloomPass,dispose:function dispose(){var this$1=this;for(var i=0;i<this.renderTargetsHorizontal.length;i++){this$1.renderTargetsHorizontal[i].dispose();}for(var i=0;i<this.renderTargetsVertical.length;i++){this$1.renderTargetsVertical[i].dispose();}this.renderTargetBright.dispose();},setSize:function setSize(width,height){var this$1=this;var resx=Math.round(width/2);var resy=Math.round(height/2);this.renderTargetBright.setSize(resx,resy);for(var i=0;i<this.nMips;i++){this$1.renderTargetsHorizontal[i].setSize(resx,resy);this$1.renderTargetsVertical[i].setSize(resx,resy);this$1.separableBlurMaterials[i].uniforms["texSize"].value=new Vector2$1(resx,resy);resx=Math.round(resx/2);resy=Math.round(resy/2);}},render:function render(renderer,writeBuffer,readBuffer,delta,maskActive){var this$1=this;this.oldClearColor.copy(renderer.getClearColor());this.oldClearAlpha=renderer.getClearAlpha();var oldAutoClear=renderer.autoClear;renderer.autoClear=false;renderer.setClearColor(new Color$1(0,0,0),0);if(maskActive){renderer.context.disable(renderer.context.STENCIL_TEST);}// Render input to screen
  if(this.renderToScreen){this.quad.material=this.basic;this.basic.map=readBuffer.texture;renderer.render(this.scene,this.camera,undefined,true);}// 1. Extract Bright Areas
  this.highPassUniforms["tDiffuse"].value=readBuffer.texture;this.highPassUniforms["luminosityThreshold"].value=this.threshold;this.quad.material=this.materialHighPassFilter;renderer.render(this.scene,this.camera,this.renderTargetBright,true);// 2. Blur All the mips progressively
  var inputRenderTarget=this.renderTargetBright;for(var i=0;i<this.nMips;i++){this$1.quad.material=this$1.separableBlurMaterials[i];this$1.separableBlurMaterials[i].uniforms["colorTexture"].value=inputRenderTarget.texture;this$1.separableBlurMaterials[i].uniforms["direction"].value=UnrealBloomPass.BlurDirectionX;renderer.render(this$1.scene,this$1.camera,this$1.renderTargetsHorizontal[i],true);this$1.separableBlurMaterials[i].uniforms["colorTexture"].value=this$1.renderTargetsHorizontal[i].texture;this$1.separableBlurMaterials[i].uniforms["direction"].value=UnrealBloomPass.BlurDirectionY;renderer.render(this$1.scene,this$1.camera,this$1.renderTargetsVertical[i],true);inputRenderTarget=this$1.renderTargetsVertical[i];}// Composite All the mips
  this.quad.material=this.compositeMaterial;this.compositeMaterial.uniforms["bloomStrength"].value=this.strength;this.compositeMaterial.uniforms["bloomRadius"].value=this.radius;this.compositeMaterial.uniforms["bloomTintColors"].value=this.bloomTintColors;renderer.render(this.scene,this.camera,this.renderTargetsHorizontal[0],true);// Blend it additively over the input texture
  this.quad.material=this.materialCopy;this.copyUniforms["tDiffuse"].value=this.renderTargetsHorizontal[0].texture;if(maskActive){renderer.context.enable(renderer.context.STENCIL_TEST);}if(this.renderToScreen){renderer.render(this.scene,this.camera,undefined,false);}else{renderer.render(this.scene,this.camera,readBuffer,false);}// Restore renderer settings
  renderer.setClearColor(this.oldClearColor,this.oldClearAlpha);renderer.autoClear=oldAutoClear;},getSeperableBlurMaterial:function getSeperableBlurMaterial(kernelRadius){return new ShaderMaterial({defines:{"KERNEL_RADIUS":kernelRadius,"SIGMA":kernelRadius},uniforms:{"colorTexture":{value:null},"texSize":{value:new Vector2$1(0.5,0.5)},"direction":{value:new Vector2$1(0.5,0.5)}},vertexShader:"varying vec2 vUv;\n\
				void main() {\n\
					vUv = uv;\n\
					gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n\
				}",fragmentShader:"#include <common>\
				varying vec2 vUv;\n\
				uniform sampler2D colorTexture;\n\
				uniform vec2 texSize;\
				uniform vec2 direction;\
				\
				float gaussianPdf(in float x, in float sigma) {\
					return 0.39894 * exp( -0.5 * x * x/( sigma * sigma))/sigma;\
				}\
				void main() {\n\
					vec2 invSize = 1.0 / texSize;\
					float fSigma = float(SIGMA);\
					float weightSum = gaussianPdf(0.0, fSigma);\
					vec3 diffuseSum = texture2D( colorTexture, vUv).rgb * weightSum;\
					for( int i = 1; i < KERNEL_RADIUS; i ++ ) {\
						float x = float(i);\
						float w = gaussianPdf(x, fSigma);\
						vec2 uvOffset = direction * invSize * x;\
						vec3 sample1 = texture2D( colorTexture, vUv + uvOffset).rgb;\
						vec3 sample2 = texture2D( colorTexture, vUv - uvOffset).rgb;\
						diffuseSum += (sample1 + sample2) * w;\
						weightSum += 2.0 * w;\
					}\
					gl_FragColor = vec4(diffuseSum/weightSum, 1.0);\n\
				}"});},getCompositeMaterial:function getCompositeMaterial(nMips){return new ShaderMaterial({defines:{"NUM_MIPS":nMips},uniforms:{"blurTexture1":{value:null},"blurTexture2":{value:null},"blurTexture3":{value:null},"blurTexture4":{value:null},"blurTexture5":{value:null},"dirtTexture":{value:null},"bloomStrength":{value:1.0},"bloomFactors":{value:null},"bloomTintColors":{value:null},"bloomRadius":{value:0.0}},vertexShader:"varying vec2 vUv;\n\
				void main() {\n\
					vUv = uv;\n\
					gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n\
				}",fragmentShader:"varying vec2 vUv;\
				uniform sampler2D blurTexture1;\
				uniform sampler2D blurTexture2;\
				uniform sampler2D blurTexture3;\
				uniform sampler2D blurTexture4;\
				uniform sampler2D blurTexture5;\
				uniform sampler2D dirtTexture;\
				uniform float bloomStrength;\
				uniform float bloomRadius;\
				uniform float bloomFactors[NUM_MIPS];\
				uniform vec3 bloomTintColors[NUM_MIPS];\
				\
				float lerpBloomFactor(const in float factor) { \
					float mirrorFactor = 1.2 - factor;\
					return mix(factor, mirrorFactor, bloomRadius);\
				}\
				\
				void main() {\
					gl_FragColor = bloomStrength * ( lerpBloomFactor(bloomFactors[0]) * vec4(bloomTintColors[0], 1.0) * texture2D(blurTexture1, vUv) + \
													 lerpBloomFactor(bloomFactors[1]) * vec4(bloomTintColors[1], 1.0) * texture2D(blurTexture2, vUv) + \
													 lerpBloomFactor(bloomFactors[2]) * vec4(bloomTintColors[2], 1.0) * texture2D(blurTexture3, vUv) + \
													 lerpBloomFactor(bloomFactors[3]) * vec4(bloomTintColors[3], 1.0) * texture2D(blurTexture4, vUv) + \
													 lerpBloomFactor(bloomFactors[4]) * vec4(bloomTintColors[4], 1.0) * texture2D(blurTexture5, vUv) );\
				}"});}});UnrealBloomPass.BlurDirectionX=new Vector2$1(1.0,0.0);UnrealBloomPass.BlurDirectionY=new Vector2$1(0.0,1.0);// Park-Miller-Carta Pseudo-Random Number Generator
  function AudioAnalyser(audio,fftSize){this.analyser=audio.context.createAnalyser();this.analyser.fftSize=fftSize!==undefined?fftSize:2048;this.data=new Uint8Array(this.analyser.frequencyBinCount);audio.getOutput().connect(this.analyser);}Object.assign(AudioAnalyser.prototype,{getFrequencyData:function getFrequencyData(){this.analyser.getByteFrequencyData(this.data);return this.data;},getAverageFrequency:function getAverageFrequency(){var value=0,data=this.getFrequencyData();for(var i=0;i<data.length;i++){value+=data[i];}return value/data.length;}});/**
   * @author mrdoob / http://mrdoob.com/
   */function Uniform(value){if(typeof value==='string'){console.warn('THREE.Uniform: Type parameter is no longer needed.');value=arguments[1];}this.value=value;}Uniform.prototype.clone=function(){return new Uniform(this.value.clone===undefined?this.value:this.value.clone());};function EllipseCurve(aX,aY,xRadius,yRadius,aStartAngle,aEndAngle,aClockwise,aRotation){Curve.call(this);this.type='EllipseCurve';this.aX=aX||0;this.aY=aY||0;this.xRadius=xRadius||1;this.yRadius=yRadius||1;this.aStartAngle=aStartAngle||0;this.aEndAngle=aEndAngle||2*Math.PI;this.aClockwise=aClockwise||false;this.aRotation=aRotation||0;}EllipseCurve.prototype=Object.create(Curve.prototype);EllipseCurve.prototype.constructor=EllipseCurve;EllipseCurve.prototype.isEllipseCurve=true;EllipseCurve.prototype.getPoint=function(t,optionalTarget){var point=optionalTarget||new Vector2$1();var twoPi=Math.PI*2;var deltaAngle=this.aEndAngle-this.aStartAngle;var samePoints=Math.abs(deltaAngle)<Number.EPSILON;// ensures that deltaAngle is 0 .. 2 PI
  while(deltaAngle<0){deltaAngle+=twoPi;}while(deltaAngle>twoPi){deltaAngle-=twoPi;}if(deltaAngle<Number.EPSILON){if(samePoints){deltaAngle=0;}else{deltaAngle=twoPi;}}if(this.aClockwise===true&&!samePoints){if(deltaAngle===twoPi){deltaAngle=-twoPi;}else{deltaAngle=deltaAngle-twoPi;}}var angle=this.aStartAngle+t*deltaAngle;var x=this.aX+this.xRadius*Math.cos(angle);var y=this.aY+this.yRadius*Math.sin(angle);if(this.aRotation!==0){var cos=Math.cos(this.aRotation);var sin=Math.sin(this.aRotation);var tx=x-this.aX;var ty=y-this.aY;// Rotate the point about the center of the ellipse.
  x=tx*cos-ty*sin+this.aX;y=tx*sin+ty*cos+this.aY;}return point.set(x,y);};EllipseCurve.prototype.copy=function(source){Curve.prototype.copy.call(this,source);this.aX=source.aX;this.aY=source.aY;this.xRadius=source.xRadius;this.yRadius=source.yRadius;this.aStartAngle=source.aStartAngle;this.aEndAngle=source.aEndAngle;this.aClockwise=source.aClockwise;this.aRotation=source.aRotation;return this;};EllipseCurve.prototype.toJSON=function(){var data=Curve.prototype.toJSON.call(this);data.aX=this.aX;data.aY=this.aY;data.xRadius=this.xRadius;data.yRadius=this.yRadius;data.aStartAngle=this.aStartAngle;data.aEndAngle=this.aEndAngle;data.aClockwise=this.aClockwise;data.aRotation=this.aRotation;return data;};EllipseCurve.prototype.fromJSON=function(json){Curve.prototype.fromJSON.call(this,json);this.aX=json.aX;this.aY=json.aY;this.xRadius=json.xRadius;this.yRadius=json.yRadius;this.aStartAngle=json.aStartAngle;this.aEndAngle=json.aEndAngle;this.aClockwise=json.aClockwise;this.aRotation=json.aRotation;return this;};function ArcCurve(aX,aY,aRadius,aStartAngle,aEndAngle,aClockwise){EllipseCurve.call(this,aX,aY,aRadius,aRadius,aStartAngle,aEndAngle,aClockwise);this.type='ArcCurve';}ArcCurve.prototype=Object.create(EllipseCurve.prototype);ArcCurve.prototype.constructor=ArcCurve;ArcCurve.prototype.isArcCurve=true;/**
   * @author zz85 https://github.com/zz85
   *
   * Centripetal CatmullRom Curve - which is useful for avoiding
   * cusps and self-intersections in non-uniform catmull rom curves.
   * http://www.cemyuksel.com/research/catmullrom_param/catmullrom.pdf
   *
   * curve.type accepts centripetal(default), chordal and catmullrom
   * curve.tension is used for catmullrom which defaults to 0.5
   *//*
  Based on an optimized c++ solution in
   - http://stackoverflow.com/questions/9489736/catmull-rom-curve-with-no-cusps-and-no-self-intersections/
   - http://ideone.com/NoEbVM

  This CubicPoly class could be used for reusing some variables and calculations,
  but for three.js curve use, it could be possible inlined and flatten into a single function call
  which can be placed in CurveUtils.
  */function CubicPoly(){var c0=0,c1=0,c2=0,c3=0;/*
  	 * Compute coefficients for a cubic polynomial
  	 *   p(s) = c0 + c1*s + c2*s^2 + c3*s^3
  	 * such that
  	 *   p(0) = x0, p(1) = x1
  	 *  and
  	 *   p'(0) = t0, p'(1) = t1.
  	 */function init(x0,x1,t0,t1){c0=x0;c1=t0;c2=-3*x0+3*x1-2*t0-t1;c3=2*x0-2*x1+t0+t1;}return{initCatmullRom:function initCatmullRom(x0,x1,x2,x3,tension){init(x1,x2,tension*(x2-x0),tension*(x3-x1));},initNonuniformCatmullRom:function initNonuniformCatmullRom(x0,x1,x2,x3,dt0,dt1,dt2){// compute tangents when parameterized in [t1,t2]
  var t1=(x1-x0)/dt0-(x2-x0)/(dt0+dt1)+(x2-x1)/dt1;var t2=(x2-x1)/dt1-(x3-x1)/(dt1+dt2)+(x3-x2)/dt2;// rescale tangents for parametrization in [0,1]
  t1*=dt1;t2*=dt1;init(x1,x2,t1,t2);},calc:function calc(t){var t2=t*t;var t3=t2*t;return c0+c1*t+c2*t2+c3*t3;}};}//
  var tmp=new Vector3$1();var px=new CubicPoly();var py=new CubicPoly();var pz=new CubicPoly();function CatmullRomCurve3$1(points,closed,curveType,tension){Curve.call(this);this.type='CatmullRomCurve3';this.points=points||[];this.closed=closed||false;this.curveType=curveType||'centripetal';this.tension=tension||0.5;}CatmullRomCurve3$1.prototype=Object.create(Curve.prototype);CatmullRomCurve3$1.prototype.constructor=CatmullRomCurve3$1;CatmullRomCurve3$1.prototype.isCatmullRomCurve3=true;CatmullRomCurve3$1.prototype.getPoint=function(t,optionalTarget){var point=optionalTarget||new Vector3$1();var points=this.points;var l=points.length;var p=(l-(this.closed?0:1))*t;var intPoint=Math.floor(p);var weight=p-intPoint;if(this.closed){intPoint+=intPoint>0?0:(Math.floor(Math.abs(intPoint)/points.length)+1)*points.length;}else if(weight===0&&intPoint===l-1){intPoint=l-2;weight=1;}var p0,p1,p2,p3;// 4 points
  if(this.closed||intPoint>0){p0=points[(intPoint-1)%l];}else{// extrapolate first point
  tmp.subVectors(points[0],points[1]).add(points[0]);p0=tmp;}p1=points[intPoint%l];p2=points[(intPoint+1)%l];if(this.closed||intPoint+2<l){p3=points[(intPoint+2)%l];}else{// extrapolate last point
  tmp.subVectors(points[l-1],points[l-2]).add(points[l-1]);p3=tmp;}if(this.curveType==='centripetal'||this.curveType==='chordal'){// init Centripetal / Chordal Catmull-Rom
  var pow=this.curveType==='chordal'?0.5:0.25;var dt0=Math.pow(p0.distanceToSquared(p1),pow);var dt1=Math.pow(p1.distanceToSquared(p2),pow);var dt2=Math.pow(p2.distanceToSquared(p3),pow);// safety check for repeated points
  if(dt1<1e-4){dt1=1.0;}if(dt0<1e-4){dt0=dt1;}if(dt2<1e-4){dt2=dt1;}px.initNonuniformCatmullRom(p0.x,p1.x,p2.x,p3.x,dt0,dt1,dt2);py.initNonuniformCatmullRom(p0.y,p1.y,p2.y,p3.y,dt0,dt1,dt2);pz.initNonuniformCatmullRom(p0.z,p1.z,p2.z,p3.z,dt0,dt1,dt2);}else if(this.curveType==='catmullrom'){px.initCatmullRom(p0.x,p1.x,p2.x,p3.x,this.tension);py.initCatmullRom(p0.y,p1.y,p2.y,p3.y,this.tension);pz.initCatmullRom(p0.z,p1.z,p2.z,p3.z,this.tension);}point.set(px.calc(weight),py.calc(weight),pz.calc(weight));return point;};CatmullRomCurve3$1.prototype.copy=function(source){var this$1=this;Curve.prototype.copy.call(this,source);this.points=[];for(var i=0,l=source.points.length;i<l;i++){var point=source.points[i];this$1.points.push(point.clone());}this.closed=source.closed;this.curveType=source.curveType;this.tension=source.tension;return this;};CatmullRomCurve3$1.prototype.toJSON=function(){var this$1=this;var data=Curve.prototype.toJSON.call(this);data.points=[];for(var i=0,l=this.points.length;i<l;i++){var point=this$1.points[i];data.points.push(point.toArray());}data.closed=this.closed;data.curveType=this.curveType;data.tension=this.tension;return data;};CatmullRomCurve3$1.prototype.fromJSON=function(json){var this$1=this;Curve.prototype.fromJSON.call(this,json);this.points=[];for(var i=0,l=json.points.length;i<l;i++){var point=json.points[i];this$1.points.push(new Vector3$1().fromArray(point));}this.closed=json.closed;this.curveType=json.curveType;this.tension=json.tension;return this;};/**
   * @author zz85 / http://www.lab4games.net/zz85/blog
   *
   * Bezier Curves formulas obtained from
   * http://en.wikipedia.org/wiki/Bézier_curve
   */function CatmullRom(t,p0,p1,p2,p3){var v0=(p2-p0)*0.5;var v1=(p3-p1)*0.5;var t2=t*t;var t3=t*t2;return(2*p1-2*p2+v0+v1)*t3+(-3*p1+3*p2-2*v0-v1)*t2+v0*t+p1;}//
  function QuadraticBezierP0(t,p){var k=1-t;return k*k*p;}function QuadraticBezierP1(t,p){return 2*(1-t)*t*p;}function QuadraticBezierP2(t,p){return t*t*p;}function QuadraticBezier(t,p0,p1,p2){return QuadraticBezierP0(t,p0)+QuadraticBezierP1(t,p1)+QuadraticBezierP2(t,p2);}//
  function CubicBezierP0(t,p){var k=1-t;return k*k*k*p;}function CubicBezierP1(t,p){var k=1-t;return 3*k*k*t*p;}function CubicBezierP2(t,p){return 3*(1-t)*t*t*p;}function CubicBezierP3(t,p){return t*t*t*p;}function CubicBezier(t,p0,p1,p2,p3){return CubicBezierP0(t,p0)+CubicBezierP1(t,p1)+CubicBezierP2(t,p2)+CubicBezierP3(t,p3);}function CubicBezierCurve(v0,v1,v2,v3){Curve.call(this);this.type='CubicBezierCurve';this.v0=v0||new Vector2$1();this.v1=v1||new Vector2$1();this.v2=v2||new Vector2$1();this.v3=v3||new Vector2$1();}CubicBezierCurve.prototype=Object.create(Curve.prototype);CubicBezierCurve.prototype.constructor=CubicBezierCurve;CubicBezierCurve.prototype.isCubicBezierCurve=true;CubicBezierCurve.prototype.getPoint=function(t,optionalTarget){var point=optionalTarget||new Vector2$1();var v0=this.v0,v1=this.v1,v2=this.v2,v3=this.v3;point.set(CubicBezier(t,v0.x,v1.x,v2.x,v3.x),CubicBezier(t,v0.y,v1.y,v2.y,v3.y));return point;};CubicBezierCurve.prototype.copy=function(source){Curve.prototype.copy.call(this,source);this.v0.copy(source.v0);this.v1.copy(source.v1);this.v2.copy(source.v2);this.v3.copy(source.v3);return this;};CubicBezierCurve.prototype.toJSON=function(){var data=Curve.prototype.toJSON.call(this);data.v0=this.v0.toArray();data.v1=this.v1.toArray();data.v2=this.v2.toArray();data.v3=this.v3.toArray();return data;};CubicBezierCurve.prototype.fromJSON=function(json){Curve.prototype.fromJSON.call(this,json);this.v0.fromArray(json.v0);this.v1.fromArray(json.v1);this.v2.fromArray(json.v2);this.v3.fromArray(json.v3);return this;};function CubicBezierCurve3(v0,v1,v2,v3){Curve.call(this);this.type='CubicBezierCurve3';this.v0=v0||new Vector3$1();this.v1=v1||new Vector3$1();this.v2=v2||new Vector3$1();this.v3=v3||new Vector3$1();}CubicBezierCurve3.prototype=Object.create(Curve.prototype);CubicBezierCurve3.prototype.constructor=CubicBezierCurve3;CubicBezierCurve3.prototype.isCubicBezierCurve3=true;CubicBezierCurve3.prototype.getPoint=function(t,optionalTarget){var point=optionalTarget||new Vector3$1();var v0=this.v0,v1=this.v1,v2=this.v2,v3=this.v3;point.set(CubicBezier(t,v0.x,v1.x,v2.x,v3.x),CubicBezier(t,v0.y,v1.y,v2.y,v3.y),CubicBezier(t,v0.z,v1.z,v2.z,v3.z));return point;};CubicBezierCurve3.prototype.copy=function(source){Curve.prototype.copy.call(this,source);this.v0.copy(source.v0);this.v1.copy(source.v1);this.v2.copy(source.v2);this.v3.copy(source.v3);return this;};CubicBezierCurve3.prototype.toJSON=function(){var data=Curve.prototype.toJSON.call(this);data.v0=this.v0.toArray();data.v1=this.v1.toArray();data.v2=this.v2.toArray();data.v3=this.v3.toArray();return data;};CubicBezierCurve3.prototype.fromJSON=function(json){Curve.prototype.fromJSON.call(this,json);this.v0.fromArray(json.v0);this.v1.fromArray(json.v1);this.v2.fromArray(json.v2);this.v3.fromArray(json.v3);return this;};function LineCurve(v1,v2){Curve.call(this);this.type='LineCurve';this.v1=v1||new Vector2$1();this.v2=v2||new Vector2$1();}LineCurve.prototype=Object.create(Curve.prototype);LineCurve.prototype.constructor=LineCurve;LineCurve.prototype.isLineCurve=true;LineCurve.prototype.getPoint=function(t,optionalTarget){var point=optionalTarget||new Vector2$1();if(t===1){point.copy(this.v2);}else{point.copy(this.v2).sub(this.v1);point.multiplyScalar(t).add(this.v1);}return point;};// Line curve is linear, so we can overwrite default getPointAt
  LineCurve.prototype.getPointAt=function(u,optionalTarget){return this.getPoint(u,optionalTarget);};LineCurve.prototype.getTangent=function()/* t */{var tangent=this.v2.clone().sub(this.v1);return tangent.normalize();};LineCurve.prototype.copy=function(source){Curve.prototype.copy.call(this,source);this.v1.copy(source.v1);this.v2.copy(source.v2);return this;};LineCurve.prototype.toJSON=function(){var data=Curve.prototype.toJSON.call(this);data.v1=this.v1.toArray();data.v2=this.v2.toArray();return data;};LineCurve.prototype.fromJSON=function(json){Curve.prototype.fromJSON.call(this,json);this.v1.fromArray(json.v1);this.v2.fromArray(json.v2);return this;};function LineCurve3(v1,v2){Curve.call(this);this.type='LineCurve3';this.v1=v1||new Vector3$1();this.v2=v2||new Vector3$1();}LineCurve3.prototype=Object.create(Curve.prototype);LineCurve3.prototype.constructor=LineCurve3;LineCurve3.prototype.isLineCurve3=true;LineCurve3.prototype.getPoint=function(t,optionalTarget){var point=optionalTarget||new Vector3$1();if(t===1){point.copy(this.v2);}else{point.copy(this.v2).sub(this.v1);point.multiplyScalar(t).add(this.v1);}return point;};// Line curve is linear, so we can overwrite default getPointAt
  LineCurve3.prototype.getPointAt=function(u,optionalTarget){return this.getPoint(u,optionalTarget);};LineCurve3.prototype.copy=function(source){Curve.prototype.copy.call(this,source);this.v1.copy(source.v1);this.v2.copy(source.v2);return this;};LineCurve3.prototype.toJSON=function(){var data=Curve.prototype.toJSON.call(this);data.v1=this.v1.toArray();data.v2=this.v2.toArray();return data;};LineCurve3.prototype.fromJSON=function(json){Curve.prototype.fromJSON.call(this,json);this.v1.fromArray(json.v1);this.v2.fromArray(json.v2);return this;};function QuadraticBezierCurve(v0,v1,v2){Curve.call(this);this.type='QuadraticBezierCurve';this.v0=v0||new Vector2$1();this.v1=v1||new Vector2$1();this.v2=v2||new Vector2$1();}QuadraticBezierCurve.prototype=Object.create(Curve.prototype);QuadraticBezierCurve.prototype.constructor=QuadraticBezierCurve;QuadraticBezierCurve.prototype.isQuadraticBezierCurve=true;QuadraticBezierCurve.prototype.getPoint=function(t,optionalTarget){var point=optionalTarget||new Vector2$1();var v0=this.v0,v1=this.v1,v2=this.v2;point.set(QuadraticBezier(t,v0.x,v1.x,v2.x),QuadraticBezier(t,v0.y,v1.y,v2.y));return point;};QuadraticBezierCurve.prototype.copy=function(source){Curve.prototype.copy.call(this,source);this.v0.copy(source.v0);this.v1.copy(source.v1);this.v2.copy(source.v2);return this;};QuadraticBezierCurve.prototype.toJSON=function(){var data=Curve.prototype.toJSON.call(this);data.v0=this.v0.toArray();data.v1=this.v1.toArray();data.v2=this.v2.toArray();return data;};QuadraticBezierCurve.prototype.fromJSON=function(json){Curve.prototype.fromJSON.call(this,json);this.v0.fromArray(json.v0);this.v1.fromArray(json.v1);this.v2.fromArray(json.v2);return this;};function QuadraticBezierCurve3(v0,v1,v2){Curve.call(this);this.type='QuadraticBezierCurve3';this.v0=v0||new Vector3$1();this.v1=v1||new Vector3$1();this.v2=v2||new Vector3$1();}QuadraticBezierCurve3.prototype=Object.create(Curve.prototype);QuadraticBezierCurve3.prototype.constructor=QuadraticBezierCurve3;QuadraticBezierCurve3.prototype.isQuadraticBezierCurve3=true;QuadraticBezierCurve3.prototype.getPoint=function(t,optionalTarget){var point=optionalTarget||new Vector3$1();var v0=this.v0,v1=this.v1,v2=this.v2;point.set(QuadraticBezier(t,v0.x,v1.x,v2.x),QuadraticBezier(t,v0.y,v1.y,v2.y),QuadraticBezier(t,v0.z,v1.z,v2.z));return point;};QuadraticBezierCurve3.prototype.copy=function(source){Curve.prototype.copy.call(this,source);this.v0.copy(source.v0);this.v1.copy(source.v1);this.v2.copy(source.v2);return this;};QuadraticBezierCurve3.prototype.toJSON=function(){var data=Curve.prototype.toJSON.call(this);data.v0=this.v0.toArray();data.v1=this.v1.toArray();data.v2=this.v2.toArray();return data;};QuadraticBezierCurve3.prototype.fromJSON=function(json){Curve.prototype.fromJSON.call(this,json);this.v0.fromArray(json.v0);this.v1.fromArray(json.v1);this.v2.fromArray(json.v2);return this;};function SplineCurve(points/* array of Vector2 */){Curve.call(this);this.type='SplineCurve';this.points=points||[];}SplineCurve.prototype=Object.create(Curve.prototype);SplineCurve.prototype.constructor=SplineCurve;SplineCurve.prototype.isSplineCurve=true;SplineCurve.prototype.getPoint=function(t,optionalTarget){var point=optionalTarget||new Vector2$1();var points=this.points;var p=(points.length-1)*t;var intPoint=Math.floor(p);var weight=p-intPoint;var p0=points[intPoint===0?intPoint:intPoint-1];var p1=points[intPoint];var p2=points[intPoint>points.length-2?points.length-1:intPoint+1];var p3=points[intPoint>points.length-3?points.length-1:intPoint+2];point.set(CatmullRom(weight,p0.x,p1.x,p2.x,p3.x),CatmullRom(weight,p0.y,p1.y,p2.y,p3.y));return point;};SplineCurve.prototype.copy=function(source){var this$1=this;Curve.prototype.copy.call(this,source);this.points=[];for(var i=0,l=source.points.length;i<l;i++){var point=source.points[i];this$1.points.push(point.clone());}return this;};SplineCurve.prototype.toJSON=function(){var this$1=this;var data=Curve.prototype.toJSON.call(this);data.points=[];for(var i=0,l=this.points.length;i<l;i++){var point=this$1.points[i];data.points.push(point.toArray());}return data;};SplineCurve.prototype.fromJSON=function(json){var this$1=this;Curve.prototype.fromJSON.call(this,json);this.points=[];for(var i=0,l=json.points.length;i<l;i++){var point=json.points[i];this$1.points.push(new Vector2$1().fromArray(point));}return this;};var Curves=Object.freeze({ArcCurve:ArcCurve,CatmullRomCurve3:CatmullRomCurve3$1,CubicBezierCurve:CubicBezierCurve,CubicBezierCurve3:CubicBezierCurve3,EllipseCurve:EllipseCurve,LineCurve:LineCurve,LineCurve3:LineCurve3,QuadraticBezierCurve:QuadraticBezierCurve,QuadraticBezierCurve3:QuadraticBezierCurve3,SplineCurve:SplineCurve});/**
   * @author zz85 / http://www.lab4games.net/zz85/blog
   *
   **//**************************************************************
   *	Curved Path - a curve path is simply a array of connected
   *  curves, but retains the api of a curve
   **************************************************************/function CurvePath(){Curve.call(this);this.type='CurvePath';this.curves=[];this.autoClose=false;// Automatically closes the path
  }CurvePath.prototype=Object.assign(Object.create(Curve.prototype),{constructor:CurvePath,add:function add(curve){this.curves.push(curve);},closePath:function closePath(){// Add a line curve if start and end of lines are not connected
  var startPoint=this.curves[0].getPoint(0);var endPoint=this.curves[this.curves.length-1].getPoint(1);if(!startPoint.equals(endPoint)){this.curves.push(new LineCurve(endPoint,startPoint));}},// To get accurate point with reference to
  // entire path distance at time t,
  // following has to be done:
  // 1. Length of each sub path have to be known
  // 2. Locate and identify type of curve
  // 3. Get t for the curve
  // 4. Return curve.getPointAt(t')
  getPoint:function getPoint(t){var this$1=this;var d=t*this.getLength();var curveLengths=this.getCurveLengths();var i=0;// To think about boundaries points.
  while(i<curveLengths.length){if(curveLengths[i]>=d){var diff=curveLengths[i]-d;var curve=this$1.curves[i];var segmentLength=curve.getLength();var u=segmentLength===0?0:1-diff/segmentLength;return curve.getPointAt(u);}i++;}return null;// loop where sum != 0, sum > d , sum+1 <d
  },// We cannot use the default THREE.Curve getPoint() with getLength() because in
  // THREE.Curve, getLength() depends on getPoint() but in THREE.CurvePath
  // getPoint() depends on getLength
  getLength:function getLength(){var lens=this.getCurveLengths();return lens[lens.length-1];},// cacheLengths must be recalculated.
  updateArcLengths:function updateArcLengths(){this.needsUpdate=true;this.cacheLengths=null;this.getCurveLengths();},// Compute lengths and cache them
  // We cannot overwrite getLengths() because UtoT mapping uses it.
  getCurveLengths:function getCurveLengths(){var this$1=this;// We use cache values if curves and cache array are same length
  if(this.cacheLengths&&this.cacheLengths.length===this.curves.length){return this.cacheLengths;}// Get length of sub-curve
  // Push sums into cached array
  var lengths=[],sums=0;for(var i=0,l=this.curves.length;i<l;i++){sums+=this$1.curves[i].getLength();lengths.push(sums);}this.cacheLengths=lengths;return lengths;},getSpacedPoints:function getSpacedPoints(divisions){var this$1=this;if(divisions===undefined){divisions=40;}var points=[];for(var i=0;i<=divisions;i++){points.push(this$1.getPoint(i/divisions));}if(this.autoClose){points.push(points[0]);}return points;},getPoints:function getPoints(divisions){divisions=divisions||12;var points=[],last;for(var i=0,curves=this.curves;i<curves.length;i++){var curve=curves[i];var resolution=curve&&curve.isEllipseCurve?divisions*2:curve&&curve.isLineCurve?1:curve&&curve.isSplineCurve?divisions*curve.points.length:divisions;var pts=curve.getPoints(resolution);for(var j=0;j<pts.length;j++){var point=pts[j];if(last&&last.equals(point)){continue;}// ensures no consecutive points are duplicates
  points.push(point);last=point;}}if(this.autoClose&&points.length>1&&!points[points.length-1].equals(points[0])){points.push(points[0]);}return points;},copy:function copy(source){var this$1=this;Curve.prototype.copy.call(this,source);this.curves=[];for(var i=0,l=source.curves.length;i<l;i++){var curve=source.curves[i];this$1.curves.push(curve.clone());}this.autoClose=source.autoClose;return this;},toJSON:function toJSON(){var this$1=this;var data=Curve.prototype.toJSON.call(this);data.autoClose=this.autoClose;data.curves=[];for(var i=0,l=this.curves.length;i<l;i++){var curve=this$1.curves[i];data.curves.push(curve.toJSON());}return data;},fromJSON:function fromJSON(json){var this$1=this;Curve.prototype.fromJSON.call(this,json);this.autoClose=json.autoClose;this.curves=[];for(var i=0,l=json.curves.length;i<l;i++){var curve=json.curves[i];this$1.curves.push(new Curves[curve.type]().fromJSON(curve));}return this;}});/**
   * @author zz85 / http://www.lab4games.net/zz85/blog
   * Creates free form 2d path using series of points, lines or curves.
   **/function Path(points){CurvePath.call(this);this.type='Path';this.currentPoint=new Vector2$1();if(points){this.setFromPoints(points);}}Path.prototype=Object.assign(Object.create(CurvePath.prototype),{constructor:Path,setFromPoints:function setFromPoints(points){var this$1=this;this.moveTo(points[0].x,points[0].y);for(var i=1,l=points.length;i<l;i++){this$1.lineTo(points[i].x,points[i].y);}},moveTo:function moveTo(x,y){this.currentPoint.set(x,y);// TODO consider referencing vectors instead of copying?
  },lineTo:function lineTo(x,y){var curve=new LineCurve(this.currentPoint.clone(),new Vector2$1(x,y));this.curves.push(curve);this.currentPoint.set(x,y);},quadraticCurveTo:function quadraticCurveTo(aCPx,aCPy,aX,aY){var curve=new QuadraticBezierCurve(this.currentPoint.clone(),new Vector2$1(aCPx,aCPy),new Vector2$1(aX,aY));this.curves.push(curve);this.currentPoint.set(aX,aY);},bezierCurveTo:function bezierCurveTo(aCP1x,aCP1y,aCP2x,aCP2y,aX,aY){var curve=new CubicBezierCurve(this.currentPoint.clone(),new Vector2$1(aCP1x,aCP1y),new Vector2$1(aCP2x,aCP2y),new Vector2$1(aX,aY));this.curves.push(curve);this.currentPoint.set(aX,aY);},splineThru:function splineThru(pts/*Array of Vector*/){var npts=[this.currentPoint.clone()].concat(pts);var curve=new SplineCurve(npts);this.curves.push(curve);this.currentPoint.copy(pts[pts.length-1]);},arc:function arc(aX,aY,aRadius,aStartAngle,aEndAngle,aClockwise){var x0=this.currentPoint.x;var y0=this.currentPoint.y;this.absarc(aX+x0,aY+y0,aRadius,aStartAngle,aEndAngle,aClockwise);},absarc:function absarc(aX,aY,aRadius,aStartAngle,aEndAngle,aClockwise){this.absellipse(aX,aY,aRadius,aRadius,aStartAngle,aEndAngle,aClockwise);},ellipse:function ellipse(aX,aY,xRadius,yRadius,aStartAngle,aEndAngle,aClockwise,aRotation){var x0=this.currentPoint.x;var y0=this.currentPoint.y;this.absellipse(aX+x0,aY+y0,xRadius,yRadius,aStartAngle,aEndAngle,aClockwise,aRotation);},absellipse:function absellipse(aX,aY,xRadius,yRadius,aStartAngle,aEndAngle,aClockwise,aRotation){var curve=new EllipseCurve(aX,aY,xRadius,yRadius,aStartAngle,aEndAngle,aClockwise,aRotation);if(this.curves.length>0){// if a previous curve is present, attempt to join
  var firstPoint=curve.getPoint(0);if(!firstPoint.equals(this.currentPoint)){this.lineTo(firstPoint.x,firstPoint.y);}}this.curves.push(curve);var lastPoint=curve.getPoint(1);this.currentPoint.copy(lastPoint);},copy:function copy(source){CurvePath.prototype.copy.call(this,source);this.currentPoint.copy(source.currentPoint);return this;},toJSON:function toJSON(){var data=CurvePath.prototype.toJSON.call(this);data.currentPoint=this.currentPoint.toArray();return data;},fromJSON:function fromJSON(json){CurvePath.prototype.fromJSON.call(this,json);this.currentPoint.fromArray(json.currentPoint);return this;}});/**
   * @author sroucheray / http://sroucheray.org/
   * @author mrdoob / http://mrdoob.com/
   */function AxesHelper(size){size=size||1;var vertices=[0,0,0,size,0,0,0,0,0,0,size,0,0,0,0,0,0,size];var colors=[1,0,0,1,0.6,0,0,1,0,0.6,1,0,0,0,1,0,0.6,1];var geometry=new BufferGeometry();geometry.addAttribute('position',new Float32BufferAttribute(vertices,3));geometry.addAttribute('color',new Float32BufferAttribute(colors,3));var material=new LineBasicMaterial$1({vertexColors:VertexColors});LineSegments.call(this,geometry,material);}AxesHelper.prototype=Object.create(LineSegments.prototype);AxesHelper.prototype.constructor=AxesHelper;/**
   * @author mrdoob / http://mrdoob.com/
   */function GridHelper(size,divisions,color1,color2){size=size||10;divisions=divisions||10;color1=new Color$1(color1!==undefined?color1:0x444444);color2=new Color$1(color2!==undefined?color2:0x888888);var center=divisions/2;var step=size/divisions;var halfSize=size/2;var vertices=[],colors=[];for(var i=0,j=0,k=-halfSize;i<=divisions;i++, k+=step){vertices.push(-halfSize,0,k,halfSize,0,k);vertices.push(k,0,-halfSize,k,0,halfSize);var color=i===center?color1:color2;color.toArray(colors,j);j+=3;color.toArray(colors,j);j+=3;color.toArray(colors,j);j+=3;color.toArray(colors,j);j+=3;}var geometry=new BufferGeometry();geometry.addAttribute('position',new Float32BufferAttribute(vertices,3));geometry.addAttribute('color',new Float32BufferAttribute(colors,3));var material=new LineBasicMaterial$1({vertexColors:VertexColors});LineSegments.call(this,geometry,material);}GridHelper.prototype=Object.create(LineSegments.prototype);GridHelper.prototype.constructor=GridHelper;/**
   * @author Sean Griffin / http://twitter.com/sgrif
   * @author Michael Guerrero / http://realitymeltdown.com
   * @author mrdoob / http://mrdoob.com/
   * @author ikerr / http://verold.com
   * @author Mugen87 / https://github.com/Mugen87
   */function getBoneList(object){var boneList=[];if(object&&object.isBone){boneList.push(object);}for(var i=0;i<object.children.length;i++){boneList.push.apply(boneList,getBoneList(object.children[i]));}return boneList;}function SkeletonHelper(object){var bones=getBoneList(object);var geometry=new BufferGeometry();var vertices=[];var colors=[];var color1=new Color$1(0,0,1);var color2=new Color$1(0,1,0);for(var i=0;i<bones.length;i++){var bone=bones[i];if(bone.parent&&bone.parent.isBone){vertices.push(0,0,0);vertices.push(0,0,0);colors.push(color1.r,color1.g,color1.b);colors.push(color2.r,color2.g,color2.b);}}geometry.addAttribute('position',new Float32BufferAttribute(vertices,3));geometry.addAttribute('color',new Float32BufferAttribute(colors,3));var material=new LineBasicMaterial$1({vertexColors:VertexColors,depthTest:false,depthWrite:false,transparent:true});LineSegments.call(this,geometry,material);this.root=object;this.bones=bones;this.matrix=object.matrixWorld;this.matrixAutoUpdate=false;}SkeletonHelper.prototype=Object.create(LineSegments.prototype);SkeletonHelper.prototype.constructor=SkeletonHelper;SkeletonHelper.prototype.updateMatrixWorld=function(){var vector=new Vector3$1();var boneMatrix=new Matrix4();var matrixWorldInv=new Matrix4();return function updateMatrixWorld(force){var bones=this.bones;var geometry=this.geometry;var position=geometry.getAttribute('position');matrixWorldInv.getInverse(this.root.matrixWorld);for(var i=0,j=0;i<bones.length;i++){var bone=bones[i];if(bone.parent&&bone.parent.isBone){boneMatrix.multiplyMatrices(matrixWorldInv,bone.matrixWorld);vector.setFromMatrixPosition(boneMatrix);position.setXYZ(j,vector.x,vector.y,vector.z);boneMatrix.multiplyMatrices(matrixWorldInv,bone.parent.matrixWorld);vector.setFromMatrixPosition(boneMatrix);position.setXYZ(j+1,vector.x,vector.y,vector.z);j+=2;}}geometry.getAttribute('position').needsUpdate=true;Object3D.prototype.updateMatrixWorld.call(this,force);};}();/**
   * @author mrdoob / http://mrdoob.com/
   */function CubeTextureLoader(manager){this.manager=manager!==undefined?manager:DefaultLoadingManager;}Object.assign(CubeTextureLoader.prototype,{crossOrigin:'Anonymous',load:function load(urls,onLoad,onProgress,onError){var texture=new CubeTexture();var loader=new ImageLoader(this.manager);loader.setCrossOrigin(this.crossOrigin);loader.setPath(this.path);var loaded=0;function loadTexture(i){loader.load(urls[i],function(image){texture.images[i]=image;loaded++;if(loaded===6){texture.needsUpdate=true;if(onLoad){onLoad(texture);}}},undefined,onError);}for(var i=0;i<urls.length;++i){loadTexture(i);}return texture;},setCrossOrigin:function setCrossOrigin(value){this.crossOrigin=value;return this;},setPath:function setPath(value){this.path=value;return this;}});/**
   * @author bhouston / http://clara.io
   */function Box2(min,max){this.min=min!==undefined?min:new Vector2$1(+Infinity,+Infinity);this.max=max!==undefined?max:new Vector2$1(-Infinity,-Infinity);}Object.assign(Box2.prototype,{set:function set$$1(min,max){this.min.copy(min);this.max.copy(max);return this;},setFromPoints:function setFromPoints(points){var this$1=this;this.makeEmpty();for(var i=0,il=points.length;i<il;i++){this$1.expandByPoint(points[i]);}return this;},setFromCenterAndSize:function(){var v1=new Vector2$1();return function setFromCenterAndSize(center,size){var halfSize=v1.copy(size).multiplyScalar(0.5);this.min.copy(center).sub(halfSize);this.max.copy(center).add(halfSize);return this;};}(),clone:function clone(){return new this.constructor().copy(this);},copy:function copy(box){this.min.copy(box.min);this.max.copy(box.max);return this;},makeEmpty:function makeEmpty(){this.min.x=this.min.y=+Infinity;this.max.x=this.max.y=-Infinity;return this;},isEmpty:function isEmpty(){// this is a more robust check for empty than ( volume <= 0 ) because volume can get positive with two negative axes
  return this.max.x<this.min.x||this.max.y<this.min.y;},getCenter:function getCenter(optionalTarget){var result=optionalTarget||new Vector2$1();return this.isEmpty()?result.set(0,0):result.addVectors(this.min,this.max).multiplyScalar(0.5);},getSize:function getSize(optionalTarget){var result=optionalTarget||new Vector2$1();return this.isEmpty()?result.set(0,0):result.subVectors(this.max,this.min);},expandByPoint:function expandByPoint(point){this.min.min(point);this.max.max(point);return this;},expandByVector:function expandByVector(vector){this.min.sub(vector);this.max.add(vector);return this;},expandByScalar:function expandByScalar(scalar){this.min.addScalar(-scalar);this.max.addScalar(scalar);return this;},containsPoint:function containsPoint(point){return point.x<this.min.x||point.x>this.max.x||point.y<this.min.y||point.y>this.max.y?false:true;},containsBox:function containsBox(box){return this.min.x<=box.min.x&&box.max.x<=this.max.x&&this.min.y<=box.min.y&&box.max.y<=this.max.y;},getParameter:function getParameter(point,optionalTarget){// This can potentially have a divide by zero if the box
  // has a size dimension of 0.
  var result=optionalTarget||new Vector2$1();return result.set((point.x-this.min.x)/(this.max.x-this.min.x),(point.y-this.min.y)/(this.max.y-this.min.y));},intersectsBox:function intersectsBox(box){// using 4 splitting planes to rule out intersections
  return box.max.x<this.min.x||box.min.x>this.max.x||box.max.y<this.min.y||box.min.y>this.max.y?false:true;},clampPoint:function clampPoint(point,optionalTarget){var result=optionalTarget||new Vector2$1();return result.copy(point).clamp(this.min,this.max);},distanceToPoint:function(){var v1=new Vector2$1();return function distanceToPoint(point){var clampedPoint=v1.copy(point).clamp(this.min,this.max);return clampedPoint.sub(point).length();};}(),intersect:function intersect(box){this.min.max(box.min);this.max.min(box.max);return this;},union:function union(box){this.min.min(box.min);this.max.max(box.max);return this;},translate:function translate(offset){this.min.add(offset);this.max.add(offset);return this;},equals:function equals(box){return box.min.equals(this.min)&&box.max.equals(this.max);}});/**
   * @author mikael emtinger / http://gomo.se/
   * @author alteredq / http://alteredqualia.com/
   * @author mrdoob / http://mrdoob.com/
   */function LOD(){Object3D.call(this);this.type='LOD';Object.defineProperties(this,{levels:{enumerable:true,value:[]}});}LOD.prototype=Object.assign(Object.create(Object3D.prototype),{constructor:LOD,copy:function copy(source){var this$1=this;Object3D.prototype.copy.call(this,source,false);var levels=source.levels;for(var i=0,l=levels.length;i<l;i++){var level=levels[i];this$1.addLevel(level.object.clone(),level.distance);}return this;},addLevel:function addLevel(object,distance){if(distance===undefined){distance=0;}distance=Math.abs(distance);var levels=this.levels;for(var l=0;l<levels.length;l++){if(distance<levels[l].distance){break;}}levels.splice(l,0,{distance:distance,object:object});this.add(object);},getObjectForDistance:function getObjectForDistance(distance){var levels=this.levels;for(var i=1,l=levels.length;i<l;i++){if(distance<levels[i].distance){break;}}return levels[i-1].object;},raycast:function(){var matrixPosition=new Vector3$1();return function raycast(raycaster,intersects){matrixPosition.setFromMatrixPosition(this.matrixWorld);var distance=raycaster.ray.origin.distanceTo(matrixPosition);this.getObjectForDistance(distance).raycast(raycaster,intersects);};}(),update:function(){var v1=new Vector3$1();var v2=new Vector3$1();return function update(camera){var levels=this.levels;if(levels.length>1){v1.setFromMatrixPosition(camera.matrixWorld);v2.setFromMatrixPosition(this.matrixWorld);var distance=v1.distanceTo(v2);levels[0].object.visible=true;for(var i=1,l=levels.length;i<l;i++){if(distance>=levels[i].distance){levels[i-1].object.visible=false;levels[i].object.visible=true;}else{break;}}for(;i<l;i++){levels[i].object.visible=false;}}};}(),toJSON:function toJSON(meta){var data=Object3D.prototype.toJSON.call(this,meta);data.object.levels=[];var levels=this.levels;for(var i=0,l=levels.length;i<l;i++){var level=levels[i];data.object.levels.push({object:level.object.uuid,distance:level.distance});}return data;}});/**
   * @author tschw
   *
   * Uniforms of a program.
   * Those form a tree structure with a special top-level container for the root,
   * which you get by calling 'new WebGLUniforms( gl, program, renderer )'.
   *
   *
   * Properties of inner nodes including the top-level container:
   *
   * .seq - array of nested uniforms
   * .map - nested uniforms by name
   *
   *
   * Methods of all nodes except the top-level container:
   *
   * .setValue( gl, value, [renderer] )
   *
   * 		uploads a uniform value(s)
   *  	the 'renderer' parameter is needed for sampler uniforms
   *
   *
   * Static methods of the top-level container (renderer factorizations):
   *
   * .upload( gl, seq, values, renderer )
   *
   * 		sets uniforms in 'seq' to 'values[id].value'
   *
   * .seqWithValue( seq, values ) : filteredSeq
   *
   * 		filters 'seq' entries with corresponding entry in values
   *
   *
   * Methods of the top-level container (renderer factorizations):
   *
   * .setValue( gl, name, value )
   *
   * 		sets uniform with  name 'name' to 'value'
   *
   * .set( gl, obj, prop )
   *
   * 		sets uniform from object and property with same name than uniform
   *
   * .setOptional( gl, obj, prop )
   *
   * 		like .set for an optional property of the object
   *
   */var emptyTexture=new Texture$1();var emptyCubeTexture=new CubeTexture();// --- Base for inner nodes (including the root) ---
  function UniformContainer(){this.seq=[];this.map={};}// --- Utilities ---
  // Array Caches (provide typed arrays for temporary by size)
  var arrayCacheF32=[];var arrayCacheI32=[];// Float32Array caches used for uploading Matrix uniforms
  var mat4array=new Float32Array(16);var mat3array=new Float32Array(9);// Flattening for arrays of vectors and matrices
  function flatten(array,nBlocks,blockSize){var firstElem=array[0];if(firstElem<=0||firstElem>0){return array;}// unoptimized: ! isNaN( firstElem )
  // see http://jacksondunstan.com/articles/983
  var n=nBlocks*blockSize,r=arrayCacheF32[n];if(r===undefined){r=new Float32Array(n);arrayCacheF32[n]=r;}if(nBlocks!==0){firstElem.toArray(r,0);for(var i=1,offset=0;i!==nBlocks;++i){offset+=blockSize;array[i].toArray(r,offset);}}return r;}// Texture unit allocation
  function allocTexUnits(renderer,n){var r=arrayCacheI32[n];if(r===undefined){r=new Int32Array(n);arrayCacheI32[n]=r;}for(var i=0;i!==n;++i){r[i]=renderer.allocTextureUnit();}return r;}// --- Setters ---
  // Note: Defining these methods externally, because they come in a bunch
  // and this way their names minify.
  // Single scalar
  function setValue1f(gl,v){gl.uniform1f(this.addr,v);}function setValue1i(gl,v){gl.uniform1i(this.addr,v);}// Single float vector (from flat array or THREE.VectorN)
  function setValue2fv(gl,v){if(v.x===undefined){gl.uniform2fv(this.addr,v);}else{gl.uniform2f(this.addr,v.x,v.y);}}function setValue3fv(gl,v){if(v.x!==undefined){gl.uniform3f(this.addr,v.x,v.y,v.z);}else if(v.r!==undefined){gl.uniform3f(this.addr,v.r,v.g,v.b);}else{gl.uniform3fv(this.addr,v);}}function setValue4fv(gl,v){if(v.x===undefined){gl.uniform4fv(this.addr,v);}else{gl.uniform4f(this.addr,v.x,v.y,v.z,v.w);}}// Single matrix (from flat array or MatrixN)
  function setValue2fm(gl,v){gl.uniformMatrix2fv(this.addr,false,v.elements||v);}function setValue3fm(gl,v){if(v.elements===undefined){gl.uniformMatrix3fv(this.addr,false,v);}else{mat3array.set(v.elements);gl.uniformMatrix3fv(this.addr,false,mat3array);}}function setValue4fm(gl,v){if(v.elements===undefined){gl.uniformMatrix4fv(this.addr,false,v);}else{mat4array.set(v.elements);gl.uniformMatrix4fv(this.addr,false,mat4array);}}// Single texture (2D / Cube)
  function setValueT1(gl,v,renderer){var unit=renderer.allocTextureUnit();gl.uniform1i(this.addr,unit);renderer.setTexture2D(v||emptyTexture,unit);}function setValueT6(gl,v,renderer){var unit=renderer.allocTextureUnit();gl.uniform1i(this.addr,unit);renderer.setTextureCube(v||emptyCubeTexture,unit);}// Integer / Boolean vectors or arrays thereof (always flat arrays)
  function setValue2iv(gl,v){gl.uniform2iv(this.addr,v);}function setValue3iv(gl,v){gl.uniform3iv(this.addr,v);}function setValue4iv(gl,v){gl.uniform4iv(this.addr,v);}// Helper to pick the right setter for the singular case
  function getSingularSetter(type){switch(type){case 0x1406:return setValue1f;// FLOAT
  case 0x8b50:return setValue2fv;// _VEC2
  case 0x8b51:return setValue3fv;// _VEC3
  case 0x8b52:return setValue4fv;// _VEC4
  case 0x8b5a:return setValue2fm;// _MAT2
  case 0x8b5b:return setValue3fm;// _MAT3
  case 0x8b5c:return setValue4fm;// _MAT4
  case 0x8b5e:case 0x8d66:return setValueT1;// SAMPLER_2D, SAMPLER_EXTERNAL_OES
  case 0x8b60:return setValueT6;// SAMPLER_CUBE
  case 0x1404:case 0x8b56:return setValue1i;// INT, BOOL
  case 0x8b53:case 0x8b57:return setValue2iv;// _VEC2
  case 0x8b54:case 0x8b58:return setValue3iv;// _VEC3
  case 0x8b55:case 0x8b59:return setValue4iv;// _VEC4
  }}// Array of scalars
  function setValue1fv(gl,v){gl.uniform1fv(this.addr,v);}function setValue1iv(gl,v){gl.uniform1iv(this.addr,v);}// Array of vectors (flat or from THREE classes)
  function setValueV2a(gl,v){gl.uniform2fv(this.addr,flatten(v,this.size,2));}function setValueV3a(gl,v){gl.uniform3fv(this.addr,flatten(v,this.size,3));}function setValueV4a(gl,v){gl.uniform4fv(this.addr,flatten(v,this.size,4));}// Array of matrices (flat or from THREE clases)
  function setValueM2a(gl,v){gl.uniformMatrix2fv(this.addr,false,flatten(v,this.size,4));}function setValueM3a(gl,v){gl.uniformMatrix3fv(this.addr,false,flatten(v,this.size,9));}function setValueM4a(gl,v){gl.uniformMatrix4fv(this.addr,false,flatten(v,this.size,16));}// Array of textures (2D / Cube)
  function setValueT1a(gl,v,renderer){var n=v.length,units=allocTexUnits(renderer,n);gl.uniform1iv(this.addr,units);for(var i=0;i!==n;++i){renderer.setTexture2D(v[i]||emptyTexture,units[i]);}}function setValueT6a(gl,v,renderer){var n=v.length,units=allocTexUnits(renderer,n);gl.uniform1iv(this.addr,units);for(var i=0;i!==n;++i){renderer.setTextureCube(v[i]||emptyCubeTexture,units[i]);}}// Helper to pick the right setter for a pure (bottom-level) array
  function getPureArraySetter(type){switch(type){case 0x1406:return setValue1fv;// FLOAT
  case 0x8b50:return setValueV2a;// _VEC2
  case 0x8b51:return setValueV3a;// _VEC3
  case 0x8b52:return setValueV4a;// _VEC4
  case 0x8b5a:return setValueM2a;// _MAT2
  case 0x8b5b:return setValueM3a;// _MAT3
  case 0x8b5c:return setValueM4a;// _MAT4
  case 0x8b5e:return setValueT1a;// SAMPLER_2D
  case 0x8b60:return setValueT6a;// SAMPLER_CUBE
  case 0x1404:case 0x8b56:return setValue1iv;// INT, BOOL
  case 0x8b53:case 0x8b57:return setValue2iv;// _VEC2
  case 0x8b54:case 0x8b58:return setValue3iv;// _VEC3
  case 0x8b55:case 0x8b59:return setValue4iv;// _VEC4
  }}// --- Uniform Classes ---
  function SingleUniform(id,activeInfo,addr){this.id=id;this.addr=addr;this.setValue=getSingularSetter(activeInfo.type);// this.path = activeInfo.name; // DEBUG
  }function PureArrayUniform(id,activeInfo,addr){this.id=id;this.addr=addr;this.size=activeInfo.size;this.setValue=getPureArraySetter(activeInfo.type);// this.path = activeInfo.name; // DEBUG
  }function StructuredUniform(id){this.id=id;UniformContainer.call(this);// mix-in
  }StructuredUniform.prototype.setValue=function(gl,value){// Note: Don't need an extra 'renderer' parameter, since samplers
  // are not allowed in structured uniforms.
  var seq=this.seq;for(var i=0,n=seq.length;i!==n;++i){var u=seq[i];u.setValue(gl,value[u.id]);}};// --- Top-level ---
  // Parser - builds up the property tree from the path strings
  var RePathPart=/([\w\d_]+)(\])?(\[|\.)?/g;// extracts
  // 	- the identifier (member name or array index)
  //  - followed by an optional right bracket (found when array index)
  //  - followed by an optional left bracket or dot (type of subscript)
  //
  // Note: These portions can be read in a non-overlapping fashion and
  // allow straightforward parsing of the hierarchy that WebGL encodes
  // in the uniform names.
  function addUniform(container,uniformObject){container.seq.push(uniformObject);container.map[uniformObject.id]=uniformObject;}function parseUniform(activeInfo,addr,container){var path=activeInfo.name,pathLength=path.length;// reset RegExp object, because of the early exit of a previous run
  RePathPart.lastIndex=0;for(;;){var match=RePathPart.exec(path),matchEnd=RePathPart.lastIndex,id=match[1],idIsIndex=match[2]===']',subscript=match[3];if(idIsIndex){id=id|0;}// convert to integer
  if(subscript===undefined||subscript==='['&&matchEnd+2===pathLength){// bare name or "pure" bottom-level array "[0]" suffix
  addUniform(container,subscript===undefined?new SingleUniform(id,activeInfo,addr):new PureArrayUniform(id,activeInfo,addr));break;}else{// step into inner node / create it in case it doesn't exist
  var map=container.map,next=map[id];if(next===undefined){next=new StructuredUniform(id);addUniform(container,next);}container=next;}}}// Root Container
  function WebGLUniforms(gl,program,renderer){var this$1=this;UniformContainer.call(this);this.renderer=renderer;var n=gl.getProgramParameter(program,gl.ACTIVE_UNIFORMS);for(var i=0;i<n;++i){var info=gl.getActiveUniform(program,i),path=info.name,addr=gl.getUniformLocation(program,path);parseUniform(info,addr,this$1);}}WebGLUniforms.prototype.setValue=function(gl,name,value){var u=this.map[name];if(u!==undefined){u.setValue(gl,value,this.renderer);}};WebGLUniforms.prototype.setOptional=function(gl,object,name){var v=object[name];if(v!==undefined){this.setValue(gl,name,v);}};// Static interface
  WebGLUniforms.upload=function(gl,seq,values,renderer){for(var i=0,n=seq.length;i!==n;++i){var u=seq[i],v=values[u.id];if(v.needsUpdate!==false){// note: always updating when .needsUpdate is undefined
  u.setValue(gl,v.value,renderer);}}};WebGLUniforms.seqWithValue=function(seq,values){var r=[];for(var i=0,n=seq.length;i!==n;++i){var u=seq[i];if(u.id in values){r.push(u);}}return r;};/**
   * @author mikael emtinger / http://gomo.se/
   * @author alteredq / http://alteredqualia.com/
   */function WebGLFlareRenderer(renderer,gl,state,textures,capabilities){var vertexBuffer,elementBuffer;var shader,program,attributes,uniforms;var tempTexture,occlusionTexture;function init(){var vertices=new Float32Array([-1,-1,0,0,1,-1,1,0,1,1,1,1,-1,1,0,1]);var faces=new Uint16Array([0,1,2,0,2,3]);// buffers
  vertexBuffer=gl.createBuffer();elementBuffer=gl.createBuffer();gl.bindBuffer(gl.ARRAY_BUFFER,vertexBuffer);gl.bufferData(gl.ARRAY_BUFFER,vertices,gl.STATIC_DRAW);gl.bindBuffer(gl.ELEMENT_ARRAY_BUFFER,elementBuffer);gl.bufferData(gl.ELEMENT_ARRAY_BUFFER,faces,gl.STATIC_DRAW);// textures
  tempTexture=gl.createTexture();occlusionTexture=gl.createTexture();state.bindTexture(gl.TEXTURE_2D,tempTexture);gl.texImage2D(gl.TEXTURE_2D,0,gl.RGB,16,16,0,gl.RGB,gl.UNSIGNED_BYTE,null);gl.texParameteri(gl.TEXTURE_2D,gl.TEXTURE_WRAP_S,gl.CLAMP_TO_EDGE);gl.texParameteri(gl.TEXTURE_2D,gl.TEXTURE_WRAP_T,gl.CLAMP_TO_EDGE);gl.texParameteri(gl.TEXTURE_2D,gl.TEXTURE_MAG_FILTER,gl.NEAREST);gl.texParameteri(gl.TEXTURE_2D,gl.TEXTURE_MIN_FILTER,gl.NEAREST);state.bindTexture(gl.TEXTURE_2D,occlusionTexture);gl.texImage2D(gl.TEXTURE_2D,0,gl.RGBA,16,16,0,gl.RGBA,gl.UNSIGNED_BYTE,null);gl.texParameteri(gl.TEXTURE_2D,gl.TEXTURE_WRAP_S,gl.CLAMP_TO_EDGE);gl.texParameteri(gl.TEXTURE_2D,gl.TEXTURE_WRAP_T,gl.CLAMP_TO_EDGE);gl.texParameteri(gl.TEXTURE_2D,gl.TEXTURE_MAG_FILTER,gl.NEAREST);gl.texParameteri(gl.TEXTURE_2D,gl.TEXTURE_MIN_FILTER,gl.NEAREST);shader={vertexShader:['uniform lowp int renderType;','uniform vec3 screenPosition;','uniform vec2 scale;','uniform float rotation;','uniform sampler2D occlusionMap;','attribute vec2 position;','attribute vec2 uv;','varying vec2 vUV;','varying float vVisibility;','void main() {','	vUV = uv;','	vec2 pos = position;','	if ( renderType == 2 ) {','		vec4 visibility = texture2D( occlusionMap, vec2( 0.1, 0.1 ) );','		visibility += texture2D( occlusionMap, vec2( 0.5, 0.1 ) );','		visibility += texture2D( occlusionMap, vec2( 0.9, 0.1 ) );','		visibility += texture2D( occlusionMap, vec2( 0.9, 0.5 ) );','		visibility += texture2D( occlusionMap, vec2( 0.9, 0.9 ) );','		visibility += texture2D( occlusionMap, vec2( 0.5, 0.9 ) );','		visibility += texture2D( occlusionMap, vec2( 0.1, 0.9 ) );','		visibility += texture2D( occlusionMap, vec2( 0.1, 0.5 ) );','		visibility += texture2D( occlusionMap, vec2( 0.5, 0.5 ) );','		vVisibility =        visibility.r / 9.0;','		vVisibility *= 1.0 - visibility.g / 9.0;','		vVisibility *=       visibility.b / 9.0;','		vVisibility *= 1.0 - visibility.a / 9.0;','		pos.x = cos( rotation ) * position.x - sin( rotation ) * position.y;','		pos.y = sin( rotation ) * position.x + cos( rotation ) * position.y;','	}','	gl_Position = vec4( ( pos * scale + screenPosition.xy ).xy, screenPosition.z, 1.0 );','}'].join('\n'),fragmentShader:['uniform lowp int renderType;','uniform sampler2D map;','uniform float opacity;','uniform vec3 color;','varying vec2 vUV;','varying float vVisibility;','void main() {',// pink square
  '	if ( renderType == 0 ) {','		gl_FragColor = vec4( 1.0, 0.0, 1.0, 0.0 );',// restore
  '	} else if ( renderType == 1 ) {','		gl_FragColor = texture2D( map, vUV );',// flare
  '	} else {','		vec4 texture = texture2D( map, vUV );','		texture.a *= opacity * vVisibility;','		gl_FragColor = texture;','		gl_FragColor.rgb *= color;','	}','}'].join('\n')};program=createProgram(shader);attributes={vertex:gl.getAttribLocation(program,'position'),uv:gl.getAttribLocation(program,'uv')};uniforms={renderType:gl.getUniformLocation(program,'renderType'),map:gl.getUniformLocation(program,'map'),occlusionMap:gl.getUniformLocation(program,'occlusionMap'),opacity:gl.getUniformLocation(program,'opacity'),color:gl.getUniformLocation(program,'color'),scale:gl.getUniformLocation(program,'scale'),rotation:gl.getUniformLocation(program,'rotation'),screenPosition:gl.getUniformLocation(program,'screenPosition')};}/*
  	 * Render lens flares
  	 * Method: renders 16x16 0xff00ff-colored points scattered over the light source area,
  	 *         reads these back and calculates occlusion.
  	 */this.render=function(flares,scene,camera,viewport){if(flares.length===0){return;}var tempPosition=new Vector3$1();var invAspect=viewport.w/viewport.z,halfViewportWidth=viewport.z*0.5,halfViewportHeight=viewport.w*0.5;var size=16/viewport.w,scale=new Vector2$1(size*invAspect,size);var screenPosition=new Vector3$1(1,1,0),screenPositionPixels=new Vector2$1(1,1);var validArea=new Box2();validArea.min.set(viewport.x,viewport.y);validArea.max.set(viewport.x+(viewport.z-16),viewport.y+(viewport.w-16));if(program===undefined){init();}state.useProgram(program);state.initAttributes();state.enableAttribute(attributes.vertex);state.enableAttribute(attributes.uv);state.disableUnusedAttributes();// loop through all lens flares to update their occlusion and positions
  // setup gl and common used attribs/uniforms
  gl.uniform1i(uniforms.occlusionMap,0);gl.uniform1i(uniforms.map,1);gl.bindBuffer(gl.ARRAY_BUFFER,vertexBuffer);gl.vertexAttribPointer(attributes.vertex,2,gl.FLOAT,false,2*8,0);gl.vertexAttribPointer(attributes.uv,2,gl.FLOAT,false,2*8,8);gl.bindBuffer(gl.ELEMENT_ARRAY_BUFFER,elementBuffer);state.disable(gl.CULL_FACE);state.buffers.depth.setMask(false);for(var i=0,l=flares.length;i<l;i++){size=16/viewport.w;scale.set(size*invAspect,size);// calc object screen position
  var flare=flares[i];tempPosition.set(flare.matrixWorld.elements[12],flare.matrixWorld.elements[13],flare.matrixWorld.elements[14]);tempPosition.applyMatrix4(camera.matrixWorldInverse);tempPosition.applyMatrix4(camera.projectionMatrix);// setup arrays for gl programs
  screenPosition.copy(tempPosition);// horizontal and vertical coordinate of the lower left corner of the pixels to copy
  screenPositionPixels.x=viewport.x+screenPosition.x*halfViewportWidth+halfViewportWidth-8;screenPositionPixels.y=viewport.y+screenPosition.y*halfViewportHeight+halfViewportHeight-8;// screen cull
  if(validArea.containsPoint(screenPositionPixels)===true){// save current RGB to temp texture
  state.activeTexture(gl.TEXTURE0);state.bindTexture(gl.TEXTURE_2D,null);state.activeTexture(gl.TEXTURE1);state.bindTexture(gl.TEXTURE_2D,tempTexture);gl.copyTexImage2D(gl.TEXTURE_2D,0,gl.RGB,screenPositionPixels.x,screenPositionPixels.y,16,16,0);// render pink quad
  gl.uniform1i(uniforms.renderType,0);gl.uniform2f(uniforms.scale,scale.x,scale.y);gl.uniform3f(uniforms.screenPosition,screenPosition.x,screenPosition.y,screenPosition.z);state.disable(gl.BLEND);state.enable(gl.DEPTH_TEST);gl.drawElements(gl.TRIANGLES,6,gl.UNSIGNED_SHORT,0);// copy result to occlusionMap
  state.activeTexture(gl.TEXTURE0);state.bindTexture(gl.TEXTURE_2D,occlusionTexture);gl.copyTexImage2D(gl.TEXTURE_2D,0,gl.RGBA,screenPositionPixels.x,screenPositionPixels.y,16,16,0);// restore graphics
  gl.uniform1i(uniforms.renderType,1);state.disable(gl.DEPTH_TEST);state.activeTexture(gl.TEXTURE1);state.bindTexture(gl.TEXTURE_2D,tempTexture);gl.drawElements(gl.TRIANGLES,6,gl.UNSIGNED_SHORT,0);// update object positions
  flare.positionScreen.copy(screenPosition);if(flare.customUpdateCallback){flare.customUpdateCallback(flare);}else{flare.updateLensFlares();}// render flares
  gl.uniform1i(uniforms.renderType,2);state.enable(gl.BLEND);for(var j=0,jl=flare.lensFlares.length;j<jl;j++){var sprite=flare.lensFlares[j];if(sprite.opacity>0.001&&sprite.scale>0.001){screenPosition.x=sprite.x;screenPosition.y=sprite.y;screenPosition.z=sprite.z;size=sprite.size*sprite.scale/viewport.w;scale.x=size*invAspect;scale.y=size;gl.uniform3f(uniforms.screenPosition,screenPosition.x,screenPosition.y,screenPosition.z);gl.uniform2f(uniforms.scale,scale.x,scale.y);gl.uniform1f(uniforms.rotation,sprite.rotation);gl.uniform1f(uniforms.opacity,sprite.opacity);gl.uniform3f(uniforms.color,sprite.color.r,sprite.color.g,sprite.color.b);state.setBlending(sprite.blending,sprite.blendEquation,sprite.blendSrc,sprite.blendDst);textures.setTexture2D(sprite.texture,1);gl.drawElements(gl.TRIANGLES,6,gl.UNSIGNED_SHORT,0);}}}}// restore gl
  state.enable(gl.CULL_FACE);state.enable(gl.DEPTH_TEST);state.buffers.depth.setMask(true);state.reset();};function createProgram(shader){var program=gl.createProgram();var fragmentShader=gl.createShader(gl.FRAGMENT_SHADER);var vertexShader=gl.createShader(gl.VERTEX_SHADER);var prefix='precision '+capabilities.precision+' float;\n';gl.shaderSource(fragmentShader,prefix+shader.fragmentShader);gl.shaderSource(vertexShader,prefix+shader.vertexShader);gl.compileShader(fragmentShader);gl.compileShader(vertexShader);gl.attachShader(program,fragmentShader);gl.attachShader(program,vertexShader);gl.linkProgram(program);return program;}}/**
   * @author mikael emtinger / http://gomo.se/
   * @author alteredq / http://alteredqualia.com/
   */function WebGLSpriteRenderer(renderer,gl,state,textures,capabilities){var vertexBuffer,elementBuffer;var program,attributes,uniforms;var texture;// decompose matrixWorld
  var spritePosition=new Vector3$1();var spriteRotation=new Quaternion();var spriteScale=new Vector3$1();function init(){var vertices=new Float32Array([-0.5,-0.5,0,0,0.5,-0.5,1,0,0.5,0.5,1,1,-0.5,0.5,0,1]);var faces=new Uint16Array([0,1,2,0,2,3]);vertexBuffer=gl.createBuffer();elementBuffer=gl.createBuffer();gl.bindBuffer(gl.ARRAY_BUFFER,vertexBuffer);gl.bufferData(gl.ARRAY_BUFFER,vertices,gl.STATIC_DRAW);gl.bindBuffer(gl.ELEMENT_ARRAY_BUFFER,elementBuffer);gl.bufferData(gl.ELEMENT_ARRAY_BUFFER,faces,gl.STATIC_DRAW);program=createProgram();attributes={position:gl.getAttribLocation(program,'position'),uv:gl.getAttribLocation(program,'uv')};uniforms={uvOffset:gl.getUniformLocation(program,'uvOffset'),uvScale:gl.getUniformLocation(program,'uvScale'),rotation:gl.getUniformLocation(program,'rotation'),scale:gl.getUniformLocation(program,'scale'),color:gl.getUniformLocation(program,'color'),map:gl.getUniformLocation(program,'map'),opacity:gl.getUniformLocation(program,'opacity'),modelViewMatrix:gl.getUniformLocation(program,'modelViewMatrix'),projectionMatrix:gl.getUniformLocation(program,'projectionMatrix'),fogType:gl.getUniformLocation(program,'fogType'),fogDensity:gl.getUniformLocation(program,'fogDensity'),fogNear:gl.getUniformLocation(program,'fogNear'),fogFar:gl.getUniformLocation(program,'fogFar'),fogColor:gl.getUniformLocation(program,'fogColor'),fogDepth:gl.getUniformLocation(program,'fogDepth'),alphaTest:gl.getUniformLocation(program,'alphaTest')};var canvas=document.createElementNS('http://www.w3.org/1999/xhtml','canvas');canvas.width=8;canvas.height=8;var context=canvas.getContext('2d');context.fillStyle='white';context.fillRect(0,0,8,8);texture=new CanvasTexture(canvas);}this.render=function(sprites,scene,camera){if(sprites.length===0){return;}// setup gl
  if(program===undefined){init();}state.useProgram(program);state.initAttributes();state.enableAttribute(attributes.position);state.enableAttribute(attributes.uv);state.disableUnusedAttributes();state.disable(gl.CULL_FACE);state.enable(gl.BLEND);gl.bindBuffer(gl.ARRAY_BUFFER,vertexBuffer);gl.vertexAttribPointer(attributes.position,2,gl.FLOAT,false,2*8,0);gl.vertexAttribPointer(attributes.uv,2,gl.FLOAT,false,2*8,8);gl.bindBuffer(gl.ELEMENT_ARRAY_BUFFER,elementBuffer);gl.uniformMatrix4fv(uniforms.projectionMatrix,false,camera.projectionMatrix.elements);state.activeTexture(gl.TEXTURE0);gl.uniform1i(uniforms.map,0);var oldFogType=0;var sceneFogType=0;var fog=scene.fog;if(fog){gl.uniform3f(uniforms.fogColor,fog.color.r,fog.color.g,fog.color.b);if(fog.isFog){gl.uniform1f(uniforms.fogNear,fog.near);gl.uniform1f(uniforms.fogFar,fog.far);gl.uniform1i(uniforms.fogType,1);oldFogType=1;sceneFogType=1;}else if(fog.isFogExp2){gl.uniform1f(uniforms.fogDensity,fog.density);gl.uniform1i(uniforms.fogType,2);oldFogType=2;sceneFogType=2;}}else{gl.uniform1i(uniforms.fogType,0);oldFogType=0;sceneFogType=0;}// update positions and sort
  for(var i=0,l=sprites.length;i<l;i++){var sprite=sprites[i];sprite.modelViewMatrix.multiplyMatrices(camera.matrixWorldInverse,sprite.matrixWorld);sprite.z=-sprite.modelViewMatrix.elements[14];}sprites.sort(painterSortStable);// render all sprites
  var scale=[];for(var i=0,l=sprites.length;i<l;i++){var sprite=sprites[i];var material=sprite.material;if(material.visible===false){continue;}sprite.onBeforeRender(renderer,scene,camera,undefined,material,undefined);gl.uniform1f(uniforms.alphaTest,material.alphaTest);gl.uniformMatrix4fv(uniforms.modelViewMatrix,false,sprite.modelViewMatrix.elements);sprite.matrixWorld.decompose(spritePosition,spriteRotation,spriteScale);scale[0]=spriteScale.x;scale[1]=spriteScale.y;var fogType=0;if(scene.fog&&material.fog){fogType=sceneFogType;}if(oldFogType!==fogType){gl.uniform1i(uniforms.fogType,fogType);oldFogType=fogType;}if(material.map!==null){gl.uniform2f(uniforms.uvOffset,material.map.offset.x,material.map.offset.y);gl.uniform2f(uniforms.uvScale,material.map.repeat.x,material.map.repeat.y);}else{gl.uniform2f(uniforms.uvOffset,0,0);gl.uniform2f(uniforms.uvScale,1,1);}gl.uniform1f(uniforms.opacity,material.opacity);gl.uniform3f(uniforms.color,material.color.r,material.color.g,material.color.b);gl.uniform1f(uniforms.rotation,material.rotation);gl.uniform2fv(uniforms.scale,scale);state.setBlending(material.blending,material.blendEquation,material.blendSrc,material.blendDst,material.blendEquationAlpha,material.blendSrcAlpha,material.blendDstAlpha,material.premultipliedAlpha);state.buffers.depth.setTest(material.depthTest);state.buffers.depth.setMask(material.depthWrite);state.buffers.color.setMask(material.colorWrite);textures.setTexture2D(material.map||texture,0);gl.drawElements(gl.TRIANGLES,6,gl.UNSIGNED_SHORT,0);sprite.onAfterRender(renderer,scene,camera,undefined,material,undefined);}// restore gl
  state.enable(gl.CULL_FACE);state.reset();};function createProgram(){var program=gl.createProgram();var vertexShader=gl.createShader(gl.VERTEX_SHADER);var fragmentShader=gl.createShader(gl.FRAGMENT_SHADER);gl.shaderSource(vertexShader,['precision '+capabilities.precision+' float;','#define SHADER_NAME '+'SpriteMaterial','uniform mat4 modelViewMatrix;','uniform mat4 projectionMatrix;','uniform float rotation;','uniform vec2 scale;','uniform vec2 uvOffset;','uniform vec2 uvScale;','attribute vec2 position;','attribute vec2 uv;','varying vec2 vUV;','varying float fogDepth;','void main() {','	vUV = uvOffset + uv * uvScale;','	vec2 alignedPosition = position * scale;','	vec2 rotatedPosition;','	rotatedPosition.x = cos( rotation ) * alignedPosition.x - sin( rotation ) * alignedPosition.y;','	rotatedPosition.y = sin( rotation ) * alignedPosition.x + cos( rotation ) * alignedPosition.y;','	vec4 mvPosition;','	mvPosition = modelViewMatrix * vec4( 0.0, 0.0, 0.0, 1.0 );','	mvPosition.xy += rotatedPosition;','	gl_Position = projectionMatrix * mvPosition;','	fogDepth = - mvPosition.z;','}'].join('\n'));gl.shaderSource(fragmentShader,['precision '+capabilities.precision+' float;','#define SHADER_NAME '+'SpriteMaterial','uniform vec3 color;','uniform sampler2D map;','uniform float opacity;','uniform int fogType;','uniform vec3 fogColor;','uniform float fogDensity;','uniform float fogNear;','uniform float fogFar;','uniform float alphaTest;','varying vec2 vUV;','varying float fogDepth;','void main() {','	vec4 texture = texture2D( map, vUV );','	gl_FragColor = vec4( color * texture.xyz, texture.a * opacity );','	if ( gl_FragColor.a < alphaTest ) discard;','	if ( fogType > 0 ) {','		float fogFactor = 0.0;','		if ( fogType == 1 ) {','			fogFactor = smoothstep( fogNear, fogFar, fogDepth );','		} else {','			const float LOG2 = 1.442695;','			fogFactor = exp2( - fogDensity * fogDensity * fogDepth * fogDepth * LOG2 );','			fogFactor = 1.0 - clamp( fogFactor, 0.0, 1.0 );','		}','		gl_FragColor.rgb = mix( gl_FragColor.rgb, fogColor, fogFactor );','	}','}'].join('\n'));gl.compileShader(vertexShader);gl.compileShader(fragmentShader);gl.attachShader(program,vertexShader);gl.attachShader(program,fragmentShader);gl.linkProgram(program);return program;}function painterSortStable(a,b){if(a.renderOrder!==b.renderOrder){return a.renderOrder-b.renderOrder;}else if(a.z!==b.z){return b.z-a.z;}else{return b.id-a.id;}}}/**
   * @author mrdoob / http://mrdoob.com/
   * @author alteredq / http://alteredqualia.com/
   * @author bhouston / http://clara.io
   */function Frustum(p0,p1,p2,p3,p4,p5){this.planes=[p0!==undefined?p0:new Plane(),p1!==undefined?p1:new Plane(),p2!==undefined?p2:new Plane(),p3!==undefined?p3:new Plane(),p4!==undefined?p4:new Plane(),p5!==undefined?p5:new Plane()];}Object.assign(Frustum.prototype,{set:function set$$1(p0,p1,p2,p3,p4,p5){var planes=this.planes;planes[0].copy(p0);planes[1].copy(p1);planes[2].copy(p2);planes[3].copy(p3);planes[4].copy(p4);planes[5].copy(p5);return this;},clone:function clone(){return new this.constructor().copy(this);},copy:function copy(frustum){var planes=this.planes;for(var i=0;i<6;i++){planes[i].copy(frustum.planes[i]);}return this;},setFromMatrix:function setFromMatrix(m){var planes=this.planes;var me=m.elements;var me0=me[0],me1=me[1],me2=me[2],me3=me[3];var me4=me[4],me5=me[5],me6=me[6],me7=me[7];var me8=me[8],me9=me[9],me10=me[10],me11=me[11];var me12=me[12],me13=me[13],me14=me[14],me15=me[15];planes[0].setComponents(me3-me0,me7-me4,me11-me8,me15-me12).normalize();planes[1].setComponents(me3+me0,me7+me4,me11+me8,me15+me12).normalize();planes[2].setComponents(me3+me1,me7+me5,me11+me9,me15+me13).normalize();planes[3].setComponents(me3-me1,me7-me5,me11-me9,me15-me13).normalize();planes[4].setComponents(me3-me2,me7-me6,me11-me10,me15-me14).normalize();planes[5].setComponents(me3+me2,me7+me6,me11+me10,me15+me14).normalize();return this;},intersectsObject:function(){var sphere=new Sphere();return function intersectsObject(object){var geometry=object.geometry;if(geometry.boundingSphere===null){geometry.computeBoundingSphere();}sphere.copy(geometry.boundingSphere).applyMatrix4(object.matrixWorld);return this.intersectsSphere(sphere);};}(),intersectsSprite:function(){var sphere=new Sphere();return function intersectsSprite(sprite){sphere.center.set(0,0,0);sphere.radius=0.7071067811865476;sphere.applyMatrix4(sprite.matrixWorld);return this.intersectsSphere(sphere);};}(),intersectsSphere:function intersectsSphere(sphere){var planes=this.planes;var center=sphere.center;var negRadius=-sphere.radius;for(var i=0;i<6;i++){var distance=planes[i].distanceToPoint(center);if(distance<negRadius){return false;}}return true;},intersectsBox:function(){var p1=new Vector3$1(),p2=new Vector3$1();return function intersectsBox(box){var planes=this.planes;for(var i=0;i<6;i++){var plane=planes[i];p1.x=plane.normal.x>0?box.min.x:box.max.x;p2.x=plane.normal.x>0?box.max.x:box.min.x;p1.y=plane.normal.y>0?box.min.y:box.max.y;p2.y=plane.normal.y>0?box.max.y:box.min.y;p1.z=plane.normal.z>0?box.min.z:box.max.z;p2.z=plane.normal.z>0?box.max.z:box.min.z;var d1=plane.distanceToPoint(p1);var d2=plane.distanceToPoint(p2);// if both outside plane, no intersection
  if(d1<0&&d2<0){return false;}}return true;};}(),containsPoint:function containsPoint(point){var planes=this.planes;for(var i=0;i<6;i++){if(planes[i].distanceToPoint(point)<0){return false;}}return true;}});/**
   * @author alteredq / http://alteredqualia.com/
   * @author mrdoob / http://mrdoob.com/
   */function WebGLShadowMap(_renderer,_objects,maxTextureSize){var _frustum=new Frustum(),_projScreenMatrix=new Matrix4(),_shadowMapSize=new Vector2$1(),_maxShadowMapSize=new Vector2$1(maxTextureSize,maxTextureSize),_lookTarget=new Vector3$1(),_lightPositionWorld=new Vector3$1(),_MorphingFlag=1,_SkinningFlag=2,_NumberOfMaterialVariants=(_MorphingFlag|_SkinningFlag)+1,_depthMaterials=new Array(_NumberOfMaterialVariants),_distanceMaterials=new Array(_NumberOfMaterialVariants),_materialCache={};var cubeDirections=[new Vector3$1(1,0,0),new Vector3$1(-1,0,0),new Vector3$1(0,0,1),new Vector3$1(0,0,-1),new Vector3$1(0,1,0),new Vector3$1(0,-1,0)];var cubeUps=[new Vector3$1(0,1,0),new Vector3$1(0,1,0),new Vector3$1(0,1,0),new Vector3$1(0,1,0),new Vector3$1(0,0,1),new Vector3$1(0,0,-1)];var cube2DViewPorts=[new Vector4$1(),new Vector4$1(),new Vector4$1(),new Vector4$1(),new Vector4$1(),new Vector4$1()];// init
  for(var i=0;i!==_NumberOfMaterialVariants;++i){var useMorphing=(i&_MorphingFlag)!==0;var useSkinning=(i&_SkinningFlag)!==0;var depthMaterial=new MeshDepthMaterial({depthPacking:RGBADepthPacking,morphTargets:useMorphing,skinning:useSkinning});_depthMaterials[i]=depthMaterial;//
  var distanceMaterial=new MeshDistanceMaterial({morphTargets:useMorphing,skinning:useSkinning});_distanceMaterials[i]=distanceMaterial;}//
  var scope=this;this.enabled=false;this.autoUpdate=true;this.needsUpdate=false;this.type=PCFShadowMap;this.renderReverseSided=true;this.renderSingleSided=true;this.render=function(lights,scene,camera){if(scope.enabled===false){return;}if(scope.autoUpdate===false&&scope.needsUpdate===false){return;}if(lights.length===0){return;}// TODO Clean up (needed in case of contextlost)
  var _gl=_renderer.context;var _state=_renderer.state;// Set GL state for depth map.
  _state.disable(_gl.BLEND);_state.buffers.color.setClear(1,1,1,1);_state.buffers.depth.setTest(true);_state.setScissorTest(false);// render depth map
  var faceCount;for(var i=0,il=lights.length;i<il;i++){var light=lights[i];var shadow=light.shadow;var isPointLight=light&&light.isPointLight;if(shadow===undefined){console.warn('THREE.WebGLShadowMap:',light,'has no shadow.');continue;}var shadowCamera=shadow.camera;_shadowMapSize.copy(shadow.mapSize);_shadowMapSize.min(_maxShadowMapSize);if(isPointLight){var vpWidth=_shadowMapSize.x;var vpHeight=_shadowMapSize.y;// These viewports map a cube-map onto a 2D texture with the
  // following orientation:
  //
  //  xzXZ
  //   y Y
  //
  // X - Positive x direction
  // x - Negative x direction
  // Y - Positive y direction
  // y - Negative y direction
  // Z - Positive z direction
  // z - Negative z direction
  // positive X
  cube2DViewPorts[0].set(vpWidth*2,vpHeight,vpWidth,vpHeight);// negative X
  cube2DViewPorts[1].set(0,vpHeight,vpWidth,vpHeight);// positive Z
  cube2DViewPorts[2].set(vpWidth*3,vpHeight,vpWidth,vpHeight);// negative Z
  cube2DViewPorts[3].set(vpWidth,vpHeight,vpWidth,vpHeight);// positive Y
  cube2DViewPorts[4].set(vpWidth*3,0,vpWidth,vpHeight);// negative Y
  cube2DViewPorts[5].set(vpWidth,0,vpWidth,vpHeight);_shadowMapSize.x*=4.0;_shadowMapSize.y*=2.0;}if(shadow.map===null){var pars={minFilter:NearestFilter,magFilter:NearestFilter,format:RGBAFormat};shadow.map=new WebGLRenderTarget(_shadowMapSize.x,_shadowMapSize.y,pars);shadow.map.texture.name=light.name+".shadowMap";shadowCamera.updateProjectionMatrix();}if(shadow.isSpotLightShadow){shadow.update(light);}var shadowMap=shadow.map;var shadowMatrix=shadow.matrix;_lightPositionWorld.setFromMatrixPosition(light.matrixWorld);shadowCamera.position.copy(_lightPositionWorld);if(isPointLight){faceCount=6;// for point lights we set the shadow matrix to be a translation-only matrix
  // equal to inverse of the light's position
  shadowMatrix.makeTranslation(-_lightPositionWorld.x,-_lightPositionWorld.y,-_lightPositionWorld.z);}else{faceCount=1;_lookTarget.setFromMatrixPosition(light.target.matrixWorld);shadowCamera.lookAt(_lookTarget);shadowCamera.updateMatrixWorld();// compute shadow matrix
  shadowMatrix.set(0.5,0.0,0.0,0.5,0.0,0.5,0.0,0.5,0.0,0.0,0.5,0.5,0.0,0.0,0.0,1.0);shadowMatrix.multiply(shadowCamera.projectionMatrix);shadowMatrix.multiply(shadowCamera.matrixWorldInverse);}_renderer.setRenderTarget(shadowMap);_renderer.clear();// render shadow map for each cube face (if omni-directional) or
  // run a single pass if not
  for(var face=0;face<faceCount;face++){if(isPointLight){_lookTarget.copy(shadowCamera.position);_lookTarget.add(cubeDirections[face]);shadowCamera.up.copy(cubeUps[face]);shadowCamera.lookAt(_lookTarget);shadowCamera.updateMatrixWorld();var vpDimensions=cube2DViewPorts[face];_state.viewport(vpDimensions);}// update camera matrices and frustum
  _projScreenMatrix.multiplyMatrices(shadowCamera.projectionMatrix,shadowCamera.matrixWorldInverse);_frustum.setFromMatrix(_projScreenMatrix);// set object matrices & frustum culling
  renderObject(scene,camera,shadowCamera,isPointLight);}}scope.needsUpdate=false;};function getDepthMaterial(object,material,isPointLight,lightPositionWorld,shadowCameraNear,shadowCameraFar){var geometry=object.geometry;var result=null;var materialVariants=_depthMaterials;var customMaterial=object.customDepthMaterial;if(isPointLight){materialVariants=_distanceMaterials;customMaterial=object.customDistanceMaterial;}if(!customMaterial){var useMorphing=false;if(material.morphTargets){if(geometry&&geometry.isBufferGeometry){useMorphing=geometry.morphAttributes&&geometry.morphAttributes.position&&geometry.morphAttributes.position.length>0;}else if(geometry&&geometry.isGeometry){useMorphing=geometry.morphTargets&&geometry.morphTargets.length>0;}}if(object.isSkinnedMesh&&material.skinning===false){console.warn('THREE.WebGLShadowMap: THREE.SkinnedMesh with material.skinning set to false:',object);}var useSkinning=object.isSkinnedMesh&&material.skinning;var variantIndex=0;if(useMorphing){variantIndex|=_MorphingFlag;}if(useSkinning){variantIndex|=_SkinningFlag;}result=materialVariants[variantIndex];}else{result=customMaterial;}if(_renderer.localClippingEnabled&&material.clipShadows===true&&material.clippingPlanes.length!==0){// in this case we need a unique material instance reflecting the
  // appropriate state
  var keyA=result.uuid,keyB=material.uuid;var materialsForVariant=_materialCache[keyA];if(materialsForVariant===undefined){materialsForVariant={};_materialCache[keyA]=materialsForVariant;}var cachedMaterial=materialsForVariant[keyB];if(cachedMaterial===undefined){cachedMaterial=result.clone();materialsForVariant[keyB]=cachedMaterial;}result=cachedMaterial;}result.visible=material.visible;result.wireframe=material.wireframe;var side=material.side;if(scope.renderSingleSided&&side==DoubleSide){side=FrontSide;}if(scope.renderReverseSided){if(side===FrontSide){side=BackSide;}else if(side===BackSide){side=FrontSide;}}result.side=side;result.clipShadows=material.clipShadows;result.clippingPlanes=material.clippingPlanes;result.clipIntersection=material.clipIntersection;result.wireframeLinewidth=material.wireframeLinewidth;result.linewidth=material.linewidth;if(isPointLight&&result.isMeshDistanceMaterial){result.referencePosition.copy(lightPositionWorld);result.nearDistance=shadowCameraNear;result.farDistance=shadowCameraFar;}return result;}function renderObject(object,camera,shadowCamera,isPointLight){if(object.visible===false){return;}var visible=object.layers.test(camera.layers);if(visible&&(object.isMesh||object.isLine||object.isPoints)){if(object.castShadow&&(!object.frustumCulled||_frustum.intersectsObject(object))){object.modelViewMatrix.multiplyMatrices(shadowCamera.matrixWorldInverse,object.matrixWorld);var geometry=_objects.update(object);var material=object.material;if(Array.isArray(material)){var groups=geometry.groups;for(var k=0,kl=groups.length;k<kl;k++){var group=groups[k];var groupMaterial=material[group.materialIndex];if(groupMaterial&&groupMaterial.visible){var depthMaterial=getDepthMaterial(object,groupMaterial,isPointLight,_lightPositionWorld,shadowCamera.near,shadowCamera.far);_renderer.renderBufferDirect(shadowCamera,null,geometry,depthMaterial,object,group);}}}else if(material.visible){var depthMaterial=getDepthMaterial(object,material,isPointLight,_lightPositionWorld,shadowCamera.near,shadowCamera.far);_renderer.renderBufferDirect(shadowCamera,null,geometry,depthMaterial,object,null);}}}var children=object.children;for(var i=0,l=children.length;i<l;i++){renderObject(children[i],camera,shadowCamera,isPointLight);}}}/**
   * @author mrdoob / http://mrdoob.com/
   */function WebGLAttributes(gl){var buffers={};function createBuffer(attribute,bufferType){var array=attribute.array;var usage=attribute.dynamic?gl.DYNAMIC_DRAW:gl.STATIC_DRAW;var buffer=gl.createBuffer();gl.bindBuffer(bufferType,buffer);gl.bufferData(bufferType,array,usage);attribute.onUploadCallback();var type=gl.FLOAT;if(array instanceof Float32Array){type=gl.FLOAT;}else if(array instanceof Float64Array){console.warn('THREE.WebGLAttributes: Unsupported data buffer format: Float64Array.');}else if(array instanceof Uint16Array){type=gl.UNSIGNED_SHORT;}else if(array instanceof Int16Array){type=gl.SHORT;}else if(array instanceof Uint32Array){type=gl.UNSIGNED_INT;}else if(array instanceof Int32Array){type=gl.INT;}else if(array instanceof Int8Array){type=gl.BYTE;}else if(array instanceof Uint8Array){type=gl.UNSIGNED_BYTE;}return{buffer:buffer,type:type,bytesPerElement:array.BYTES_PER_ELEMENT,version:attribute.version};}function updateBuffer(buffer,attribute,bufferType){var array=attribute.array;var updateRange=attribute.updateRange;gl.bindBuffer(bufferType,buffer);if(attribute.dynamic===false){gl.bufferData(bufferType,array,gl.STATIC_DRAW);}else if(updateRange.count===-1){// Not using update ranges
  gl.bufferSubData(bufferType,0,array);}else if(updateRange.count===0){console.error('THREE.WebGLObjects.updateBuffer: dynamic THREE.BufferAttribute marked as needsUpdate but updateRange.count is 0, ensure you are using set methods or updating manually.');}else{gl.bufferSubData(bufferType,updateRange.offset*array.BYTES_PER_ELEMENT,array.subarray(updateRange.offset,updateRange.offset+updateRange.count));updateRange.count=-1;// reset range
  }}//
  function get$$1(attribute){if(attribute.isInterleavedBufferAttribute){attribute=attribute.data;}return buffers[attribute.uuid];}function remove(attribute){if(attribute.isInterleavedBufferAttribute){attribute=attribute.data;}var data=buffers[attribute.uuid];if(data){gl.deleteBuffer(data.buffer);delete buffers[attribute.uuid];}}function update(attribute,bufferType){if(attribute.isInterleavedBufferAttribute){attribute=attribute.data;}var data=buffers[attribute.uuid];if(data===undefined){buffers[attribute.uuid]=createBuffer(attribute,bufferType);}else if(data.version<attribute.version){updateBuffer(data.buffer,attribute,bufferType);data.version=attribute.version;}}return{get:get$$1,remove:remove,update:update};}/**
   * @author mrdoob / http://mrdoob.com/
   */function WebGLBackground(renderer,state,geometries,premultipliedAlpha){var clearColor=new Color$1(0x000000);var clearAlpha=0;var planeCamera,planeMesh;var boxMesh;function render(renderList,scene,camera,forceClear){var background=scene.background;if(background===null){setClear(clearColor,clearAlpha);}else if(background&&background.isColor){setClear(background,1);forceClear=true;}if(renderer.autoClear||forceClear){renderer.clear(renderer.autoClearColor,renderer.autoClearDepth,renderer.autoClearStencil);}if(background&&background.isCubeTexture){if(boxMesh===undefined){boxMesh=new Mesh(new BoxBufferGeometry(1,1,1),new ShaderMaterial({uniforms:ShaderLib.cube.uniforms,vertexShader:ShaderLib.cube.vertexShader,fragmentShader:ShaderLib.cube.fragmentShader,side:BackSide,depthTest:true,depthWrite:false,fog:false}));boxMesh.geometry.removeAttribute('normal');boxMesh.geometry.removeAttribute('uv');boxMesh.onBeforeRender=function(renderer,scene,camera){this.matrixWorld.copyPosition(camera.matrixWorld);};geometries.update(boxMesh.geometry);}boxMesh.material.uniforms.tCube.value=background;renderList.push(boxMesh,boxMesh.geometry,boxMesh.material,0,null);}else if(background&&background.isTexture){if(planeCamera===undefined){planeCamera=new OrthographicCamera(-1,1,1,-1,0,1);planeMesh=new Mesh(new PlaneBufferGeometry(2,2),new MeshBasicMaterial({depthTest:false,depthWrite:false,fog:false}));geometries.update(planeMesh.geometry);}planeMesh.material.map=background;// TODO Push this to renderList
  renderer.renderBufferDirect(planeCamera,null,planeMesh.geometry,planeMesh.material,planeMesh,null);}}function setClear(color,alpha){state.buffers.color.setClear(color.r,color.g,color.b,alpha,premultipliedAlpha);}return{getClearColor:function getClearColor(){return clearColor;},setClearColor:function setClearColor(color,alpha){clearColor.set(color);clearAlpha=alpha!==undefined?alpha:1;setClear(clearColor,clearAlpha);},getClearAlpha:function getClearAlpha(){return clearAlpha;},setClearAlpha:function setClearAlpha(alpha){clearAlpha=alpha;setClear(clearColor,clearAlpha);},render:render};}/**
   * @author mrdoob / http://mrdoob.com/
   */function painterSortStable(a,b){if(a.renderOrder!==b.renderOrder){return a.renderOrder-b.renderOrder;}else if(a.program&&b.program&&a.program!==b.program){return a.program.id-b.program.id;}else if(a.material.id!==b.material.id){return a.material.id-b.material.id;}else if(a.z!==b.z){return a.z-b.z;}else{return a.id-b.id;}}function reversePainterSortStable(a,b){if(a.renderOrder!==b.renderOrder){return a.renderOrder-b.renderOrder;}if(a.z!==b.z){return b.z-a.z;}else{return a.id-b.id;}}function WebGLRenderList(){var renderItems=[];var renderItemsIndex=0;var opaque=[];var transparent=[];function init(){renderItemsIndex=0;opaque.length=0;transparent.length=0;}function push(object,geometry,material,z,group){var renderItem=renderItems[renderItemsIndex];if(renderItem===undefined){renderItem={id:object.id,object:object,geometry:geometry,material:material,program:material.program,renderOrder:object.renderOrder,z:z,group:group};renderItems[renderItemsIndex]=renderItem;}else{renderItem.id=object.id;renderItem.object=object;renderItem.geometry=geometry;renderItem.material=material;renderItem.program=material.program;renderItem.renderOrder=object.renderOrder;renderItem.z=z;renderItem.group=group;}(material.transparent===true?transparent:opaque).push(renderItem);renderItemsIndex++;}function sort(){if(opaque.length>1){opaque.sort(painterSortStable);}if(transparent.length>1){transparent.sort(reversePainterSortStable);}}return{opaque:opaque,transparent:transparent,init:init,push:push,sort:sort};}function WebGLRenderLists(){var lists={};function get$$1(scene,camera){var hash=scene.id+','+camera.id;var list=lists[hash];if(list===undefined){// console.log( 'THREE.WebGLRenderLists:', hash );
  list=new WebGLRenderList();lists[hash]=list;}return list;}function dispose(){lists={};}return{get:get$$1,dispose:dispose};}/**
   * @author mrdoob / http://mrdoob.com/
   */function absNumericalSort(a,b){return Math.abs(b[1])-Math.abs(a[1]);}function WebGLMorphtargets(gl){var influencesList={};var morphInfluences=new Float32Array(8);function update(object,geometry,material,program){var objectInfluences=object.morphTargetInfluences;var length=objectInfluences.length;var influences=influencesList[geometry.id];if(influences===undefined){// initialise list
  influences=[];for(var i=0;i<length;i++){influences[i]=[i,0];}influencesList[geometry.id]=influences;}var morphTargets=material.morphTargets&&geometry.morphAttributes.position;var morphNormals=material.morphNormals&&geometry.morphAttributes.normal;// Remove current morphAttributes
  for(var i=0;i<length;i++){var influence=influences[i];if(influence[1]!==0){if(morphTargets){geometry.removeAttribute('morphTarget'+i);}if(morphNormals){geometry.removeAttribute('morphNormal'+i);}}}// Collect influences
  for(var i=0;i<length;i++){var influence=influences[i];influence[0]=i;influence[1]=objectInfluences[i];}influences.sort(absNumericalSort);// Add morphAttributes
  for(var i=0;i<8;i++){var influence=influences[i];if(influence){var index=influence[0];var value=influence[1];if(value){if(morphTargets){geometry.addAttribute('morphTarget'+i,morphTargets[index]);}if(morphNormals){geometry.addAttribute('morphNormal'+i,morphNormals[index]);}morphInfluences[i]=value;continue;}}morphInfluences[i]=0;}program.getUniforms().setValue(gl,'morphTargetInfluences',morphInfluences);}return{update:update};}/**
   * @author mrdoob / http://mrdoob.com/
   */function WebGLIndexedBufferRenderer(gl,extensions,infoRender){var mode;function setMode(value){mode=value;}var type,bytesPerElement;function setIndex(value){type=value.type;bytesPerElement=value.bytesPerElement;}function render(start,count){gl.drawElements(mode,count,type,start*bytesPerElement);infoRender.calls++;infoRender.vertices+=count;if(mode===gl.TRIANGLES){infoRender.faces+=count/3;}else if(mode===gl.POINTS){infoRender.points+=count;}}function renderInstances(geometry,start,count){var extension=extensions.get('ANGLE_instanced_arrays');if(extension===null){console.error('THREE.WebGLIndexedBufferRenderer: using THREE.InstancedBufferGeometry but hardware does not support extension ANGLE_instanced_arrays.');return;}extension.drawElementsInstancedANGLE(mode,count,type,start*bytesPerElement,geometry.maxInstancedCount);infoRender.calls++;infoRender.vertices+=count*geometry.maxInstancedCount;if(mode===gl.TRIANGLES){infoRender.faces+=geometry.maxInstancedCount*count/3;}else if(mode===gl.POINTS){infoRender.points+=geometry.maxInstancedCount*count;}}//
  this.setMode=setMode;this.setIndex=setIndex;this.render=render;this.renderInstances=renderInstances;}/**
   * @author mrdoob / http://mrdoob.com/
   */function WebGLBufferRenderer(gl,extensions,infoRender){var mode;function setMode(value){mode=value;}function render(start,count){gl.drawArrays(mode,start,count);infoRender.calls++;infoRender.vertices+=count;if(mode===gl.TRIANGLES){infoRender.faces+=count/3;}else if(mode===gl.POINTS){infoRender.points+=count;}}function renderInstances(geometry,start,count){var extension=extensions.get('ANGLE_instanced_arrays');if(extension===null){console.error('THREE.WebGLBufferRenderer: using THREE.InstancedBufferGeometry but hardware does not support extension ANGLE_instanced_arrays.');return;}var position=geometry.attributes.position;if(position.isInterleavedBufferAttribute){count=position.data.count;extension.drawArraysInstancedANGLE(mode,0,count,geometry.maxInstancedCount);}else{extension.drawArraysInstancedANGLE(mode,start,count,geometry.maxInstancedCount);}infoRender.calls++;infoRender.vertices+=count*geometry.maxInstancedCount;if(mode===gl.TRIANGLES){infoRender.faces+=geometry.maxInstancedCount*count/3;}else if(mode===gl.POINTS){infoRender.points+=geometry.maxInstancedCount*count;}}//
  this.setMode=setMode;this.render=render;this.renderInstances=renderInstances;}/**
   * @author mrdoob / http://mrdoob.com/
   */function WebGLGeometries(gl,attributes,infoMemory){var geometries={};var wireframeAttributes={};function onGeometryDispose(event){var geometry=event.target;var buffergeometry=geometries[geometry.id];if(buffergeometry.index!==null){attributes.remove(buffergeometry.index);}for(var name in buffergeometry.attributes){attributes.remove(buffergeometry.attributes[name]);}geometry.removeEventListener('dispose',onGeometryDispose);delete geometries[geometry.id];// TODO Remove duplicate code
  var attribute=wireframeAttributes[geometry.id];if(attribute){attributes.remove(attribute);delete wireframeAttributes[geometry.id];}attribute=wireframeAttributes[buffergeometry.id];if(attribute){attributes.remove(attribute);delete wireframeAttributes[buffergeometry.id];}//
  infoMemory.geometries--;}function get$$1(object,geometry){var buffergeometry=geometries[geometry.id];if(buffergeometry){return buffergeometry;}geometry.addEventListener('dispose',onGeometryDispose);if(geometry.isBufferGeometry){buffergeometry=geometry;}else if(geometry.isGeometry){if(geometry._bufferGeometry===undefined){geometry._bufferGeometry=new BufferGeometry().setFromObject(object);}buffergeometry=geometry._bufferGeometry;}geometries[geometry.id]=buffergeometry;infoMemory.geometries++;return buffergeometry;}function update(geometry){var index=geometry.index;var geometryAttributes=geometry.attributes;if(index!==null){attributes.update(index,gl.ELEMENT_ARRAY_BUFFER);}for(var name in geometryAttributes){attributes.update(geometryAttributes[name],gl.ARRAY_BUFFER);}// morph targets
  var morphAttributes=geometry.morphAttributes;for(var name in morphAttributes){var array=morphAttributes[name];for(var i=0,l=array.length;i<l;i++){attributes.update(array[i],gl.ARRAY_BUFFER);}}}function getWireframeAttribute(geometry){var attribute=wireframeAttributes[geometry.id];if(attribute){return attribute;}var indices=[];var geometryIndex=geometry.index;var geometryAttributes=geometry.attributes;// console.time( 'wireframe' );
  if(geometryIndex!==null){var array=geometryIndex.array;for(var i=0,l=array.length;i<l;i+=3){var a=array[i+0];var b=array[i+1];var c=array[i+2];indices.push(a,b,b,c,c,a);}}else{var array=geometryAttributes.position.array;for(var i=0,l=array.length/3-1;i<l;i+=3){var a=i+0;var b=i+1;var c=i+2;indices.push(a,b,b,c,c,a);}}// console.timeEnd( 'wireframe' );
  attribute=new(arrayMax(indices)>65535?Uint32BufferAttribute:Uint16BufferAttribute)(indices,1);attributes.update(attribute,gl.ELEMENT_ARRAY_BUFFER);wireframeAttributes[geometry.id]=attribute;return attribute;}return{get:get$$1,update:update,getWireframeAttribute:getWireframeAttribute};}/**
   * @author mrdoob / http://mrdoob.com/
   */function UniformsCache(){var lights={};return{get:function get$$1(light){if(lights[light.id]!==undefined){return lights[light.id];}var uniforms;switch(light.type){case'DirectionalLight':uniforms={direction:new Vector3$1(),color:new Color$1(),shadow:false,shadowBias:0,shadowRadius:1,shadowMapSize:new Vector2$1()};break;case'SpotLight':uniforms={position:new Vector3$1(),direction:new Vector3$1(),color:new Color$1(),distance:0,coneCos:0,penumbraCos:0,decay:0,shadow:false,shadowBias:0,shadowRadius:1,shadowMapSize:new Vector2$1()};break;case'PointLight':uniforms={position:new Vector3$1(),color:new Color$1(),distance:0,decay:0,shadow:false,shadowBias:0,shadowRadius:1,shadowMapSize:new Vector2$1(),shadowCameraNear:1,shadowCameraFar:1000};break;case'HemisphereLight':uniforms={direction:new Vector3$1(),skyColor:new Color$1(),groundColor:new Color$1()};break;case'RectAreaLight':uniforms={color:new Color$1(),position:new Vector3$1(),halfWidth:new Vector3$1(),halfHeight:new Vector3$1()// TODO (abelnation): set RectAreaLight shadow uniforms
  };break;}lights[light.id]=uniforms;return uniforms;}};}function WebGLLights(){var cache=new UniformsCache();var state={hash:'',ambient:[0,0,0],directional:[],directionalShadowMap:[],directionalShadowMatrix:[],spot:[],spotShadowMap:[],spotShadowMatrix:[],rectArea:[],point:[],pointShadowMap:[],pointShadowMatrix:[],hemi:[]};var vector3=new Vector3$1();var matrix4=new Matrix4();var matrix42=new Matrix4();function setup(lights,shadows,camera){var r=0,g=0,b=0;var directionalLength=0;var pointLength=0;var spotLength=0;var rectAreaLength=0;var hemiLength=0;var viewMatrix=camera.matrixWorldInverse;for(var i=0,l=lights.length;i<l;i++){var light=lights[i];var color=light.color;var intensity=light.intensity;var distance=light.distance;var shadowMap=light.shadow&&light.shadow.map?light.shadow.map.texture:null;if(light.isAmbientLight){r+=color.r*intensity;g+=color.g*intensity;b+=color.b*intensity;}else if(light.isDirectionalLight){var uniforms=cache.get(light);uniforms.color.copy(light.color).multiplyScalar(light.intensity);uniforms.direction.setFromMatrixPosition(light.matrixWorld);vector3.setFromMatrixPosition(light.target.matrixWorld);uniforms.direction.sub(vector3);uniforms.direction.transformDirection(viewMatrix);uniforms.shadow=light.castShadow;if(light.castShadow){var shadow=light.shadow;uniforms.shadowBias=shadow.bias;uniforms.shadowRadius=shadow.radius;uniforms.shadowMapSize=shadow.mapSize;}state.directionalShadowMap[directionalLength]=shadowMap;state.directionalShadowMatrix[directionalLength]=light.shadow.matrix;state.directional[directionalLength]=uniforms;directionalLength++;}else if(light.isSpotLight){var uniforms=cache.get(light);uniforms.position.setFromMatrixPosition(light.matrixWorld);uniforms.position.applyMatrix4(viewMatrix);uniforms.color.copy(color).multiplyScalar(intensity);uniforms.distance=distance;uniforms.direction.setFromMatrixPosition(light.matrixWorld);vector3.setFromMatrixPosition(light.target.matrixWorld);uniforms.direction.sub(vector3);uniforms.direction.transformDirection(viewMatrix);uniforms.coneCos=Math.cos(light.angle);uniforms.penumbraCos=Math.cos(light.angle*(1-light.penumbra));uniforms.decay=light.distance===0?0.0:light.decay;uniforms.shadow=light.castShadow;if(light.castShadow){var shadow=light.shadow;uniforms.shadowBias=shadow.bias;uniforms.shadowRadius=shadow.radius;uniforms.shadowMapSize=shadow.mapSize;}state.spotShadowMap[spotLength]=shadowMap;state.spotShadowMatrix[spotLength]=light.shadow.matrix;state.spot[spotLength]=uniforms;spotLength++;}else if(light.isRectAreaLight){var uniforms=cache.get(light);// (a) intensity controls irradiance of entire light
  uniforms.color.copy(color).multiplyScalar(intensity/(light.width*light.height));// (b) intensity controls the radiance per light area
  // uniforms.color.copy( color ).multiplyScalar( intensity );
  uniforms.position.setFromMatrixPosition(light.matrixWorld);uniforms.position.applyMatrix4(viewMatrix);// extract local rotation of light to derive width/height half vectors
  matrix42.identity();matrix4.copy(light.matrixWorld);matrix4.premultiply(viewMatrix);matrix42.extractRotation(matrix4);uniforms.halfWidth.set(light.width*0.5,0.0,0.0);uniforms.halfHeight.set(0.0,light.height*0.5,0.0);uniforms.halfWidth.applyMatrix4(matrix42);uniforms.halfHeight.applyMatrix4(matrix42);// TODO (abelnation): RectAreaLight distance?
  // uniforms.distance = distance;
  state.rectArea[rectAreaLength]=uniforms;rectAreaLength++;}else if(light.isPointLight){var uniforms=cache.get(light);uniforms.position.setFromMatrixPosition(light.matrixWorld);uniforms.position.applyMatrix4(viewMatrix);uniforms.color.copy(light.color).multiplyScalar(light.intensity);uniforms.distance=light.distance;uniforms.decay=light.distance===0?0.0:light.decay;uniforms.shadow=light.castShadow;if(light.castShadow){var shadow=light.shadow;uniforms.shadowBias=shadow.bias;uniforms.shadowRadius=shadow.radius;uniforms.shadowMapSize=shadow.mapSize;uniforms.shadowCameraNear=shadow.camera.near;uniforms.shadowCameraFar=shadow.camera.far;}state.pointShadowMap[pointLength]=shadowMap;state.pointShadowMatrix[pointLength]=light.shadow.matrix;state.point[pointLength]=uniforms;pointLength++;}else if(light.isHemisphereLight){var uniforms=cache.get(light);uniforms.direction.setFromMatrixPosition(light.matrixWorld);uniforms.direction.transformDirection(viewMatrix);uniforms.direction.normalize();uniforms.skyColor.copy(light.color).multiplyScalar(intensity);uniforms.groundColor.copy(light.groundColor).multiplyScalar(intensity);state.hemi[hemiLength]=uniforms;hemiLength++;}}state.ambient[0]=r;state.ambient[1]=g;state.ambient[2]=b;state.directional.length=directionalLength;state.spot.length=spotLength;state.rectArea.length=rectAreaLength;state.point.length=pointLength;state.hemi.length=hemiLength;// TODO (sam-g-steel) why aren't we using join
  state.hash=directionalLength+','+pointLength+','+spotLength+','+rectAreaLength+','+hemiLength+','+shadows.length;}return{setup:setup,state:state};}/**
   * @author mrdoob / http://mrdoob.com/
   */function WebGLObjects(geometries,infoRender){var updateList={};function update(object){var frame=infoRender.frame;var geometry=object.geometry;var buffergeometry=geometries.get(object,geometry);// Update once per frame
  if(updateList[buffergeometry.id]!==frame){if(geometry.isGeometry){buffergeometry.updateFromObject(object);}geometries.update(buffergeometry);updateList[buffergeometry.id]=frame;}return buffergeometry;}function clear(){updateList={};}return{update:update,clear:clear};}/**
   * @author mrdoob / http://mrdoob.com/
   */function addLineNumbers(string){var lines=string.split('\n');for(var i=0;i<lines.length;i++){lines[i]=i+1+': '+lines[i];}return lines.join('\n');}function WebGLShader(gl,type,string){var shader=gl.createShader(type);gl.shaderSource(shader,string);gl.compileShader(shader);if(gl.getShaderParameter(shader,gl.COMPILE_STATUS)===false){console.error('THREE.WebGLShader: Shader couldn\'t compile.');}if(gl.getShaderInfoLog(shader)!==''){console.warn('THREE.WebGLShader: gl.getShaderInfoLog()',type===gl.VERTEX_SHADER?'vertex':'fragment',gl.getShaderInfoLog(shader),addLineNumbers(string));}// --enable-privileged-webgl-extension
  // console.log( type, gl.getExtension( 'WEBGL_debug_shaders' ).getTranslatedShaderSource( shader ) );
  return shader;}/**
   * @author mrdoob / http://mrdoob.com/
   */var programIdCount=0;function getEncodingComponents(encoding){switch(encoding){case LinearEncoding:return['Linear','( value )'];case sRGBEncoding:return['sRGB','( value )'];case RGBEEncoding:return['RGBE','( value )'];case RGBM7Encoding:return['RGBM','( value, 7.0 )'];case RGBM16Encoding:return['RGBM','( value, 16.0 )'];case RGBDEncoding:return['RGBD','( value, 256.0 )'];case GammaEncoding:return['Gamma','( value, float( GAMMA_FACTOR ) )'];default:throw new Error('unsupported encoding: '+encoding);}}function getTexelDecodingFunction(functionName,encoding){var components=getEncodingComponents(encoding);return'vec4 '+functionName+'( vec4 value ) { return '+components[0]+'ToLinear'+components[1]+'; }';}function getTexelEncodingFunction(functionName,encoding){var components=getEncodingComponents(encoding);return'vec4 '+functionName+'( vec4 value ) { return LinearTo'+components[0]+components[1]+'; }';}function getToneMappingFunction(functionName,toneMapping){var toneMappingName;switch(toneMapping){case LinearToneMapping:toneMappingName='Linear';break;case ReinhardToneMapping:toneMappingName='Reinhard';break;case Uncharted2ToneMapping:toneMappingName='Uncharted2';break;case CineonToneMapping:toneMappingName='OptimizedCineon';break;default:throw new Error('unsupported toneMapping: '+toneMapping);}return'vec3 '+functionName+'( vec3 color ) { return '+toneMappingName+'ToneMapping( color ); }';}function generateExtensions(extensions,parameters,rendererExtensions){extensions=extensions||{};var chunks=[extensions.derivatives||parameters.envMapCubeUV||parameters.bumpMap||parameters.normalMap||parameters.flatShading?'#extension GL_OES_standard_derivatives : enable':'',(extensions.fragDepth||parameters.logarithmicDepthBuffer)&&rendererExtensions.get('EXT_frag_depth')?'#extension GL_EXT_frag_depth : enable':'',extensions.drawBuffers&&rendererExtensions.get('WEBGL_draw_buffers')?'#extension GL_EXT_draw_buffers : require':'',(extensions.shaderTextureLOD||parameters.envMap)&&rendererExtensions.get('EXT_shader_texture_lod')?'#extension GL_EXT_shader_texture_lod : enable':''];return chunks.filter(filterEmptyLine).join('\n');}function generateDefines(defines){var chunks=[];for(var name in defines){var value=defines[name];if(value===false){continue;}chunks.push('#define '+name+' '+value);}return chunks.join('\n');}function fetchAttributeLocations(gl,program){var attributes={};var n=gl.getProgramParameter(program,gl.ACTIVE_ATTRIBUTES);for(var i=0;i<n;i++){var info=gl.getActiveAttrib(program,i);var name=info.name;// console.log( 'THREE.WebGLProgram: ACTIVE VERTEX ATTRIBUTE:', name, i );
  attributes[name]=gl.getAttribLocation(program,name);}return attributes;}function filterEmptyLine(string){return string!=='';}function replaceLightNums(string,parameters){return string.replace(/NUM_DIR_LIGHTS/g,parameters.numDirLights).replace(/NUM_SPOT_LIGHTS/g,parameters.numSpotLights).replace(/NUM_RECT_AREA_LIGHTS/g,parameters.numRectAreaLights).replace(/NUM_POINT_LIGHTS/g,parameters.numPointLights).replace(/NUM_HEMI_LIGHTS/g,parameters.numHemiLights);}function parseIncludes(string){var pattern=/^[ \t]*#include +<([\w\d.]+)>/gm;function replace(match,include){var replace=ShaderChunk[include];if(replace===undefined){throw new Error('Can not resolve #include <'+include+'>');}return parseIncludes(replace);}return string.replace(pattern,replace);}function unrollLoops(string){var pattern=/for \( int i \= (\d+)\; i < (\d+)\; i \+\+ \) \{([\s\S]+?)(?=\})\}/g;function replace(match,start,end,snippet){var unroll='';for(var i=parseInt(start);i<parseInt(end);i++){unroll+=snippet.replace(/\[ i \]/g,'[ '+i+' ]');}return unroll;}return string.replace(pattern,replace);}function WebGLProgram(renderer,extensions,code,material,shader,parameters){var gl=renderer.context;var defines=material.defines;var vertexShader=shader.vertexShader;var fragmentShader=shader.fragmentShader;var shadowMapTypeDefine='SHADOWMAP_TYPE_BASIC';if(parameters.shadowMapType===PCFShadowMap){shadowMapTypeDefine='SHADOWMAP_TYPE_PCF';}else if(parameters.shadowMapType===PCFSoftShadowMap){shadowMapTypeDefine='SHADOWMAP_TYPE_PCF_SOFT';}var envMapTypeDefine='ENVMAP_TYPE_CUBE';var envMapModeDefine='ENVMAP_MODE_REFLECTION';var envMapBlendingDefine='ENVMAP_BLENDING_MULTIPLY';if(parameters.envMap){switch(material.envMap.mapping){case CubeReflectionMapping:case CubeRefractionMapping:envMapTypeDefine='ENVMAP_TYPE_CUBE';break;case CubeUVReflectionMapping:case CubeUVRefractionMapping:envMapTypeDefine='ENVMAP_TYPE_CUBE_UV';break;case EquirectangularReflectionMapping:case EquirectangularRefractionMapping:envMapTypeDefine='ENVMAP_TYPE_EQUIREC';break;case SphericalReflectionMapping:envMapTypeDefine='ENVMAP_TYPE_SPHERE';break;}switch(material.envMap.mapping){case CubeRefractionMapping:case EquirectangularRefractionMapping:envMapModeDefine='ENVMAP_MODE_REFRACTION';break;}switch(material.combine){case MultiplyOperation:envMapBlendingDefine='ENVMAP_BLENDING_MULTIPLY';break;case MixOperation:envMapBlendingDefine='ENVMAP_BLENDING_MIX';break;case AddOperation:envMapBlendingDefine='ENVMAP_BLENDING_ADD';break;}}var gammaFactorDefine=renderer.gammaFactor>0?renderer.gammaFactor:1.0;// console.log( 'building new program ' );
  //
  var customExtensions=generateExtensions(material.extensions,parameters,extensions);var customDefines=generateDefines(defines);//
  var program=gl.createProgram();var prefixVertex,prefixFragment;if(material.isRawShaderMaterial){prefixVertex=[customDefines].filter(filterEmptyLine).join('\n');if(prefixVertex.length>0){prefixVertex+='\n';}prefixFragment=[customExtensions,customDefines].filter(filterEmptyLine).join('\n');if(prefixFragment.length>0){prefixFragment+='\n';}}else{prefixVertex=['precision '+parameters.precision+' float;','precision '+parameters.precision+' int;','#define SHADER_NAME '+shader.name,customDefines,parameters.supportsVertexTextures?'#define VERTEX_TEXTURES':'','#define GAMMA_FACTOR '+gammaFactorDefine,'#define MAX_BONES '+parameters.maxBones,parameters.useFog&&parameters.fog?'#define USE_FOG':'',parameters.useFog&&parameters.fogExp?'#define FOG_EXP2':'',parameters.map?'#define USE_MAP':'',parameters.envMap?'#define USE_ENVMAP':'',parameters.envMap?'#define '+envMapModeDefine:'',parameters.lightMap?'#define USE_LIGHTMAP':'',parameters.aoMap?'#define USE_AOMAP':'',parameters.emissiveMap?'#define USE_EMISSIVEMAP':'',parameters.bumpMap?'#define USE_BUMPMAP':'',parameters.normalMap?'#define USE_NORMALMAP':'',parameters.displacementMap&&parameters.supportsVertexTextures?'#define USE_DISPLACEMENTMAP':'',parameters.specularMap?'#define USE_SPECULARMAP':'',parameters.roughnessMap?'#define USE_ROUGHNESSMAP':'',parameters.metalnessMap?'#define USE_METALNESSMAP':'',parameters.alphaMap?'#define USE_ALPHAMAP':'',parameters.vertexColors?'#define USE_COLOR':'',parameters.flatShading?'#define FLAT_SHADED':'',parameters.skinning?'#define USE_SKINNING':'',parameters.useVertexTexture?'#define BONE_TEXTURE':'',parameters.morphTargets?'#define USE_MORPHTARGETS':'',parameters.morphNormals&&parameters.flatShading===false?'#define USE_MORPHNORMALS':'',parameters.doubleSided?'#define DOUBLE_SIDED':'',parameters.flipSided?'#define FLIP_SIDED':'','#define NUM_CLIPPING_PLANES '+parameters.numClippingPlanes,parameters.shadowMapEnabled?'#define USE_SHADOWMAP':'',parameters.shadowMapEnabled?'#define '+shadowMapTypeDefine:'',parameters.sizeAttenuation?'#define USE_SIZEATTENUATION':'',parameters.logarithmicDepthBuffer?'#define USE_LOGDEPTHBUF':'',parameters.logarithmicDepthBuffer&&extensions.get('EXT_frag_depth')?'#define USE_LOGDEPTHBUF_EXT':'','uniform mat4 modelMatrix;','uniform mat4 modelViewMatrix;','uniform mat4 projectionMatrix;','uniform mat4 viewMatrix;','uniform mat3 normalMatrix;','uniform vec3 cameraPosition;','attribute vec3 position;','attribute vec3 normal;','attribute vec2 uv;','#ifdef USE_COLOR','	attribute vec3 color;','#endif','#ifdef USE_MORPHTARGETS','	attribute vec3 morphTarget0;','	attribute vec3 morphTarget1;','	attribute vec3 morphTarget2;','	attribute vec3 morphTarget3;','	#ifdef USE_MORPHNORMALS','		attribute vec3 morphNormal0;','		attribute vec3 morphNormal1;','		attribute vec3 morphNormal2;','		attribute vec3 morphNormal3;','	#else','		attribute vec3 morphTarget4;','		attribute vec3 morphTarget5;','		attribute vec3 morphTarget6;','		attribute vec3 morphTarget7;','	#endif','#endif','#ifdef USE_SKINNING','	attribute vec4 skinIndex;','	attribute vec4 skinWeight;','#endif','\n'].filter(filterEmptyLine).join('\n');prefixFragment=[customExtensions,'precision '+parameters.precision+' float;','precision '+parameters.precision+' int;','#define SHADER_NAME '+shader.name,customDefines,parameters.alphaTest?'#define ALPHATEST '+parameters.alphaTest:'','#define GAMMA_FACTOR '+gammaFactorDefine,parameters.useFog&&parameters.fog?'#define USE_FOG':'',parameters.useFog&&parameters.fogExp?'#define FOG_EXP2':'',parameters.map?'#define USE_MAP':'',parameters.envMap?'#define USE_ENVMAP':'',parameters.envMap?'#define '+envMapTypeDefine:'',parameters.envMap?'#define '+envMapModeDefine:'',parameters.envMap?'#define '+envMapBlendingDefine:'',parameters.lightMap?'#define USE_LIGHTMAP':'',parameters.aoMap?'#define USE_AOMAP':'',parameters.emissiveMap?'#define USE_EMISSIVEMAP':'',parameters.bumpMap?'#define USE_BUMPMAP':'',parameters.normalMap?'#define USE_NORMALMAP':'',parameters.specularMap?'#define USE_SPECULARMAP':'',parameters.roughnessMap?'#define USE_ROUGHNESSMAP':'',parameters.metalnessMap?'#define USE_METALNESSMAP':'',parameters.alphaMap?'#define USE_ALPHAMAP':'',parameters.vertexColors?'#define USE_COLOR':'',parameters.gradientMap?'#define USE_GRADIENTMAP':'',parameters.flatShading?'#define FLAT_SHADED':'',parameters.doubleSided?'#define DOUBLE_SIDED':'',parameters.flipSided?'#define FLIP_SIDED':'','#define NUM_CLIPPING_PLANES '+parameters.numClippingPlanes,'#define UNION_CLIPPING_PLANES '+(parameters.numClippingPlanes-parameters.numClipIntersection),parameters.shadowMapEnabled?'#define USE_SHADOWMAP':'',parameters.shadowMapEnabled?'#define '+shadowMapTypeDefine:'',parameters.premultipliedAlpha?'#define PREMULTIPLIED_ALPHA':'',parameters.physicallyCorrectLights?'#define PHYSICALLY_CORRECT_LIGHTS':'',parameters.logarithmicDepthBuffer?'#define USE_LOGDEPTHBUF':'',parameters.logarithmicDepthBuffer&&extensions.get('EXT_frag_depth')?'#define USE_LOGDEPTHBUF_EXT':'',parameters.envMap&&extensions.get('EXT_shader_texture_lod')?'#define TEXTURE_LOD_EXT':'','uniform mat4 viewMatrix;','uniform vec3 cameraPosition;',parameters.toneMapping!==NoToneMapping?'#define TONE_MAPPING':'',parameters.toneMapping!==NoToneMapping?ShaderChunk['tonemapping_pars_fragment']:'',// this code is required here because it is used by the toneMapping() function defined below
  parameters.toneMapping!==NoToneMapping?getToneMappingFunction('toneMapping',parameters.toneMapping):'',parameters.dithering?'#define DITHERING':'',parameters.outputEncoding||parameters.mapEncoding||parameters.envMapEncoding||parameters.emissiveMapEncoding?ShaderChunk['encodings_pars_fragment']:'',// this code is required here because it is used by the various encoding/decoding function defined below
  parameters.mapEncoding?getTexelDecodingFunction('mapTexelToLinear',parameters.mapEncoding):'',parameters.envMapEncoding?getTexelDecodingFunction('envMapTexelToLinear',parameters.envMapEncoding):'',parameters.emissiveMapEncoding?getTexelDecodingFunction('emissiveMapTexelToLinear',parameters.emissiveMapEncoding):'',parameters.outputEncoding?getTexelEncodingFunction('linearToOutputTexel',parameters.outputEncoding):'',parameters.depthPacking?'#define DEPTH_PACKING '+material.depthPacking:'','\n'].filter(filterEmptyLine).join('\n');}vertexShader=parseIncludes(vertexShader);vertexShader=replaceLightNums(vertexShader,parameters);fragmentShader=parseIncludes(fragmentShader);fragmentShader=replaceLightNums(fragmentShader,parameters);if(!material.isShaderMaterial){vertexShader=unrollLoops(vertexShader);fragmentShader=unrollLoops(fragmentShader);}var vertexGlsl=prefixVertex+vertexShader;var fragmentGlsl=prefixFragment+fragmentShader;// console.log( '*VERTEX*', vertexGlsl );
  // console.log( '*FRAGMENT*', fragmentGlsl );
  var glVertexShader=WebGLShader(gl,gl.VERTEX_SHADER,vertexGlsl);var glFragmentShader=WebGLShader(gl,gl.FRAGMENT_SHADER,fragmentGlsl);gl.attachShader(program,glVertexShader);gl.attachShader(program,glFragmentShader);// Force a particular attribute to index 0.
  if(material.index0AttributeName!==undefined){gl.bindAttribLocation(program,0,material.index0AttributeName);}else if(parameters.morphTargets===true){// programs with morphTargets displace position out of attribute 0
  gl.bindAttribLocation(program,0,'position');}gl.linkProgram(program);var programLog=gl.getProgramInfoLog(program);var vertexLog=gl.getShaderInfoLog(glVertexShader);var fragmentLog=gl.getShaderInfoLog(glFragmentShader);var runnable=true;var haveDiagnostics=true;// console.log( '**VERTEX**', gl.getExtension( 'WEBGL_debug_shaders' ).getTranslatedShaderSource( glVertexShader ) );
  // console.log( '**FRAGMENT**', gl.getExtension( 'WEBGL_debug_shaders' ).getTranslatedShaderSource( glFragmentShader ) );
  if(gl.getProgramParameter(program,gl.LINK_STATUS)===false){runnable=false;console.error('THREE.WebGLProgram: shader error: ',gl.getError(),'gl.VALIDATE_STATUS',gl.getProgramParameter(program,gl.VALIDATE_STATUS),'gl.getProgramInfoLog',programLog,vertexLog,fragmentLog);}else if(programLog!==''){console.warn('THREE.WebGLProgram: gl.getProgramInfoLog()',programLog);}else if(vertexLog===''||fragmentLog===''){haveDiagnostics=false;}if(haveDiagnostics){this.diagnostics={runnable:runnable,material:material,programLog:programLog,vertexShader:{log:vertexLog,prefix:prefixVertex},fragmentShader:{log:fragmentLog,prefix:prefixFragment}};}// clean up
  gl.deleteShader(glVertexShader);gl.deleteShader(glFragmentShader);// set up caching for uniform locations
  var cachedUniforms;this.getUniforms=function(){if(cachedUniforms===undefined){cachedUniforms=new WebGLUniforms(gl,program,renderer);}return cachedUniforms;};// set up caching for attribute locations
  var cachedAttributes;this.getAttributes=function(){if(cachedAttributes===undefined){cachedAttributes=fetchAttributeLocations(gl,program);}return cachedAttributes;};// free resource
  this.destroy=function(){gl.deleteProgram(program);this.program=undefined;};// DEPRECATED
  Object.defineProperties(this,{uniforms:{get:function get$$1(){console.warn('THREE.WebGLProgram: .uniforms is now .getUniforms().');return this.getUniforms();}},attributes:{get:function get$$1(){console.warn('THREE.WebGLProgram: .attributes is now .getAttributes().');return this.getAttributes();}}});//
  this.id=programIdCount++;this.code=code;this.usedTimes=1;this.program=program;this.vertexShader=glVertexShader;this.fragmentShader=glFragmentShader;return this;}/**
   * @author mrdoob / http://mrdoob.com/
   */function WebGLPrograms(renderer,extensions,capabilities){var programs=[];var shaderIDs={MeshDepthMaterial:'depth',MeshDistanceMaterial:'distanceRGBA',MeshNormalMaterial:'normal',MeshBasicMaterial:'basic',MeshLambertMaterial:'lambert',MeshPhongMaterial:'phong',MeshToonMaterial:'phong',MeshStandardMaterial:'physical',MeshPhysicalMaterial:'physical',LineBasicMaterial:'basic',LineDashedMaterial:'dashed',PointsMaterial:'points',ShadowMaterial:'shadow'};var parameterNames=["precision","supportsVertexTextures","map","mapEncoding","envMap","envMapMode","envMapEncoding","lightMap","aoMap","emissiveMap","emissiveMapEncoding","bumpMap","normalMap","displacementMap","specularMap","roughnessMap","metalnessMap","gradientMap","alphaMap","combine","vertexColors","fog","useFog","fogExp","flatShading","sizeAttenuation","logarithmicDepthBuffer","skinning","maxBones","useVertexTexture","morphTargets","morphNormals","maxMorphTargets","maxMorphNormals","premultipliedAlpha","numDirLights","numPointLights","numSpotLights","numHemiLights","numRectAreaLights","shadowMapEnabled","shadowMapType","toneMapping",'physicallyCorrectLights',"alphaTest","doubleSided","flipSided","numClippingPlanes","numClipIntersection","depthPacking","dithering"];function allocateBones(object){var skeleton=object.skeleton;var bones=skeleton.bones;if(capabilities.floatVertexTextures){return 1024;}else{// default for when object is not specified
  // ( for example when prebuilding shader to be used with multiple objects )
  //
  //  - leave some extra space for other uniforms
  //  - limit here is ANGLE's 254 max uniform vectors
  //    (up to 54 should be safe)
  var nVertexUniforms=capabilities.maxVertexUniforms;var nVertexMatrices=Math.floor((nVertexUniforms-20)/4);var maxBones=Math.min(nVertexMatrices,bones.length);if(maxBones<bones.length){console.warn('THREE.WebGLRenderer: Skeleton has '+bones.length+' bones. This GPU supports '+maxBones+'.');return 0;}return maxBones;}}function getTextureEncodingFromMap(map,gammaOverrideLinear){var encoding;if(!map){encoding=LinearEncoding;}else if(map.isTexture){encoding=map.encoding;}else if(map.isWebGLRenderTarget){console.warn("THREE.WebGLPrograms.getTextureEncodingFromMap: don't use render targets as textures. Use their .texture property instead.");encoding=map.texture.encoding;}// add backwards compatibility for WebGLRenderer.gammaInput/gammaOutput parameter, should probably be removed at some point.
  if(encoding===LinearEncoding&&gammaOverrideLinear){encoding=GammaEncoding;}return encoding;}this.getParameters=function(material,lights,shadows,fog,nClipPlanes,nClipIntersection,object){var shaderID=shaderIDs[material.type];// heuristics to create shader parameters according to lights in the scene
  // (not to blow over maxLights budget)
  var maxBones=object.isSkinnedMesh?allocateBones(object):0;var precision=capabilities.precision;if(material.precision!==null){precision=capabilities.getMaxPrecision(material.precision);if(precision!==material.precision){console.warn('THREE.WebGLProgram.getParameters:',material.precision,'not supported, using',precision,'instead.');}}var currentRenderTarget=renderer.getRenderTarget();var parameters={shaderID:shaderID,precision:precision,supportsVertexTextures:capabilities.vertexTextures,outputEncoding:getTextureEncodingFromMap(!currentRenderTarget?null:currentRenderTarget.texture,renderer.gammaOutput),map:!!material.map,mapEncoding:getTextureEncodingFromMap(material.map,renderer.gammaInput),envMap:!!material.envMap,envMapMode:material.envMap&&material.envMap.mapping,envMapEncoding:getTextureEncodingFromMap(material.envMap,renderer.gammaInput),envMapCubeUV:!!material.envMap&&(material.envMap.mapping===CubeUVReflectionMapping||material.envMap.mapping===CubeUVRefractionMapping),lightMap:!!material.lightMap,aoMap:!!material.aoMap,emissiveMap:!!material.emissiveMap,emissiveMapEncoding:getTextureEncodingFromMap(material.emissiveMap,renderer.gammaInput),bumpMap:!!material.bumpMap,normalMap:!!material.normalMap,displacementMap:!!material.displacementMap,roughnessMap:!!material.roughnessMap,metalnessMap:!!material.metalnessMap,specularMap:!!material.specularMap,alphaMap:!!material.alphaMap,gradientMap:!!material.gradientMap,combine:material.combine,vertexColors:material.vertexColors,fog:!!fog,useFog:material.fog,fogExp:fog&&fog.isFogExp2,flatShading:material.flatShading,sizeAttenuation:material.sizeAttenuation,logarithmicDepthBuffer:capabilities.logarithmicDepthBuffer,skinning:material.skinning&&maxBones>0,maxBones:maxBones,useVertexTexture:capabilities.floatVertexTextures,morphTargets:material.morphTargets,morphNormals:material.morphNormals,maxMorphTargets:renderer.maxMorphTargets,maxMorphNormals:renderer.maxMorphNormals,numDirLights:lights.directional.length,numPointLights:lights.point.length,numSpotLights:lights.spot.length,numRectAreaLights:lights.rectArea.length,numHemiLights:lights.hemi.length,numClippingPlanes:nClipPlanes,numClipIntersection:nClipIntersection,dithering:material.dithering,shadowMapEnabled:renderer.shadowMap.enabled&&object.receiveShadow&&shadows.length>0,shadowMapType:renderer.shadowMap.type,toneMapping:renderer.toneMapping,physicallyCorrectLights:renderer.physicallyCorrectLights,premultipliedAlpha:material.premultipliedAlpha,alphaTest:material.alphaTest,doubleSided:material.side===DoubleSide,flipSided:material.side===BackSide,depthPacking:material.depthPacking!==undefined?material.depthPacking:false};return parameters;};this.getProgramCode=function(material,parameters){var array=[];if(parameters.shaderID){array.push(parameters.shaderID);}else{array.push(material.fragmentShader);array.push(material.vertexShader);}if(material.defines!==undefined){for(var name in material.defines){array.push(name);array.push(material.defines[name]);}}for(var i=0;i<parameterNames.length;i++){array.push(parameters[parameterNames[i]]);}array.push(material.onBeforeCompile.toString());array.push(renderer.gammaOutput);return array.join();};this.acquireProgram=function(material,shader,parameters,code){var program;// Check if code has been already compiled
  for(var p=0,pl=programs.length;p<pl;p++){var programInfo=programs[p];if(programInfo.code===code){program=programInfo;++program.usedTimes;break;}}if(program===undefined){program=new WebGLProgram(renderer,extensions,code,material,shader,parameters);programs.push(program);}return program;};this.releaseProgram=function(program){if(--program.usedTimes===0){// Remove from unordered set
  var i=programs.indexOf(program);programs[i]=programs[programs.length-1];programs.pop();// Free WebGL resources
  program.destroy();}};// Exposed for resource monitoring & error feedback via renderer.info:
  this.programs=programs;}/**
   * @author mrdoob / http://mrdoob.com/
   */function WebGLTextures(_gl,extensions,state,properties,capabilities,utils,infoMemory){var _isWebGL2=typeof WebGL2RenderingContext!=='undefined'&&_gl instanceof window.WebGL2RenderingContext;var _videoTextures={};//
  function clampToMaxSize(image,maxSize){if(image.width>maxSize||image.height>maxSize){// Warning: Scaling through the canvas will only work with images that use
  // premultiplied alpha.
  var scale=maxSize/Math.max(image.width,image.height);var canvas=document.createElementNS('http://www.w3.org/1999/xhtml','canvas');canvas.width=Math.floor(image.width*scale);canvas.height=Math.floor(image.height*scale);var context=canvas.getContext('2d');context.drawImage(image,0,0,image.width,image.height,0,0,canvas.width,canvas.height);console.warn('THREE.WebGLRenderer: image is too big ('+image.width+'x'+image.height+'). Resized to '+canvas.width+'x'+canvas.height,image);return canvas;}return image;}function isPowerOfTwo(image){return _Math$1.isPowerOfTwo(image.width)&&_Math$1.isPowerOfTwo(image.height);}function makePowerOfTwo(image){if(image instanceof HTMLImageElement||image instanceof HTMLCanvasElement||image instanceof ImageBitmap){var canvas=document.createElementNS('http://www.w3.org/1999/xhtml','canvas');canvas.width=_Math$1.floorPowerOfTwo(image.width);canvas.height=_Math$1.floorPowerOfTwo(image.height);var context=canvas.getContext('2d');context.drawImage(image,0,0,canvas.width,canvas.height);console.warn('THREE.WebGLRenderer: image is not power of two ('+image.width+'x'+image.height+'). Resized to '+canvas.width+'x'+canvas.height,image);return canvas;}return image;}function textureNeedsPowerOfTwo(texture){return texture.wrapS!==ClampToEdgeWrapping||texture.wrapT!==ClampToEdgeWrapping||texture.minFilter!==NearestFilter&&texture.minFilter!==LinearFilter;}function textureNeedsGenerateMipmaps(texture,isPowerOfTwo){return texture.generateMipmaps&&isPowerOfTwo&&texture.minFilter!==NearestFilter&&texture.minFilter!==LinearFilter;}// Fallback filters for non-power-of-2 textures
  function filterFallback(f){if(f===NearestFilter||f===NearestMipMapNearestFilter||f===NearestMipMapLinearFilter){return _gl.NEAREST;}return _gl.LINEAR;}//
  function onTextureDispose(event){var texture=event.target;texture.removeEventListener('dispose',onTextureDispose);deallocateTexture(texture);if(texture.isVideoTexture){delete _videoTextures[texture.id];}infoMemory.textures--;}function onRenderTargetDispose(event){var renderTarget=event.target;renderTarget.removeEventListener('dispose',onRenderTargetDispose);deallocateRenderTarget(renderTarget);infoMemory.textures--;}//
  function deallocateTexture(texture){var textureProperties=properties.get(texture);if(texture.image&&textureProperties.__image__webglTextureCube){// cube texture
  _gl.deleteTexture(textureProperties.__image__webglTextureCube);}else{// 2D texture
  if(textureProperties.__webglInit===undefined){return;}_gl.deleteTexture(textureProperties.__webglTexture);}// remove all webgl properties
  properties.remove(texture);}function deallocateRenderTarget(renderTarget){var renderTargetProperties=properties.get(renderTarget);var textureProperties=properties.get(renderTarget.texture);if(!renderTarget){return;}if(textureProperties.__webglTexture!==undefined){_gl.deleteTexture(textureProperties.__webglTexture);}if(renderTarget.depthTexture){renderTarget.depthTexture.dispose();}if(renderTarget.isWebGLRenderTargetCube){for(var i=0;i<6;i++){_gl.deleteFramebuffer(renderTargetProperties.__webglFramebuffer[i]);if(renderTargetProperties.__webglDepthbuffer){_gl.deleteRenderbuffer(renderTargetProperties.__webglDepthbuffer[i]);}}}else{_gl.deleteFramebuffer(renderTargetProperties.__webglFramebuffer);if(renderTargetProperties.__webglDepthbuffer){_gl.deleteRenderbuffer(renderTargetProperties.__webglDepthbuffer);}}properties.remove(renderTarget.texture);properties.remove(renderTarget);}//
  function setTexture2D(texture,slot){var textureProperties=properties.get(texture);if(texture.version>0&&textureProperties.__version!==texture.version){var image=texture.image;if(image===undefined){console.warn('THREE.WebGLRenderer: Texture marked for update but image is undefined',texture);}else if(image.complete===false){console.warn('THREE.WebGLRenderer: Texture marked for update but image is incomplete',texture);}else{uploadTexture(textureProperties,texture,slot);return;}}state.activeTexture(_gl.TEXTURE0+slot);state.bindTexture(_gl.TEXTURE_2D,textureProperties.__webglTexture);}function setTextureCube(texture,slot){var textureProperties=properties.get(texture);if(texture.image.length===6){if(texture.version>0&&textureProperties.__version!==texture.version){if(!textureProperties.__image__webglTextureCube){texture.addEventListener('dispose',onTextureDispose);textureProperties.__image__webglTextureCube=_gl.createTexture();infoMemory.textures++;}state.activeTexture(_gl.TEXTURE0+slot);state.bindTexture(_gl.TEXTURE_CUBE_MAP,textureProperties.__image__webglTextureCube);_gl.pixelStorei(_gl.UNPACK_FLIP_Y_WEBGL,texture.flipY);var isCompressed=texture&&texture.isCompressedTexture;var isDataTexture=texture.image[0]&&texture.image[0].isDataTexture;var cubeImage=[];for(var i=0;i<6;i++){if(!isCompressed&&!isDataTexture){cubeImage[i]=clampToMaxSize(texture.image[i],capabilities.maxCubemapSize);}else{cubeImage[i]=isDataTexture?texture.image[i].image:texture.image[i];}}var image=cubeImage[0],isPowerOfTwoImage=isPowerOfTwo(image),glFormat=utils.convert(texture.format),glType=utils.convert(texture.type);setTextureParameters(_gl.TEXTURE_CUBE_MAP,texture,isPowerOfTwoImage);for(var i=0;i<6;i++){if(!isCompressed){if(isDataTexture){state.texImage2D(_gl.TEXTURE_CUBE_MAP_POSITIVE_X+i,0,glFormat,cubeImage[i].width,cubeImage[i].height,0,glFormat,glType,cubeImage[i].data);}else{state.texImage2D(_gl.TEXTURE_CUBE_MAP_POSITIVE_X+i,0,glFormat,glFormat,glType,cubeImage[i]);}}else{var mipmap,mipmaps=cubeImage[i].mipmaps;for(var j=0,jl=mipmaps.length;j<jl;j++){mipmap=mipmaps[j];if(texture.format!==RGBAFormat&&texture.format!==RGBFormat){if(state.getCompressedTextureFormats().indexOf(glFormat)>-1){state.compressedTexImage2D(_gl.TEXTURE_CUBE_MAP_POSITIVE_X+i,j,glFormat,mipmap.width,mipmap.height,0,mipmap.data);}else{console.warn('THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .setTextureCube()');}}else{state.texImage2D(_gl.TEXTURE_CUBE_MAP_POSITIVE_X+i,j,glFormat,mipmap.width,mipmap.height,0,glFormat,glType,mipmap.data);}}}}if(textureNeedsGenerateMipmaps(texture,isPowerOfTwoImage)){_gl.generateMipmap(_gl.TEXTURE_CUBE_MAP);}textureProperties.__version=texture.version;if(texture.onUpdate){texture.onUpdate(texture);}}else{state.activeTexture(_gl.TEXTURE0+slot);state.bindTexture(_gl.TEXTURE_CUBE_MAP,textureProperties.__image__webglTextureCube);}}}function setTextureCubeDynamic(texture,slot){state.activeTexture(_gl.TEXTURE0+slot);state.bindTexture(_gl.TEXTURE_CUBE_MAP,properties.get(texture).__webglTexture);}function setTextureParameters(textureType,texture,isPowerOfTwoImage){var extension;if(isPowerOfTwoImage){_gl.texParameteri(textureType,_gl.TEXTURE_WRAP_S,utils.convert(texture.wrapS));_gl.texParameteri(textureType,_gl.TEXTURE_WRAP_T,utils.convert(texture.wrapT));_gl.texParameteri(textureType,_gl.TEXTURE_MAG_FILTER,utils.convert(texture.magFilter));_gl.texParameteri(textureType,_gl.TEXTURE_MIN_FILTER,utils.convert(texture.minFilter));}else{_gl.texParameteri(textureType,_gl.TEXTURE_WRAP_S,_gl.CLAMP_TO_EDGE);_gl.texParameteri(textureType,_gl.TEXTURE_WRAP_T,_gl.CLAMP_TO_EDGE);if(texture.wrapS!==ClampToEdgeWrapping||texture.wrapT!==ClampToEdgeWrapping){console.warn('THREE.WebGLRenderer: Texture is not power of two. Texture.wrapS and Texture.wrapT should be set to THREE.ClampToEdgeWrapping.',texture);}_gl.texParameteri(textureType,_gl.TEXTURE_MAG_FILTER,filterFallback(texture.magFilter));_gl.texParameteri(textureType,_gl.TEXTURE_MIN_FILTER,filterFallback(texture.minFilter));if(texture.minFilter!==NearestFilter&&texture.minFilter!==LinearFilter){console.warn('THREE.WebGLRenderer: Texture is not power of two. Texture.minFilter should be set to THREE.NearestFilter or THREE.LinearFilter.',texture);}}extension=extensions.get('EXT_texture_filter_anisotropic');if(extension){if(texture.type===FloatType&&extensions.get('OES_texture_float_linear')===null){return;}if(texture.type===HalfFloatType&&extensions.get('OES_texture_half_float_linear')===null){return;}if(texture.anisotropy>1||properties.get(texture).__currentAnisotropy){_gl.texParameterf(textureType,extension.TEXTURE_MAX_ANISOTROPY_EXT,Math.min(texture.anisotropy,capabilities.getMaxAnisotropy()));properties.get(texture).__currentAnisotropy=texture.anisotropy;}}}function uploadTexture(textureProperties,texture,slot){if(textureProperties.__webglInit===undefined){textureProperties.__webglInit=true;texture.addEventListener('dispose',onTextureDispose);textureProperties.__webglTexture=_gl.createTexture();if(texture.isVideoTexture){_videoTextures[texture.id]=texture;}infoMemory.textures++;}state.activeTexture(_gl.TEXTURE0+slot);state.bindTexture(_gl.TEXTURE_2D,textureProperties.__webglTexture);_gl.pixelStorei(_gl.UNPACK_FLIP_Y_WEBGL,texture.flipY);_gl.pixelStorei(_gl.UNPACK_PREMULTIPLY_ALPHA_WEBGL,texture.premultiplyAlpha);_gl.pixelStorei(_gl.UNPACK_ALIGNMENT,texture.unpackAlignment);var image=clampToMaxSize(texture.image,capabilities.maxTextureSize);if(textureNeedsPowerOfTwo(texture)&&isPowerOfTwo(image)===false){image=makePowerOfTwo(image);}var isPowerOfTwoImage=isPowerOfTwo(image),glFormat=utils.convert(texture.format),glType=utils.convert(texture.type);setTextureParameters(_gl.TEXTURE_2D,texture,isPowerOfTwoImage);var mipmap,mipmaps=texture.mipmaps;if(texture.isDepthTexture){// populate depth texture with dummy data
  var internalFormat=_gl.DEPTH_COMPONENT;if(texture.type===FloatType){if(!_isWebGL2){throw new Error('Float Depth Texture only supported in WebGL2.0');}internalFormat=_gl.DEPTH_COMPONENT32F;}else if(_isWebGL2){// WebGL 2.0 requires signed internalformat for glTexImage2D
  internalFormat=_gl.DEPTH_COMPONENT16;}if(texture.format===DepthFormat&&internalFormat===_gl.DEPTH_COMPONENT){// The error INVALID_OPERATION is generated by texImage2D if format and internalformat are
  // DEPTH_COMPONENT and type is not UNSIGNED_SHORT or UNSIGNED_INT
  // (https://www.khronos.org/registry/webgl/extensions/WEBGL_depth_texture/)
  if(texture.type!==UnsignedShortType&&texture.type!==UnsignedIntType){console.warn('THREE.WebGLRenderer: Use UnsignedShortType or UnsignedIntType for DepthFormat DepthTexture.');texture.type=UnsignedShortType;glType=utils.convert(texture.type);}}// Depth stencil textures need the DEPTH_STENCIL internal format
  // (https://www.khronos.org/registry/webgl/extensions/WEBGL_depth_texture/)
  if(texture.format===DepthStencilFormat){internalFormat=_gl.DEPTH_STENCIL;// The error INVALID_OPERATION is generated by texImage2D if format and internalformat are
  // DEPTH_STENCIL and type is not UNSIGNED_INT_24_8_WEBGL.
  // (https://www.khronos.org/registry/webgl/extensions/WEBGL_depth_texture/)
  if(texture.type!==UnsignedInt248Type){console.warn('THREE.WebGLRenderer: Use UnsignedInt248Type for DepthStencilFormat DepthTexture.');texture.type=UnsignedInt248Type;glType=utils.convert(texture.type);}}state.texImage2D(_gl.TEXTURE_2D,0,internalFormat,image.width,image.height,0,glFormat,glType,null);}else if(texture.isDataTexture){// use manually created mipmaps if available
  // if there are no manual mipmaps
  // set 0 level mipmap and then use GL to generate other mipmap levels
  if(mipmaps.length>0&&isPowerOfTwoImage){for(var i=0,il=mipmaps.length;i<il;i++){mipmap=mipmaps[i];state.texImage2D(_gl.TEXTURE_2D,i,glFormat,mipmap.width,mipmap.height,0,glFormat,glType,mipmap.data);}texture.generateMipmaps=false;}else{state.texImage2D(_gl.TEXTURE_2D,0,glFormat,image.width,image.height,0,glFormat,glType,image.data);}}else if(texture.isCompressedTexture){for(var i=0,il=mipmaps.length;i<il;i++){mipmap=mipmaps[i];if(texture.format!==RGBAFormat&&texture.format!==RGBFormat){if(state.getCompressedTextureFormats().indexOf(glFormat)>-1){state.compressedTexImage2D(_gl.TEXTURE_2D,i,glFormat,mipmap.width,mipmap.height,0,mipmap.data);}else{console.warn('THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .uploadTexture()');}}else{state.texImage2D(_gl.TEXTURE_2D,i,glFormat,mipmap.width,mipmap.height,0,glFormat,glType,mipmap.data);}}}else{// regular Texture (image, video, canvas)
  // use manually created mipmaps if available
  // if there are no manual mipmaps
  // set 0 level mipmap and then use GL to generate other mipmap levels
  if(mipmaps.length>0&&isPowerOfTwoImage){for(var i=0,il=mipmaps.length;i<il;i++){mipmap=mipmaps[i];state.texImage2D(_gl.TEXTURE_2D,i,glFormat,glFormat,glType,mipmap);}texture.generateMipmaps=false;}else{state.texImage2D(_gl.TEXTURE_2D,0,glFormat,glFormat,glType,image);}}if(textureNeedsGenerateMipmaps(texture,isPowerOfTwoImage)){_gl.generateMipmap(_gl.TEXTURE_2D);}textureProperties.__version=texture.version;if(texture.onUpdate){texture.onUpdate(texture);}}// Render targets
  // Setup storage for target texture and bind it to correct framebuffer
  function setupFrameBufferTexture(framebuffer,renderTarget,attachment,textureTarget){var glFormat=utils.convert(renderTarget.texture.format);var glType=utils.convert(renderTarget.texture.type);state.texImage2D(textureTarget,0,glFormat,renderTarget.width,renderTarget.height,0,glFormat,glType,null);_gl.bindFramebuffer(_gl.FRAMEBUFFER,framebuffer);_gl.framebufferTexture2D(_gl.FRAMEBUFFER,attachment,textureTarget,properties.get(renderTarget.texture).__webglTexture,0);_gl.bindFramebuffer(_gl.FRAMEBUFFER,null);}// Setup storage for internal depth/stencil buffers and bind to correct framebuffer
  function setupRenderBufferStorage(renderbuffer,renderTarget){_gl.bindRenderbuffer(_gl.RENDERBUFFER,renderbuffer);if(renderTarget.depthBuffer&&!renderTarget.stencilBuffer){_gl.renderbufferStorage(_gl.RENDERBUFFER,_gl.DEPTH_COMPONENT16,renderTarget.width,renderTarget.height);_gl.framebufferRenderbuffer(_gl.FRAMEBUFFER,_gl.DEPTH_ATTACHMENT,_gl.RENDERBUFFER,renderbuffer);}else if(renderTarget.depthBuffer&&renderTarget.stencilBuffer){_gl.renderbufferStorage(_gl.RENDERBUFFER,_gl.DEPTH_STENCIL,renderTarget.width,renderTarget.height);_gl.framebufferRenderbuffer(_gl.FRAMEBUFFER,_gl.DEPTH_STENCIL_ATTACHMENT,_gl.RENDERBUFFER,renderbuffer);}else{// FIXME: We don't support !depth !stencil
  _gl.renderbufferStorage(_gl.RENDERBUFFER,_gl.RGBA4,renderTarget.width,renderTarget.height);}_gl.bindRenderbuffer(_gl.RENDERBUFFER,null);}// Setup resources for a Depth Texture for a FBO (needs an extension)
  function setupDepthTexture(framebuffer,renderTarget){var isCube=renderTarget&&renderTarget.isWebGLRenderTargetCube;if(isCube){throw new Error('Depth Texture with cube render targets is not supported');}_gl.bindFramebuffer(_gl.FRAMEBUFFER,framebuffer);if(!(renderTarget.depthTexture&&renderTarget.depthTexture.isDepthTexture)){throw new Error('renderTarget.depthTexture must be an instance of THREE.DepthTexture');}// upload an empty depth texture with framebuffer size
  if(!properties.get(renderTarget.depthTexture).__webglTexture||renderTarget.depthTexture.image.width!==renderTarget.width||renderTarget.depthTexture.image.height!==renderTarget.height){renderTarget.depthTexture.image.width=renderTarget.width;renderTarget.depthTexture.image.height=renderTarget.height;renderTarget.depthTexture.needsUpdate=true;}setTexture2D(renderTarget.depthTexture,0);var webglDepthTexture=properties.get(renderTarget.depthTexture).__webglTexture;if(renderTarget.depthTexture.format===DepthFormat){_gl.framebufferTexture2D(_gl.FRAMEBUFFER,_gl.DEPTH_ATTACHMENT,_gl.TEXTURE_2D,webglDepthTexture,0);}else if(renderTarget.depthTexture.format===DepthStencilFormat){_gl.framebufferTexture2D(_gl.FRAMEBUFFER,_gl.DEPTH_STENCIL_ATTACHMENT,_gl.TEXTURE_2D,webglDepthTexture,0);}else{throw new Error('Unknown depthTexture format');}}// Setup GL resources for a non-texture depth buffer
  function setupDepthRenderbuffer(renderTarget){var renderTargetProperties=properties.get(renderTarget);var isCube=renderTarget.isWebGLRenderTargetCube===true;if(renderTarget.depthTexture){if(isCube){throw new Error('target.depthTexture not supported in Cube render targets');}setupDepthTexture(renderTargetProperties.__webglFramebuffer,renderTarget);}else{if(isCube){renderTargetProperties.__webglDepthbuffer=[];for(var i=0;i<6;i++){_gl.bindFramebuffer(_gl.FRAMEBUFFER,renderTargetProperties.__webglFramebuffer[i]);renderTargetProperties.__webglDepthbuffer[i]=_gl.createRenderbuffer();setupRenderBufferStorage(renderTargetProperties.__webglDepthbuffer[i],renderTarget);}}else{_gl.bindFramebuffer(_gl.FRAMEBUFFER,renderTargetProperties.__webglFramebuffer);renderTargetProperties.__webglDepthbuffer=_gl.createRenderbuffer();setupRenderBufferStorage(renderTargetProperties.__webglDepthbuffer,renderTarget);}}_gl.bindFramebuffer(_gl.FRAMEBUFFER,null);}// Set up GL resources for the render target
  function setupRenderTarget(renderTarget){var renderTargetProperties=properties.get(renderTarget);var textureProperties=properties.get(renderTarget.texture);renderTarget.addEventListener('dispose',onRenderTargetDispose);textureProperties.__webglTexture=_gl.createTexture();infoMemory.textures++;var isCube=renderTarget.isWebGLRenderTargetCube===true;var isTargetPowerOfTwo=isPowerOfTwo(renderTarget);// Setup framebuffer
  if(isCube){renderTargetProperties.__webglFramebuffer=[];for(var i=0;i<6;i++){renderTargetProperties.__webglFramebuffer[i]=_gl.createFramebuffer();}}else{renderTargetProperties.__webglFramebuffer=_gl.createFramebuffer();}// Setup color buffer
  if(isCube){state.bindTexture(_gl.TEXTURE_CUBE_MAP,textureProperties.__webglTexture);setTextureParameters(_gl.TEXTURE_CUBE_MAP,renderTarget.texture,isTargetPowerOfTwo);for(var i=0;i<6;i++){setupFrameBufferTexture(renderTargetProperties.__webglFramebuffer[i],renderTarget,_gl.COLOR_ATTACHMENT0,_gl.TEXTURE_CUBE_MAP_POSITIVE_X+i);}if(textureNeedsGenerateMipmaps(renderTarget.texture,isTargetPowerOfTwo)){_gl.generateMipmap(_gl.TEXTURE_CUBE_MAP);}state.bindTexture(_gl.TEXTURE_CUBE_MAP,null);}else{state.bindTexture(_gl.TEXTURE_2D,textureProperties.__webglTexture);setTextureParameters(_gl.TEXTURE_2D,renderTarget.texture,isTargetPowerOfTwo);setupFrameBufferTexture(renderTargetProperties.__webglFramebuffer,renderTarget,_gl.COLOR_ATTACHMENT0,_gl.TEXTURE_2D);if(textureNeedsGenerateMipmaps(renderTarget.texture,isTargetPowerOfTwo)){_gl.generateMipmap(_gl.TEXTURE_2D);}state.bindTexture(_gl.TEXTURE_2D,null);}// Setup depth and stencil buffers
  if(renderTarget.depthBuffer){setupDepthRenderbuffer(renderTarget);}}function updateRenderTargetMipmap(renderTarget){var texture=renderTarget.texture;var isTargetPowerOfTwo=isPowerOfTwo(renderTarget);if(textureNeedsGenerateMipmaps(texture,isTargetPowerOfTwo)){var target=renderTarget.isWebGLRenderTargetCube?_gl.TEXTURE_CUBE_MAP:_gl.TEXTURE_2D;var webglTexture=properties.get(texture).__webglTexture;state.bindTexture(target,webglTexture);_gl.generateMipmap(target);state.bindTexture(target,null);}}function updateVideoTextures(){for(var id in _videoTextures){_videoTextures[id].update();}}this.setTexture2D=setTexture2D;this.setTextureCube=setTextureCube;this.setTextureCubeDynamic=setTextureCubeDynamic;this.setupRenderTarget=setupRenderTarget;this.updateRenderTargetMipmap=updateRenderTargetMipmap;this.updateVideoTextures=updateVideoTextures;}/**
   * @author fordacious / fordacious.github.io
   */function WebGLProperties(){var properties={};function get$$1(object){var uuid=object.uuid;var map=properties[uuid];if(map===undefined){map={};properties[uuid]=map;}return map;}function remove(object){delete properties[object.uuid];}function clear(){properties={};}return{get:get$$1,remove:remove,clear:clear};}/**
   * @author mrdoob / http://mrdoob.com/
   */function WebGLState(gl,extensions,utils){function ColorBuffer(){var locked=false;var color=new Vector4$1();var currentColorMask=null;var currentColorClear=new Vector4$1(0,0,0,0);return{setMask:function setMask(colorMask){if(currentColorMask!==colorMask&&!locked){gl.colorMask(colorMask,colorMask,colorMask,colorMask);currentColorMask=colorMask;}},setLocked:function setLocked(lock){locked=lock;},setClear:function setClear(r,g,b,a,premultipliedAlpha){if(premultipliedAlpha===true){r*=a;g*=a;b*=a;}color.set(r,g,b,a);if(currentColorClear.equals(color)===false){gl.clearColor(r,g,b,a);currentColorClear.copy(color);}},reset:function reset(){locked=false;currentColorMask=null;currentColorClear.set(-1,0,0,0);// set to invalid state
  }};}function DepthBuffer(){var locked=false;var currentDepthMask=null;var currentDepthFunc=null;var currentDepthClear=null;return{setTest:function setTest(depthTest){if(depthTest){enable(gl.DEPTH_TEST);}else{disable(gl.DEPTH_TEST);}},setMask:function setMask(depthMask){if(currentDepthMask!==depthMask&&!locked){gl.depthMask(depthMask);currentDepthMask=depthMask;}},setFunc:function setFunc(depthFunc){if(currentDepthFunc!==depthFunc){if(depthFunc){switch(depthFunc){case NeverDepth:gl.depthFunc(gl.NEVER);break;case AlwaysDepth:gl.depthFunc(gl.ALWAYS);break;case LessDepth:gl.depthFunc(gl.LESS);break;case LessEqualDepth:gl.depthFunc(gl.LEQUAL);break;case EqualDepth:gl.depthFunc(gl.EQUAL);break;case GreaterEqualDepth:gl.depthFunc(gl.GEQUAL);break;case GreaterDepth:gl.depthFunc(gl.GREATER);break;case NotEqualDepth:gl.depthFunc(gl.NOTEQUAL);break;default:gl.depthFunc(gl.LEQUAL);}}else{gl.depthFunc(gl.LEQUAL);}currentDepthFunc=depthFunc;}},setLocked:function setLocked(lock){locked=lock;},setClear:function setClear(depth){if(currentDepthClear!==depth){gl.clearDepth(depth);currentDepthClear=depth;}},reset:function reset(){locked=false;currentDepthMask=null;currentDepthFunc=null;currentDepthClear=null;}};}function StencilBuffer(){var locked=false;var currentStencilMask=null;var currentStencilFunc=null;var currentStencilRef=null;var currentStencilFuncMask=null;var currentStencilFail=null;var currentStencilZFail=null;var currentStencilZPass=null;var currentStencilClear=null;return{setTest:function setTest(stencilTest){if(stencilTest){enable(gl.STENCIL_TEST);}else{disable(gl.STENCIL_TEST);}},setMask:function setMask(stencilMask){if(currentStencilMask!==stencilMask&&!locked){gl.stencilMask(stencilMask);currentStencilMask=stencilMask;}},setFunc:function setFunc(stencilFunc,stencilRef,stencilMask){if(currentStencilFunc!==stencilFunc||currentStencilRef!==stencilRef||currentStencilFuncMask!==stencilMask){gl.stencilFunc(stencilFunc,stencilRef,stencilMask);currentStencilFunc=stencilFunc;currentStencilRef=stencilRef;currentStencilFuncMask=stencilMask;}},setOp:function setOp(stencilFail,stencilZFail,stencilZPass){if(currentStencilFail!==stencilFail||currentStencilZFail!==stencilZFail||currentStencilZPass!==stencilZPass){gl.stencilOp(stencilFail,stencilZFail,stencilZPass);currentStencilFail=stencilFail;currentStencilZFail=stencilZFail;currentStencilZPass=stencilZPass;}},setLocked:function setLocked(lock){locked=lock;},setClear:function setClear(stencil){if(currentStencilClear!==stencil){gl.clearStencil(stencil);currentStencilClear=stencil;}},reset:function reset(){locked=false;currentStencilMask=null;currentStencilFunc=null;currentStencilRef=null;currentStencilFuncMask=null;currentStencilFail=null;currentStencilZFail=null;currentStencilZPass=null;currentStencilClear=null;}};}//
  var colorBuffer=new ColorBuffer();var depthBuffer=new DepthBuffer();var stencilBuffer=new StencilBuffer();var maxVertexAttributes=gl.getParameter(gl.MAX_VERTEX_ATTRIBS);var newAttributes=new Uint8Array(maxVertexAttributes);var enabledAttributes=new Uint8Array(maxVertexAttributes);var attributeDivisors=new Uint8Array(maxVertexAttributes);var capabilities={};var compressedTextureFormats=null;var currentProgram=null;var currentBlending=null;var currentBlendEquation=null;var currentBlendSrc=null;var currentBlendDst=null;var currentBlendEquationAlpha=null;var currentBlendSrcAlpha=null;var currentBlendDstAlpha=null;var currentPremultipledAlpha=false;var currentFlipSided=null;var currentCullFace=null;var currentLineWidth=null;var currentPolygonOffsetFactor=null;var currentPolygonOffsetUnits=null;var maxTextures=gl.getParameter(gl.MAX_COMBINED_TEXTURE_IMAGE_UNITS);var version=parseFloat(/^WebGL\ ([0-9])/.exec(gl.getParameter(gl.VERSION))[1]);var lineWidthAvailable=parseFloat(version)>=1.0;var currentTextureSlot=null;var currentBoundTextures={};var currentScissor=new Vector4$1();var currentViewport=new Vector4$1();function createTexture(type,target,count){var data=new Uint8Array(4);// 4 is required to match default unpack alignment of 4.
  var texture=gl.createTexture();gl.bindTexture(type,texture);gl.texParameteri(type,gl.TEXTURE_MIN_FILTER,gl.NEAREST);gl.texParameteri(type,gl.TEXTURE_MAG_FILTER,gl.NEAREST);for(var i=0;i<count;i++){gl.texImage2D(target+i,0,gl.RGBA,1,1,0,gl.RGBA,gl.UNSIGNED_BYTE,data);}return texture;}var emptyTextures={};emptyTextures[gl.TEXTURE_2D]=createTexture(gl.TEXTURE_2D,gl.TEXTURE_2D,1);emptyTextures[gl.TEXTURE_CUBE_MAP]=createTexture(gl.TEXTURE_CUBE_MAP,gl.TEXTURE_CUBE_MAP_POSITIVE_X,6);// init
  colorBuffer.setClear(0,0,0,1);depthBuffer.setClear(1);stencilBuffer.setClear(0);enable(gl.DEPTH_TEST);depthBuffer.setFunc(LessEqualDepth);setFlipSided(false);setCullFace(CullFaceBack);enable(gl.CULL_FACE);enable(gl.BLEND);setBlending(NormalBlending);//
  function initAttributes(){for(var i=0,l=newAttributes.length;i<l;i++){newAttributes[i]=0;}}function enableAttribute(attribute){newAttributes[attribute]=1;if(enabledAttributes[attribute]===0){gl.enableVertexAttribArray(attribute);enabledAttributes[attribute]=1;}if(attributeDivisors[attribute]!==0){var extension=extensions.get('ANGLE_instanced_arrays');extension.vertexAttribDivisorANGLE(attribute,0);attributeDivisors[attribute]=0;}}function enableAttributeAndDivisor(attribute,meshPerAttribute){newAttributes[attribute]=1;if(enabledAttributes[attribute]===0){gl.enableVertexAttribArray(attribute);enabledAttributes[attribute]=1;}if(attributeDivisors[attribute]!==meshPerAttribute){var extension=extensions.get('ANGLE_instanced_arrays');extension.vertexAttribDivisorANGLE(attribute,meshPerAttribute);attributeDivisors[attribute]=meshPerAttribute;}}function disableUnusedAttributes(){for(var i=0,l=enabledAttributes.length;i!==l;++i){if(enabledAttributes[i]!==newAttributes[i]){gl.disableVertexAttribArray(i);enabledAttributes[i]=0;}}}function enable(id){if(capabilities[id]!==true){gl.enable(id);capabilities[id]=true;}}function disable(id){if(capabilities[id]!==false){gl.disable(id);capabilities[id]=false;}}function getCompressedTextureFormats(){if(compressedTextureFormats===null){compressedTextureFormats=[];if(extensions.get('WEBGL_compressed_texture_pvrtc')||extensions.get('WEBGL_compressed_texture_s3tc')||extensions.get('WEBGL_compressed_texture_etc1')){var formats=gl.getParameter(gl.COMPRESSED_TEXTURE_FORMATS);for(var i=0;i<formats.length;i++){compressedTextureFormats.push(formats[i]);}}}return compressedTextureFormats;}function useProgram(program){if(currentProgram!==program){gl.useProgram(program);currentProgram=program;return true;}return false;}function setBlending(blending,blendEquation,blendSrc,blendDst,blendEquationAlpha,blendSrcAlpha,blendDstAlpha,premultipliedAlpha){if(blending!==NoBlending){enable(gl.BLEND);}else{disable(gl.BLEND);}if(blending!==CustomBlending){if(blending!==currentBlending||premultipliedAlpha!==currentPremultipledAlpha){switch(blending){case AdditiveBlending:if(premultipliedAlpha){gl.blendEquationSeparate(gl.FUNC_ADD,gl.FUNC_ADD);gl.blendFuncSeparate(gl.ONE,gl.ONE,gl.ONE,gl.ONE);}else{gl.blendEquation(gl.FUNC_ADD);gl.blendFunc(gl.SRC_ALPHA,gl.ONE);}break;case SubtractiveBlending:if(premultipliedAlpha){gl.blendEquationSeparate(gl.FUNC_ADD,gl.FUNC_ADD);gl.blendFuncSeparate(gl.ZERO,gl.ZERO,gl.ONE_MINUS_SRC_COLOR,gl.ONE_MINUS_SRC_ALPHA);}else{gl.blendEquation(gl.FUNC_ADD);gl.blendFunc(gl.ZERO,gl.ONE_MINUS_SRC_COLOR);}break;case MultiplyBlending:if(premultipliedAlpha){gl.blendEquationSeparate(gl.FUNC_ADD,gl.FUNC_ADD);gl.blendFuncSeparate(gl.ZERO,gl.SRC_COLOR,gl.ZERO,gl.SRC_ALPHA);}else{gl.blendEquation(gl.FUNC_ADD);gl.blendFunc(gl.ZERO,gl.SRC_COLOR);}break;default:if(premultipliedAlpha){gl.blendEquationSeparate(gl.FUNC_ADD,gl.FUNC_ADD);gl.blendFuncSeparate(gl.ONE,gl.ONE_MINUS_SRC_ALPHA,gl.ONE,gl.ONE_MINUS_SRC_ALPHA);}else{gl.blendEquationSeparate(gl.FUNC_ADD,gl.FUNC_ADD);gl.blendFuncSeparate(gl.SRC_ALPHA,gl.ONE_MINUS_SRC_ALPHA,gl.ONE,gl.ONE_MINUS_SRC_ALPHA);}}}currentBlendEquation=null;currentBlendSrc=null;currentBlendDst=null;currentBlendEquationAlpha=null;currentBlendSrcAlpha=null;currentBlendDstAlpha=null;}else{blendEquationAlpha=blendEquationAlpha||blendEquation;blendSrcAlpha=blendSrcAlpha||blendSrc;blendDstAlpha=blendDstAlpha||blendDst;if(blendEquation!==currentBlendEquation||blendEquationAlpha!==currentBlendEquationAlpha){gl.blendEquationSeparate(utils.convert(blendEquation),utils.convert(blendEquationAlpha));currentBlendEquation=blendEquation;currentBlendEquationAlpha=blendEquationAlpha;}if(blendSrc!==currentBlendSrc||blendDst!==currentBlendDst||blendSrcAlpha!==currentBlendSrcAlpha||blendDstAlpha!==currentBlendDstAlpha){gl.blendFuncSeparate(utils.convert(blendSrc),utils.convert(blendDst),utils.convert(blendSrcAlpha),utils.convert(blendDstAlpha));currentBlendSrc=blendSrc;currentBlendDst=blendDst;currentBlendSrcAlpha=blendSrcAlpha;currentBlendDstAlpha=blendDstAlpha;}}currentBlending=blending;currentPremultipledAlpha=premultipliedAlpha;}function setMaterial(material,frontFaceCW){material.side===DoubleSide?disable(gl.CULL_FACE):enable(gl.CULL_FACE);var flipSided=material.side===BackSide;if(frontFaceCW){flipSided=!flipSided;}setFlipSided(flipSided);material.transparent===true?setBlending(material.blending,material.blendEquation,material.blendSrc,material.blendDst,material.blendEquationAlpha,material.blendSrcAlpha,material.blendDstAlpha,material.premultipliedAlpha):setBlending(NoBlending);depthBuffer.setFunc(material.depthFunc);depthBuffer.setTest(material.depthTest);depthBuffer.setMask(material.depthWrite);colorBuffer.setMask(material.colorWrite);setPolygonOffset(material.polygonOffset,material.polygonOffsetFactor,material.polygonOffsetUnits);}//
  function setFlipSided(flipSided){if(currentFlipSided!==flipSided){if(flipSided){gl.frontFace(gl.CW);}else{gl.frontFace(gl.CCW);}currentFlipSided=flipSided;}}function setCullFace(cullFace){if(cullFace!==CullFaceNone){enable(gl.CULL_FACE);if(cullFace!==currentCullFace){if(cullFace===CullFaceBack){gl.cullFace(gl.BACK);}else if(cullFace===CullFaceFront){gl.cullFace(gl.FRONT);}else{gl.cullFace(gl.FRONT_AND_BACK);}}}else{disable(gl.CULL_FACE);}currentCullFace=cullFace;}function setLineWidth(width){if(width!==currentLineWidth){if(lineWidthAvailable){gl.lineWidth(width);}currentLineWidth=width;}}function setPolygonOffset(polygonOffset,factor,units){if(polygonOffset){enable(gl.POLYGON_OFFSET_FILL);if(currentPolygonOffsetFactor!==factor||currentPolygonOffsetUnits!==units){gl.polygonOffset(factor,units);currentPolygonOffsetFactor=factor;currentPolygonOffsetUnits=units;}}else{disable(gl.POLYGON_OFFSET_FILL);}}function setScissorTest(scissorTest){if(scissorTest){enable(gl.SCISSOR_TEST);}else{disable(gl.SCISSOR_TEST);}}// texture
  function activeTexture(webglSlot){if(webglSlot===undefined){webglSlot=gl.TEXTURE0+maxTextures-1;}if(currentTextureSlot!==webglSlot){gl.activeTexture(webglSlot);currentTextureSlot=webglSlot;}}function bindTexture(webglType,webglTexture){if(currentTextureSlot===null){activeTexture();}var boundTexture=currentBoundTextures[currentTextureSlot];if(boundTexture===undefined){boundTexture={type:undefined,texture:undefined};currentBoundTextures[currentTextureSlot]=boundTexture;}if(boundTexture.type!==webglType||boundTexture.texture!==webglTexture){gl.bindTexture(webglType,webglTexture||emptyTextures[webglType]);boundTexture.type=webglType;boundTexture.texture=webglTexture;}}function compressedTexImage2D(){try{gl.compressedTexImage2D.apply(gl,arguments);}catch(error){console.error('THREE.WebGLState:',error);}}function texImage2D(){try{gl.texImage2D.apply(gl,arguments);}catch(error){console.error('THREE.WebGLState:',error);}}//
  function scissor(scissor){if(currentScissor.equals(scissor)===false){gl.scissor(scissor.x,scissor.y,scissor.z,scissor.w);currentScissor.copy(scissor);}}function viewport(viewport){if(currentViewport.equals(viewport)===false){gl.viewport(viewport.x,viewport.y,viewport.z,viewport.w);currentViewport.copy(viewport);}}//
  function reset(){for(var i=0;i<enabledAttributes.length;i++){if(enabledAttributes[i]===1){gl.disableVertexAttribArray(i);enabledAttributes[i]=0;}}capabilities={};compressedTextureFormats=null;currentTextureSlot=null;currentBoundTextures={};currentProgram=null;currentBlending=null;currentFlipSided=null;currentCullFace=null;colorBuffer.reset();depthBuffer.reset();stencilBuffer.reset();}return{buffers:{color:colorBuffer,depth:depthBuffer,stencil:stencilBuffer},initAttributes:initAttributes,enableAttribute:enableAttribute,enableAttributeAndDivisor:enableAttributeAndDivisor,disableUnusedAttributes:disableUnusedAttributes,enable:enable,disable:disable,getCompressedTextureFormats:getCompressedTextureFormats,useProgram:useProgram,setBlending:setBlending,setMaterial:setMaterial,setFlipSided:setFlipSided,setCullFace:setCullFace,setLineWidth:setLineWidth,setPolygonOffset:setPolygonOffset,setScissorTest:setScissorTest,activeTexture:activeTexture,bindTexture:bindTexture,compressedTexImage2D:compressedTexImage2D,texImage2D:texImage2D,scissor:scissor,viewport:viewport,reset:reset};}/**
   * @author mrdoob / http://mrdoob.com/
   */function WebGLCapabilities(gl,extensions,parameters){var maxAnisotropy;function getMaxAnisotropy(){if(maxAnisotropy!==undefined){return maxAnisotropy;}var extension=extensions.get('EXT_texture_filter_anisotropic');if(extension!==null){maxAnisotropy=gl.getParameter(extension.MAX_TEXTURE_MAX_ANISOTROPY_EXT);}else{maxAnisotropy=0;}return maxAnisotropy;}function getMaxPrecision(precision){if(precision==='highp'){if(gl.getShaderPrecisionFormat(gl.VERTEX_SHADER,gl.HIGH_FLOAT).precision>0&&gl.getShaderPrecisionFormat(gl.FRAGMENT_SHADER,gl.HIGH_FLOAT).precision>0){return'highp';}precision='mediump';}if(precision==='mediump'){if(gl.getShaderPrecisionFormat(gl.VERTEX_SHADER,gl.MEDIUM_FLOAT).precision>0&&gl.getShaderPrecisionFormat(gl.FRAGMENT_SHADER,gl.MEDIUM_FLOAT).precision>0){return'mediump';}}return'lowp';}var precision=parameters.precision!==undefined?parameters.precision:'highp';var maxPrecision=getMaxPrecision(precision);if(maxPrecision!==precision){console.warn('THREE.WebGLRenderer:',precision,'not supported, using',maxPrecision,'instead.');precision=maxPrecision;}var logarithmicDepthBuffer=parameters.logarithmicDepthBuffer===true;var maxTextures=gl.getParameter(gl.MAX_TEXTURE_IMAGE_UNITS);var maxVertexTextures=gl.getParameter(gl.MAX_VERTEX_TEXTURE_IMAGE_UNITS);var maxTextureSize=gl.getParameter(gl.MAX_TEXTURE_SIZE);var maxCubemapSize=gl.getParameter(gl.MAX_CUBE_MAP_TEXTURE_SIZE);var maxAttributes=gl.getParameter(gl.MAX_VERTEX_ATTRIBS);var maxVertexUniforms=gl.getParameter(gl.MAX_VERTEX_UNIFORM_VECTORS);var maxVaryings=gl.getParameter(gl.MAX_VARYING_VECTORS);var maxFragmentUniforms=gl.getParameter(gl.MAX_FRAGMENT_UNIFORM_VECTORS);var vertexTextures=maxVertexTextures>0;var floatFragmentTextures=!!extensions.get('OES_texture_float');var floatVertexTextures=vertexTextures&&floatFragmentTextures;return{getMaxAnisotropy:getMaxAnisotropy,getMaxPrecision:getMaxPrecision,precision:precision,logarithmicDepthBuffer:logarithmicDepthBuffer,maxTextures:maxTextures,maxVertexTextures:maxVertexTextures,maxTextureSize:maxTextureSize,maxCubemapSize:maxCubemapSize,maxAttributes:maxAttributes,maxVertexUniforms:maxVertexUniforms,maxVaryings:maxVaryings,maxFragmentUniforms:maxFragmentUniforms,vertexTextures:vertexTextures,floatFragmentTextures:floatFragmentTextures,floatVertexTextures:floatVertexTextures};}/**
   * @author mrdoob / http://mrdoob.com/
   */function ArrayCamera(array){PerspectiveCamera.call(this);this.cameras=array||[];}ArrayCamera.prototype=Object.assign(Object.create(PerspectiveCamera.prototype),{constructor:ArrayCamera,isArrayCamera:true});/**
   * @author mrdoob / http://mrdoob.com/
   */function WebVRManager(renderer){var scope=this;var device=null;var frameData=null;var poseTarget=null;if(typeof window!=='undefined'&&'VRFrameData'in window){frameData=new window.VRFrameData();}var matrixWorldInverse=new Matrix4();var cameraL=new PerspectiveCamera();cameraL.bounds=new Vector4$1(0.0,0.0,0.5,1.0);cameraL.layers.enable(1);var cameraR=new PerspectiveCamera();cameraR.bounds=new Vector4$1(0.5,0.0,0.5,1.0);cameraR.layers.enable(2);var cameraVR=new ArrayCamera([cameraL,cameraR]);cameraVR.layers.enable(1);cameraVR.layers.enable(2);//
  var currentSize,currentPixelRatio;function onVRDisplayPresentChange(){if(device!==null&&device.isPresenting){var eyeParameters=device.getEyeParameters('left');var renderWidth=eyeParameters.renderWidth;var renderHeight=eyeParameters.renderHeight;currentPixelRatio=renderer.getPixelRatio();currentSize=renderer.getSize();renderer.setDrawingBufferSize(renderWidth*2,renderHeight,1);}else if(scope.enabled){renderer.setDrawingBufferSize(currentSize.width,currentSize.height,currentPixelRatio);}}if(typeof window!=='undefined'){window.addEventListener('vrdisplaypresentchange',onVRDisplayPresentChange,false);}//
  this.enabled=false;this.getDevice=function(){return device;};this.setDevice=function(value){if(value!==undefined){device=value;}};this.setPoseTarget=function(object){if(object!==undefined){poseTarget=object;}};this.getCamera=function(camera){if(device===null){return camera;}device.depthNear=camera.near;device.depthFar=camera.far;device.getFrameData(frameData);//
  var pose=frameData.pose;var poseObject=poseTarget!==null?poseTarget:camera;if(pose.position!==null){poseObject.position.fromArray(pose.position);}else{poseObject.position.set(0,0,0);}if(pose.orientation!==null){poseObject.quaternion.fromArray(pose.orientation);}poseObject.updateMatrixWorld();if(device.isPresenting===false){return camera;}//
  cameraL.near=camera.near;cameraR.near=camera.near;cameraL.far=camera.far;cameraR.far=camera.far;cameraVR.matrixWorld.copy(camera.matrixWorld);cameraVR.matrixWorldInverse.copy(camera.matrixWorldInverse);cameraL.matrixWorldInverse.fromArray(frameData.leftViewMatrix);cameraR.matrixWorldInverse.fromArray(frameData.rightViewMatrix);var parent=poseObject.parent;if(parent!==null){matrixWorldInverse.getInverse(parent.matrixWorld);cameraL.matrixWorldInverse.multiply(matrixWorldInverse);cameraR.matrixWorldInverse.multiply(matrixWorldInverse);}// envMap and Mirror needs camera.matrixWorld
  cameraL.matrixWorld.getInverse(cameraL.matrixWorldInverse);cameraR.matrixWorld.getInverse(cameraR.matrixWorldInverse);cameraL.projectionMatrix.fromArray(frameData.leftProjectionMatrix);cameraR.projectionMatrix.fromArray(frameData.rightProjectionMatrix);// HACK @mrdoob
  // https://github.com/w3c/webvr/issues/203
  cameraVR.projectionMatrix.copy(cameraL.projectionMatrix);//
  var layers=device.getLayers();if(layers.length){var layer=layers[0];if(layer.leftBounds!==null&&layer.leftBounds.length===4){cameraL.bounds.fromArray(layer.leftBounds);}if(layer.rightBounds!==null&&layer.rightBounds.length===4){cameraR.bounds.fromArray(layer.rightBounds);}}return cameraVR;};this.submitFrame=function(){if(device&&device.isPresenting){device.submitFrame();}};this.dispose=function(){if(typeof window!=='undefined'){window.removeEventListener('vrdisplaypresentchange',onVRDisplayPresentChange);}};}/**
   * @author mrdoob / http://mrdoob.com/
   */function WebGLExtensions(gl){var extensions={};return{get:function get$$1(name){if(extensions[name]!==undefined){return extensions[name];}var extension;switch(name){case'WEBGL_depth_texture':extension=gl.getExtension('WEBGL_depth_texture')||gl.getExtension('MOZ_WEBGL_depth_texture')||gl.getExtension('WEBKIT_WEBGL_depth_texture');break;case'EXT_texture_filter_anisotropic':extension=gl.getExtension('EXT_texture_filter_anisotropic')||gl.getExtension('MOZ_EXT_texture_filter_anisotropic')||gl.getExtension('WEBKIT_EXT_texture_filter_anisotropic');break;case'WEBGL_compressed_texture_s3tc':extension=gl.getExtension('WEBGL_compressed_texture_s3tc')||gl.getExtension('MOZ_WEBGL_compressed_texture_s3tc')||gl.getExtension('WEBKIT_WEBGL_compressed_texture_s3tc');break;case'WEBGL_compressed_texture_pvrtc':extension=gl.getExtension('WEBGL_compressed_texture_pvrtc')||gl.getExtension('WEBKIT_WEBGL_compressed_texture_pvrtc');break;case'WEBGL_compressed_texture_etc1':extension=gl.getExtension('WEBGL_compressed_texture_etc1');break;default:extension=gl.getExtension(name);}if(extension===null){console.warn('THREE.WebGLRenderer: '+name+' extension not supported.');}extensions[name]=extension;return extension;}};}/**
   * @author tschw
   */function WebGLClipping(){var scope=this,globalState=null,numGlobalPlanes=0,localClippingEnabled=false,renderingShadows=false,plane=new Plane(),viewNormalMatrix=new Matrix3$1(),uniform={value:null,needsUpdate:false};this.uniform=uniform;this.numPlanes=0;this.numIntersection=0;this.init=function(planes,enableLocalClipping,camera){var enabled=planes.length!==0||enableLocalClipping||// enable state of previous frame - the clipping code has to
  // run another frame in order to reset the state:
  numGlobalPlanes!==0||localClippingEnabled;localClippingEnabled=enableLocalClipping;globalState=projectPlanes(planes,camera,0);numGlobalPlanes=planes.length;return enabled;};this.beginShadows=function(){renderingShadows=true;projectPlanes(null);};this.endShadows=function(){renderingShadows=false;resetGlobalState();};this.setState=function(planes,clipIntersection,clipShadows,camera,cache,fromCache){if(!localClippingEnabled||planes===null||planes.length===0||renderingShadows&&!clipShadows){// there's no local clipping
  if(renderingShadows){// there's no global clipping
  projectPlanes(null);}else{resetGlobalState();}}else{var nGlobal=renderingShadows?0:numGlobalPlanes,lGlobal=nGlobal*4,dstArray=cache.clippingState||null;uniform.value=dstArray;// ensure unique state
  dstArray=projectPlanes(planes,camera,lGlobal,fromCache);for(var i=0;i!==lGlobal;++i){dstArray[i]=globalState[i];}cache.clippingState=dstArray;this.numIntersection=clipIntersection?this.numPlanes:0;this.numPlanes+=nGlobal;}};function resetGlobalState(){if(uniform.value!==globalState){uniform.value=globalState;uniform.needsUpdate=numGlobalPlanes>0;}scope.numPlanes=numGlobalPlanes;scope.numIntersection=0;}function projectPlanes(planes,camera,dstOffset,skipTransform){var nPlanes=planes!==null?planes.length:0,dstArray=null;if(nPlanes!==0){dstArray=uniform.value;if(skipTransform!==true||dstArray===null){var flatSize=dstOffset+nPlanes*4,viewMatrix=camera.matrixWorldInverse;viewNormalMatrix.getNormalMatrix(viewMatrix);if(dstArray===null||dstArray.length<flatSize){dstArray=new Float32Array(flatSize);}for(var i=0,i4=dstOffset;i!==nPlanes;++i, i4+=4){plane.copy(planes[i]).applyMatrix4(viewMatrix,viewNormalMatrix);plane.normal.toArray(dstArray,i4);dstArray[i4+3]=plane.constant;}}uniform.value=dstArray;uniform.needsUpdate=true;}scope.numPlanes=nPlanes;return dstArray;}}/**
   * @author thespite / http://www.twitter.com/thespite
   */function WebGLUtils(gl,extensions){function convert(p){var extension;if(p===RepeatWrapping){return gl.REPEAT;}if(p===ClampToEdgeWrapping){return gl.CLAMP_TO_EDGE;}if(p===MirroredRepeatWrapping){return gl.MIRRORED_REPEAT;}if(p===NearestFilter){return gl.NEAREST;}if(p===NearestMipMapNearestFilter){return gl.NEAREST_MIPMAP_NEAREST;}if(p===NearestMipMapLinearFilter){return gl.NEAREST_MIPMAP_LINEAR;}if(p===LinearFilter){return gl.LINEAR;}if(p===LinearMipMapNearestFilter){return gl.LINEAR_MIPMAP_NEAREST;}if(p===LinearMipMapLinearFilter){return gl.LINEAR_MIPMAP_LINEAR;}if(p===UnsignedByteType){return gl.UNSIGNED_BYTE;}if(p===UnsignedShort4444Type){return gl.UNSIGNED_SHORT_4_4_4_4;}if(p===UnsignedShort5551Type){return gl.UNSIGNED_SHORT_5_5_5_1;}if(p===UnsignedShort565Type){return gl.UNSIGNED_SHORT_5_6_5;}if(p===ByteType){return gl.BYTE;}if(p===ShortType){return gl.SHORT;}if(p===UnsignedShortType){return gl.UNSIGNED_SHORT;}if(p===IntType){return gl.INT;}if(p===UnsignedIntType){return gl.UNSIGNED_INT;}if(p===FloatType){return gl.FLOAT;}if(p===HalfFloatType){extension=extensions.get('OES_texture_half_float');if(extension!==null){return extension.HALF_FLOAT_OES;}}if(p===AlphaFormat){return gl.ALPHA;}if(p===RGBFormat){return gl.RGB;}if(p===RGBAFormat){return gl.RGBA;}if(p===LuminanceFormat){return gl.LUMINANCE;}if(p===LuminanceAlphaFormat){return gl.LUMINANCE_ALPHA;}if(p===DepthFormat){return gl.DEPTH_COMPONENT;}if(p===DepthStencilFormat){return gl.DEPTH_STENCIL;}if(p===AddEquation){return gl.FUNC_ADD;}if(p===SubtractEquation){return gl.FUNC_SUBTRACT;}if(p===ReverseSubtractEquation){return gl.FUNC_REVERSE_SUBTRACT;}if(p===ZeroFactor){return gl.ZERO;}if(p===OneFactor){return gl.ONE;}if(p===SrcColorFactor){return gl.SRC_COLOR;}if(p===OneMinusSrcColorFactor){return gl.ONE_MINUS_SRC_COLOR;}if(p===SrcAlphaFactor){return gl.SRC_ALPHA;}if(p===OneMinusSrcAlphaFactor){return gl.ONE_MINUS_SRC_ALPHA;}if(p===DstAlphaFactor){return gl.DST_ALPHA;}if(p===OneMinusDstAlphaFactor){return gl.ONE_MINUS_DST_ALPHA;}if(p===DstColorFactor){return gl.DST_COLOR;}if(p===OneMinusDstColorFactor){return gl.ONE_MINUS_DST_COLOR;}if(p===SrcAlphaSaturateFactor){return gl.SRC_ALPHA_SATURATE;}if(p===RGB_S3TC_DXT1_Format||p===RGBA_S3TC_DXT1_Format||p===RGBA_S3TC_DXT3_Format||p===RGBA_S3TC_DXT5_Format){extension=extensions.get('WEBGL_compressed_texture_s3tc');if(extension!==null){if(p===RGB_S3TC_DXT1_Format){return extension.COMPRESSED_RGB_S3TC_DXT1_EXT;}if(p===RGBA_S3TC_DXT1_Format){return extension.COMPRESSED_RGBA_S3TC_DXT1_EXT;}if(p===RGBA_S3TC_DXT3_Format){return extension.COMPRESSED_RGBA_S3TC_DXT3_EXT;}if(p===RGBA_S3TC_DXT5_Format){return extension.COMPRESSED_RGBA_S3TC_DXT5_EXT;}}}if(p===RGB_PVRTC_4BPPV1_Format||p===RGB_PVRTC_2BPPV1_Format||p===RGBA_PVRTC_4BPPV1_Format||p===RGBA_PVRTC_2BPPV1_Format){extension=extensions.get('WEBGL_compressed_texture_pvrtc');if(extension!==null){if(p===RGB_PVRTC_4BPPV1_Format){return extension.COMPRESSED_RGB_PVRTC_4BPPV1_IMG;}if(p===RGB_PVRTC_2BPPV1_Format){return extension.COMPRESSED_RGB_PVRTC_2BPPV1_IMG;}if(p===RGBA_PVRTC_4BPPV1_Format){return extension.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG;}if(p===RGBA_PVRTC_2BPPV1_Format){return extension.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG;}}}if(p===RGB_ETC1_Format){extension=extensions.get('WEBGL_compressed_texture_etc1');if(extension!==null){return extension.COMPRESSED_RGB_ETC1_WEBGL;}}if(p===MinEquation||p===MaxEquation){extension=extensions.get('EXT_blend_minmax');if(extension!==null){if(p===MinEquation){return extension.MIN_EXT;}if(p===MaxEquation){return extension.MAX_EXT;}}}if(p===UnsignedInt248Type){extension=extensions.get('WEBGL_depth_texture');if(extension!==null){return extension.UNSIGNED_INT_24_8_WEBGL;}}return 0;}return{convert:convert};}/**
   * @author supereggbert / http://www.paulbrunt.co.uk/
   * @author mrdoob / http://mrdoob.com/
   * @author alteredq / http://alteredqualia.com/
   * @author szimek / https://github.com/szimek/
   * @author tschw
   */function WebGLRenderer(parameters){console.log('THREE.WebGLRenderer',REVISION);parameters=parameters||{};var _canvas=parameters.canvas!==undefined?parameters.canvas:document.createElementNS('http://www.w3.org/1999/xhtml','canvas'),_context=parameters.context!==undefined?parameters.context:null,_alpha=parameters.alpha!==undefined?parameters.alpha:false,_depth=parameters.depth!==undefined?parameters.depth:true,_stencil=parameters.stencil!==undefined?parameters.stencil:true,_antialias=parameters.antialias!==undefined?parameters.antialias:false,_premultipliedAlpha=parameters.premultipliedAlpha!==undefined?parameters.premultipliedAlpha:true,_preserveDrawingBuffer=parameters.preserveDrawingBuffer!==undefined?parameters.preserveDrawingBuffer:false,_powerPreference=parameters.powerPreference!==undefined?parameters.powerPreference:'default';var lightsArray=[];var shadowsArray=[];var currentRenderList=null;var spritesArray=[];var flaresArray=[];// public properties
  this.domElement=_canvas;this.context=null;// clearing
  this.autoClear=true;this.autoClearColor=true;this.autoClearDepth=true;this.autoClearStencil=true;// scene graph
  this.sortObjects=true;// user-defined clipping
  this.clippingPlanes=[];this.localClippingEnabled=false;// physically based shading
  this.gammaFactor=2.0;// for backwards compatibility
  this.gammaInput=false;this.gammaOutput=false;// physical lights
  this.physicallyCorrectLights=false;// tone mapping
  this.toneMapping=LinearToneMapping;this.toneMappingExposure=1.0;this.toneMappingWhitePoint=1.0;// morphs
  this.maxMorphTargets=8;this.maxMorphNormals=4;// internal properties
  var _this=this,_isContextLost=false,// internal state cache
  _currentRenderTarget=null,_currentFramebuffer=null,_currentMaterialId=-1,_currentGeometryProgram='',_currentCamera=null,_currentArrayCamera=null,_currentViewport=new Vector4$1(),_currentScissor=new Vector4$1(),_currentScissorTest=null,//
  _usedTextureUnits=0,//
  _width=_canvas.width,_height=_canvas.height,_pixelRatio=1,_viewport=new Vector4$1(0,0,_width,_height),_scissor=new Vector4$1(0,0,_width,_height),_scissorTest=false,// frustum
  _frustum=new Frustum(),// clipping
  _clipping=new WebGLClipping(),_clippingEnabled=false,_localClippingEnabled=false,// camera matrices cache
  _projScreenMatrix=new Matrix4(),_vector3=new Vector3$1(),// info
  _infoMemory={geometries:0,textures:0},_infoRender={frame:0,calls:0,vertices:0,faces:0,points:0};this.info={render:_infoRender,memory:_infoMemory,programs:null};function getTargetPixelRatio(){return _currentRenderTarget===null?_pixelRatio:1;}// initialize
  var _gl;try{var contextAttributes={alpha:_alpha,depth:_depth,stencil:_stencil,antialias:_antialias,premultipliedAlpha:_premultipliedAlpha,preserveDrawingBuffer:_preserveDrawingBuffer,powerPreference:_powerPreference};// event listeners must be registered before WebGL context is created, see #12753
  _canvas.addEventListener('webglcontextlost',onContextLost,false);_canvas.addEventListener('webglcontextrestored',onContextRestore,false);_gl=_context||_canvas.getContext('webgl',contextAttributes)||_canvas.getContext('experimental-webgl',contextAttributes);if(_gl===null){if(_canvas.getContext('webgl')!==null){throw new Error('Error creating WebGL context with your selected attributes.');}else{throw new Error('Error creating WebGL context.');}}// Some experimental-webgl implementations do not have getShaderPrecisionFormat
  if(_gl.getShaderPrecisionFormat===undefined){_gl.getShaderPrecisionFormat=function(){return{'rangeMin':1,'rangeMax':1,'precision':1};};}}catch(error){console.error('THREE.WebGLRenderer: '+error.message);}var extensions,capabilities,state;var properties,textures,attributes,geometries,objects,lights;var programCache,renderLists;var background,morphtargets,bufferRenderer,indexedBufferRenderer;var flareRenderer,spriteRenderer;var utils;function initGLContext(){extensions=new WebGLExtensions(_gl);extensions.get('WEBGL_depth_texture');extensions.get('OES_texture_float');extensions.get('OES_texture_float_linear');extensions.get('OES_texture_half_float');extensions.get('OES_texture_half_float_linear');extensions.get('OES_standard_derivatives');extensions.get('OES_element_index_uint');extensions.get('ANGLE_instanced_arrays');utils=new WebGLUtils(_gl,extensions);capabilities=new WebGLCapabilities(_gl,extensions,parameters);state=new WebGLState(_gl,extensions,utils);state.scissor(_currentScissor.copy(_scissor).multiplyScalar(_pixelRatio));state.viewport(_currentViewport.copy(_viewport).multiplyScalar(_pixelRatio));properties=new WebGLProperties();textures=new WebGLTextures(_gl,extensions,state,properties,capabilities,utils,_infoMemory);attributes=new WebGLAttributes(_gl);geometries=new WebGLGeometries(_gl,attributes,_infoMemory);objects=new WebGLObjects(geometries,_infoRender);morphtargets=new WebGLMorphtargets(_gl);programCache=new WebGLPrograms(_this,extensions,capabilities);lights=new WebGLLights();renderLists=new WebGLRenderLists();background=new WebGLBackground(_this,state,geometries,_premultipliedAlpha);bufferRenderer=new WebGLBufferRenderer(_gl,extensions,_infoRender);indexedBufferRenderer=new WebGLIndexedBufferRenderer(_gl,extensions,_infoRender);flareRenderer=new WebGLFlareRenderer(_this,_gl,state,textures,capabilities);spriteRenderer=new WebGLSpriteRenderer(_this,_gl,state,textures,capabilities);_this.info.programs=programCache.programs;_this.context=_gl;_this.capabilities=capabilities;_this.extensions=extensions;_this.properties=properties;_this.renderLists=renderLists;_this.state=state;}initGLContext();// vr
  var vr=new WebVRManager(_this);this.vr=vr;// shadow map
  var shadowMap=new WebGLShadowMap(_this,objects,capabilities.maxTextureSize);this.shadowMap=shadowMap;// API
  this.getContext=function(){return _gl;};this.getContextAttributes=function(){return _gl.getContextAttributes();};this.forceContextLoss=function(){var extension=extensions.get('WEBGL_lose_context');if(extension){extension.loseContext();}};this.forceContextRestore=function(){var extension=extensions.get('WEBGL_lose_context');if(extension){extension.restoreContext();}};this.getPixelRatio=function(){return _pixelRatio;};this.setPixelRatio=function(value){if(value===undefined){return;}_pixelRatio=value;this.setSize(_width,_height,false);};this.getSize=function(){return{width:_width,height:_height};};this.setSize=function(width,height,updateStyle){var device=vr.getDevice();if(device&&device.isPresenting){console.warn('THREE.WebGLRenderer: Can\'t change size while VR device is presenting.');return;}_width=width;_height=height;_canvas.width=width*_pixelRatio;_canvas.height=height*_pixelRatio;if(updateStyle!==false){_canvas.style.width=width+'px';_canvas.style.height=height+'px';}this.setViewport(0,0,width,height);};this.getDrawingBufferSize=function(){return{width:_width*_pixelRatio,height:_height*_pixelRatio};};this.setDrawingBufferSize=function(width,height,pixelRatio){_width=width;_height=height;_pixelRatio=pixelRatio;_canvas.width=width*pixelRatio;_canvas.height=height*pixelRatio;this.setViewport(0,0,width,height);};this.setViewport=function(x,y,width,height){_viewport.set(x,_height-y-height,width,height);state.viewport(_currentViewport.copy(_viewport).multiplyScalar(_pixelRatio));};this.setScissor=function(x,y,width,height){_scissor.set(x,_height-y-height,width,height);state.scissor(_currentScissor.copy(_scissor).multiplyScalar(_pixelRatio));};this.setScissorTest=function(boolean){state.setScissorTest(_scissorTest=boolean);};// Clearing
  this.getClearColor=function(){return background.getClearColor();};this.setClearColor=function(){background.setClearColor.apply(background,arguments);};this.getClearAlpha=function(){return background.getClearAlpha();};this.setClearAlpha=function(){background.setClearAlpha.apply(background,arguments);};this.clear=function(color,depth,stencil){var bits=0;if(color===undefined||color){bits|=_gl.COLOR_BUFFER_BIT;}if(depth===undefined||depth){bits|=_gl.DEPTH_BUFFER_BIT;}if(stencil===undefined||stencil){bits|=_gl.STENCIL_BUFFER_BIT;}_gl.clear(bits);};this.clearColor=function(){this.clear(true,false,false);};this.clearDepth=function(){this.clear(false,true,false);};this.clearStencil=function(){this.clear(false,false,true);};this.clearTarget=function(renderTarget,color,depth,stencil){this.setRenderTarget(renderTarget);this.clear(color,depth,stencil);};//
  this.dispose=function(){_canvas.removeEventListener('webglcontextlost',onContextLost,false);_canvas.removeEventListener('webglcontextrestored',onContextRestore,false);renderLists.dispose();vr.dispose();};// Events
  function onContextLost(event){event.preventDefault();console.log('THREE.WebGLRenderer: Context Lost.');_isContextLost=true;}function onContextRestore()/* event */{console.log('THREE.WebGLRenderer: Context Restored.');_isContextLost=false;initGLContext();}function onMaterialDispose(event){var material=event.target;material.removeEventListener('dispose',onMaterialDispose);deallocateMaterial(material);}// Buffer deallocation
  function deallocateMaterial(material){releaseMaterialProgramReference(material);properties.remove(material);}function releaseMaterialProgramReference(material){var programInfo=properties.get(material).program;material.program=undefined;if(programInfo!==undefined){programCache.releaseProgram(programInfo);}}// Buffer rendering
  function renderObjectImmediate(object,program,material){object.render(function(object){_this.renderBufferImmediate(object,program,material);});}this.renderBufferImmediate=function(object,program,material){state.initAttributes();var buffers=properties.get(object);if(object.hasPositions&&!buffers.position){buffers.position=_gl.createBuffer();}if(object.hasNormals&&!buffers.normal){buffers.normal=_gl.createBuffer();}if(object.hasUvs&&!buffers.uv){buffers.uv=_gl.createBuffer();}if(object.hasColors&&!buffers.color){buffers.color=_gl.createBuffer();}var programAttributes=program.getAttributes();if(object.hasPositions){_gl.bindBuffer(_gl.ARRAY_BUFFER,buffers.position);_gl.bufferData(_gl.ARRAY_BUFFER,object.positionArray,_gl.DYNAMIC_DRAW);state.enableAttribute(programAttributes.position);_gl.vertexAttribPointer(programAttributes.position,3,_gl.FLOAT,false,0,0);}if(object.hasNormals){_gl.bindBuffer(_gl.ARRAY_BUFFER,buffers.normal);if(!material.isMeshPhongMaterial&&!material.isMeshStandardMaterial&&!material.isMeshNormalMaterial&&material.flatShading===true){for(var i=0,l=object.count*3;i<l;i+=9){var array=object.normalArray;var nx=(array[i+0]+array[i+3]+array[i+6])/3;var ny=(array[i+1]+array[i+4]+array[i+7])/3;var nz=(array[i+2]+array[i+5]+array[i+8])/3;array[i+0]=nx;array[i+1]=ny;array[i+2]=nz;array[i+3]=nx;array[i+4]=ny;array[i+5]=nz;array[i+6]=nx;array[i+7]=ny;array[i+8]=nz;}}_gl.bufferData(_gl.ARRAY_BUFFER,object.normalArray,_gl.DYNAMIC_DRAW);state.enableAttribute(programAttributes.normal);_gl.vertexAttribPointer(programAttributes.normal,3,_gl.FLOAT,false,0,0);}if(object.hasUvs&&material.map){_gl.bindBuffer(_gl.ARRAY_BUFFER,buffers.uv);_gl.bufferData(_gl.ARRAY_BUFFER,object.uvArray,_gl.DYNAMIC_DRAW);state.enableAttribute(programAttributes.uv);_gl.vertexAttribPointer(programAttributes.uv,2,_gl.FLOAT,false,0,0);}if(object.hasColors&&material.vertexColors!==NoColors){_gl.bindBuffer(_gl.ARRAY_BUFFER,buffers.color);_gl.bufferData(_gl.ARRAY_BUFFER,object.colorArray,_gl.DYNAMIC_DRAW);state.enableAttribute(programAttributes.color);_gl.vertexAttribPointer(programAttributes.color,3,_gl.FLOAT,false,0,0);}state.disableUnusedAttributes();_gl.drawArrays(_gl.TRIANGLES,0,object.count);object.count=0;};this.renderBufferDirect=function(camera,fog,geometry,material,object,group){var frontFaceCW=object.isMesh&&object.matrixWorld.determinant()<0;state.setMaterial(material,frontFaceCW);var program=setProgram(camera,fog,material,object);var geometryProgram=geometry.id+'_'+program.id+'_'+(material.wireframe===true);var updateBuffers=false;if(geometryProgram!==_currentGeometryProgram){_currentGeometryProgram=geometryProgram;updateBuffers=true;}if(object.morphTargetInfluences){morphtargets.update(object,geometry,material,program);updateBuffers=true;}//
  var index=geometry.index;var position=geometry.attributes.position;var rangeFactor=1;if(material.wireframe===true){index=geometries.getWireframeAttribute(geometry);rangeFactor=2;}var attribute;var renderer=bufferRenderer;if(index!==null){attribute=attributes.get(index);renderer=indexedBufferRenderer;renderer.setIndex(attribute);}if(updateBuffers){setupVertexAttributes(material,program,geometry);if(index!==null){_gl.bindBuffer(_gl.ELEMENT_ARRAY_BUFFER,attribute.buffer);}}//
  var dataCount=0;if(index!==null){dataCount=index.count;}else if(position!==undefined){dataCount=position.count;}var rangeStart=geometry.drawRange.start*rangeFactor;var rangeCount=geometry.drawRange.count*rangeFactor;var groupStart=group!==null?group.start*rangeFactor:0;var groupCount=group!==null?group.count*rangeFactor:Infinity;var drawStart=Math.max(rangeStart,groupStart);var drawEnd=Math.min(dataCount,rangeStart+rangeCount,groupStart+groupCount)-1;var drawCount=Math.max(0,drawEnd-drawStart+1);if(drawCount===0){return;}//
  if(object.isMesh){if(material.wireframe===true){state.setLineWidth(material.wireframeLinewidth*getTargetPixelRatio());renderer.setMode(_gl.LINES);}else{switch(object.drawMode){case TrianglesDrawMode:renderer.setMode(_gl.TRIANGLES);break;case TriangleStripDrawMode:renderer.setMode(_gl.TRIANGLE_STRIP);break;case TriangleFanDrawMode:renderer.setMode(_gl.TRIANGLE_FAN);break;}}}else if(object.isLine){var lineWidth=material.linewidth;if(lineWidth===undefined){lineWidth=1;}// Not using Line*Material
  state.setLineWidth(lineWidth*getTargetPixelRatio());if(object.isLineSegments){renderer.setMode(_gl.LINES);}else if(object.isLineLoop){renderer.setMode(_gl.LINE_LOOP);}else{renderer.setMode(_gl.LINE_STRIP);}}else if(object.isPoints){renderer.setMode(_gl.POINTS);}if(geometry&&geometry.isInstancedBufferGeometry){if(geometry.maxInstancedCount>0){renderer.renderInstances(geometry,drawStart,drawCount);}}else{renderer.render(drawStart,drawCount);}};function setupVertexAttributes(material,program,geometry,startIndex){if(geometry&&geometry.isInstancedBufferGeometry){if(extensions.get('ANGLE_instanced_arrays')===null){console.error('THREE.WebGLRenderer.setupVertexAttributes: using THREE.InstancedBufferGeometry but hardware does not support extension ANGLE_instanced_arrays.');return;}}if(startIndex===undefined){startIndex=0;}state.initAttributes();var geometryAttributes=geometry.attributes;var programAttributes=program.getAttributes();var materialDefaultAttributeValues=material.defaultAttributeValues;for(var name in programAttributes){var programAttribute=programAttributes[name];if(programAttribute>=0){var geometryAttribute=geometryAttributes[name];if(geometryAttribute!==undefined){var normalized=geometryAttribute.normalized;var size=geometryAttribute.itemSize;var attribute=attributes.get(geometryAttribute);// TODO Attribute may not be available on context restore
  if(attribute===undefined){continue;}var buffer=attribute.buffer;var type=attribute.type;var bytesPerElement=attribute.bytesPerElement;if(geometryAttribute.isInterleavedBufferAttribute){var data=geometryAttribute.data;var stride=data.stride;var offset=geometryAttribute.offset;if(data&&data.isInstancedInterleavedBuffer){state.enableAttributeAndDivisor(programAttribute,data.meshPerAttribute);if(geometry.maxInstancedCount===undefined){geometry.maxInstancedCount=data.meshPerAttribute*data.count;}}else{state.enableAttribute(programAttribute);}_gl.bindBuffer(_gl.ARRAY_BUFFER,buffer);_gl.vertexAttribPointer(programAttribute,size,type,normalized,stride*bytesPerElement,(startIndex*stride+offset)*bytesPerElement);}else{if(geometryAttribute.isInstancedBufferAttribute){state.enableAttributeAndDivisor(programAttribute,geometryAttribute.meshPerAttribute);if(geometry.maxInstancedCount===undefined){geometry.maxInstancedCount=geometryAttribute.meshPerAttribute*geometryAttribute.count;}}else{state.enableAttribute(programAttribute);}_gl.bindBuffer(_gl.ARRAY_BUFFER,buffer);_gl.vertexAttribPointer(programAttribute,size,type,normalized,0,startIndex*size*bytesPerElement);}}else if(materialDefaultAttributeValues!==undefined){var value=materialDefaultAttributeValues[name];if(value!==undefined){switch(value.length){case 2:_gl.vertexAttrib2fv(programAttribute,value);break;case 3:_gl.vertexAttrib3fv(programAttribute,value);break;case 4:_gl.vertexAttrib4fv(programAttribute,value);break;default:_gl.vertexAttrib1fv(programAttribute,value);}}}}}state.disableUnusedAttributes();}// Compile
  this.compile=function(scene,camera){lightsArray.length=0;shadowsArray.length=0;scene.traverse(function(object){if(object.isLight){lightsArray.push(object);if(object.castShadow){shadowsArray.push(object);}}});lights.setup(lightsArray,shadowsArray,camera);scene.traverse(function(object){if(object.material){if(Array.isArray(object.material)){for(var i=0;i<object.material.length;i++){initMaterial(object.material[i],scene.fog,object);}}else{initMaterial(object.material,scene.fog,object);}}});};// Animation Loop
  var isAnimating=false;var onAnimationFrame=null;function start(){if(isAnimating){return;}var device=vr.getDevice();if(device&&device.isPresenting){device.requestAnimationFrame(loop);}else{window.requestAnimationFrame(loop);}isAnimating=true;}function loop(time){if(onAnimationFrame!==null){onAnimationFrame(time);}var device=vr.getDevice();if(device&&device.isPresenting){device.requestAnimationFrame(loop);}else{window.requestAnimationFrame(loop);}}this.animate=function(callback){onAnimationFrame=callback;start();};// Rendering
  this.render=function(scene,camera,renderTarget,forceClear){if(!(camera&&camera.isCamera)){console.error('THREE.WebGLRenderer.render: camera is not an instance of THREE.Camera.');return;}if(_isContextLost){return;}// reset caching for this frame
  _currentGeometryProgram='';_currentMaterialId=-1;_currentCamera=null;// update scene graph
  if(scene.autoUpdate===true){scene.updateMatrixWorld();}// update camera matrices and frustum
  if(camera.parent===null){camera.updateMatrixWorld();}if(vr.enabled){camera=vr.getCamera(camera);}_projScreenMatrix.multiplyMatrices(camera.projectionMatrix,camera.matrixWorldInverse);_frustum.setFromMatrix(_projScreenMatrix);lightsArray.length=0;shadowsArray.length=0;spritesArray.length=0;flaresArray.length=0;_localClippingEnabled=this.localClippingEnabled;_clippingEnabled=_clipping.init(this.clippingPlanes,_localClippingEnabled,camera);currentRenderList=renderLists.get(scene,camera);currentRenderList.init();projectObject(scene,camera,_this.sortObjects);if(_this.sortObjects===true){currentRenderList.sort();}//
  textures.updateVideoTextures();//
  if(_clippingEnabled){_clipping.beginShadows();}shadowMap.render(shadowsArray,scene,camera);lights.setup(lightsArray,shadowsArray,camera);if(_clippingEnabled){_clipping.endShadows();}//
  _infoRender.frame++;_infoRender.calls=0;_infoRender.vertices=0;_infoRender.faces=0;_infoRender.points=0;if(renderTarget===undefined){renderTarget=null;}this.setRenderTarget(renderTarget);//
  background.render(currentRenderList,scene,camera,forceClear);// render scene
  var opaqueObjects=currentRenderList.opaque;var transparentObjects=currentRenderList.transparent;if(scene.overrideMaterial){var overrideMaterial=scene.overrideMaterial;if(opaqueObjects.length){renderObjects(opaqueObjects,scene,camera,overrideMaterial);}if(transparentObjects.length){renderObjects(transparentObjects,scene,camera,overrideMaterial);}}else{// opaque pass (front-to-back order)
  if(opaqueObjects.length){renderObjects(opaqueObjects,scene,camera);}// transparent pass (back-to-front order)
  if(transparentObjects.length){renderObjects(transparentObjects,scene,camera);}}// custom renderers
  spriteRenderer.render(spritesArray,scene,camera);flareRenderer.render(flaresArray,scene,camera,_currentViewport);// Generate mipmap if we're using any kind of mipmap filtering
  if(renderTarget){textures.updateRenderTargetMipmap(renderTarget);}// Ensure depth buffer writing is enabled so it can be cleared on next render
  state.buffers.depth.setTest(true);state.buffers.depth.setMask(true);state.buffers.color.setMask(true);state.setPolygonOffset(false);if(vr.enabled){vr.submitFrame();}// _gl.finish();
  };/*
  	// TODO Duplicated code (Frustum)

  	var _sphere = new Sphere();

  	function isObjectViewable( object ) {

  		var geometry = object.geometry;

  		if ( geometry.boundingSphere === null )
  			geometry.computeBoundingSphere();

  		_sphere.copy( geometry.boundingSphere ).
  		applyMatrix4( object.matrixWorld );

  		return isSphereViewable( _sphere );

  	}

  	function isSpriteViewable( sprite ) {

  		_sphere.center.set( 0, 0, 0 );
  		_sphere.radius = 0.7071067811865476;
  		_sphere.applyMatrix4( sprite.matrixWorld );

  		return isSphereViewable( _sphere );

  	}

  	function isSphereViewable( sphere ) {

  		if ( ! _frustum.intersectsSphere( sphere ) ) return false;

  		var numPlanes = _clipping.numPlanes;

  		if ( numPlanes === 0 ) return true;

  		var planes = _this.clippingPlanes,

  			center = sphere.center,
  			negRad = - sphere.radius,
  			i = 0;

  		do {

  			// out when deeper than radius in the negative halfspace
  			if ( planes[ i ].distanceToPoint( center ) < negRad ) return false;

  		} while ( ++ i !== numPlanes );

  		return true;

  	}
  	*/function projectObject(object,camera,sortObjects){if(object.visible===false){return;}var visible=object.layers.test(camera.layers);if(visible){if(object.isLight){lightsArray.push(object);if(object.castShadow){shadowsArray.push(object);}}else if(object.isSprite){if(!object.frustumCulled||_frustum.intersectsSprite(object)){spritesArray.push(object);}}else if(object.isLensFlare){flaresArray.push(object);}else if(object.isImmediateRenderObject){if(sortObjects){_vector3.setFromMatrixPosition(object.matrixWorld).applyMatrix4(_projScreenMatrix);}currentRenderList.push(object,null,object.material,_vector3.z,null);}else if(object.isMesh||object.isLine||object.isPoints){if(object.isSkinnedMesh){object.skeleton.update();}if(!object.frustumCulled||_frustum.intersectsObject(object)){if(sortObjects){_vector3.setFromMatrixPosition(object.matrixWorld).applyMatrix4(_projScreenMatrix);}var geometry=objects.update(object);var material=object.material;if(Array.isArray(material)){var groups=geometry.groups;for(var i=0,l=groups.length;i<l;i++){var group=groups[i];var groupMaterial=material[group.materialIndex];if(groupMaterial&&groupMaterial.visible){currentRenderList.push(object,geometry,groupMaterial,_vector3.z,group);}}}else if(material.visible){currentRenderList.push(object,geometry,material,_vector3.z,null);}}}}var children=object.children;for(var i=0,l=children.length;i<l;i++){projectObject(children[i],camera,sortObjects);}}function renderObjects(renderList,scene,camera,overrideMaterial){for(var i=0,l=renderList.length;i<l;i++){var renderItem=renderList[i];var object=renderItem.object;var geometry=renderItem.geometry;var material=overrideMaterial===undefined?renderItem.material:overrideMaterial;var group=renderItem.group;if(camera.isArrayCamera){_currentArrayCamera=camera;var cameras=camera.cameras;for(var j=0,jl=cameras.length;j<jl;j++){var camera2=cameras[j];if(object.layers.test(camera2.layers)){var bounds=camera2.bounds;var x=bounds.x*_width;var y=bounds.y*_height;var width=bounds.z*_width;var height=bounds.w*_height;state.viewport(_currentViewport.set(x,y,width,height).multiplyScalar(_pixelRatio));renderObject(object,scene,camera2,geometry,material,group);}}}else{_currentArrayCamera=null;renderObject(object,scene,camera,geometry,material,group);}}}function renderObject(object,scene,camera,geometry,material,group){object.onBeforeRender(_this,scene,camera,geometry,material,group);object.modelViewMatrix.multiplyMatrices(camera.matrixWorldInverse,object.matrixWorld);object.normalMatrix.getNormalMatrix(object.modelViewMatrix);if(object.isImmediateRenderObject){var frontFaceCW=object.isMesh&&object.matrixWorld.determinant()<0;state.setMaterial(material,frontFaceCW);var program=setProgram(camera,scene.fog,material,object);_currentGeometryProgram='';renderObjectImmediate(object,program,material);}else{_this.renderBufferDirect(camera,scene.fog,geometry,material,object,group);}object.onAfterRender(_this,scene,camera,geometry,material,group);}function initMaterial(material,fog,object){var materialProperties=properties.get(material);var parameters=programCache.getParameters(material,lights.state,shadowsArray,fog,_clipping.numPlanes,_clipping.numIntersection,object);var code=programCache.getProgramCode(material,parameters);var program=materialProperties.program;var programChange=true;if(program===undefined){// new material
  material.addEventListener('dispose',onMaterialDispose);}else if(program.code!==code){// changed glsl or parameters
  releaseMaterialProgramReference(material);}else if(parameters.shaderID!==undefined){// same glsl and uniform list
  return;}else{// only rebuild uniform list
  programChange=false;}if(programChange){if(parameters.shaderID){var shader=ShaderLib[parameters.shaderID];materialProperties.shader={name:material.type,uniforms:UniformsUtils.clone(shader.uniforms),vertexShader:shader.vertexShader,fragmentShader:shader.fragmentShader};}else{materialProperties.shader={name:material.type,uniforms:material.uniforms,vertexShader:material.vertexShader,fragmentShader:material.fragmentShader};}material.onBeforeCompile(materialProperties.shader);program=programCache.acquireProgram(material,materialProperties.shader,parameters,code);materialProperties.program=program;material.program=program;}var programAttributes=program.getAttributes();if(material.morphTargets){material.numSupportedMorphTargets=0;for(var i=0;i<_this.maxMorphTargets;i++){if(programAttributes['morphTarget'+i]>=0){material.numSupportedMorphTargets++;}}}if(material.morphNormals){material.numSupportedMorphNormals=0;for(var i=0;i<_this.maxMorphNormals;i++){if(programAttributes['morphNormal'+i]>=0){material.numSupportedMorphNormals++;}}}var uniforms=materialProperties.shader.uniforms;if(!material.isShaderMaterial&&!material.isRawShaderMaterial||material.clipping===true){materialProperties.numClippingPlanes=_clipping.numPlanes;materialProperties.numIntersection=_clipping.numIntersection;uniforms.clippingPlanes=_clipping.uniform;}materialProperties.fog=fog;// store the light setup it was created for
  materialProperties.lightsHash=lights.state.hash;if(material.lights){// wire up the material to this renderer's lighting state
  uniforms.ambientLightColor.value=lights.state.ambient;uniforms.directionalLights.value=lights.state.directional;uniforms.spotLights.value=lights.state.spot;uniforms.rectAreaLights.value=lights.state.rectArea;uniforms.pointLights.value=lights.state.point;uniforms.hemisphereLights.value=lights.state.hemi;uniforms.directionalShadowMap.value=lights.state.directionalShadowMap;uniforms.directionalShadowMatrix.value=lights.state.directionalShadowMatrix;uniforms.spotShadowMap.value=lights.state.spotShadowMap;uniforms.spotShadowMatrix.value=lights.state.spotShadowMatrix;uniforms.pointShadowMap.value=lights.state.pointShadowMap;uniforms.pointShadowMatrix.value=lights.state.pointShadowMatrix;// TODO (abelnation): add area lights shadow info to uniforms
  }var progUniforms=materialProperties.program.getUniforms(),uniformsList=WebGLUniforms.seqWithValue(progUniforms.seq,uniforms);materialProperties.uniformsList=uniformsList;}function setProgram(camera,fog,material,object){_usedTextureUnits=0;var materialProperties=properties.get(material);if(_clippingEnabled){if(_localClippingEnabled||camera!==_currentCamera){var useCache=camera===_currentCamera&&material.id===_currentMaterialId;// we might want to call this function with some ClippingGroup
  // object instead of the material, once it becomes feasible
  // (#8465, #8379)
  _clipping.setState(material.clippingPlanes,material.clipIntersection,material.clipShadows,camera,materialProperties,useCache);}}if(material.needsUpdate===false){if(materialProperties.program===undefined){material.needsUpdate=true;}else if(material.fog&&materialProperties.fog!==fog){material.needsUpdate=true;}else if(material.lights&&materialProperties.lightsHash!==lights.state.hash){material.needsUpdate=true;}else if(materialProperties.numClippingPlanes!==undefined&&(materialProperties.numClippingPlanes!==_clipping.numPlanes||materialProperties.numIntersection!==_clipping.numIntersection)){material.needsUpdate=true;}}if(material.needsUpdate){initMaterial(material,fog,object);material.needsUpdate=false;}var refreshProgram=false;var refreshMaterial=false;var refreshLights=false;var program=materialProperties.program,p_uniforms=program.getUniforms(),m_uniforms=materialProperties.shader.uniforms;if(state.useProgram(program.program)){refreshProgram=true;refreshMaterial=true;refreshLights=true;}if(material.id!==_currentMaterialId){_currentMaterialId=material.id;refreshMaterial=true;}if(refreshProgram||camera!==_currentCamera){p_uniforms.setValue(_gl,'projectionMatrix',camera.projectionMatrix);if(capabilities.logarithmicDepthBuffer){p_uniforms.setValue(_gl,'logDepthBufFC',2.0/(Math.log(camera.far+1.0)/Math.LN2));}// Avoid unneeded uniform updates per ArrayCamera's sub-camera
  if(_currentCamera!==(_currentArrayCamera||camera)){_currentCamera=_currentArrayCamera||camera;// lighting uniforms depend on the camera so enforce an update
  // now, in case this material supports lights - or later, when
  // the next material that does gets activated:
  refreshMaterial=true;// set to true on material change
  refreshLights=true;// remains set until update done
  }// load material specific uniforms
  // (shader material also gets them for the sake of genericity)
  if(material.isShaderMaterial||material.isMeshPhongMaterial||material.isMeshStandardMaterial||material.envMap){var uCamPos=p_uniforms.map.cameraPosition;if(uCamPos!==undefined){uCamPos.setValue(_gl,_vector3.setFromMatrixPosition(camera.matrixWorld));}}if(material.isMeshPhongMaterial||material.isMeshLambertMaterial||material.isMeshBasicMaterial||material.isMeshStandardMaterial||material.isShaderMaterial||material.skinning){p_uniforms.setValue(_gl,'viewMatrix',camera.matrixWorldInverse);}}// skinning uniforms must be set even if material didn't change
  // auto-setting of texture unit for bone texture must go before other textures
  // not sure why, but otherwise weird things happen
  if(material.skinning){p_uniforms.setOptional(_gl,object,'bindMatrix');p_uniforms.setOptional(_gl,object,'bindMatrixInverse');var skeleton=object.skeleton;if(skeleton){var bones=skeleton.bones;if(capabilities.floatVertexTextures){if(skeleton.boneTexture===undefined){// layout (1 matrix = 4 pixels)
  //      RGBA RGBA RGBA RGBA (=> column1, column2, column3, column4)
  //  with  8x8  pixel texture max   16 bones * 4 pixels =  (8 * 8)
  //       16x16 pixel texture max   64 bones * 4 pixels = (16 * 16)
  //       32x32 pixel texture max  256 bones * 4 pixels = (32 * 32)
  //       64x64 pixel texture max 1024 bones * 4 pixels = (64 * 64)
  var size=Math.sqrt(bones.length*4);// 4 pixels needed for 1 matrix
  size=_Math$1.ceilPowerOfTwo(size);size=Math.max(size,4);var boneMatrices=new Float32Array(size*size*4);// 4 floats per RGBA pixel
  boneMatrices.set(skeleton.boneMatrices);// copy current values
  var boneTexture=new DataTexture(boneMatrices,size,size,RGBAFormat,FloatType);skeleton.boneMatrices=boneMatrices;skeleton.boneTexture=boneTexture;skeleton.boneTextureSize=size;}p_uniforms.setValue(_gl,'boneTexture',skeleton.boneTexture);p_uniforms.setValue(_gl,'boneTextureSize',skeleton.boneTextureSize);}else{p_uniforms.setOptional(_gl,skeleton,'boneMatrices');}}}if(refreshMaterial){p_uniforms.setValue(_gl,'toneMappingExposure',_this.toneMappingExposure);p_uniforms.setValue(_gl,'toneMappingWhitePoint',_this.toneMappingWhitePoint);if(material.lights){// the current material requires lighting info
  // note: all lighting uniforms are always set correctly
  // they simply reference the renderer's state for their
  // values
  //
  // use the current material's .needsUpdate flags to set
  // the GL state when required
  markUniformsLightsNeedsUpdate(m_uniforms,refreshLights);}// refresh uniforms common to several materials
  if(fog&&material.fog){refreshUniformsFog(m_uniforms,fog);}if(material.isMeshBasicMaterial){refreshUniformsCommon(m_uniforms,material);}else if(material.isMeshLambertMaterial){refreshUniformsCommon(m_uniforms,material);refreshUniformsLambert(m_uniforms,material);}else if(material.isMeshPhongMaterial){refreshUniformsCommon(m_uniforms,material);if(material.isMeshToonMaterial){refreshUniformsToon(m_uniforms,material);}else{refreshUniformsPhong(m_uniforms,material);}}else if(material.isMeshStandardMaterial){refreshUniformsCommon(m_uniforms,material);if(material.isMeshPhysicalMaterial){refreshUniformsPhysical(m_uniforms,material);}else{refreshUniformsStandard(m_uniforms,material);}}else if(material.isMeshDepthMaterial){refreshUniformsCommon(m_uniforms,material);refreshUniformsDepth(m_uniforms,material);}else if(material.isMeshDistanceMaterial){refreshUniformsCommon(m_uniforms,material);refreshUniformsDistance(m_uniforms,material);}else if(material.isMeshNormalMaterial){refreshUniformsCommon(m_uniforms,material);refreshUniformsNormal(m_uniforms,material);}else if(material.isLineBasicMaterial){refreshUniformsLine(m_uniforms,material);if(material.isLineDashedMaterial){refreshUniformsDash(m_uniforms,material);}}else if(material.isPointsMaterial){refreshUniformsPoints(m_uniforms,material);}else if(material.isShadowMaterial){m_uniforms.color.value=material.color;m_uniforms.opacity.value=material.opacity;}// RectAreaLight Texture
  // TODO (mrdoob): Find a nicer implementation
  if(m_uniforms.ltcMat!==undefined){m_uniforms.ltcMat.value=UniformsLib.LTC_MAT_TEXTURE;}if(m_uniforms.ltcMag!==undefined){m_uniforms.ltcMag.value=UniformsLib.LTC_MAG_TEXTURE;}WebGLUniforms.upload(_gl,materialProperties.uniformsList,m_uniforms,_this);}// common matrices
  p_uniforms.setValue(_gl,'modelViewMatrix',object.modelViewMatrix);p_uniforms.setValue(_gl,'normalMatrix',object.normalMatrix);p_uniforms.setValue(_gl,'modelMatrix',object.matrixWorld);return program;}// Uniforms (refresh uniforms objects)
  function refreshUniformsCommon(uniforms,material){uniforms.opacity.value=material.opacity;if(material.color){uniforms.diffuse.value=material.color;}if(material.emissive){uniforms.emissive.value.copy(material.emissive).multiplyScalar(material.emissiveIntensity);}if(material.map){uniforms.map.value=material.map;}if(material.alphaMap){uniforms.alphaMap.value=material.alphaMap;}if(material.specularMap){uniforms.specularMap.value=material.specularMap;}if(material.envMap){uniforms.envMap.value=material.envMap;// don't flip CubeTexture envMaps, flip everything else:
  //  WebGLRenderTargetCube will be flipped for backwards compatibility
  //  WebGLRenderTargetCube.texture will be flipped because it's a Texture and NOT a CubeTexture
  // this check must be handled differently, or removed entirely, if WebGLRenderTargetCube uses a CubeTexture in the future
  uniforms.flipEnvMap.value=!(material.envMap&&material.envMap.isCubeTexture)?1:-1;uniforms.reflectivity.value=material.reflectivity;uniforms.refractionRatio.value=material.refractionRatio;}if(material.lightMap){uniforms.lightMap.value=material.lightMap;uniforms.lightMapIntensity.value=material.lightMapIntensity;}if(material.aoMap){uniforms.aoMap.value=material.aoMap;uniforms.aoMapIntensity.value=material.aoMapIntensity;}// uv repeat and offset setting priorities
  // 1. color map
  // 2. specular map
  // 3. normal map
  // 4. bump map
  // 5. alpha map
  // 6. emissive map
  var uvScaleMap;if(material.map){uvScaleMap=material.map;}else if(material.specularMap){uvScaleMap=material.specularMap;}else if(material.displacementMap){uvScaleMap=material.displacementMap;}else if(material.normalMap){uvScaleMap=material.normalMap;}else if(material.bumpMap){uvScaleMap=material.bumpMap;}else if(material.roughnessMap){uvScaleMap=material.roughnessMap;}else if(material.metalnessMap){uvScaleMap=material.metalnessMap;}else if(material.alphaMap){uvScaleMap=material.alphaMap;}else if(material.emissiveMap){uvScaleMap=material.emissiveMap;}if(uvScaleMap!==undefined){// backwards compatibility
  if(uvScaleMap.isWebGLRenderTarget){uvScaleMap=uvScaleMap.texture;}if(uvScaleMap.matrixAutoUpdate===true){var offset=uvScaleMap.offset;var repeat=uvScaleMap.repeat;var rotation=uvScaleMap.rotation;var center=uvScaleMap.center;uvScaleMap.matrix.setUvTransform(offset.x,offset.y,repeat.x,repeat.y,rotation,center.x,center.y);}uniforms.uvTransform.value.copy(uvScaleMap.matrix);}}function refreshUniformsLine(uniforms,material){uniforms.diffuse.value=material.color;uniforms.opacity.value=material.opacity;}function refreshUniformsDash(uniforms,material){uniforms.dashSize.value=material.dashSize;uniforms.totalSize.value=material.dashSize+material.gapSize;uniforms.scale.value=material.scale;}function refreshUniformsPoints(uniforms,material){uniforms.diffuse.value=material.color;uniforms.opacity.value=material.opacity;uniforms.size.value=material.size*_pixelRatio;uniforms.scale.value=_height*0.5;uniforms.map.value=material.map;if(material.map!==null){if(material.map.matrixAutoUpdate===true){var offset=material.map.offset;var repeat=material.map.repeat;var rotation=material.map.rotation;var center=material.map.center;material.map.matrix.setUvTransform(offset.x,offset.y,repeat.x,repeat.y,rotation,center.x,center.y);}uniforms.uvTransform.value.copy(material.map.matrix);}}function refreshUniformsFog(uniforms,fog){uniforms.fogColor.value=fog.color;if(fog.isFog){uniforms.fogNear.value=fog.near;uniforms.fogFar.value=fog.far;}else if(fog.isFogExp2){uniforms.fogDensity.value=fog.density;}}function refreshUniformsLambert(uniforms,material){if(material.emissiveMap){uniforms.emissiveMap.value=material.emissiveMap;}}function refreshUniformsPhong(uniforms,material){uniforms.specular.value=material.specular;uniforms.shininess.value=Math.max(material.shininess,1e-4);// to prevent pow( 0.0, 0.0 )
  if(material.emissiveMap){uniforms.emissiveMap.value=material.emissiveMap;}if(material.bumpMap){uniforms.bumpMap.value=material.bumpMap;uniforms.bumpScale.value=material.bumpScale;}if(material.normalMap){uniforms.normalMap.value=material.normalMap;uniforms.normalScale.value.copy(material.normalScale);}if(material.displacementMap){uniforms.displacementMap.value=material.displacementMap;uniforms.displacementScale.value=material.displacementScale;uniforms.displacementBias.value=material.displacementBias;}}function refreshUniformsToon(uniforms,material){refreshUniformsPhong(uniforms,material);if(material.gradientMap){uniforms.gradientMap.value=material.gradientMap;}}function refreshUniformsStandard(uniforms,material){uniforms.roughness.value=material.roughness;uniforms.metalness.value=material.metalness;if(material.roughnessMap){uniforms.roughnessMap.value=material.roughnessMap;}if(material.metalnessMap){uniforms.metalnessMap.value=material.metalnessMap;}if(material.emissiveMap){uniforms.emissiveMap.value=material.emissiveMap;}if(material.bumpMap){uniforms.bumpMap.value=material.bumpMap;uniforms.bumpScale.value=material.bumpScale;}if(material.normalMap){uniforms.normalMap.value=material.normalMap;uniforms.normalScale.value.copy(material.normalScale);}if(material.displacementMap){uniforms.displacementMap.value=material.displacementMap;uniforms.displacementScale.value=material.displacementScale;uniforms.displacementBias.value=material.displacementBias;}if(material.envMap){//uniforms.envMap.value = material.envMap; // part of uniforms common
  uniforms.envMapIntensity.value=material.envMapIntensity;}}function refreshUniformsPhysical(uniforms,material){uniforms.clearCoat.value=material.clearCoat;uniforms.clearCoatRoughness.value=material.clearCoatRoughness;refreshUniformsStandard(uniforms,material);}function refreshUniformsDepth(uniforms,material){if(material.displacementMap){uniforms.displacementMap.value=material.displacementMap;uniforms.displacementScale.value=material.displacementScale;uniforms.displacementBias.value=material.displacementBias;}}function refreshUniformsDistance(uniforms,material){if(material.displacementMap){uniforms.displacementMap.value=material.displacementMap;uniforms.displacementScale.value=material.displacementScale;uniforms.displacementBias.value=material.displacementBias;}uniforms.referencePosition.value.copy(material.referencePosition);uniforms.nearDistance.value=material.nearDistance;uniforms.farDistance.value=material.farDistance;}function refreshUniformsNormal(uniforms,material){if(material.bumpMap){uniforms.bumpMap.value=material.bumpMap;uniforms.bumpScale.value=material.bumpScale;}if(material.normalMap){uniforms.normalMap.value=material.normalMap;uniforms.normalScale.value.copy(material.normalScale);}if(material.displacementMap){uniforms.displacementMap.value=material.displacementMap;uniforms.displacementScale.value=material.displacementScale;uniforms.displacementBias.value=material.displacementBias;}}// If uniforms are marked as clean, they don't need to be loaded to the GPU.
  function markUniformsLightsNeedsUpdate(uniforms,value){uniforms.ambientLightColor.needsUpdate=value;uniforms.directionalLights.needsUpdate=value;uniforms.pointLights.needsUpdate=value;uniforms.spotLights.needsUpdate=value;uniforms.rectAreaLights.needsUpdate=value;uniforms.hemisphereLights.needsUpdate=value;}// GL state setting
  this.setFaceCulling=function(cullFace,frontFaceDirection){state.setCullFace(cullFace);state.setFlipSided(frontFaceDirection===FrontFaceDirectionCW);};// Textures
  function allocTextureUnit(){var textureUnit=_usedTextureUnits;if(textureUnit>=capabilities.maxTextures){console.warn('THREE.WebGLRenderer: Trying to use '+textureUnit+' texture units while this GPU supports only '+capabilities.maxTextures);}_usedTextureUnits+=1;return textureUnit;}this.allocTextureUnit=allocTextureUnit;// this.setTexture2D = setTexture2D;
  this.setTexture2D=function(){var warned=false;// backwards compatibility: peel texture.texture
  return function setTexture2D(texture,slot){if(texture&&texture.isWebGLRenderTarget){if(!warned){console.warn("THREE.WebGLRenderer.setTexture2D: don't use render targets as textures. Use their .texture property instead.");warned=true;}texture=texture.texture;}textures.setTexture2D(texture,slot);};}();this.setTexture=function(){var warned=false;return function setTexture(texture,slot){if(!warned){console.warn("THREE.WebGLRenderer: .setTexture is deprecated, use setTexture2D instead.");warned=true;}textures.setTexture2D(texture,slot);};}();this.setTextureCube=function(){var warned=false;return function setTextureCube(texture,slot){// backwards compatibility: peel texture.texture
  if(texture&&texture.isWebGLRenderTargetCube){if(!warned){console.warn("THREE.WebGLRenderer.setTextureCube: don't use cube render targets as textures. Use their .texture property instead.");warned=true;}texture=texture.texture;}// currently relying on the fact that WebGLRenderTargetCube.texture is a Texture and NOT a CubeTexture
  // TODO: unify these code paths
  if(texture&&texture.isCubeTexture||Array.isArray(texture.image)&&texture.image.length===6){// CompressedTexture can have Array in image :/
  // this function alone should take care of cube textures
  textures.setTextureCube(texture,slot);}else{// assumed: texture property of THREE.WebGLRenderTargetCube
  textures.setTextureCubeDynamic(texture,slot);}};}();this.getRenderTarget=function(){return _currentRenderTarget;};this.setRenderTarget=function(renderTarget){_currentRenderTarget=renderTarget;if(renderTarget&&properties.get(renderTarget).__webglFramebuffer===undefined){textures.setupRenderTarget(renderTarget);}var framebuffer=null;var isCube=false;if(renderTarget){var __webglFramebuffer=properties.get(renderTarget).__webglFramebuffer;if(renderTarget.isWebGLRenderTargetCube){framebuffer=__webglFramebuffer[renderTarget.activeCubeFace];isCube=true;}else{framebuffer=__webglFramebuffer;}_currentViewport.copy(renderTarget.viewport);_currentScissor.copy(renderTarget.scissor);_currentScissorTest=renderTarget.scissorTest;}else{_currentViewport.copy(_viewport).multiplyScalar(_pixelRatio);_currentScissor.copy(_scissor).multiplyScalar(_pixelRatio);_currentScissorTest=_scissorTest;}if(_currentFramebuffer!==framebuffer){_gl.bindFramebuffer(_gl.FRAMEBUFFER,framebuffer);_currentFramebuffer=framebuffer;}state.viewport(_currentViewport);state.scissor(_currentScissor);state.setScissorTest(_currentScissorTest);if(isCube){var textureProperties=properties.get(renderTarget.texture);_gl.framebufferTexture2D(_gl.FRAMEBUFFER,_gl.COLOR_ATTACHMENT0,_gl.TEXTURE_CUBE_MAP_POSITIVE_X+renderTarget.activeCubeFace,textureProperties.__webglTexture,renderTarget.activeMipMapLevel);}};this.readRenderTargetPixels=function(renderTarget,x,y,width,height,buffer){if(!(renderTarget&&renderTarget.isWebGLRenderTarget)){console.error('THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not THREE.WebGLRenderTarget.');return;}var framebuffer=properties.get(renderTarget).__webglFramebuffer;if(framebuffer){var restore=false;if(framebuffer!==_currentFramebuffer){_gl.bindFramebuffer(_gl.FRAMEBUFFER,framebuffer);restore=true;}try{var texture=renderTarget.texture;var textureFormat=texture.format;var textureType=texture.type;if(textureFormat!==RGBAFormat&&utils.convert(textureFormat)!==_gl.getParameter(_gl.IMPLEMENTATION_COLOR_READ_FORMAT)){console.error('THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in RGBA or implementation defined format.');return;}if(textureType!==UnsignedByteType&&utils.convert(textureType)!==_gl.getParameter(_gl.IMPLEMENTATION_COLOR_READ_TYPE)&&// IE11, Edge and Chrome Mac < 52 (#9513)
  !(textureType===FloatType&&(extensions.get('OES_texture_float')||extensions.get('WEBGL_color_buffer_float')))&&// Chrome Mac >= 52 and Firefox
  !(textureType===HalfFloatType&&extensions.get('EXT_color_buffer_half_float'))){console.error('THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in UnsignedByteType or implementation defined type.');return;}if(_gl.checkFramebufferStatus(_gl.FRAMEBUFFER)===_gl.FRAMEBUFFER_COMPLETE){// the following if statement ensures valid read requests (no out-of-bounds pixels, see #8604)
  if(x>=0&&x<=renderTarget.width-width&&y>=0&&y<=renderTarget.height-height){_gl.readPixels(x,y,width,height,utils.convert(textureFormat),utils.convert(textureType),buffer);}}else{console.error('THREE.WebGLRenderer.readRenderTargetPixels: readPixels from renderTarget failed. Framebuffer not complete.');}}finally{if(restore){_gl.bindFramebuffer(_gl.FRAMEBUFFER,_currentFramebuffer);}}}};}/**
   * @author zz85 / http://www.lab4games.net/zz85/blog
   * Defines a 2d shape plane using paths.
   **/// STEP 1 Create a path.
  // STEP 2 Turn path into shape.
  // STEP 3 ExtrudeGeometry takes in Shape/Shapes
  // STEP 3a - Extract points from each shape, turn to vertices
  // STEP 3b - Triangulate each shape, add faces.
  function Shape(points){Path.call(this,points);this.uuid=_Math$1.generateUUID();this.type='Shape';this.holes=[];}Shape.prototype=Object.assign(Object.create(Path.prototype),{constructor:Shape,getPointsHoles:function getPointsHoles(divisions){var this$1=this;var holesPts=[];for(var i=0,l=this.holes.length;i<l;i++){holesPts[i]=this$1.holes[i].getPoints(divisions);}return holesPts;},// get points of shape and holes (keypoints based on segments parameter)
  extractPoints:function extractPoints(divisions){return{shape:this.getPoints(divisions),holes:this.getPointsHoles(divisions)};},copy:function copy(source){var this$1=this;Path.prototype.copy.call(this,source);this.holes=[];for(var i=0,l=source.holes.length;i<l;i++){var hole=source.holes[i];this$1.holes.push(hole.clone());}return this;},toJSON:function toJSON(){var this$1=this;var data=Path.prototype.toJSON.call(this);data.uuid=this.uuid;data.holes=[];for(var i=0,l=this.holes.length;i<l;i++){var hole=this$1.holes[i];data.holes.push(hole.toJSON());}return data;},fromJSON:function fromJSON(json){var this$1=this;Path.prototype.fromJSON.call(this,json);this.uuid=json.uuid;this.holes=[];for(var i=0,l=json.holes.length;i<l;i++){var hole=json.holes[i];this$1.holes.push(new Path().fromJSON(hole));}return this;}});/**
   * Camera for rendering cube maps
   *	- renders scene into axis-aligned cube
   *
   * @author alteredq / http://alteredqualia.com/
   */function CubeCamera(near,far,cubeResolution){Object3D.call(this);this.type='CubeCamera';var fov=90,aspect=1;var cameraPX=new PerspectiveCamera(fov,aspect,near,far);cameraPX.up.set(0,-1,0);cameraPX.lookAt(new Vector3$1(1,0,0));this.add(cameraPX);var cameraNX=new PerspectiveCamera(fov,aspect,near,far);cameraNX.up.set(0,-1,0);cameraNX.lookAt(new Vector3$1(-1,0,0));this.add(cameraNX);var cameraPY=new PerspectiveCamera(fov,aspect,near,far);cameraPY.up.set(0,0,1);cameraPY.lookAt(new Vector3$1(0,1,0));this.add(cameraPY);var cameraNY=new PerspectiveCamera(fov,aspect,near,far);cameraNY.up.set(0,0,-1);cameraNY.lookAt(new Vector3$1(0,-1,0));this.add(cameraNY);var cameraPZ=new PerspectiveCamera(fov,aspect,near,far);cameraPZ.up.set(0,-1,0);cameraPZ.lookAt(new Vector3$1(0,0,1));this.add(cameraPZ);var cameraNZ=new PerspectiveCamera(fov,aspect,near,far);cameraNZ.up.set(0,-1,0);cameraNZ.lookAt(new Vector3$1(0,0,-1));this.add(cameraNZ);var options={format:RGBFormat,magFilter:LinearFilter,minFilter:LinearFilter};this.renderTarget=new WebGLRenderTargetCube(cubeResolution,cubeResolution,options);this.renderTarget.texture.name="CubeCamera";this.update=function(renderer,scene){if(this.parent===null){this.updateMatrixWorld();}var renderTarget=this.renderTarget;var generateMipmaps=renderTarget.texture.generateMipmaps;renderTarget.texture.generateMipmaps=false;renderTarget.activeCubeFace=0;renderer.render(scene,cameraPX,renderTarget);renderTarget.activeCubeFace=1;renderer.render(scene,cameraNX,renderTarget);renderTarget.activeCubeFace=2;renderer.render(scene,cameraPY,renderTarget);renderTarget.activeCubeFace=3;renderer.render(scene,cameraNY,renderTarget);renderTarget.activeCubeFace=4;renderer.render(scene,cameraPZ,renderTarget);renderTarget.texture.generateMipmaps=generateMipmaps;renderTarget.activeCubeFace=5;renderer.render(scene,cameraNZ,renderTarget);renderer.setRenderTarget(null);};this.clear=function(renderer,color,depth,stencil){var renderTarget=this.renderTarget;for(var i=0;i<6;i++){renderTarget.activeCubeFace=i;renderer.setRenderTarget(renderTarget);renderer.clear(color,depth,stencil);}renderer.setRenderTarget(null);};}CubeCamera.prototype=Object.create(Object3D.prototype);CubeCamera.prototype.constructor=CubeCamera;/**
   * @author mrdoob / http://mrdoob.com/
   */Curve.create=function(construct,getPoint){console.log('THREE.Curve.create() has been deprecated');construct.prototype=Object.create(Curve.prototype);construct.prototype.constructor=construct;construct.prototype.getPoint=getPoint;return construct;};//
  Object.assign(CurvePath.prototype,{createPointsGeometry:function createPointsGeometry(divisions){console.warn('THREE.CurvePath: .createPointsGeometry() has been removed. Use new THREE.Geometry().setFromPoints( points ) instead.');// generate geometry from path points (for Line or Points objects)
  var pts=this.getPoints(divisions);return this.createGeometry(pts);},createSpacedPointsGeometry:function createSpacedPointsGeometry(divisions){console.warn('THREE.CurvePath: .createSpacedPointsGeometry() has been removed. Use new THREE.Geometry().setFromPoints( points ) instead.');// generate geometry from equidistant sampling along the path
  var pts=this.getSpacedPoints(divisions);return this.createGeometry(pts);},createGeometry:function createGeometry(points){console.warn('THREE.CurvePath: .createGeometry() has been removed. Use new THREE.Geometry().setFromPoints( points ) instead.');var geometry=new Geometry();for(var i=0,l=points.length;i<l;i++){var point=points[i];geometry.vertices.push(new Vector3$1(point.x,point.y,point.z||0));}return geometry;}});//
  Object.assign(Path.prototype,{fromPoints:function fromPoints(points){console.warn('THREE.Path: .fromPoints() has been renamed to .setFromPoints().');this.setFromPoints(points);}});//
  function Spline(points){console.warn('THREE.Spline has been removed. Use THREE.CatmullRomCurve3 instead.');CatmullRomCurve3$1.call(this,points);this.type='catmullrom';}Spline.prototype=Object.create(CatmullRomCurve3$1.prototype);Object.assign(Spline.prototype,{initFromArray:function initFromArray()/* a */{console.error('THREE.Spline: .initFromArray() has been removed.');},getControlPointsArray:function getControlPointsArray()/* optionalTarget */{console.error('THREE.Spline: .getControlPointsArray() has been removed.');},reparametrizeByArcLength:function reparametrizeByArcLength()/* samplingCoef */{console.error('THREE.Spline: .reparametrizeByArcLength() has been removed.');}});//
  function AxisHelper(size){console.warn('THREE.AxisHelper has been renamed to THREE.AxesHelper.');return new AxesHelper(size);}GridHelper.prototype.setColors=function(){console.error('THREE.GridHelper: setColors() has been deprecated, pass them in the constructor instead.');};SkeletonHelper.prototype.update=function(){console.error('THREE.SkeletonHelper: update() no longer needs to be called.');};Object.assign(Loader$1.prototype,{extractUrlBase:function extractUrlBase(url){console.warn('THREE.Loader: .extractUrlBase() has been deprecated. Use THREE.LoaderUtils.extractUrlBase() instead.');return LoaderUtils.extractUrlBase(url);}});Object.assign(Box2.prototype,{center:function center(optionalTarget){console.warn('THREE.Box2: .center() has been renamed to .getCenter().');return this.getCenter(optionalTarget);},empty:function empty(){console.warn('THREE.Box2: .empty() has been renamed to .isEmpty().');return this.isEmpty();},isIntersectionBox:function isIntersectionBox(box){console.warn('THREE.Box2: .isIntersectionBox() has been renamed to .intersectsBox().');return this.intersectsBox(box);},size:function size(optionalTarget){console.warn('THREE.Box2: .size() has been renamed to .getSize().');return this.getSize(optionalTarget);}});Object.assign(Box3.prototype,{center:function center(optionalTarget){console.warn('THREE.Box3: .center() has been renamed to .getCenter().');return this.getCenter(optionalTarget);},empty:function empty(){console.warn('THREE.Box3: .empty() has been renamed to .isEmpty().');return this.isEmpty();},isIntersectionBox:function isIntersectionBox(box){console.warn('THREE.Box3: .isIntersectionBox() has been renamed to .intersectsBox().');return this.intersectsBox(box);},isIntersectionSphere:function isIntersectionSphere(sphere){console.warn('THREE.Box3: .isIntersectionSphere() has been renamed to .intersectsSphere().');return this.intersectsSphere(sphere);},size:function size(optionalTarget){console.warn('THREE.Box3: .size() has been renamed to .getSize().');return this.getSize(optionalTarget);}});Line3.prototype.center=function(optionalTarget){console.warn('THREE.Line3: .center() has been renamed to .getCenter().');return this.getCenter(optionalTarget);};Object.assign(_Math$1,{random16:function random16(){console.warn('THREE.Math: .random16() has been deprecated. Use Math.random() instead.');return Math.random();},nearestPowerOfTwo:function nearestPowerOfTwo(value){console.warn('THREE.Math: .nearestPowerOfTwo() has been renamed to .floorPowerOfTwo().');return _Math$1.floorPowerOfTwo(value);},nextPowerOfTwo:function nextPowerOfTwo(value){console.warn('THREE.Math: .nextPowerOfTwo() has been renamed to .ceilPowerOfTwo().');return _Math$1.ceilPowerOfTwo(value);}});Object.assign(Matrix3$1.prototype,{flattenToArrayOffset:function flattenToArrayOffset(array,offset){console.warn("THREE.Matrix3: .flattenToArrayOffset() has been deprecated. Use .toArray() instead.");return this.toArray(array,offset);},multiplyVector3:function multiplyVector3(vector){console.warn('THREE.Matrix3: .multiplyVector3() has been removed. Use vector.applyMatrix3( matrix ) instead.');return vector.applyMatrix3(this);},multiplyVector3Array:function multiplyVector3Array()/* a */{console.error('THREE.Matrix3: .multiplyVector3Array() has been removed.');},applyToBuffer:function applyToBuffer(buffer/* offset, length */){console.warn('THREE.Matrix3: .applyToBuffer() has been removed. Use matrix.applyToBufferAttribute( attribute ) instead.');return this.applyToBufferAttribute(buffer);},applyToVector3Array:function applyToVector3Array()/* array, offset, length */{console.error('THREE.Matrix3: .applyToVector3Array() has been removed.');}});Object.assign(Matrix4.prototype,{extractPosition:function extractPosition(m){console.warn('THREE.Matrix4: .extractPosition() has been renamed to .copyPosition().');return this.copyPosition(m);},flattenToArrayOffset:function flattenToArrayOffset(array,offset){console.warn("THREE.Matrix4: .flattenToArrayOffset() has been deprecated. Use .toArray() instead.");return this.toArray(array,offset);},getPosition:function(){var v1;return function getPosition(){if(v1===undefined){v1=new Vector3$1();}console.warn('THREE.Matrix4: .getPosition() has been removed. Use Vector3.setFromMatrixPosition( matrix ) instead.');return v1.setFromMatrixColumn(this,3);};}(),setRotationFromQuaternion:function setRotationFromQuaternion(q){console.warn('THREE.Matrix4: .setRotationFromQuaternion() has been renamed to .makeRotationFromQuaternion().');return this.makeRotationFromQuaternion(q);},multiplyToArray:function multiplyToArray(){console.warn('THREE.Matrix4: .multiplyToArray() has been removed.');},multiplyVector3:function multiplyVector3(vector){console.warn('THREE.Matrix4: .multiplyVector3() has been removed. Use vector.applyMatrix4( matrix ) instead.');return vector.applyMatrix4(this);},multiplyVector4:function multiplyVector4(vector){console.warn('THREE.Matrix4: .multiplyVector4() has been removed. Use vector.applyMatrix4( matrix ) instead.');return vector.applyMatrix4(this);},multiplyVector3Array:function multiplyVector3Array()/* a */{console.error('THREE.Matrix4: .multiplyVector3Array() has been removed.');},rotateAxis:function rotateAxis(v){console.warn('THREE.Matrix4: .rotateAxis() has been removed. Use Vector3.transformDirection( matrix ) instead.');v.transformDirection(this);},crossVector:function crossVector(vector){console.warn('THREE.Matrix4: .crossVector() has been removed. Use vector.applyMatrix4( matrix ) instead.');return vector.applyMatrix4(this);},translate:function translate(){console.error('THREE.Matrix4: .translate() has been removed.');},rotateX:function rotateX(){console.error('THREE.Matrix4: .rotateX() has been removed.');},rotateY:function rotateY(){console.error('THREE.Matrix4: .rotateY() has been removed.');},rotateZ:function rotateZ(){console.error('THREE.Matrix4: .rotateZ() has been removed.');},rotateByAxis:function rotateByAxis(){console.error('THREE.Matrix4: .rotateByAxis() has been removed.');},applyToBuffer:function applyToBuffer(buffer/* offset, length */){console.warn('THREE.Matrix4: .applyToBuffer() has been removed. Use matrix.applyToBufferAttribute( attribute ) instead.');return this.applyToBufferAttribute(buffer);},applyToVector3Array:function applyToVector3Array()/* array, offset, length */{console.error('THREE.Matrix4: .applyToVector3Array() has been removed.');},makeFrustum:function makeFrustum(left,right,bottom,top,near,far){console.warn('THREE.Matrix4: .makeFrustum() has been removed. Use .makePerspective( left, right, top, bottom, near, far ) instead.');return this.makePerspective(left,right,top,bottom,near,far);}});Plane.prototype.isIntersectionLine=function(line){console.warn('THREE.Plane: .isIntersectionLine() has been renamed to .intersectsLine().');return this.intersectsLine(line);};Quaternion.prototype.multiplyVector3=function(vector){console.warn('THREE.Quaternion: .multiplyVector3() has been removed. Use is now vector.applyQuaternion( quaternion ) instead.');return vector.applyQuaternion(this);};Object.assign(Ray.prototype,{isIntersectionBox:function isIntersectionBox(box){console.warn('THREE.Ray: .isIntersectionBox() has been renamed to .intersectsBox().');return this.intersectsBox(box);},isIntersectionPlane:function isIntersectionPlane(plane){console.warn('THREE.Ray: .isIntersectionPlane() has been renamed to .intersectsPlane().');return this.intersectsPlane(plane);},isIntersectionSphere:function isIntersectionSphere(sphere){console.warn('THREE.Ray: .isIntersectionSphere() has been renamed to .intersectsSphere().');return this.intersectsSphere(sphere);}});Object.assign(Shape.prototype,{extractAllPoints:function extractAllPoints(divisions){console.warn('THREE.Shape: .extractAllPoints() has been removed. Use .extractPoints() instead.');return this.extractPoints(divisions);},extrude:function extrude(options){console.warn('THREE.Shape: .extrude() has been removed. Use ExtrudeGeometry() instead.');return new ExtrudeGeometry(this,options);},makeGeometry:function makeGeometry(options){console.warn('THREE.Shape: .makeGeometry() has been removed. Use ShapeGeometry() instead.');return new ShapeGeometry(this,options);}});Object.assign(Vector2$1.prototype,{fromAttribute:function fromAttribute(attribute,index,offset){console.warn('THREE.Vector2: .fromAttribute() has been renamed to .fromBufferAttribute().');return this.fromBufferAttribute(attribute,index,offset);},distanceToManhattan:function distanceToManhattan(v){console.warn('THREE.Vector2: .distanceToManhattan() has been renamed to .manhattanDistanceTo().');return this.manhattanDistanceTo(v);},lengthManhattan:function lengthManhattan(){console.warn('THREE.Vector2: .lengthManhattan() has been renamed to .manhattanLength().');return this.manhattanLength();}});Object.assign(Vector3$1.prototype,{setEulerFromRotationMatrix:function setEulerFromRotationMatrix(){console.error('THREE.Vector3: .setEulerFromRotationMatrix() has been removed. Use Euler.setFromRotationMatrix() instead.');},setEulerFromQuaternion:function setEulerFromQuaternion(){console.error('THREE.Vector3: .setEulerFromQuaternion() has been removed. Use Euler.setFromQuaternion() instead.');},getPositionFromMatrix:function getPositionFromMatrix(m){console.warn('THREE.Vector3: .getPositionFromMatrix() has been renamed to .setFromMatrixPosition().');return this.setFromMatrixPosition(m);},getScaleFromMatrix:function getScaleFromMatrix(m){console.warn('THREE.Vector3: .getScaleFromMatrix() has been renamed to .setFromMatrixScale().');return this.setFromMatrixScale(m);},getColumnFromMatrix:function getColumnFromMatrix(index,matrix){console.warn('THREE.Vector3: .getColumnFromMatrix() has been renamed to .setFromMatrixColumn().');return this.setFromMatrixColumn(matrix,index);},applyProjection:function applyProjection(m){console.warn('THREE.Vector3: .applyProjection() has been removed. Use .applyMatrix4( m ) instead.');return this.applyMatrix4(m);},fromAttribute:function fromAttribute(attribute,index,offset){console.warn('THREE.Vector3: .fromAttribute() has been renamed to .fromBufferAttribute().');return this.fromBufferAttribute(attribute,index,offset);},distanceToManhattan:function distanceToManhattan(v){console.warn('THREE.Vector3: .distanceToManhattan() has been renamed to .manhattanDistanceTo().');return this.manhattanDistanceTo(v);},lengthManhattan:function lengthManhattan(){console.warn('THREE.Vector3: .lengthManhattan() has been renamed to .manhattanLength().');return this.manhattanLength();}});Object.assign(Vector4$1.prototype,{fromAttribute:function fromAttribute(attribute,index,offset){console.warn('THREE.Vector4: .fromAttribute() has been renamed to .fromBufferAttribute().');return this.fromBufferAttribute(attribute,index,offset);},lengthManhattan:function lengthManhattan(){console.warn('THREE.Vector4: .lengthManhattan() has been renamed to .manhattanLength().');return this.manhattanLength();}});//
  Geometry.prototype.computeTangents=function(){console.warn('THREE.Geometry: .computeTangents() has been removed.');};Object.assign(Object3D.prototype,{getChildByName:function getChildByName(name){console.warn('THREE.Object3D: .getChildByName() has been renamed to .getObjectByName().');return this.getObjectByName(name);},renderDepth:function renderDepth(){console.warn('THREE.Object3D: .renderDepth has been removed. Use .renderOrder, instead.');},translate:function translate(distance,axis){console.warn('THREE.Object3D: .translate() has been removed. Use .translateOnAxis( axis, distance ) instead.');return this.translateOnAxis(axis,distance);}});Object.defineProperties(Object3D.prototype,{eulerOrder:{get:function get$$1(){console.warn('THREE.Object3D: .eulerOrder is now .rotation.order.');return this.rotation.order;},set:function set$$1(value){console.warn('THREE.Object3D: .eulerOrder is now .rotation.order.');this.rotation.order=value;}},useQuaternion:{get:function get$$1(){console.warn('THREE.Object3D: .useQuaternion has been removed. The library now uses quaternions by default.');},set:function set$$1(){console.warn('THREE.Object3D: .useQuaternion has been removed. The library now uses quaternions by default.');}}});Object.defineProperties(LOD.prototype,{objects:{get:function get$$1(){console.warn('THREE.LOD: .objects has been renamed to .levels.');return this.levels;}}});Object.defineProperty(Skeleton$1.prototype,'useVertexTexture',{get:function get$$1(){console.warn('THREE.Skeleton: useVertexTexture has been removed.');},set:function set$$1(){console.warn('THREE.Skeleton: useVertexTexture has been removed.');}});Object.defineProperty(Curve.prototype,'__arcLengthDivisions',{get:function get$$1(){console.warn('THREE.Curve: .__arcLengthDivisions is now .arcLengthDivisions.');return this.arcLengthDivisions;},set:function set$$1(value){console.warn('THREE.Curve: .__arcLengthDivisions is now .arcLengthDivisions.');this.arcLengthDivisions=value;}});//
  PerspectiveCamera.prototype.setLens=function(focalLength,filmGauge){console.warn("THREE.PerspectiveCamera.setLens is deprecated. "+"Use .setFocalLength and .filmGauge for a photographic setup.");if(filmGauge!==undefined){this.filmGauge=filmGauge;}this.setFocalLength(focalLength);};//
  Object.defineProperties(Light.prototype,{onlyShadow:{set:function set$$1(){console.warn('THREE.Light: .onlyShadow has been removed.');}},shadowCameraFov:{set:function set$$1(value){console.warn('THREE.Light: .shadowCameraFov is now .shadow.camera.fov.');this.shadow.camera.fov=value;}},shadowCameraLeft:{set:function set$$1(value){console.warn('THREE.Light: .shadowCameraLeft is now .shadow.camera.left.');this.shadow.camera.left=value;}},shadowCameraRight:{set:function set$$1(value){console.warn('THREE.Light: .shadowCameraRight is now .shadow.camera.right.');this.shadow.camera.right=value;}},shadowCameraTop:{set:function set$$1(value){console.warn('THREE.Light: .shadowCameraTop is now .shadow.camera.top.');this.shadow.camera.top=value;}},shadowCameraBottom:{set:function set$$1(value){console.warn('THREE.Light: .shadowCameraBottom is now .shadow.camera.bottom.');this.shadow.camera.bottom=value;}},shadowCameraNear:{set:function set$$1(value){console.warn('THREE.Light: .shadowCameraNear is now .shadow.camera.near.');this.shadow.camera.near=value;}},shadowCameraFar:{set:function set$$1(value){console.warn('THREE.Light: .shadowCameraFar is now .shadow.camera.far.');this.shadow.camera.far=value;}},shadowCameraVisible:{set:function set$$1(){console.warn('THREE.Light: .shadowCameraVisible has been removed. Use new THREE.CameraHelper( light.shadow.camera ) instead.');}},shadowBias:{set:function set$$1(value){console.warn('THREE.Light: .shadowBias is now .shadow.bias.');this.shadow.bias=value;}},shadowDarkness:{set:function set$$1(){console.warn('THREE.Light: .shadowDarkness has been removed.');}},shadowMapWidth:{set:function set$$1(value){console.warn('THREE.Light: .shadowMapWidth is now .shadow.mapSize.width.');this.shadow.mapSize.width=value;}},shadowMapHeight:{set:function set$$1(value){console.warn('THREE.Light: .shadowMapHeight is now .shadow.mapSize.height.');this.shadow.mapSize.height=value;}}});//
  Object.defineProperties(BufferAttribute.prototype,{length:{get:function get$$1(){console.warn('THREE.BufferAttribute: .length has been deprecated. Use .count instead.');return this.array.length;}}});Object.assign(BufferGeometry.prototype,{addIndex:function addIndex(index){console.warn('THREE.BufferGeometry: .addIndex() has been renamed to .setIndex().');this.setIndex(index);},addDrawCall:function addDrawCall(start,count,indexOffset){if(indexOffset!==undefined){console.warn('THREE.BufferGeometry: .addDrawCall() no longer supports indexOffset.');}console.warn('THREE.BufferGeometry: .addDrawCall() is now .addGroup().');this.addGroup(start,count);},clearDrawCalls:function clearDrawCalls(){console.warn('THREE.BufferGeometry: .clearDrawCalls() is now .clearGroups().');this.clearGroups();},computeTangents:function computeTangents(){console.warn('THREE.BufferGeometry: .computeTangents() has been removed.');},computeOffsets:function computeOffsets(){console.warn('THREE.BufferGeometry: .computeOffsets() has been removed.');}});Object.defineProperties(BufferGeometry.prototype,{drawcalls:{get:function get$$1(){console.error('THREE.BufferGeometry: .drawcalls has been renamed to .groups.');return this.groups;}},offsets:{get:function get$$1(){console.warn('THREE.BufferGeometry: .offsets has been renamed to .groups.');return this.groups;}}});//
  Object.defineProperties(Uniform.prototype,{dynamic:{set:function set$$1(){console.warn('THREE.Uniform: .dynamic has been removed. Use object.onBeforeRender() instead.');}},onUpdate:{value:function value(){console.warn('THREE.Uniform: .onUpdate() has been removed. Use object.onBeforeRender() instead.');return this;}}});//
  Object.defineProperties(Material.prototype,{wrapAround:{get:function get$$1(){console.warn('THREE.Material: .wrapAround has been removed.');},set:function set$$1(){console.warn('THREE.Material: .wrapAround has been removed.');}},wrapRGB:{get:function get$$1(){console.warn('THREE.Material: .wrapRGB has been removed.');return new Color$1();}},shading:{get:function get$$1(){console.error('THREE.'+this.type+': .shading has been removed. Use the boolean .flatShading instead.');},set:function set$$1(value){console.warn('THREE.'+this.type+': .shading has been removed. Use the boolean .flatShading instead.');this.flatShading=value===FlatShading;}}});Object.defineProperties(MeshPhongMaterial.prototype,{metal:{get:function get$$1(){console.warn('THREE.MeshPhongMaterial: .metal has been removed. Use THREE.MeshStandardMaterial instead.');return false;},set:function set$$1(){console.warn('THREE.MeshPhongMaterial: .metal has been removed. Use THREE.MeshStandardMaterial instead');}}});Object.defineProperties(ShaderMaterial.prototype,{derivatives:{get:function get$$1(){console.warn('THREE.ShaderMaterial: .derivatives has been moved to .extensions.derivatives.');return this.extensions.derivatives;},set:function set$$1(value){console.warn('THREE. ShaderMaterial: .derivatives has been moved to .extensions.derivatives.');this.extensions.derivatives=value;}}});//
  Object.assign(WebGLRenderer.prototype,{getCurrentRenderTarget:function getCurrentRenderTarget(){console.warn('THREE.WebGLRenderer: .getCurrentRenderTarget() is now .getRenderTarget().');return this.getRenderTarget();},getMaxAnisotropy:function getMaxAnisotropy(){console.warn('THREE.WebGLRenderer: .getMaxAnisotropy() is now .capabilities.getMaxAnisotropy().');return this.capabilities.getMaxAnisotropy();},getPrecision:function getPrecision(){console.warn('THREE.WebGLRenderer: .getPrecision() is now .capabilities.precision.');return this.capabilities.precision;},resetGLState:function resetGLState(){console.warn('THREE.WebGLRenderer: .resetGLState() is now .state.reset().');return this.state.reset();},supportsFloatTextures:function supportsFloatTextures(){console.warn('THREE.WebGLRenderer: .supportsFloatTextures() is now .extensions.get( \'OES_texture_float\' ).');return this.extensions.get('OES_texture_float');},supportsHalfFloatTextures:function supportsHalfFloatTextures(){console.warn('THREE.WebGLRenderer: .supportsHalfFloatTextures() is now .extensions.get( \'OES_texture_half_float\' ).');return this.extensions.get('OES_texture_half_float');},supportsStandardDerivatives:function supportsStandardDerivatives(){console.warn('THREE.WebGLRenderer: .supportsStandardDerivatives() is now .extensions.get( \'OES_standard_derivatives\' ).');return this.extensions.get('OES_standard_derivatives');},supportsCompressedTextureS3TC:function supportsCompressedTextureS3TC(){console.warn('THREE.WebGLRenderer: .supportsCompressedTextureS3TC() is now .extensions.get( \'WEBGL_compressed_texture_s3tc\' ).');return this.extensions.get('WEBGL_compressed_texture_s3tc');},supportsCompressedTexturePVRTC:function supportsCompressedTexturePVRTC(){console.warn('THREE.WebGLRenderer: .supportsCompressedTexturePVRTC() is now .extensions.get( \'WEBGL_compressed_texture_pvrtc\' ).');return this.extensions.get('WEBGL_compressed_texture_pvrtc');},supportsBlendMinMax:function supportsBlendMinMax(){console.warn('THREE.WebGLRenderer: .supportsBlendMinMax() is now .extensions.get( \'EXT_blend_minmax\' ).');return this.extensions.get('EXT_blend_minmax');},supportsVertexTextures:function supportsVertexTextures(){console.warn('THREE.WebGLRenderer: .supportsVertexTextures() is now .capabilities.vertexTextures.');return this.capabilities.vertexTextures;},supportsInstancedArrays:function supportsInstancedArrays(){console.warn('THREE.WebGLRenderer: .supportsInstancedArrays() is now .extensions.get( \'ANGLE_instanced_arrays\' ).');return this.extensions.get('ANGLE_instanced_arrays');},enableScissorTest:function enableScissorTest(boolean){console.warn('THREE.WebGLRenderer: .enableScissorTest() is now .setScissorTest().');this.setScissorTest(boolean);},initMaterial:function initMaterial(){console.warn('THREE.WebGLRenderer: .initMaterial() has been removed.');},addPrePlugin:function addPrePlugin(){console.warn('THREE.WebGLRenderer: .addPrePlugin() has been removed.');},addPostPlugin:function addPostPlugin(){console.warn('THREE.WebGLRenderer: .addPostPlugin() has been removed.');},updateShadowMap:function updateShadowMap(){console.warn('THREE.WebGLRenderer: .updateShadowMap() has been removed.');}});Object.defineProperties(WebGLRenderer.prototype,{shadowMapEnabled:{get:function get$$1(){return this.shadowMap.enabled;},set:function set$$1(value){console.warn('THREE.WebGLRenderer: .shadowMapEnabled is now .shadowMap.enabled.');this.shadowMap.enabled=value;}},shadowMapType:{get:function get$$1(){return this.shadowMap.type;},set:function set$$1(value){console.warn('THREE.WebGLRenderer: .shadowMapType is now .shadowMap.type.');this.shadowMap.type=value;}},shadowMapCullFace:{get:function get$$1(){return this.shadowMap.cullFace;},set:function set$$1(value){console.warn('THREE.WebGLRenderer: .shadowMapCullFace is now .shadowMap.cullFace.');this.shadowMap.cullFace=value;}}});Object.defineProperties(WebGLShadowMap.prototype,{cullFace:{get:function get$$1(){return this.renderReverseSided?CullFaceFront:CullFaceBack;},set:function set$$1(cullFace){var value=cullFace!==CullFaceBack;console.warn("WebGLRenderer: .shadowMap.cullFace is deprecated. Set .shadowMap.renderReverseSided to "+value+".");this.renderReverseSided=value;}}});//
  Object.defineProperties(WebGLRenderTarget.prototype,{wrapS:{get:function get$$1(){console.warn('THREE.WebGLRenderTarget: .wrapS is now .texture.wrapS.');return this.texture.wrapS;},set:function set$$1(value){console.warn('THREE.WebGLRenderTarget: .wrapS is now .texture.wrapS.');this.texture.wrapS=value;}},wrapT:{get:function get$$1(){console.warn('THREE.WebGLRenderTarget: .wrapT is now .texture.wrapT.');return this.texture.wrapT;},set:function set$$1(value){console.warn('THREE.WebGLRenderTarget: .wrapT is now .texture.wrapT.');this.texture.wrapT=value;}},magFilter:{get:function get$$1(){console.warn('THREE.WebGLRenderTarget: .magFilter is now .texture.magFilter.');return this.texture.magFilter;},set:function set$$1(value){console.warn('THREE.WebGLRenderTarget: .magFilter is now .texture.magFilter.');this.texture.magFilter=value;}},minFilter:{get:function get$$1(){console.warn('THREE.WebGLRenderTarget: .minFilter is now .texture.minFilter.');return this.texture.minFilter;},set:function set$$1(value){console.warn('THREE.WebGLRenderTarget: .minFilter is now .texture.minFilter.');this.texture.minFilter=value;}},anisotropy:{get:function get$$1(){console.warn('THREE.WebGLRenderTarget: .anisotropy is now .texture.anisotropy.');return this.texture.anisotropy;},set:function set$$1(value){console.warn('THREE.WebGLRenderTarget: .anisotropy is now .texture.anisotropy.');this.texture.anisotropy=value;}},offset:{get:function get$$1(){console.warn('THREE.WebGLRenderTarget: .offset is now .texture.offset.');return this.texture.offset;},set:function set$$1(value){console.warn('THREE.WebGLRenderTarget: .offset is now .texture.offset.');this.texture.offset=value;}},repeat:{get:function get$$1(){console.warn('THREE.WebGLRenderTarget: .repeat is now .texture.repeat.');return this.texture.repeat;},set:function set$$1(value){console.warn('THREE.WebGLRenderTarget: .repeat is now .texture.repeat.');this.texture.repeat=value;}},format:{get:function get$$1(){console.warn('THREE.WebGLRenderTarget: .format is now .texture.format.');return this.texture.format;},set:function set$$1(value){console.warn('THREE.WebGLRenderTarget: .format is now .texture.format.');this.texture.format=value;}},type:{get:function get$$1(){console.warn('THREE.WebGLRenderTarget: .type is now .texture.type.');return this.texture.type;},set:function set$$1(value){console.warn('THREE.WebGLRenderTarget: .type is now .texture.type.');this.texture.type=value;}},generateMipmaps:{get:function get$$1(){console.warn('THREE.WebGLRenderTarget: .generateMipmaps is now .texture.generateMipmaps.');return this.texture.generateMipmaps;},set:function set$$1(value){console.warn('THREE.WebGLRenderTarget: .generateMipmaps is now .texture.generateMipmaps.');this.texture.generateMipmaps=value;}}});//
  Object.assign(WebVRManager.prototype,{getStandingMatrix:function getStandingMatrix(){console.warn('THREE.WebVRManager: .getStandingMatrix() has been removed.');}});Object.defineProperties(WebVRManager.prototype,{standing:{set:function set$$1()/* value */{console.warn('THREE.WebVRManager: .standing has been removed.');}}});//
  Audio.prototype.load=function(file){console.warn('THREE.Audio: .load has been deprecated. Use THREE.AudioLoader instead.');var scope=this;var audioLoader=new AudioLoader();audioLoader.load(file,function(buffer){scope.setBuffer(buffer);});return this;};AudioAnalyser.prototype.getData=function(){console.warn('THREE.AudioAnalyser: .getData() is now .getFrequencyData().');return this.getFrequencyData();};//
  CubeCamera.prototype.updateCubeMap=function(renderer,scene){console.warn('THREE.CubeCamera: .updateCubeMap() is now .update().');return this.update(renderer,scene);};//
  var SpriteCanvasMaterial=function SpriteCanvasMaterial(parameters){Material.call(this);this.type='SpriteCanvasMaterial';this.color=new Color$1(0xffffff);this.program=function(){};this.setValues(parameters);};SpriteCanvasMaterial.prototype=Object.create(Material.prototype);SpriteCanvasMaterial.prototype.constructor=SpriteCanvasMaterial;SpriteCanvasMaterial.prototype.isSpriteCanvasMaterial=true;SpriteCanvasMaterial.prototype.clone=function(){var material=new SpriteCanvasMaterial();material.copy(this);material.color.copy(this.color);material.program=this.program;return material;};/**
   * @author mrdoob / http://mrdoob.com/
   */var CSS2DObject=function CSS2DObject(element){Object3D.call(this);this.element=element;this.element.style.position='absolute';this.addEventListener('removed',function(event){if(this.element.parentNode!==null){this.element.parentNode.removeChild(this.element);}});};CSS2DObject.prototype=Object.create(Object3D.prototype);CSS2DObject.prototype.constructor=CSS2DObject;//
  var CSS3DObject=function CSS3DObject(element){Object3D.call(this);this.element=element;this.element.style.position='absolute';this.addEventListener('removed',function(){if(this.element.parentNode!==null){this.element.parentNode.removeChild(this.element);}});};CSS3DObject.prototype=Object.create(Object3D.prototype);CSS3DObject.prototype.constructor=CSS3DObject;var CSS3DSprite=function CSS3DSprite(element){CSS3DObject.call(this,element);};CSS3DSprite.prototype=Object.create(CSS3DObject.prototype);CSS3DSprite.prototype.constructor=CSS3DSprite;//
  var RaytracingRenderer=function RaytracingRenderer(parameters){console.log('RaytracingRenderer',REVISION);parameters=parameters||{};var scope=this;var pool=[];var renderering=false;var canvas=document.createElement('canvas');var context=canvas.getContext('2d',{alpha:parameters.alpha===true});var canvasWidth,canvasHeight;var clearColor=new Color$1(0x000000);this.domElement=canvas;this.autoClear=true;var workers=parameters.workers;var blockSize=parameters.blockSize||64;this.randomize=parameters.randomize;var toRender=[],workerId=0,sceneId=0;console.log('%cSpinning off '+workers+' Workers ','font-size: 20px; background: black; color: white; font-family: monospace;');this.setWorkers=function(w){workers=w||navigator.hardwareConcurrency||4;while(pool.length<workers){var worker=new Worker(parameters.workerPath);worker.id=workerId++;worker.onmessage=function(e){var data=e.data;if(!data){return;}if(data.blockSize&&sceneId==data.sceneId){// we match sceneId here to be sure
  var imagedata=new ImageData(new Uint8ClampedArray(data.data),data.blockSize,data.blockSize);context.putImageData(imagedata,data.blockX,data.blockY);// completed
  console.log('Worker '+this.id,data.time/1000,(Date.now()-reallyThen)/1000+' s');if(pool.length>workers){pool.splice(pool.indexOf(this),1);return this.terminate();}renderNext(this);}};worker.color=new Color$1().setHSL(Math.random(),0.8,0.8).getHexString();pool.push(worker);if(renderering){updateSettings(worker);worker.postMessage({scene:sceneJSON,camera:cameraJSON,annex:materials,sceneId:sceneId});renderNext(worker);}}if(!renderering){while(pool.length>workers){pool.pop().terminate();}}};this.setWorkers(workers);this.setClearColor=function(color,alpha){clearColor.set(color);};this.setPixelRatio=function(){};this.setSize=function(width,height){canvas.width=width;canvas.height=height;canvasWidth=canvas.width;canvasHeight=canvas.height;context.fillStyle='white';pool.forEach(updateSettings);};this.setSize(canvas.width,canvas.height);this.clear=function(){};//
  var totalBlocks,xblocks,yblocks;function updateSettings(worker){worker.postMessage({init:[canvasWidth,canvasHeight],worker:worker.id,// workers: pool.length,
  blockSize:blockSize});}function renderNext(worker){if(!toRender.length){renderering=false;return scope.dispatchEvent({type:"complete"});}var current=toRender.pop();var blockX=current%xblocks*blockSize;var blockY=(current/xblocks|0)*blockSize;worker.postMessage({render:true,x:blockX,y:blockY,sceneId:sceneId});context.fillStyle='#'+worker.color;context.fillRect(blockX,blockY,blockSize,blockSize);}var materials={};var sceneJSON,cameraJSON,reallyThen;// additional properties that were not serialize automatically
  var _annex={mirror:1,reflectivity:1,refractionRatio:1,glass:1};function serializeObject(o){var mat=o.material;if(!mat||mat.uuid in materials){return;}var props={};for(var m in _annex){if(mat[m]!==undefined){props[m]=mat[m];}}materials[mat.uuid]=props;}this.render=function(scene,camera){renderering=true;// update scene graph
  if(scene.autoUpdate===true){scene.updateMatrixWorld();}// update camera matrices
  if(camera.parent===null){camera.updateMatrixWorld();}sceneJSON=scene.toJSON();cameraJSON=camera.toJSON();++sceneId;scene.traverse(serializeObject);pool.forEach(function(worker){worker.postMessage({scene:sceneJSON,camera:cameraJSON,annex:materials,sceneId:sceneId});});context.clearRect(0,0,canvasWidth,canvasHeight);reallyThen=Date.now();xblocks=Math.ceil(canvasWidth/blockSize);yblocks=Math.ceil(canvasHeight/blockSize);totalBlocks=xblocks*yblocks;toRender=[];for(var i=0;i<totalBlocks;i++){toRender.push(i);}// Randomize painting :)
  if(scope.randomize){for(var i=0;i<totalBlocks;i++){var swap=Math.random()*totalBlocks|0;var tmp=toRender[swap];toRender[swap]=toRender[i];toRender[i]=tmp;}}pool.forEach(renderNext);};};Object.assign(RaytracingRenderer.prototype,EventDispatcher.prototype);/**
   * @author mrdoob / http://mrdoob.com/
   * @author ryg / http://farbrausch.de/~fg
   * @author mraleph / http://mrale.ph/
   * @author daoshengmu / http://dsmu.me/
   */var SVGObject=function SVGObject(node){Object3D.call(this);this.node=node;};SVGObject.prototype=Object.create(Object3D.prototype);SVGObject.prototype.constructor=SVGObject;var FXAAShader={uniforms:{"tDiffuse":{value:null},"resolution":{value:new Vector2$1(1/1024,1/512)}},vertexShader:["varying vec2 vUv;","void main() {","vUv = uv;","gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),fragmentShader:["precision highp float;","","uniform sampler2D tDiffuse;","","uniform vec2 resolution;","","varying vec2 vUv;","","// FXAA 3.11 implementation by NVIDIA, ported to WebGL by Agost Biro (biro@archilogic.com)","","//----------------------------------------------------------------------------------","// File:        es3-kepler\FXAA\assets\shaders/FXAA_DefaultES.frag","// SDK Version: v3.00","// Email:       gameworks@nvidia.com","// Site:        http://developer.nvidia.com/","//","// Copyright (c) 2014-2015, NVIDIA CORPORATION. All rights reserved.","//","// Redistribution and use in source and binary forms, with or without","// modification, are permitted provided that the following conditions","// are met:","//  * Redistributions of source code must retain the above copyright","//    notice, this list of conditions and the following disclaimer.","//  * Redistributions in binary form must reproduce the above copyright","//    notice, this list of conditions and the following disclaimer in the","//    documentation and/or other materials provided with the distribution.","//  * Neither the name of NVIDIA CORPORATION nor the names of its","//    contributors may be used to endorse or promote products derived","//    from this software without specific prior written permission.","//","// THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS ``AS IS'' AND ANY","// EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE","// IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR","// PURPOSE ARE DISCLAIMED.  IN NO EVENT SHALL THE COPYRIGHT OWNER OR","// CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL,","// EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO,","// PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR","// PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY","// OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT","// (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE","// OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.","//","//----------------------------------------------------------------------------------","","#define FXAA_PC 1","#define FXAA_GLSL_100 1","#define FXAA_QUALITY_PRESET 12","","#define FXAA_GREEN_AS_LUMA 1","","/*--------------------------------------------------------------------------*/","#ifndef FXAA_PC_CONSOLE","    //","    // The console algorithm for PC is included","    // for developers targeting really low spec machines.","    // Likely better to just run FXAA_PC, and use a really low preset.","    //","    #define FXAA_PC_CONSOLE 0","#endif","/*--------------------------------------------------------------------------*/","#ifndef FXAA_GLSL_120","    #define FXAA_GLSL_120 0","#endif","/*--------------------------------------------------------------------------*/","#ifndef FXAA_GLSL_130","    #define FXAA_GLSL_130 0","#endif","/*--------------------------------------------------------------------------*/","#ifndef FXAA_HLSL_3","    #define FXAA_HLSL_3 0","#endif","/*--------------------------------------------------------------------------*/","#ifndef FXAA_HLSL_4","    #define FXAA_HLSL_4 0","#endif","/*--------------------------------------------------------------------------*/","#ifndef FXAA_HLSL_5","    #define FXAA_HLSL_5 0","#endif","/*==========================================================================*/","#ifndef FXAA_GREEN_AS_LUMA","    //","    // For those using non-linear color,","    // and either not able to get luma in alpha, or not wanting to,","    // this enables FXAA to run using green as a proxy for luma.","    // So with this enabled, no need to pack luma in alpha.","    //","    // This will turn off AA on anything which lacks some amount of green.","    // Pure red and blue or combination of only R and B, will get no AA.","    //","    // Might want to lower the settings for both,","    //    fxaaConsoleEdgeThresholdMin","    //    fxaaQualityEdgeThresholdMin","    // In order to insure AA does not get turned off on colors","    // which contain a minor amount of green.","    //","    // 1 = On.","    // 0 = Off.","    //","    #define FXAA_GREEN_AS_LUMA 0","#endif","/*--------------------------------------------------------------------------*/","#ifndef FXAA_EARLY_EXIT","    //","    // Controls algorithm's early exit path.","    // On PS3 turning this ON adds 2 cycles to the shader.","    // On 360 turning this OFF adds 10ths of a millisecond to the shader.","    // Turning this off on console will result in a more blurry image.","    // So this defaults to on.","    //","    // 1 = On.","    // 0 = Off.","    //","    #define FXAA_EARLY_EXIT 1","#endif","/*--------------------------------------------------------------------------*/","#ifndef FXAA_DISCARD","    //","    // Only valid for PC OpenGL currently.","    // Probably will not work when FXAA_GREEN_AS_LUMA = 1.","    //","    // 1 = Use discard on pixels which don't need AA.","    //     For APIs which enable concurrent TEX+ROP from same surface.","    // 0 = Return unchanged color on pixels which don't need AA.","    //","    #define FXAA_DISCARD 0","#endif","/*--------------------------------------------------------------------------*/","#ifndef FXAA_FAST_PIXEL_OFFSET","    //","    // Used for GLSL 120 only.","    //","    // 1 = GL API supports fast pixel offsets","    // 0 = do not use fast pixel offsets","    //","    #ifdef GL_EXT_gpu_shader4","        #define FXAA_FAST_PIXEL_OFFSET 1","    #endif","    #ifdef GL_NV_gpu_shader5","        #define FXAA_FAST_PIXEL_OFFSET 1","    #endif","    #ifdef GL_ARB_gpu_shader5","        #define FXAA_FAST_PIXEL_OFFSET 1","    #endif","    #ifndef FXAA_FAST_PIXEL_OFFSET","        #define FXAA_FAST_PIXEL_OFFSET 0","    #endif","#endif","/*--------------------------------------------------------------------------*/","#ifndef FXAA_GATHER4_ALPHA","    //","    // 1 = API supports gather4 on alpha channel.","    // 0 = API does not support gather4 on alpha channel.","    //","    #if (FXAA_HLSL_5 == 1)","        #define FXAA_GATHER4_ALPHA 1","    #endif","    #ifdef GL_ARB_gpu_shader5","        #define FXAA_GATHER4_ALPHA 1","    #endif","    #ifdef GL_NV_gpu_shader5","        #define FXAA_GATHER4_ALPHA 1","    #endif","    #ifndef FXAA_GATHER4_ALPHA","        #define FXAA_GATHER4_ALPHA 0","    #endif","#endif","","","/*============================================================================","                        FXAA QUALITY - TUNING KNOBS","------------------------------------------------------------------------------","NOTE the other tuning knobs are now in the shader function inputs!","============================================================================*/","#ifndef FXAA_QUALITY_PRESET","    //","    // Choose the quality preset.","    // This needs to be compiled into the shader as it effects code.","    // Best option to include multiple presets is to","    // in each shader define the preset, then include this file.","    //","    // OPTIONS","    // -----------------------------------------------------------------------","    // 10 to 15 - default medium dither (10=fastest, 15=highest quality)","    // 20 to 29 - less dither, more expensive (20=fastest, 29=highest quality)","    // 39       - no dither, very expensive","    //","    // NOTES","    // -----------------------------------------------------------------------","    // 12 = slightly faster then FXAA 3.9 and higher edge quality (default)","    // 13 = about same speed as FXAA 3.9 and better than 12","    // 23 = closest to FXAA 3.9 visually and performance wise","    //  _ = the lowest digit is directly related to performance","    // _  = the highest digit is directly related to style","    //","    #define FXAA_QUALITY_PRESET 12","#endif","","","/*============================================================================","","                           FXAA QUALITY - PRESETS","","============================================================================*/","","/*============================================================================","                     FXAA QUALITY - MEDIUM DITHER PRESETS","============================================================================*/","#if (FXAA_QUALITY_PRESET == 10)","    #define FXAA_QUALITY_PS 3","    #define FXAA_QUALITY_P0 1.5","    #define FXAA_QUALITY_P1 3.0","    #define FXAA_QUALITY_P2 12.0","#endif","/*--------------------------------------------------------------------------*/","#if (FXAA_QUALITY_PRESET == 11)","    #define FXAA_QUALITY_PS 4","    #define FXAA_QUALITY_P0 1.0","    #define FXAA_QUALITY_P1 1.5","    #define FXAA_QUALITY_P2 3.0","    #define FXAA_QUALITY_P3 12.0","#endif","/*--------------------------------------------------------------------------*/","#if (FXAA_QUALITY_PRESET == 12)","    #define FXAA_QUALITY_PS 5","    #define FXAA_QUALITY_P0 1.0","    #define FXAA_QUALITY_P1 1.5","    #define FXAA_QUALITY_P2 2.0","    #define FXAA_QUALITY_P3 4.0","    #define FXAA_QUALITY_P4 12.0","#endif","/*--------------------------------------------------------------------------*/","#if (FXAA_QUALITY_PRESET == 13)","    #define FXAA_QUALITY_PS 6","    #define FXAA_QUALITY_P0 1.0","    #define FXAA_QUALITY_P1 1.5","    #define FXAA_QUALITY_P2 2.0","    #define FXAA_QUALITY_P3 2.0","    #define FXAA_QUALITY_P4 4.0","    #define FXAA_QUALITY_P5 12.0","#endif","/*--------------------------------------------------------------------------*/","#if (FXAA_QUALITY_PRESET == 14)","    #define FXAA_QUALITY_PS 7","    #define FXAA_QUALITY_P0 1.0","    #define FXAA_QUALITY_P1 1.5","    #define FXAA_QUALITY_P2 2.0","    #define FXAA_QUALITY_P3 2.0","    #define FXAA_QUALITY_P4 2.0","    #define FXAA_QUALITY_P5 4.0","    #define FXAA_QUALITY_P6 12.0","#endif","/*--------------------------------------------------------------------------*/","#if (FXAA_QUALITY_PRESET == 15)","    #define FXAA_QUALITY_PS 8","    #define FXAA_QUALITY_P0 1.0","    #define FXAA_QUALITY_P1 1.5","    #define FXAA_QUALITY_P2 2.0","    #define FXAA_QUALITY_P3 2.0","    #define FXAA_QUALITY_P4 2.0","    #define FXAA_QUALITY_P5 2.0","    #define FXAA_QUALITY_P6 4.0","    #define FXAA_QUALITY_P7 12.0","#endif","","/*============================================================================","                     FXAA QUALITY - LOW DITHER PRESETS","============================================================================*/","#if (FXAA_QUALITY_PRESET == 20)","    #define FXAA_QUALITY_PS 3","    #define FXAA_QUALITY_P0 1.5","    #define FXAA_QUALITY_P1 2.0","    #define FXAA_QUALITY_P2 8.0","#endif","/*--------------------------------------------------------------------------*/","#if (FXAA_QUALITY_PRESET == 21)","    #define FXAA_QUALITY_PS 4","    #define FXAA_QUALITY_P0 1.0","    #define FXAA_QUALITY_P1 1.5","    #define FXAA_QUALITY_P2 2.0","    #define FXAA_QUALITY_P3 8.0","#endif","/*--------------------------------------------------------------------------*/","#if (FXAA_QUALITY_PRESET == 22)","    #define FXAA_QUALITY_PS 5","    #define FXAA_QUALITY_P0 1.0","    #define FXAA_QUALITY_P1 1.5","    #define FXAA_QUALITY_P2 2.0","    #define FXAA_QUALITY_P3 2.0","    #define FXAA_QUALITY_P4 8.0","#endif","/*--------------------------------------------------------------------------*/","#if (FXAA_QUALITY_PRESET == 23)","    #define FXAA_QUALITY_PS 6","    #define FXAA_QUALITY_P0 1.0","    #define FXAA_QUALITY_P1 1.5","    #define FXAA_QUALITY_P2 2.0","    #define FXAA_QUALITY_P3 2.0","    #define FXAA_QUALITY_P4 2.0","    #define FXAA_QUALITY_P5 8.0","#endif","/*--------------------------------------------------------------------------*/","#if (FXAA_QUALITY_PRESET == 24)","    #define FXAA_QUALITY_PS 7","    #define FXAA_QUALITY_P0 1.0","    #define FXAA_QUALITY_P1 1.5","    #define FXAA_QUALITY_P2 2.0","    #define FXAA_QUALITY_P3 2.0","    #define FXAA_QUALITY_P4 2.0","    #define FXAA_QUALITY_P5 3.0","    #define FXAA_QUALITY_P6 8.0","#endif","/*--------------------------------------------------------------------------*/","#if (FXAA_QUALITY_PRESET == 25)","    #define FXAA_QUALITY_PS 8","    #define FXAA_QUALITY_P0 1.0","    #define FXAA_QUALITY_P1 1.5","    #define FXAA_QUALITY_P2 2.0","    #define FXAA_QUALITY_P3 2.0","    #define FXAA_QUALITY_P4 2.0","    #define FXAA_QUALITY_P5 2.0","    #define FXAA_QUALITY_P6 4.0","    #define FXAA_QUALITY_P7 8.0","#endif","/*--------------------------------------------------------------------------*/","#if (FXAA_QUALITY_PRESET == 26)","    #define FXAA_QUALITY_PS 9","    #define FXAA_QUALITY_P0 1.0","    #define FXAA_QUALITY_P1 1.5","    #define FXAA_QUALITY_P2 2.0","    #define FXAA_QUALITY_P3 2.0","    #define FXAA_QUALITY_P4 2.0","    #define FXAA_QUALITY_P5 2.0","    #define FXAA_QUALITY_P6 2.0","    #define FXAA_QUALITY_P7 4.0","    #define FXAA_QUALITY_P8 8.0","#endif","/*--------------------------------------------------------------------------*/","#if (FXAA_QUALITY_PRESET == 27)","    #define FXAA_QUALITY_PS 10","    #define FXAA_QUALITY_P0 1.0","    #define FXAA_QUALITY_P1 1.5","    #define FXAA_QUALITY_P2 2.0","    #define FXAA_QUALITY_P3 2.0","    #define FXAA_QUALITY_P4 2.0","    #define FXAA_QUALITY_P5 2.0","    #define FXAA_QUALITY_P6 2.0","    #define FXAA_QUALITY_P7 2.0","    #define FXAA_QUALITY_P8 4.0","    #define FXAA_QUALITY_P9 8.0","#endif","/*--------------------------------------------------------------------------*/","#if (FXAA_QUALITY_PRESET == 28)","    #define FXAA_QUALITY_PS 11","    #define FXAA_QUALITY_P0 1.0","    #define FXAA_QUALITY_P1 1.5","    #define FXAA_QUALITY_P2 2.0","    #define FXAA_QUALITY_P3 2.0","    #define FXAA_QUALITY_P4 2.0","    #define FXAA_QUALITY_P5 2.0","    #define FXAA_QUALITY_P6 2.0","    #define FXAA_QUALITY_P7 2.0","    #define FXAA_QUALITY_P8 2.0","    #define FXAA_QUALITY_P9 4.0","    #define FXAA_QUALITY_P10 8.0","#endif","/*--------------------------------------------------------------------------*/","#if (FXAA_QUALITY_PRESET == 29)","    #define FXAA_QUALITY_PS 12","    #define FXAA_QUALITY_P0 1.0","    #define FXAA_QUALITY_P1 1.5","    #define FXAA_QUALITY_P2 2.0","    #define FXAA_QUALITY_P3 2.0","    #define FXAA_QUALITY_P4 2.0","    #define FXAA_QUALITY_P5 2.0","    #define FXAA_QUALITY_P6 2.0","    #define FXAA_QUALITY_P7 2.0","    #define FXAA_QUALITY_P8 2.0","    #define FXAA_QUALITY_P9 2.0","    #define FXAA_QUALITY_P10 4.0","    #define FXAA_QUALITY_P11 8.0","#endif","","/*============================================================================","                     FXAA QUALITY - EXTREME QUALITY","============================================================================*/","#if (FXAA_QUALITY_PRESET == 39)","    #define FXAA_QUALITY_PS 12","    #define FXAA_QUALITY_P0 1.0","    #define FXAA_QUALITY_P1 1.0","    #define FXAA_QUALITY_P2 1.0","    #define FXAA_QUALITY_P3 1.0","    #define FXAA_QUALITY_P4 1.0","    #define FXAA_QUALITY_P5 1.5","    #define FXAA_QUALITY_P6 2.0","    #define FXAA_QUALITY_P7 2.0","    #define FXAA_QUALITY_P8 2.0","    #define FXAA_QUALITY_P9 2.0","    #define FXAA_QUALITY_P10 4.0","    #define FXAA_QUALITY_P11 8.0","#endif","","","","/*============================================================================","","                                API PORTING","","============================================================================*/","#if (FXAA_GLSL_100 == 1) || (FXAA_GLSL_120 == 1) || (FXAA_GLSL_130 == 1)","    #define FxaaBool bool","    #define FxaaDiscard discard","    #define FxaaFloat float","    #define FxaaFloat2 vec2","    #define FxaaFloat3 vec3","    #define FxaaFloat4 vec4","    #define FxaaHalf float","    #define FxaaHalf2 vec2","    #define FxaaHalf3 vec3","    #define FxaaHalf4 vec4","    #define FxaaInt2 ivec2","    #define FxaaSat(x) clamp(x, 0.0, 1.0)","    #define FxaaTex sampler2D","#else","    #define FxaaBool bool","    #define FxaaDiscard clip(-1)","    #define FxaaFloat float","    #define FxaaFloat2 float2","    #define FxaaFloat3 float3","    #define FxaaFloat4 float4","    #define FxaaHalf half","    #define FxaaHalf2 half2","    #define FxaaHalf3 half3","    #define FxaaHalf4 half4","    #define FxaaSat(x) saturate(x)","#endif","/*--------------------------------------------------------------------------*/","#if (FXAA_GLSL_100 == 1)","  #define FxaaTexTop(t, p) texture2D(t, p, 0.0)","  #define FxaaTexOff(t, p, o, r) texture2D(t, p + (o * r), 0.0)","#endif","/*--------------------------------------------------------------------------*/","#if (FXAA_GLSL_120 == 1)","    // Requires,","    //  #version 120","    // And at least,","    //  #extension GL_EXT_gpu_shader4 : enable","    //  (or set FXAA_FAST_PIXEL_OFFSET 1 to work like DX9)","    #define FxaaTexTop(t, p) texture2DLod(t, p, 0.0)","    #if (FXAA_FAST_PIXEL_OFFSET == 1)","        #define FxaaTexOff(t, p, o, r) texture2DLodOffset(t, p, 0.0, o)","    #else","        #define FxaaTexOff(t, p, o, r) texture2DLod(t, p + (o * r), 0.0)","    #endif","    #if (FXAA_GATHER4_ALPHA == 1)","        // use #extension GL_ARB_gpu_shader5 : enable","        #define FxaaTexAlpha4(t, p) textureGather(t, p, 3)","        #define FxaaTexOffAlpha4(t, p, o) textureGatherOffset(t, p, o, 3)","        #define FxaaTexGreen4(t, p) textureGather(t, p, 1)","        #define FxaaTexOffGreen4(t, p, o) textureGatherOffset(t, p, o, 1)","    #endif","#endif","/*--------------------------------------------------------------------------*/","#if (FXAA_GLSL_130 == 1)","    // Requires \"#version 130\" or better","    #define FxaaTexTop(t, p) textureLod(t, p, 0.0)","    #define FxaaTexOff(t, p, o, r) textureLodOffset(t, p, 0.0, o)","    #if (FXAA_GATHER4_ALPHA == 1)","        // use #extension GL_ARB_gpu_shader5 : enable","        #define FxaaTexAlpha4(t, p) textureGather(t, p, 3)","        #define FxaaTexOffAlpha4(t, p, o) textureGatherOffset(t, p, o, 3)","        #define FxaaTexGreen4(t, p) textureGather(t, p, 1)","        #define FxaaTexOffGreen4(t, p, o) textureGatherOffset(t, p, o, 1)","    #endif","#endif","/*--------------------------------------------------------------------------*/","#if (FXAA_HLSL_3 == 1)","    #define FxaaInt2 float2","    #define FxaaTex sampler2D","    #define FxaaTexTop(t, p) tex2Dlod(t, float4(p, 0.0, 0.0))","    #define FxaaTexOff(t, p, o, r) tex2Dlod(t, float4(p + (o * r), 0, 0))","#endif","/*--------------------------------------------------------------------------*/","#if (FXAA_HLSL_4 == 1)","    #define FxaaInt2 int2","    struct FxaaTex { SamplerState smpl; Texture2D tex; };","    #define FxaaTexTop(t, p) t.tex.SampleLevel(t.smpl, p, 0.0)","    #define FxaaTexOff(t, p, o, r) t.tex.SampleLevel(t.smpl, p, 0.0, o)","#endif","/*--------------------------------------------------------------------------*/","#if (FXAA_HLSL_5 == 1)","    #define FxaaInt2 int2","    struct FxaaTex { SamplerState smpl; Texture2D tex; };","    #define FxaaTexTop(t, p) t.tex.SampleLevel(t.smpl, p, 0.0)","    #define FxaaTexOff(t, p, o, r) t.tex.SampleLevel(t.smpl, p, 0.0, o)","    #define FxaaTexAlpha4(t, p) t.tex.GatherAlpha(t.smpl, p)","    #define FxaaTexOffAlpha4(t, p, o) t.tex.GatherAlpha(t.smpl, p, o)","    #define FxaaTexGreen4(t, p) t.tex.GatherGreen(t.smpl, p)","    #define FxaaTexOffGreen4(t, p, o) t.tex.GatherGreen(t.smpl, p, o)","#endif","","","/*============================================================================","                   GREEN AS LUMA OPTION SUPPORT FUNCTION","============================================================================*/","#if (FXAA_GREEN_AS_LUMA == 0)","    FxaaFloat FxaaLuma(FxaaFloat4 rgba) { return rgba.w; }","#else","    FxaaFloat FxaaLuma(FxaaFloat4 rgba) { return rgba.y; }","#endif","","","","","/*============================================================================","","                             FXAA3 QUALITY - PC","","============================================================================*/","#if (FXAA_PC == 1)","/*--------------------------------------------------------------------------*/","FxaaFloat4 FxaaPixelShader(","    //","    // Use noperspective interpolation here (turn off perspective interpolation).","    // {xy} = center of pixel","    FxaaFloat2 pos,","    //","    // Used only for FXAA Console, and not used on the 360 version.","    // Use noperspective interpolation here (turn off perspective interpolation).","    // {xy_} = upper left of pixel","    // {_zw} = lower right of pixel","    FxaaFloat4 fxaaConsolePosPos,","    //","    // Input color texture.","    // {rgb_} = color in linear or perceptual color space","    // if (FXAA_GREEN_AS_LUMA == 0)","    //     {__a} = luma in perceptual color space (not linear)","    FxaaTex tex,","    //","    // Only used on the optimized 360 version of FXAA Console.","    // For everything but 360, just use the same input here as for \"tex\".","    // For 360, same texture, just alias with a 2nd sampler.","    // This sampler needs to have an exponent bias of -1.","    FxaaTex fxaaConsole360TexExpBiasNegOne,","    //","    // Only used on the optimized 360 version of FXAA Console.","    // For everything but 360, just use the same input here as for \"tex\".","    // For 360, same texture, just alias with a 3nd sampler.","    // This sampler needs to have an exponent bias of -2.","    FxaaTex fxaaConsole360TexExpBiasNegTwo,","    //","    // Only used on FXAA Quality.","    // This must be from a constant/uniform.","    // {x_} = 1.0/screenWidthInPixels","    // {_y} = 1.0/screenHeightInPixels","    FxaaFloat2 fxaaQualityRcpFrame,","    //","    // Only used on FXAA Console.","    // This must be from a constant/uniform.","    // This effects sub-pixel AA quality and inversely sharpness.","    //   Where N ranges between,","    //     N = 0.50 (default)","    //     N = 0.33 (sharper)","    // {x__} = -N/screenWidthInPixels","    // {_y_} = -N/screenHeightInPixels","    // {_z_} =  N/screenWidthInPixels","    // {__w} =  N/screenHeightInPixels","    FxaaFloat4 fxaaConsoleRcpFrameOpt,","    //","    // Only used on FXAA Console.","    // Not used on 360, but used on PS3 and PC.","    // This must be from a constant/uniform.","    // {x__} = -2.0/screenWidthInPixels","    // {_y_} = -2.0/screenHeightInPixels","    // {_z_} =  2.0/screenWidthInPixels","    // {__w} =  2.0/screenHeightInPixels","    FxaaFloat4 fxaaConsoleRcpFrameOpt2,","    //","    // Only used on FXAA Console.","    // Only used on 360 in place of fxaaConsoleRcpFrameOpt2.","    // This must be from a constant/uniform.","    // {x__} =  8.0/screenWidthInPixels","    // {_y_} =  8.0/screenHeightInPixels","    // {_z_} = -4.0/screenWidthInPixels","    // {__w} = -4.0/screenHeightInPixels","    FxaaFloat4 fxaaConsole360RcpFrameOpt2,","    //","    // Only used on FXAA Quality.","    // This used to be the FXAA_QUALITY_SUBPIX define.","    // It is here now to allow easier tuning.","    // Choose the amount of sub-pixel aliasing removal.","    // This can effect sharpness.","    //   1.00 - upper limit (softer)","    //   0.75 - default amount of filtering","    //   0.50 - lower limit (sharper, less sub-pixel aliasing removal)","    //   0.25 - almost off","    //   0.00 - completely off","    FxaaFloat fxaaQualitySubpix,","    //","    // Only used on FXAA Quality.","    // This used to be the FXAA_QUALITY_EDGE_THRESHOLD define.","    // It is here now to allow easier tuning.","    // The minimum amount of local contrast required to apply algorithm.","    //   0.333 - too little (faster)","    //   0.250 - low quality","    //   0.166 - default","    //   0.125 - high quality","    //   0.063 - overkill (slower)","    FxaaFloat fxaaQualityEdgeThreshold,","    //","    // Only used on FXAA Quality.","    // This used to be the FXAA_QUALITY_EDGE_THRESHOLD_MIN define.","    // It is here now to allow easier tuning.","    // Trims the algorithm from processing darks.","    //   0.0833 - upper limit (default, the start of visible unfiltered edges)","    //   0.0625 - high quality (faster)","    //   0.0312 - visible limit (slower)","    // Special notes when using FXAA_GREEN_AS_LUMA,","    //   Likely want to set this to zero.","    //   As colors that are mostly not-green","    //   will appear very dark in the green channel!","    //   Tune by looking at mostly non-green content,","    //   then start at zero and increase until aliasing is a problem.","    FxaaFloat fxaaQualityEdgeThresholdMin,","    //","    // Only used on FXAA Console.","    // This used to be the FXAA_CONSOLE_EDGE_SHARPNESS define.","    // It is here now to allow easier tuning.","    // This does not effect PS3, as this needs to be compiled in.","    //   Use FXAA_CONSOLE_PS3_EDGE_SHARPNESS for PS3.","    //   Due to the PS3 being ALU bound,","    //   there are only three safe values here: 2 and 4 and 8.","    //   These options use the shaders ability to a free *|/ by 2|4|8.","    // For all other platforms can be a non-power of two.","    //   8.0 is sharper (default!!!)","    //   4.0 is softer","    //   2.0 is really soft (good only for vector graphics inputs)","    FxaaFloat fxaaConsoleEdgeSharpness,","    //","    // Only used on FXAA Console.","    // This used to be the FXAA_CONSOLE_EDGE_THRESHOLD define.","    // It is here now to allow easier tuning.","    // This does not effect PS3, as this needs to be compiled in.","    //   Use FXAA_CONSOLE_PS3_EDGE_THRESHOLD for PS3.","    //   Due to the PS3 being ALU bound,","    //   there are only two safe values here: 1/4 and 1/8.","    //   These options use the shaders ability to a free *|/ by 2|4|8.","    // The console setting has a different mapping than the quality setting.","    // Other platforms can use other values.","    //   0.125 leaves less aliasing, but is softer (default!!!)","    //   0.25 leaves more aliasing, and is sharper","    FxaaFloat fxaaConsoleEdgeThreshold,","    //","    // Only used on FXAA Console.","    // This used to be the FXAA_CONSOLE_EDGE_THRESHOLD_MIN define.","    // It is here now to allow easier tuning.","    // Trims the algorithm from processing darks.","    // The console setting has a different mapping than the quality setting.","    // This only applies when FXAA_EARLY_EXIT is 1.","    // This does not apply to PS3,","    // PS3 was simplified to avoid more shader instructions.","    //   0.06 - faster but more aliasing in darks","    //   0.05 - default","    //   0.04 - slower and less aliasing in darks","    // Special notes when using FXAA_GREEN_AS_LUMA,","    //   Likely want to set this to zero.","    //   As colors that are mostly not-green","    //   will appear very dark in the green channel!","    //   Tune by looking at mostly non-green content,","    //   then start at zero and increase until aliasing is a problem.","    FxaaFloat fxaaConsoleEdgeThresholdMin,","    //","    // Extra constants for 360 FXAA Console only.","    // Use zeros or anything else for other platforms.","    // These must be in physical constant registers and NOT immedates.","    // Immedates will result in compiler un-optimizing.","    // {xyzw} = float4(1.0, -1.0, 0.25, -0.25)","    FxaaFloat4 fxaaConsole360ConstDir",") {","/*--------------------------------------------------------------------------*/","    FxaaFloat2 posM;","    posM.x = pos.x;","    posM.y = pos.y;","    #if (FXAA_GATHER4_ALPHA == 1)","        #if (FXAA_DISCARD == 0)","            FxaaFloat4 rgbyM = FxaaTexTop(tex, posM);","            #if (FXAA_GREEN_AS_LUMA == 0)","                #define lumaM rgbyM.w","            #else","                #define lumaM rgbyM.y","            #endif","        #endif","        #if (FXAA_GREEN_AS_LUMA == 0)","            FxaaFloat4 luma4A = FxaaTexAlpha4(tex, posM);","            FxaaFloat4 luma4B = FxaaTexOffAlpha4(tex, posM, FxaaInt2(-1, -1));","        #else","            FxaaFloat4 luma4A = FxaaTexGreen4(tex, posM);","            FxaaFloat4 luma4B = FxaaTexOffGreen4(tex, posM, FxaaInt2(-1, -1));","        #endif","        #if (FXAA_DISCARD == 1)","            #define lumaM luma4A.w","        #endif","        #define lumaE luma4A.z","        #define lumaS luma4A.x","        #define lumaSE luma4A.y","        #define lumaNW luma4B.w","        #define lumaN luma4B.z","        #define lumaW luma4B.x","    #else","        FxaaFloat4 rgbyM = FxaaTexTop(tex, posM);","        #if (FXAA_GREEN_AS_LUMA == 0)","            #define lumaM rgbyM.w","        #else","            #define lumaM rgbyM.y","        #endif","        #if (FXAA_GLSL_100 == 1)","          FxaaFloat lumaS = FxaaLuma(FxaaTexOff(tex, posM, FxaaFloat2( 0.0, 1.0), fxaaQualityRcpFrame.xy));","          FxaaFloat lumaE = FxaaLuma(FxaaTexOff(tex, posM, FxaaFloat2( 1.0, 0.0), fxaaQualityRcpFrame.xy));","          FxaaFloat lumaN = FxaaLuma(FxaaTexOff(tex, posM, FxaaFloat2( 0.0,-1.0), fxaaQualityRcpFrame.xy));","          FxaaFloat lumaW = FxaaLuma(FxaaTexOff(tex, posM, FxaaFloat2(-1.0, 0.0), fxaaQualityRcpFrame.xy));","        #else","          FxaaFloat lumaS = FxaaLuma(FxaaTexOff(tex, posM, FxaaInt2( 0, 1), fxaaQualityRcpFrame.xy));","          FxaaFloat lumaE = FxaaLuma(FxaaTexOff(tex, posM, FxaaInt2( 1, 0), fxaaQualityRcpFrame.xy));","          FxaaFloat lumaN = FxaaLuma(FxaaTexOff(tex, posM, FxaaInt2( 0,-1), fxaaQualityRcpFrame.xy));","          FxaaFloat lumaW = FxaaLuma(FxaaTexOff(tex, posM, FxaaInt2(-1, 0), fxaaQualityRcpFrame.xy));","        #endif","    #endif","/*--------------------------------------------------------------------------*/","    FxaaFloat maxSM = max(lumaS, lumaM);","    FxaaFloat minSM = min(lumaS, lumaM);","    FxaaFloat maxESM = max(lumaE, maxSM);","    FxaaFloat minESM = min(lumaE, minSM);","    FxaaFloat maxWN = max(lumaN, lumaW);","    FxaaFloat minWN = min(lumaN, lumaW);","    FxaaFloat rangeMax = max(maxWN, maxESM);","    FxaaFloat rangeMin = min(minWN, minESM);","    FxaaFloat rangeMaxScaled = rangeMax * fxaaQualityEdgeThreshold;","    FxaaFloat range = rangeMax - rangeMin;","    FxaaFloat rangeMaxClamped = max(fxaaQualityEdgeThresholdMin, rangeMaxScaled);","    FxaaBool earlyExit = range < rangeMaxClamped;","/*--------------------------------------------------------------------------*/","    if(earlyExit)","        #if (FXAA_DISCARD == 1)","            FxaaDiscard;","        #else","            return rgbyM;","        #endif","/*--------------------------------------------------------------------------*/","    #if (FXAA_GATHER4_ALPHA == 0)","        #if (FXAA_GLSL_100 == 1)","          FxaaFloat lumaNW = FxaaLuma(FxaaTexOff(tex, posM, FxaaFloat2(-1.0,-1.0), fxaaQualityRcpFrame.xy));","          FxaaFloat lumaSE = FxaaLuma(FxaaTexOff(tex, posM, FxaaFloat2( 1.0, 1.0), fxaaQualityRcpFrame.xy));","          FxaaFloat lumaNE = FxaaLuma(FxaaTexOff(tex, posM, FxaaFloat2( 1.0,-1.0), fxaaQualityRcpFrame.xy));","          FxaaFloat lumaSW = FxaaLuma(FxaaTexOff(tex, posM, FxaaFloat2(-1.0, 1.0), fxaaQualityRcpFrame.xy));","        #else","          FxaaFloat lumaNW = FxaaLuma(FxaaTexOff(tex, posM, FxaaInt2(-1,-1), fxaaQualityRcpFrame.xy));","          FxaaFloat lumaSE = FxaaLuma(FxaaTexOff(tex, posM, FxaaInt2( 1, 1), fxaaQualityRcpFrame.xy));","          FxaaFloat lumaNE = FxaaLuma(FxaaTexOff(tex, posM, FxaaInt2( 1,-1), fxaaQualityRcpFrame.xy));","          FxaaFloat lumaSW = FxaaLuma(FxaaTexOff(tex, posM, FxaaInt2(-1, 1), fxaaQualityRcpFrame.xy));","        #endif","    #else","        FxaaFloat lumaNE = FxaaLuma(FxaaTexOff(tex, posM, FxaaInt2(1, -1), fxaaQualityRcpFrame.xy));","        FxaaFloat lumaSW = FxaaLuma(FxaaTexOff(tex, posM, FxaaInt2(-1, 1), fxaaQualityRcpFrame.xy));","    #endif","/*--------------------------------------------------------------------------*/","    FxaaFloat lumaNS = lumaN + lumaS;","    FxaaFloat lumaWE = lumaW + lumaE;","    FxaaFloat subpixRcpRange = 1.0/range;","    FxaaFloat subpixNSWE = lumaNS + lumaWE;","    FxaaFloat edgeHorz1 = (-2.0 * lumaM) + lumaNS;","    FxaaFloat edgeVert1 = (-2.0 * lumaM) + lumaWE;","/*--------------------------------------------------------------------------*/","    FxaaFloat lumaNESE = lumaNE + lumaSE;","    FxaaFloat lumaNWNE = lumaNW + lumaNE;","    FxaaFloat edgeHorz2 = (-2.0 * lumaE) + lumaNESE;","    FxaaFloat edgeVert2 = (-2.0 * lumaN) + lumaNWNE;","/*--------------------------------------------------------------------------*/","    FxaaFloat lumaNWSW = lumaNW + lumaSW;","    FxaaFloat lumaSWSE = lumaSW + lumaSE;","    FxaaFloat edgeHorz4 = (abs(edgeHorz1) * 2.0) + abs(edgeHorz2);","    FxaaFloat edgeVert4 = (abs(edgeVert1) * 2.0) + abs(edgeVert2);","    FxaaFloat edgeHorz3 = (-2.0 * lumaW) + lumaNWSW;","    FxaaFloat edgeVert3 = (-2.0 * lumaS) + lumaSWSE;","    FxaaFloat edgeHorz = abs(edgeHorz3) + edgeHorz4;","    FxaaFloat edgeVert = abs(edgeVert3) + edgeVert4;","/*--------------------------------------------------------------------------*/","    FxaaFloat subpixNWSWNESE = lumaNWSW + lumaNESE;","    FxaaFloat lengthSign = fxaaQualityRcpFrame.x;","    FxaaBool horzSpan = edgeHorz >= edgeVert;","    FxaaFloat subpixA = subpixNSWE * 2.0 + subpixNWSWNESE;","/*--------------------------------------------------------------------------*/","    if(!horzSpan) lumaN = lumaW;","    if(!horzSpan) lumaS = lumaE;","    if(horzSpan) lengthSign = fxaaQualityRcpFrame.y;","    FxaaFloat subpixB = (subpixA * (1.0/12.0)) - lumaM;","/*--------------------------------------------------------------------------*/","    FxaaFloat gradientN = lumaN - lumaM;","    FxaaFloat gradientS = lumaS - lumaM;","    FxaaFloat lumaNN = lumaN + lumaM;","    FxaaFloat lumaSS = lumaS + lumaM;","    FxaaBool pairN = abs(gradientN) >= abs(gradientS);","    FxaaFloat gradient = max(abs(gradientN), abs(gradientS));","    if(pairN) lengthSign = -lengthSign;","    FxaaFloat subpixC = FxaaSat(abs(subpixB) * subpixRcpRange);","/*--------------------------------------------------------------------------*/","    FxaaFloat2 posB;","    posB.x = posM.x;","    posB.y = posM.y;","    FxaaFloat2 offNP;","    offNP.x = (!horzSpan) ? 0.0 : fxaaQualityRcpFrame.x;","    offNP.y = ( horzSpan) ? 0.0 : fxaaQualityRcpFrame.y;","    if(!horzSpan) posB.x += lengthSign * 0.5;","    if( horzSpan) posB.y += lengthSign * 0.5;","/*--------------------------------------------------------------------------*/","    FxaaFloat2 posN;","    posN.x = posB.x - offNP.x * FXAA_QUALITY_P0;","    posN.y = posB.y - offNP.y * FXAA_QUALITY_P0;","    FxaaFloat2 posP;","    posP.x = posB.x + offNP.x * FXAA_QUALITY_P0;","    posP.y = posB.y + offNP.y * FXAA_QUALITY_P0;","    FxaaFloat subpixD = ((-2.0)*subpixC) + 3.0;","    FxaaFloat lumaEndN = FxaaLuma(FxaaTexTop(tex, posN));","    FxaaFloat subpixE = subpixC * subpixC;","    FxaaFloat lumaEndP = FxaaLuma(FxaaTexTop(tex, posP));","/*--------------------------------------------------------------------------*/","    if(!pairN) lumaNN = lumaSS;","    FxaaFloat gradientScaled = gradient * 1.0/4.0;","    FxaaFloat lumaMM = lumaM - lumaNN * 0.5;","    FxaaFloat subpixF = subpixD * subpixE;","    FxaaBool lumaMLTZero = lumaMM < 0.0;","/*--------------------------------------------------------------------------*/","    lumaEndN -= lumaNN * 0.5;","    lumaEndP -= lumaNN * 0.5;","    FxaaBool doneN = abs(lumaEndN) >= gradientScaled;","    FxaaBool doneP = abs(lumaEndP) >= gradientScaled;","    if(!doneN) posN.x -= offNP.x * FXAA_QUALITY_P1;","    if(!doneN) posN.y -= offNP.y * FXAA_QUALITY_P1;","    FxaaBool doneNP = (!doneN) || (!doneP);","    if(!doneP) posP.x += offNP.x * FXAA_QUALITY_P1;","    if(!doneP) posP.y += offNP.y * FXAA_QUALITY_P1;","/*--------------------------------------------------------------------------*/","    if(doneNP) {","        if(!doneN) lumaEndN = FxaaLuma(FxaaTexTop(tex, posN.xy));","        if(!doneP) lumaEndP = FxaaLuma(FxaaTexTop(tex, posP.xy));","        if(!doneN) lumaEndN = lumaEndN - lumaNN * 0.5;","        if(!doneP) lumaEndP = lumaEndP - lumaNN * 0.5;","        doneN = abs(lumaEndN) >= gradientScaled;","        doneP = abs(lumaEndP) >= gradientScaled;","        if(!doneN) posN.x -= offNP.x * FXAA_QUALITY_P2;","        if(!doneN) posN.y -= offNP.y * FXAA_QUALITY_P2;","        doneNP = (!doneN) || (!doneP);","        if(!doneP) posP.x += offNP.x * FXAA_QUALITY_P2;","        if(!doneP) posP.y += offNP.y * FXAA_QUALITY_P2;","/*--------------------------------------------------------------------------*/","        #if (FXAA_QUALITY_PS > 3)","        if(doneNP) {","            if(!doneN) lumaEndN = FxaaLuma(FxaaTexTop(tex, posN.xy));","            if(!doneP) lumaEndP = FxaaLuma(FxaaTexTop(tex, posP.xy));","            if(!doneN) lumaEndN = lumaEndN - lumaNN * 0.5;","            if(!doneP) lumaEndP = lumaEndP - lumaNN * 0.5;","            doneN = abs(lumaEndN) >= gradientScaled;","            doneP = abs(lumaEndP) >= gradientScaled;","            if(!doneN) posN.x -= offNP.x * FXAA_QUALITY_P3;","            if(!doneN) posN.y -= offNP.y * FXAA_QUALITY_P3;","            doneNP = (!doneN) || (!doneP);","            if(!doneP) posP.x += offNP.x * FXAA_QUALITY_P3;","            if(!doneP) posP.y += offNP.y * FXAA_QUALITY_P3;","/*--------------------------------------------------------------------------*/","            #if (FXAA_QUALITY_PS > 4)","            if(doneNP) {","                if(!doneN) lumaEndN = FxaaLuma(FxaaTexTop(tex, posN.xy));","                if(!doneP) lumaEndP = FxaaLuma(FxaaTexTop(tex, posP.xy));","                if(!doneN) lumaEndN = lumaEndN - lumaNN * 0.5;","                if(!doneP) lumaEndP = lumaEndP - lumaNN * 0.5;","                doneN = abs(lumaEndN) >= gradientScaled;","                doneP = abs(lumaEndP) >= gradientScaled;","                if(!doneN) posN.x -= offNP.x * FXAA_QUALITY_P4;","                if(!doneN) posN.y -= offNP.y * FXAA_QUALITY_P4;","                doneNP = (!doneN) || (!doneP);","                if(!doneP) posP.x += offNP.x * FXAA_QUALITY_P4;","                if(!doneP) posP.y += offNP.y * FXAA_QUALITY_P4;","/*--------------------------------------------------------------------------*/","                #if (FXAA_QUALITY_PS > 5)","                if(doneNP) {","                    if(!doneN) lumaEndN = FxaaLuma(FxaaTexTop(tex, posN.xy));","                    if(!doneP) lumaEndP = FxaaLuma(FxaaTexTop(tex, posP.xy));","                    if(!doneN) lumaEndN = lumaEndN - lumaNN * 0.5;","                    if(!doneP) lumaEndP = lumaEndP - lumaNN * 0.5;","                    doneN = abs(lumaEndN) >= gradientScaled;","                    doneP = abs(lumaEndP) >= gradientScaled;","                    if(!doneN) posN.x -= offNP.x * FXAA_QUALITY_P5;","                    if(!doneN) posN.y -= offNP.y * FXAA_QUALITY_P5;","                    doneNP = (!doneN) || (!doneP);","                    if(!doneP) posP.x += offNP.x * FXAA_QUALITY_P5;","                    if(!doneP) posP.y += offNP.y * FXAA_QUALITY_P5;","/*--------------------------------------------------------------------------*/","                    #if (FXAA_QUALITY_PS > 6)","                    if(doneNP) {","                        if(!doneN) lumaEndN = FxaaLuma(FxaaTexTop(tex, posN.xy));","                        if(!doneP) lumaEndP = FxaaLuma(FxaaTexTop(tex, posP.xy));","                        if(!doneN) lumaEndN = lumaEndN - lumaNN * 0.5;","                        if(!doneP) lumaEndP = lumaEndP - lumaNN * 0.5;","                        doneN = abs(lumaEndN) >= gradientScaled;","                        doneP = abs(lumaEndP) >= gradientScaled;","                        if(!doneN) posN.x -= offNP.x * FXAA_QUALITY_P6;","                        if(!doneN) posN.y -= offNP.y * FXAA_QUALITY_P6;","                        doneNP = (!doneN) || (!doneP);","                        if(!doneP) posP.x += offNP.x * FXAA_QUALITY_P6;","                        if(!doneP) posP.y += offNP.y * FXAA_QUALITY_P6;","/*--------------------------------------------------------------------------*/","                        #if (FXAA_QUALITY_PS > 7)","                        if(doneNP) {","                            if(!doneN) lumaEndN = FxaaLuma(FxaaTexTop(tex, posN.xy));","                            if(!doneP) lumaEndP = FxaaLuma(FxaaTexTop(tex, posP.xy));","                            if(!doneN) lumaEndN = lumaEndN - lumaNN * 0.5;","                            if(!doneP) lumaEndP = lumaEndP - lumaNN * 0.5;","                            doneN = abs(lumaEndN) >= gradientScaled;","                            doneP = abs(lumaEndP) >= gradientScaled;","                            if(!doneN) posN.x -= offNP.x * FXAA_QUALITY_P7;","                            if(!doneN) posN.y -= offNP.y * FXAA_QUALITY_P7;","                            doneNP = (!doneN) || (!doneP);","                            if(!doneP) posP.x += offNP.x * FXAA_QUALITY_P7;","                            if(!doneP) posP.y += offNP.y * FXAA_QUALITY_P7;","/*--------------------------------------------------------------------------*/","    #if (FXAA_QUALITY_PS > 8)","    if(doneNP) {","        if(!doneN) lumaEndN = FxaaLuma(FxaaTexTop(tex, posN.xy));","        if(!doneP) lumaEndP = FxaaLuma(FxaaTexTop(tex, posP.xy));","        if(!doneN) lumaEndN = lumaEndN - lumaNN * 0.5;","        if(!doneP) lumaEndP = lumaEndP - lumaNN * 0.5;","        doneN = abs(lumaEndN) >= gradientScaled;","        doneP = abs(lumaEndP) >= gradientScaled;","        if(!doneN) posN.x -= offNP.x * FXAA_QUALITY_P8;","        if(!doneN) posN.y -= offNP.y * FXAA_QUALITY_P8;","        doneNP = (!doneN) || (!doneP);","        if(!doneP) posP.x += offNP.x * FXAA_QUALITY_P8;","        if(!doneP) posP.y += offNP.y * FXAA_QUALITY_P8;","/*--------------------------------------------------------------------------*/","        #if (FXAA_QUALITY_PS > 9)","        if(doneNP) {","            if(!doneN) lumaEndN = FxaaLuma(FxaaTexTop(tex, posN.xy));","            if(!doneP) lumaEndP = FxaaLuma(FxaaTexTop(tex, posP.xy));","            if(!doneN) lumaEndN = lumaEndN - lumaNN * 0.5;","            if(!doneP) lumaEndP = lumaEndP - lumaNN * 0.5;","            doneN = abs(lumaEndN) >= gradientScaled;","            doneP = abs(lumaEndP) >= gradientScaled;","            if(!doneN) posN.x -= offNP.x * FXAA_QUALITY_P9;","            if(!doneN) posN.y -= offNP.y * FXAA_QUALITY_P9;","            doneNP = (!doneN) || (!doneP);","            if(!doneP) posP.x += offNP.x * FXAA_QUALITY_P9;","            if(!doneP) posP.y += offNP.y * FXAA_QUALITY_P9;","/*--------------------------------------------------------------------------*/","            #if (FXAA_QUALITY_PS > 10)","            if(doneNP) {","                if(!doneN) lumaEndN = FxaaLuma(FxaaTexTop(tex, posN.xy));","                if(!doneP) lumaEndP = FxaaLuma(FxaaTexTop(tex, posP.xy));","                if(!doneN) lumaEndN = lumaEndN - lumaNN * 0.5;","                if(!doneP) lumaEndP = lumaEndP - lumaNN * 0.5;","                doneN = abs(lumaEndN) >= gradientScaled;","                doneP = abs(lumaEndP) >= gradientScaled;","                if(!doneN) posN.x -= offNP.x * FXAA_QUALITY_P10;","                if(!doneN) posN.y -= offNP.y * FXAA_QUALITY_P10;","                doneNP = (!doneN) || (!doneP);","                if(!doneP) posP.x += offNP.x * FXAA_QUALITY_P10;","                if(!doneP) posP.y += offNP.y * FXAA_QUALITY_P10;","/*--------------------------------------------------------------------------*/","                #if (FXAA_QUALITY_PS > 11)","                if(doneNP) {","                    if(!doneN) lumaEndN = FxaaLuma(FxaaTexTop(tex, posN.xy));","                    if(!doneP) lumaEndP = FxaaLuma(FxaaTexTop(tex, posP.xy));","                    if(!doneN) lumaEndN = lumaEndN - lumaNN * 0.5;","                    if(!doneP) lumaEndP = lumaEndP - lumaNN * 0.5;","                    doneN = abs(lumaEndN) >= gradientScaled;","                    doneP = abs(lumaEndP) >= gradientScaled;","                    if(!doneN) posN.x -= offNP.x * FXAA_QUALITY_P11;","                    if(!doneN) posN.y -= offNP.y * FXAA_QUALITY_P11;","                    doneNP = (!doneN) || (!doneP);","                    if(!doneP) posP.x += offNP.x * FXAA_QUALITY_P11;","                    if(!doneP) posP.y += offNP.y * FXAA_QUALITY_P11;","/*--------------------------------------------------------------------------*/","                    #if (FXAA_QUALITY_PS > 12)","                    if(doneNP) {","                        if(!doneN) lumaEndN = FxaaLuma(FxaaTexTop(tex, posN.xy));","                        if(!doneP) lumaEndP = FxaaLuma(FxaaTexTop(tex, posP.xy));","                        if(!doneN) lumaEndN = lumaEndN - lumaNN * 0.5;","                        if(!doneP) lumaEndP = lumaEndP - lumaNN * 0.5;","                        doneN = abs(lumaEndN) >= gradientScaled;","                        doneP = abs(lumaEndP) >= gradientScaled;","                        if(!doneN) posN.x -= offNP.x * FXAA_QUALITY_P12;","                        if(!doneN) posN.y -= offNP.y * FXAA_QUALITY_P12;","                        doneNP = (!doneN) || (!doneP);","                        if(!doneP) posP.x += offNP.x * FXAA_QUALITY_P12;","                        if(!doneP) posP.y += offNP.y * FXAA_QUALITY_P12;","/*--------------------------------------------------------------------------*/","                    }","                    #endif","/*--------------------------------------------------------------------------*/","                }","                #endif","/*--------------------------------------------------------------------------*/","            }","            #endif","/*--------------------------------------------------------------------------*/","        }","        #endif","/*--------------------------------------------------------------------------*/","    }","    #endif","/*--------------------------------------------------------------------------*/","                        }","                        #endif","/*--------------------------------------------------------------------------*/","                    }","                    #endif","/*--------------------------------------------------------------------------*/","                }","                #endif","/*--------------------------------------------------------------------------*/","            }","            #endif","/*--------------------------------------------------------------------------*/","        }","        #endif","/*--------------------------------------------------------------------------*/","    }","/*--------------------------------------------------------------------------*/","    FxaaFloat dstN = posM.x - posN.x;","    FxaaFloat dstP = posP.x - posM.x;","    if(!horzSpan) dstN = posM.y - posN.y;","    if(!horzSpan) dstP = posP.y - posM.y;","/*--------------------------------------------------------------------------*/","    FxaaBool goodSpanN = (lumaEndN < 0.0) != lumaMLTZero;","    FxaaFloat spanLength = (dstP + dstN);","    FxaaBool goodSpanP = (lumaEndP < 0.0) != lumaMLTZero;","    FxaaFloat spanLengthRcp = 1.0/spanLength;","/*--------------------------------------------------------------------------*/","    FxaaBool directionN = dstN < dstP;","    FxaaFloat dst = min(dstN, dstP);","    FxaaBool goodSpan = directionN ? goodSpanN : goodSpanP;","    FxaaFloat subpixG = subpixF * subpixF;","    FxaaFloat pixelOffset = (dst * (-spanLengthRcp)) + 0.5;","    FxaaFloat subpixH = subpixG * fxaaQualitySubpix;","/*--------------------------------------------------------------------------*/","    FxaaFloat pixelOffsetGood = goodSpan ? pixelOffset : 0.0;","    FxaaFloat pixelOffsetSubpix = max(pixelOffsetGood, subpixH);","    if(!horzSpan) posM.x += pixelOffsetSubpix * lengthSign;","    if( horzSpan) posM.y += pixelOffsetSubpix * lengthSign;","    #if (FXAA_DISCARD == 1)","        return FxaaTexTop(tex, posM);","    #else","        return FxaaFloat4(FxaaTexTop(tex, posM).xyz, lumaM);","    #endif","}","/*==========================================================================*/","#endif","","void main() {","  gl_FragColor = FxaaPixelShader(","    vUv,","    vec4(0.0),","    tDiffuse,","    tDiffuse,","    tDiffuse,","    resolution,","    vec4(0.0),","    vec4(0.0),","    vec4(0.0),","    0.75,","    0.166,","    0.0833,","    0.0,","    0.0,","    0.0,","    vec4(0.0)","  );","","  // TODO avoid querying texture twice for same texel","  gl_FragColor.a = texture2D(tDiffuse, vUv).a;","}"].join("\n")};/**
   * @author alteredq / http://alteredqualia.com/
   * @author MPanknin / http://www.redplant.de/
   * @author takahiro / https://github.com/takahirox
   *
   * WebGLDeferredRenderer supports two types of Deferred Renderings.
   * One is Classic Deferred Rendering and the other one is
   * Light Pre-Pass (Deferred Lighting).
   * Classic Deferred Rendering is default. You can use Light Pre-Pass
   * by calling .enableLightPrePass( true ) method.
   *
   * Dependencies
   *  - CopyShader
   *  - RenderPass
   *  - ShaderPass
   *  - EffectComposer
   *  - FXAAShader
   *
   * TODO
   *  - reuse existing glsl
   *  - shadow
   *  - optimization
   *  - MRT (when it's available on Three.js)
   *  - AmbientLight
   *  - HemisphereLight
   *  - PointLight (distance < 0)
   *  - morphNormals
   *  - BumpMap
   *  - ToneMap
   *  - envMap
   *  - wrapAround
   *  - addEffect
   */var DeferredShaderChunk={packVector3:["float vec3_to_float( vec3 data ) {","	const float unit = 255.0/256.0;","	highp float compressed = fract( data.x * unit ) + floor( data.y * unit * 255.0 ) + floor( data.z * unit * 255.0 ) * 255.0;","	return compressed;","}"].join("\n"),unpackFloat:["vec3 float_to_vec3( float data ) {","	const float unit = 255.0;","	vec3 uncompressed;","	uncompressed.x = fract( data );","	float zInt = floor( data / unit );","	uncompressed.z = fract( zInt / unit );","	uncompressed.y = fract( floor( data - ( zInt * unit ) ) / unit );","	return uncompressed;","}"].join("\n"),// Refer to http://aras-p.info/texts/CompactNormalStorage.html
  packNormal:["vec2 normal_to_vec2( vec3 normal ) {","	return normal.xy / sqrt( normal.z * 8.0 + 8.0 ) + 0.5;","}"].join("\n"),unpackVector2:["vec3 vec2_to_normal( vec2 data ) {","	vec2 fenc = data * 4.0 - 2.0;","	float f = dot( fenc, fenc );","	float g = sqrt( 1.0 - f / 4.0 );","	vec3 normal;","	normal.xy = fenc * g;","	normal.z = 1.0 - f / 2.0;","	return normal;","}"].join("\n"),computeTextureCoord:["vec2 texCoord = gl_FragCoord.xy / vec2( viewWidth, viewHeight );"].join("\n"),packNormalDepth:["vec4 packedNormalDepth;","packedNormalDepth.xyz = normal * 0.5 + 0.5;","packedNormalDepth.w = position.z / position.w;"].join("\n"),unpackNormalDepth:["vec4 normalDepthMap = texture2D( samplerNormalDepth, texCoord );","float depth = normalDepthMap.w;","if ( depth == 0.0 ) discard;","vec3 normal = normalDepthMap.xyz * 2.0 - 1.0;"].join("\n"),packNormalDepthShininess:["vec4 packedNormalDepthShininess;","packedNormalDepthShininess.xy = normal_to_vec2( normal );","packedNormalDepthShininess.z = shininess;","packedNormalDepthShininess.w = position.z / position.w;"].join("\n"),unpackNormalDepthShininess:["vec4 normalDepthMap = texture2D( samplerNormalDepthShininess, texCoord );","float depth = normalDepthMap.w;","if ( depth == 0.0 ) discard;","vec3 normal = vec2_to_normal( normalDepthMap.xy );","float shininess = normalDepthMap.z;"].join("\n"),packColor:["vec4 packedColor;","packedColor.x = vec3_to_float( diffuseColor.rgb );","packedColor.y = vec3_to_float( emissiveColor );","packedColor.z = vec3_to_float( specularColor );","packedColor.w = shininess;"].join("\n"),unpackColor:["vec4 colorMap = texture2D( samplerColor, texCoord );","vec3 diffuseColor = float_to_vec3( colorMap.x );","vec3 emissiveColor = float_to_vec3( colorMap.y );","vec3 specularColor = float_to_vec3( colorMap.z );","float shininess = colorMap.w;"].join("\n"),packLight:["vec4 packedLight;","packedLight.xyz = lightIntensity * lightColor * max( dot( lightVector, normal ), 0.0 ) * attenuation;","packedLight.w = lightIntensity * specular * max( dot( lightVector, normal ), 0.0 ) * attenuation;"].join("\n"),computeVertexPositionVS:["vec2 xy = texCoord * 2.0 - 1.0;","vec4 vertexPositionProjected = vec4( xy, depth, 1.0 );","vec4 vertexPositionVS = matProjInverse * vertexPositionProjected;","vertexPositionVS.xyz /= vertexPositionVS.w;","vertexPositionVS.w = 1.0;"].join("\n"),// TODO: calculate schlick
  computeSpecular:["vec3 halfVector = normalize( lightVector - normalize( vertexPositionVS.xyz ) );","float dotNormalHalf = max( dot( normal, halfVector ), 0.0 );","float specular = 0.31830988618 * ( shininess * 0.5 + 1.0 ) * pow( dotNormalHalf, shininess );"].join("\n"),combine:["gl_FragColor = vec4( lightIntensity * lightColor * max( dot( lightVector, normal ), 0.0 ) * ( diffuseColor + specular * specularColor ) * attenuation, 1.0 );"].join("\n")};var ShaderDeferredCommon={commonUniforms:{matProjInverse:new Uniform(new Matrix4()),viewWidth:new Uniform(800),viewHeight:new Uniform(600)}};var ShaderDeferred={normalDepth:{uniforms:{},vertexShader:["varying vec3 vNormal;","varying vec4 vPosition;","#include <morphtarget_pars_vertex>","#include <skinning_pars_vertex>","void main() {","#include <begin_vertex>","#include <beginnormal_vertex>","#include <skinbase_vertex>","#include <skinnormal_vertex>","#include <defaultnormal_vertex>","#include <morphtarget_vertex>","#include <skinning_vertex>","#include <project_vertex>","	vNormal = normalize( transformedNormal );","	vPosition = gl_Position;","}"].join("\n"),fragmentShader:["varying vec3 vNormal;","varying vec4 vPosition;","void main() {","	vec3 normal = vNormal;","	vec4 position = vPosition;",DeferredShaderChunk["packNormalDepth"],"	gl_FragColor = packedNormalDepth;","}"].join("\n")},color:{uniforms:{map:new Uniform(null),offsetRepeat:new Uniform(new Vector4$1(0,0,1,1)),diffuse:new Uniform(new Color$1(0x000000)),emissive:new Uniform(new Color$1(0x000000)),specular:new Uniform(new Color$1(0x000000)),shininess:new Uniform(30.0)},vertexShader:["#include <uv_pars_vertex>","#include <morphtarget_pars_vertex>","#include <skinning_pars_vertex>","void main() {","#include <uv_vertex>","#include <begin_vertex>","#include <beginnormal_vertex>","#include <skinbase_vertex>","#include <skinnormal_vertex>","#include <defaultnormal_vertex>","#include <morphtarget_vertex>","#include <skinning_vertex>","#include <project_vertex>","}"].join("\n"),fragmentShader:["uniform vec3 diffuse;","uniform vec3 emissive;","uniform vec3 specular;","uniform float shininess;","#include <uv_pars_fragment>","#include <map_pars_fragment>",DeferredShaderChunk["packVector3"],"void main() {","	vec4 diffuseColor = vec4( diffuse, 1.0 );","	vec3 emissiveColor = emissive;","	vec3 specularColor = specular;","#include <map_fragment>",DeferredShaderChunk["packColor"],"	gl_FragColor = packedColor;","}"].join("\n")},emissiveLight:{uniforms:Object.assign({samplerColor:new Uniform(null)},ShaderDeferredCommon['commonUniforms']),vertexShader:["void main() { ","	gl_Position = vec4( sign( position.xy ), 0.0, 1.0 );","}"].join('\n'),fragmentShader:["uniform sampler2D samplerColor;","uniform float viewHeight;","uniform float viewWidth;",DeferredShaderChunk["unpackFloat"],"void main() {",DeferredShaderChunk["computeTextureCoord"],DeferredShaderChunk["unpackColor"],"	gl_FragColor = vec4( emissiveColor, 1.0 );","}"].join('\n')},pointLight:{uniforms:Object.assign({samplerNormalDepth:new Uniform(null),samplerColor:new Uniform(null),lightColor:new Uniform(new Color$1(0x000000)),lightPositionVS:new Uniform(new Vector3$1(0,1,0)),lightIntensity:new Uniform(1.0),lightRadius:new Uniform(1.0)},ShaderDeferredCommon['commonUniforms']),vertexShader:["void main() {","	gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),fragmentShader:["uniform sampler2D samplerNormalDepth;","uniform sampler2D samplerColor;","uniform float viewHeight;","uniform float viewWidth;","uniform vec3 lightColor;","uniform vec3 lightPositionVS;","uniform float lightIntensity;","uniform float lightRadius;","uniform mat4 matProjInverse;",DeferredShaderChunk["unpackFloat"],"void main() {",DeferredShaderChunk["computeTextureCoord"],DeferredShaderChunk["unpackNormalDepth"],DeferredShaderChunk["computeVertexPositionVS"],"	vec3 lightVector = lightPositionVS - vertexPositionVS.xyz;","	float distance = length( lightVector );","	if ( distance > lightRadius ) discard;","	lightVector = normalize( lightVector );",DeferredShaderChunk["unpackColor"],DeferredShaderChunk["computeSpecular"],"	//float cutoff = 0.3;","	//float denom = distance / lightRadius + 1.0;","	//float attenuation = 1.0 / ( denom * denom );","	//attenuation = ( attenuation - cutoff ) / ( 1.0 - cutoff );","	//attenuation = max( attenuation, 0.0 );","	//attenuation *= attenuation;","	//diffuseColor *= saturate( -distance / lightRadius + 1.0 );","	//float attenuation = 1.0;","	float attenuation = saturate( -distance / lightRadius + 1.0 );",DeferredShaderChunk["combine"],"}"].join("\n")},spotLight:{uniforms:Object.assign({samplerNormalDepth:new Uniform(null),samplerColor:new Uniform(null),lightColor:new Uniform(new Color$1(0x000000)),lightDirectionVS:new Uniform(new Vector3$1(0,1,0)),lightPositionVS:new Uniform(new Vector3$1(0,1,0)),lightAngle:new Uniform(1.0),lightIntensity:new Uniform(1.0)},ShaderDeferredCommon['commonUniforms']),vertexShader:["void main() { ","	gl_Position = vec4( sign( position.xy ), 0.0, 1.0 );","}"].join("\n"),fragmentShader:["uniform sampler2D samplerNormalDepth;","uniform sampler2D samplerColor;","uniform float viewHeight;","uniform float viewWidth;","uniform vec3 lightColor;","uniform vec3 lightPositionVS;","uniform vec3 lightDirectionVS;","uniform float lightAngle;","uniform float lightIntensity;","uniform mat4 matProjInverse;",DeferredShaderChunk["unpackFloat"],"void main() {",DeferredShaderChunk["computeTextureCoord"],DeferredShaderChunk["unpackNormalDepth"],DeferredShaderChunk["computeVertexPositionVS"],DeferredShaderChunk["unpackColor"],"	vec3 lightVector = normalize( lightPositionVS.xyz - vertexPositionVS.xyz );","	float rho = dot( lightDirectionVS, lightVector );","	float rhoMax = cos( lightAngle );","	if ( rho <= rhoMax ) discard;","	float theta = rhoMax + 0.0001;","	float phi = rhoMax + 0.05;","	float falloff = 4.0;","	float spot = 0.0;","	if ( rho >= phi ) {","		spot = 1.0;","	} else if ( rho <= theta ) {","		spot = 0.0;","	} else { ","		spot = pow( ( rho - theta ) / ( phi - theta ), falloff );","	}","	diffuseColor *= spot;",DeferredShaderChunk["computeSpecular"],"	const float attenuation = 1.0;",DeferredShaderChunk["combine"],"}"].join("\n")},directionalLight:{uniforms:Object.assign({samplerNormalDepth:new Uniform(null),samplerColor:new Uniform(null),lightColor:new Uniform(new Color$1(0x000000)),lightDirectionVS:new Uniform(new Vector3$1(0,1,0)),lightIntensity:new Uniform(1.0)},ShaderDeferredCommon['commonUniforms']),vertexShader:["void main() { ","	gl_Position = vec4( sign( position.xy ), 0.0, 1.0 );","}"].join('\n'),fragmentShader:["uniform sampler2D samplerNormalDepth;","uniform sampler2D samplerColor;","uniform float viewHeight;","uniform float viewWidth;","uniform vec3 lightColor;","uniform vec3 lightDirectionVS;","uniform float lightIntensity;","uniform mat4 matProjInverse;",DeferredShaderChunk["unpackFloat"],"void main() {",DeferredShaderChunk["computeTextureCoord"],DeferredShaderChunk["unpackNormalDepth"],DeferredShaderChunk["computeVertexPositionVS"],DeferredShaderChunk["unpackColor"],"	vec3 lightVector = normalize( lightDirectionVS );",DeferredShaderChunk["computeSpecular"],"	const float attenuation = 1.0;",DeferredShaderChunk["combine"],"}"].join('\n')},normalDepthShininess:{uniforms:{shininess:new Uniform(30.0)},vertexShader:["varying vec3 vNormal;","varying vec4 vPosition;","#include <morphtarget_pars_vertex>","#include <skinning_pars_vertex>","void main() {","#include <begin_vertex>","#include <beginnormal_vertex>","#include <skinbase_vertex>","#include <skinnormal_vertex>","#include <defaultnormal_vertex>","#include <morphtarget_vertex>","#include <skinning_vertex>","#include <project_vertex>","	vNormal = normalize( transformedNormal );","	vPosition = gl_Position;","}"].join("\n"),fragmentShader:["varying vec3 vNormal;","varying vec4 vPosition;","uniform float shininess;",DeferredShaderChunk["packNormal"],"void main() {","	vec3 normal = vNormal;","	vec4 position = vPosition;",DeferredShaderChunk["packNormalDepthShininess"],"	gl_FragColor = packedNormalDepthShininess;","}"].join("\n")},pointLightPre:{uniforms:Object.assign({samplerNormalDepthShininess:new Uniform(null),lightColor:new Uniform(new Color$1(0x000000)),lightPositionVS:new Uniform(new Vector3$1(0,1,0)),lightIntensity:new Uniform(1.0),lightRadius:new Uniform(1.0)},ShaderDeferredCommon['commonUniforms']),vertexShader:["void main() {","	gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),fragmentShader:["uniform sampler2D samplerNormalDepthShininess;","uniform float viewHeight;","uniform float viewWidth;","uniform vec3 lightColor;","uniform vec3 lightPositionVS;","uniform float lightIntensity;","uniform float lightRadius;","uniform mat4 matProjInverse;",DeferredShaderChunk["unpackFloat"],DeferredShaderChunk["unpackVector2"],"void main() {",DeferredShaderChunk["computeTextureCoord"],DeferredShaderChunk["unpackNormalDepthShininess"],DeferredShaderChunk["computeVertexPositionVS"],"	vec3 lightVector = lightPositionVS - vertexPositionVS.xyz;","	float distance = length( lightVector );","	if ( distance > lightRadius ) discard;","	lightVector = normalize( lightVector );",DeferredShaderChunk["computeSpecular"],"	float attenuation = saturate( -distance / lightRadius + 1.0 );",DeferredShaderChunk["packLight"],"	gl_FragColor = packedLight;","}"].join("\n")},spotLightPre:{uniforms:Object.assign({samplerNormalDepthShininess:new Uniform(null),lightColor:new Uniform(new Color$1(0x000000)),lightDirectionVS:new Uniform(new Vector3$1(0,1,0)),lightPositionVS:new Uniform(new Vector3$1(0,1,0)),lightAngle:new Uniform(1.0),lightIntensity:new Uniform(1.0)},ShaderDeferredCommon['commonUniforms']),vertexShader:["void main() { ","	gl_Position = vec4( sign( position.xy ), 0.0, 1.0 );","}"].join("\n"),fragmentShader:["uniform sampler2D samplerNormalDepthShininess;","uniform float viewHeight;","uniform float viewWidth;","uniform vec3 lightColor;","uniform vec3 lightPositionVS;","uniform vec3 lightDirectionVS;","uniform float lightAngle;","uniform float lightIntensity;","uniform mat4 matProjInverse;",DeferredShaderChunk["unpackFloat"],DeferredShaderChunk["unpackVector2"],"void main() {",DeferredShaderChunk["computeTextureCoord"],DeferredShaderChunk["unpackNormalDepthShininess"],DeferredShaderChunk["computeVertexPositionVS"],"	vec3 lightVector = normalize( lightPositionVS.xyz - vertexPositionVS.xyz );","	float rho = dot( lightDirectionVS, lightVector );","	float rhoMax = cos( lightAngle );","	if ( rho <= rhoMax ) discard;","	float theta = rhoMax + 0.0001;","	float phi = rhoMax + 0.05;","	float falloff = 4.0;","	float spot = 0.0;","	if ( rho >= phi ) {","		spot = 1.0;","	} else if ( rho <= theta ) {","		spot = 0.0;","	} else { ","		spot = pow( ( rho - theta ) / ( phi - theta ), falloff );","	}",DeferredShaderChunk["computeSpecular"],"	const float attenuation = 1.0;",DeferredShaderChunk["packLight"],"	gl_FragColor = spot * packedLight;","}"].join("\n")},directionalLightPre:{uniforms:Object.assign({samplerNormalDepthShininess:new Uniform(null),lightColor:new Uniform(new Color$1(0x000000)),lightDirectionVS:new Uniform(new Vector3$1(0,1,0)),lightIntensity:new Uniform(1.0)},ShaderDeferredCommon['commonUniforms']),vertexShader:["void main() { ","	gl_Position = vec4( sign( position.xy ), 0.0, 1.0 );","}"].join('\n'),fragmentShader:["uniform sampler2D samplerNormalDepthShininess;","uniform float viewHeight;","uniform float viewWidth;","uniform vec3 lightColor;","uniform vec3 lightDirectionVS;","uniform float lightIntensity;","uniform mat4 matProjInverse;",DeferredShaderChunk["unpackFloat"],DeferredShaderChunk["unpackVector2"],"void main() {",DeferredShaderChunk["computeTextureCoord"],DeferredShaderChunk["unpackNormalDepthShininess"],DeferredShaderChunk["computeVertexPositionVS"],"	vec3 lightVector = normalize( lightDirectionVS );",DeferredShaderChunk["computeSpecular"],"	const float attenuation = 1.0;",DeferredShaderChunk["packLight"],"	gl_FragColor = packedLight;","}"].join('\n')},reconstruction:{uniforms:Object.assign({samplerLight:new Uniform(null),map:new Uniform(null),offsetRepeat:new Uniform(new Vector4$1(0,0,1,1)),diffuse:new Uniform(new Color$1(0x000000)),emissive:new Uniform(new Color$1(0x000000)),specular:new Uniform(new Color$1(0x000000)),shininess:new Uniform(30.0)},ShaderDeferredCommon['commonUniforms']),vertexShader:["#include <uv_pars_vertex>","#include <morphtarget_pars_vertex>","#include <skinning_pars_vertex>","void main() {","#include <uv_vertex>","#include <begin_vertex>","#include <beginnormal_vertex>","#include <skinbase_vertex>","#include <skinnormal_vertex>","#include <defaultnormal_vertex>","#include <morphtarget_vertex>","#include <skinning_vertex>","#include <project_vertex>","}"].join("\n"),fragmentShader:["uniform sampler2D samplerLight;","uniform vec3 diffuse;","uniform vec3 emissive;","uniform vec3 specular;","uniform float shininess;","uniform float viewHeight;","uniform float viewWidth;","#include <uv_pars_fragment>","#include <map_pars_fragment>",DeferredShaderChunk["unpackFloat"],"void main() {","	vec4 diffuseColor = vec4( diffuse, 1.0 );","	vec3 emissiveColor = emissive;","	vec3 specularColor = specular;",DeferredShaderChunk["computeTextureCoord"],"	vec4 light = texture2D( samplerLight, texCoord );","#include <map_fragment>","	vec3 diffuseFinal = diffuseColor.rgb * light.rgb;","	vec3 emissiveFinal = emissiveColor;","	vec3 specularFinal = specularColor * light.rgb * light.a;","	gl_FragColor = vec4( diffuseFinal + emissiveFinal + specularFinal, 1.0 );","}"].join("\n")},// TODO: implement tone mapping
  final:{uniforms:{samplerResult:new Uniform(null)},vertexShader:["varying vec2 texCoord;","void main() {","	vec4 pos = vec4( sign( position.xy ), 0.0, 1.0 );","	texCoord = pos.xy * vec2( 0.5 ) + 0.5;","	gl_Position = pos;","}"].join("\n"),fragmentShader:["varying vec2 texCoord;","uniform sampler2D samplerResult;","void main() {","	gl_FragColor = texture2D( samplerResult, texCoord );","}"].join("\n")}};/**
   * @author huwb / http://huwbowles.com/
   *
   * God-rays (crepuscular rays)
   *
   * Similar implementation to the one used by Crytek for CryEngine 2 [Sousa2008].
   * Blurs a mask generated from the depth map along radial lines emanating from the light
   * source. The blur repeatedly applies a blur filter of increasing support but constant
   * sample count to produce a blur filter with large support.
   *
   * My implementation performs 3 passes, similar to the implementation from Sousa. I found
   * just 6 samples per pass produced acceptible results. The blur is applied three times,
   * with decreasing filter support. The result is equivalent to a single pass with
   * 6*6*6 = 216 samples.
   *
   * References:
   *
   * Sousa2008 - Crysis Next Gen Effects, GDC2008, http://www.crytek.com/sites/default/files/GDC08_SousaT_CrysisEffects.ppt
   */var ShaderGodRays={/**
  	 * The god-ray generation shader.
  	 *
  	 * First pass:
  	 *
  	 * The input is the depth map. I found that the output from the
  	 * MeshDepthMaterial material was directly suitable without
  	 * requiring any treatment whatsoever.
  	 *
  	 * The depth map is blurred along radial lines towards the "sun". The
  	 * output is written to a temporary render target (I used a 1/4 sized
  	 * target).
  	 *
  	 * Pass two & three:
  	 *
  	 * The results of the previous pass are re-blurred, each time with a
  	 * decreased distance between samples.
  	 */'godrays_generate':{uniforms:{tInput:{value:null},fStepSize:{value:1.0},vSunPositionScreenSpace:{value:new Vector2$1(0.5,0.5)}},vertexShader:["varying vec2 vUv;","void main() {","vUv = uv;","gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),fragmentShader:["#define TAPS_PER_PASS 6.0","varying vec2 vUv;","uniform sampler2D tInput;","uniform vec2 vSunPositionScreenSpace;","uniform float fStepSize;",// filter step size
  "void main() {",// delta from current pixel to "sun" position
  "vec2 delta = vSunPositionScreenSpace - vUv;","float dist = length( delta );",// Step vector (uv space)
  "vec2 stepv = fStepSize * delta / dist;",// Number of iterations between pixel and sun
  "float iters = dist/fStepSize;","vec2 uv = vUv.xy;","float col = 0.0;",// This breaks ANGLE in Chrome 22
  //	- see http://code.google.com/p/chromium/issues/detail?id=153105
  /*
  				// Unrolling didnt do much on my hardware (ATI Mobility Radeon 3450),
  				// so i've just left the loop

  				"for ( float i = 0.0; i < TAPS_PER_PASS; i += 1.0 ) {",

  					// Accumulate samples, making sure we dont walk past the light source.

  					// The check for uv.y < 1 would not be necessary with "border" UV wrap
  					// mode, with a black border colour. I don't think this is currently
  					// exposed by three.js. As a result there might be artifacts when the
  					// sun is to the left, right or bottom of screen as these cases are
  					// not specifically handled.

  					"col += ( i <= iters && uv.y < 1.0 ? texture2D( tInput, uv ).r : 0.0 );",
  					"uv += stepv;",

  				"}",
  				*/// Unrolling loop manually makes it work in ANGLE
  "if ( 0.0 <= iters && uv.y < 1.0 ) col += texture2D( tInput, uv ).r;","uv += stepv;","if ( 1.0 <= iters && uv.y < 1.0 ) col += texture2D( tInput, uv ).r;","uv += stepv;","if ( 2.0 <= iters && uv.y < 1.0 ) col += texture2D( tInput, uv ).r;","uv += stepv;","if ( 3.0 <= iters && uv.y < 1.0 ) col += texture2D( tInput, uv ).r;","uv += stepv;","if ( 4.0 <= iters && uv.y < 1.0 ) col += texture2D( tInput, uv ).r;","uv += stepv;","if ( 5.0 <= iters && uv.y < 1.0 ) col += texture2D( tInput, uv ).r;","uv += stepv;",// Should technically be dividing by 'iters', but 'TAPS_PER_PASS' smooths out
  // objectionable artifacts, in particular near the sun position. The side
  // effect is that the result is darker than it should be around the sun, as
  // TAPS_PER_PASS is greater than the number of samples actually accumulated.
  // When the result is inverted (in the shader 'godrays_combine', this produces
  // a slight bright spot at the position of the sun, even when it is occluded.
  "gl_FragColor = vec4( col/TAPS_PER_PASS );","gl_FragColor.a = 1.0;","}"].join("\n")},/**
  	 * Additively applies god rays from texture tGodRays to a background (tColors).
  	 * fGodRayIntensity attenuates the god rays.
  	 */'godrays_combine':{uniforms:{tColors:{value:null},tGodRays:{value:null},fGodRayIntensity:{value:0.69},vSunPositionScreenSpace:{value:new Vector2$1(0.5,0.5)}},vertexShader:["varying vec2 vUv;","void main() {","vUv = uv;","gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),fragmentShader:["varying vec2 vUv;","uniform sampler2D tColors;","uniform sampler2D tGodRays;","uniform vec2 vSunPositionScreenSpace;","uniform float fGodRayIntensity;","void main() {",// Since MeshDepthMaterial renders foreground objects white and background
  // objects black, the god-rays will be white streaks. Therefore value is inverted
  // before being combined with tColors
  "gl_FragColor = texture2D( tColors, vUv ) + fGodRayIntensity * vec4( 1.0 - texture2D( tGodRays, vUv ).r );","gl_FragColor.a = 1.0;","}"].join("\n")},/**
  	 * A dodgy sun/sky shader. Makes a bright spot at the sun location. Would be
  	 * cheaper/faster/simpler to implement this as a simple sun sprite.
  	 */'godrays_fake_sun':{uniforms:{vSunPositionScreenSpace:{value:new Vector2$1(0.5,0.5)},fAspect:{value:1.0},sunColor:{value:new Color$1(0xffee00)},bgColor:{value:new Color$1(0x000000)}},vertexShader:["varying vec2 vUv;","void main() {","vUv = uv;","gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),fragmentShader:["varying vec2 vUv;","uniform vec2 vSunPositionScreenSpace;","uniform float fAspect;","uniform vec3 sunColor;","uniform vec3 bgColor;","void main() {","vec2 diff = vUv - vSunPositionScreenSpace;",// Correct for aspect ratio
  "diff.x *= fAspect;","float prop = clamp( length( diff ) / 0.5, 0.0, 1.0 );","prop = 0.35 * pow( 1.0 - prop, 3.0 );","gl_FragColor.xyz = mix( sunColor, bgColor, 1.0 - prop );","gl_FragColor.w = 1.0;","}"].join("\n")}};/**
   * @author mrdoob / http://www.mrdoob.com
   *
   * Simple test shader
   */var BasicShader={uniforms:{},vertexShader:["void main() {","gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),fragmentShader:["void main() {","gl_FragColor = vec4( 1.0, 0.0, 0.0, 0.5 );","}"].join("\n")};/**
   * @author alteredq / http://alteredqualia.com/
   *
   * Bleach bypass shader [http://en.wikipedia.org/wiki/Bleach_bypass]
   * - based on Nvidia example
   * http://developer.download.nvidia.com/shaderlibrary/webpages/shader_library.html#post_bleach_bypass
   */var BleachBypassShader={uniforms:{"tDiffuse":{value:null},"opacity":{value:1.0}},vertexShader:["varying vec2 vUv;","void main() {","vUv = uv;","gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),fragmentShader:["uniform float opacity;","uniform sampler2D tDiffuse;","varying vec2 vUv;","void main() {","vec4 base = texture2D( tDiffuse, vUv );","vec3 lumCoeff = vec3( 0.25, 0.65, 0.1 );","float lum = dot( lumCoeff, base.rgb );","vec3 blend = vec3( lum );","float L = min( 1.0, max( 0.0, 10.0 * ( lum - 0.45 ) ) );","vec3 result1 = 2.0 * base.rgb * blend;","vec3 result2 = 1.0 - 2.0 * ( 1.0 - blend ) * ( 1.0 - base.rgb );","vec3 newColor = mix( result1, result2, L );","float A2 = opacity * base.a;","vec3 mixRGB = A2 * newColor.rgb;","mixRGB += ( ( 1.0 - A2 ) * base.rgb );","gl_FragColor = vec4( mixRGB, base.a );","}"].join("\n")};/**
   * @author alteredq / http://alteredqualia.com/
   *
   * Blend two textures
   */var BlendShader={uniforms:{"tDiffuse1":{value:null},"tDiffuse2":{value:null},"mixRatio":{value:0.5},"opacity":{value:1.0}},vertexShader:["varying vec2 vUv;","void main() {","vUv = uv;","gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),fragmentShader:["uniform float opacity;","uniform float mixRatio;","uniform sampler2D tDiffuse1;","uniform sampler2D tDiffuse2;","varying vec2 vUv;","void main() {","vec4 texel1 = texture2D( tDiffuse1, vUv );","vec4 texel2 = texture2D( tDiffuse2, vUv );","gl_FragColor = opacity * mix( texel1, texel2, mixRatio );","}"].join("\n")};/**
   * @author tapio / http://tapio.github.com/
   *
   * Brightness and contrast adjustment
   * https://github.com/evanw/glfx.js
   * brightness: -1 to 1 (-1 is solid black, 0 is no change, and 1 is solid white)
   * contrast: -1 to 1 (-1 is solid gray, 0 is no change, and 1 is maximum contrast)
   */var BrightnessContrastShader={uniforms:{"tDiffuse":{value:null},"brightness":{value:0},"contrast":{value:0}},vertexShader:["varying vec2 vUv;","void main() {","vUv = uv;","gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),fragmentShader:["uniform sampler2D tDiffuse;","uniform float brightness;","uniform float contrast;","varying vec2 vUv;","void main() {","gl_FragColor = texture2D( tDiffuse, vUv );","gl_FragColor.rgb += brightness;","if (contrast > 0.0) {","gl_FragColor.rgb = (gl_FragColor.rgb - 0.5) / (1.0 - contrast) + 0.5;","} else {","gl_FragColor.rgb = (gl_FragColor.rgb - 0.5) * (1.0 + contrast) + 0.5;","}","}"].join("\n")};/**
   * @author alteredq / http://alteredqualia.com/
   *
   * Color correction
   */var ColorCorrectionShader={uniforms:{"tDiffuse":{value:null},"powRGB":{value:new Vector3$1(2,2,2)},"mulRGB":{value:new Vector3$1(1,1,1)},"addRGB":{value:new Vector3$1(0,0,0)}},vertexShader:["varying vec2 vUv;","void main() {","vUv = uv;","gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),fragmentShader:["uniform sampler2D tDiffuse;","uniform vec3 powRGB;","uniform vec3 mulRGB;","uniform vec3 addRGB;","varying vec2 vUv;","void main() {","gl_FragColor = texture2D( tDiffuse, vUv );","gl_FragColor.rgb = mulRGB * pow( ( gl_FragColor.rgb + addRGB ), powRGB );","}"].join("\n")};/**
   * @author alteredq / http://alteredqualia.com/
   *
   * Colorify shader
   */var ColorifyShader={uniforms:{"tDiffuse":{value:null},"color":{value:new Color$1(0xffffff)}},vertexShader:["varying vec2 vUv;","void main() {","vUv = uv;","gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),fragmentShader:["uniform vec3 color;","uniform sampler2D tDiffuse;","varying vec2 vUv;","void main() {","vec4 texel = texture2D( tDiffuse, vUv );","vec3 luma = vec3( 0.299, 0.587, 0.114 );","float v = dot( texel.xyz, luma );","gl_FragColor = vec4( v * color, texel.w );","}"].join("\n")};/**
   * @author alteredq / http://alteredqualia.com/
   *
   * Depth-of-field shader using mipmaps
   * - from Matt Handley @applmak
   * - requires power-of-2 sized render target with enabled mipmaps
   */var DOFMipMapShader={uniforms:{"tColor":{value:null},"tDepth":{value:null},"focus":{value:1.0},"maxblur":{value:1.0}},vertexShader:["varying vec2 vUv;","void main() {","vUv = uv;","gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),fragmentShader:["uniform float focus;","uniform float maxblur;","uniform sampler2D tColor;","uniform sampler2D tDepth;","varying vec2 vUv;","void main() {","vec4 depth = texture2D( tDepth, vUv );","float factor = depth.x - focus;","vec4 col = texture2D( tColor, vUv, 2.0 * maxblur * abs( focus - depth.x ) );","gl_FragColor = col;","gl_FragColor.a = 1.0;","}"].join("\n")};/**
   * @author alteredq / http://alteredqualia.com/
   *
   * Focus shader
   * based on PaintEffect postprocess from ro.me
   * http://code.google.com/p/3-dreams-of-black/source/browse/deploy/js/effects/PaintEffect.js
   */var FocusShader={uniforms:{"tDiffuse":{value:null},"screenWidth":{value:1024},"screenHeight":{value:1024},"sampleDistance":{value:0.94},"waveFactor":{value:0.00125}},vertexShader:["varying vec2 vUv;","void main() {","vUv = uv;","gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),fragmentShader:["uniform float screenWidth;","uniform float screenHeight;","uniform float sampleDistance;","uniform float waveFactor;","uniform sampler2D tDiffuse;","varying vec2 vUv;","void main() {","vec4 color, org, tmp, add;","float sample_dist, f;","vec2 vin;","vec2 uv = vUv;","add = color = org = texture2D( tDiffuse, uv );","vin = ( uv - vec2( 0.5 ) ) * vec2( 1.4 );","sample_dist = dot( vin, vin ) * 2.0;","f = ( waveFactor * 100.0 + sample_dist ) * sampleDistance * 4.0;","vec2 sampleSize = vec2(  1.0 / screenWidth, 1.0 / screenHeight ) * vec2( f );","add += tmp = texture2D( tDiffuse, uv + vec2( 0.111964, 0.993712 ) * sampleSize );","if( tmp.b < color.b ) color = tmp;","add += tmp = texture2D( tDiffuse, uv + vec2( 0.846724, 0.532032 ) * sampleSize );","if( tmp.b < color.b ) color = tmp;","add += tmp = texture2D( tDiffuse, uv + vec2( 0.943883, -0.330279 ) * sampleSize );","if( tmp.b < color.b ) color = tmp;","add += tmp = texture2D( tDiffuse, uv + vec2( 0.330279, -0.943883 ) * sampleSize );","if( tmp.b < color.b ) color = tmp;","add += tmp = texture2D( tDiffuse, uv + vec2( -0.532032, -0.846724 ) * sampleSize );","if( tmp.b < color.b ) color = tmp;","add += tmp = texture2D( tDiffuse, uv + vec2( -0.993712, -0.111964 ) * sampleSize );","if( tmp.b < color.b ) color = tmp;","add += tmp = texture2D( tDiffuse, uv + vec2( -0.707107, 0.707107 ) * sampleSize );","if( tmp.b < color.b ) color = tmp;","color = color * vec4( 2.0 ) - ( add / vec4( 8.0 ) );","color = color + ( add / vec4( 8.0 ) - color ) * ( vec4( 1.0 ) - vec4( sample_dist * 0.5 ) );","gl_FragColor = vec4( color.rgb * color.rgb * vec3( 0.95 ) + color.rgb, 1.0 );","}"].join("\n")};/**
   * @author zz85 / https://github.com/zz85 | https://www.lab4games.net/zz85/blog
   *
   * Edge Detection Shader using Frei-Chen filter
   * Based on http://rastergrid.com/blog/2011/01/frei-chen-edge-detector
   *
   * aspect: vec2 of (1/width, 1/height)
   */var FreiChenShader={uniforms:{"tDiffuse":{value:null},"aspect":{value:new Vector2$1(512,512)}},vertexShader:["varying vec2 vUv;","void main() {","vUv = uv;","gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),fragmentShader:["uniform sampler2D tDiffuse;","varying vec2 vUv;","uniform vec2 aspect;","vec2 texel = vec2(1.0 / aspect.x, 1.0 / aspect.y);","mat3 G[9];",// hard coded matrix values!!!! as suggested in https://github.com/neilmendoza/ofxPostProcessing/blob/master/src/EdgePass.cpp#L45
  "const mat3 g0 = mat3( 0.3535533845424652, 0, -0.3535533845424652, 0.5, 0, -0.5, 0.3535533845424652, 0, -0.3535533845424652 );","const mat3 g1 = mat3( 0.3535533845424652, 0.5, 0.3535533845424652, 0, 0, 0, -0.3535533845424652, -0.5, -0.3535533845424652 );","const mat3 g2 = mat3( 0, 0.3535533845424652, -0.5, -0.3535533845424652, 0, 0.3535533845424652, 0.5, -0.3535533845424652, 0 );","const mat3 g3 = mat3( 0.5, -0.3535533845424652, 0, -0.3535533845424652, 0, 0.3535533845424652, 0, 0.3535533845424652, -0.5 );","const mat3 g4 = mat3( 0, -0.5, 0, 0.5, 0, 0.5, 0, -0.5, 0 );","const mat3 g5 = mat3( -0.5, 0, 0.5, 0, 0, 0, 0.5, 0, -0.5 );","const mat3 g6 = mat3( 0.1666666716337204, -0.3333333432674408, 0.1666666716337204, -0.3333333432674408, 0.6666666865348816, -0.3333333432674408, 0.1666666716337204, -0.3333333432674408, 0.1666666716337204 );","const mat3 g7 = mat3( -0.3333333432674408, 0.1666666716337204, -0.3333333432674408, 0.1666666716337204, 0.6666666865348816, 0.1666666716337204, -0.3333333432674408, 0.1666666716337204, -0.3333333432674408 );","const mat3 g8 = mat3( 0.3333333432674408, 0.3333333432674408, 0.3333333432674408, 0.3333333432674408, 0.3333333432674408, 0.3333333432674408, 0.3333333432674408, 0.3333333432674408, 0.3333333432674408 );","void main(void)","{","G[0] = g0,","G[1] = g1,","G[2] = g2,","G[3] = g3,","G[4] = g4,","G[5] = g5,","G[6] = g6,","G[7] = g7,","G[8] = g8;","mat3 I;","float cnv[9];","vec3 sample;",/* fetch the 3x3 neighbourhood and use the RGB vector's length as intensity value */"for (float i=0.0; i<3.0; i++) {","for (float j=0.0; j<3.0; j++) {","sample = texture2D(tDiffuse, vUv + texel * vec2(i-1.0,j-1.0) ).rgb;","I[int(i)][int(j)] = length(sample);","}","}",/* calculate the convolution values for all the masks */"for (int i=0; i<9; i++) {","float dp3 = dot(G[i][0], I[0]) + dot(G[i][1], I[1]) + dot(G[i][2], I[2]);","cnv[i] = dp3 * dp3;","}","float M = (cnv[0] + cnv[1]) + (cnv[2] + cnv[3]);","float S = (cnv[4] + cnv[5]) + (cnv[6] + cnv[7]) + (cnv[8] + M);","gl_FragColor = vec4(vec3(sqrt(M/S)), 1.0);","}"].join("\n")};/**
   * @author alteredq / http://alteredqualia.com/
   *
   * Based on Nvidia Cg tutorial
   */var FresnelShader={uniforms:{"mRefractionRatio":{value:1.02},"mFresnelBias":{value:0.1},"mFresnelPower":{value:2.0},"mFresnelScale":{value:1.0},"tCube":{value:null}},vertexShader:["uniform float mRefractionRatio;","uniform float mFresnelBias;","uniform float mFresnelScale;","uniform float mFresnelPower;","varying vec3 vReflect;","varying vec3 vRefract[3];","varying float vReflectionFactor;","void main() {","vec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );","vec4 worldPosition = modelMatrix * vec4( position, 1.0 );","vec3 worldNormal = normalize( mat3( modelMatrix[0].xyz, modelMatrix[1].xyz, modelMatrix[2].xyz ) * normal );","vec3 I = worldPosition.xyz - cameraPosition;","vReflect = reflect( I, worldNormal );","vRefract[0] = refract( normalize( I ), worldNormal, mRefractionRatio );","vRefract[1] = refract( normalize( I ), worldNormal, mRefractionRatio * 0.99 );","vRefract[2] = refract( normalize( I ), worldNormal, mRefractionRatio * 0.98 );","vReflectionFactor = mFresnelBias + mFresnelScale * pow( 1.0 + dot( normalize( I ), worldNormal ), mFresnelPower );","gl_Position = projectionMatrix * mvPosition;","}"].join("\n"),fragmentShader:["uniform samplerCube tCube;","varying vec3 vReflect;","varying vec3 vRefract[3];","varying float vReflectionFactor;","void main() {","vec4 reflectedColor = textureCube( tCube, vec3( -vReflect.x, vReflect.yz ) );","vec4 refractedColor = vec4( 1.0 );","refractedColor.r = textureCube( tCube, vec3( -vRefract[0].x, vRefract[0].yz ) ).r;","refractedColor.g = textureCube( tCube, vec3( -vRefract[1].x, vRefract[1].yz ) ).g;","refractedColor.b = textureCube( tCube, vec3( -vRefract[2].x, vRefract[2].yz ) ).b;","gl_FragColor = mix( refractedColor, reflectedColor, clamp( vReflectionFactor, 0.0, 1.0 ) );","}"].join("\n")};/**
   * @author WestLangley / http://github.com/WestLangley
   *
   * Gamma Correction Shader
   * http://en.wikipedia.org/wiki/gamma_correction
   */var GammaCorrectionShader={uniforms:{"tDiffuse":{value:null}},vertexShader:["varying vec2 vUv;","void main() {","vUv = uv;","gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),fragmentShader:["uniform sampler2D tDiffuse;","varying vec2 vUv;","void main() {","vec4 tex = texture2D( tDiffuse, vec2( vUv.x, vUv.y ) );","gl_FragColor = LinearToGamma( tex, float( GAMMA_FACTOR ) );","}"].join("\n")};/**
   * @author zz85 / http://www.lab4games.net/zz85/blog
   *
   * Two pass Gaussian blur filter (horizontal and vertical blur shaders)
   * - described in http://www.gamerendering.com/2008/10/11/gaussian-blur-filter-shader/
   *   and used in http://www.cake23.de/traveling-wavefronts-lit-up.html
   *
   * - 9 samples per pass
   * - standard deviation 2.7
   * - "h" and "v" parameters should be set to "1 / width" and "1 / height"
   */var HorizontalBlurShader={uniforms:{"tDiffuse":{value:null},"h":{value:1.0/512.0}},vertexShader:["varying vec2 vUv;","void main() {","vUv = uv;","gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),fragmentShader:["uniform sampler2D tDiffuse;","uniform float h;","varying vec2 vUv;","void main() {","vec4 sum = vec4( 0.0 );","sum += texture2D( tDiffuse, vec2( vUv.x - 4.0 * h, vUv.y ) ) * 0.051;","sum += texture2D( tDiffuse, vec2( vUv.x - 3.0 * h, vUv.y ) ) * 0.0918;","sum += texture2D( tDiffuse, vec2( vUv.x - 2.0 * h, vUv.y ) ) * 0.12245;","sum += texture2D( tDiffuse, vec2( vUv.x - 1.0 * h, vUv.y ) ) * 0.1531;","sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y ) ) * 0.1633;","sum += texture2D( tDiffuse, vec2( vUv.x + 1.0 * h, vUv.y ) ) * 0.1531;","sum += texture2D( tDiffuse, vec2( vUv.x + 2.0 * h, vUv.y ) ) * 0.12245;","sum += texture2D( tDiffuse, vec2( vUv.x + 3.0 * h, vUv.y ) ) * 0.0918;","sum += texture2D( tDiffuse, vec2( vUv.x + 4.0 * h, vUv.y ) ) * 0.051;","gl_FragColor = sum;","}"].join("\n")};/**
   * @author alteredq / http://alteredqualia.com/
   *
   * Simple fake tilt-shift effect, modulating two pass Gaussian blur (see above) by vertical position
   *
   * - 9 samples per pass
   * - standard deviation 2.7
   * - "h" and "v" parameters should be set to "1 / width" and "1 / height"
   * - "r" parameter control where "focused" horizontal line lies
   */var HorizontalTiltShiftShader={uniforms:{"tDiffuse":{value:null},"h":{value:1.0/512.0},"r":{value:0.35}},vertexShader:["varying vec2 vUv;","void main() {","vUv = uv;","gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),fragmentShader:["uniform sampler2D tDiffuse;","uniform float h;","uniform float r;","varying vec2 vUv;","void main() {","vec4 sum = vec4( 0.0 );","float hh = h * abs( r - vUv.y );","sum += texture2D( tDiffuse, vec2( vUv.x - 4.0 * hh, vUv.y ) ) * 0.051;","sum += texture2D( tDiffuse, vec2( vUv.x - 3.0 * hh, vUv.y ) ) * 0.0918;","sum += texture2D( tDiffuse, vec2( vUv.x - 2.0 * hh, vUv.y ) ) * 0.12245;","sum += texture2D( tDiffuse, vec2( vUv.x - 1.0 * hh, vUv.y ) ) * 0.1531;","sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y ) ) * 0.1633;","sum += texture2D( tDiffuse, vec2( vUv.x + 1.0 * hh, vUv.y ) ) * 0.1531;","sum += texture2D( tDiffuse, vec2( vUv.x + 2.0 * hh, vUv.y ) ) * 0.12245;","sum += texture2D( tDiffuse, vec2( vUv.x + 3.0 * hh, vUv.y ) ) * 0.0918;","sum += texture2D( tDiffuse, vec2( vUv.x + 4.0 * hh, vUv.y ) ) * 0.051;","gl_FragColor = sum;","}"].join("\n")};/**
   * @author tapio / http://tapio.github.com/
   *
   * Hue and saturation adjustment
   * https://github.com/evanw/glfx.js
   * hue: -1 to 1 (-1 is 180 degrees in the negative direction, 0 is no change, etc.
   * saturation: -1 to 1 (-1 is solid gray, 0 is no change, and 1 is maximum contrast)
   */var HueSaturationShader={uniforms:{"tDiffuse":{value:null},"hue":{value:0},"saturation":{value:0}},vertexShader:["varying vec2 vUv;","void main() {","vUv = uv;","gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),fragmentShader:["uniform sampler2D tDiffuse;","uniform float hue;","uniform float saturation;","varying vec2 vUv;","void main() {","gl_FragColor = texture2D( tDiffuse, vUv );",// hue
  "float angle = hue * 3.14159265;","float s = sin(angle), c = cos(angle);","vec3 weights = (vec3(2.0 * c, -sqrt(3.0) * s - c, sqrt(3.0) * s - c) + 1.0) / 3.0;","float len = length(gl_FragColor.rgb);","gl_FragColor.rgb = vec3(","dot(gl_FragColor.rgb, weights.xyz),","dot(gl_FragColor.rgb, weights.zxy),","dot(gl_FragColor.rgb, weights.yzx)",");",// saturation
  "float average = (gl_FragColor.r + gl_FragColor.g + gl_FragColor.b) / 3.0;","if (saturation > 0.0) {","gl_FragColor.rgb += (average - gl_FragColor.rgb) * (1.0 - 1.0 / (1.001 - saturation));","} else {","gl_FragColor.rgb += (average - gl_FragColor.rgb) * (-saturation);","}","}"].join("\n")};/**
   * @author felixturner / http://airtight.cc/
   *
   * Kaleidoscope Shader
   * Radial reflection around center point
   * Ported from: http://pixelshaders.com/editor/
   * by Toby Schachman / http://tobyschachman.com/
   *
   * sides: number of reflections
   * angle: initial angle in radians
   */var KaleidoShader={uniforms:{"tDiffuse":{value:null},"sides":{value:6.0},"angle":{value:0.0}},vertexShader:["varying vec2 vUv;","void main() {","vUv = uv;","gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),fragmentShader:["uniform sampler2D tDiffuse;","uniform float sides;","uniform float angle;","varying vec2 vUv;","void main() {","vec2 p = vUv - 0.5;","float r = length(p);","float a = atan(p.y, p.x) + angle;","float tau = 2. * 3.1416 ;","a = mod(a, tau/sides);","a = abs(a - tau/sides/2.) ;","p = r * vec2(cos(a), sin(a));","vec4 color = texture2D(tDiffuse, p + 0.5);","gl_FragColor = color;","}"].join("\n")};/**
   * @author felixturner / http://airtight.cc/
   *
   * Mirror Shader
   * Copies half the input to the other half
   *
   * side: side of input to mirror (0 = left, 1 = right, 2 = top, 3 = bottom)
   */var MirrorShader={uniforms:{"tDiffuse":{value:null},"side":{value:1}},vertexShader:["varying vec2 vUv;","void main() {","vUv = uv;","gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),fragmentShader:["uniform sampler2D tDiffuse;","uniform int side;","varying vec2 vUv;","void main() {","vec2 p = vUv;","if (side == 0){","if (p.x > 0.5) p.x = 1.0 - p.x;","}else if (side == 1){","if (p.x < 0.5) p.x = 1.0 - p.x;","}else if (side == 2){","if (p.y < 0.5) p.y = 1.0 - p.y;","}else if (side == 3){","if (p.y > 0.5) p.y = 1.0 - p.y;","} ","vec4 color = texture2D(tDiffuse, p);","gl_FragColor = color;","}"].join("\n")};/**
   * @author alteredq / http://alteredqualia.com/
   *
   * Normal map shader
   * - compute normals from heightmap
   */var NormalMapShader={uniforms:{"heightMap":{value:null},"resolution":{value:new Vector2$1(512,512)},"scale":{value:new Vector2$1(1,1)},"height":{value:0.05}},vertexShader:["varying vec2 vUv;","void main() {","vUv = uv;","gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),fragmentShader:["uniform float height;","uniform vec2 resolution;","uniform sampler2D heightMap;","varying vec2 vUv;","void main() {","float val = texture2D( heightMap, vUv ).x;","float valU = texture2D( heightMap, vUv + vec2( 1.0 / resolution.x, 0.0 ) ).x;","float valV = texture2D( heightMap, vUv + vec2( 0.0, 1.0 / resolution.y ) ).x;","gl_FragColor = vec4( ( 0.5 * normalize( vec3( val - valU, val - valV, height  ) ) + 0.5 ), 1.0 );","}"].join("\n")};// Parallax Occlusion shaders from
  //    http://sunandblackcat.com/tipFullView.php?topicid=28
  // No tangent-space transforms logic based on
  //   http://mmikkelsen3d.blogspot.sk/2012/02/parallaxpoc-mapping-and-no-tangent.html
  var ParallaxShader={// Ordered from fastest to best quality.
  modes:{none:'NO_PARALLAX',basic:'USE_BASIC_PARALLAX',steep:'USE_STEEP_PARALLAX',occlusion:'USE_OCLUSION_PARALLAX',// a.k.a. POM
  relief:'USE_RELIEF_PARALLAX'},uniforms:{"bumpMap":{value:null},"map":{value:null},"parallaxScale":{value:null},"parallaxMinLayers":{value:null},"parallaxMaxLayers":{value:null}},vertexShader:["varying vec2 vUv;","varying vec3 vViewPosition;","varying vec3 vNormal;","void main() {","vUv = uv;","vec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );","vViewPosition = -mvPosition.xyz;","vNormal = normalize( normalMatrix * normal );","gl_Position = projectionMatrix * mvPosition;","}"].join("\n"),fragmentShader:["uniform sampler2D bumpMap;","uniform sampler2D map;","uniform float parallaxScale;","uniform float parallaxMinLayers;","uniform float parallaxMaxLayers;","varying vec2 vUv;","varying vec3 vViewPosition;","varying vec3 vNormal;","#ifdef USE_BASIC_PARALLAX","vec2 parallaxMap( in vec3 V ) {","float initialHeight = texture2D( bumpMap, vUv ).r;",// No Offset Limitting: messy, floating output at grazing angles.
  //"vec2 texCoordOffset = parallaxScale * V.xy / V.z * initialHeight;",
  // Offset Limiting
  "vec2 texCoordOffset = parallaxScale * V.xy * initialHeight;","return vUv - texCoordOffset;","}","#else","vec2 parallaxMap( in vec3 V ) {",// Determine number of layers from angle between V and N
  "float numLayers = mix( parallaxMaxLayers, parallaxMinLayers, abs( dot( vec3( 0.0, 0.0, 1.0 ), V ) ) );","float layerHeight = 1.0 / numLayers;","float currentLayerHeight = 0.0;",// Shift of texture coordinates for each iteration
  "vec2 dtex = parallaxScale * V.xy / V.z / numLayers;","vec2 currentTextureCoords = vUv;","float heightFromTexture = texture2D( bumpMap, currentTextureCoords ).r;",// while ( heightFromTexture > currentLayerHeight )
  // Infinite loops are not well supported. Do a "large" finite
  // loop, but not too large, as it slows down some compilers.
  "for ( int i = 0; i < 30; i += 1 ) {","if ( heightFromTexture <= currentLayerHeight ) {","break;","}","currentLayerHeight += layerHeight;",// Shift texture coordinates along vector V
  "currentTextureCoords -= dtex;","heightFromTexture = texture2D( bumpMap, currentTextureCoords ).r;","}","#ifdef USE_STEEP_PARALLAX","return currentTextureCoords;","#elif defined( USE_RELIEF_PARALLAX )","vec2 deltaTexCoord = dtex / 2.0;","float deltaHeight = layerHeight / 2.0;",// Return to the mid point of previous layer
  "currentTextureCoords += deltaTexCoord;","currentLayerHeight -= deltaHeight;",// Binary search to increase precision of Steep Parallax Mapping
  "const int numSearches = 5;","for ( int i = 0; i < numSearches; i += 1 ) {","deltaTexCoord /= 2.0;","deltaHeight /= 2.0;","heightFromTexture = texture2D( bumpMap, currentTextureCoords ).r;",// Shift along or against vector V
  "if( heightFromTexture > currentLayerHeight ) {",// Below the surface
  "currentTextureCoords -= deltaTexCoord;","currentLayerHeight += deltaHeight;","} else {",// above the surface
  "currentTextureCoords += deltaTexCoord;","currentLayerHeight -= deltaHeight;","}","}","return currentTextureCoords;","#elif defined( USE_OCLUSION_PARALLAX )","vec2 prevTCoords = currentTextureCoords + dtex;",// Heights for linear interpolation
  "float nextH = heightFromTexture - currentLayerHeight;","float prevH = texture2D( bumpMap, prevTCoords ).r - currentLayerHeight + layerHeight;",// Proportions for linear interpolation
  "float weight = nextH / ( nextH - prevH );",// Interpolation of texture coordinates
  "return prevTCoords * weight + currentTextureCoords * ( 1.0 - weight );","#else",// NO_PARALLAX
  "return vUv;","#endif","}","#endif","vec2 perturbUv( vec3 surfPosition, vec3 surfNormal, vec3 viewPosition ) {","vec2 texDx = dFdx( vUv );","vec2 texDy = dFdy( vUv );","vec3 vSigmaX = dFdx( surfPosition );","vec3 vSigmaY = dFdy( surfPosition );","vec3 vR1 = cross( vSigmaY, surfNormal );","vec3 vR2 = cross( surfNormal, vSigmaX );","float fDet = dot( vSigmaX, vR1 );","vec2 vProjVscr = ( 1.0 / fDet ) * vec2( dot( vR1, viewPosition ), dot( vR2, viewPosition ) );","vec3 vProjVtex;","vProjVtex.xy = texDx * vProjVscr.x + texDy * vProjVscr.y;","vProjVtex.z = dot( surfNormal, viewPosition );","return parallaxMap( vProjVtex );","}","void main() {","vec2 mapUv = perturbUv( -vViewPosition, normalize( vNormal ), normalize( vViewPosition ) );","gl_FragColor = texture2D( map, mapUv );","}"].join("\n")};/**
   * @author felixturner / http://airtight.cc/
   *
   * RGB Shift Shader
   * Shifts red and blue channels from center in opposite directions
   * Ported from http://kriss.cx/tom/2009/05/rgb-shift/
   * by Tom Butterworth / http://kriss.cx/tom/
   *
   * amount: shift distance (1 is width of input)
   * angle: shift angle in radians
   */var RGBShiftShader={uniforms:{"tDiffuse":{value:null},"amount":{value:0.005},"angle":{value:0.0}},vertexShader:["varying vec2 vUv;","void main() {","vUv = uv;","gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),fragmentShader:["uniform sampler2D tDiffuse;","uniform float amount;","uniform float angle;","varying vec2 vUv;","void main() {","vec2 offset = amount * vec2( cos(angle), sin(angle));","vec4 cr = texture2D(tDiffuse, vUv + offset);","vec4 cga = texture2D(tDiffuse, vUv);","vec4 cb = texture2D(tDiffuse, vUv - offset);","gl_FragColor = vec4(cr.r, cga.g, cb.b, cga.a);","}"].join("\n")};/**
   * @author alteredq / http://alteredqualia.com/
   *
   * Sepia tone shader
   * based on glfx.js sepia shader
   * https://github.com/evanw/glfx.js
   */var SepiaShader={uniforms:{"tDiffuse":{value:null},"amount":{value:1.0}},vertexShader:["varying vec2 vUv;","void main() {","vUv = uv;","gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),fragmentShader:["uniform float amount;","uniform sampler2D tDiffuse;","varying vec2 vUv;","void main() {","vec4 color = texture2D( tDiffuse, vUv );","vec3 c = color.rgb;","color.r = dot( c, vec3( 1.0 - 0.607 * amount, 0.769 * amount, 0.189 * amount ) );","color.g = dot( c, vec3( 0.349 * amount, 1.0 - 0.314 * amount, 0.168 * amount ) );","color.b = dot( c, vec3( 0.272 * amount, 0.534 * amount, 1.0 - 0.869 * amount ) );","gl_FragColor = vec4( min( vec3( 1.0 ), color.rgb ), color.a );","}"].join("\n")};/**
   * @author Mugen87 / https://github.com/Mugen87
   *
   * Sobel Edge Detection (see https://youtu.be/uihBwtPIBxM)
   *
   * As mentioned in the video the Sobel operator expects a grayscale image as input.
   *
   */var SobelOperatorShader={uniforms:{"tDiffuse":{value:null},"resolution":{value:new Vector2$1()}},vertexShader:["varying vec2 vUv;","void main() {","vUv = uv;","gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),fragmentShader:["uniform sampler2D tDiffuse;","uniform vec2 resolution;","varying vec2 vUv;","void main() {","vec2 texel = vec2( 1.0 / resolution.x, 1.0 / resolution.y );",// kernel definition (in glsl matrices are filled in column-major order)
  "const mat3 Gx = mat3( -1, -2, -1, 0, 0, 0, 1, 2, 1 );",// x direction kernel
  "const mat3 Gy = mat3( -1, 0, 1, -2, 0, 2, -1, 0, 1 );",// y direction kernel
  // fetch the 3x3 neighbourhood of a fragment
  // first column
  "float tx0y0 = texture2D( tDiffuse, vUv + texel * vec2( -1, -1 ) ).r;","float tx0y1 = texture2D( tDiffuse, vUv + texel * vec2( -1,  0 ) ).r;","float tx0y2 = texture2D( tDiffuse, vUv + texel * vec2( -1,  1 ) ).r;",// second column
  "float tx1y0 = texture2D( tDiffuse, vUv + texel * vec2(  0, -1 ) ).r;","float tx1y1 = texture2D( tDiffuse, vUv + texel * vec2(  0,  0 ) ).r;","float tx1y2 = texture2D( tDiffuse, vUv + texel * vec2(  0,  1 ) ).r;",// third column
  "float tx2y0 = texture2D( tDiffuse, vUv + texel * vec2(  1, -1 ) ).r;","float tx2y1 = texture2D( tDiffuse, vUv + texel * vec2(  1,  0 ) ).r;","float tx2y2 = texture2D( tDiffuse, vUv + texel * vec2(  1,  1 ) ).r;",// gradient value in x direction
  "float valueGx = Gx[0][0] * tx0y0 + Gx[1][0] * tx1y0 + Gx[2][0] * tx2y0 + ","Gx[0][1] * tx0y1 + Gx[1][1] * tx1y1 + Gx[2][1] * tx2y1 + ","Gx[0][2] * tx0y2 + Gx[1][2] * tx1y2 + Gx[2][2] * tx2y2; ",// gradient value in y direction
  "float valueGy = Gy[0][0] * tx0y0 + Gy[1][0] * tx1y0 + Gy[2][0] * tx2y0 + ","Gy[0][1] * tx0y1 + Gy[1][1] * tx1y1 + Gy[2][1] * tx2y1 + ","Gy[0][2] * tx0y2 + Gy[1][2] * tx1y2 + Gy[2][2] * tx2y2; ",// magnitute of the total gradient
  "float G = sqrt( ( valueGx * valueGx ) + ( valueGy * valueGy ) );","gl_FragColor = vec4( vec3( G ), 1 );","}"].join("\n")};/**
   * @author flimshaw / http://charliehoey.com
   *
   * Technicolor Shader
   * Simulates the look of the two-strip technicolor process popular in early 20th century films.
   * More historical info here: http://www.widescreenmuseum.com/oldcolor/technicolor1.htm
   * Demo here: http://charliehoey.com/technicolor_shader/shader_test.html
   */var TechnicolorShader={uniforms:{"tDiffuse":{value:null}},vertexShader:["varying vec2 vUv;","void main() {","vUv = uv;","gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),fragmentShader:["uniform sampler2D tDiffuse;","varying vec2 vUv;","void main() {","vec4 tex = texture2D( tDiffuse, vec2( vUv.x, vUv.y ) );","vec4 newTex = vec4(tex.r, (tex.g + tex.b) * .5, (tex.g + tex.b) * .5, 1.0);","gl_FragColor = newTex;","}"].join("\n")};/**
   * @author zz85 / http://www.lab4games.net/zz85/blog
   *
   * Triangle blur shader
   * based on glfx.js triangle blur shader
   * https://github.com/evanw/glfx.js
   *
   * A basic blur filter, which convolves the image with a
   * pyramid filter. The pyramid filter is separable and is applied as two
   * perpendicular triangle filters.
   */var TriangleBlurShader={uniforms:{"texture":{value:null},"delta":{value:new Vector2$1(1,1)}},vertexShader:["varying vec2 vUv;","void main() {","vUv = uv;","gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),fragmentShader:["#include <common>","#define ITERATIONS 10.0","uniform sampler2D texture;","uniform vec2 delta;","varying vec2 vUv;","void main() {","vec4 color = vec4( 0.0 );","float total = 0.0;",// randomize the lookup values to hide the fixed number of samples
  "float offset = rand( vUv );","for ( float t = -ITERATIONS; t <= ITERATIONS; t ++ ) {","float percent = ( t + offset - 0.5 ) / ITERATIONS;","float weight = 1.0 - abs( percent );","color += texture2D( texture, vUv + delta * percent ) * weight;","total += weight;","}","gl_FragColor = color / total;","}"].join("\n")};/**
   * @author zz85 / http://www.lab4games.net/zz85/blog
   *
   * Two pass Gaussian blur filter (horizontal and vertical blur shaders)
   * - described in http://www.gamerendering.com/2008/10/11/gaussian-blur-filter-shader/
   *   and used in http://www.cake23.de/traveling-wavefronts-lit-up.html
   *
   * - 9 samples per pass
   * - standard deviation 2.7
   * - "h" and "v" parameters should be set to "1 / width" and "1 / height"
   */var VerticalBlurShader={uniforms:{"tDiffuse":{value:null},"v":{value:1.0/512.0}},vertexShader:["varying vec2 vUv;","void main() {","vUv = uv;","gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),fragmentShader:["uniform sampler2D tDiffuse;","uniform float v;","varying vec2 vUv;","void main() {","vec4 sum = vec4( 0.0 );","sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y - 4.0 * v ) ) * 0.051;","sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y - 3.0 * v ) ) * 0.0918;","sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y - 2.0 * v ) ) * 0.12245;","sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y - 1.0 * v ) ) * 0.1531;","sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y ) ) * 0.1633;","sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y + 1.0 * v ) ) * 0.1531;","sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y + 2.0 * v ) ) * 0.12245;","sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y + 3.0 * v ) ) * 0.0918;","sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y + 4.0 * v ) ) * 0.051;","gl_FragColor = sum;","}"].join("\n")};/**
   * @author alteredq / http://alteredqualia.com/
   *
   * Simple fake tilt-shift effect, modulating two pass Gaussian blur (see above) by vertical position
   *
   * - 9 samples per pass
   * - standard deviation 2.7
   * - "h" and "v" parameters should be set to "1 / width" and "1 / height"
   * - "r" parameter control where "focused" horizontal line lies
   */var VerticalTiltShiftShader={uniforms:{"tDiffuse":{value:null},"v":{value:1.0/512.0},"r":{value:0.35}},vertexShader:["varying vec2 vUv;","void main() {","vUv = uv;","gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),fragmentShader:["uniform sampler2D tDiffuse;","uniform float v;","uniform float r;","varying vec2 vUv;","void main() {","vec4 sum = vec4( 0.0 );","float vv = v * abs( r - vUv.y );","sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y - 4.0 * vv ) ) * 0.051;","sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y - 3.0 * vv ) ) * 0.0918;","sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y - 2.0 * vv ) ) * 0.12245;","sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y - 1.0 * vv ) ) * 0.1531;","sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y ) ) * 0.1633;","sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y + 1.0 * vv ) ) * 0.1531;","sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y + 2.0 * vv ) ) * 0.12245;","sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y + 3.0 * vv ) ) * 0.0918;","sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y + 4.0 * vv ) ) * 0.051;","gl_FragColor = sum;","}"].join("\n")};/**
   * @author alteredq / http://alteredqualia.com/
   *
   * Vignette shader
   * based on PaintEffect postprocess from ro.me
   * http://code.google.com/p/3-dreams-of-black/source/browse/deploy/js/effects/PaintEffect.js
   */var VignetteShader={uniforms:{"tDiffuse":{value:null},"offset":{value:1.0},"darkness":{value:1.0}},vertexShader:["varying vec2 vUv;","void main() {","vUv = uv;","gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),fragmentShader:["uniform float offset;","uniform float darkness;","uniform sampler2D tDiffuse;","varying vec2 vUv;","void main() {",// Eskil's vignette
  "vec4 texel = texture2D( tDiffuse, vUv );","vec2 uv = ( vUv - vec2( 0.5 ) ) * vec2( offset );","gl_FragColor = vec4( mix( texel.rgb, vec3( 1.0 - darkness ), dot( uv, uv ) ), texel.a );",/*
  			// alternative version from glfx.js
  			// this one makes more "dusty" look (as opposed to "burned")

  			"vec4 color = texture2D( tDiffuse, vUv );",
  			"float dist = distance( vUv, vec2( 0.5 ) );",
  			"color.rgb *= smoothstep( 0.8, offset * 0.799, dist *( darkness + offset ) );",
  			"gl_FragColor = color;",
  			*/"}"].join("\n")};/**
   * @author Mugen87 / https://github.com/Mugen87
   *
   */var WaterRefractionShader={uniforms:{'color':{type:'c',value:null},'time':{type:'f',value:0},'tDiffuse':{type:'t',value:null},'tDudv':{type:'t',value:null},'textureMatrix':{type:'m4',value:null}},vertexShader:['uniform mat4 textureMatrix;','varying vec2 vUv;','varying vec4 vUvRefraction;','void main() {','	vUv = uv;','	vUvRefraction = textureMatrix * vec4( position, 1.0 );','	gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );','}'].join('\n'),fragmentShader:['uniform vec3 color;','uniform float time;','uniform sampler2D tDiffuse;','uniform sampler2D tDudv;','varying vec2 vUv;','varying vec4 vUvRefraction;','float blendOverlay( float base, float blend ) {','	return( base < 0.5 ? ( 2.0 * base * blend ) : ( 1.0 - 2.0 * ( 1.0 - base ) * ( 1.0 - blend ) ) );','}','vec3 blendOverlay( vec3 base, vec3 blend ) {','	return vec3( blendOverlay( base.r, blend.r ), blendOverlay( base.g, blend.g ),blendOverlay( base.b, blend.b ) );','}','void main() {',' float waveStrength = 0.1;',' float waveSpeed = 0.03;',// simple distortion (ripple) via dudv map (see https://www.youtube.com/watch?v=6B7IF6GOu7s)
  '	vec2 distortedUv = texture2D( tDudv, vec2( vUv.x + time * waveSpeed, vUv.y ) ).rg * waveStrength;','	distortedUv = vUv.xy + vec2( distortedUv.x, distortedUv.y + time * waveSpeed );','	vec2 distortion = ( texture2D( tDudv, distortedUv ).rg * 2.0 - 1.0 ) * waveStrength;',// new uv coords
  ' vec4 uv = vec4( vUvRefraction );',' uv.xy += distortion;','	vec4 base = texture2DProj( tDiffuse, uv );','	gl_FragColor = vec4( blendOverlay( base.rgb, color ), 1.0 );','}'].join('\n')};/**
   * @author alteredq / http://alteredqualia.com/
   *
   */var ShaderSkin={/* ------------------------------------------------------------------------------------------
  	//	Simple skin shader
  	//		- per-pixel Blinn-Phong diffuse term mixed with half-Lambert wrap-around term (per color component)
  	//		- physically based specular term (Kelemen/Szirmay-Kalos specular reflectance)
  	//
  	//		- diffuse map
  	//		- bump map
  	//		- specular map
  	//		- point, directional and hemisphere lights (use with "lights: true" material option)
  	//		- fog (use with "fog: true" material option)
  	//		- shadow maps
  	//
  	// ------------------------------------------------------------------------------------------ */'skinSimple':{uniforms:UniformsUtils.merge([UniformsLib["fog"],UniformsLib["lights"],{"enableBump":{value:0},"enableSpecular":{value:0},"tDiffuse":{value:null},"tBeckmann":{value:null},"diffuse":{value:new Color$1(0xeeeeee)},"specular":{value:new Color$1(0x111111)},"opacity":{value:1},"uRoughness":{value:0.15},"uSpecularBrightness":{value:0.75},"bumpMap":{value:null},"bumpScale":{value:1},"specularMap":{value:null},"offsetRepeat":{value:new Vector4$1(0,0,1,1)},"uWrapRGB":{value:new Vector3$1(0.75,0.375,0.1875)}}]),fragmentShader:["#define USE_BUMPMAP","uniform bool enableBump;","uniform bool enableSpecular;","uniform vec3 diffuse;","uniform vec3 specular;","uniform float opacity;","uniform float uRoughness;","uniform float uSpecularBrightness;","uniform vec3 uWrapRGB;","uniform sampler2D tDiffuse;","uniform sampler2D tBeckmann;","uniform sampler2D specularMap;","varying vec3 vNormal;","varying vec2 vUv;","varying vec3 vViewPosition;",ShaderChunk["common"],ShaderChunk["bsdfs"],ShaderChunk["packing"],ShaderChunk["lights_pars"],ShaderChunk["shadowmap_pars_fragment"],ShaderChunk["fog_pars_fragment"],ShaderChunk["bumpmap_pars_fragment"],// Fresnel term
  "float fresnelReflectance( vec3 H, vec3 V, float F0 ) {","float base = 1.0 - dot( V, H );","float exponential = pow( base, 5.0 );","return exponential + F0 * ( 1.0 - exponential );","}",// Kelemen/Szirmay-Kalos specular BRDF
  "float KS_Skin_Specular( vec3 N,",// Bumped surface normal
  "vec3 L,",// Points to light
  "vec3 V,",// Points to eye
  "float m,",// Roughness
  "float rho_s",// Specular brightness
  ") {","float result = 0.0;","float ndotl = dot( N, L );","if( ndotl > 0.0 ) {","vec3 h = L + V;",// Unnormalized half-way vector
  "vec3 H = normalize( h );","float ndoth = dot( N, H );","float PH = pow( 2.0 * texture2D( tBeckmann, vec2( ndoth, m ) ).x, 10.0 );","float F = fresnelReflectance( H, V, 0.028 );","float frSpec = max( PH * F / dot( h, h ), 0.0 );","result = ndotl * rho_s * frSpec;",// BRDF * dot(N,L) * rho_s
  "}","return result;","}","void main() {","vec3 outgoingLight = vec3( 0.0 );",// outgoing light does not have an alpha, the surface does
  "vec4 diffuseColor = vec4( diffuse, opacity );","vec4 colDiffuse = texture2D( tDiffuse, vUv );","colDiffuse.rgb *= colDiffuse.rgb;","diffuseColor = diffuseColor * colDiffuse;","vec3 normal = normalize( vNormal );","vec3 viewerDirection = normalize( vViewPosition );","float specularStrength;","if ( enableSpecular ) {","vec4 texelSpecular = texture2D( specularMap, vUv );","specularStrength = texelSpecular.r;","} else {","specularStrength = 1.0;","}","#ifdef USE_BUMPMAP","if ( enableBump ) normal = perturbNormalArb( -vViewPosition, normal, dHdxy_fwd() );","#endif",// point lights
  "vec3 totalSpecularLight = vec3( 0.0 );","vec3 totalDiffuseLight = vec3( 0.0 );","#if NUM_POINT_LIGHTS > 0","for ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {","vec3 lVector = pointLights[ i ].position + vViewPosition.xyz;","float attenuation = calcLightAttenuation( length( lVector ), pointLights[ i ].distance, pointLights[ i ].decay );","lVector = normalize( lVector );","float pointDiffuseWeightFull = max( dot( normal, lVector ), 0.0 );","float pointDiffuseWeightHalf = max( 0.5 * dot( normal, lVector ) + 0.5, 0.0 );","vec3 pointDiffuseWeight = mix( vec3 ( pointDiffuseWeightFull ), vec3( pointDiffuseWeightHalf ), uWrapRGB );","float pointSpecularWeight = KS_Skin_Specular( normal, lVector, viewerDirection, uRoughness, uSpecularBrightness );","totalDiffuseLight += pointLight[ i ].color * ( pointDiffuseWeight * attenuation );","totalSpecularLight += pointLight[ i ].color * specular * ( pointSpecularWeight * specularStrength * attenuation );","}","#endif",// directional lights
  "#if NUM_DIR_LIGHTS > 0","for( int i = 0; i < NUM_DIR_LIGHTS; i++ ) {","vec3 dirVector = directionalLights[ i ].direction;","float dirDiffuseWeightFull = max( dot( normal, dirVector ), 0.0 );","float dirDiffuseWeightHalf = max( 0.5 * dot( normal, dirVector ) + 0.5, 0.0 );","vec3 dirDiffuseWeight = mix( vec3 ( dirDiffuseWeightFull ), vec3( dirDiffuseWeightHalf ), uWrapRGB );","float dirSpecularWeight = KS_Skin_Specular( normal, dirVector, viewerDirection, uRoughness, uSpecularBrightness );","totalDiffuseLight += directionalLights[ i ].color * dirDiffuseWeight;","totalSpecularLight += directionalLights[ i ].color * ( dirSpecularWeight * specularStrength );","}","#endif",// hemisphere lights
  "#if NUM_HEMI_LIGHTS > 0","for ( int i = 0; i < NUM_HEMI_LIGHTS; i ++ ) {","vec3 lVector = hemisphereLightDirection[ i ];","float dotProduct = dot( normal, lVector );","float hemiDiffuseWeight = 0.5 * dotProduct + 0.5;","totalDiffuseLight += mix( hemisphereLightGroundColor[ i ], hemisphereLightSkyColor[ i ], hemiDiffuseWeight );",// specular (sky light)
  "float hemiSpecularWeight = 0.0;","hemiSpecularWeight += KS_Skin_Specular( normal, lVector, viewerDirection, uRoughness, uSpecularBrightness );",// specular (ground light)
  "vec3 lVectorGround = -lVector;","hemiSpecularWeight += KS_Skin_Specular( normal, lVectorGround, viewerDirection, uRoughness, uSpecularBrightness );","vec3 hemiSpecularColor = mix( hemisphereLightGroundColor[ i ], hemisphereLightSkyColor[ i ], hemiDiffuseWeight );","totalSpecularLight += hemiSpecularColor * specular * ( hemiSpecularWeight * specularStrength );","}","#endif","outgoingLight += diffuseColor.xyz * ( totalDiffuseLight + ambientLightColor * diffuse ) + totalSpecularLight;","gl_FragColor = linearToOutputTexel( vec4( outgoingLight, diffuseColor.a ) );",// TODO, this should be pre-multiplied to allow for bright highlights on very transparent objects
  ShaderChunk["fog_fragment"],"}"].join("\n"),vertexShader:["uniform vec4 offsetRepeat;","varying vec3 vNormal;","varying vec2 vUv;","varying vec3 vViewPosition;",ShaderChunk["common"],ShaderChunk["lights_pars"],ShaderChunk["shadowmap_pars_vertex"],ShaderChunk["fog_pars_vertex"],"void main() {","vec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );","vec4 worldPosition = modelMatrix * vec4( position, 1.0 );","vViewPosition = -mvPosition.xyz;","vNormal = normalize( normalMatrix * normal );","vUv = uv * offsetRepeat.zw + offsetRepeat.xy;","gl_Position = projectionMatrix * mvPosition;",ShaderChunk["shadowmap_vertex"],ShaderChunk["fog_vertex"],"}"].join("\n")},/* ------------------------------------------------------------------------------------------
  	//	Skin shader
  	//		- Blinn-Phong diffuse term (using normal + diffuse maps)
  	//		- subsurface scattering approximation by four blur layers
  	//		- physically based specular term (Kelemen/Szirmay-Kalos specular reflectance)
  	//
  	//		- point and directional lights (use with "lights: true" material option)
  	//
  	//		- based on Nvidia Advanced Skin Rendering GDC 2007 presentation
  	//		  and GPU Gems 3 Chapter 14. Advanced Techniques for Realistic Real-Time Skin Rendering
  	//
  	//			http://developer.download.nvidia.com/presentations/2007/gdc/Advanced_Skin.pdf
  	//			http://http.developer.nvidia.com/GPUGems3/gpugems3_ch14.html
  	// ------------------------------------------------------------------------------------------ */'skin':{uniforms:UniformsUtils.merge([UniformsLib["fog"],UniformsLib["lights"],{"passID":{value:0},"tDiffuse":{value:null},"tNormal":{value:null},"tBlur1":{value:null},"tBlur2":{value:null},"tBlur3":{value:null},"tBlur4":{value:null},"tBeckmann":{value:null},"uNormalScale":{value:1.0},"diffuse":{value:new Color$1(0xeeeeee)},"specular":{value:new Color$1(0x111111)},"opacity":{value:1},"uRoughness":{value:0.15},"uSpecularBrightness":{value:0.75}}]),fragmentShader:["uniform vec3 diffuse;","uniform vec3 specular;","uniform float opacity;","uniform float uRoughness;","uniform float uSpecularBrightness;","uniform int passID;","uniform sampler2D tDiffuse;","uniform sampler2D tNormal;","uniform sampler2D tBlur1;","uniform sampler2D tBlur2;","uniform sampler2D tBlur3;","uniform sampler2D tBlur4;","uniform sampler2D tBeckmann;","uniform float uNormalScale;","varying vec3 vNormal;","varying vec2 vUv;","varying vec3 vViewPosition;",ShaderChunk["common"],ShaderChunk["lights_pars"],ShaderChunk["fog_pars_fragment"],"float fresnelReflectance( vec3 H, vec3 V, float F0 ) {","float base = 1.0 - dot( V, H );","float exponential = pow( base, 5.0 );","return exponential + F0 * ( 1.0 - exponential );","}",// Kelemen/Szirmay-Kalos specular BRDF
  "float KS_Skin_Specular( vec3 N,",// Bumped surface normal
  "vec3 L,",// Points to light
  "vec3 V,",// Points to eye
  "float m,",// Roughness
  "float rho_s",// Specular brightness
  ") {","float result = 0.0;","float ndotl = dot( N, L );","if( ndotl > 0.0 ) {","vec3 h = L + V;",// Unnormalized half-way vector
  "vec3 H = normalize( h );","float ndoth = dot( N, H );","float PH = pow( 2.0 * texture2D( tBeckmann, vec2( ndoth, m ) ).x, 10.0 );","float F = fresnelReflectance( H, V, 0.028 );","float frSpec = max( PH * F / dot( h, h ), 0.0 );","result = ndotl * rho_s * frSpec;",// BRDF * dot(N,L) * rho_s
  "}","return result;","}","void main() {","vec3 outgoingLight = vec3( 0.0 );",// outgoing light does not have an alpha, the surface does
  "vec4 diffuseColor = vec4( diffuse, opacity );","vec4 mSpecular = vec4( specular, opacity );","vec4 colDiffuse = texture2D( tDiffuse, vUv );","colDiffuse *= colDiffuse;","diffuseColor *= colDiffuse;",// normal mapping
  "vec4 posAndU = vec4( -vViewPosition, vUv.x );","vec4 posAndU_dx = dFdx( posAndU ),  posAndU_dy = dFdy( posAndU );","vec3 tangent = posAndU_dx.w * posAndU_dx.xyz + posAndU_dy.w * posAndU_dy.xyz;","vec3 normal = normalize( vNormal );","vec3 binormal = normalize( cross( tangent, normal ) );","tangent = cross( normal, binormal );",// no normalization required
  "mat3 tsb = mat3( tangent, binormal, normal );","vec3 normalTex = texture2D( tNormal, vUv ).xyz * 2.0 - 1.0;","normalTex.xy *= uNormalScale;","normalTex = normalize( normalTex );","vec3 finalNormal = tsb * normalTex;","normal = normalize( finalNormal );","vec3 viewerDirection = normalize( vViewPosition );",// point lights
  "vec3 totalDiffuseLight = vec3( 0.0 );","vec3 totalSpecularLight = vec3( 0.0 );","#if NUM_POINT_LIGHTS > 0","for ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {","vec3 pointVector = normalize( pointLights[ i ].direction );","float attenuation = calcLightAttenuation( length( lVector ), pointLights[ i ].distance, pointLights[ i ].decay );","float pointDiffuseWeight = max( dot( normal, pointVector ), 0.0 );","totalDiffuseLight += pointLightColor[ i ] * ( pointDiffuseWeight * attenuation );","if ( passID == 1 ) {","float pointSpecularWeight = KS_Skin_Specular( normal, pointVector, viewerDirection, uRoughness, uSpecularBrightness );","totalSpecularLight += pointLightColor[ i ] * mSpecular.xyz * ( pointSpecularWeight * attenuation );","}","}","#endif",// directional lights
  "#if NUM_DIR_LIGHTS > 0","for( int i = 0; i < NUM_DIR_LIGHTS; i++ ) {","vec3 dirVector = directionalLights[ i ].direction;","float dirDiffuseWeight = max( dot( normal, dirVector ), 0.0 );","totalDiffuseLight += directionalLights[ i ].color * dirDiffuseWeight;","if ( passID == 1 ) {","float dirSpecularWeight = KS_Skin_Specular( normal, dirVector, viewerDirection, uRoughness, uSpecularBrightness );","totalSpecularLight += directionalLights[ i ].color * mSpecular.xyz * dirSpecularWeight;","}","}","#endif","outgoingLight += diffuseColor.rgb * ( totalDiffuseLight + totalSpecularLight );","if ( passID == 0 ) {","outgoingLight = sqrt( outgoingLight );","} else if ( passID == 1 ) {",//"#define VERSION1",
  "#ifdef VERSION1","vec3 nonblurColor = sqrt(outgoingLight );","#else","vec3 nonblurColor = outgoingLight;","#endif","vec3 blur1Color = texture2D( tBlur1, vUv ).xyz;","vec3 blur2Color = texture2D( tBlur2, vUv ).xyz;","vec3 blur3Color = texture2D( tBlur3, vUv ).xyz;","vec3 blur4Color = texture2D( tBlur4, vUv ).xyz;",//"gl_FragColor = vec4( blur1Color, gl_FragColor.w );",
  //"gl_FragColor = vec4( vec3( 0.22, 0.5, 0.7 ) * nonblurColor + vec3( 0.2, 0.5, 0.3 ) * blur1Color + vec3( 0.58, 0.0, 0.0 ) * blur2Color, gl_FragColor.w );",
  //"gl_FragColor = vec4( vec3( 0.25, 0.6, 0.8 ) * nonblurColor + vec3( 0.15, 0.25, 0.2 ) * blur1Color + vec3( 0.15, 0.15, 0.0 ) * blur2Color + vec3( 0.45, 0.0, 0.0 ) * blur3Color, gl_FragColor.w );",
  "outgoingLight = vec3( vec3( 0.22,  0.437, 0.635 ) * nonblurColor + ","vec3( 0.101, 0.355, 0.365 ) * blur1Color + ","vec3( 0.119, 0.208, 0.0 )   * blur2Color + ","vec3( 0.114, 0.0,   0.0 )   * blur3Color + ","vec3( 0.444, 0.0,   0.0 )   * blur4Color );","outgoingLight *= sqrt( colDiffuse.xyz );","outgoingLight += ambientLightColor * diffuse * colDiffuse.xyz + totalSpecularLight;","#ifndef VERSION1","outgoingLight = sqrt( outgoingLight );","#endif","}","gl_FragColor = vec4( outgoingLight, diffuseColor.a );",// TODO, this should be pre-multiplied to allow for bright highlights on very transparent objects
  ShaderChunk["fog_fragment"],"}"].join("\n"),vertexShader:["#ifdef VERTEX_TEXTURES","uniform sampler2D tDisplacement;","uniform float uDisplacementScale;","uniform float uDisplacementBias;","#endif","varying vec3 vNormal;","varying vec2 vUv;","varying vec3 vViewPosition;",ShaderChunk["common"],ShaderChunk["fog_pars_vertex"],"void main() {","vec4 worldPosition = modelMatrix * vec4( position, 1.0 );","vec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );","vViewPosition = -mvPosition.xyz;","vNormal = normalize( normalMatrix * normal );","vUv = uv;",// displacement mapping
  "#ifdef VERTEX_TEXTURES","vec3 dv = texture2D( tDisplacement, uv ).xyz;","float df = uDisplacementScale * dv.x + uDisplacementBias;","vec4 displacedPosition = vec4( vNormal.xyz * df, 0.0 ) + mvPosition;","gl_Position = projectionMatrix * displacedPosition;","#else","gl_Position = projectionMatrix * mvPosition;","#endif",ShaderChunk["fog_vertex"],"}"].join("\n"),vertexShaderUV:["varying vec3 vNormal;","varying vec2 vUv;","varying vec3 vViewPosition;",ShaderChunk["common"],"void main() {","vec4 worldPosition = modelMatrix * vec4( position, 1.0 );","vec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );","vViewPosition = -mvPosition.xyz;","vNormal = normalize( normalMatrix * normal );","vUv = uv;","gl_Position = vec4( uv.x * 2.0 - 1.0, uv.y * 2.0 - 1.0, 0.0, 1.0 );","}"].join("\n")},/* ------------------------------------------------------------------------------------------
  	// Beckmann distribution function
  	//	- to be used in specular term of skin shader
  	//	- render a screen-aligned quad to precompute a 512 x 512 texture
  	//
  	//		- from http://developer.nvidia.com/node/171
  	 ------------------------------------------------------------------------------------------ */"beckmann":{uniforms:{},vertexShader:["varying vec2 vUv;","void main() {","vUv = uv;","gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),fragmentShader:["varying vec2 vUv;","float PHBeckmann( float ndoth, float m ) {","float alpha = acos( ndoth );","float ta = tan( alpha );","float val = 1.0 / ( m * m * pow( ndoth, 4.0 ) ) * exp( -( ta * ta ) / ( m * m ) );","return val;","}","float KSTextureCompute( vec2 tex ) {",// Scale the value to fit within [0,1]  invert upon lookup.
  "return 0.5 * pow( PHBeckmann( tex.x, tex.y ), 0.1 );","}","void main() {","float x = KSTextureCompute( vUv );","gl_FragColor = vec4( x, x, x, 1.0 );","}"].join("\n")}};/**
   * @author alteredq / http://alteredqualia.com/
   *
   */var ShaderTerrain={/* -------------------------------------------------------------------------
  	//	Dynamic terrain shader
  	//		- Blinn-Phong
  	//		- height + normal + diffuse1 + diffuse2 + specular + detail maps
  	//		- point, directional and hemisphere lights (use with "lights: true" material option)
  	//		- shadow maps receiving
  	 ------------------------------------------------------------------------- */'terrain':{uniforms:UniformsUtils.merge([UniformsLib["fog"],UniformsLib["lights"],{"enableDiffuse1":{value:0},"enableDiffuse2":{value:0},"enableSpecular":{value:0},"enableReflection":{value:0},"tDiffuse1":{value:null},"tDiffuse2":{value:null},"tDetail":{value:null},"tNormal":{value:null},"tSpecular":{value:null},"tDisplacement":{value:null},"uNormalScale":{value:1.0},"uDisplacementBias":{value:0.0},"uDisplacementScale":{value:1.0},"diffuse":{value:new Color$1(0xeeeeee)},"specular":{value:new Color$1(0x111111)},"shininess":{value:30},"opacity":{value:1},"uRepeatBase":{value:new Vector2$1(1,1)},"uRepeatOverlay":{value:new Vector2$1(1,1)},"uOffset":{value:new Vector2$1(0,0)}}]),fragmentShader:["uniform vec3 diffuse;","uniform vec3 specular;","uniform float shininess;","uniform float opacity;","uniform bool enableDiffuse1;","uniform bool enableDiffuse2;","uniform bool enableSpecular;","uniform sampler2D tDiffuse1;","uniform sampler2D tDiffuse2;","uniform sampler2D tDetail;","uniform sampler2D tNormal;","uniform sampler2D tSpecular;","uniform sampler2D tDisplacement;","uniform float uNormalScale;","uniform vec2 uRepeatOverlay;","uniform vec2 uRepeatBase;","uniform vec2 uOffset;","varying vec3 vTangent;","varying vec3 vBinormal;","varying vec3 vNormal;","varying vec2 vUv;","varying vec3 vViewPosition;",ShaderChunk["common"],ShaderChunk["bsdfs"],ShaderChunk["lights_pars"],ShaderChunk["shadowmap_pars_fragment"],ShaderChunk["fog_pars_fragment"],"float calcLightAttenuation( float lightDistance, float cutoffDistance, float decayExponent ) {","if ( decayExponent > 0.0 ) {","return pow( saturate( - lightDistance / cutoffDistance + 1.0 ), decayExponent );","}","return 1.0;","}","void main() {","vec3 outgoingLight = vec3( 0.0 );",// outgoing light does not have an alpha, the surface does
  "vec4 diffuseColor = vec4( diffuse, opacity );","vec3 specularTex = vec3( 1.0 );","vec2 uvOverlay = uRepeatOverlay * vUv + uOffset;","vec2 uvBase = uRepeatBase * vUv;","vec3 normalTex = texture2D( tDetail, uvOverlay ).xyz * 2.0 - 1.0;","normalTex.xy *= uNormalScale;","normalTex = normalize( normalTex );","if( enableDiffuse1 && enableDiffuse2 ) {","vec4 colDiffuse1 = texture2D( tDiffuse1, uvOverlay );","vec4 colDiffuse2 = texture2D( tDiffuse2, uvOverlay );","colDiffuse1 = GammaToLinear( colDiffuse1, float( GAMMA_FACTOR ) );","colDiffuse2 = GammaToLinear( colDiffuse2, float( GAMMA_FACTOR ) );","diffuseColor *= mix ( colDiffuse1, colDiffuse2, 1.0 - texture2D( tDisplacement, uvBase ) );"," } else if( enableDiffuse1 ) {","diffuseColor *= texture2D( tDiffuse1, uvOverlay );","} else if( enableDiffuse2 ) {","diffuseColor *= texture2D( tDiffuse2, uvOverlay );","}","if( enableSpecular )","specularTex = texture2D( tSpecular, uvOverlay ).xyz;","mat3 tsb = mat3( vTangent, vBinormal, vNormal );","vec3 finalNormal = tsb * normalTex;","vec3 normal = normalize( finalNormal );","vec3 viewPosition = normalize( vViewPosition );","vec3 totalDiffuseLight = vec3( 0.0 );","vec3 totalSpecularLight = vec3( 0.0 );",// point lights
  "#if NUM_POINT_LIGHTS > 0","for ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {","vec3 lVector = pointLights[ i ].position + vViewPosition.xyz;","float attenuation = calcLightAttenuation( length( lVector ), pointLights[ i ].distance, pointLights[ i ].decay );","lVector = normalize( lVector );","vec3 pointHalfVector = normalize( lVector + viewPosition );","float pointDotNormalHalf = max( dot( normal, pointHalfVector ), 0.0 );","float pointDiffuseWeight = max( dot( normal, lVector ), 0.0 );","float pointSpecularWeight = specularTex.r * max( pow( pointDotNormalHalf, shininess ), 0.0 );","totalDiffuseLight += attenuation * pointLights[ i ].color * pointDiffuseWeight;","totalSpecularLight += attenuation * pointLights[ i ].color * specular * pointSpecularWeight * pointDiffuseWeight;","}","#endif",// directional lights
  "#if NUM_DIR_LIGHTS > 0","vec3 dirDiffuse = vec3( 0.0 );","vec3 dirSpecular = vec3( 0.0 );","for( int i = 0; i < NUM_DIR_LIGHTS; i++ ) {","vec3 dirVector = directionalLights[ i ].direction;","vec3 dirHalfVector = normalize( dirVector + viewPosition );","float dirDotNormalHalf = max( dot( normal, dirHalfVector ), 0.0 );","float dirDiffuseWeight = max( dot( normal, dirVector ), 0.0 );","float dirSpecularWeight = specularTex.r * max( pow( dirDotNormalHalf, shininess ), 0.0 );","totalDiffuseLight += directionalLights[ i ].color * dirDiffuseWeight;","totalSpecularLight += directionalLights[ i ].color * specular * dirSpecularWeight * dirDiffuseWeight;","}","#endif",// hemisphere lights
  "#if NUM_HEMI_LIGHTS > 0","vec3 hemiDiffuse  = vec3( 0.0 );","vec3 hemiSpecular = vec3( 0.0 );","for( int i = 0; i < NUM_HEMI_LIGHTS; i ++ ) {","vec3 lVector = hemisphereLightDirection[ i ];",// diffuse
  "float dotProduct = dot( normal, lVector );","float hemiDiffuseWeight = 0.5 * dotProduct + 0.5;","totalDiffuseLight += mix( hemisphereLights[ i ].groundColor, hemisphereLights[ i ].skyColor, hemiDiffuseWeight );",// specular (sky light)
  "float hemiSpecularWeight = 0.0;","vec3 hemiHalfVectorSky = normalize( lVector + viewPosition );","float hemiDotNormalHalfSky = 0.5 * dot( normal, hemiHalfVectorSky ) + 0.5;","hemiSpecularWeight += specularTex.r * max( pow( hemiDotNormalHalfSky, shininess ), 0.0 );",// specular (ground light)
  "vec3 lVectorGround = -lVector;","vec3 hemiHalfVectorGround = normalize( lVectorGround + viewPosition );","float hemiDotNormalHalfGround = 0.5 * dot( normal, hemiHalfVectorGround ) + 0.5;","hemiSpecularWeight += specularTex.r * max( pow( hemiDotNormalHalfGround, shininess ), 0.0 );","totalSpecularLight += specular * mix( hemisphereLights[ i ].groundColor, hemisphereLights[ i ].skyColor, hemiDiffuseWeight ) * hemiSpecularWeight * hemiDiffuseWeight;","}","#endif","outgoingLight += diffuseColor.xyz * ( totalDiffuseLight + ambientLightColor + totalSpecularLight );","gl_FragColor = vec4( outgoingLight, diffuseColor.a );",// TODO, this should be pre-multiplied to allow for bright highlights on very transparent objects
  ShaderChunk["fog_fragment"],"}"].join("\n"),vertexShader:["attribute vec4 tangent;","uniform vec2 uRepeatBase;","uniform sampler2D tNormal;","#ifdef VERTEX_TEXTURES","uniform sampler2D tDisplacement;","uniform float uDisplacementScale;","uniform float uDisplacementBias;","#endif","varying vec3 vTangent;","varying vec3 vBinormal;","varying vec3 vNormal;","varying vec2 vUv;","varying vec3 vViewPosition;",ShaderChunk["shadowmap_pars_vertex"],ShaderChunk["fog_pars_vertex"],"void main() {","vNormal = normalize( normalMatrix * normal );",// tangent and binormal vectors
  "vTangent = normalize( normalMatrix * tangent.xyz );","vBinormal = cross( vNormal, vTangent ) * tangent.w;","vBinormal = normalize( vBinormal );",// texture coordinates
  "vUv = uv;","vec2 uvBase = uv * uRepeatBase;",// displacement mapping
  "#ifdef VERTEX_TEXTURES","vec3 dv = texture2D( tDisplacement, uvBase ).xyz;","float df = uDisplacementScale * dv.x + uDisplacementBias;","vec3 displacedPosition = normal * df + position;","vec4 worldPosition = modelMatrix * vec4( displacedPosition, 1.0 );","vec4 mvPosition = modelViewMatrix * vec4( displacedPosition, 1.0 );","#else","vec4 worldPosition = modelMatrix * vec4( position, 1.0 );","vec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );","#endif","gl_Position = projectionMatrix * mvPosition;","vViewPosition = -mvPosition.xyz;","vec3 normalTex = texture2D( tNormal, uvBase ).xyz * 2.0 - 1.0;","vNormal = normalMatrix * normalTex;",ShaderChunk["shadowmap_vertex"],ShaderChunk["fog_vertex"],"}"].join("\n")}};/**
   * @author mrdoob / http://mrdoob.com/
   * @author alteredq / http://alteredqualia.com/
   *
   * ShaderToon currently contains:
   *
   *	toon1
   *	toon2
   *	hatching
   *	dotted
   */var ShaderToon={'toon1':{uniforms:{"uDirLightPos":{value:new Vector3$1()},"uDirLightColor":{value:new Color$1(0xeeeeee)},"uAmbientLightColor":{value:new Color$1(0x050505)},"uBaseColor":{value:new Color$1(0xffffff)}},vertexShader:["varying vec3 vNormal;","varying vec3 vRefract;","void main() {","vec4 worldPosition = modelMatrix * vec4( position, 1.0 );","vec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );","vec3 worldNormal = normalize ( mat3( modelMatrix[0].xyz, modelMatrix[1].xyz, modelMatrix[2].xyz ) * normal );","vNormal = normalize( normalMatrix * normal );","vec3 I = worldPosition.xyz - cameraPosition;","vRefract = refract( normalize( I ), worldNormal, 1.02 );","gl_Position = projectionMatrix * mvPosition;","}"].join("\n"),fragmentShader:["uniform vec3 uBaseColor;","uniform vec3 uDirLightPos;","uniform vec3 uDirLightColor;","uniform vec3 uAmbientLightColor;","varying vec3 vNormal;","varying vec3 vRefract;","void main() {","float directionalLightWeighting = max( dot( normalize( vNormal ), uDirLightPos ), 0.0);","vec3 lightWeighting = uAmbientLightColor + uDirLightColor * directionalLightWeighting;","float intensity = smoothstep( - 0.5, 1.0, pow( length(lightWeighting), 20.0 ) );","intensity += length(lightWeighting) * 0.2;","float cameraWeighting = dot( normalize( vNormal ), vRefract );","intensity += pow( 1.0 - length( cameraWeighting ), 6.0 );","intensity = intensity * 0.2 + 0.3;","if ( intensity < 0.50 ) {","gl_FragColor = vec4( 2.0 * intensity * uBaseColor, 1.0 );","} else {","gl_FragColor = vec4( 1.0 - 2.0 * ( 1.0 - intensity ) * ( 1.0 - uBaseColor ), 1.0 );","}","}"].join("\n")},'toon2':{uniforms:{"uDirLightPos":{value:new Vector3$1()},"uDirLightColor":{value:new Color$1(0xeeeeee)},"uAmbientLightColor":{value:new Color$1(0x050505)},"uBaseColor":{value:new Color$1(0xeeeeee)},"uLineColor1":{value:new Color$1(0x808080)},"uLineColor2":{value:new Color$1(0x000000)},"uLineColor3":{value:new Color$1(0x000000)},"uLineColor4":{value:new Color$1(0x000000)}},vertexShader:["varying vec3 vNormal;","void main() {","gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","vNormal = normalize( normalMatrix * normal );","}"].join("\n"),fragmentShader:["uniform vec3 uBaseColor;","uniform vec3 uLineColor1;","uniform vec3 uLineColor2;","uniform vec3 uLineColor3;","uniform vec3 uLineColor4;","uniform vec3 uDirLightPos;","uniform vec3 uDirLightColor;","uniform vec3 uAmbientLightColor;","varying vec3 vNormal;","void main() {","float camera = max( dot( normalize( vNormal ), vec3( 0.0, 0.0, 1.0 ) ), 0.4);","float light = max( dot( normalize( vNormal ), uDirLightPos ), 0.0);","gl_FragColor = vec4( uBaseColor, 1.0 );","if ( length(uAmbientLightColor + uDirLightColor * light) < 1.00 ) {","gl_FragColor *= vec4( uLineColor1, 1.0 );","}","if ( length(uAmbientLightColor + uDirLightColor * camera) < 0.50 ) {","gl_FragColor *= vec4( uLineColor2, 1.0 );","}","}"].join("\n")},'hatching':{uniforms:{"uDirLightPos":{value:new Vector3$1()},"uDirLightColor":{value:new Color$1(0xeeeeee)},"uAmbientLightColor":{value:new Color$1(0x050505)},"uBaseColor":{value:new Color$1(0xffffff)},"uLineColor1":{value:new Color$1(0x000000)},"uLineColor2":{value:new Color$1(0x000000)},"uLineColor3":{value:new Color$1(0x000000)},"uLineColor4":{value:new Color$1(0x000000)}},vertexShader:["varying vec3 vNormal;","void main() {","gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","vNormal = normalize( normalMatrix * normal );","}"].join("\n"),fragmentShader:["uniform vec3 uBaseColor;","uniform vec3 uLineColor1;","uniform vec3 uLineColor2;","uniform vec3 uLineColor3;","uniform vec3 uLineColor4;","uniform vec3 uDirLightPos;","uniform vec3 uDirLightColor;","uniform vec3 uAmbientLightColor;","varying vec3 vNormal;","void main() {","float directionalLightWeighting = max( dot( normalize(vNormal), uDirLightPos ), 0.0);","vec3 lightWeighting = uAmbientLightColor + uDirLightColor * directionalLightWeighting;","gl_FragColor = vec4( uBaseColor, 1.0 );","if ( length(lightWeighting) < 1.00 ) {","if ( mod(gl_FragCoord.x + gl_FragCoord.y, 10.0) == 0.0) {","gl_FragColor = vec4( uLineColor1, 1.0 );","}","}","if ( length(lightWeighting) < 0.75 ) {","if (mod(gl_FragCoord.x - gl_FragCoord.y, 10.0) == 0.0) {","gl_FragColor = vec4( uLineColor2, 1.0 );","}","}","if ( length(lightWeighting) < 0.50 ) {","if (mod(gl_FragCoord.x + gl_FragCoord.y - 5.0, 10.0) == 0.0) {","gl_FragColor = vec4( uLineColor3, 1.0 );","}","}","if ( length(lightWeighting) < 0.3465 ) {","if (mod(gl_FragCoord.x - gl_FragCoord.y - 5.0, 10.0) == 0.0) {","gl_FragColor = vec4( uLineColor4, 1.0 );","}","}","}"].join("\n")},'dotted':{uniforms:{"uDirLightPos":{value:new Vector3$1()},"uDirLightColor":{value:new Color$1(0xeeeeee)},"uAmbientLightColor":{value:new Color$1(0x050505)},"uBaseColor":{value:new Color$1(0xffffff)},"uLineColor1":{value:new Color$1(0x000000)}},vertexShader:["varying vec3 vNormal;","void main() {","gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","vNormal = normalize( normalMatrix * normal );","}"].join("\n"),fragmentShader:["uniform vec3 uBaseColor;","uniform vec3 uLineColor1;","uniform vec3 uLineColor2;","uniform vec3 uLineColor3;","uniform vec3 uLineColor4;","uniform vec3 uDirLightPos;","uniform vec3 uDirLightColor;","uniform vec3 uAmbientLightColor;","varying vec3 vNormal;","void main() {","float directionalLightWeighting = max( dot( normalize(vNormal), uDirLightPos ), 0.0);","vec3 lightWeighting = uAmbientLightColor + uDirLightColor * directionalLightWeighting;","gl_FragColor = vec4( uBaseColor, 1.0 );","if ( length(lightWeighting) < 1.00 ) {","if ( ( mod(gl_FragCoord.x, 4.001) + mod(gl_FragCoord.y, 4.0) ) > 6.00 ) {","gl_FragColor = vec4( uLineColor1, 1.0 );","}","}","if ( length(lightWeighting) < 0.50 ) {","if ( ( mod(gl_FragCoord.x + 2.0, 4.001) + mod(gl_FragCoord.y + 2.0, 4.0) ) > 6.00 ) {","gl_FragColor = vec4( uLineColor1, 1.0 );","}","}","}"].join("\n")}};// Ported from Stefan Gustavson's java implementation
  var TypedArrayUtils={};/**
   * In-place quicksort for typed arrays (e.g. for Float32Array)
   * provides fast sorting
   * useful e.g. for a custom shader and/or BufferGeometry
   *
   * @author Roman Bolzern <roman.bolzern@fhnw.ch>, 2013
   * @author I4DS http://www.fhnw.ch/i4ds, 2013
   * @license MIT License <http://www.opensource.org/licenses/mit-license.php>
   *
   * Complexity: http://bigocheatsheet.com/ see Quicksort
   *
   * Example: 
   * points: [x, y, z, x, y, z, x, y, z, ...]
   * eleSize: 3 //because of (x, y, z)
   * orderElement: 0 //order according to x
   */TypedArrayUtils.quicksortIP=function(arr,eleSize,orderElement){var stack=[];var sp=-1;var left=0;var right=arr.length/eleSize-1;var tmp=0.0,x=0,y=0;var swapF=function swapF(a,b){a*=eleSize;b*=eleSize;for(y=0;y<eleSize;y++){tmp=arr[a+y];arr[a+y]=arr[b+y];arr[b+y]=tmp;}};var i,j,swap=new Float32Array(eleSize),temp=new Float32Array(eleSize);while(true){if(right-left<=25){for(j=left+1;j<=right;j++){for(x=0;x<eleSize;x++){swap[x]=arr[j*eleSize+x];}i=j-1;while(i>=left&&arr[i*eleSize+orderElement]>swap[orderElement]){for(x=0;x<eleSize;x++){arr[(i+1)*eleSize+x]=arr[i*eleSize+x];}i--;}for(x=0;x<eleSize;x++){arr[(i+1)*eleSize+x]=swap[x];}}if(sp==-1){break;}right=stack[sp--];//?
  left=stack[sp--];}else{var median=left+right>>1;i=left+1;j=right;swapF(median,i);if(arr[left*eleSize+orderElement]>arr[right*eleSize+orderElement]){swapF(left,right);}if(arr[i*eleSize+orderElement]>arr[right*eleSize+orderElement]){swapF(i,right);}if(arr[left*eleSize+orderElement]>arr[i*eleSize+orderElement]){swapF(left,i);}for(x=0;x<eleSize;x++){temp[x]=arr[i*eleSize+x];}while(true){do{i++;}while(arr[i*eleSize+orderElement]<temp[orderElement]);do{j--;}while(arr[j*eleSize+orderElement]>temp[orderElement]);if(j<i){break;}swapF(i,j);}for(x=0;x<eleSize;x++){arr[(left+1)*eleSize+x]=arr[j*eleSize+x];arr[j*eleSize+x]=temp[x];}if(right-i+1>=j-left){stack[++sp]=i;stack[++sp]=right;right=j-1;}else{stack[++sp]=left;stack[++sp]=j-1;left=i;}}}return arr;};/**
   * k-d Tree for typed arrays (e.g. for Float32Array), in-place
   * provides fast nearest neighbour search
   * useful e.g. for a custom shader and/or BufferGeometry, saves tons of memory
   * has no insert and remove, only buildup and neares neighbour search
   *
   * Based on https://github.com/ubilabs/kd-tree-javascript by Ubilabs
   *
   * @author Roman Bolzern <roman.bolzern@fhnw.ch>, 2013
   * @author I4DS http://www.fhnw.ch/i4ds, 2013
   * @license MIT License <http://www.opensource.org/licenses/mit-license.php>
   *
   * Requires typed array quicksort
   *
   * Example: 
   * points: [x, y, z, x, y, z, x, y, z, ...]
   * metric: function(a, b){	return Math.pow(a[0] - b[0], 2) +  Math.pow(a[1] - b[1], 2) +  Math.pow(a[2] - b[2], 2); }  //Manhatten distance
   * eleSize: 3 //because of (x, y, z)
   *
   * Further information (including mathematical properties)
   * http://en.wikipedia.org/wiki/Binary_tree
   * http://en.wikipedia.org/wiki/K-d_tree
   *
   * If you want to further minimize memory usage, remove Node.depth and replace in search algorithm with a traversal to root node (see comments at TypedArrayUtils.Kdtree.prototype.Node)
   */TypedArrayUtils.Kdtree=function(points,metric,eleSize){var self=this;var maxDepth=0;var getPointSet=function getPointSet(points,pos){return points.subarray(pos*eleSize,pos*eleSize+eleSize);};function buildTree(points,depth,parent,pos){var dim=depth%eleSize,median,node,plength=points.length/eleSize;if(depth>maxDepth){maxDepth=depth;}if(plength===0){return null;}if(plength===1){return new self.Node(getPointSet(points,0),depth,parent,pos);}TypedArrayUtils.quicksortIP(points,eleSize,dim);median=Math.floor(plength/2);node=new self.Node(getPointSet(points,median),depth,parent,median+pos);node.left=buildTree(points.subarray(0,median*eleSize),depth+1,node,pos);node.right=buildTree(points.subarray((median+1)*eleSize,points.length),depth+1,node,pos+median+1);return node;}this.root=buildTree(points,0,null,0);this.getMaxDepth=function(){return maxDepth;};this.nearest=function(point,maxNodes,maxDistance){/* point: array of size eleSize 
  			maxNodes: max amount of nodes to return 
  			maxDistance: maximum distance to point result nodes should have
  			condition (not implemented): function to test node before it's added to the result list, e.g. test for view frustum
  		*/var i,result,bestNodes;bestNodes=new TypedArrayUtils.Kdtree.BinaryHeap(function(e){return-e[1];});function nearestSearch(node){var bestChild,dimension=node.depth%eleSize,ownDistance=metric(point,node.obj),linearDistance=0,otherChild,i,linearPoint=[];function saveNode(node,distance){bestNodes.push([node,distance]);if(bestNodes.size()>maxNodes){bestNodes.pop();}}for(i=0;i<eleSize;i+=1){if(i===node.depth%eleSize){linearPoint[i]=point[i];}else{linearPoint[i]=node.obj[i];}}linearDistance=metric(linearPoint,node.obj);// if it's a leaf
  if(node.right===null&&node.left===null){if(bestNodes.size()<maxNodes||ownDistance<bestNodes.peek()[1]){saveNode(node,ownDistance);}return;}if(node.right===null){bestChild=node.left;}else if(node.left===null){bestChild=node.right;}else{if(point[dimension]<node.obj[dimension]){bestChild=node.left;}else{bestChild=node.right;}}// recursive search
  nearestSearch(bestChild);if(bestNodes.size()<maxNodes||ownDistance<bestNodes.peek()[1]){saveNode(node,ownDistance);}// if there's still room or the current distance is nearer than the best distance
  if(bestNodes.size()<maxNodes||Math.abs(linearDistance)<bestNodes.peek()[1]){if(bestChild===node.left){otherChild=node.right;}else{otherChild=node.left;}if(otherChild!==null){nearestSearch(otherChild);}}}if(maxDistance){for(i=0;i<maxNodes;i+=1){bestNodes.push([null,maxDistance]);}}nearestSearch(self.root);result=[];for(i=0;i<maxNodes;i+=1){if(bestNodes.content[i][0]){result.push([bestNodes.content[i][0],bestNodes.content[i][1]]);}}return result;};};/**
   * If you need to free up additional memory and agree with an additional O( log n ) traversal time you can get rid of "depth" and "pos" in Node:
   * Depth can be easily done by adding 1 for every parent (care: root node has depth 0, not 1)
   * Pos is a bit tricky: Assuming the tree is balanced (which is the case when after we built it up), perform the following steps:
   *   By traversing to the root store the path e.g. in a bit pattern (01001011, 0 is left, 1 is right)
   *   From buildTree we know that "median = Math.floor( plength / 2 );", therefore for each bit...
   *     0: amountOfNodesRelevantForUs = Math.floor( (pamountOfNodesRelevantForUs - 1) / 2 );
   *     1: amountOfNodesRelevantForUs = Math.ceil( (pamountOfNodesRelevantForUs - 1) / 2 );
   *        pos += Math.floor( (pamountOfNodesRelevantForUs - 1) / 2 );
   *     when recursion done, we still need to add all left children of target node:
   *        pos += Math.floor( (pamountOfNodesRelevantForUs - 1) / 2 );
   *        and I think you need to +1 for the current position, not sure.. depends, try it out ^^
   *
   * I experienced that for 200'000 nodes you can get rid of 4 MB memory each, leading to 8 MB memory saved.
   */TypedArrayUtils.Kdtree.prototype.Node=function(obj,depth,parent,pos){this.obj=obj;this.left=null;this.right=null;this.parent=parent;this.depth=depth;this.pos=pos;};/**
   * Binary heap implementation
   * @author http://eloquentjavascript.net/appendix2.htm
   */TypedArrayUtils.Kdtree.BinaryHeap=function(scoreFunction){this.content=[];this.scoreFunction=scoreFunction;};TypedArrayUtils.Kdtree.BinaryHeap.prototype={push:function push(element){// Add the new element to the end of the array.
  this.content.push(element);// Allow it to bubble up.
  this.bubbleUp(this.content.length-1);},pop:function pop(){// Store the first element so we can return it later.
  var result=this.content[0];// Get the element at the end of the array.
  var end=this.content.pop();// If there are any elements left, put the end element at the
  // start, and let it sink down.
  if(this.content.length>0){this.content[0]=end;this.sinkDown(0);}return result;},peek:function peek(){return this.content[0];},remove:function remove(node){var this$1=this;var len=this.content.length;// To remove a value, we must search through the array to find it.
  for(var i=0;i<len;i++){if(this$1.content[i]==node){// When it is found, the process seen in 'pop' is repeated
  // to fill up the hole.
  var end=this$1.content.pop();if(i!=len-1){this$1.content[i]=end;if(this$1.scoreFunction(end)<this$1.scoreFunction(node)){this$1.bubbleUp(i);}else{this$1.sinkDown(i);}}return;}}throw new Error("Node not found.");},size:function size(){return this.content.length;},bubbleUp:function bubbleUp(n){var this$1=this;// Fetch the element that has to be moved.
  var element=this.content[n];// When at 0, an element can not go up any further.
  while(n>0){// Compute the parent element's index, and fetch it.
  var parentN=Math.floor((n+1)/2)-1,parent=this$1.content[parentN];// Swap the elements if the parent is greater.
  if(this$1.scoreFunction(element)<this$1.scoreFunction(parent)){this$1.content[parentN]=element;this$1.content[n]=parent;// Update 'n' to continue at the new position.
  n=parentN;}else{// Found a parent that is less, no need to move it further.
  break;}}},sinkDown:function sinkDown(n){var this$1=this;// Look up the target element and its score.
  var length=this.content.length,element=this.content[n],elemScore=this.scoreFunction(element);while(true){// Compute the indices of the child elements.
  var child2N=(n+1)*2,child1N=child2N-1;// This is used to store the new position of the element, if any.
  var swap=null;// If the first child exists (is inside the array)...
  if(child1N<length){// Look it up and compute its score.
  var child1=this$1.content[child1N],child1Score=this$1.scoreFunction(child1);// If the score is less than our element's, we need to swap.
  if(child1Score<elemScore){swap=child1N;}}// Do the same checks for the other child.
  if(child2N<length){var child2=this$1.content[child2N],child2Score=this$1.scoreFunction(child2);if(child2Score<(swap===null?elemScore:child1Score)){swap=child2N;}}// If the element needs to be moved, swap it, and continue.
  if(swap!==null){this$1.content[n]=this$1.content[swap];this$1.content[swap]=element;n=swap;}else{// Otherwise, we are done.
  break;}}}};var DaydreamController=function DaydreamController(){Object3D.call(this);var scope=this;var gamepad;var axes=[0,0];var touchpadIsPressed=false;var angularVelocity=new Vector3$1();this.matrixAutoUpdate=false;function findGamepad(){// iterate across gamepads as the Daydream Controller may not be
  // in position 0
  var gamepads=navigator.getGamepads&&navigator.getGamepads();for(var i=0;i<4;i++){var gamepad=gamepads[i];if(gamepad&&gamepad.id==='Daydream Controller'){return gamepad;}}}this.getGamepad=function(){return gamepad;};this.getTouchPadState=function(){return touchpadIsPressed;};this.update=function(){gamepad=findGamepad();if(gamepad!==undefined&&gamepad.pose!==undefined){var pose=gamepad.pose;if(pose===null){return;}// no user action yet
  //  orientation
  if(pose.orientation!==null){scope.quaternion.fromArray(pose.orientation);}scope.updateMatrix();scope.visible=true;// angular velocity
  if(pose.angularVelocity!==null&&!angularVelocity.equals(pose.angularVelocity)){angularVelocity.fromArray(pose.angularVelocity);scope.dispatchEvent({type:'angularvelocitychanged',angularVelocity:angularVelocity});}// axes (touchpad)
  if(axes[0]!==gamepad.axes[0]||axes[1]!==gamepad.axes[1]){axes[0]=gamepad.axes[0];axes[1]=gamepad.axes[1];scope.dispatchEvent({type:'axischanged',axes:axes});}// button (touchpad)
  if(touchpadIsPressed!==gamepad.buttons[0].pressed){touchpadIsPressed=gamepad.buttons[0].pressed;scope.dispatchEvent({type:touchpadIsPressed?'touchpaddown':'touchpadup'});}// app button not available, reserved for use by the browser
  }else{scope.visible=false;}};};DaydreamController.prototype=Object.create(Object3D.prototype);DaydreamController.prototype.constructor=DaydreamController;/**
   * @author servinlp
   */var GearVRController=function GearVRController(){Object3D.call(this);var scope=this;var gamepad;var axes=[0,0];var touchpadIsPressed=false;var triggerIsPressed=false;var angularVelocity=new Vector3$1();this.matrixAutoUpdate=true;function findGamepad(){var gamepads=navigator.getGamepads&&navigator.getGamepads();for(var i=0;i<4;i++){var gamepad=gamepads[i];if(gamepad&&gamepad.id==='Gear VR Controller'){return gamepad;}}}this.setHand=function(hand){if(hand===void 0)hand='right';var handPos;if(hand==='right'){handPos=0.3;}else{handPos=-0.3;}this.translateX(handPos);this.translateY(-0.35);this.translateZ(-0.4);};this.getGamepad=function(){return gamepad;};this.getTouchPadState=function(){return touchpadIsPressed;};this.update=function(){gamepad=findGamepad();if(gamepad!==undefined&&gamepad.pose!==undefined){var pose=gamepad.pose;if(pose===null){return;}// no user action yet
  //  orientation
  if(pose.orientation!==null){scope.quaternion.fromArray(pose.orientation);}scope.updateMatrix();scope.visible=true;// angular velocity
  if(pose.angularVelocity!==null&&!angularVelocity.equals(pose.angularVelocity)){angularVelocity.fromArray(pose.angularVelocity);scope.dispatchEvent({type:'angularvelocitychanged',angularVelocity:angularVelocity});}// axes (touchpad)
  if(axes[0]!==gamepad.axes[0]||axes[1]!==gamepad.axes[1]){axes[0]=gamepad.axes[0];axes[1]=gamepad.axes[1];scope.dispatchEvent({type:'axischanged',axes:axes});}// button (touchpad)
  if(touchpadIsPressed!==gamepad.buttons[0].pressed){touchpadIsPressed=gamepad.buttons[0].pressed;scope.dispatchEvent({type:touchpadIsPressed?'touchpaddown':'touchpadup',axes:axes});}// trigger
  if(triggerIsPressed!==gamepad.buttons[1].pressed){triggerIsPressed=gamepad.buttons[1].pressed;scope.dispatchEvent({type:triggerIsPressed?'triggerdown':'triggerup'});}// app button not available, reserved for use by the browser
  }else{scope.visible=false;}};};GearVRController.prototype=Object.create(Object3D.prototype);GearVRController.prototype.constructor=GearVRController;/**
   * @author mrdoob / http://mrdoob.com
   * @author stewdio / http://stewd.io
   */var ViveController=function ViveController(id){Object3D.call(this);var scope=this;var gamepad;var axes=[0,0];var thumbpadIsPressed=false;var triggerIsPressed=false;var gripsArePressed=false;var menuIsPressed=false;function findGamepad(id){// Iterate across gamepads as Vive Controllers may not be
  // in position 0 and 1.
  var gamepads=navigator.getGamepads&&navigator.getGamepads();for(var i=0,j=0;i<gamepads.length;i++){var gamepad=gamepads[i];if(gamepad&&(gamepad.id==='OpenVR Gamepad'||gamepad.id.startsWith('Oculus Touch')||gamepad.id.startsWith('Spatial Controller'))){if(j===id){return gamepad;}j++;}}}this.matrixAutoUpdate=false;this.getGamepad=function(){return gamepad;};this.getButtonState=function(button){if(button==='thumbpad'){return thumbpadIsPressed;}if(button==='trigger'){return triggerIsPressed;}if(button==='grips'){return gripsArePressed;}if(button==='menu'){return menuIsPressed;}};this.update=function(){gamepad=findGamepad(id);if(gamepad!==undefined&&gamepad.pose!==undefined){if(gamepad.pose===null){return;}// No user action yet
  //  Position and orientation.
  var pose=gamepad.pose;if(pose.position!==null){scope.position.fromArray(pose.position);}if(pose.orientation!==null){scope.quaternion.fromArray(pose.orientation);}scope.matrix.compose(scope.position,scope.quaternion,scope.scale);scope.matrixWorldNeedsUpdate=true;scope.visible=true;//  Thumbpad and Buttons.
  if(axes[0]!==gamepad.axes[0]||axes[1]!==gamepad.axes[1]){axes[0]=gamepad.axes[0];//  X axis: -1 = Left, +1 = Right.
  axes[1]=gamepad.axes[1];//  Y axis: -1 = Bottom, +1 = Top.
  scope.dispatchEvent({type:'axischanged',axes:axes});}if(thumbpadIsPressed!==gamepad.buttons[0].pressed){thumbpadIsPressed=gamepad.buttons[0].pressed;scope.dispatchEvent({type:thumbpadIsPressed?'thumbpaddown':'thumbpadup',axes:axes});}if(triggerIsPressed!==gamepad.buttons[1].pressed){triggerIsPressed=gamepad.buttons[1].pressed;scope.dispatchEvent({type:triggerIsPressed?'triggerdown':'triggerup'});}if(gripsArePressed!==gamepad.buttons[2].pressed){gripsArePressed=gamepad.buttons[2].pressed;scope.dispatchEvent({type:gripsArePressed?'gripsdown':'gripsup'});}if(menuIsPressed!==gamepad.buttons[3].pressed){menuIsPressed=gamepad.buttons[3].pressed;scope.dispatchEvent({type:menuIsPressed?'menudown':'menuup'});}}else{scope.visible=false;}};};ViveController.prototype=Object.create(Object3D.prototype);ViveController.prototype.constructor=ViveController;/**
   * @author mrdoob / http://mrdoob.com
   */var PaintViveController=function PaintViveController(id){ViveController.call(this,id);var PI2=Math.PI*2;var MODES={COLOR:0,SIZE:1};var mode=MODES.COLOR;var color=new Color$1(1,1,1);var size=1.0;//
  function generateHueTexture(){var canvas=document.createElement('canvas');canvas.width=256;canvas.height=256;var context=canvas.getContext('2d');var imageData=context.getImageData(0,0,256,256);var data=imageData.data;var swatchColor=new Color$1();for(var i=0,j=0;i<data.length;i+=4, j++){var x=j%256/256-0.5;var y=Math.floor(j/256)/256-0.5;swatchColor.setHSL(Math.atan2(y,x)/PI2,1,(0.5-Math.sqrt(x*x+y*y))*2.0);data[i+0]=swatchColor.r*256;data[i+1]=swatchColor.g*256;data[i+2]=swatchColor.b*256;data[i+3]=256;}context.putImageData(imageData,0,0);return new CanvasTexture(canvas);}// COLOR UI
  var geometry=new CircleGeometry(1,32);var material=new MeshBasicMaterial({map:generateHueTexture()});var colorUI=new Mesh(geometry,material);colorUI.position.set(0,0.005,0.0495);colorUI.rotation.x=-1.45;colorUI.scale.setScalar(0.02);this.add(colorUI);var geometry=new IcosahedronGeometry(0.1,2);var material=new MeshBasicMaterial();material.color=color;var ball=new Mesh(geometry,material);colorUI.add(ball);// SIZE UI
  var sizeUI=new Group();sizeUI.position.set(0,0.005,0.0495);sizeUI.rotation.x=-1.45;sizeUI.scale.setScalar(0.02);this.add(sizeUI);var triangleShape=new Shape();triangleShape.moveTo(0,-1);triangleShape.lineTo(1,1);triangleShape.lineTo(-1,1);var geometry=new ShapeGeometry(triangleShape);var material=new MeshBasicMaterial({color:0x222222,wireframe:true});var sizeUIOutline=new Mesh(geometry,material);sizeUIOutline.position.z=0.001;resizeTriangleGeometry(sizeUIOutline.geometry,1.0);sizeUI.add(sizeUIOutline);var geometry=new ShapeGeometry(triangleShape);var material=new MeshBasicMaterial({side:DoubleSide});material.color=color;var sizeUIFill=new Mesh(geometry,material);sizeUIFill.position.z=0.0011;resizeTriangleGeometry(sizeUIFill.geometry,0.5);sizeUI.add(sizeUIFill);sizeUI.visible=false;function onAxisChanged(event){if(this.getButtonState('thumbpad')===false){return;}var x=event.axes[0]/2.0;var y=-event.axes[1]/2.0;if(mode===MODES.COLOR){color.setHSL(Math.atan2(y,x)/PI2,1,(0.5-Math.sqrt(x*x+y*y))*2.0);ball.position.set(event.axes[0],event.axes[1],0);}if(mode===MODES.SIZE){var ratio=0.5-y;size=ratio*2;resizeTriangleGeometry(sizeUIFill.geometry,ratio);}}function resizeTriangleGeometry(geometry,ratio){var x=0,y=0;var fullWidth=0.75,fullHeight=1.5;var angle=Math.atan(fullWidth/2/fullHeight);var bottomY=y-fullHeight/2;var height=fullHeight*ratio;var width=Math.tan(angle)*height*2;geometry.vertices[0].set(x,bottomY,0);geometry.vertices[1].set(x+width/2,bottomY+height,0);geometry.vertices[2].set(x-width/2,bottomY+height,0);geometry.verticesNeedUpdate=true;}function onGripsDown(event){if(mode===MODES.COLOR){mode=MODES.SIZE;colorUI.visible=false;sizeUI.visible=true;return;}if(mode===MODES.SIZE){mode=MODES.COLOR;colorUI.visible=true;sizeUI.visible=false;return;}}this.getColor=function(){return color;};this.getSize=function(){return size;};this.addEventListener('axischanged',onAxisChanged);this.addEventListener('gripsdown',onGripsDown);};PaintViveController.prototype=Object.create(ViveController.prototype);PaintViveController.prototype.constructor=PaintViveController;/**
   * @author mrdoob / http://mrdoob.com
   * @author Mugen87 / https://github.com/Mugen87
   *
   * Based on @tojiro's vr-samples-utils.js
   */function AnimationObjectGroup(){var arguments$1=arguments;this.uuid=_Math$1.generateUUID();// cached objects followed by the active ones
  this._objects=Array.prototype.slice.call(arguments);this.nCachedObjects_=0;// threshold
  // note: read by PropertyBinding.Composite
  var indices={};this._indicesByUUID=indices;// for bookkeeping
  for(var i=0,n=arguments.length;i!==n;++i){indices[arguments$1[i].uuid]=i;}this._paths=[];// inside: string
  this._parsedPaths=[];// inside: { we don't care, here }
  this._bindings=[];// inside: Array< PropertyBinding >
  this._bindingsIndicesByPath={};// inside: indices in these arrays
  var scope=this;this.stats={objects:{get total(){return scope._objects.length;},get inUse(){return this.total-scope.nCachedObjects_;}},get bindingsPerObject(){return scope._bindings.length;}};}Object.assign(AnimationObjectGroup.prototype,{isAnimationObjectGroup:true,add:function add(){var arguments$1=arguments;var objects=this._objects,nObjects=objects.length,nCachedObjects=this.nCachedObjects_,indicesByUUID=this._indicesByUUID,paths=this._paths,parsedPaths=this._parsedPaths,bindings=this._bindings,nBindings=bindings.length;for(var i=0,n=arguments.length;i!==n;++i){var object=arguments$1[i],uuid=object.uuid,index=indicesByUUID[uuid],knownObject=undefined;if(index===undefined){// unknown object -> add it to the ACTIVE region
  index=nObjects++;indicesByUUID[uuid]=index;objects.push(object);// accounting is done, now do the same for all bindings
  for(var j=0,m=nBindings;j!==m;++j){bindings[j].push(new PropertyBinding$1(object,paths[j],parsedPaths[j]));}}else if(index<nCachedObjects){knownObject=objects[index];// move existing object to the ACTIVE region
  var firstActiveIndex=--nCachedObjects,lastCachedObject=objects[firstActiveIndex];indicesByUUID[lastCachedObject.uuid]=index;objects[index]=lastCachedObject;indicesByUUID[uuid]=firstActiveIndex;objects[firstActiveIndex]=object;// accounting is done, now do the same for all bindings
  for(var j=0,m=nBindings;j!==m;++j){var bindingsForPath=bindings[j],lastCached=bindingsForPath[firstActiveIndex],binding=bindingsForPath[index];bindingsForPath[index]=lastCached;if(binding===undefined){// since we do not bother to create new bindings
  // for objects that are cached, the binding may
  // or may not exist
  binding=new PropertyBinding$1(object,paths[j],parsedPaths[j]);}bindingsForPath[firstActiveIndex]=binding;}}else if(objects[index]!==knownObject){console.error('THREE.AnimationObjectGroup: Different objects with the same UUID '+'detected. Clean the caches or recreate your infrastructure when reloading scenes.');}// else the object is already where we want it to be
  }// for arguments
  this.nCachedObjects_=nCachedObjects;},remove:function remove(){var arguments$1=arguments;var objects=this._objects,nCachedObjects=this.nCachedObjects_,indicesByUUID=this._indicesByUUID,bindings=this._bindings,nBindings=bindings.length;for(var i=0,n=arguments.length;i!==n;++i){var object=arguments$1[i],uuid=object.uuid,index=indicesByUUID[uuid];if(index!==undefined&&index>=nCachedObjects){// move existing object into the CACHED region
  var lastCachedIndex=nCachedObjects++,firstActiveObject=objects[lastCachedIndex];indicesByUUID[firstActiveObject.uuid]=index;objects[index]=firstActiveObject;indicesByUUID[uuid]=lastCachedIndex;objects[lastCachedIndex]=object;// accounting is done, now do the same for all bindings
  for(var j=0,m=nBindings;j!==m;++j){var bindingsForPath=bindings[j],firstActive=bindingsForPath[lastCachedIndex],binding=bindingsForPath[index];bindingsForPath[index]=firstActive;bindingsForPath[lastCachedIndex]=binding;}}}// for arguments
  this.nCachedObjects_=nCachedObjects;},// remove & forget
  uncache:function uncache(){var arguments$1=arguments;var objects=this._objects,nObjects=objects.length,nCachedObjects=this.nCachedObjects_,indicesByUUID=this._indicesByUUID,bindings=this._bindings,nBindings=bindings.length;for(var i=0,n=arguments.length;i!==n;++i){var object=arguments$1[i],uuid=object.uuid,index=indicesByUUID[uuid];if(index!==undefined){delete indicesByUUID[uuid];if(index<nCachedObjects){// object is cached, shrink the CACHED region
  var firstActiveIndex=--nCachedObjects,lastCachedObject=objects[firstActiveIndex],lastIndex=--nObjects,lastObject=objects[lastIndex];// last cached object takes this object's place
  indicesByUUID[lastCachedObject.uuid]=index;objects[index]=lastCachedObject;// last object goes to the activated slot and pop
  indicesByUUID[lastObject.uuid]=firstActiveIndex;objects[firstActiveIndex]=lastObject;objects.pop();// accounting is done, now do the same for all bindings
  for(var j=0,m=nBindings;j!==m;++j){var bindingsForPath=bindings[j],lastCached=bindingsForPath[firstActiveIndex],last=bindingsForPath[lastIndex];bindingsForPath[index]=lastCached;bindingsForPath[firstActiveIndex]=last;bindingsForPath.pop();}}else{// object is active, just swap with the last and pop
  var lastIndex=--nObjects,lastObject=objects[lastIndex];indicesByUUID[lastObject.uuid]=index;objects[index]=lastObject;objects.pop();// accounting is done, now do the same for all bindings
  for(var j=0,m=nBindings;j!==m;++j){var bindingsForPath=bindings[j];bindingsForPath[index]=bindingsForPath[lastIndex];bindingsForPath.pop();}}// cached or active
  }// if object is known
  }// for arguments
  this.nCachedObjects_=nCachedObjects;},// Internal interface used by befriended PropertyBinding.Composite:
  subscribe_:function subscribe_(path,parsedPath){// returns an array of bindings for the given path that is changed
  // according to the contained objects in the group
  var indicesByPath=this._bindingsIndicesByPath,index=indicesByPath[path],bindings=this._bindings;if(index!==undefined){return bindings[index];}var paths=this._paths,parsedPaths=this._parsedPaths,objects=this._objects,nObjects=objects.length,nCachedObjects=this.nCachedObjects_,bindingsForPath=new Array(nObjects);index=bindings.length;indicesByPath[path]=index;paths.push(path);parsedPaths.push(parsedPath);bindings.push(bindingsForPath);for(var i=nCachedObjects,n=objects.length;i!==n;++i){var object=objects[i];bindingsForPath[i]=new PropertyBinding$1(object,path,parsedPath);}return bindingsForPath;},unsubscribe_:function unsubscribe_(path){// tells the group to forget about a property path and no longer
  // update the array previously obtained with 'subscribe_'
  var indicesByPath=this._bindingsIndicesByPath,index=indicesByPath[path];if(index!==undefined){var paths=this._paths,parsedPaths=this._parsedPaths,bindings=this._bindings,lastBindingsIndex=bindings.length-1,lastBindings=bindings[lastBindingsIndex],lastBindingsPath=path[lastBindingsIndex];indicesByPath[lastBindingsPath]=index;bindings[index]=lastBindings;bindings.pop();parsedPaths[index]=parsedPaths[lastBindingsIndex];parsedPaths.pop();paths[index]=paths[lastBindingsIndex];paths.pop();}}});/**
   * @author mrdoob / http://mrdoob.com/
   */function PositionalAudio(listener){Audio.call(this,listener);this.panner=this.context.createPanner();this.panner.connect(this.gain);}PositionalAudio.prototype=Object.assign(Object.create(Audio.prototype),{constructor:PositionalAudio,getOutput:function getOutput(){return this.panner;},getRefDistance:function getRefDistance(){return this.panner.refDistance;},setRefDistance:function setRefDistance(value){this.panner.refDistance=value;},getRolloffFactor:function getRolloffFactor(){return this.panner.rolloffFactor;},setRolloffFactor:function setRolloffFactor(value){this.panner.rolloffFactor=value;},getDistanceModel:function getDistanceModel(){return this.panner.distanceModel;},setDistanceModel:function setDistanceModel(value){this.panner.distanceModel=value;},getMaxDistance:function getMaxDistance(){return this.panner.maxDistance;},setMaxDistance:function setMaxDistance(value){this.panner.maxDistance=value;},updateMatrixWorld:function(){var position=new Vector3$1();return function updateMatrixWorld(force){Object3D.prototype.updateMatrixWorld.call(this,force);position.setFromMatrixPosition(this.matrixWorld);this.panner.setPosition(position.x,position.y,position.z);};}()});/**
   * @author alteredq / http://alteredqualia.com/
   */function Clock(autoStart){this.autoStart=autoStart!==undefined?autoStart:true;this.startTime=0;this.oldTime=0;this.elapsedTime=0;this.running=false;}Object.assign(Clock.prototype,{start:function start(){this.startTime=(typeof performance==='undefined'?Date:performance).now();// see #10732
  this.oldTime=this.startTime;this.elapsedTime=0;this.running=true;},stop:function stop(){this.getElapsedTime();this.running=false;this.autoStart=false;},getElapsedTime:function getElapsedTime(){this.getDelta();return this.elapsedTime;},getDelta:function getDelta(){var diff=0;if(this.autoStart&&!this.running){this.start();return 0;}if(this.running){var newTime=(typeof performance==='undefined'?Date:performance).now();diff=(newTime-this.oldTime)/1000;this.oldTime=newTime;this.elapsedTime+=diff;}return diff;}});/**
   * @author benaadams / https://twitter.com/ben_a_adams
   */function InstancedBufferAttribute(array,itemSize,meshPerAttribute){BufferAttribute.call(this,array,itemSize);this.meshPerAttribute=meshPerAttribute||1;}InstancedBufferAttribute.prototype=Object.assign(Object.create(BufferAttribute.prototype),{constructor:InstancedBufferAttribute,isInstancedBufferAttribute:true,copy:function copy(source){BufferAttribute.prototype.copy.call(this,source);this.meshPerAttribute=source.meshPerAttribute;return this;}});/**
   * @author benaadams / https://twitter.com/ben_a_adams
   */function InstancedBufferGeometry(){BufferGeometry.call(this);this.type='InstancedBufferGeometry';this.maxInstancedCount=undefined;}InstancedBufferGeometry.prototype=Object.assign(Object.create(BufferGeometry.prototype),{constructor:InstancedBufferGeometry,isInstancedBufferGeometry:true,copy:function copy(source){BufferGeometry.prototype.copy.call(this,source);this.maxInstancedCount=source.maxInstancedCount;return this;},clone:function clone(){return new this.constructor().copy(this);}});/**
   * @author benaadams / https://twitter.com/ben_a_adams
   */function InstancedInterleavedBuffer(array,stride,meshPerAttribute){InterleavedBuffer.call(this,array,stride);this.meshPerAttribute=meshPerAttribute||1;}InstancedInterleavedBuffer.prototype=Object.assign(Object.create(InterleavedBuffer.prototype),{constructor:InstancedInterleavedBuffer,isInstancedInterleavedBuffer:true,copy:function copy(source){InterleavedBuffer.prototype.copy.call(this,source);this.meshPerAttribute=source.meshPerAttribute;return this;}});/**
   * @author zz85 / http://www.lab4games.net/zz85/blog
   * minimal class for proxing functions to Path. Replaces old "extractSubpaths()"
   **/function ShapePath(){this.type='ShapePath';this.subPaths=[];this.currentPath=null;}Object.assign(ShapePath.prototype,{moveTo:function moveTo(x,y){this.currentPath=new Path();this.subPaths.push(this.currentPath);this.currentPath.moveTo(x,y);},lineTo:function lineTo(x,y){this.currentPath.lineTo(x,y);},quadraticCurveTo:function quadraticCurveTo(aCPx,aCPy,aX,aY){this.currentPath.quadraticCurveTo(aCPx,aCPy,aX,aY);},bezierCurveTo:function bezierCurveTo(aCP1x,aCP1y,aCP2x,aCP2y,aX,aY){this.currentPath.bezierCurveTo(aCP1x,aCP1y,aCP2x,aCP2y,aX,aY);},splineThru:function splineThru(pts){this.currentPath.splineThru(pts);},toShapes:function toShapes(isCCW,noHoles){function toShapesNoHoles(inSubpaths){var shapes=[];for(var i=0,l=inSubpaths.length;i<l;i++){var tmpPath=inSubpaths[i];var tmpShape=new Shape();tmpShape.curves=tmpPath.curves;shapes.push(tmpShape);}return shapes;}function isPointInsidePolygon(inPt,inPolygon){var polyLen=inPolygon.length;// inPt on polygon contour => immediate success    or
  // toggling of inside/outside at every single! intersection point of an edge
  //  with the horizontal line through inPt, left of inPt
  //  not counting lowerY endpoints of edges and whole edges on that line
  var inside=false;for(var p=polyLen-1,q=0;q<polyLen;p=q++){var edgeLowPt=inPolygon[p];var edgeHighPt=inPolygon[q];var edgeDx=edgeHighPt.x-edgeLowPt.x;var edgeDy=edgeHighPt.y-edgeLowPt.y;if(Math.abs(edgeDy)>Number.EPSILON){// not parallel
  if(edgeDy<0){edgeLowPt=inPolygon[q];edgeDx=-edgeDx;edgeHighPt=inPolygon[p];edgeDy=-edgeDy;}if(inPt.y<edgeLowPt.y||inPt.y>edgeHighPt.y){continue;}if(inPt.y===edgeLowPt.y){if(inPt.x===edgeLowPt.x){return true;}// inPt is on contour ?
  // continue;				// no intersection or edgeLowPt => doesn't count !!!
  }else{var perpEdge=edgeDy*(inPt.x-edgeLowPt.x)-edgeDx*(inPt.y-edgeLowPt.y);if(perpEdge===0){return true;}// inPt is on contour ?
  if(perpEdge<0){continue;}inside=!inside;// true intersection left of inPt
  }}else{// parallel or collinear
  if(inPt.y!==edgeLowPt.y){continue;}// parallel
  // edge lies on the same horizontal line as inPt
  if(edgeHighPt.x<=inPt.x&&inPt.x<=edgeLowPt.x||edgeLowPt.x<=inPt.x&&inPt.x<=edgeHighPt.x){return true;}// inPt: Point on contour !
  // continue;
  }}return inside;}var isClockWise=ShapeUtils.isClockWise;var subPaths=this.subPaths;if(subPaths.length===0){return[];}if(noHoles===true){return toShapesNoHoles(subPaths);}var solid,tmpPath,tmpShape,shapes=[];if(subPaths.length===1){tmpPath=subPaths[0];tmpShape=new Shape();tmpShape.curves=tmpPath.curves;shapes.push(tmpShape);return shapes;}var holesFirst=!isClockWise(subPaths[0].getPoints());holesFirst=isCCW?!holesFirst:holesFirst;// console.log("Holes first", holesFirst);
  var betterShapeHoles=[];var newShapes=[];var newShapeHoles=[];var mainIdx=0;var tmpPoints;newShapes[mainIdx]=undefined;newShapeHoles[mainIdx]=[];for(var i=0,l=subPaths.length;i<l;i++){tmpPath=subPaths[i];tmpPoints=tmpPath.getPoints();solid=isClockWise(tmpPoints);solid=isCCW?!solid:solid;if(solid){if(!holesFirst&&newShapes[mainIdx]){mainIdx++;}newShapes[mainIdx]={s:new Shape(),p:tmpPoints};newShapes[mainIdx].s.curves=tmpPath.curves;if(holesFirst){mainIdx++;}newShapeHoles[mainIdx]=[];//console.log('cw', i);
  }else{newShapeHoles[mainIdx].push({h:tmpPath,p:tmpPoints[0]});//console.log('ccw', i);
  }}// only Holes? -> probably all Shapes with wrong orientation
  if(!newShapes[0]){return toShapesNoHoles(subPaths);}if(newShapes.length>1){var ambiguous=false;var toChange=[];for(var sIdx=0,sLen=newShapes.length;sIdx<sLen;sIdx++){betterShapeHoles[sIdx]=[];}for(var sIdx=0,sLen=newShapes.length;sIdx<sLen;sIdx++){var sho=newShapeHoles[sIdx];for(var hIdx=0;hIdx<sho.length;hIdx++){var ho=sho[hIdx];var hole_unassigned=true;for(var s2Idx=0;s2Idx<newShapes.length;s2Idx++){if(isPointInsidePolygon(ho.p,newShapes[s2Idx].p)){if(sIdx!==s2Idx){toChange.push({froms:sIdx,tos:s2Idx,hole:hIdx});}if(hole_unassigned){hole_unassigned=false;betterShapeHoles[s2Idx].push(ho);}else{ambiguous=true;}}}if(hole_unassigned){betterShapeHoles[sIdx].push(ho);}}}// console.log("ambiguous: ", ambiguous);
  if(toChange.length>0){// console.log("to change: ", toChange);
  if(!ambiguous){newShapeHoles=betterShapeHoles;}}}var tmpHoles;for(var i=0,il=newShapes.length;i<il;i++){tmpShape=newShapes[i].s;shapes.push(tmpShape);tmpHoles=newShapeHoles[i];for(var j=0,jl=tmpHoles.length;j<jl;j++){tmpShape.holes.push(tmpHoles[j].h);}}//console.log("shape", shapes);
  return shapes;}});/**
   * @author zz85 / http://www.lab4games.net/zz85/blog
   * @author mrdoob / http://mrdoob.com/
   */function Font(data){this.type='Font';this.data=data;}Object.assign(Font.prototype,{isFont:true,generateShapes:function generateShapes(text,size,divisions){function createPaths(text){var chars=String(text).split('');var scale=size/data.resolution;var line_height=(data.boundingBox.yMax-data.boundingBox.yMin+data.underlineThickness)*scale;var offsetX=0,offsetY=0;var paths=[];for(var i=0;i<chars.length;i++){var char=chars[i];if(char==='\n'){offsetX=0;offsetY-=line_height;}else{var ret=createPath(char,scale,offsetX,offsetY);offsetX+=ret.offsetX;paths.push(ret.path);}}return paths;}function createPath(c,scale,offsetX,offsetY){var glyph=data.glyphs[c]||data.glyphs['?'];if(!glyph){return;}var path=new ShapePath();var pts=[];var x,y,cpx,cpy,cpx0,cpy0,cpx1,cpy1,cpx2,cpy2,laste;if(glyph.o){var outline=glyph._cachedOutline||(glyph._cachedOutline=glyph.o.split(' '));for(var i=0,l=outline.length;i<l;){var action=outline[i++];switch(action){case'm':// moveTo
  x=outline[i++]*scale+offsetX;y=outline[i++]*scale+offsetY;path.moveTo(x,y);break;case'l':// lineTo
  x=outline[i++]*scale+offsetX;y=outline[i++]*scale+offsetY;path.lineTo(x,y);break;case'q':// quadraticCurveTo
  cpx=outline[i++]*scale+offsetX;cpy=outline[i++]*scale+offsetY;cpx1=outline[i++]*scale+offsetX;cpy1=outline[i++]*scale+offsetY;path.quadraticCurveTo(cpx1,cpy1,cpx,cpy);laste=pts[pts.length-1];if(laste){cpx0=laste.x;cpy0=laste.y;}break;case'b':// bezierCurveTo
  cpx=outline[i++]*scale+offsetX;cpy=outline[i++]*scale+offsetY;cpx1=outline[i++]*scale+offsetX;cpy1=outline[i++]*scale+offsetY;cpx2=outline[i++]*scale+offsetX;cpy2=outline[i++]*scale+offsetY;path.bezierCurveTo(cpx1,cpy1,cpx2,cpy2,cpx,cpy);laste=pts[pts.length-1];if(laste){cpx0=laste.x;cpy0=laste.y;}break;}}}return{offsetX:glyph.ha*scale,path:path};}//
  if(size===undefined){size=100;}if(divisions===undefined){divisions=4;}var data=this.data;var paths=createPaths(text);var shapes=[];for(var p=0,pl=paths.length;p<pl;p++){Array.prototype.push.apply(shapes,paths[p].toShapes());}return shapes;}});/**
   * @author alteredq / http://alteredqualia.com/
   */var lineGeometry;var coneGeometry;function ArrowHelper(dir,origin,length,color,headLength,headWidth){// dir is assumed to be normalized
  Object3D.call(this);if(color===undefined){color=0xffff00;}if(length===undefined){length=1;}if(headLength===undefined){headLength=0.2*length;}if(headWidth===undefined){headWidth=0.2*headLength;}if(lineGeometry===undefined){lineGeometry=new BufferGeometry();lineGeometry.addAttribute('position',new Float32BufferAttribute([0,0,0,0,1,0],3));coneGeometry=new CylinderBufferGeometry(0,0.5,1,5,1);coneGeometry.translate(0,-0.5,0);}this.position.copy(origin);this.line=new Line$1(lineGeometry,new LineBasicMaterial$1({color:color}));this.line.matrixAutoUpdate=false;this.add(this.line);this.cone=new Mesh(coneGeometry,new MeshBasicMaterial({color:color}));this.cone.matrixAutoUpdate=false;this.add(this.cone);this.setDirection(dir);this.setLength(length,headLength,headWidth);}ArrowHelper.prototype=Object.create(Object3D.prototype);ArrowHelper.prototype.constructor=ArrowHelper;ArrowHelper.prototype.setDirection=function(){var axis=new Vector3$1();var radians;return function setDirection(dir){// dir is assumed to be normalized
  if(dir.y>0.99999){this.quaternion.set(0,0,0,1);}else if(dir.y<-0.99999){this.quaternion.set(1,0,0,0);}else{axis.set(dir.z,0,-dir.x).normalize();radians=Math.acos(dir.y);this.quaternion.setFromAxisAngle(axis,radians);}};}();ArrowHelper.prototype.setLength=function(length,headLength,headWidth){if(headLength===undefined){headLength=0.2*length;}if(headWidth===undefined){headWidth=0.2*headLength;}this.line.scale.set(1,Math.max(0,length-headLength),1);this.line.updateMatrix();this.cone.scale.set(headWidth,headLength,headWidth);this.cone.position.y=length;this.cone.updateMatrix();};ArrowHelper.prototype.setColor=function(color){this.line.material.color.copy(color);this.cone.material.color.copy(color);};/**
   * @author WestLangley / http://github.com/WestLangley
   */function Box3Helper(box,hex){this.type='Box3Helper';this.box=box;var color=hex!==undefined?hex:0xffff00;var indices=new Uint16Array([0,1,1,2,2,3,3,0,4,5,5,6,6,7,7,4,0,4,1,5,2,6,3,7]);var positions=[1,1,1,-1,1,1,-1,-1,1,1,-1,1,1,1,-1,-1,1,-1,-1,-1,-1,1,-1,-1];var geometry=new BufferGeometry();geometry.setIndex(new BufferAttribute(indices,1));geometry.addAttribute('position',new Float32BufferAttribute(positions,3));LineSegments.call(this,geometry,new LineBasicMaterial$1({color:color}));this.geometry.computeBoundingSphere();}Box3Helper.prototype=Object.create(LineSegments.prototype);Box3Helper.prototype.constructor=Box3Helper;Box3Helper.prototype.updateMatrixWorld=function(force){var box=this.box;if(box.isEmpty()){return;}box.getCenter(this.position);box.getSize(this.scale);this.scale.multiplyScalar(0.5);Object3D.prototype.updateMatrixWorld.call(this,force);};/**
   * @author alteredq / http://alteredqualia.com/
   * @author Mugen87 / https://github.com/Mugen87
   *
   *	- shows frustum, line of sight and up of the camera
   *	- suitable for fast updates
   * 	- based on frustum visualization in lightgl.js shadowmap example
   *		http://evanw.github.com/lightgl.js/tests/shadowmap.html
   */function CameraHelper(camera){var geometry=new BufferGeometry();var material=new LineBasicMaterial$1({color:0xffffff,vertexColors:FaceColors});var vertices=[];var colors=[];var pointMap={};// colors
  var colorFrustum=new Color$1(0xffaa00);var colorCone=new Color$1(0xff0000);var colorUp=new Color$1(0x00aaff);var colorTarget=new Color$1(0xffffff);var colorCross=new Color$1(0x333333);// near
  addLine('n1','n2',colorFrustum);addLine('n2','n4',colorFrustum);addLine('n4','n3',colorFrustum);addLine('n3','n1',colorFrustum);// far
  addLine('f1','f2',colorFrustum);addLine('f2','f4',colorFrustum);addLine('f4','f3',colorFrustum);addLine('f3','f1',colorFrustum);// sides
  addLine('n1','f1',colorFrustum);addLine('n2','f2',colorFrustum);addLine('n3','f3',colorFrustum);addLine('n4','f4',colorFrustum);// cone
  addLine('p','n1',colorCone);addLine('p','n2',colorCone);addLine('p','n3',colorCone);addLine('p','n4',colorCone);// up
  addLine('u1','u2',colorUp);addLine('u2','u3',colorUp);addLine('u3','u1',colorUp);// target
  addLine('c','t',colorTarget);addLine('p','c',colorCross);// cross
  addLine('cn1','cn2',colorCross);addLine('cn3','cn4',colorCross);addLine('cf1','cf2',colorCross);addLine('cf3','cf4',colorCross);function addLine(a,b,color){addPoint(a,color);addPoint(b,color);}function addPoint(id,color){vertices.push(0,0,0);colors.push(color.r,color.g,color.b);if(pointMap[id]===undefined){pointMap[id]=[];}pointMap[id].push(vertices.length/3-1);}geometry.addAttribute('position',new Float32BufferAttribute(vertices,3));geometry.addAttribute('color',new Float32BufferAttribute(colors,3));LineSegments.call(this,geometry,material);this.camera=camera;if(this.camera.updateProjectionMatrix){this.camera.updateProjectionMatrix();}this.matrix=camera.matrixWorld;this.matrixAutoUpdate=false;this.pointMap=pointMap;this.update();}CameraHelper.prototype=Object.create(LineSegments.prototype);CameraHelper.prototype.constructor=CameraHelper;CameraHelper.prototype.update=function(){var geometry,pointMap;var vector=new Vector3$1();var camera=new Camera();function setPoint(point,x,y,z){vector.set(x,y,z).unproject(camera);var points=pointMap[point];if(points!==undefined){var position=geometry.getAttribute('position');for(var i=0,l=points.length;i<l;i++){position.setXYZ(points[i],vector.x,vector.y,vector.z);}}}return function update(){geometry=this.geometry;pointMap=this.pointMap;var w=1,h=1;// we need just camera projection matrix
  // world matrix must be identity
  camera.projectionMatrix.copy(this.camera.projectionMatrix);// center / target
  setPoint('c',0,0,-1);setPoint('t',0,0,1);// near
  setPoint('n1',-w,-h,-1);setPoint('n2',w,-h,-1);setPoint('n3',-w,h,-1);setPoint('n4',w,h,-1);// far
  setPoint('f1',-w,-h,1);setPoint('f2',w,-h,1);setPoint('f3',-w,h,1);setPoint('f4',w,h,1);// up
  setPoint('u1',w*0.7,h*1.1,-1);setPoint('u2',-w*0.7,h*1.1,-1);setPoint('u3',0,h*2,-1);// cross
  setPoint('cf1',-w,0,1);setPoint('cf2',w,0,1);setPoint('cf3',0,-h,1);setPoint('cf4',0,h,1);setPoint('cn1',-w,0,-1);setPoint('cn2',w,0,-1);setPoint('cn3',0,-h,-1);setPoint('cn4',0,h,-1);geometry.getAttribute('position').needsUpdate=true;};}();/**
   * @author alteredq / http://alteredqualia.com/
   * @author mrdoob / http://mrdoob.com/
   * @author WestLangley / http://github.com/WestLangley
   */function DirectionalLightHelper(light,size,color){Object3D.call(this);this.light=light;this.light.updateMatrixWorld();this.matrix=light.matrixWorld;this.matrixAutoUpdate=false;this.color=color;if(size===undefined){size=1;}var geometry=new BufferGeometry();geometry.addAttribute('position',new Float32BufferAttribute([-size,size,0,size,size,0,size,-size,0,-size,-size,0,-size,size,0],3));var material=new LineBasicMaterial$1({fog:false});this.lightPlane=new Line$1(geometry,material);this.add(this.lightPlane);geometry=new BufferGeometry();geometry.addAttribute('position',new Float32BufferAttribute([0,0,0,0,0,1],3));this.targetLine=new Line$1(geometry,material);this.add(this.targetLine);this.update();}DirectionalLightHelper.prototype=Object.create(Object3D.prototype);DirectionalLightHelper.prototype.constructor=DirectionalLightHelper;DirectionalLightHelper.prototype.dispose=function(){this.lightPlane.geometry.dispose();this.lightPlane.material.dispose();this.targetLine.geometry.dispose();this.targetLine.material.dispose();};DirectionalLightHelper.prototype.update=function(){var v1=new Vector3$1();var v2=new Vector3$1();var v3=new Vector3$1();return function update(){v1.setFromMatrixPosition(this.light.matrixWorld);v2.setFromMatrixPosition(this.light.target.matrixWorld);v3.subVectors(v2,v1);this.lightPlane.lookAt(v3);if(this.color!==undefined){this.lightPlane.material.color.set(this.color);this.targetLine.material.color.set(this.color);}else{this.lightPlane.material.color.copy(this.light.color);this.targetLine.material.color.copy(this.light.color);}this.targetLine.lookAt(v3);this.targetLine.scale.z=v3.length();};}();/**
   * @author mrdoob / http://mrdoob.com/
   * @author WestLangley / http://github.com/WestLangley
   */function FaceNormalsHelper(object,size,hex,linewidth){// FaceNormalsHelper only supports THREE.Geometry
  this.object=object;this.size=size!==undefined?size:1;var color=hex!==undefined?hex:0xffff00;var width=linewidth!==undefined?linewidth:1;//
  var nNormals=0;var objGeometry=this.object.geometry;if(objGeometry&&objGeometry.isGeometry){nNormals=objGeometry.faces.length;}else{console.warn('THREE.FaceNormalsHelper: only THREE.Geometry is supported. Use THREE.VertexNormalsHelper, instead.');}//
  var geometry=new BufferGeometry();var positions=new Float32BufferAttribute(nNormals*2*3,3);geometry.addAttribute('position',positions);LineSegments.call(this,geometry,new LineBasicMaterial$1({color:color,linewidth:width}));//
  this.matrixAutoUpdate=false;this.update();}FaceNormalsHelper.prototype=Object.create(LineSegments.prototype);FaceNormalsHelper.prototype.constructor=FaceNormalsHelper;FaceNormalsHelper.prototype.update=function(){var v1=new Vector3$1();var v2=new Vector3$1();var normalMatrix=new Matrix3$1();return function update(){var this$1=this;this.object.updateMatrixWorld(true);normalMatrix.getNormalMatrix(this.object.matrixWorld);var matrixWorld=this.object.matrixWorld;var position=this.geometry.attributes.position;//
  var objGeometry=this.object.geometry;var vertices=objGeometry.vertices;var faces=objGeometry.faces;var idx=0;for(var i=0,l=faces.length;i<l;i++){var face=faces[i];var normal=face.normal;v1.copy(vertices[face.a]).add(vertices[face.b]).add(vertices[face.c]).divideScalar(3).applyMatrix4(matrixWorld);v2.copy(normal).applyMatrix3(normalMatrix).normalize().multiplyScalar(this$1.size).add(v1);position.setXYZ(idx,v1.x,v1.y,v1.z);idx=idx+1;position.setXYZ(idx,v2.x,v2.y,v2.z);idx=idx+1;}position.needsUpdate=true;};}();/**
   * @author alteredq / http://alteredqualia.com/
   * @author mrdoob / http://mrdoob.com/
   * @author Mugen87 / https://github.com/Mugen87
   */function HemisphereLightHelper(light,size,color){Object3D.call(this);this.light=light;this.light.updateMatrixWorld();this.matrix=light.matrixWorld;this.matrixAutoUpdate=false;this.color=color;var geometry=new OctahedronBufferGeometry(size);geometry.rotateY(Math.PI*0.5);this.material=new MeshBasicMaterial({wireframe:true,fog:false});if(this.color===undefined){this.material.vertexColors=VertexColors;}var position=geometry.getAttribute('position');var colors=new Float32Array(position.count*3);geometry.addAttribute('color',new BufferAttribute(colors,3));this.add(new Mesh(geometry,this.material));this.update();}HemisphereLightHelper.prototype=Object.create(Object3D.prototype);HemisphereLightHelper.prototype.constructor=HemisphereLightHelper;HemisphereLightHelper.prototype.dispose=function(){this.children[0].geometry.dispose();this.children[0].material.dispose();};HemisphereLightHelper.prototype.update=function(){var vector=new Vector3$1();var color1=new Color$1();var color2=new Color$1();return function update(){var mesh=this.children[0];if(this.color!==undefined){this.material.color.set(this.color);}else{var colors=mesh.geometry.getAttribute('color');color1.copy(this.light.color);color2.copy(this.light.groundColor);for(var i=0,l=colors.count;i<l;i++){var color=i<l/2?color1:color2;colors.setXYZ(i,color.r,color.g,color.b);}colors.needsUpdate=true;}mesh.lookAt(vector.setFromMatrixPosition(this.light.matrixWorld).negate());};}();/**
   * @author WestLangley / http://github.com/WestLangley
   */function PlaneHelper(plane,size,hex){this.type='PlaneHelper';this.plane=plane;this.size=size===undefined?1:size;var color=hex!==undefined?hex:0xffff00;var positions=[1,-1,1,-1,1,1,-1,-1,1,1,1,1,-1,1,1,-1,-1,1,1,-1,1,1,1,1,0,0,1,0,0,0];var geometry=new BufferGeometry();geometry.addAttribute('position',new Float32BufferAttribute(positions,3));geometry.computeBoundingSphere();Line$1.call(this,geometry,new LineBasicMaterial$1({color:color}));//
  var positions2=[1,1,1,-1,1,1,-1,-1,1,1,1,1,-1,-1,1,1,-1,1];var geometry2=new BufferGeometry();geometry2.addAttribute('position',new Float32BufferAttribute(positions2,3));geometry2.computeBoundingSphere();this.add(new Mesh(geometry2,new MeshBasicMaterial({color:color,opacity:0.2,transparent:true,depthWrite:false})));}PlaneHelper.prototype=Object.create(Line$1.prototype);PlaneHelper.prototype.constructor=PlaneHelper;PlaneHelper.prototype.updateMatrixWorld=function(force){var scale=-this.plane.constant;if(Math.abs(scale)<1e-8){scale=1e-8;}// sign does not matter
  this.scale.set(0.5*this.size,0.5*this.size,scale);this.lookAt(this.plane.normal);Object3D.prototype.updateMatrixWorld.call(this,force);};/**
   * @author alteredq / http://alteredqualia.com/
   * @author mrdoob / http://mrdoob.com/
   */function PointLightHelper(light,sphereSize,color){this.light=light;this.light.updateMatrixWorld();this.color=color;var geometry=new SphereBufferGeometry(sphereSize,4,2);var material=new MeshBasicMaterial({wireframe:true,fog:false});Mesh.call(this,geometry,material);this.matrix=this.light.matrixWorld;this.matrixAutoUpdate=false;this.update();/*
  	var distanceGeometry = new THREE.IcosahedronGeometry( 1, 2 );
  	var distanceMaterial = new THREE.MeshBasicMaterial( { color: hexColor, fog: false, wireframe: true, opacity: 0.1, transparent: true } );

  	this.lightSphere = new THREE.Mesh( bulbGeometry, bulbMaterial );
  	this.lightDistance = new THREE.Mesh( distanceGeometry, distanceMaterial );

  	var d = light.distance;

  	if ( d === 0.0 ) {

  		this.lightDistance.visible = false;

  	} else {

  		this.lightDistance.scale.set( d, d, d );

  	}

  	this.add( this.lightDistance );
  	*/}PointLightHelper.prototype=Object.create(Mesh.prototype);PointLightHelper.prototype.constructor=PointLightHelper;PointLightHelper.prototype.dispose=function(){this.geometry.dispose();this.material.dispose();};PointLightHelper.prototype.update=function(){if(this.color!==undefined){this.material.color.set(this.color);}else{this.material.color.copy(this.light.color);}/*
  	var d = this.light.distance;

  	if ( d === 0.0 ) {

  		this.lightDistance.visible = false;

  	} else {

  		this.lightDistance.visible = true;
  		this.lightDistance.scale.set( d, d, d );

  	}
  	*/};/**
   * @author mrdoob / http://mrdoob.com/
   * @author Mugen87 / http://github.com/Mugen87
   * @author Hectate / http://www.github.com/Hectate
   */function PolarGridHelper(radius,radials,circles,divisions,color1,color2){radius=radius||10;radials=radials||16;circles=circles||8;divisions=divisions||64;color1=new Color$1(color1!==undefined?color1:0x444444);color2=new Color$1(color2!==undefined?color2:0x888888);var vertices=[];var colors=[];var x,z;var v,i,j,r,color;// create the radials
  for(i=0;i<=radials;i++){v=i/radials*(Math.PI*2);x=Math.sin(v)*radius;z=Math.cos(v)*radius;vertices.push(0,0,0);vertices.push(x,0,z);color=i&1?color1:color2;colors.push(color.r,color.g,color.b);colors.push(color.r,color.g,color.b);}// create the circles
  for(i=0;i<=circles;i++){color=i&1?color1:color2;r=radius-radius/circles*i;for(j=0;j<divisions;j++){// first vertex
  v=j/divisions*(Math.PI*2);x=Math.sin(v)*r;z=Math.cos(v)*r;vertices.push(x,0,z);colors.push(color.r,color.g,color.b);// second vertex
  v=(j+1)/divisions*(Math.PI*2);x=Math.sin(v)*r;z=Math.cos(v)*r;vertices.push(x,0,z);colors.push(color.r,color.g,color.b);}}var geometry=new BufferGeometry();geometry.addAttribute('position',new Float32BufferAttribute(vertices,3));geometry.addAttribute('color',new Float32BufferAttribute(colors,3));var material=new LineBasicMaterial$1({vertexColors:VertexColors});LineSegments.call(this,geometry,material);}PolarGridHelper.prototype=Object.create(LineSegments.prototype);PolarGridHelper.prototype.constructor=PolarGridHelper;/**
   * @author abelnation / http://github.com/abelnation
   * @author Mugen87 / http://github.com/Mugen87
   * @author WestLangley / http://github.com/WestLangley
   */function RectAreaLightHelper(light,color){Object3D.call(this);this.light=light;this.light.updateMatrixWorld();this.matrix=light.matrixWorld;this.matrixAutoUpdate=false;this.color=color;var material=new LineBasicMaterial$1({fog:false});var geometry=new BufferGeometry();geometry.addAttribute('position',new BufferAttribute(new Float32Array(5*3),3));this.line=new Line$1(geometry,material);this.add(this.line);this.update();}RectAreaLightHelper.prototype=Object.create(Object3D.prototype);RectAreaLightHelper.prototype.constructor=RectAreaLightHelper;RectAreaLightHelper.prototype.dispose=function(){this.children[0].geometry.dispose();this.children[0].material.dispose();};RectAreaLightHelper.prototype.update=function(){// calculate new dimensions of the helper
  var hx=this.light.width*0.5;var hy=this.light.height*0.5;var position=this.line.geometry.attributes.position;var array=position.array;// update vertices
  array[0]=hx;array[1]=-hy;array[2]=0;array[3]=hx;array[4]=hy;array[5]=0;array[6]=-hx;array[7]=hy;array[8]=0;array[9]=-hx;array[10]=-hy;array[11]=0;array[12]=hx;array[13]=-hy;array[14]=0;position.needsUpdate=true;if(this.color!==undefined){this.line.material.color.set(this.color);}else{this.line.material.color.copy(this.light.color);}};/**
   * @author alteredq / http://alteredqualia.com/
   * @author mrdoob / http://mrdoob.com/
   * @author WestLangley / http://github.com/WestLangley
   */function SpotLightHelper(light,color){Object3D.call(this);this.light=light;this.light.updateMatrixWorld();this.matrix=light.matrixWorld;this.matrixAutoUpdate=false;this.color=color;var geometry=new BufferGeometry();var positions=[0,0,0,0,0,1,0,0,0,1,0,1,0,0,0,-1,0,1,0,0,0,0,1,1,0,0,0,0,-1,1];for(var i=0,j=1,l=32;i<l;i++, j++){var p1=i/l*Math.PI*2;var p2=j/l*Math.PI*2;positions.push(Math.cos(p1),Math.sin(p1),1,Math.cos(p2),Math.sin(p2),1);}geometry.addAttribute('position',new Float32BufferAttribute(positions,3));var material=new LineBasicMaterial$1({fog:false});this.cone=new LineSegments(geometry,material);this.add(this.cone);this.update();}SpotLightHelper.prototype=Object.create(Object3D.prototype);SpotLightHelper.prototype.constructor=SpotLightHelper;SpotLightHelper.prototype.dispose=function(){this.cone.geometry.dispose();this.cone.material.dispose();};SpotLightHelper.prototype.update=function(){var vector=new Vector3$1();var vector2=new Vector3$1();return function update(){this.light.updateMatrixWorld();var coneLength=this.light.distance?this.light.distance:1000;var coneWidth=coneLength*Math.tan(this.light.angle);this.cone.scale.set(coneWidth,coneWidth,coneLength);vector.setFromMatrixPosition(this.light.matrixWorld);vector2.setFromMatrixPosition(this.light.target.matrixWorld);this.cone.lookAt(vector2.sub(vector));if(this.color!==undefined){this.cone.material.color.set(this.color);}else{this.cone.material.color.copy(this.light.color);}};}();/**
   * @author mrdoob / http://mrdoob.com/
   * @author WestLangley / http://github.com/WestLangley
   */function VertexNormalsHelper(object,size,hex,linewidth){this.object=object;this.size=size!==undefined?size:1;var color=hex!==undefined?hex:0xff0000;var width=linewidth!==undefined?linewidth:1;//
  var nNormals=0;var objGeometry=this.object.geometry;if(objGeometry&&objGeometry.isGeometry){nNormals=objGeometry.faces.length*3;}else if(objGeometry&&objGeometry.isBufferGeometry){nNormals=objGeometry.attributes.normal.count;}//
  var geometry=new BufferGeometry();var positions=new Float32BufferAttribute(nNormals*2*3,3);geometry.addAttribute('position',positions);LineSegments.call(this,geometry,new LineBasicMaterial$1({color:color,linewidth:width}));//
  this.matrixAutoUpdate=false;this.update();}VertexNormalsHelper.prototype=Object.create(LineSegments.prototype);VertexNormalsHelper.prototype.constructor=VertexNormalsHelper;VertexNormalsHelper.prototype.update=function(){var v1=new Vector3$1();var v2=new Vector3$1();var normalMatrix=new Matrix3$1();return function update(){var this$1=this;var keys=['a','b','c'];this.object.updateMatrixWorld(true);normalMatrix.getNormalMatrix(this.object.matrixWorld);var matrixWorld=this.object.matrixWorld;var position=this.geometry.attributes.position;//
  var objGeometry=this.object.geometry;if(objGeometry&&objGeometry.isGeometry){var vertices=objGeometry.vertices;var faces=objGeometry.faces;var idx=0;for(var i=0,l=faces.length;i<l;i++){var face=faces[i];for(var j=0,jl=face.vertexNormals.length;j<jl;j++){var vertex=vertices[face[keys[j]]];var normal=face.vertexNormals[j];v1.copy(vertex).applyMatrix4(matrixWorld);v2.copy(normal).applyMatrix3(normalMatrix).normalize().multiplyScalar(this$1.size).add(v1);position.setXYZ(idx,v1.x,v1.y,v1.z);idx=idx+1;position.setXYZ(idx,v2.x,v2.y,v2.z);idx=idx+1;}}}else if(objGeometry&&objGeometry.isBufferGeometry){var objPos=objGeometry.attributes.position;var objNorm=objGeometry.attributes.normal;var idx=0;// for simplicity, ignore index and drawcalls, and render every normal
  for(var j=0,jl=objPos.count;j<jl;j++){v1.set(objPos.getX(j),objPos.getY(j),objPos.getZ(j)).applyMatrix4(matrixWorld);v2.set(objNorm.getX(j),objNorm.getY(j),objNorm.getZ(j));v2.applyMatrix3(normalMatrix).normalize().multiplyScalar(this$1.size).add(v1);position.setXYZ(idx,v1.x,v1.y,v1.z);idx=idx+1;position.setXYZ(idx,v2.x,v2.y,v2.z);idx=idx+1;}}position.needsUpdate=true;};}();/**
   * @author abelnation / http://github.com/abelnation
   */function RectAreaLight(color,intensity,width,height){Light.call(this,color,intensity);this.type='RectAreaLight';this.position.set(0,1,0);this.updateMatrix();this.width=width!==undefined?width:10;this.height=height!==undefined?height:10;// TODO (abelnation): distance/decay
  // TODO (abelnation): update method for RectAreaLight to update transform to lookat target
  // TODO (abelnation): shadows
  }// TODO (abelnation): RectAreaLight update when light shape is changed
  RectAreaLight.prototype=Object.assign(Object.create(Light.prototype),{constructor:RectAreaLight,isRectAreaLight:true,copy:function copy(source){Light.prototype.copy.call(this,source);this.width=source.width;this.height=source.height;return this;},toJSON:function toJSON(meta){var data=Light.prototype.toJSON.call(this,meta);data.object.width=this.width;data.object.height=this.height;return data;}});/**
   * @author bhouston / http://clara.io/
   */function AnimationLoader(manager){this.manager=manager!==undefined?manager:DefaultLoadingManager;}Object.assign(AnimationLoader.prototype,{load:function load(url,onLoad,onProgress,onError){var scope=this;var loader=new FileLoader(scope.manager);loader.load(url,function(text){onLoad(scope.parse(JSON.parse(text)));},onProgress,onError);},parse:function parse(json,onLoad){var animations=[];for(var i=0;i<json.length;i++){var clip=AnimationClip$1.parse(json[i]);animations.push(clip);}onLoad(animations);}});/**
   * @author mrdoob / http://mrdoob.com/
   */function BufferGeometryLoader(manager){this.manager=manager!==undefined?manager:DefaultLoadingManager;}Object.assign(BufferGeometryLoader.prototype,{load:function load(url,onLoad,onProgress,onError){var scope=this;var loader=new FileLoader(scope.manager);loader.load(url,function(text){onLoad(scope.parse(JSON.parse(text)));},onProgress,onError);},parse:function parse(json){var geometry=new BufferGeometry();var index=json.data.index;if(index!==undefined){var typedArray=new TYPED_ARRAYS[index.type](index.array);geometry.setIndex(new BufferAttribute(typedArray,1));}var attributes=json.data.attributes;for(var key in attributes){var attribute=attributes[key];var typedArray=new TYPED_ARRAYS[attribute.type](attribute.array);geometry.addAttribute(key,new BufferAttribute(typedArray,attribute.itemSize,attribute.normalized));}var groups=json.data.groups||json.data.drawcalls||json.data.offsets;if(groups!==undefined){for(var i=0,n=groups.length;i!==n;++i){var group=groups[i];geometry.addGroup(group.start,group.count,group.materialIndex);}}var boundingSphere=json.data.boundingSphere;if(boundingSphere!==undefined){var center=new Vector3$1();if(boundingSphere.center!==undefined){center.fromArray(boundingSphere.center);}geometry.boundingSphere=new Sphere(center,boundingSphere.radius);}return geometry;}});var TYPED_ARRAYS={Int8Array:Int8Array,Uint8Array:Uint8Array,// Workaround for IE11 pre KB2929437. See #11440
  Uint8ClampedArray:typeof Uint8ClampedArray!=='undefined'?Uint8ClampedArray:Uint8Array,Int16Array:Int16Array,Uint16Array:Uint16Array,Int32Array:Int32Array,Uint32Array:Uint32Array,Float32Array:Float32Array,Float64Array:Float64Array};/**
   * @author mrdoob / http://mrdoob.com/
   */function FontLoader(manager){this.manager=manager!==undefined?manager:DefaultLoadingManager;}Object.assign(FontLoader.prototype,{load:function load(url,onLoad,onProgress,onError){var scope=this;var loader=new FileLoader(this.manager);loader.setPath(this.path);loader.load(url,function(text){var json;try{json=JSON.parse(text);}catch(e){console.warn('THREE.FontLoader: typeface.js support is being deprecated. Use typeface.json instead.');json=JSON.parse(text.substring(65,text.length-2));}var font=scope.parse(json);if(onLoad){onLoad(font);}},onProgress,onError);},parse:function parse(json){return new Font(json);},setPath:function setPath(value){this.path=value;return this;}});/**
   * @author thespite / http://clicktorelease.com/
   */function Fog(color,near,far){this.name='';this.color=new Color$1(color);this.near=near!==undefined?near:1;this.far=far!==undefined?far:1000;}Fog.prototype.isFog=true;Fog.prototype.clone=function(){return new Fog(this.color.getHex(),this.near,this.far);};Fog.prototype.toJSON=function()/* meta */{return{type:'Fog',color:this.color.getHex(),near:this.near,far:this.far};};/**
   * @author mrdoob / http://mrdoob.com/
   * @author alteredq / http://alteredqualia.com/
   */function FogExp2(color,density){this.name='';this.color=new Color$1(color);this.density=density!==undefined?density:0.00025;}FogExp2.prototype.isFogExp2=true;FogExp2.prototype.clone=function(){return new FogExp2(this.color.getHex(),this.density);};FogExp2.prototype.toJSON=function()/* meta */{return{type:'FogExp2',color:this.color.getHex(),density:this.density};};/**
   * @author mrdoob / http://mrdoob.com/
   */function ObjectLoader(manager){this.manager=manager!==undefined?manager:DefaultLoadingManager;this.texturePath='';}Object.assign(ObjectLoader.prototype,{load:function load(url,onLoad,onProgress,onError){if(this.texturePath===''){this.texturePath=url.substring(0,url.lastIndexOf('/')+1);}var scope=this;var loader=new FileLoader(scope.manager);loader.load(url,function(text){var json=null;try{json=JSON.parse(text);}catch(error){if(onError!==undefined){onError(error);}console.error('THREE:ObjectLoader: Can\'t parse '+url+'.',error.message);return;}var metadata=json.metadata;if(metadata===undefined||metadata.type===undefined||metadata.type.toLowerCase()==='geometry'){console.error('THREE.ObjectLoader: Can\'t load '+url+'. Use THREE.JSONLoader instead.');return;}scope.parse(json,onLoad);},onProgress,onError);},setTexturePath:function setTexturePath(value){this.texturePath=value;},setCrossOrigin:function setCrossOrigin(value){this.crossOrigin=value;},parse:function parse(json,onLoad){var shapes=this.parseShape(json.shapes);var geometries=this.parseGeometries(json.geometries,shapes);var images=this.parseImages(json.images,function(){if(onLoad!==undefined){onLoad(object);}});var textures=this.parseTextures(json.textures,images);var materials=this.parseMaterials(json.materials,textures);var object=this.parseObject(json.object,geometries,materials);if(json.animations){object.animations=this.parseAnimations(json.animations);}if(json.images===undefined||json.images.length===0){if(onLoad!==undefined){onLoad(object);}}return object;},parseShape:function parseShape(json){var shapes={};if(json!==undefined){for(var i=0,l=json.length;i<l;i++){var shape=new Shape().fromJSON(json[i]);shapes[shape.uuid]=shape;}}return shapes;},parseGeometries:function parseGeometries(json,shapes){var this$1=this;var geometries={};if(json!==undefined){var geometryLoader=new JSONLoader();var bufferGeometryLoader=new BufferGeometryLoader();for(var i=0,l=json.length;i<l;i++){var geometry;var data=json[i];switch(data.type){case'PlaneGeometry':case'PlaneBufferGeometry':geometry=new Geometries[data.type](data.width,data.height,data.widthSegments,data.heightSegments);break;case'BoxGeometry':case'BoxBufferGeometry':case'CubeGeometry':// backwards compatible
  geometry=new Geometries[data.type](data.width,data.height,data.depth,data.widthSegments,data.heightSegments,data.depthSegments);break;case'CircleGeometry':case'CircleBufferGeometry':geometry=new Geometries[data.type](data.radius,data.segments,data.thetaStart,data.thetaLength);break;case'CylinderGeometry':case'CylinderBufferGeometry':geometry=new Geometries[data.type](data.radiusTop,data.radiusBottom,data.height,data.radialSegments,data.heightSegments,data.openEnded,data.thetaStart,data.thetaLength);break;case'ConeGeometry':case'ConeBufferGeometry':geometry=new Geometries[data.type](data.radius,data.height,data.radialSegments,data.heightSegments,data.openEnded,data.thetaStart,data.thetaLength);break;case'SphereGeometry':case'SphereBufferGeometry':geometry=new Geometries[data.type](data.radius,data.widthSegments,data.heightSegments,data.phiStart,data.phiLength,data.thetaStart,data.thetaLength);break;case'DodecahedronGeometry':case'DodecahedronBufferGeometry':case'IcosahedronGeometry':case'IcosahedronBufferGeometry':case'OctahedronGeometry':case'OctahedronBufferGeometry':case'TetrahedronGeometry':case'TetrahedronBufferGeometry':geometry=new Geometries[data.type](data.radius,data.detail);break;case'RingGeometry':case'RingBufferGeometry':geometry=new Geometries[data.type](data.innerRadius,data.outerRadius,data.thetaSegments,data.phiSegments,data.thetaStart,data.thetaLength);break;case'TorusGeometry':case'TorusBufferGeometry':geometry=new Geometries[data.type](data.radius,data.tube,data.radialSegments,data.tubularSegments,data.arc);break;case'TorusKnotGeometry':case'TorusKnotBufferGeometry':geometry=new Geometries[data.type](data.radius,data.tube,data.tubularSegments,data.radialSegments,data.p,data.q);break;case'LatheGeometry':case'LatheBufferGeometry':geometry=new Geometries[data.type](data.points,data.segments,data.phiStart,data.phiLength);break;case'PolyhedronGeometry':case'PolyhedronBufferGeometry':geometry=new Geometries[data.type](data.vertices,data.indices,data.radius,data.details);break;case'ShapeGeometry':case'ShapeBufferGeometry':var geometryShapes=[];for(var i=0,l=data.shapes.length;i<l;i++){var shape=shapes[data.shapes[i]];geometryShapes.push(shape);}geometry=new Geometries[data.type](geometryShapes,data.curveSegments);break;case'BufferGeometry':geometry=bufferGeometryLoader.parse(data);break;case'Geometry':geometry=geometryLoader.parse(data,this$1.texturePath).geometry;break;default:console.warn('THREE.ObjectLoader: Unsupported geometry type "'+data.type+'"');continue;}geometry.uuid=data.uuid;if(data.name!==undefined){geometry.name=data.name;}geometries[data.uuid]=geometry;}}return geometries;},parseMaterials:function parseMaterials(json,textures){var materials={};if(json!==undefined){var loader=new MaterialLoader();loader.setTextures(textures);for(var i=0,l=json.length;i<l;i++){var data=json[i];if(data.type==='MultiMaterial'){// Deprecated
  var array=[];for(var j=0;j<data.materials.length;j++){array.push(loader.parse(data.materials[j]));}materials[data.uuid]=array;}else{materials[data.uuid]=loader.parse(data);}}}return materials;},parseAnimations:function parseAnimations(json){var animations=[];for(var i=0;i<json.length;i++){var clip=AnimationClip$1.parse(json[i]);animations.push(clip);}return animations;},parseImages:function parseImages(json,onLoad){var scope=this;var images={};function loadImage(url){scope.manager.itemStart(url);return loader.load(url,function(){scope.manager.itemEnd(url);},undefined,function(){scope.manager.itemEnd(url);scope.manager.itemError(url);});}if(json!==undefined&&json.length>0){var manager=new LoadingManager(onLoad);var loader=new ImageLoader(manager);loader.setCrossOrigin(this.crossOrigin);for(var i=0,l=json.length;i<l;i++){var image=json[i];var path=/^(\/\/)|([a-z]+:(\/\/)?)/i.test(image.url)?image.url:scope.texturePath+image.url;images[image.uuid]=loadImage(path);}}return images;},parseTextures:function parseTextures(json,images){function parseConstant(value,type){if(typeof value==='number'){return value;}console.warn('THREE.ObjectLoader.parseTexture: Constant should be in numeric form.',value);return type[value];}var textures={};if(json!==undefined){for(var i=0,l=json.length;i<l;i++){var data=json[i];if(data.image===undefined){console.warn('THREE.ObjectLoader: No "image" specified for',data.uuid);}if(images[data.image]===undefined){console.warn('THREE.ObjectLoader: Undefined image',data.image);}var texture=new Texture$1(images[data.image]);texture.needsUpdate=true;texture.uuid=data.uuid;if(data.name!==undefined){texture.name=data.name;}if(data.mapping!==undefined){texture.mapping=parseConstant(data.mapping,TEXTURE_MAPPING);}if(data.offset!==undefined){texture.offset.fromArray(data.offset);}if(data.repeat!==undefined){texture.repeat.fromArray(data.repeat);}if(data.center!==undefined){texture.center.fromArray(data.center);}if(data.rotation!==undefined){texture.rotation=data.rotation;}if(data.wrap!==undefined){texture.wrapS=parseConstant(data.wrap[0],TEXTURE_WRAPPING);texture.wrapT=parseConstant(data.wrap[1],TEXTURE_WRAPPING);}if(data.minFilter!==undefined){texture.minFilter=parseConstant(data.minFilter,TEXTURE_FILTER);}if(data.magFilter!==undefined){texture.magFilter=parseConstant(data.magFilter,TEXTURE_FILTER);}if(data.anisotropy!==undefined){texture.anisotropy=data.anisotropy;}if(data.flipY!==undefined){texture.flipY=data.flipY;}textures[data.uuid]=texture;}}return textures;},parseObject:function(){var matrix=new Matrix4();return function parseObject(data,geometries,materials){var this$1=this;var object;function getGeometry(name){if(geometries[name]===undefined){console.warn('THREE.ObjectLoader: Undefined geometry',name);}return geometries[name];}function getMaterial(name){if(name===undefined){return undefined;}if(Array.isArray(name)){var array=[];for(var i=0,l=name.length;i<l;i++){var uuid=name[i];if(materials[uuid]===undefined){console.warn('THREE.ObjectLoader: Undefined material',uuid);}array.push(materials[uuid]);}return array;}if(materials[name]===undefined){console.warn('THREE.ObjectLoader: Undefined material',name);}return materials[name];}switch(data.type){case'Scene':object=new Scene();if(data.background!==undefined){if(Number.isInteger(data.background)){object.background=new Color$1(data.background);}}if(data.fog!==undefined){if(data.fog.type==='Fog'){object.fog=new Fog(data.fog.color,data.fog.near,data.fog.far);}else if(data.fog.type==='FogExp2'){object.fog=new FogExp2(data.fog.color,data.fog.density);}}break;case'PerspectiveCamera':object=new PerspectiveCamera(data.fov,data.aspect,data.near,data.far);if(data.focus!==undefined){object.focus=data.focus;}if(data.zoom!==undefined){object.zoom=data.zoom;}if(data.filmGauge!==undefined){object.filmGauge=data.filmGauge;}if(data.filmOffset!==undefined){object.filmOffset=data.filmOffset;}if(data.view!==undefined){object.view=Object.assign({},data.view);}break;case'OrthographicCamera':object=new OrthographicCamera(data.left,data.right,data.top,data.bottom,data.near,data.far);break;case'AmbientLight':object=new AmbientLight(data.color,data.intensity);break;case'DirectionalLight':object=new DirectionalLight(data.color,data.intensity);break;case'PointLight':object=new PointLight(data.color,data.intensity,data.distance,data.decay);break;case'RectAreaLight':object=new RectAreaLight(data.color,data.intensity,data.width,data.height);break;case'SpotLight':object=new SpotLight(data.color,data.intensity,data.distance,data.angle,data.penumbra,data.decay);break;case'HemisphereLight':object=new HemisphereLight(data.color,data.groundColor,data.intensity);break;case'SkinnedMesh':console.warn('THREE.ObjectLoader.parseObject() does not support SkinnedMesh yet.');case'Mesh':var geometry=getGeometry(data.geometry);var material=getMaterial(data.material);if(geometry.bones&&geometry.bones.length>0){object=new SkinnedMesh(geometry,material);}else{object=new Mesh(geometry,material);}break;case'LOD':object=new LOD();break;case'Line':object=new Line$1(getGeometry(data.geometry),getMaterial(data.material),data.mode);break;case'LineLoop':object=new LineLoop(getGeometry(data.geometry),getMaterial(data.material));break;case'LineSegments':object=new LineSegments(getGeometry(data.geometry),getMaterial(data.material));break;case'PointCloud':case'Points':object=new Points(getGeometry(data.geometry),getMaterial(data.material));break;case'Sprite':object=new Sprite(getMaterial(data.material));break;case'Group':object=new Group();break;default:object=new Object3D();}object.uuid=data.uuid;if(data.name!==undefined){object.name=data.name;}if(data.matrix!==undefined){matrix.fromArray(data.matrix);matrix.decompose(object.position,object.quaternion,object.scale);}else{if(data.position!==undefined){object.position.fromArray(data.position);}if(data.rotation!==undefined){object.rotation.fromArray(data.rotation);}if(data.quaternion!==undefined){object.quaternion.fromArray(data.quaternion);}if(data.scale!==undefined){object.scale.fromArray(data.scale);}}if(data.castShadow!==undefined){object.castShadow=data.castShadow;}if(data.receiveShadow!==undefined){object.receiveShadow=data.receiveShadow;}if(data.shadow){if(data.shadow.bias!==undefined){object.shadow.bias=data.shadow.bias;}if(data.shadow.radius!==undefined){object.shadow.radius=data.shadow.radius;}if(data.shadow.mapSize!==undefined){object.shadow.mapSize.fromArray(data.shadow.mapSize);}if(data.shadow.camera!==undefined){object.shadow.camera=this.parseObject(data.shadow.camera);}}if(data.visible!==undefined){object.visible=data.visible;}if(data.userData!==undefined){object.userData=data.userData;}if(data.children!==undefined){var children=data.children;for(var i=0;i<children.length;i++){object.add(this$1.parseObject(children[i],geometries,materials));}}if(data.type==='LOD'){var levels=data.levels;for(var l=0;l<levels.length;l++){var level=levels[l];var child=object.getObjectByProperty('uuid',level.object);if(child!==undefined){object.addLevel(child,level.distance);}}}return object;};}()});var TEXTURE_MAPPING={UVMapping:UVMapping,CubeReflectionMapping:CubeReflectionMapping,CubeRefractionMapping:CubeRefractionMapping,EquirectangularReflectionMapping:EquirectangularReflectionMapping,EquirectangularRefractionMapping:EquirectangularRefractionMapping,SphericalReflectionMapping:SphericalReflectionMapping,CubeUVReflectionMapping:CubeUVReflectionMapping,CubeUVRefractionMapping:CubeUVRefractionMapping};var TEXTURE_WRAPPING={RepeatWrapping:RepeatWrapping,ClampToEdgeWrapping:ClampToEdgeWrapping,MirroredRepeatWrapping:MirroredRepeatWrapping};var TEXTURE_FILTER={NearestFilter:NearestFilter,NearestMipMapNearestFilter:NearestMipMapNearestFilter,NearestMipMapLinearFilter:NearestMipMapLinearFilter,LinearFilter:LinearFilter,LinearMipMapNearestFilter:LinearMipMapNearestFilter,LinearMipMapLinearFilter:LinearMipMapLinearFilter};/**
   * @author Mugen87 / https://github.com/Mugen87
   *
   * Ref: https://en.wikipedia.org/wiki/Cylindrical_coordinate_system
   *
   */function Cylindrical(radius,theta,y){this.radius=radius!==undefined?radius:1.0;// distance from the origin to a point in the x-z plane
  this.theta=theta!==undefined?theta:0;// counterclockwise angle in the x-z plane measured in radians from the positive z-axis
  this.y=y!==undefined?y:0;// height above the x-z plane
  return this;}Object.assign(Cylindrical.prototype,{set:function set$$1(radius,theta,y){this.radius=radius;this.theta=theta;this.y=y;return this;},clone:function clone(){return new this.constructor().copy(this);},copy:function copy(other){this.radius=other.radius;this.theta=other.theta;this.y=other.y;return this;},setFromVector3:function setFromVector3(vec3){this.radius=Math.sqrt(vec3.x*vec3.x+vec3.z*vec3.z);this.theta=Math.atan2(vec3.x,vec3.z);this.y=vec3.y;return this;}});/**
   * @author mikael emtinger / http://gomo.se/
   * @author alteredq / http://alteredqualia.com/
   */function LensFlare(texture,size,distance,blending,color){Object3D.call(this);this.lensFlares=[];this.positionScreen=new Vector3$1();this.customUpdateCallback=undefined;if(texture!==undefined){this.add(texture,size,distance,blending,color);}}LensFlare.prototype=Object.assign(Object.create(Object3D.prototype),{constructor:LensFlare,isLensFlare:true,copy:function copy(source){var this$1=this;Object3D.prototype.copy.call(this,source);this.positionScreen.copy(source.positionScreen);this.customUpdateCallback=source.customUpdateCallback;for(var i=0,l=source.lensFlares.length;i<l;i++){this$1.lensFlares.push(source.lensFlares[i]);}return this;},add:function add(texture,size,distance,blending,color,opacity){if(size===undefined){size=-1;}if(distance===undefined){distance=0;}if(opacity===undefined){opacity=1;}if(color===undefined){color=new Color$1(0xffffff);}if(blending===undefined){blending=NormalBlending;}distance=Math.min(distance,Math.max(0,distance));this.lensFlares.push({texture:texture,// THREE.Texture
  size:size,// size in pixels (-1 = use texture.width)
  distance:distance,// distance (0-1) from light source (0=at light source)
  x:0,y:0,z:0,// screen position (-1 => 1) z = 0 is in front z = 1 is back
  scale:1,// scale
  rotation:0,// rotation
  opacity:opacity,// opacity
  color:color,// color
  blending:blending// blending
  });},/*
  	 * Update lens flares update positions on all flares based on the screen position
  	 * Set myLensFlare.customUpdateCallback to alter the flares in your project specific way.
  	 */updateLensFlares:function updateLensFlares(){var this$1=this;var f,fl=this.lensFlares.length;var flare;var vecX=-this.positionScreen.x*2;var vecY=-this.positionScreen.y*2;for(f=0;f<fl;f++){flare=this$1.lensFlares[f];flare.x=this$1.positionScreen.x+vecX*flare.distance;flare.y=this$1.positionScreen.y+vecY*flare.distance;flare.wantedRotation=flare.x*Math.PI*0.25;flare.rotation+=(flare.wantedRotation-flare.rotation)*0.25;}}});/**
   * @author mrdoob / http://mrdoob.com/
   */function VideoTexture(video,mapping,wrapS,wrapT,magFilter,minFilter,format,type,anisotropy){Texture$1.call(this,video,mapping,wrapS,wrapT,magFilter,minFilter,format,type,anisotropy);this.generateMipmaps=false;// Set needsUpdate when first frame is ready
  var scope=this;function onLoaded(){video.removeEventListener('loadeddata',onLoaded,false);scope.needsUpdate=true;}video.addEventListener('loadeddata',onLoaded,false);}VideoTexture.prototype=Object.assign(Object.create(Texture$1.prototype),{constructor:VideoTexture,isVideoTexture:true,update:function update(){var video=this.image;if(video.readyState>=video.HAVE_CURRENT_DATA){this.needsUpdate=true;}}});// Made by Itee (https://github.com/Itee) with ES6 Convertor script
  /**
   * @author [Tristan Valcke]{@link https://github.com/Itee}
   * @license [BSD-3-Clause]{@link https://opensource.org/licenses/BSD-3-Clause}
   *//**
   * A freezed javascript object used like an enum.
   * @typedef {object} Enum
   * @example
   * const Foo = Object.freeze( {
   *     Bar: 0,
   *     Baz: 1,
   *     Qux: 3
   * } )
   *//**
   * @typedef {Enum} HttpVerb
   * @property {string} Create="PUT" - Corresponding to the create http verb for an itee server, namely "PUT".
   * @property {string} Read="POST" - Corresponding to the read http verb for an itee server, namely "POST".
   * @property {string} Update="PATCH" - Corresponding to the update http verb for an itee server, namely "PATCH".
   * @property {string} Delete="DELETE" - Corresponding to the delete http verb for an itee server, namely "DELETE".
   *
   * @constant
   * @type {HttpVerb}
   * @description HttpVerb contains the CRUD actions with corresponding http verb to request an itee server.
   * @see {@link https://en.wikipedia.org/wiki/Create,_read,_update_and_delete} for further information.
   */var HttpVerb=Object.freeze({Create:"PUT",Read:"POST",Update:"PATCH",Delete:"DELETE"});/**
   * @typedef {Enum} ResponseType
   * @property {string} ArrayBuffer="arraybuffer" - The "arraybuffer" server response type.
   * @property {string} Blob="blob" - The "blob" server response type.
   * @property {string} Document="document" - The "document" server response type.
   * @property {string} Json="json" - The "json" server response type.
   * @property {string} DOMString="text" - The "text" server response type.
   * @property {string} Default="text" - The "" server response type ( equivalent to DOMString ).
   *
   * @constant
   * @type {ResponseType}
   * @description ResponseType allow to filter wich type of response is recieved from the server.
   * @see {@link https://developer.mozilla.org/en-US/docs/Web/API/XMLHttpRequest/responseType} for further information.
   */var ResponseType=Object.freeze({ArrayBuffer:'arraybuffer',Blob:'blob',Document:'document',Json:'json',DOMString:'text',Default:''});/**
   * @typedef {Enum} HttpStatusCode
   * @property {number} Continue=100 - Waiting for the continuation of the request.
   * @property {number} SwitchingProtocols=101 - The requester has asked the server to switch protocols and the server has agreed to do so.
   * @property {number} Processing=102 - WebDAV: Processing in progress (prevents the client from exceeding the limited waiting time).
   * @property {number} Ok=200 - Query successfully processed.
   * @property {number} Created=201 - Query successfully processed and a document was created.
   * @property {number} Accepted=202 - Query processed, but without guarantee of result.
   * @property {number} NonAuthoritativeInformation=203 - Information returned, but generated by an uncertified source.
   * @property {number} NoContent=204 - Query successfully processed but no information returned.
   * @property {number} ResetContent=205 - Query successfully processed, the current page can be cleared.
   * @property {number} PartialContent=206 - Only part of the resource has been transmitted.
   * @property {number} MultiStatus=207 - WebDAV: Multiple Response.
   * @property {number} AlreadyReported=208 - WebDAV: The document was previously sent to this collection.
   * @property {number} ContentDifferent=210 - WebDAV: The copy of the client-side resource differs from that of the server (content or properties).
   * @property {number} IMUsed=226 - The server has completed the request for the resource, and the response is a representation of the result of one or more instance manipulations applied to the
   *     current instance.
   * @property {number} MultipleChoices=300 - The requested URI refers to multiple resources.
   * @property {number} MovedPermanently=301 - Document moved permanently.
   * @property {number} Found=302 - Document moved temporarily.
   * @property {number} SeeOther=303 - The answer to this query is elsewhere.
   * @property {number} NotModified=304 - Document not modified since the last request.
   * @property {number} UseProxy=305 - The request must be re-addressed to the proxy.
   * @property {number} Unused=306 - Code used by an older version of RFC 2616, now reserved.
   * @property {number} TemporaryRedirect=307 - The request must be temporarily redirected to the specified URI.
   * @property {number} PermanentRedirect=308 - The request must be redirected permanently to the specified URI.
   * @property {number} TooManyRedirects=310 - The request must be redirected too many times, or is the victim of a redirection loop.
   * @property {number} BadRequest=400 - The syntax of the query is wrong.
   * @property {number} Unauthorized=401 - Authentication is required to access the resource.
   * @property {number} PaymentRequired=402 - Payment required to access the resource.
   * @property {number} Forbidden=403 - The server understood the request, but refuses to execute it. Unlike error 401, authenticating will not make any difference. On servers where authentication is
   *     required, this usually means that authentication has been accepted but access rights do not allow the client to access the resource.
   * @property {number} NotFound=404 - Resource not found.
   * @property {number} MethodNotAllowed=405 - Unauthorized request method.
   * @property {number} NotAcceptable=406 - The requested resource is not available in a format that would respect the "Accept" headers of the request.
   * @property {number} ProxyAuthenticationRequired=407 - Access to the authorized resource by identification with the proxy.
   * @property {number} RequestTimeOut=408 - Waiting time for an elapsed client request.
   * @property {number} Conflict=409 - The request can not be processed in the current state.
   * @property {number} Gone=410 - The resource is no longer available and no redirection address is known.
   * @property {number} LengthRequired=411 - The length of the request has not been specified.
   * @property {number} PreconditionFailed=412 - Preconditions sent by the query unverified.
   * @property {number} RequestEntityTooLarge=413 - Abandoned processing due to excessive request
   * @property {number} RequestURITooLong=414 - URI too long
   * @property {number} UnsupportedMediaType=415 - Unsupported query format for a given method and resource.
   * @property {number} RequestRangeUnsatisfiable=416 - Invalid "range" request header fields.
   * @property {number} ExpectationFailed=417 - Expected behavior and defined in the header of the unsatisfactory request.
   * @property {number} ImATeapot=418 - "I am a teapot". This code is defined in RFC 2324 dated April 1, 1998, Hyper Text Coffee Pot Control Protocol.
   * @property {number} BadMapping=421 - The request was sent to a server that is not able to produce a response (for example, because a connection has been reused).
   * @property {number} UnprocessableEntity=422 - WebDAV: The entity provided with the request is incomprehensible or incomplete.
   * @property {number} Locked=423 - WebDAV: The operation can not take place because the resource is locked.
   * @property {number} MethodFailure=424 - WebDAV: A method of the transaction failed.
   * @property {number} UnorderedCollection=425 - WebDAV RFC 3648. This code is defined in the WebDAV Advanced Collections Protocol draft , but is absent from the Web Distributed Authoring and
   *     Versioning (WebDAV) Ordered Collections Protocol.
   * @property {number} UpgradeRequired=426 - RFC 2817 The client should change protocol, for example to TLS / 1.0 .
   * @property {number} PreconditionRequired=428 - RFC 6585 The request must be conditional.
   * @property {number} TooManyRequests=429 - RFC 6585 The client has issued too many requests within a given time.
   * @property {number} RequestHeaderFieldsTooLarge=431 - RFC 6585 HTTP headers issued exceed the maximum size allowed by the server.
   * @property {number} NoResponse=444 - Indicates that the server did not return any information to the client and closed the connection.
   * @property {number} RetryWith=449 - Code defined by Microsoft . The request should be returned after performing an action.
   * @property {number} BlockedByWindowsParentalControls=450 - Code defined by Microsoft. This error is generated when Windows Parental Control tools are enabled and block access to the page.
   * @property {number} UnavailableForLegalReasons=451 - This error code indicates that the requested resource is inaccessible for legal reasons
   * @property {number} UnrecoverableError=456 - WebDAV: Fatal error.
   * @property {number} SSLCertificateError=495 - An extension of the 400 Bad Request error, used when the client provided an invalid certificate.
   * @property {number} SSLCertificateRequired=496 - An extension of the 400 Bad Request error, used when a required client certificate is not provided.
   * @property {number} HTTPRequestSentToHTTPSPort=497 - An extension of the 400 Bad Request error, used when the client sends an HTTP request to port 443 normally intended for HTTPS requests.
   * @property {number} ClientClosedRequest=499 - The client closed the connection before receiving the response. This error occurs when the processing is too long on the server side.
   * @property {number} InternalServerError=500 - Internal server error.
   * @property {number} NotImplemented=501 - Functionality claimed not supported by the server.
   * @property {number} BadGateway=502 - Wrong response sent to an intermediate server by another server.
   * @property {number} ServiceUnavailable=503 - Service temporarily unavailable or under maintenance.
   * @property {number} GatewayTimeOut=504 - Waiting time for a response from a server to an intermediate server that has elapsed.
   * @property {number} HTTPVersionNotSupported=505 - HTTP version not managed by the server.
   * @property {number} VariantAlsoNegotiates=506 - RFC 2295: Negotiation Error. Transparent content negociation.
   * @property {number} InsufficientStorage=507 - WebDAV: Insufficient space to modify properties or build the collection.
   * @property {number} LoopDetected=508 - WebDAV: Loop in a Resource Match
   * @property {number} BandwidthLimitExceeded=509 - Used by many servers to indicate a quota overrun.
   * @property {number} NotExtended=510 - RFC 2774: The request does not respect the policy for accessing extended HTTP resources.
   * @property {number} NetworkAuthenticationRequired=511 - RFC 6585: The client must authenticate to access the network. Used by captive portals to redirect clients to the authentication page.
   * @property {number} UnknownError=520 - Error 520 is used as a wildcard response when the origin server returns an unexpected result.
   * @property {number} WebServerIsDown=521 - The server has refused the connection from Cloudflare.
   * @property {number} ConnectionTimedOut=522 - Cloudflare could not negotiate a TCP handshake with the origin server.
   * @property {number} OriginIsUnreachable=523 - Cloudflare failed to reach the origin server. This can occur if DNS server name resolution fails.
   * @property {number} ATimeoutOccured=524 - Cloudflare established a TCP connection with the origin server but did not receive an HTTP response before the login timeout.
   * @property {number} SSLHandshakeFailed=525 - Cloudflare could not negotiate SSL / TLS handshake with the origin server.
   * @property {number} InvalidSSLCertificate=526 - Cloudflare could not validate the SSL certificate presented by the origin server.
   * @property {number} RailgunError=527 - Error 527 indicates that the request has timed out or failed after the WAN connection was established.
   *
   * @constant
   * @type {HttpStatusCode}
   * @description HttpStatusCode contains all http status code available to check and process correctly server response.
   * @see {@link https://en.wikipedia.org/wiki/List_of_HTTP_status_codes} for further information.
   */var HttpStatusCode=Object.freeze({// 100
  Continue:100,SwitchingProtocols:101,Processing:102,// 200
  Ok:200,Created:201,Accepted:202,NonAuthoritativeInformation:203,NoContent:204,ResetContent:205,PartialContent:206,MultiStatus:207,AlreadyReported:208,ContentDifferent:210,IMUsed:226,// 300
  MultipleChoices:300,MovedPermanently:301,Found:302,SeeOther:303,NotModified:304,UseProxy:305,Unused:306,TemporaryRedirect:307,PermanentRedirect:308,TooManyRedirects:310,// 400
  BadRequest:400,Unauthorized:401,PaymentRequired:402,Forbidden:403,NotFound:404,MethodNotAllowed:405,NotAcceptable:406,ProxyAuthenticationRequired:407,RequestTimeOut:408,Conflict:409,Gone:410,LengthRequired:411,PreconditionFailed:412,RequestEntityTooLarge:413,RequestRangeUnsatisfiable:416,ExpectationFailed:417,ImATeapot:418,BadMapping:421,UnprocessableEntity:422,Locked:423,MethodFailure:424,UnorderedCollection:425,UpgradeRequired:426,PreconditionRequired:428,TooManyRequests:429,RequestHeaderFieldsTooLarge:431,NoResponse:444,RetryWith:449,BlockedByWindowsParentalControls:450,UnavailableForLegalReasons:451,UnrecoverableError:456,SSLCertificateError:495,SSLCertificateRequired:496,HTTPRequestSentToHTTPSPort:497,ClientClosedRequest:499,// 500
  InternalServerError:500,NotImplemented:501,BadGateway:502,ServiceUnavailable:503,GatewayTimeOut:504,HTTPVersionNotSupported:505,VariantAlsoNegotiates:506,InsufficientStorage:507,LoopDetected:508,BandwidthLimitExceeded:509,NotExtended:510,NetworkAuthenticationRequired:511,UnknownError:520,WebServerIsDown:521,ConnectionTimedOut:522,OriginIsUnreachable:523,ATimeoutOccured:524,SSLHandshakeFailed:525,InvalidSSLCertificate:526,RailgunError:527});/**
   * @author [Tristan Valcke]{@link https://github.com/Itee}
   * @license [BSD-3-Clause]{@link https://opensource.org/licenses/BSD-3-Clause}
   *
   * @file The TValidator contains all function to check is parameters are correct or not, it not throw or log on error.
   *
   * @example import { isObject } from './TValidator'
   * var myObj = {}
   * if( isObject( myObj ) ) {
   *      console.log('Is object !')
   * }
   *
   */function isString(value){return value&&typeof value==='string';}function isArray$1(value){return value&&Array.isArray(value);}function isFunction(value){return value&&typeof value==='function';}function isObject(value){return value&&(typeof value==='undefined'?'undefined':_typeof(value))==='object'&&!Array.isArray(value);}/**
   * @author [Tristan Valcke]{@link https://github.com/Itee}
   * @license [BSD-3-Clause]{@link https://opensource.org/licenses/BSD-3-Clause}
   *
   * @file TUtils contain all utils methods for itee client
   *
   * @example Todo
   *
   */function extend(target,source){var output=Object.assign({},target);if(isObject(target)&&isObject(source)){var keys=Object.keys(source);for(var i=0,n=keys.length;i<n;++i){var key=keys[i];if(isObject(source[key])){if(!(key in target)){Object.assign(output,defineProperty({},key,source[key]));}else{output[key]=mergeDeep(target[key],source[key]);}}else{Object.assign(output,defineProperty({},key,source[key]));}}}return output;}/**
   * @author Kyle-Larson https://github.com/Kyle-Larson
   * @author Takahiro https://github.com/takahirox
   *
   * Loader loads FBX file and generates Group representing FBX scene.
   * Requires FBX file to be >= 7.0 and in ASCII or to be any version in Binary format.
   *
   * Supports:
   *    Mesh Generation (Positional Data)
   *    Normal Data (Per Vertex Drawing Instance)
   *  UV Data (Per Vertex Drawing Instance)
   *  Skinning
   *  Animation
   *    - Separated Animations based on stacks.
   *    - Skeletal & Non-Skeletal Animations
   *  NURBS (Open, Closed and Periodic forms)
   *
   * Needs Support:
   *    Indexed Buffers
   *    PreRotation support.
   */// Helper methods
  var DEG2RAD=Math.PI/180;function degreeToRadian(value){if(value===null||value===undefined){console.error('FBXLoader2: Unable to convert degree to radian with null or undefined value !');return null;}return value*DEG2RAD;}function parseFloatArray(floatString){if(!floatString){console.error('FBXLoader2: Unable to parse float array with null or undefined value !');return null;}return floatString.replace(/,$/,'').split(',').map(function(stringValue){return parseFloat(stringValue);});}function parseIntArray(intString){if(!intString){console.error('FBXLoader2: Unable to parse int array with null or undefined value !');return null;}return intString.replace(/,$/,'').split(',').map(function(stringValue){return parseInt(stringValue);});}function parseVector3(property){if(!property){console.error('FBXLoader2: Unable to parse Vector3 with null or undefined value !');return null;}return new Vector3$1().fromArray(property.value);}function parseColor$1(property){if(!property){console.error('FBXLoader2: Unable to parse Vector3 with null or undefined value !');return null;}return new Color$1().fromArray(property.value);}function parseMatrixArray(floatString){if(!floatString){console.error('FBXLoader2: Unable to parse Matrix4 with null or undefined value !');return null;}return new Matrix4().fromArray(parseFloatArray(floatString));}function convertArrayBufferToString$1(buffer,from,to){if(!buffer){console.error('FBXLoader2: Unable to comvert null or undefined buffer !');return null;}if(from===undefined){from=0;}if(to===undefined){to=buffer.byteLength;}var array=new Uint8Array(buffer,from,to);if(window.TextDecoder!==undefined){return new TextDecoder().decode(array);}var s='';for(var i=0,il=array.length;i<il;i++){s+=String.fromCharCode(array[i]);}return s;}function findIndex(array,func){for(var i=0,l=array.length;i<l;i++){if(func(array[i])){return i;}}return-1;}function append$1(a,b){for(var i=0,j=a.length,l=b.length;i<l;i++, j++){a[j]=b[i];}}function slice$1(a,b,from,to){for(var i=from,j=0;i<to;i++, j++){a[j]=b[i];}return a;}var FBXLoader2=function FBXLoader2(manager,logger){};// Public static methods
  Object.assign(FBXLoader2,{BINARY_SIGNATURE:'Kaydara FBX Binary  ',TICKS_PER_SECOND:46186158000,getFbxFormat:function getFbxFormat(FBXBuffer){return convertArrayBufferToString$1(FBXBuffer.slice(0,20))===FBXLoader2.BINARY_SIGNATURE?'binary':'ascii';},convertFbxTimeToSeconds:function convertFbxTimeToSeconds(time){if(time==undefined){throw new Error('FBXLoader2: Unable to convert FBX time with null or undefined time !');}if(isNaN(parseFloat(time))){throw new Error('FBXLoader2: Unable to convert FBX time for NaN value !');}if(!isFinite(time)){throw new Error('FBXLoader2: Unable to convert FBX time with infinit value !');}return time/FBXLoader2.TICKS_PER_SECOND;},getFbxPropertyData:function getFbxPropertyData(propertyName,object){if(!propertyName){throw new Error('FBXLoader2: Unable to get FBX property with null or undefined property name !');}if(typeof propertyName!=='string'){throw new Error('FBXLoader2: Unable to get FBX property ! The property name must be a string.');}if(!object){throw new Error('FBXLoader2: Unable to get FBX property in null or undefined object !');}if(object.properties&&propertyName in object.properties){return object.properties[propertyName];}else if(object.subNodes&&propertyName in object.subNodes){return object.subNodes[propertyName].properties.a;}else{return null;}},getFileName:function getFileName(nodeProperties){if(!nodeProperties){throw new Error('FBXLoader2: Unable to search filename in null or undefined nodeProperties !');}for(var property in nodeProperties){if(nodeProperties.hasOwnProperty(property)&&property.toLowerCase()==="filename"){return nodeProperties[property];}}return null;}});Object.assign(FBXLoader2.prototype,function privateAssignement(){// Private static methods
  function parseConnections(FBXTree,version){var connections=FBXTree.Connections;if(!connections){console.error('FBXLoader2: Unable to parse connections, fbx tree does not contain Connections !');return null;}var connectionsProperties=connections.properties;if(!connectionsProperties){console.error('FBXLoader2: Unable to parse connections, connections does not contain properties !');return null;}var connectionArray=connectionsProperties.connections;if(!connectionArray){console.error('FBXLoader2: Unable to parse connections, connections properties does not contain connections !');return null;}var connectionMap=new Map();var connection=undefined;var connectionId=undefined;var parentId=undefined;var childId=undefined;for(var connectionIndex=0,numberOfConnections=connectionArray.length;connectionIndex<numberOfConnections;++connectionIndex){connection=connectionArray[connectionIndex];connectionId=connection[0];parentId=connection[1];childId=connection[2];if(!connectionMap.has(connectionId)){connectionMap.set(connectionId,{parents:[],children:[]});}var parentRelationship={ID:parentId,relationship:childId};connectionMap.get(connectionId).parents.push(parentRelationship);if(!connectionMap.has(parentId)){connectionMap.set(parentId,{parents:[],children:[]});}var childRelationship={ID:connectionId,relationship:childId};connectionMap.get(parentId).children.push(childRelationship);}return connectionMap;}function parseImages(FBXTree,version){var objects=FBXTree.Objects;if(!objects){console.error('FBXLoader2: Unable to parse images, fbx tree does not contain Objects !');return null;}var subNodes=objects.subNodes;if(!subNodes){console.error('FBXLoader2: Unable to parse images, fbx tree\'s Objects does not contain subNodes !');return null;}var videoNodes=subNodes.Video;if(!videoNodes){console.error('FBXLoader2: Unable to parse images, fbx tree\'s Objects subNodes does not contain Video !');return null;}var imageMap=new Map();var videoNode=undefined;var videoNodeProperties=undefined;var videoContent=undefined;var image=undefined;var id=undefined;for(var nodeID in videoNodes){videoNode=videoNodes[nodeID];id=version>7000?parseInt(nodeID):videoNode.id;//TODO: check id for version 6
  videoNodeProperties=videoNode.properties;if(!videoNodeProperties){console.error('FBXLoader2: Unable to get video node properties for video node: '+nodeID+' !');continue;}if(version<7000){image=videoNodeProperties.RelativeFilename||FBXLoader2.getFileName(videoNodeProperties);}else{// raw image data is in videoNode.properties.Content
  videoContent=videoNodeProperties.Content;if(!videoContent){console.error('FBXLoader2: Unable to get video node content for video node: '+nodeID+' !');continue;}image=parseImage(videoNodeProperties);}if(!image){continue;}imageMap.set(id,image);}return imageMap;}function parseImage(videoNodeProperties){var content=videoNodeProperties.Content;var fileName=videoNodeProperties.RelativeFilename||FBXLoader2.getFileName(videoNodeProperties);if(!fileName){console.error('FBXLoader2: Unable to get image file name !');return null;}var extension=fileName.slice(fileName.lastIndexOf('.')+1).toLowerCase();var type;switch(extension){case'bmp':type='image/bmp';break;case'jpg':type='image/jpeg';break;case'png':type='image/png';break;case'tif':type='image/tiff';break;default:console.warn('FBXLoader: No support image type '+extension);return;}if(typeof content==='string'){return'data:'+type+';base64,'+content;}else{var array=new Uint8Array(content);return window.URL.createObjectURL(new Blob([array],{type:type}));}}function parseTextures(FBXTree,loader,imageMap,connections,version){if(!loader){console.error('FBXLoader2: Unable to parse textures, loader is null or undefined !');return null;}if(!imageMap){// ImageMap is optional, and only in version > 7000 ?
  console.warn('FBXLoader2: Unable to parse textures, imageMap is null or undefined !');//				return null;
  }if(!connections){console.error('FBXLoader2: Unable to parse textures, connections is null or undefined !');return null;}var objects=FBXTree.Objects;if(!objects){console.error('FBXLoader2: Unable to parse textures, fbx tree does not contain Objects !');return null;}var subNodes=objects.subNodes;if(!subNodes){console.error('FBXLoader2: Unable to parse textures, fbx tree\'s Objects does not contain subNodes !');return null;}var textureMap=new Map();var textureNodes=subNodes.Texture;var textureNode=undefined;var texture=undefined;var id=undefined;for(var nodeID in textureNodes){textureNode=textureNodes[nodeID];if(textureNode.constructor===Array){textureNode=textureNode[0];// Todo: check if this is duplicates or NOT !
  // for (var textureIndex = 0, numberOfTexture = textureNode.length; textureIndex < numberOfTexture; ++ textureIndex ) {}
  }id=version>7000?parseInt(nodeID):textureNode.id;//TODO: check id for version 6
  texture=parseTexture(textureNode,loader,imageMap,connections);if(!texture){continue;}textureMap.set(id,texture);}return textureMap;}function parseTexture(textureNode,loader,imageMap,connections){if(!textureNode){console.error('FBXLoader2: Unable to parse texture for null or undefined texture node !');return null;}var FBX_ID=textureNode.id;var name=textureNode.name;var filePath=FBXLoader2.getFileName(textureNode.properties);var relativeFilePath=textureNode.properties.RelativeFilename;var fileName=undefined;var children=connections.get(FBX_ID).children;if(children!==undefined&&children.length>0&&imageMap&&imageMap.has(children[0].ID)){fileName=imageMap.get(children[0].ID);}else if(relativeFilePath!==undefined&&relativeFilePath[0]!=='/'&&relativeFilePath.match(/^[a-zA-Z]:/)===null){// use textureNode.properties.RelativeFilename
  // if it exists and it doesn't seem an absolute path
  fileName=relativeFilePath;}else{var split=filePath.split(/[\\\/]/);if(split.length>0){fileName=split[split.length-1];}else{fileName=filePath;}}var currentPath=loader.path;if(fileName.indexOf('blob:')===0||fileName.indexOf('data:')===0){loader.setPath(undefined);}var texture=loader.load(fileName);texture.name=name;texture.FBX_ID=FBX_ID;var wrapModeU=textureNode.properties.WrapModeU;var wrapModeV=textureNode.properties.WrapModeV;var valueU=wrapModeU!==undefined?wrapModeU.value:0;var valueV=wrapModeV!==undefined?wrapModeV.value:0;// http://download.autodesk.com/us/fbx/SDKdocs/FBX_SDK_Help/files/fbxsdkref/class_k_fbx_texture.html#889640e63e2e681259ea81061b85143a
  // 0: repeat(default), 1: clamp
  texture.wrapS=valueU===0?RepeatWrapping:ClampToEdgeWrapping;texture.wrapT=valueV===0?RepeatWrapping:ClampToEdgeWrapping;loader.setPath(currentPath);return texture;}function parseMaterials(FBXTree,textureMap,connections,version){if(!textureMap){console.error('FBXLoader2: Unable to parse materials for null or undefined texture map !');return null;}if(!connections){console.error('FBXLoader2: Unable to parse materials for null or undefined connections !');return null;}var objects=FBXTree.Objects;if(!objects){console.error('FBXLoader2: Unable to parse materials, fbx tree does not contain Objects !');return null;}var subNodes=objects.subNodes;if(!subNodes){console.error('FBXLoader2: Unable to parse materials, fbx tree\'s Objects does not contain subNodes !');return null;}var materialMap=new Map();var materialNodes=subNodes.Material;var materialNode=undefined;var material=undefined;var id=undefined;for(var nodeID in materialNodes){materialNode=materialNodes[nodeID];id=version>7000?parseInt(nodeID):materialNode.id;//TODO: check id for version 6
  material=parseMaterial(materialNode,textureMap,connections,version);if(!material){continue;}materialMap.set(id,material);}return materialMap;}function parseMaterial(materialNode,textureMap,connections,version){if(!materialNode){console.error('FBXLoader2: Unable to parse material for null or undefined material node !');return null;}var materialNodeProperties=materialNode.properties;if(!materialNodeProperties){console.error('FBXLoader2: Unable to parse material with null or undefined properties !');return null;}var FBX_ID=materialNode.id;var name=materialNode.attrName;var type=materialNode.properties.ShadingModel;//Case where FBXs wrap shading model in property object.
  if((typeof type==='undefined'?'undefined':_typeof(type))==='object'){type=type.value;}type=type.toLowerCase();// Seems like FBX can include unused materials which don't have any connections.
  // Ignores them so far.
  if(!connections.has(FBX_ID)){return null;}var parameters=undefined;if(version<7000){// If version 6 search if parent have a texture assign for child...
  // This is weird but...
  var parents=connections.get(FBX_ID).parents;var parentChildren=connections.get(parents[0].ID).children;var parentChildrenFiltered=parentChildren.filter(function(child){return child.ID!==FBX_ID;});parameters=parseParameters(materialNode.properties,textureMap,parentChildrenFiltered);}else{var children=connections.get(FBX_ID).children;parameters=parseParameters(materialNode.properties,textureMap,children);}var material=undefined;switch(type){case'phong':material=new MeshPhongMaterial();break;case'lambert':material=new MeshLambertMaterial();break;default:console.warn('FBXLoader2: No implementation given for material type %s in FBXLoader.js. Defaulting to standard material.',type);material=new MeshStandardMaterial({color:0x3300ff});break;}material.setValues(parameters);material.name=name;return material;}function parseParameters(properties,textureMap,childrenRelationships){var parameters={};var diffuseColor=properties.Diffuse||properties.DiffuseColor;if(diffuseColor){parameters.color=parseColor$1(diffuseColor);}if(properties.Specular){parameters.specular=parseColor$1(properties.Specular);}if(properties.Shininess){parameters.shininess=properties.Shininess.value;}if(properties.Emissive){parameters.emissive=parseColor$1(properties.Emissive);}if(properties.EmissiveFactor){parameters.emissiveIntensity=properties.EmissiveFactor.value;}if(properties.Opacity){parameters.opacity=properties.Opacity.value;}if(parameters.opacity<1.0){parameters.transparent=true;}for(var childrenRelationshipsIndex=0,childrenRelationshipsLength=childrenRelationships.length;childrenRelationshipsIndex<childrenRelationshipsLength;++childrenRelationshipsIndex){var relationship=childrenRelationships[childrenRelationshipsIndex];var type=relationship.relationship;switch(type){case'DiffuseColor':case' "DiffuseColor':parameters.map=textureMap.get(relationship.ID);break;case'TransparencyFactor':case' "TransparencyFactor':parameters.map=textureMap.get(relationship.ID);parameters.transparent=true;break;case'Bump':case' "Bump':parameters.bumpMap=textureMap.get(relationship.ID);break;case'NormalMap':case' "NormalMap':parameters.normalMap=textureMap.get(relationship.ID);break;case'AmbientColor':case' "AmbientColor':case'EmissiveColor':case' "EmissiveColor':default:console.warn('FBXLoader2: Unknown texture application of type %s, skipping texture.',type);break;}}return parameters;}function parseDeformers(FBXTree,connections,version){if(!connections){console.error('FBXLoader2: Unable to parse deformers for null or undefined connections !');return null;}var objects=FBXTree.Objects;if(!objects){console.error('FBXLoader2: Unable to parse deformers, fbx tree does not contain Objects !');return null;}var subNodes=objects.subNodes;if(!subNodes){console.error('FBXLoader2: Unable to parse deformers, fbx tree\'s Objects does not contain subNodes !');return null;}var deformers={};var deformerNodes=subNodes.Deformer;var deformerNode=undefined;var connection=undefined;var skeleton=undefined;var id=undefined;for(var nodeID in deformerNodes){deformerNode=deformerNodes[nodeID];if(deformerNode.attrType==='Skin'){id=version>7000?parseInt(nodeID):deformerNode.id;//TODO: check id for version 6
  connection=connections.get(id);skeleton=parseSkeleton(connection,deformerNodes);if(!skeleton){continue;}skeleton.FBX_ID=id;deformers[nodeID]=skeleton;}}return deformers;}function parseSkeleton(connections,deformerNodes){if(!connections){console.error("FBXLoader2: Unable to parse skeleton for null or undefined connections !");return null;}var subDeformers={};var children=connections.children;var subDeformerArray=[];// TODO: remove ?
  var child=undefined;var subDeformerNode=undefined;var subDeformer=undefined;var indexes=undefined;for(var i=0,l=children.length;i<l;++i){child=children[i];subDeformerNode=deformerNodes[child.ID];subDeformer={FBX_ID:child.ID,index:i,indices:[],weights:[],transform:parseMatrixArray(FBXLoader2.getFbxPropertyData('Transform',subDeformerNode)),transformLink:parseMatrixArray(FBXLoader2.getFbxPropertyData('TransformLink',subDeformerNode)),linkMode:subDeformerNode.properties.Mode};var indexes=FBXLoader2.getFbxPropertyData('Indexes',subDeformerNode);if(indexes){subDeformer.indices=parseIntArray(indexes);subDeformer.weights=parseFloatArray(FBXLoader2.getFbxPropertyData('Weights',subDeformerNode));}subDeformers[child.ID]=subDeformer;subDeformerArray.push(subDeformer);// TODO: remove ?
  }return{map:subDeformers,array:subDeformerArray,// TODO: remove ?
  bones:[]};}function parseGeometries(FBXTree,connections,deformers,version){if(!connections){console.error("FBXLoader2: Unable to parse geometries for null or undefined connections !");return null;}if(!deformers){console.error("FBXLoader2: Unable to parse geometries for null or undefined deformers !");return null;}var objects=FBXTree.Objects;if(!objects){console.error("FBXLoader2: Unable to parse geometries, fbx tree does not contain Objects !");return null;}var subNodes=objects.subNodes;if(!subNodes){console.error("FBXLoader2: Unable to parse geometries, fbx tree's Objects does not contain subNodes !");return null;}var geometryNodes=version<7000?subNodes.Model:subNodes.Geometry;if(!geometryNodes){console.error("FBXLoader2: Unable to parse geometries, fbx tree's Objects sub-nodes does not contain geometry !");return null;}var geometryMap=new Map();var geometryNode=undefined;var geometry=undefined;var connection=undefined;var id=undefined;for(var nodeID in geometryNodes){geometryNode=geometryNodes[nodeID];id=version>7000?parseInt(nodeID):geometryNode.id;//TODO: check id for version 6
  connection=connections.get(id);if(!connection){continue;}geometry=parseGeometry(geometryNode,connection,deformers,version);if(!geometry){continue;}geometryMap.set(id,geometry);}return geometryMap;}function parseGeometry(geometryNode,relationships,deformers,version){switch(geometryNode.attrType){case'Mesh':return parseMeshGeometry(geometryNode,relationships,deformers,version);break;case'NurbsCurve':return parseNurbsGeometry(geometryNode);break;}}function parseMeshGeometry(geometryNode,relationships,deformers,version){var deformer=undefined;var relationShipsChildren=relationships.children;if(relationShipsChildren.length>0){for(var i=0;i<relationShipsChildren.length;++i){deformer=deformers[relationShipsChildren[i].ID];if(deformer!==undefined){break;}}}return genGeometry(geometryNode,deformer,version);}function genGeometry(geometryNode,deformer,version){var geometry=new Geometry$1();var subNodes=geometryNode.subNodes;// First, each index is going to be its own vertex.
  var vertexBuffer=parseFloatArray(FBXLoader2.getFbxPropertyData('Vertices',geometryNode));var indexBuffer=parseIntArray(FBXLoader2.getFbxPropertyData('PolygonVertexIndex',geometryNode));if(subNodes.LayerElementNormal){var normalInfo=getNormals(subNodes.LayerElementNormal[0]);}if(subNodes.LayerElementUV){var uvInfo=getUVs(subNodes.LayerElementUV[0]);}if(subNodes.LayerElementColor){var colorInfo=getColors(subNodes.LayerElementColor[0]);}if(subNodes.LayerElementMaterial){var materialInfo=getMaterials(subNodes.LayerElementMaterial[0]);}var weightTable={};if(deformer){var subDeformers=deformer.map;for(var key in subDeformers){var subDeformer=subDeformers[key];var indices=subDeformer.indices;for(var j=0;j<indices.length;j++){var index=indices[j];var weight=subDeformer.weights[j];if(weightTable[index]===undefined){weightTable[index]=[];}weightTable[index].push({id:subDeformer.index,weight:weight});}}}var faceVertexBuffer=[];var polygonIndex=0;var displayedWeightsWarning=false;for(var polygonVertexIndex=0,numberOfIndexes=indexBuffer.length;polygonVertexIndex<numberOfIndexes;polygonVertexIndex++){var vertexIndex=indexBuffer[polygonVertexIndex];var endOfFace=false;if(vertexIndex<0){vertexIndex=vertexIndex^-1;indexBuffer[polygonVertexIndex]=vertexIndex;endOfFace=true;}var vertex=new Vertex$1();var weightIndices=[];var weights=[];vertex.position.fromArray(vertexBuffer,vertexIndex*3);if(deformer){if(version<7000){var subDeformer=undefined;var vertexWeight=undefined;for(var deformerIndex=0,numberOfDeformers=deformer.array.length;deformerIndex<numberOfDeformers;deformerIndex++){subDeformer=deformer.array[deformerIndex];vertexWeight=subDeformer.weights[index];vertex.skinWeights.w=vertexWeight;vertex.skinWeights.x=0;vertex.skinWeights.y=0;vertex.skinWeights.z=0;vertex.skinIndices.w=index;vertex.skinIndices.x=0;vertex.skinIndices.y=0;vertex.skinIndices.z=0;}}else{if(weightTable[vertexIndex]!==undefined){var array=weightTable[vertexIndex];for(var j=0,jl=array.length;j<jl;j++){weights.push(array[j].weight);weightIndices.push(array[j].id);}}if(weights.length>4){if(!displayedWeightsWarning){console.warn('FBXLoader2: Vertex has more than 4 skinning weights assigned to vertex. Deleting additional weights.');displayedWeightsWarning=true;}var WIndex=[0,0,0,0];var Weight=[0,0,0,0];weights.forEach(function(weight,weightIndex){var currentWeight=weight;var currentIndex=weightIndices[weightIndex];Weight.forEach(function(comparedWeight,comparedWeightIndex,comparedWeightArray){if(currentWeight>comparedWeight){comparedWeightArray[comparedWeightIndex]=currentWeight;currentWeight=comparedWeight;var tmp=WIndex[comparedWeightIndex];WIndex[comparedWeightIndex]=currentIndex;currentIndex=tmp;}});});weightIndices=WIndex;weights=Weight;}for(var i=weights.length;i<4;++i){weights[i]=0;weightIndices[i]=0;}vertex.skinWeights.fromArray(weights);vertex.skinIndices.fromArray(weightIndices);}}if(normalInfo){vertex.normal.fromArray(getData(polygonVertexIndex,polygonIndex,vertexIndex,normalInfo));}if(uvInfo){vertex.uv.fromArray(getData(polygonVertexIndex,polygonIndex,vertexIndex,uvInfo));}if(colorInfo){vertex.color.fromArray(getData(polygonVertexIndex,polygonIndex,vertexIndex,colorInfo));}faceVertexBuffer.push(vertex);if(endOfFace){var face=new Face$1();face.generateTrianglesFromVertices(faceVertexBuffer);if(materialInfo!==undefined){var materials=getData(polygonVertexIndex,polygonIndex,vertexIndex,materialInfo);face.materialIndex=materials[0];}else{// Seems like some models don't have materialInfo(subNodes.LayerElementMaterial).
  // Set 0 in such a case.
  face.materialIndex=0;}geometry.faces.push(face);faceVertexBuffer=[];polygonIndex++;endOfFace=false;}}var bufferInfo=geometry.flattenToBuffers();var geo=new BufferGeometry();geo.name=geometryNode.name;geo.addAttribute('position',new Float32BufferAttribute(bufferInfo.vertexBuffer,3));if(bufferInfo.normalBuffer.length>0){geo.addAttribute('normal',new Float32BufferAttribute(bufferInfo.normalBuffer,3));}if(bufferInfo.uvBuffer.length>0){geo.addAttribute('uv',new Float32BufferAttribute(bufferInfo.uvBuffer,2));}if(subNodes.LayerElementColor){geo.addAttribute('color',new Float32BufferAttribute(bufferInfo.colorBuffer,3));}if(deformer){geo.addAttribute('skinIndex',new Float32BufferAttribute(bufferInfo.skinIndexBuffer,4));geo.addAttribute('skinWeight',new Float32BufferAttribute(bufferInfo.skinWeightBuffer,4));geo.FBX_Deformer=deformer;}// Convert the material indices of each vertex into rendering groups on the geometry.
  var materialIndexBuffer=bufferInfo.materialIndexBuffer;var prevMaterialIndex=materialIndexBuffer[0];var startIndex=0;for(var i=0;i<materialIndexBuffer.length;++i){if(materialIndexBuffer[i]!==prevMaterialIndex){geo.addGroup(startIndex,i-startIndex,prevMaterialIndex);prevMaterialIndex=materialIndexBuffer[i];startIndex=i;}}return geo;}function getNormals(NormalNode$$1){if(!NormalNode$$1){console.error("Unable to get normals with null or undefined NormalNode !");return null;}var mappingType=NormalNode$$1.properties.MappingInformationType;var referenceType=NormalNode$$1.properties.ReferenceInformationType;var buffer=parseFloatArray(FBXLoader2.getFbxPropertyData('Normals',NormalNode$$1));var indexBuffer=[];if(referenceType==='IndexToDirect'){if('NormalIndex'in NormalNode$$1.subNodes){indexBuffer=parseIntArray(FBXLoader2.getFbxPropertyData('NormalIndex',NormalNode$$1));}else if('NormalsIndex'in NormalNode$$1.subNodes){indexBuffer=parseIntArray(FBXLoader2.getFbxPropertyData('NormalsIndex',NormalNode$$1));}}return{dataSize:3,buffer:buffer,indices:indexBuffer,mappingType:mappingType,referenceType:referenceType};}function getUVs(UVNode$$1){if(!UVNode$$1){console.error("Unable to get UVs with null or undefined UVNode !");return null;}var mappingType=UVNode$$1.properties.MappingInformationType;var referenceType=UVNode$$1.properties.ReferenceInformationType;var buffer=parseFloatArray(FBXLoader2.getFbxPropertyData('UV',UVNode$$1));var indexBuffer=[];if(referenceType==='IndexToDirect'){indexBuffer=parseIntArray(FBXLoader2.getFbxPropertyData('UVIndex',UVNode$$1));}return{dataSize:2,buffer:buffer,indices:indexBuffer,mappingType:mappingType,referenceType:referenceType};}function getColors(ColorNode$$1){if(!ColorNode$$1){console.error("Unable to get colors with null or undefined ColorNode !");return null;}var mappingType=ColorNode$$1.properties.MappingInformationType;var referenceType=ColorNode$$1.properties.ReferenceInformationType;var buffer=parseFloatArray(FBXLoader2.getFbxPropertyData('Colors',ColorNode$$1));var indexBuffer=[];if(referenceType==='IndexToDirect'){indexBuffer=parseFloatArray(FBXLoader2.getFbxPropertyData('ColorIndex',ColorNode$$1));}return{dataSize:4,buffer:buffer,indices:indexBuffer,mappingType:mappingType,referenceType:referenceType};}function getMaterials(MaterialNode){if(!MaterialNode){console.error("Unable to get materials with null or undefined MaterialNode !");return null;}var mappingType=MaterialNode.properties.MappingInformationType;var referenceType=MaterialNode.properties.ReferenceInformationType;if(mappingType==='NoMappingInformation'){return{dataSize:1,buffer:[0],indices:[0],mappingType:'AllSame',referenceType:referenceType};}var materialIndexBuffer=parseIntArray(FBXLoader2.getFbxPropertyData('Materials',MaterialNode));// Since materials are stored as indices, there's a bit of a mismatch between FBX and what
  // we expect.  So we create an intermediate buffer that points to the index in the buffer,
  // for conforming with the other functions we've written for other data.
  var materialIndices=[];for(var materialIndexBufferIndex=0,materialIndexBufferLength=materialIndexBuffer.length;materialIndexBufferIndex<materialIndexBufferLength;++materialIndexBufferIndex){materialIndices.push(materialIndexBufferIndex);}return{dataSize:1,buffer:materialIndexBuffer,indices:materialIndices,mappingType:mappingType,referenceType:referenceType};}var dataArray=[];var GetData={ByPolygonVertex:{Direct:function Direct(polygonVertexIndex,polygonIndex,vertexIndex,infoObject){var dataSize=infoObject.dataSize;var from=polygonVertexIndex*dataSize;var to=polygonVertexIndex*dataSize+dataSize;// return infoObject.buffer.slice( from, to );
  return slice$1(dataArray,infoObject.buffer,from,to);},IndexToDirect:function IndexToDirect(polygonVertexIndex,polygonIndex,vertexIndex,infoObject){var dataSize=infoObject.dataSize;var index=infoObject.indices[polygonVertexIndex];var from=index*dataSize;var to=index*dataSize+dataSize;// return infoObject.buffer.slice( from, to );
  return slice$1(dataArray,infoObject.buffer,from,to);}},ByPolygon:{Direct:function Direct(polygonVertexIndex,polygonIndex,vertexIndex,infoObject){var dataSize=infoObject.dataSize;var from=polygonIndex*dataSize;var to=polygonIndex*dataSize+dataSize;// return infoObject.buffer.slice( from, to );
  return slice$1(dataArray,infoObject.buffer,from,to);},IndexToDirect:function IndexToDirect(polygonVertexIndex,polygonIndex,vertexIndex,infoObject){var dataSize=infoObject.dataSize;var index=infoObject.indices[polygonIndex];var from=index*dataSize;var to=index*dataSize+dataSize;// return infoObject.buffer.slice( from, to );
  return slice$1(dataArray,infoObject.buffer,from,to);}},ByVertice:{Direct:function Direct(polygonVertexIndex,polygonIndex,vertexIndex,infoObject){var dataSize=infoObject.dataSize;var from=vertexIndex*dataSize;var to=vertexIndex*dataSize+dataSize;// return infoObject.buffer.slice( from, to );
  return slice$1(dataArray,infoObject.buffer,from,to);}},AllSame:{IndexToDirect:function IndexToDirect(polygonVertexIndex,polygonIndex,vertexIndex,infoObject){var dataSize=infoObject.dataSize;var from=infoObject.indices[0]*dataSize;var to=infoObject.indices[0]*dataSize+dataSize;// return infoObject.buffer.slice( from, to );
  return slice$1(dataArray,infoObject.buffer,from,to);}}};function getData(polygonVertexIndex,polygonIndex,vertexIndex,infoObject){return GetData[infoObject.mappingType][infoObject.referenceType](polygonVertexIndex,polygonIndex,vertexIndex,infoObject);}function parseNurbsGeometry(geometryNode){if(!geometryNode){console.error("Unable to parse Nurbs Geometry with null or undefined geometryNode !");return null;}if(NURBSCurve===undefined){console.error('FBXLoader2: The loader relies on NURBSCurve for any nurbs present in the model. Nurbs will show up as empty geometry.');return new BufferGeometry();}var order=parseInt(geometryNode.properties.Order);if(isNaN(order)){console.error('FBXLoader2: Invalid Order %s given for geometry ID: %s',geometryNode.properties.Order,geometryNode.id);return new BufferGeometry();}var degree=order-1;var knots=parseFloatArray(FBXLoader2.getFbxPropertyData('KnotVector',geometryNode));var controlPoints=[];var pointsValues=parseFloatArray(FBXLoader2.getFbxPropertyData('Points',geometryNode));for(var i=0,l=pointsValues.length;i<l;i+=4){controlPoints.push(new Vector4$1().fromArray(pointsValues,i));}var startKnot,endKnot;if(geometryNode.properties.Form==='Closed'){controlPoints.push(controlPoints[0]);}else if(geometryNode.properties.Form==='Periodic'){startKnot=degree;endKnot=knots.length-1-startKnot;for(var i=0;i<degree;++i){controlPoints.push(controlPoints[i]);}}var curve=new NURBSCurve(degree,knots,controlPoints,startKnot,endKnot);var vertices=curve.getPoints(controlPoints.length*7);var positions=new Float32Array(vertices.length*3);for(var i=0,l=vertices.length;i<l;++i){vertices[i].toArray(positions,i*3);}var geometry=new BufferGeometry();geometry.addAttribute('position',new BufferAttribute(positions,3));return geometry;}function parseScene(FBXTree,connections,deformers,geometryMap,materialMap,version){if(!connections){console.error("FBXLoader2: Unable to parse scene for null or undefined connections !");return null;}var objects=FBXTree.Objects;if(!objects){console.error("FBXLoader2: Unable to parse scene, fbx tree does not contain Objects !");return null;}var subNodes=objects.subNodes;if(!subNodes){console.error("FBXLoader2: Unable to parse scene, fbx tree's Objects does not contain subNodes !");return null;}var sceneGraph=new Group();var ModelNode=FBXTree.Objects.subNodes.Model;var modelArray=[];var modelMap=new Map();for(var nodeID in ModelNode){var node=ModelNode[nodeID];var id=version>7000?parseInt(nodeID):node.id;//TODO: check id for version 6
  var connection=connections.get(id);if(!connection){continue;}var connectionParents=connection.parents;if(!connectionParents){continue;}var model=null;for(var i=0,numberOfParents=connectionParents.length;i<numberOfParents;++i){for(var FBX_ID in deformers){var deformer=deformers[FBX_ID];var subDeformers=deformer.map;var subDeformer=subDeformers[connection.parents[i].ID];if(subDeformer){var model2=model;model=new Bone();deformer.bones[subDeformer.index]=model;// seems like we need this not to make non-connected bone, maybe?
  // TODO: confirm
  if(model2!==null){model.add(model2);}}}}if(!model){switch(node.attrType){case'Mesh':var geometry=null;var material=null;var materials=[];for(var childrenIndex=0,childrenLength=connection.children.length;childrenIndex<childrenLength;++childrenIndex){var child=connection.children[childrenIndex];if(geometryMap.has(child.ID)){geometry=geometryMap.get(child.ID);}else if(version<7000&&geometryMap.has(node.id)){geometry=geometryMap.get(node.id);}if(materialMap.has(child.ID)){materials.push(materialMap.get(child.ID));}}if(materials.length>1){material=materials;}else if(materials.length===1){material=materials[0];}else{material=new MeshStandardMaterial();materials.push(material);}if(geometry){if(geometry.attributes&&geometry.attributes.color){for(var materialIndex=0,numMaterials=materials.length;materialIndex<numMaterials;++materialIndex){materials[materialIndex].vertexColors=VertexColors;}}if(geometry.FBX_Deformer){for(var materialsIndex=0,materialsLength=materials.length;materialsIndex<materialsLength;++materialsIndex){materials[materialsIndex].skinning=true;}model=new SkinnedMesh(geometry,material);}else{model=new Mesh(geometry,material);}}else{model=new Object3D();}break;case'NurbsCurve':var geometry=null;for(var childrenIndex=0,childrenLength=connection.children.length;childrenIndex<childrenLength;++childrenIndex){var child=connection.children[childrenIndex];if(geometryMap.has(child.ID)){geometry=geometryMap.get(child.ID);}}// FBX does not list materials for Nurbs lines, so we'll just put our own in here.
  var nurbsMaterial=new LineBasicMaterial({color:0x3300ff,linewidth:5});model=new Line(geometry,nurbsMaterial);break;default:model=new Object3D();break;}}model.name=version<7000?node.id.replace(/:/,'').replace(/_/,'').replace(/-/,''):node.attrName.replace(/:/,'').replace(/_/,'').replace(/-/,'');model.FBX_ID=id;modelArray.push(model);modelMap.set(id,model);}for(var modelArrayIndex=0,modelArrayLength=modelArray.length;modelArrayIndex<modelArrayLength;++modelArrayIndex){var model=modelArray[modelArrayIndex];var node=ModelNode[model.FBX_ID];if('Lcl_Translation'in node.properties){model.position.fromArray(parseFloatArray(node.properties.Lcl_Translation.value));}if('Lcl_Rotation'in node.properties){var rotation=parseFloatArray(node.properties.Lcl_Rotation.value).map(degreeToRadian);rotation.push('ZYX');model.rotation.fromArray(rotation);}if('Lcl_Scaling'in node.properties){model.scale.fromArray(parseFloatArray(node.properties.Lcl_Scaling.value));}if('PreRotation'in node.properties){var preRotations=new Euler().setFromVector3(parseVector3(node.properties.PreRotation).multiplyScalar(DEG2RAD),'ZYX');preRotations=new Quaternion().setFromEuler(preRotations);var currentRotation=new Quaternion().setFromEuler(model.rotation);preRotations.multiply(currentRotation);model.rotation.setFromQuaternion(preRotations,'ZYX');}var conns=connections.get(model.FBX_ID);for(var parentIndex=0;parentIndex<conns.parents.length;parentIndex++){var pIndex=findIndex(modelArray,function(mod){return mod.FBX_ID===conns.parents[parentIndex].ID;});if(pIndex>-1){modelArray[pIndex].add(model);break;}}if(model.parent===null){sceneGraph.add(model);}}// Now with the bones created, we can update the skeletons and bind them to the skinned meshes.
  sceneGraph.updateMatrixWorld(true);// Put skeleton into bind pose.
  var BindPoseNode=FBXTree.Objects.subNodes.Pose;for(var nodeID in BindPoseNode){if(BindPoseNode[nodeID].attrType==='BindPose'){BindPoseNode=BindPoseNode[nodeID];break;}}if(BindPoseNode){var PoseNode=BindPoseNode.subNodes.PoseNode;var worldMatrices=new Map();var id=undefined;var rawMatWrd=undefined;for(var PoseNodeIndex=0,PoseNodeLength=PoseNode.length;PoseNodeIndex<PoseNodeLength;++PoseNodeIndex){var node=PoseNode[PoseNodeIndex];var subNodes=node.subNodes;if(version<7000){subNodes=node;}if(!subNodes){continue;}id=version>7000?parseInt(node.id):node.id;//TODO: check id for version 6
  rawMatWrd=parseMatrixArray(FBXLoader2.getFbxPropertyData('Matrix',subNodes));if(!rawMatWrd){continue;}worldMatrices.set(id,rawMatWrd);}}for(var FBX_ID in deformers){// setSkeletonInBindPose
  var deformer=deformers[FBX_ID];var subDeformers=deformer.map;for(var key in subDeformers){var subDeformer=subDeformers[key];var subDeformerIndex=subDeformer.index;var bone=deformer.bones[subDeformerIndex];if(!worldMatrices.has(bone.FBX_ID)){break;}var mat=worldMatrices.get(bone.FBX_ID);bone.matrixWorld.copy(mat);}// Now that skeleton is in bind pose, bind to model.
  deformer.skeleton=new Skeleton(deformer.bones);// bindSkeletonToModel
  var conns=connections.get(deformer.FBX_ID);var parents=conns.parents;var parent=undefined;var geometryId=undefined;var geometryConnections=undefined;var geometryParents=undefined;var geometryParentId=undefined;var model=undefined;for(var parentsIndex=0,parentsLength=parents.length;parentsIndex<parentsLength;++parentsIndex){parent=parents[parentsIndex];geometryId=parent.ID;if(!geometryMap.has(geometryId)){continue;}if(version<7000){if(!modelMap.has(geometryId)){continue;}model=modelMap.get(geometryId);if(model instanceof SkinnedMesh){model.bind(deformer.skeleton,model.matrixWorld);break;}else{console.error('FBXLoader2: Unable to bind skeleton with world matrix, the mesh is not an instance of SkinnedMesh !');}}else{geometryConnections=connections.get(geometryId);geometryParents=geometryConnections.parents;for(var i=0,numberOfGeometry=geometryParents.length;i<numberOfGeometry;++i){geometryParentId=geometryParents[i].ID;if(!modelMap.has(geometryParentId)){continue;}model=modelMap.get(geometryParentId);if(model instanceof SkinnedMesh){model.bind(deformer.skeleton,model.matrixWorld);break;}else{console.error('FBXLoader2: Unable to bind skeleton with world matrix, the mesh is not an instance of SkinnedMesh !');}}}}}//Skeleton is now bound, return objects to starting
  //world positions.
  sceneGraph.updateMatrixWorld(true);// Silly hack with the animation parsing.  We're gonna pretend the scene graph has a skeleton
  // to attach animations to, since FBXs treat animations as animations for the entire scene,
  // not just for individual objects.
  sceneGraph.skeleton={bones:modelArray};return sceneGraph;}function parseAnimations(FBXTree,connections,sceneGraph,version){var objects=FBXTree.Objects;if(!objects){console.error("Unable to parse animation, fbx tree does not contain Objects !");return null;}var subNodes=objects.subNodes;if(!subNodes){console.error("Unable to parse animation, fbx tree's Objects does not contain subNodes !");return null;}if(!connections){console.error("Unable to parse animation for null or undefined connections !");return null;}if(!sceneGraph){console.error("Unable to parse animation for null or undefined scene !");return null;}var rawNodes=FBXTree.Objects.subNodes.AnimationCurveNode;var rawCurves=FBXTree.Objects.subNodes.AnimationCurve;var rawLayers=FBXTree.Objects.subNodes.AnimationLayer;var rawStacks=FBXTree.Objects.subNodes.AnimationStack;var animations={curves:new Map(),layers:{},stacks:{},length:0,fps:30,frames:0};var animationCurveNodes=[];for(var nodeID in rawNodes){if(!nodeID.match(/\d+/)){continue;}var animationNode=parseAnimationNode(FBXTree,rawNodes[nodeID],connections,sceneGraph);animationCurveNodes.push(animationNode);}var tmpMap=new Map();for(var animationCurveNodeIndex=0,numberOfAnimationCurves=animationCurveNodes.length;animationCurveNodeIndex<numberOfAnimationCurves;++animationCurveNodeIndex){if(animationCurveNodes[animationCurveNodeIndex]===null){continue;}tmpMap.set(animationCurveNodes[animationCurveNodeIndex].id,animationCurveNodes[animationCurveNodeIndex]);}var animationCurves=[];for(nodeID in rawCurves){if(!nodeID.match(/\d+/)){continue;}var animationCurve=parseAnimationCurve(rawCurves[nodeID],version);// seems like this check would be necessary?
  if(!connections.has(animationCurve.id)){continue;}animationCurves.push(animationCurve);var firstParentConn=connections.get(animationCurve.id).parents[0];var firstParentID=firstParentConn.ID;var firstParentRelationship=firstParentConn.relationship;var axis='';if(firstParentRelationship.match(/X/)){axis='x';}else if(firstParentRelationship.match(/Y/)){axis='y';}else if(firstParentRelationship.match(/Z/)){axis='z';}else{continue;}tmpMap.get(firstParentID).curves[axis]=animationCurve;}tmpMap.forEach(function(curveNode){var id=curveNode.containerBoneID;if(!animations.curves.has(id)){animations.curves.set(id,{T:null,R:null,S:null});}animations.curves.get(id)[curveNode.attr]=curveNode;if(curveNode.attr==='R'){var curves=curveNode.curves;// Seems like some FBX files have AnimationCurveNode
  // which doesn't have any connected AnimationCurve.
  // Setting animation parameter for them here.
  if(curves.x===null){curves.x={version:null,times:[0.0],values:[0.0]};}if(curves.y===null){curves.y={version:null,times:[0.0],values:[0.0]};}if(curves.z===null){curves.z={version:null,times:[0.0],values:[0.0]};}curves.x.values=curves.x.values.map(degreeToRadian);curves.y.values=curves.y.values.map(degreeToRadian);curves.z.values=curves.z.values.map(degreeToRadian);if(curveNode.preRotations!==null){var preRotations=new Euler().setFromVector3(curveNode.preRotations,'ZYX');preRotations=new Quaternion().setFromEuler(preRotations);var frameRotation=new Euler();var frameRotationQuaternion=new Quaternion();for(var frame=0;frame<curves.x.times.length;++frame){frameRotation.set(curves.x.values[frame],curves.y.values[frame],curves.z.values[frame],'ZYX');frameRotationQuaternion.setFromEuler(frameRotation).premultiply(preRotations);frameRotation.setFromQuaternion(frameRotationQuaternion,'ZYX');curves.x.values[frame]=frameRotation.x;curves.y.values[frame]=frameRotation.y;curves.z.values[frame]=frameRotation.z;}}}});for(var nodeID in rawLayers){var layer=[];var rawLayer=rawLayers[nodeID];var id=version>7000?parseInt(nodeID):rawLayer.id;//TODO: check id for version 6
  var children=connections.get(id).children;for(var childIndex=0;childIndex<children.length;childIndex++){// Skip lockInfluenceWeights
  if(tmpMap.has(children[childIndex].ID)){var curveNode=tmpMap.get(children[childIndex].ID);var boneID=curveNode.containerBoneID;if(layer[boneID]===undefined){layer[boneID]={T:null,R:null,S:null};}layer[boneID][curveNode.attr]=curveNode;}}animations.layers[nodeID]=layer;}for(var nodeID in rawStacks){var layers=[];var rawStack=rawStacks[nodeID];var id=version>7000?parseInt(nodeID):rawStack.id;//TODO: check id for version 6
  var children=connections.get(id).children;var timestamps={max:0,min:Number.MAX_VALUE};for(var childIndex=0;childIndex<children.length;++childIndex){var currentLayer=animations.layers[children[childIndex].ID];if(!currentLayer){continue;}layers.push(currentLayer);for(var currentLayerIndex=0,currentLayerLength=currentLayer.length;currentLayerIndex<currentLayerLength;++currentLayerIndex){var layer=currentLayer[currentLayerIndex];if(!layer){continue;}getCurveNodeMaxMinTimeStamps(layer,timestamps);}}// Do we have an animation clip with actual length?
  if(timestamps.max>timestamps.min){animations.stacks[nodeID]={name:rawStacks[nodeID].attrName,layers:layers,length:timestamps.max-timestamps.min,frames:(timestamps.max-timestamps.min)*30};}}return animations;}function parseAnimationsV6(FBXTree,connections,sceneGraph){if(!FBXTree){console.error("Unable to parse animation for null or undefined fbx tree !");return null;}var takes=FBXTree.Takes;if(!takes){console.error("Unable to parse animation, fbx tree does not contain Takes !");return null;}if(!connections){console.error("Unable to parse animation for null or undefined connections !");return null;}if(!sceneGraph){console.error("Unable to parse animation for null or undefined scene !");return null;}if(sceneGraph.animations===undefined){sceneGraph.animations=[];}var take=undefined;var animationClip=undefined;var animationName=undefined;var animationDuration=0;var tracks=[];for(var takeIndex=0,numberOfTakes=takes.length;takeIndex<numberOfTakes;takeIndex++){take=takes[takeIndex];// TODO: create tracks from take
  animationClip=new AnimationClip$1(animationName,animationDuration,tracks);sceneGraph.animations.push(animationClip);}}function parseAnimationNode(FBXTree,animationCurveNode,connections,sceneGraph){var rawModels=FBXTree.Objects.subNodes.Model;var animationNode={id:animationCurveNode.id,attr:animationCurveNode.attrName,internalID:animationCurveNode.id,attrX:false,attrY:false,attrZ:false,containerBoneID:-1,containerID:-1,curves:{x:null,y:null,z:null},preRotations:null};if(!animationNode.attr.match(/S|R|T/)){return null;}for(var attributeKey in animationCurveNode.properties){if(attributeKey.match(/X/)){animationNode.attrX=true;}if(attributeKey.match(/Y/)){animationNode.attrY=true;}if(attributeKey.match(/Z/)){animationNode.attrZ=true;}}var conns=connections.get(animationNode.id);var containerIndices=conns.parents;for(var containerIndicesIndex=containerIndices.length-1;containerIndicesIndex>=0;--containerIndicesIndex){var boneID=findIndex(sceneGraph.skeleton.bones,function(bone){return bone.FBX_ID===containerIndices[containerIndicesIndex].ID;});if(boneID>-1){animationNode.containerBoneID=boneID;animationNode.containerID=containerIndices[containerIndicesIndex].ID;var model=rawModels[animationNode.containerID.toString()];if('PreRotation'in model.properties){animationNode.preRotations=parseVector3(model.properties.PreRotation).multiplyScalar(DEG2RAD);}break;}}return animationNode;}function parseAnimationCurve(animationCurve,version){return{version:null,id:animationCurve.id,internalID:animationCurve.id,times:parseFloatArray(FBXLoader2.getFbxPropertyData('KeyTime',animationCurve)).map(FBXLoader2.convertFbxTimeToSeconds),values:parseFloatArray(FBXLoader2.getFbxPropertyData('KeyValueFloat',animationCurve)),attrFlag:parseIntArray(FBXLoader2.getFbxPropertyData('KeyAttrFlags',animationCurve)),attrData:parseFloatArray(FBXLoader2.getFbxPropertyData('KeyAttrDataFloat',animationCurve))};}function getCurveNodeMaxMinTimeStamps(layer,timestamps){if(layer.R){getCurveMaxMinTimeStamp(layer.R.curves,timestamps);}if(layer.S){getCurveMaxMinTimeStamp(layer.S.curves,timestamps);}if(layer.T){getCurveMaxMinTimeStamp(layer.T.curves,timestamps);}}function getCurveMaxMinTimeStamp(curve,timestamps){if(curve.x){getCurveAxisMaxMinTimeStamps(curve.x,timestamps);}if(curve.y){getCurveAxisMaxMinTimeStamps(curve.y,timestamps);}if(curve.z){getCurveAxisMaxMinTimeStamps(curve.z,timestamps);}}function getCurveAxisMaxMinTimeStamps(axis,timestamps){timestamps.max=axis.times[axis.times.length-1]>timestamps.max?axis.times[axis.times.length-1]:timestamps.max;timestamps.min=axis.times[0]<timestamps.min?axis.times[0]:timestamps.min;}function addAnimations(group,animations){if(!group){console.error("Unable to add animation for null or undefined group !");return null;}var skeleton=group.skeleton;if(!group){console.error("Unable to add animation for null or undefined group skeleton !");return null;}var bones=skeleton.bones;if(!bones){console.error("Unable to add animation for null or undefined group skeleton bones !");return null;}if(!animations){console.error("Unable to add animation for null or undefined animations !");return null;}var stacks=animations.stacks;if(!stacks){console.error("Unable to add animation for null or undefined animations stacks !");return null;}if(group.animations===undefined){group.animations=[];}var stacks=animations.stacks;var bone=undefined;var boneName=undefined;var parentIndex=undefined;var animationNode=undefined;var node=undefined;for(var key in stacks){var stack=stacks[key];var animationData={name:stack.name,fps:30,length:stack.length,hierarchy:[]};for(var bonesIndex=0,bonesLength=bones.length;bonesIndex<bonesLength;++bonesIndex){bone=bones[bonesIndex];boneName=bone.name.replace(/.*:/,'');parentIndex=bones.findIndex(function(parentBone){return bone.parent===parentBone;});animationData.hierarchy.push({parent:parentIndex,name:boneName,keys:[]});}for(var frame=0,numberOfFrames=stack.frames;frame<numberOfFrames;frame++){for(var bonesIndex=0,bonesLength=bones.length;bonesIndex<bonesLength;++bonesIndex){bone=bones[bonesIndex];animationNode=stack.layers[0][bonesIndex];for(var hierarchyIndex=0,hierarchyLength=animationData.hierarchy.length;hierarchyIndex<hierarchyLength;++hierarchyIndex){node=animationData.hierarchy[hierarchyIndex];if(node.name===bone.name){node.keys.push(generateKey(animations,animationNode,bone,frame));}}}}group.animations.push(AnimationClip$1.parseAnimation(animationData,bones));}}var euler=new Euler();var quaternion=new Quaternion();function generateKey(animations,animationNode,bone,frame){var key={time:frame/animations.fps,pos:bone.position.toArray(),rot:bone.quaternion.toArray(),scl:bone.scale.toArray()};if(animationNode===undefined){return key;}try{if(hasCurve(animationNode,'T')&&hasKeyOnFrame(animationNode.T,frame)){key.pos=[animationNode.T.curves.x.values[frame],animationNode.T.curves.y.values[frame],animationNode.T.curves.z.values[frame]];}if(hasCurve(animationNode,'R')&&hasKeyOnFrame(animationNode.R,frame)){var rotationX=animationNode.R.curves.x.values[frame];var rotationY=animationNode.R.curves.y.values[frame];var rotationZ=animationNode.R.curves.z.values[frame];quaternion.setFromEuler(euler.set(rotationX,rotationY,rotationZ,'ZYX'));key.rot=quaternion.toArray();}if(hasCurve(animationNode,'S')&&hasKeyOnFrame(animationNode.S,frame)){key.scl=[animationNode.S.curves.x.values[frame],animationNode.S.curves.y.values[frame],animationNode.S.curves.z.values[frame]];}}catch(error){// Curve is not fully plotted.
  console.log('FBXLoader2: ',bone);console.log('FBXLoader2: ',error);}return key;}var AXES=['x','y','z'];function hasCurve(animationNode,attribute){if(animationNode===undefined){return false;}var attributeNode=animationNode[attribute];if(!attributeNode){return false;}return AXES.every(function(key){return attributeNode.curves[key]!==null;});}function hasKeyOnFrame(attributeNode,frame){return AXES.every(function(key){return isKeyExistOnFrame(attributeNode.curves[key],frame);});}function isKeyExistOnFrame(curve,frame){return curve.values[frame]!==undefined;}// Public methods
  return{constructor:FBXLoader2,load:function load(url,onLoad,onProgress,onError){if(url===null||url===undefined){throw new Error('FBXLoader2: url cannot be null, or undefined !');}if(onLoad===null||onLoad===undefined){throw new Error('FBXLoader2: onLoad cannot be null, or undefined !');}if(typeof onLoad!=='function'){throw new Error('FBXLoader2: onLoad must be a function that take an Object3D as parameter !');}var self=this;var resourceDirectory=Loader$1.prototype.extractUrlBase(url);var loader=new FileLoader(this.manager);loader.setResponseType('arraybuffer');loader.load(url,function(buffer){try{var scene=self.parse(buffer,resourceDirectory);onLoad(scene);}catch(error){window.setTimeout(function(){if(onError){onError(error);}self.manager.itemError(url);},0);}},onProgress,onError);},parse:function parse(FBXBuffer,resourceDirectory){if(FBXBuffer===null||FBXBuffer===undefined){throw new Error('FBXLoader2: FBXBuffer cannot be null, or undefined');}if(resourceDirectory===null||resourceDirectory===undefined){throw new Error('FBXLoader2: resourceDirectory cannot be null, or undefined');}var format=FBXLoader2.getFbxFormat(FBXBuffer);var parser=undefined;if(format==='binary'){parser=new BinaryParser$1();}else{FBXBuffer=convertArrayBufferToString$1(FBXBuffer);parser=new TextParser$1();}var FBXTree=parser.parse(FBXBuffer);if(!FBXTree){throw new Error('FBXLoader2: Unable to parse data tree for null or undefined fbx tree !');}var version=parser.version;var connections=parseConnections(FBXTree,version);var images=parseImages(FBXTree,version);var textures=parseTextures(FBXTree,new TextureLoader(this.manager).setPath(resourceDirectory),images,connections,version);var materials=parseMaterials(FBXTree,textures,connections,version);var deformers=parseDeformers(FBXTree,connections,version);var geometries=parseGeometries(FBXTree,connections,deformers,version);var scene=parseScene(FBXTree,connections,deformers,geometries,materials,version);var animations=version>7000?parseAnimations(FBXTree,connections,scene):parseAnimationsV6(FBXTree,connections,scene);addAnimations(scene,animations);return scene;}};}());function Vertex$1(){this.position=new Vector3$1();this.normal=new Vector3$1();this.uv=new Vector2$1();this.color=new Vector3$1();this.skinIndices=new Vector4$1(0,0,0,0);this.skinWeights=new Vector4$1(0,0,0,0);}Object.assign(Vertex$1.prototype,{copy:function copy(target){var vertex=target||new Vertex$1();vertex.position.copy(this.position);vertex.normal.copy(this.normal);vertex.uv.copy(this.uv);vertex.skinIndices.copy(this.skinIndices);vertex.skinWeights.copy(this.skinWeights);return vertex;}});function Triangle$1(){this.vertices=[];}Object.assign(Triangle$1.prototype,{copy:function copy(target){var triangle=target||new Triangle$1();for(var i=0;i<this.vertices.length;++i){this.vertices[i].copy(triangle.vertices[i]);}return triangle;}});function Face$1(){this.triangles=[];this.materialIndex=0;}Object.assign(Face$1.prototype,{copy:function copy(target){var face=target||new Face$1();for(var i=0;i<this.triangles.length;++i){this.triangles[i].copy(face.triangles[i]);}face.materialIndex=this.materialIndex;return face;},generateTrianglesFromVertices:function generateTrianglesFromVertices(vertexArray){var triangle=undefined;for(var i=2;i<vertexArray.length;++i){triangle=new Triangle$1();triangle.vertices[0]=vertexArray[0];triangle.vertices[1]=vertexArray[i-1];triangle.vertices[2]=vertexArray[i];this.triangles.push(triangle);}}});function Geometry$1(){this.faces=[];this.skeleton=null;}Object.assign(Geometry$1.prototype,{flattenToBuffers:function flattenToBuffers(){var vertexBuffer=[];var normalBuffer=[];var uvBuffer=[];var colorBuffer=[];var skinIndexBuffer=[];var skinWeightBuffer=[];var materialIndex=this.materialIndex;var materialIndexBuffer=[];var faces=this.faces;var face=undefined;var triangles=undefined;var triangle=undefined;var vertices=undefined;var vertice=undefined;var position=undefined;var normal=undefined;var uv=undefined;var color=undefined;var skinIndex=undefined;var skinWeight=undefined;for(var faceIndex=0,faceLength=faces.length;faceIndex<faceLength;++faceIndex){face=faces[faceIndex];triangles=face.triangles;materialIndex=face.materialIndex;for(var triangleIndex=0,numberOfTriangles=triangles.length;triangleIndex<numberOfTriangles;++triangleIndex){triangle=triangles[triangleIndex];vertices=triangle.vertices;materialIndexBuffer.push(materialIndex,materialIndex,materialIndex);for(var verticeIndex=0,numberOfVertices=vertices.length;verticeIndex<numberOfVertices;++verticeIndex){vertice=vertices[verticeIndex];position=vertice.position;normal=vertice.normal;uv=vertice.uv;color=vertice.color;skinIndex=vertice.skinIndices;skinWeight=vertice.skinWeights;vertexBuffer.push(position.x,position.y,position.z);normalBuffer.push(normal.x,normal.y,normal.z);uvBuffer.push(uv.x,uv.y);colorBuffer.push(color.x,color.y,color.z);skinIndexBuffer.push(skinIndex.x,skinIndex.y,skinIndex.z,skinIndex.w);skinWeightBuffer.push(skinWeight.x,skinWeight.y,skinWeight.z,skinWeight.w);}}}return{vertexBuffer:vertexBuffer,normalBuffer:normalBuffer,uvBuffer:uvBuffer,colorsBuffer:colorBuffer,skinIndexBuffer:skinIndexBuffer,skinWeightBuffer:skinWeightBuffer,materialIndexBuffer:materialIndexBuffer};}});function TextParser$1(){this.allNodes=new FBXTree$1();this.nodeStack=[];this.currentProp=[];this.currentPropName='';this.currentIndent=0;this.version=0;}Object.assign(TextParser$1,{// UTILS
  isFlattenNode:function isFlattenNode(node){return'subNodes'in node&&'properties'in node?true:false;}});Object.assign(TextParser$1.prototype,{getFbxVersion:function getFbxVersion(text){var match=text.match(/FBXVersion: (\d+)/);if(!match){throw new Error('FBXLoader2: Cannot find the version number for the file given.');}var version=parseInt(match[1]);if(!version||version<6000){throw new Error('FBXLoader2: FBX version '+version+' not supported.');}return version;},getPrevNode:function getPrevNode(){return this.nodeStack[this.currentIndent-2];},getCurrentNode:function getCurrentNode(){return this.nodeStack[this.currentIndent-1];},getCurrentProp:function getCurrentProp(){return this.currentProp;},setCurrentProp:function setCurrentProp(val,name){this.currentProp=val;this.currentPropName=name;},pushStack:function pushStack(node){this.nodeStack.push(node);this.currentIndent+=1;},popStack:function popStack(){this.nodeStack.pop();this.currentIndent-=1;},// ----------parse ---------------------------------------------------
  parse:function parse(text){this.allNodes=new FBXTree$1();this.nodeStack=[];this.currentProp=[];this.currentPropName='';this.currentIndent=0;this.version=this.getFbxVersion(text);console.log('FBXLoader2: FBX ascii version: '+this.version);var split=text.split('\n');var line=undefined;var beginningOfNodeExp=undefined;var propExp=undefined;var endOfNodeExp=undefined;for(var lineNum=0,lineLength=split.length;lineNum<lineLength;lineNum++){line=split[lineNum];// skip comment line
  if(line.match(/^[\s\t]*;/)){continue;}// skip empty line
  if(line.match(/^[\s\t]*$/)){continue;}// beginning of node
  beginningOfNodeExp=new RegExp("^(?:\\t{"+this.currentIndent+"}|[ ]{"+this.currentIndent*4+"})(\\w+):(.*){",'');if(beginningOfNodeExp.test(line)){var match=line.match(beginningOfNodeExp);if(match.length!==3){console.error("Invalid matching for begin of node: "+line);continue;}var nodeName=match[1].trim().replace(/^"/,'').replace(/"$/,'');var nodeAttrs=match[2].split(',').map(function(element){return element.trim().replace(/^"/,'').replace(/"$/,'');});this.parseNodeBegin(line,nodeName,nodeAttrs||null);continue;}// node's property
  propExp=new RegExp("^(?:\\t{"+this.currentIndent+"}|[ ]{"+this.currentIndent*4+"})(\\w+):[\\s\\t\\r\\n](.*)");if(propExp.test(line)){// If this is a root property, just ignore it
  if(this.currentIndent===0){continue;}var match=line.match(propExp);if(match.length!==3){console.error("Invalid matching for node property: "+line);continue;}var propName=match[1].replace(/^"/,'').replace(/"$/,'').trim();var propValue=match[2].replace(/^"/,'').replace(/"$/,'').trim();// for special case: base64 image data follows "Content: ," line
  //	Content: ,
  //	 "iVB..."
  if(propName==='Content'&&propValue===','){propValue=split[++lineNum].replace(/"/g,'').trim();}this.parseNodeProperty(line,propName,propValue);continue;}// end of node
  endOfNodeExp=new RegExp("^(?:\\t{"+(this.currentIndent-1)+"}|[ ]{"+(this.currentIndent-1)*4+"})}");if(endOfNodeExp.test(line)){this.nodeEnd();continue;}// for special case,
  //
  //	  Vertices: *8670 {
  //		  a: 0.0356229953467846,13.9599733352661,-0.399196773.....(snip)
  // -0.0612030513584614,13.960485458374,-0.409748703241348,-0.10.....
  // 0.12490539252758,13.7450733184814,-0.454119384288788,0.09272.....
  // 0.0836158767342567,13.5432004928589,-0.435397416353226,0.028.....
  //
  // these case the lines must contiue with previous line
  if(/(\d+(\.\d+)?,?)+/.test(line)){this.parseNodePropertyContinued(line);}}return this.allNodes;},parseNodeBegin:function parseNodeBegin(line,nodeName,nodeAttrs){// var nodeName = match[1];
  var node={name:nodeName,properties:{},subNodes:{}};var attrs=this.parseNodeAttribute(nodeAttrs);var currentNode=this.getCurrentNode();// a top node
  if(this.currentIndent===0){this.allNodes.add(nodeName,node);}else{// a subnode
  // already exists subnode, then append it
  if(nodeName in currentNode.subNodes){var tmp=currentNode.subNodes[nodeName];// console.log( "duped entry found\nkey: " + nodeName + "\nvalue: " + propValue );
  if(TextParser$1.isFlattenNode(currentNode.subNodes[nodeName])){if(attrs.id===''){currentNode.subNodes[nodeName]=[];currentNode.subNodes[nodeName].push(tmp);}else{currentNode.subNodes[nodeName]={};currentNode.subNodes[nodeName][tmp.id]=tmp;}}if(attrs.id===''){currentNode.subNodes[nodeName].push(node);}else{currentNode.subNodes[nodeName][attrs.id]=node;}}else if(nodeName==="Material"||nodeName==="Model"||nodeName==="Texture"){currentNode.subNodes[nodeName]={};currentNode.subNodes[nodeName][attrs.id]=node;}else if(typeof attrs.id==='number'||attrs.id.match(/^\d+$/)){currentNode.subNodes[nodeName]={};currentNode.subNodes[nodeName][attrs.id]=node;}else{currentNode.subNodes[nodeName]=node;}}// for this		  ↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓
  // NodeAttribute: 1001463072, "NodeAttribute::", "LimbNode" {
  if(nodeAttrs){// Todo maybe we should generate UUID id for version 6  instead of using the name !
  node.id=attrs.id;node.attrName=attrs.name;node.attrType=attrs.type?attrs.type:attrs.name;}this.pushStack(node);},parseNodeAttribute:function parseNodeAttribute(attrs){// Remove inner space in case it's a string !
  var id=attrs[0].replace(/\s+/g,'');if(attrs[0]!==""){id=parseInt(attrs[0]);if(isNaN(id)){// PolygonVertexIndex: *16380 {
  id=attrs[0].replace(/\s+/g,'');}}var name='',type='';if(attrs.length>1){name=attrs[1].replace(/^(\w+)::/,'');type=attrs[2];}return{id:id,name:name,type:type};},parseNodeProperty:function parseNodeProperty(line,propName,propValue){var currentNode=this.getCurrentNode();var parentName=currentNode.name;// special case parent node's is like "Properties70"
  // these children nodes must treat with careful
  if(parentName!==undefined){var propMatch=parentName.match(/Properties(\d)+/);if(propMatch){this.parseNodeSpecialProperty(line,propName,propValue);return;}}// special case Connections
  if(propName==='C'){var connProps=propValue.split(',').slice(1);var from=parseInt(connProps[0]);var to=parseInt(connProps[1]);var rest=propValue.split(',').slice(3);propName='connections';propValue=[from,to];append$1(propValue,rest);if(currentNode.properties[propName]===undefined){currentNode.properties[propName]=[];}}// special case Connections for version 6 files
  if(propName==='Connect'){var connProps=propValue.replace(/["\s]+/g,'').split(',').slice(1);var from=connProps[0];var to=connProps[1];var rest=propValue.split(',').slice(3);propName='connections';propValue=[from,to];propValue=propValue.concat(rest);if(currentNode.properties[propName]===undefined){currentNode.properties[propName]=[];}}// special case Connections
  if(propName==='Node'){// Todo: check if Version 6 have non numerical id !!!
  currentNode.properties.id=propValue;currentNode.id=propValue;// var id = parseInt( propValue );
  // currentNode.properties.id = id;
  // currentNode.id = id;
  }// already exists in properties, then append this
  if(propName in currentNode.properties){// console.log( "duped entry found\nkey: " + propName + "\nvalue: " + propValue );
  if(Array.isArray(currentNode.properties[propName])){currentNode.properties[propName].push(propValue);}else{currentNode.properties[propName]+=propValue;}}else{// console.log( propName + ":  " + propValue );
  if(Array.isArray(currentNode.properties[propName])){currentNode.properties[propName].push(propValue);}else{currentNode.properties[propName]=propValue;}}this.setCurrentProp(currentNode.properties,propName);},parseNodePropertyContinued:function parseNodePropertyContinued(line){this.currentProp[this.currentPropName]+=line;},parseNodeSpecialProperty:function parseNodeSpecialProperty(line,propName,propValue){// split this
  // P: "Lcl Scaling", "Lcl Scaling", "", "A",1,1,1
  // into array like below
  // ["Lcl Scaling", "Lcl Scaling", "", "A", "1,1,1" ]
  var props=propValue.split('",').map(function(element){return element.trim().replace(/^\"/,'').replace(/\s/,'_');});var innerPropName=props[0];var innerPropType1=props[1];var innerPropType2=props[2];if(!props[4]){var innerPropFlag=null;var innerPropValue=props[3];}else{var innerPropFlag=props[3];var innerPropValue=props[4];}// cast value in its type
  switch(innerPropType1){case'int':innerPropValue=parseInt(innerPropValue);break;case'double':innerPropValue=parseFloat(innerPropValue);break;case'ColorRGB':case'Vector3D':innerPropValue=parseFloatArray(innerPropValue);break;}// CAUTION: these props must append to parent's parent
  this.getPrevNode().properties[innerPropName]={'type':innerPropType1,'type2':innerPropType2,'flag':innerPropFlag,'value':innerPropValue};this.setCurrentProp(this.getPrevNode().properties,innerPropName);},nodeEnd:function nodeEnd(){this.popStack();}});// Binary format specification:
  //   https://code.blender.org/2013/08/fbx-binary-file-format-specification/
  //   https://wiki.rogiken.org/specifications/file-format/fbx/ (more detail but Japanese)
  function BinaryParser$1(){this.version=0;}Object.assign(BinaryParser$1.prototype,{getFbxVersion:function getFbxVersion(reader){var version=reader.getUint32();if(!version||version<6000){throw new Error('FBXLoader2: FBX version '+version+' not supported.');}return version;},parse:function parse(buffer){var reader=new BinaryReader$1(buffer);reader.skip(23);// skip magic 23 bytes
  this.version=this.getFbxVersion(reader);console.log('FBXLoader2: FBX binary version: '+this.version);var allNodes=new FBXTree$1();while(!this.endOfContent(reader)){var node=this.parseNode(reader,this.version);if(node!==null){allNodes.add(node.name,node);}}return allNodes;},endOfContent:function endOfContent(reader){// footer size: 160bytes + 16-byte alignment padding
  // - 16bytes: magic
  // - padding til 16-byte alignment (at least 1byte?)
  //   (seems like some exporters embed fixed 15 or 16bytes?)
  // - 4bytes: magic
  // - 4bytes: version
  // - 120bytes: zero
  // - 16bytes: magic
  if(reader.size()%16===0){return(reader.getOffset()+160+16&~0xf)>=reader.size();}else{return reader.getOffset()+160+16>=reader.size();}},parseNode:function parseNode(reader,version){// The first three data sizes depends on version.
  var endOffset=version>=7500?reader.getUint64():reader.getUint32();var numProperties=version>=7500?reader.getUint64():reader.getUint32();var propertyListLen=version>=7500?reader.getUint64():reader.getUint32();var nameLen=reader.getUint8();var name=reader.getString(nameLen);// Regards this node as NULL-record if endOffset is zero
  if(endOffset===0){return null;}var propertyList=[];for(var i=0;i<numProperties;i++){propertyList.push(this.parseProperty(reader));}// Regards the first three elements in propertyList as id, attrName, and attrType
  var id=propertyList.length>0?propertyList[0]:'';var attrName=propertyList.length>1?propertyList[1]:'';var attrType=propertyList.length>2?propertyList[2]:'';var subNodes={};var properties={};var isSingleProperty=false;// if this node represents just a single property
  // like (name, 0) set or (name2, [0, 1, 2]) set of {name: 0, name2: [0, 1, 2]}
  if(numProperties===1&&reader.getOffset()===endOffset){isSingleProperty=true;}while(endOffset>reader.getOffset()){var node=this.parseNode(reader,version);if(node===null){continue;}// special case: child node is single property
  if(node.singleProperty===true){var value=node.propertyList[0];if(Array.isArray(value)){// node represents
  //	Vertices: *3 {
  //		a: 0.01, 0.02, 0.03
  //	}
  // of text format here.
  node.properties[node.name]=node.propertyList[0];subNodes[node.name]=node;// Later phase expects single property array is in node.properties.a as String.
  // TODO: optimize
  node.properties.a=value.toString();}else{// node represents
  // 	Version: 100
  // of text format here.
  properties[node.name]=value;}continue;}// special case: connections
  if(name==='Connections'&&node.name==='C'){var array=[];// node.propertyList would be like
  // ["OO", 111264976, 144038752, "d|x"] (?, from, to, additional values)
  for(var i=1,il=node.propertyList.length;i<il;i++){array[i-1]=node.propertyList[i];}if(properties.connections===undefined){properties.connections=[];}properties.connections.push(array);continue;}// special case: child node is Properties\d+
  if(node.name.match(/^Properties\d+$/)){// move child node's properties to this node.
  var keys=Object.keys(node.properties);for(var i=0,il=keys.length;i<il;i++){var key=keys[i];properties[key]=node.properties[key];}continue;}// special case: properties
  if(name.match(/^Properties\d+$/)&&node.name==='P'){var innerPropName=node.propertyList[0];var innerPropType1=node.propertyList[1];var innerPropType2=node.propertyList[2];var innerPropFlag=node.propertyList[3];var innerPropValue;if(innerPropName.indexOf('Lcl ')===0){innerPropName=innerPropName.replace('Lcl ','Lcl_');}if(innerPropType1.indexOf('Lcl ')===0){innerPropType1=innerPropType1.replace('Lcl ','Lcl_');}if(innerPropType1==='Color'||innerPropType1==='ColorRGB'||innerPropType1==='Vector'||innerPropType1==='Vector3D'||innerPropType1.indexOf('Lcl_')===0){innerPropValue=[node.propertyList[4],node.propertyList[5],node.propertyList[6]];}else{innerPropValue=node.propertyList[4];}if(innerPropType1.indexOf('Lcl_')===0){innerPropValue=innerPropValue.toString();}// this will be copied to parent. see above.
  properties[innerPropName]={'type':innerPropType1,'type2':innerPropType2,'flag':innerPropFlag,'value':innerPropValue};continue;}// standard case
  // follows TextParser's manner.
  if(subNodes[node.name]===undefined){if(typeof node.id==='number'){subNodes[node.name]={};subNodes[node.name][node.id]=node;}else{subNodes[node.name]=node;}}else{if(node.id===''){if(!Array.isArray(subNodes[node.name])){subNodes[node.name]=[subNodes[node.name]];}subNodes[node.name].push(node);}else{if(subNodes[node.name][node.id]===undefined){subNodes[node.name][node.id]=node;}else{// conflict id. irregular?
  if(!Array.isArray(subNodes[node.name][node.id])){subNodes[node.name][node.id]=[subNodes[node.name][node.id]];}subNodes[node.name][node.id].push(node);}}}}return{singleProperty:isSingleProperty,id:id,attrName:attrName,attrType:attrType,name:name,properties:properties,propertyList:propertyList,// raw property list, would be used by parent
  subNodes:subNodes};},parseProperty:function parseProperty(reader){var type=reader.getChar();switch(type){case'F':return reader.getFloat32();case'D':return reader.getFloat64();case'L':return reader.getInt64();case'I':return reader.getInt32();case'Y':return reader.getInt16();case'C':return reader.getBoolean();case'f':case'd':case'l':case'i':case'b':var arrayLength=reader.getUint32();var encoding=reader.getUint32();// 0: non-compressed, 1: compressed
  var compressedLength=reader.getUint32();if(encoding===0){switch(type){case'f':return reader.getFloat32Array(arrayLength);case'd':return reader.getFloat64Array(arrayLength);case'l':return reader.getInt64Array(arrayLength);case'i':return reader.getInt32Array(arrayLength);case'b':return reader.getBooleanArray(arrayLength);}}if(window.Zlib===undefined){throw new Error('FBXLoader2: External library Inflate.min.js required, obtain or import from https://github.com/imaya/zlib.js');}var inflate=new Zlib.Inflate(new Uint8Array(reader.getArrayBuffer(compressedLength)));// eslint-disable-line no-undef
  var reader2=new BinaryReader$1(inflate.decompress().buffer);switch(type){case'f':return reader2.getFloat32Array(arrayLength);case'd':return reader2.getFloat64Array(arrayLength);case'l':return reader2.getInt64Array(arrayLength);case'i':return reader2.getInt32Array(arrayLength);case'b':return reader2.getBooleanArray(arrayLength);}case'S':var length=reader.getUint32();return reader.getString(length);case'R':var length=reader.getUint32();return reader.getArrayBuffer(length);default:throw new Error('FBXLoader2: Unknown property type '+type);}}});function BinaryReader$1(buffer,littleEndian){this.dv=new DataView(buffer);this.offset=0;this.littleEndian=littleEndian!==undefined?littleEndian:true;}Object.assign(BinaryReader$1.prototype,{getOffset:function getOffset(){return this.offset;},size:function size(){return this.dv.buffer.byteLength;},skip:function skip(length){this.offset+=length;},// seems like true/false representation depends on exporter.
  //   true: 1 or 'Y'(=0x59), false: 0 or 'T'(=0x54)
  // then sees LSB.
  getBoolean:function getBoolean(){return(this.getUint8()&1)===1;},getBooleanArray:function getBooleanArray(size){var a=[];for(var i=0;i<size;i++){a.push(this.getBoolean());}return a;},getInt8:function getInt8(){var value=this.dv.getInt8(this.offset);this.offset+=1;return value;},getInt8Array:function getInt8Array(size){var a=[];for(var i=0;i<size;i++){a.push(this.getInt8());}return a;},getUint8:function getUint8(){var value=this.dv.getUint8(this.offset);this.offset+=1;return value;},getUint8Array:function getUint8Array(size){var a=[];for(var i=0;i<size;i++){a.push(this.getUint8());}return a;},getInt16:function getInt16(){var value=this.dv.getInt16(this.offset,this.littleEndian);this.offset+=2;return value;},getInt16Array:function getInt16Array(size){var a=[];for(var i=0;i<size;i++){a.push(this.getInt16());}return a;},getUint16:function getUint16(){var value=this.dv.getUint16(this.offset,this.littleEndian);this.offset+=2;return value;},getUint16Array:function getUint16Array(size){var a=[];for(var i=0;i<size;i++){a.push(this.getUint16());}return a;},getInt32:function getInt32(){var value=this.dv.getInt32(this.offset,this.littleEndian);this.offset+=4;return value;},getInt32Array:function getInt32Array(size){var a=[];for(var i=0;i<size;i++){a.push(this.getInt32());}return a;},getUint32:function getUint32(){var value=this.dv.getUint32(this.offset,this.littleEndian);this.offset+=4;return value;},getUint32Array:function getUint32Array(size){var a=[];for(var i=0;i<size;i++){a.push(this.getUint32());}return a;},// JavaScript doesn't support 64-bit integer so attempting to calculate by ourselves.
  // 1 << 32 will return 1 so using multiply operation instead here.
  // There'd be a possibility that this method returns wrong value if the value
  // is out of the range between Number.MAX_SAFE_INTEGER and Number.MIN_SAFE_INTEGER.
  // TODO: safely handle 64-bit integer
  getInt64:function getInt64(){var low,high;if(this.littleEndian){low=this.getUint32();high=this.getUint32();}else{high=this.getUint32();low=this.getUint32();}// calculate negative value
  if(high&0x80000000){high=~high&0xFFFFFFFF;low=~low&0xFFFFFFFF;if(low===0xFFFFFFFF){high=high+1&0xFFFFFFFF;}low=low+1&0xFFFFFFFF;return-(high*0x100000000+low);}return high*0x100000000+low;},getInt64Array:function getInt64Array(size){var a=[];for(var i=0;i<size;i++){a.push(this.getInt64());}return a;},// Note: see getInt64() comment
  getUint64:function getUint64(){var low,high;if(this.littleEndian){low=this.getUint32();high=this.getUint32();}else{high=this.getUint32();low=this.getUint32();}return high*0x100000000+low;},getUint64Array:function getUint64Array(size){var a=[];for(var i=0;i<size;i++){a.push(this.getUint64());}return a;},getFloat32:function getFloat32(){var value=this.dv.getFloat32(this.offset,this.littleEndian);this.offset+=4;return value;},getFloat32Array:function getFloat32Array(size){var a=[];for(var i=0;i<size;i++){a.push(this.getFloat32());}return a;},getFloat64:function getFloat64(){var value=this.dv.getFloat64(this.offset,this.littleEndian);this.offset+=8;return value;},getFloat64Array:function getFloat64Array(size){var a=[];for(var i=0;i<size;i++){a.push(this.getFloat64());}return a;},getArrayBuffer:function getArrayBuffer(size){var value=this.dv.buffer.slice(this.offset,this.offset+size);this.offset+=size;return value;},getChar:function getChar(){return String.fromCharCode(this.getUint8());},getString:function getString(size){var s='';while(size>0){var value=this.getUint8();size--;if(value===0){break;}s+=String.fromCharCode(value);}this.skip(size);return s;}});function FBXTree$1(){}Object.assign(FBXTree$1.prototype,{add:function add(key,val){this[key]=val;},searchConnectionParent:function searchConnectionParent(id){if(this.__cache_search_connection_parent===undefined){this.__cache_search_connection_parent=[];}if(this.__cache_search_connection_parent[id]!==undefined){return this.__cache_search_connection_parent[id];}else{this.__cache_search_connection_parent[id]=[];}var conns=this.Connections.properties.connections;var results=[];for(var i=0;i<conns.length;++i){if(conns[i][0]==id){// 0 means scene root
  var res=conns[i][1]===0?-1:conns[i][1];results.push(res);}}if(results.length>0){append$1(this.__cache_search_connection_parent[id],results);return results;}else{this.__cache_search_connection_parent[id]=[-1];return[-1];}},searchConnectionChildren:function searchConnectionChildren(id){if(this.__cache_search_connection_children===undefined){this.__cache_search_connection_children=[];}if(this.__cache_search_connection_children[id]!==undefined){return this.__cache_search_connection_children[id];}else{this.__cache_search_connection_children[id]=[];}var conns=this.Connections.properties.connections;var res=[];for(var i=0;i<conns.length;++i){if(conns[i][1]==id){// 0 means scene root
  res.push(conns[i][0]===0?-1:conns[i][0]);// there may more than one kid, then search to the end
  }}if(res.length>0){append$1(this.__cache_search_connection_children[id],res);return res;}else{this.__cache_search_connection_children[id]=[];return[];}},searchConnectionType:function searchConnectionType(id,to){var key=id+','+to;// TODO: to hash
  if(this.__cache_search_connection_type===undefined){this.__cache_search_connection_type={};}if(this.__cache_search_connection_type[key]!==undefined){return this.__cache_search_connection_type[key];}else{this.__cache_search_connection_type[key]='';}var conns=this.Connections.properties.connections;for(var i=0;i<conns.length;++i){if(conns[i][0]==id&&conns[i][1]==to){// 0 means scene root
  this.__cache_search_connection_type[key]=conns[i][2];return conns[i][2];}}this.__cache_search_connection_type[id]=null;return null;}});/*
   * This program is free software: you can redistribute it and/or modify
   * it under the terms of the GNU Lesser General Public License as published by
   * the Free Software Foundation, either version 3 of the License, or
   * (at your option) any later version.
   *
   * This program is distributed in the hope that it will be useful,
   * but WITHOUT ANY WARRANTY; without even the implied warranty of
   * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.
   * See the GNU Lesser General Public License for more details.
   *
   * You should have received a copy of the GNU Lesser General Public License along
   * with this program.  If not, see <http://www.gnu.org/licenses/>.
   *
   *//**
   * @author Tristan Valcke / https://github.com/TristanVALCKE
   *
   * Description: A loader for ASC cloud point files.
   *
   *
   * Usage:
   *    var loader = new ASCLoader();
   *    loader.load('/path/to/file.asc', function (geometry) {
   *
   *		scene.add( new Mesh( geometry ) );
   *
   *	} );
   *
   * If the ASC file need to be offset,
   * it can be set before loading file.
   *
   * loader.setOffset( {
   *	x: 1.0,
   *  y: 52.0,
   *  z: -5.0
   * } );
   *
   *//**
   * Bounding box
   * @constructor
   */var BoundingBox=function BoundingBox(){this.xMin=Number.MAX_VALUE;this.xMax=Number.MIN_VALUE;this.yMin=Number.MAX_VALUE;this.yMax=Number.MIN_VALUE;this.zMin=Number.MAX_VALUE;this.zMax=Number.MIN_VALUE;};BoundingBox.prototype={constructor:BoundingBox,computePoint:function computePoint(point){if(point.x<this.xMin){this.xMin=point.x;}if(point.x>this.xMax){this.xMax=point.x;}if(point.y<this.yMin){this.yMin=point.y;}if(point.y>this.yMax){this.yMax=point.y;}if(point.z<this.zMin){this.zMin=point.z;}if(point.z>this.zMax){this.zMax=point.z;}},computePoints:function computePoints(points){for(var i=0,numPts=points.length;i<numPts;++i){this.computePoint(points[i]);}},getCenter:function getCenter(){return{x:(this.xMin+this.xMax)/2,y:(this.yMin+this.yMax)/2,z:(this.zMin+this.zMax)/2};}};/**
   *
   * @param manager
   * @constructor
   */var ASCLoader=function ASCLoader(manager){this.manager=manager!==undefined?manager:DefaultLoadingManager;this._boundingBox=new BoundingBox();this._points=[];this._numberOfPoints=0;this._coloredPoints=false;this._autoOffset=false;// Only for tiny files !!!!!!!
  this._offset={x:600200,y:131400,z:60};this._positions=null;this._bufferIndex=0;this._positionsC=null;this._bufferIndexC=0;this.wrongPoints=0;};ASCLoader.prototype={constructor:ASCLoader,load:function load(url,onLoad,onProgress,onError,sampling){console.time("ASCLoader");var scope=this;var loader=new FileLoader(scope.manager);loader.setResponseType('blob');loader.load(url,function(blob){var groupToFeed=new Group();scope._parse(blob,groupToFeed,onLoad,onProgress,onError,sampling);onLoad(groupToFeed);},onProgress,onError);},setOffset:function setOffset(offset){//TODO: check is correct
  this._offset=offset;this._autoOffset=false;},_parse:function _parse(blob,groupToFeed,onLoad,onProgress,onError,sampling){var self=this;var _sampling=sampling?sampling:100;// console.time("Parse");
  var reader=new FileReader();var CHUNK_SIZE=134217728;// var CHUNK_SIZE = 16777216;
  var offset=0;reader.onabort=function(abortEvent){// console.log("abortEvent:");
  // console.log(abortEvent);
  };reader.onerror=function(errorEvent){// console.log("errorEvent:");
  // console.log(errorEvent);
  if(onError){onError(errorEvent);}};reader.onloadstart=function(loadStartEvent){// console.log("loadStartEvent:");
  // console.log(loadStartEvent);
  };reader.onprogress=function(progressEvent){// console.log("progressEvent:");
  // console.log(progressEvent);
  // // By lines
  // var lines = this.result.split('\n');
  // for(var lineIndex = 0, numberOfLine = lines.length; lineIndex < numberOfLine; ++lineIndex){
  //     self._parseLine(lines[lineIndex])
  // }
  if(onProgress){onProgress(progressEvent);}};reader.onload=function(loadEvent){// console.log("loadEvent:");
  // console.log(loadEvent);
  // By lines
  var lines=this.result.split('\n');var numberOfLines=lines.length;// /!\ Rollback offset for last line that is uncompleted in most time
  offset-=lines[numberOfLines-1].length;// console.time("Parse Lines A");
  var modSampling=Math.round(100/_sampling);for(var lineIndex=0;lineIndex<numberOfLines-1;lineIndex++){if(lineIndex%modSampling===0)// Just to make cloud lighter under debug !!!!
  {self._parseLine(lines[lineIndex]);}}// console.timeEnd("Parse Lines A");
  // console.time("Parse Lines B");
  // self._parseLines(lines);
  // console.timeEnd("Parse Lines B");
  ////Todo: use ArrayBuffer instead !!!
  // console.time("Parse Lines B");
  // self._bufferIndex = 0;
  // self._positions = new Float32Array( numberOfLines * 3 );
  // for (var lineIndex = 0; lineIndex < numberOfLines - 1; lineIndex++) {
  //     self._parseLineB(lines[ lineIndex ])
  // }
  // console.timeEnd("Parse Lines B");
  //
  // console.time("Parse Lines C");
  // self._bufferIndexC = 0;
  // self._positionsC = new Float32Array( numberOfLines * 3 );
  // for (var lineIndex = 0; lineIndex < numberOfLines - 1; lineIndex++) {
  //     self._parseLineB(lines[ lineIndex ])
  // }
  // console.timeEnd("Parse Lines C");
  };reader.onloadend=function(loadEndEvent){// console.log("loadEndEvent");
  // console.log(loadEndEvent);
  if(self._points.length>1000000||offset+CHUNK_SIZE>=blob.size){// Compute bounding box in view to get his center for auto offseting the cloud point.
  // if ( self._autoOffset ) {
  //     console.time("Compute Points");
  //     self._boundingBox.computePoints(self._points);
  //     console.timeEnd("Compute Points");
  // }
  // console.time("Offset Points");
  self._offsetPoints();// console.timeEnd("Offset Points");
  // console.time("Create WorldCell");
  self._createSubCloudPoint(groupToFeed);// console.timeEnd("Create WorldCell");
  }offset+=CHUNK_SIZE;seek();};// reader.readAsText(blob);
  seek();function seek(){if(offset>=blob.size){// console.timeEnd("Parse");
  console.timeEnd("ASCLoader");// // Compute bounding box in view to get his center for auto offseting the cloud point.
  // if ( self._autoOffset ) {
  //     console.time("Compute Points");
  //     self._boundingBox.computePoints(self._points);
  //     console.timeEnd("Compute Points");
  // }
  //
  // console.time("Offset Points");
  // self._offsetPoints();
  // console.timeEnd("Offset Points");
  //
  // console.time("Create WorldCell");
  // self._createCloudPoint(groupToFeed);
  // // var cloudPoints = self._createCloudPoint();
  // console.timeEnd("Create WorldCell");
  // // onLoad(cloudPoints);
  return;}var slice=blob.slice(offset,offset+CHUNK_SIZE,"text/plain");reader.readAsText(slice);}},_parseLine:function _parseLine(line){var values=line.split(" "),numberOfWords=values.length;if(numberOfWords===3){this._points.push({x:parseFloat(values[0]),y:parseFloat(values[1]),z:parseFloat(values[2])});}else if(numberOfWords===4){this._pointsHaveIntensity=true;this._points.push({x:parseFloat(values[0]),y:parseFloat(values[1]),z:parseFloat(values[2]),i:parseFloat(values[3])});}else if(numberOfWords===6){//Todo: allow to ask user if 4, 5 and 6 index are normals
  //Todo: for the moment consider it is color !
  this._pointsHaveColor=true;this._points.push({x:parseFloat(values[0]),y:parseFloat(values[1]),z:parseFloat(values[2]),r:parseFloat(values[3]),g:parseFloat(values[4]),b:parseFloat(values[5])});}else if(numberOfWords===7){//Todo: allow to ask user if 4, 5 and 6 index are normals
  //Todo: for the moment consider it is color !
  this._pointsHaveIntensity=true;this._pointsHaveColor=true;this._points.push({x:parseFloat(values[0]),y:parseFloat(values[1]),z:parseFloat(values[2]),i:parseFloat(values[3]),r:parseFloat(values[4]),g:parseFloat(values[5]),b:parseFloat(values[6])});}else if(numberOfWords===9){this._pointsHaveColor=true;this._pointsHaveNormals=true;this._points.push({x:parseFloat(values[0]),y:parseFloat(values[1]),z:parseFloat(values[2]),r:parseFloat(values[3]),g:parseFloat(values[4]),b:parseFloat(values[5]),nx:parseFloat(values[6]),ny:parseFloat(values[7]),nz:parseFloat(values[8])});}else if(numberOfWords===10){this._pointsHaveIntensity=true;this._pointsHaveColor=true;this._pointsHaveNormals=true;this._points.push({x:parseFloat(values[0]),y:parseFloat(values[1]),z:parseFloat(values[2]),i:parseFloat(values[3]),r:parseFloat(values[4]),g:parseFloat(values[5]),b:parseFloat(values[6]),nx:parseFloat(values[7]),ny:parseFloat(values[8]),nz:parseFloat(values[9])});}else{console.error("Invalid data line: "+line);}},_parseLines:function _parseLines(lines){var firstLine=lines[0].split(" ");var pointType=firstLine.length;if(pointType===3){this._parseLinesAsXYZ(lines);}else if(pointType===4){this._parseLinesAsXYZI(lines);}else if(pointType===6){//Todo: allow to ask user if 4, 5 and 6 index are normals
  //Todo: for the moment consider it is color !
  this._parseLinesAsXYZRGB(lines);}else if(pointType===7){//Todo: allow to ask user if 4, 5 and 6 index are normals see _parseLinesAsXYZInXnYnZ
  //Todo: for the moment consider it is color !
  this._parseLinesAsXYZIRGB(lines);}else if(pointType===9){this._parseLinesAsXYZRGBnXnYnZ(lines);}else if(pointType===10){this._parseLinesAsXYZIRGBnXnYnZ(lines);}else{console.error("Invalid data line: "+line);}},_parseLinesAsXYZ:function _parseLinesAsXYZ(lines){var words=[];for(var lineIndex=0,numberOfLines=lines.length;lineIndex<numberOfLines;lineIndex++){words=lines[lineIndex].split(" ");this._points.push({x:parseFloat(words[0]),y:parseFloat(words[1]),z:parseFloat(words[2])});}},_parseLinesAsXYZI:function _parseLinesAsXYZI(lines){this._pointsHaveIntensity=true;var words=[];for(var lineIndex=0,numberOfLines=lines.length;lineIndex<numberOfLines;lineIndex++){words=lines[lineIndex].split(" ");this._points.push({x:parseFloat(words[0]),y:parseFloat(words[1]),z:parseFloat(words[2]),i:parseFloat(words[3])});}},_parseLinesAsXYZRGB:function _parseLinesAsXYZRGB(lines){this._pointsHaveColor=true;var words=[];for(var lineIndex=0,numberOfLines=lines.length;lineIndex<numberOfLines;lineIndex++){words=lines[lineIndex].split(" ");this._points.push({x:parseFloat(words[0]),y:parseFloat(words[1]),z:parseFloat(words[2]),r:parseFloat(words[3]),g:parseFloat(words[4]),b:parseFloat(words[5])});}},_parseLinesAsXYZnXnYnZ:function _parseLinesAsXYZnXnYnZ(lines){var words=[];for(var lineIndex=0,numberOfLines=lines.length;lineIndex<numberOfLines;lineIndex++){words=lines[lineIndex].split(" ");}},_parseLinesAsXYZIRGB:function _parseLinesAsXYZIRGB(lines){this._pointsHaveIntensity=true;this._pointsHaveColor=true;var words=[];for(var lineIndex=0,numberOfLines=lines.length;lineIndex<numberOfLines;lineIndex++){words=lines[lineIndex].split(" ");this._points.push({x:parseFloat(words[0]),y:parseFloat(words[1]),z:parseFloat(words[2]),i:parseFloat(words[3]),r:parseFloat(words[4]),g:parseFloat(words[5]),b:parseFloat(words[6])});}},_parseLinesAsXYZInXnYnZ:function _parseLinesAsXYZInXnYnZ(lines){var words=[];for(var lineIndex=0,numberOfLines=lines.length;lineIndex<numberOfLines;lineIndex++){words=lines[lineIndex].split(" ");}},_parseLinesAsXYZRGBnXnYnZ:function _parseLinesAsXYZRGBnXnYnZ(lines){this._pointsHaveColor=true;this._pointsHaveNormals=true;var words=[];for(var lineIndex=0,numberOfLines=lines.length;lineIndex<numberOfLines;lineIndex++){words=lines[lineIndex].split(" ");this._points.push({x:parseFloat(words[0]),y:parseFloat(words[1]),z:parseFloat(words[2]),r:parseFloat(words[3]),g:parseFloat(words[4]),b:parseFloat(words[5]),nx:parseFloat(words[6]),ny:parseFloat(words[7]),nz:parseFloat(words[8])});}},_parseLinesAsXYZIRGBnXnYnZ:function _parseLinesAsXYZIRGBnXnYnZ(lines){this._pointsHaveIntensity=true;this._pointsHaveColor=true;this._pointsHaveNormals=true;var words=[];for(var lineIndex=0,numberOfLines=lines.length;lineIndex<numberOfLines;lineIndex++){words=lines[lineIndex].split(" ");this._points.push({x:parseFloat(words[0]),y:parseFloat(words[1]),z:parseFloat(words[2]),i:parseFloat(words[3]),r:parseFloat(words[4]),g:parseFloat(words[5]),b:parseFloat(words[6]),nx:parseFloat(words[7]),ny:parseFloat(words[8]),nz:parseFloat(words[9])});}},_parseLineB:function _parseLineB(line){var values=line.split(" ");var numberOfWords=values.length;var bufferIndex=this._bufferIndex;if(numberOfWords===3){// positions
  this._positions[bufferIndex]=parseFloat(values[0]);this._positions[bufferIndex+1]=parseFloat(values[1]);this._positions[bufferIndex+2]=parseFloat(values[2]);this._bufferIndex+=3;}},_parseLineC:function _parseLineC(line){var values=line.split(" ");var numberOfWords=values.length;var bufferIndex=this._bufferIndexC;if(numberOfWords===3){// positions
  this._positionsC[bufferIndex]=Number.parseFloat(values[0]);this._positionsC[bufferIndex+1]=Number.parseFloat(values[1]);this._positionsC[bufferIndex+2]=Number.parseFloat(values[2]);this._bufferIndexC+=3;}},_offsetPoints:function _offsetPoints(){var offset=this._autoOffset?this._boundingBox.getCenter():this._offset;var numberOfPoints=this._points.length;var point=null;for(var i=0;i<numberOfPoints;++i){point=this._points[i];point.x-=offset.x;point.y-=offset.y;point.z-=offset.z;}},_createCloudPoint:function _createCloudPoint(groupToFeed){var SPLIT_LIMIT=1000000;// var group = new Group();
  var numberOfPoints=this._points.length;var numberOfSplit=Math.ceil(numberOfPoints/SPLIT_LIMIT);var numberOfPointInSplit=0;var cloud=null;for(var splitIndex=0;splitIndex<numberOfSplit;++splitIndex){var splice=this._points.splice(0,SPLIT_LIMIT);numberOfPointInSplit=splice.length;var geometry=new BufferGeometry();var positions=new Float32Array(numberOfPointInSplit*3);var colors=new Float32Array(numberOfPointInSplit*3);var color=new Color$1();var bufferIndex=0;var point=undefined;for(var i=0;i<numberOfPointInSplit;++i){// current point
  point=splice[i];// positions
  positions[bufferIndex]=point.x;positions[bufferIndex+1]=point.y;positions[bufferIndex+2]=point.z;// colors
  if(this._pointsHaveColor){colors[bufferIndex]=point.r/255;colors[bufferIndex+1]=point.g/255;colors[bufferIndex+2]=point.b/255;}else{colors[bufferIndex]=0.1;colors[bufferIndex+1]=0.2;colors[bufferIndex+2]=0.5;}bufferIndex+=3;}geometry.addAttribute('position',new BufferAttribute(positions,3));geometry.addAttribute('color',new BufferAttribute(colors,3));var material=new PointsMaterial({size:0.01,vertexColors:true});cloud=new Points(geometry,material);groupToFeed.children.push(cloud);// group.children.push(cloud);
  }// return group;
  },_createSubCloudPoint:function _createSubCloudPoint(group){var numberOfPoints=this._points.length;var geometry=new BufferGeometry(),positions=new Float32Array(numberOfPoints*3),colors=new Float32Array(numberOfPoints*3),color=new Color$1(),bufferIndex=0,point=undefined;for(var i=0;i<numberOfPoints;++i){// current point
  point=this._points[i];// positions
  positions[bufferIndex]=point.x;positions[bufferIndex+1]=point.y;positions[bufferIndex+2]=point.z;// colors
  if(this._pointsHaveColor){colors[bufferIndex]=point.r/255;colors[bufferIndex+1]=point.g/255;colors[bufferIndex+2]=point.b/255;}else{colors[bufferIndex]=0.1;colors[bufferIndex+1]=0.2;colors[bufferIndex+2]=0.5;}bufferIndex+=3;}geometry.addAttribute('position',new BufferAttribute(positions,3));geometry.addAttribute('color',new BufferAttribute(colors,3));var material=new PointsMaterial({size:0.005,vertexColors:true});var cloud=new Points(geometry,material);//Todo: Apply import coordinates syteme here !
  cloud.rotation.x-=Math.PI/2;group.children.push(cloud);// Clear current processed points
  this._points=[];}};/**
   * @author [Tristan Valcke]{@link https://github.com/Itee}
   * @license [BSD-3-Clause]{@link https://opensource.org/licenses/BSD-3-Clause}
   *
   * @file Todo
   *
   * @example Todo
   *
   */function TLogger(){}Object.assign(TLogger.prototype,{log:function log(message){console.log(message);},warn:function warn(warning){console.warn(warning);},error:function error(_error){console.error(_error);}});var DefaultLogger=new TLogger();/**
   * @author [Tristan Valcke]{@link https://github.com/Itee}
   * @license [BSD-3-Clause]{@link https://opensource.org/licenses/BSD-3-Clause}
   *
   * @file Todo
   *
   * @example Todo
   *
   */var Endianness=Object.freeze({Little:true,Big:false});var Byte=Object.freeze({One:1,Two:2,Four:4,Height:8});function BinaryReader$2(buffer,offset,length,endianness){this._buffer=buffer||new ArrayBuffer(0);this._offset=offset||0;this._length=length||buffer?buffer.byteLength:0;this._endianness=!!endianness||Endianness.Little;this._updateDataView();}Object.assign(BinaryReader$2.prototype,{_getAndUpdateOffsetBy:function _getAndUpdateOffsetBy(increment){var currentOffset=this._offset;this._offset+=increment;return currentOffset;},_updateDataView:function _updateDataView(){this._dataView=new DataView(this._buffer,this._offset,this._length);},isEndOfFile:function isEndOfFile(){return this._offset===this._length;},getOffset:function getOffset(){return this._offset;},skipOffsetTo:function skipOffsetTo(offset){this._offset=offset;return this;},skipOffsetOf:function skipOffsetOf(nBytes){this._offset+=nBytes;return this;},setBuffer:function setBuffer(buffer,offset,length){this._buffer=buffer;this._offset=offset||0;this._length=length||buffer.byteLength;this._updateDataView();return this;},setEndianess:function setEndianess(endianess){this._endianness=endianess;return this;},/**
       *
       * @return {number} - Int8
       */getInt8:function getInt8(){return this._dataView.getInt8(this._getAndUpdateOffsetBy(Byte.One));},getUInt8:function getUInt8(){return this._dataView.getUint8(this._getAndUpdateOffsetBy(Byte.One));},getInt16:function getInt16(){return this._dataView.getInt16(this._getAndUpdateOffsetBy(Byte.Two),this._endianness);},getUInt16:function getUInt16(){return this._dataView.getUint16(this._getAndUpdateOffsetBy(Byte.Two),this._endianness);},getInt32:function getInt32(){return this._dataView.getInt32(this._getAndUpdateOffsetBy(Byte.Four),this._endianness);},getUInt32:function getUInt32(){return this._dataView.getUint32(this._getAndUpdateOffsetBy(Byte.Four),this._endianness);},getFloat:function getFloat(){return this._dataView.getFloat32(this._getAndUpdateOffsetBy(Byte.Four),this._endianness);},getDouble:function getDouble(){return this._dataView.getFloat64(this._getAndUpdateOffsetBy(Byte.Height),this._endianness);},getChar:function getChar(){return String.fromCharCode(this._dataView.getInt8(this._getAndUpdateOffsetBy(Byte.One)));},getString:function getString(length){var trim=arguments.length>1&&arguments[1]!==undefined?arguments[1]:true;var string='';var charCode=undefined;for(var i=0;i<length;i++){charCode=this.getUInt8();if(charCode===0){continue;}string+=String.fromCharCode(charCode);}if(trim){string=string.trim();}return string;}});/**
   * @author TristanVALCKE / https://github.com/TristanVALCKE
   *
   * This class allow to split any geometries type during runtime.
   * Keeping normals and Uvs. It is really usefull to see inside mesh like building.
   *
   * Constructor parameter:
   *
   * size - the size of the square view
   *
   *////////////
  var ShapeType=Object.freeze({NullShape:0,Point:1,Polyline:3,Polygon:5,MultiPoint:8,PointZ:11,PolyLineZ:13,PolygonZ:15,MultiPointZ:18,PointM:21,PolylineM:23,PolygonM:25,MultiPointM:28,MultiPatch:31});// Helpers
  function ringClockwise(ring){if((n=ring.length)<4){return false;}var i=0,n,area=ring[n-1][1]*ring[0][0]-ring[n-1][0]*ring[0][1];while(++i<n){area+=ring[i-1][1]*ring[i][0]-ring[i-1][0]*ring[i][1];}return area>=0;}function ringContainsSome(ring,hole){var i=-1,n=hole.length,c;while(++i<n){if(c=ringContains(ring,hole[i])){return c>0;}}return false;}function ringContains(ring,point){var x=point[0],y=point[1],contains=-1;for(var i=0,n=ring.length,j=n-1;i<n;j=i++){var pi=ring[i],xi=pi[0],yi=pi[1],pj=ring[j],xj=pj[0],yj=pj[1];if(segmentContains(pi,pj,point)){return 0;}if(yi>y!==yj>y&&x<(xj-xi)*(y-yi)/(yj-yi)+xi){contains=-contains;}}return contains;}function segmentContains(p0,p1,p2){var x20=p2[0]-p0[0],y20=p2[1]-p0[1];if(x20===0&&y20===0){return true;}var x10=p1[0]-p0[0],y10=p1[1]-p0[1];if(x10===0&&y10===0){return false;}var t=(x20*x10+y20*y10)/(x10*x10+y10*y10);return t<0||t>1?false:t===0||t===1?true:t*x10===x20&&t*y10===y20;}/**
   *
   * Loader
   *
   * @param manager
   * @param logger
   * @constructor
   */function SHPLoader(){var manager=arguments.length>0&&arguments[0]!==undefined?arguments[0]:DefaultLoadingManager;var logger=arguments.length>1&&arguments[1]!==undefined?arguments[1]:DefaultLogger;this.manager=manager;this.logger=logger;this.globalOffset=new Vector3$1();this.worldAxis={from:'zUp',to:'zForward'};this._reader=new BinaryReader$2();}Object.assign(SHPLoader,{FileCode:9994,MinFileLength:100,MinVersion:1000});Object.assign(SHPLoader.prototype,{load:function load(url,onLoad,onProgress,onError){var scope=this;var loader=new FileLoader(scope.manager);loader.setResponseType('arraybuffer');loader.load(url,function(arrayBuffer){onLoad(scope.parse(arrayBuffer));},onProgress,onError);},parse:function parse(arrayBuffer){this._reader.setEndianess(Endianness.Big).setBuffer(arrayBuffer);var header=this._parseHeader();if(header.fileCode!==SHPLoader.FileCode){this.logger.error("SHPLoader: Invalide Shape file code !");return null;}if(header.fileLength<SHPLoader.MinFileLength){this.logger.error("SHPLoader: Shape file have an incorrect length !");return null;}if(!Object.values(ShapeType).includes(header.shapeType)){this.logger.error("SHPLoader: Shape file have an incorrect shape type !");return null;}if(header.version<SHPLoader.MinVersion){this.logger.warn("SHPLoader: Version of shape file below than 1000 could be incorrectly parsed !");}var datas=this._parseDatas(header);var shapes=this._convertToObjects(datas);return shapes;},_parseHeader:function _parseHeader(){var fileCode=this._reader.getInt32();this._reader.skipOffsetOf(20);var fileLength=this._reader.getInt32();this._reader.setEndianess(Endianness.Little);var version=this._reader.getInt32();var shapeType=this._reader.getInt32();var xMinBoundingBox=this._reader.getInt32();var yMinBoundingBox=this._reader.getInt32();var xMaxBoundingBox=this._reader.getInt32();var yMaxBoundingBox=this._reader.getInt32();var zMinBoundingBox=this._reader.getInt32();var zMaxBoundingBox=this._reader.getInt32();var mMinBoundingBox=this._reader.getInt32();var mMaxBoundingBox=this._reader.getInt32();return{fileCode:fileCode,fileLength:fileLength,version:version,shapeType:shapeType,boundingBox:{xMin:xMinBoundingBox,xMax:xMaxBoundingBox,yMin:yMinBoundingBox,yMax:yMaxBoundingBox,zMin:zMinBoundingBox,zMax:zMaxBoundingBox,mMin:mMinBoundingBox,mMax:mMaxBoundingBox}};},_parseDatas:function _parseDatas(header){this._reader.skipOffsetTo(100);var datas=[];var recordHeader=undefined;var endOfRecord=undefined;var recordContent=undefined;while(!this._reader.isEndOfFile()){recordHeader=this._parseRecordHeader();endOfRecord=this._reader.getOffset()+recordHeader.contentLength*2;// All parsing methods use little below
  this._reader.setEndianess(Endianness.Little);switch(header.shapeType){case ShapeType.NullShape:this._reader.skipOffsetTo(endOfRecord);//                    // Todo: just skip 1 byte - or - to endRecord
  //                    while ( this._reader.getOffset() < endOfRecord ) {
  //
  //                        recordContent = this._parseNull();
  //                        if ( recordContent ) {
  //                            datas.push( recordContent );
  //                        }
  //
  //                    }
  break;case ShapeType.Point:case ShapeType.PointZ:case ShapeType.PointM:while(this._reader.getOffset()<endOfRecord){recordContent=this._parsePoint();if(recordContent){datas.push(recordContent);}}break;case ShapeType.Polyline:case ShapeType.PolyLineZ:case ShapeType.PolylineM:while(this._reader.getOffset()<endOfRecord){recordContent=this._parsePolyLine();if(recordContent){datas.push(recordContent);}}break;case ShapeType.Polygon:case ShapeType.PolygonZ:case ShapeType.PolygonM:while(this._reader.getOffset()<endOfRecord){recordContent=this._parsePolygon();if(recordContent){datas.push(recordContent);}}break;case ShapeType.MultiPoint:case ShapeType.MultiPointZ:case ShapeType.MultiPointM:while(this._reader.getOffset()<endOfRecord){recordContent=this._parseMultiPoint();if(recordContent){datas.push(recordContent);}}break;case ShapeType.MultiPatch:while(this._reader.getOffset()<endOfRecord){recordContent=this._parseMultiPatch();if(recordContent){datas.push(recordContent);}}break;default:this.logger.error('SHPLoader: Invalid switch parameter: '+shapeType);break;}}return datas;},_parseRecordHeader:function _parseRecordHeader(){this._reader.setEndianess(Endianness.Big);var recordNumber=this._reader.getInt32();var contentLength=this._reader.getInt32();return{recordNumber:recordNumber,contentLength:contentLength};},//    _parseNull () {
  //
  //        this._reader.getInt32();
  //
  //        return null;
  //    },
  _parsePoint:function _parsePoint(){var shapeType=this._reader.getInt32();if(shapeType===ShapeType.NullShape){return null;}var x=this._reader.getDouble();var y=this._reader.getDouble();return{shapeType:shapeType,x:x,y:y};},_parsePolyLine:function _parsePolyLine(){var shapeType=this._reader.getInt32();if(shapeType===ShapeType.NullShape){return null;}var boundingBox={xMin:this._reader.getDouble(),yMin:this._reader.getDouble(),xMax:this._reader.getDouble(),yMax:this._reader.getDouble()};var numberOfParts=this._reader.getInt32();var numberOfPoints=this._reader.getInt32();var parts=new Array(numberOfParts);for(var indexParts=0;indexParts<numberOfParts;indexParts++){parts[indexParts]=this._reader.getInt32();}var points=new Array(numberOfPoints);for(var indexPoint=0;indexPoint<numberOfPoints;indexPoint++){points[indexPoint]={x:this._reader.getDouble(),y:this._reader.getDouble()};}return{shapeType:shapeType,boundingBox:boundingBox,numberOfParts:numberOfParts,numberOfPoints:numberOfPoints,parts:parts,points:points};},_parsePolygon:function _parsePolygon(){var shapeType=this._reader.getInt32();if(shapeType===ShapeType.NullShape){return null;}var boundingBox={xMin:this._reader.getDouble(),yMin:this._reader.getDouble(),xMax:this._reader.getDouble(),yMax:this._reader.getDouble()};var numberOfParts=this._reader.getInt32();var numberOfPoints=this._reader.getInt32();var parts=new Array(numberOfParts);for(var indexParts=0;indexParts<numberOfParts;indexParts++){parts[indexParts]=this._reader.getInt32();}var points=new Array(numberOfPoints);for(var indexPoint=0;indexPoint<numberOfPoints;indexPoint++){points[indexPoint]={x:this._reader.getDouble(),y:this._reader.getDouble()};}var polygons=[];var holes=[];parts.forEach(function(value,index){var ring=points.slice(value,parts[index+1]);if(ringClockwise(ring)){polygons.push(ring);//					polygons.push( [ ring ] );
  }else{holes.push(ring);}});holes.forEach(function(hole){polygons.some(function(polygon){if(ringContainsSome(polygon[0],hole)){polygon.push(hole);return true;}})||polygons.push([hole]);});return{shapeType:shapeType,boundingBox:boundingBox,numberOfParts:numberOfParts,numberOfPoints:numberOfPoints,parts:parts,polygons:polygons};},_parseMultiPoint:function _parseMultiPoint(){var shapeType=this._reader.getInt32();if(shapeType===ShapeType.NullShape){return null;}var boundingBox={xMin:this._reader.getDouble(),xMax:this._reader.getDouble(),yMin:this._reader.getDouble(),yMax:this._reader.getDouble()};var numberOfPoints=this._reader.getInt32();var points=new Array(numberOfPoints);for(var indexPoint=0;indexPoint<numberOfPoints;indexPoint++){points.push([this._reader.getDouble(),this._reader.getDouble()]);}return{shapeType:shapeType,boundingBox:boundingBox,numberOfPoints:numberOfPoints,points:points};},_parseMultiPatch:function _parseMultiPatch(){var shapeType=this._reader.getInt32();if(shapeType===ShapeType.NullShape){return null;}return{shapeType:shapeType};},_convertToObjects:function _convertToObjects(datas){var shapes=[];for(var index=0,numberOfShapes=datas.length;index<numberOfShapes;index++){var data=datas[index];if(data.shapeType===ShapeType.Polygon||data.shapeType===ShapeType.PolygonZ||data.shapeType===ShapeType.PolygonM){if(Array.isArray(data.points)){__createObjectsFromArrays(data.points);}else{__createObjectFromPoints(data.points);}}}function __createObjectsFromArrays(arrays){//Todo: need to fix parsePolygon to avoid too much array imbrication
  for(var arrayIndex=0,numberOfArray=arrays.length;arrayIndex<numberOfArray;arrayIndex++){var array=arrays[arrayIndex];if(!array){console.log('no array, oups !');continue;}if(Array.isArray(array[0])){__createObjectsFromArrays(array);}else{__createObjectFromPoints(array);}}}function __createObjectFromPoints(points){shapes.push(new Shape(points));}return shapes;}});/**
   * @author TristanVALCKE / https://github.com/TristanVALCKE
   *
   *
   * From:
   * https://www.clicketyclick.dk/databases/xbase/format/db2_dbf.html#DBII_DBF_STRUCT
   * http://web.archive.org/web/20150323061445/http://ulisse.elettra.trieste.it/services/doc/dbase/DBFstruct.htm
   * http://www.dbase.com/Knowledgebase/INT/db7_file_fmt.htm
   *
   *////////////
  var DBFVersion=Object.freeze({FoxPro:0x30,FoxPro_Autoincrement:0x31,dBASE_II:0x02,FoxPro_Var:0x32,dBASE_III_plus:0x03,dBASE_III_plus_memo:0x83,dBASE_IV_SQL_table:0x43,dBASE_IV_SQL_system:0x63,dBASE_IV_memo:0x8B,dBASE_IV_memo_SQL_table:0xCB,FoxBase:0xFB,dBase_v_7:4,FoxPro_2_x:0xF5,HiPerSix_memo:0xE5});var DataType=Object.freeze({Binary:'B',Character:'C',Date:'D',Numeric:'N',Logical:'L',Memo:'M',Timestamp:'@',Long:'I',Autoincrement:'+',Float:'F',Double:'O',OLE:'G'});/**
   *
   * Loader
   *
   * @param manager
   * @param logger
   * @constructor
   */function DBFLoader(manager,logger){this.manager=manager===undefined?DefaultLoadingManager:manager;this.logger=logger===undefined?DefaultLogger:logger;this.reader=new BinaryReader$2();}Object.assign(DBFLoader,{Terminator:0x0D,DeletedRecord:0x1A,YearOffset:1900});Object.assign(DBFLoader.prototype,{load:function load(url,onLoad,onProgress,onError){var scope=this;var loader=new FileLoader(scope.manager);loader.setResponseType('arraybuffer');loader.load(url,function(arrayBuffer){onLoad(scope.parse(arrayBuffer));},onProgress,onError);},parse:function parse(arrayBuffer){this.reader.setEndianess(Endianness.Big).setBuffer(arrayBuffer);var version=this.reader.getInt8();if(!this._isValidVersion(version)){console.error('DBFLoader: Invalid version number: '+version);return null;}var header=this._parseHeader(version);var datas=this._parseDatas(version,header);return{header:header,datas:datas};},_isValidVersion:function _isValidVersion(version){var availablesVersionValues=Object.values(DBFVersion);return availablesVersionValues.includes(version);},_parseHeader:function _parseHeader(version){var header={};switch(version){case DBFVersion.FoxPro:case DBFVersion.FoxPro_Autoincrement:case DBFVersion.FoxPro_Var:case DBFVersion.dBASE_II:header=this._parseHeaderV2();break;case DBFVersion.dBASE_III_plus:case DBFVersion.dBASE_III_plus_memo://                header = this._parseHeaderV2_5()
  //                break;
  case DBFVersion.dBASE_IV_memo:case DBFVersion.dBASE_IV_memo_SQL_table:case DBFVersion.dBASE_IV_SQL_system:case DBFVersion.dBASE_IV_SQL_table:header=this._parseHeaderV3();break;case DBFVersion.dBase_v_7:case DBFVersion.FoxPro_2_x:case DBFVersion.HiPerSix_memo:header=this._parseHeaderV4();break;default:throw new RangeError('Invalid version parameter: '+version,'DBFLoader');break;}// Check terminator
  if(this.reader.getUInt8()!==DBFLoader.Terminator){console.error('DBFLoader: Invalid terminator after field descriptors !!!');}return header;},_parseHeaderV2:function _parseHeaderV2(){var numberOfRecords=this.reader.getInt16();var year=this.reader.getInt8()+DBFLoader.YearOffset;var month=this.reader.getInt8();var day=this.reader.getInt8();var lengthOfEachRecords=this.reader.getInt16();// Field descriptor array
  var fields=[];var name=undefined;var type=undefined;var length=undefined;var memoryAddress=undefined;var decimalCount=undefined;for(var fieldIndex=0;fieldIndex<numberOfRecords;fieldIndex++){name=this.reader.getString(11);type=this.reader.getChar();length=this.reader.getUInt8();memoryAddress=this.reader.getInt16();decimalCount=this.reader.getInt8();fields.push({name:name,type:type,length:length,memoryAddress:memoryAddress,decimalCount:decimalCount});}return{numberOfRecords:numberOfRecords,year:year,month:month,day:day,lengthOfEachRecords:lengthOfEachRecords,fields:fields};},_parseHeaderV2_5:function _parseHeaderV2_5(){var year=this.reader.getInt8()+DBFLoader.YearOffset;var month=this.reader.getInt8();var day=this.reader.getInt8();this.reader.setEndianess(Endianness.Little);var numberOfRecords=this.reader.getInt32();var numberOfByteInHeader=this.reader.getInt16();var numberOfByteInRecord=this.reader.getInt16();this.reader.setEndianess(Endianness.Big);this.reader.skipOffsetOf(3+13+4);// Reserved
  // Field descriptor array
  var fields=[];var name=undefined;var type=undefined;var length=undefined;var memoryAddress=undefined;var decimalCount=undefined;var workAreaId=undefined;var MDXFlag=undefined;for(var fieldIndex=0;fieldIndex<numberOfRecords;fieldIndex++){name=this.reader.getString(11);type=this.reader.getChar();memoryAddress=this.reader.getInt32();length=this.reader.getUInt8();decimalCount=this.reader.getUInt8();this.reader.skipOffsetOf(2);// Reserved
  workAreaId=this.reader.getInt8();this.reader.skipOffsetOf(2);// Reserved
  MDXFlag=this.reader.getInt8();this.reader.skipOffsetOf(1);// Reserved
  fields.push({name:name,type:type,length:length,memoryAddress:memoryAddress,decimalCount:decimalCount,workAreaId:workAreaId,MDXFlag:MDXFlag});}return{year:year,month:month,day:day,numberOfRecords:numberOfRecords,numberOfByteInHeader:numberOfByteInHeader,numberOfByteInRecord:numberOfByteInRecord,fields:fields};},_parseHeaderV3:function _parseHeaderV3(){var year=this.reader.getInt8()+DBFLoader.YearOffset;var month=this.reader.getInt8();var day=this.reader.getInt8();this.reader.setEndianess(Endianness.Little);var numberOfRecords=this.reader.getInt32();var numberOfByteInHeader=this.reader.getInt16();var numberOfByteInRecord=this.reader.getInt16();this.reader.setEndianess(Endianness.Big);this.reader.skipOffsetOf(2);// Reserved
  var incompleteTransactionFlag=this.reader.getInt8();var encryptionFlag=this.reader.getInt8();this.reader.skipOffsetOf(12);// Reserved multi-users
  var MDXFlag=this.reader.getInt8();var languageDriverId=this.reader.getInt8();this.reader.skipOffsetOf(2);// Reserved
  // Field descriptor array
  var fields=[];var name=undefined;var type=undefined;var length=undefined;var decimalCount=undefined;var workAreaId=undefined;var MDXFieldFlag=undefined;while(this.reader.getOffset()<numberOfByteInHeader-1){//                for ( let fieldIndex = 0 ; fieldIndex < numberOfRecords ; fieldIndex++ ) {
  name=this.reader.getString(11);type=this.reader.getChar();this.reader.skipOffsetOf(4);// Reserved
  length=this.reader.getUInt8();decimalCount=this.reader.getUInt8();this.reader.skipOffsetOf(2);// Reserved
  workAreaId=this.reader.getInt8();this.reader.skipOffsetOf(10);// Reserved
  MDXFieldFlag=this.reader.getInt8();fields.push({name:name,type:type,length:length,decimalCount:decimalCount,workAreaId:workAreaId,MDXFieldFlag:MDXFieldFlag});}return{year:year,month:month,day:day,numberOfRecords:numberOfRecords,numberOfByteInHeader:numberOfByteInHeader,numberOfByteInRecord:numberOfByteInRecord,incompleteTransactionFlag:incompleteTransactionFlag,encryptionFlag:encryptionFlag,MDXFlag:MDXFlag,languageDriverId:languageDriverId,fields:fields};},_parseHeaderV4:function _parseHeaderV4(){var year=this.reader.getInt8()+DBFLoader.YearOffset;var month=this.reader.getInt8();var day=this.reader.getInt8();this.reader.setEndianess(Endianness.Little);var numberOfRecords=this.reader.getInt32();var numberOfByteInHeader=this.reader.getInt16();var numberOfByteInRecord=this.reader.getInt16();this.reader.setEndianess(Endianness.Big);this.reader.skipOffsetOf(2);// Reserved
  var incompleteTransactionFlag=this.reader.getInt8();var encryptionFlag=this.reader.getInt8();this.reader.skipOffsetOf(12);// Reserved multi-users
  var MDXFlag=this.reader.getInt8();var languageDriverId=this.reader.getInt8();this.reader.skipOffsetOf(2);// Reserved
  var languageDriverName=this.reader.getString(32);this.reader.skipOffsetOf(4);// Reserved
  // Field descriptor array
  var fields=[];var name=undefined;var type=undefined;var length=undefined;var decimalCount=undefined;var MDXFieldFlag=undefined;var nextAutoincrementValue=undefined;for(var fieldIndex=0;fieldIndex<numberOfRecords;fieldIndex++){name=this.reader.getString(32);type=this.reader.getChar();length=this.reader.getUInt8();decimalCount=this.reader.getUInt8();this.reader.skipOffsetOf(2);// Reserved
  MDXFieldFlag=this.reader.getInt8();this.reader.skipOffsetOf(2);// Reserved
  nextAutoincrementValue=this.reader.getInt32();this.reader.skipOffsetOf(4);// Reserved
  fields.push({name:name,type:type,length:length,decimalCount:decimalCount,MDXFieldFlag:MDXFieldFlag,nextAutoincrementValue:nextAutoincrementValue});}return{year:year,month:month,day:day,numberOfRecords:numberOfRecords,numberOfByteInHeader:numberOfByteInHeader,numberOfByteInRecord:numberOfByteInRecord,incompleteTransactionFlag:incompleteTransactionFlag,encryptionFlag:encryptionFlag,MDXFlag:MDXFlag,languageDriverId:languageDriverId,languageDriverName:languageDriverName,fields:fields};},_parseDatas:function _parseDatas(version,header){var numberOfRecords=header.numberOfRecords;var fields=header.fields;var properties=undefined;if(version===DBFVersion.dBase_v_7){properties=this._parseFieldProperties();}var records=[];var record=undefined;var field=undefined;for(var recordIndex=0;recordIndex<numberOfRecords;recordIndex++){record={};record['deleted']=this.reader.getUInt8()===DBFLoader.DeletedRecord;for(var fieldIndex=0,numberOfFields=fields.length;fieldIndex<numberOfFields;fieldIndex++){field=fields[fieldIndex];switch(field.type){case DataType.Binary:var binaryString=this.reader.getString(field.length);record[field.name]=parseInt(binaryString);break;case DataType.Numeric:var numericString=this.reader.getString(field.length);record[field.name]=parseInt(numericString);break;case DataType.Character:record[field.name]=this.reader.getString(field.length);break;case DataType.Date:// YYYYMMDD
  record[field.name]=this.reader.getString(field.length);break;case DataType.Logical:var logical=this.reader.getChar().toLowerCase();if(logical==='t'||logical==='y'){record[field.name]=true;}else if(logical==='f'||logical==='n'){record[field.name]=false;}else{record[field.name]=null;}break;case DataType.Memo:record[field.name]=this.reader.getString(field.length);break;case DataType.Timestamp:// 8 bytes - two longs, first for date, second for time.
  // The date is the number of days since  01/01/4713 BC.
  // Time is hours * 3600000L + minutes * 60000L + Seconds * 1000L
  break;case DataType.Long:// 4 bytes. Leftmost bit used to indicate sign, 0 negative.
  record[field.name]=this.reader.getInt32();break;case DataType.Autoincrement:// Same as a Long
  record[field.name]=this.reader.getInt32();break;case DataType.Float:var floatString=this.reader.getString(field.length);record[field.name]=parseInt(floatString);break;case DataType.Double:record[field.name]=this.reader.getDouble();break;case DataType.OLE:record[field.name]=this.reader.getString(field.length);break;default:throw new RangeError('Invalid data type parameter: '+field.type,'_parseDatas');break;}}records.push(record);}return records;},_parseFieldProperties:function _parseFieldProperties(){var numberOfStandardProperties=this.reader.getInt16();var startOfStandardPropertiesDescriptor=this.reader.getInt16();var numberOfCustomProperties=this.reader.getInt16();var startOfCustomPropertiesDescriptor=this.reader.getInt16();var numberOfReferentialIntegrityProperties=this.reader.getInt16();var startOfReferentialIntegrityDescriptor=this.reader.getInt16();var startOfData=this.reader.getInt16();var sizeOfPropertiesStructure=this.reader.getInt16();var standardProperties=[];for(var standardIndex=0;standardIndex<numberOfStandardProperties;standardIndex++){standardProperties.push(this._getStandardProperties());}var customProperties=[];for(var customIndex=0;customIndex<numberOfCustomProperties;customIndex++){customProperties.push(this._getCustomProperties());}var referentialIntegrityProperties=[];for(var referentialIntegrityIndex=0;referentialIntegrityIndex<numberOfReferentialIntegrityProperties;referentialIntegrityIndex++){referentialIntegrityProperties.push(this._getReferentialIntegrityProperties());}return{numberOfStandardProperties:numberOfStandardProperties,startOfStandardPropertiesDescriptor:startOfStandardPropertiesDescriptor,numberOfCustomProperties:numberOfCustomProperties,startOfCustomPropertiesDescriptor:startOfCustomPropertiesDescriptor,numberOfReferentialIntegrityProperties:numberOfReferentialIntegrityProperties,startOfReferentialIntegrityDescriptor:startOfReferentialIntegrityDescriptor,startOfData:startOfData,sizeOfPropertiesStructure:sizeOfPropertiesStructure,standardProperties:standardProperties,customProperties:customProperties,referentialIntegrityProperties:referentialIntegrityProperties};},_getStandardProperties:function _getStandardProperties(){var generationalNumber=this.reader.getInt16();var tableFieldOffset=this.reader.getInt16();var propertyDescribed=this.reader.getInt8();var type=this.reader.getInt8();var isConstraint=this.reader.getInt8();this.reader.skipOffsetOf(4);// Reserved
  var offsetFromStart=this.reader.getInt16();var widthOfDatabaseField=this.reader.getInt16();return{generationalNumber:generationalNumber,tableFieldOffset:tableFieldOffset,propertyDescribed:propertyDescribed,type:type,isConstraint:isConstraint,offsetFromStart:offsetFromStart,widthOfDatabaseField:widthOfDatabaseField};},_getCustomProperties:function _getCustomProperties(){var generationalNumber=this.reader.getInt16();var tableFieldOffset=this.reader.getInt16();var type=this.reader.getInt8();this.reader.skipOffsetOf(1);// Reserved
  var offsetFromStartOfName=this.reader.getInt16();var lengthOfName=this.reader.getInt16();var offsetFromStartOfData=this.reader.getInt16();var lengthOfData=this.reader.getInt16();return{generationalNumber:generationalNumber,tableFieldOffset:tableFieldOffset,type:type,offsetFromStartOfName:offsetFromStartOfName,lengthOfName:lengthOfName,offsetFromStartOfData:offsetFromStartOfData,lengthOfData:lengthOfData};},_getReferentialIntegrityProperties:function _getReferentialIntegrityProperties(){var databaseState=this.reader.getInt8();var sequentialNumberRule=this.reader.getInt16();var offsetOfTheRIRuleName=this.reader.getInt16();var sizeOfTheRIRuleName=this.reader.getInt16();var offsetOfNameOfForeignTable=this.reader.getInt16();var sizeOfNameOfForeignTable=this.reader.getInt16();var stateBehaviour=this.reader.getInt8();var numberOfFieldsInLinkingKey=this.reader.getInt16();var offsetOfLocalTableTagName=this.reader.getInt16();var sizeOfTheLocalTableTagName=this.reader.getInt16();var offsetOfForeignTableTagName=this.reader.getInt16();var sizeOfTheForeignTableTagName=this.reader.getInt16();return{databaseState:databaseState,sequentialNumberRule:sequentialNumberRule,offsetOfTheRIRuleName:offsetOfTheRIRuleName,sizeOfTheRIRuleName:sizeOfTheRIRuleName,offsetOfNameOfForeignTable:offsetOfNameOfForeignTable,sizeOfNameOfForeignTable:sizeOfNameOfForeignTable,stateBehaviour:stateBehaviour,numberOfFieldsInLinkingKey:numberOfFieldsInLinkingKey,offsetOfLocalTableTagName:offsetOfLocalTableTagName,sizeOfTheLocalTableTagName:sizeOfTheLocalTableTagName,offsetOfForeignTableTagName:offsetOfForeignTableTagName,sizeOfTheForeignTableTagName:sizeOfTheForeignTableTagName};}});/**
   * @author [Tristan Valcke]{@link https://github.com/Itee}
   * @license [BSD-3-Clause]{@link https://opensource.org/licenses/BSD-3-Clause}
   *
   * @file Todo
   *
   * @example Todo
   *
   */function TLogger$1(){}Object.assign(TLogger$1.prototype,{log:function log(message){console.log(message);},warn:function warn(warning){console.warn(warning);},error:function error(_error){console.error(_error);}});var DefaultLogger$1=new TLogger$1();/**
   * @author [Tristan Valcke]{@link https://github.com/Itee}
   * @license [BSD-3-Clause]{@link https://opensource.org/licenses/BSD-3-Clause}
   *
   * @class TUniversalLoader
   * @classdesc The TUniversalLoader allow to automatically select correct THREE loader for given files. (based on https://github.com/jeromeetienne/threex.universalloader)
   * @example Todo...
   *
   *//* eslint-env browser */// Local loader
  function getFilePath(fileUrl){return fileUrl.substring(0,fileUrl.lastIndexOf('/'));}function getFileName(fileUrl){return fileUrl.substring(fileUrl.lastIndexOf('/')+1);}function getFileExtension(fileName){return fileName.slice((fileName.lastIndexOf(".")-1>>>0)+2);}function computeUrl(fileUrl){var filePath=getFilePath(fileUrl);var isBlob=fileUrl.indexOf('blob')>-1;return isBlob?filePath:fileUrl;}var FileFormat=Object.freeze({Asc:'asc',Dbf:'dbf',Fbx:'fbx',Mtl:'mtl',Json:'json',Obj:'obj',Shp:'shp',Stl:'stl',toString:function toString(){var formats=Object.values(this);var result='';for(var index=0,numberOfFormats=formats.length;index<numberOfFormats;index++){result+=formats[index];result+=index===numberOfFormats-1?', ':'.';}}});function TUniversalLoader(){var manager=arguments.length>0&&arguments[0]!==undefined?arguments[0]:DefaultLoadingManager;var logger=arguments.length>1&&arguments[1]!==undefined?arguments[1]:DefaultLogger$1;this.manager=manager;this.logger=logger;}Object.assign(TUniversalLoader.prototype,{load:function load(files,onLoad,onProgress,onError){if(!files){console.error("Unable to load null or undefined files !");return;}if(isObject(files)){this.loadSingleFile(files,onLoad,onProgress,onError);}else if(isFunction(files)){this.load(files(),onLoad,onProgress,onError);}else if(isArray$1(files)){// Todo: need to rework logic here and use wrapper object instead of array of object to avoid
  // Todo: array of 2 differents files.
  if(files.length===2&&isObject(files[0])&&isObject(files[1])){this.loadAssociatedFiles(files,onLoad,onProgress,onError);}else{for(var fileIndex=0,numberOfFiles=files.length;fileIndex<numberOfFiles;fileIndex++){this.load(files[fileIndex],onLoad,onProgress,onError);}}}else if(isString(files)){this.loadSingleFile({url:files},onLoad,onProgress,onError);}else{console.error('TUniversalLoader: Invalid files parameter !!!');}},loadSingleFile:function loadSingleFile(file,onLoad,onProgress,onError){var fileUrl=file.url;var fileName=getFileName(fileUrl);var fileExtension=getFileExtension(fileName);var loadUrl=computeUrl(fileUrl);file.url=loadUrl;switch(fileExtension){case FileFormat.Asc:this._loadAsc(file,onLoad,onProgress,onError);break;case FileFormat.Dbf:this._loadDbf(file,onLoad,onProgress,onError);break;case FileFormat.Fbx:this._loadFbx(file,onLoad,onProgress,onError);break;case FileFormat.Json:this._loadJson(file,onLoad,onProgress,onError);break;case FileFormat.Obj:this._loadObj(file,onLoad,onProgress,onError);break;case FileFormat.Shp:this._loadShp(file,onLoad,onProgress,onError);break;case FileFormat.Stl:this._loadStl(file,onLoad,onProgress,onError);break;default:throw new RangeError('Invalid file extension: '+fileExtension+'. Supported formats are: '+FileFormat.toString(),'TUniversalLoader');break;}},loadAssociatedFiles:function loadAssociatedFiles(files,onLoad,onProgress,onError){var firstFile=files[0];var firstUrl=firstFile.url;var firstFileName=getFileName(firstUrl);var firstFileExtension=getFileExtension(firstFileName);var firstLoadUrl=computeUrl(firstUrl);firstFile.url=firstLoadUrl;var secondFile=files[1];var secondUrl=secondFile.url;var secondFileName=getFileName(secondUrl);var secondFileExtension=getFileExtension(secondFileName);var secondLoadUrl=computeUrl(secondUrl);secondFile.url=secondLoadUrl;if(firstFileExtension===FileFormat.Mtl&&secondFileExtension===FileFormat.Obj){this._loadObjMtlCouple(secondFile,firstFile,onLoad,onProgress,onError);}else if(firstFileExtension===FileFormat.Obj&&secondFileExtension===FileFormat.Mtl){this._loadObjMtlCouple(firstFile,secondFile,onLoad,onProgress,onError);}else if(firstFileExtension===FileFormat.Shp&&secondFileExtension===FileFormat.Dbf){this._loadShpDbfCouple(firstFile,secondFile,onLoad,onProgress,onError);}else if(firstFileExtension===FileFormat.Dbf&&secondFileExtension===FileFormat.Shp){this._loadShpDbfCouple(secondFile,firstFile,onLoad,onProgress,onError);}else{this.loadSingleFile(files[0],onLoad,onProgress,onError);this.loadSingleFile(files[1],onLoad,onProgress,onError);}},_loadAsc:function _loadAsc(file,onLoad,onProgress,onError){var loader=new ASCLoader(this.manager);loader.load(file.url,onLoad,onProgress,onError);},_loadDbf:function _loadDbf(file,onLoad,onProgress,onError){var loader=new DBFLoader(this.manager);loader.load(file.url,onLoad,onProgress,onError);},_loadFbx:function _loadFbx(file,onLoad,onProgress,onError){var loader=new FBXLoader2(this.manager);loader.load(file.url,function(object){var position=file.position;if(position){object.position.set(position.x,position.y,position.z);}onLoad(object);},onProgress,onError);},_loadJson:function _loadJson(file,onLoad,onProgress,onError){var loader=new ObjectLoader(this.manager);loader.load(file.url,onLoad,onProgress,onError);},_loadObj:function _loadObj(file,onLoad,onProgress,onError){var loader=new OBJLoader(this.manager);loader.load(file.url,onLoad,onProgress,onError);},_loadShp:function _loadShp(file,onLoad,onProgress,onError){var loader=new SHPLoader(this.manager);loader.load(file.url,function(shapes){var group=new Group();for(var shapeIndex=0,numberOfShapes=shapes.length;shapeIndex<numberOfShapes;shapeIndex++){group.add(new Mesh(new ShapeBufferGeometry(shapes[shapeIndex]),new MeshPhongMaterial({color:Math.random()*0xffffff,side:DoubleSide})));}group.rotateX(-90*DEG_TO_RAD);onLoad(group);},onProgress,onError);},_loadStl:function _loadStl(file,onLoad,onProgress,onError){var loader=new STLLoader(this.manager);loader.load(file.url,function(geometry){var material=new MeshPhongMaterial();var object=new Mesh(geometry,material);var position=file.position;if(position){object.position.set(position.x,position.y,position.z);}onLoad(object);},onProgress,onError);},_loadObjMtlCouple:function _loadObjMtlCouple(objFile,mtlFile,onLoad,onProgress,onError){var mtlLoader=new MTLLoader(this.manager);var objLoader=new OBJLoader(this.manager);var texturePath=mtlFile.texturePath||'resources/models/evan/';if(texturePath){mtlLoader.setTexturePath(texturePath);}mtlLoader.load(mtlFile.url,function(materials){materials.preload();for(var materialIndex=0,numberOfMaterials=materials.materials.length;materialIndex<numberOfMaterials;materialIndex++){var material=materials.materials[materialIndex];material.opacity=1.0;materials.materials[materialIndex]=material;}objLoader.setMaterials(materials);objLoader.load(objFile.url,onLoad,onProgress,onError);},onProgress,onError);},_loadShpDbfCouple:function _loadShpDbfCouple(shpFile,dbfFile,onLoad,onProgress,onError){var _shapes=undefined;var _dbf=undefined;var shpLoader=new SHPLoader(this.manager);shpLoader.load(shpFile.url,function(shapes){_shapes=shapes;checkEnd();},onProgress,onError);var dbfLoader=new DBFLoader(this.manager);dbfLoader.load(dbfFile.url,function(dbf){_dbf=dbf;checkEnd();},onProgress,onError);function checkEnd(){if(!_shapes||!_dbf){return;}var group=new Group();group.name="Locaux";var mesh=undefined;for(var shapeIndex=0,numberOfShapes=_shapes.length;shapeIndex<numberOfShapes;shapeIndex++){mesh=new Mesh(new ShapeBufferGeometry(_shapes[shapeIndex]),new MeshPhongMaterial({color:Math.random()*0xffffff,side:DoubleSide}));mesh.name=_dbf.datas[shapeIndex]['CODE'];group.add(mesh);}group.rotateX(-90*DEG_TO_RAD);group.rotateZ(180*DEG_TO_RAD);group.position.z-=159.05;group.position.x-=0.79;onLoad(group);}}});var dockspawn={version:"0.0.2"};/**
   * A tab handle represents the tab button on the tab strip
   */dockspawn.TabHandle=function(parent){this.parent=parent;var undockHandler=dockspawn.TabHandle.prototype._performUndock.bind(this);this.elementBase=document.createElement('div');this.elementText=document.createElement('div');this.elementCloseButton=document.createElement('div');this.elementBase.classList.add("tab-handle");this.elementBase.classList.add("disable-selection");// Disable text selection
  this.elementText.classList.add("tab-handle-text");this.elementCloseButton.classList.add("tab-handle-close-button");this.elementBase.appendChild(this.elementText);if(this.parent.host.displayCloseButton){this.elementBase.appendChild(this.elementCloseButton);}this.parent.host.tabListElement.appendChild(this.elementBase);var panel=parent.container;var title=panel.getRawTitle();this.elementText.innerHTML=title;// Set the close button text (font awesome)
  var closeIcon="fa fa-times";this.elementCloseButton.innerHTML='<i class="'+closeIcon+'"></i>';this._bringToFront(this.elementBase);this.undockInitiator=new dockspawn.UndockInitiator(this.elementBase,undockHandler);this.undockInitiator.enabled=true;this.mouseClickHandler=new dockspawn.EventHandler(this.elementBase,'click',this.onMouseClicked.bind(this));// Button click handler for the tab handle
  this.closeButtonHandler=new dockspawn.EventHandler(this.elementCloseButton,'mousedown',this.onCloseButtonClicked.bind(this));// Button click handler for the close button
  this.zIndexCounter=1000;};dockspawn.TabHandle.prototype.updateTitle=function(){if(this.parent.container instanceof dockspawn.PanelContainer){var panel=this.parent.container;var title=panel.getRawTitle();this.elementText.innerHTML=title;}};dockspawn.TabHandle.prototype.destroy=function(){this.mouseClickHandler.cancel();this.closeButtonHandler.cancel();removeNode$1(this.elementBase);removeNode$1(this.elementCloseButton);delete this.elementBase;delete this.elementCloseButton;};dockspawn.TabHandle.prototype._performUndock=function(e,dragOffset){if(this.parent.container.containerType=="panel"){this.undockInitiator.enabled=false;var panel=this.parent.container;return panel.performUndockToDialog(e,dragOffset);}else{return null;}};dockspawn.TabHandle.prototype.onMouseClicked=function(){this.parent.onSelected();};dockspawn.TabHandle.prototype.onCloseButtonClicked=function(){// If the page contains a panel element, undock it and destroy it
  if(this.parent.container.containerType=="panel"){this.undockInitiator.enabled=false;var panel=this.parent.container;panel.performUndock();}};dockspawn.TabHandle.prototype.setSelected=function(selected){var selectedClassName="tab-handle-selected";if(selected){this.elementBase.classList.add(selectedClassName);}else{this.elementBase.classList.remove(selectedClassName);}};dockspawn.TabHandle.prototype.setZIndex=function(zIndex){this.elementBase.style.zIndex=zIndex;};dockspawn.TabHandle.prototype._bringToFront=function(element){element.style.zIndex=this.zIndexCounter;this.zIndexCounter++;};/**
   * Tab Host control contains tabs known as TabPages.
   * The tab strip can be aligned in different orientations
   */dockspawn.TabHost=function(tabStripDirection,displayCloseButton){/**
       * Create a tab host with the tab strip aligned in the [tabStripDirection] direciton
       * Only dockspawn.TabHost.DIRECTION_BOTTOM and dockspawn.TabHost.DIRECTION_TOP are supported
       */if(tabStripDirection===undefined){tabStripDirection=dockspawn.TabHost.DIRECTION_BOTTOM;}if(displayCloseButton===undefined){displayCloseButton=false;}this.tabStripDirection=tabStripDirection;this.displayCloseButton=displayCloseButton;// Indicates if the close button next to the tab handle should be displayed
  this.pages=[];this.hostElement=document.createElement('div');// The main tab host DOM element
  this.tabListElement=document.createElement('div');// Hosts the tab handles
  this.separatorElement=document.createElement('div');// A seperator line between the tabs and content
  this.contentElement=document.createElement('div');// Hosts the active tab content
  this.createTabPage=this._createDefaultTabPage;// Factory for creating tab pages
  if(this.tabStripDirection==dockspawn.TabHost.DIRECTION_BOTTOM){this.hostElement.appendChild(this.contentElement);this.hostElement.appendChild(this.separatorElement);this.hostElement.appendChild(this.tabListElement);}else if(this.tabStripDirection==dockspawn.TabHost.DIRECTION_TOP){this.hostElement.appendChild(this.tabListElement);this.hostElement.appendChild(this.separatorElement);this.hostElement.appendChild(this.contentElement);}else{throw new dockspawn.Exception("Only top and bottom tab strip orientations are supported");}this.hostElement.classList.add("tab-host");this.tabListElement.classList.add("tab-handle-list-container");this.separatorElement.classList.add("tab-handle-content-seperator");this.contentElement.classList.add("tab-content");};// constants
  dockspawn.TabHost.DIRECTION_TOP=0;dockspawn.TabHost.DIRECTION_BOTTOM=1;dockspawn.TabHost.DIRECTION_LEFT=2;dockspawn.TabHost.DIRECTION_RIGHT=3;dockspawn.TabHost.prototype._createDefaultTabPage=function(tabHost,container){return new dockspawn.TabPage(tabHost,container);};dockspawn.TabHost.prototype.setActiveTab=function(container){var self=this;this.pages.forEach(function(page){if(page.container===container){self.onTabPageSelected(page);return;}});};dockspawn.TabHost.prototype.resize=function(width,height){this.hostElement.style.width=width+"px";this.hostElement.style.height=height+"px";var tabHeight=this.tabListElement.clientHeight;var separatorHeight=this.separatorElement.clientHeight;var contentHeight=height-tabHeight-separatorHeight;this.contentElement.style.height=contentHeight+"px";if(this.activeTab){this.activeTab.resize(width,contentHeight);}};dockspawn.TabHost.prototype.performLayout=function(children){// Destroy all existing tab pages
  this.pages.forEach(function(tab){tab.destroy();});this.pages.length=0;var oldActiveTab=this.activeTab;delete this.activeTab;var childPanels=children.filter(function(child){return child.containerType=="panel";});if(childPanels.length>0){// Rebuild new tab pages
  var self=this;childPanels.forEach(function(child){var page=self.createTabPage(self,child);self.pages.push(page);// Restore the active selected tab
  if(oldActiveTab&&page.container===oldActiveTab.container){self.activeTab=page;}});this._setTabHandlesVisible(true);}else// Do not show an empty tab handle host with zero tabs
  {this._setTabHandlesVisible(false);}if(this.activeTab){this.onTabPageSelected(this.activeTab);}};dockspawn.TabHost.prototype._setTabHandlesVisible=function(visible){this.tabListElement.style.display=visible?"block":"none";this.separatorElement.style.display=visible?"block":"none";};dockspawn.TabHost.prototype.onTabPageSelected=function(page){this.activeTab=page;this.pages.forEach(function(tabPage){var selected=tabPage===page;tabPage.setSelected(selected);});// adjust the zIndex of the tabs to have proper shadow/depth effect
  var zIndexDelta=1;var zIndex=1000;this.pages.forEach(function(tabPage){tabPage.handle.setZIndex(zIndex);var selected=tabPage==page;if(selected){zIndexDelta=-1;}zIndex+=zIndexDelta;});// If a callback is defined, then notify it of this event
  //if (this.onTabChanged)
  //    this.onTabChanged(this, page);
  };dockspawn.TabPage=function(host,container){if(arguments.length==0){return;}this.selected=false;this.host=host;this.container=container;this.handle=new dockspawn.TabHandle(this);this.containerElement=container.containerElement;if(container instanceof dockspawn.PanelContainer){var panel=container;panel.onTitleChanged=this.onTitleChanged.bind(this);}};dockspawn.TabPage.prototype.onTitleChanged=function(sender,title){this.handle.updateTitle();};dockspawn.TabPage.prototype.destroy=function(){this.handle.destroy();if(this.container instanceof dockspawn.PanelContainer){var panel=this.container;delete panel.onTitleChanged;}};dockspawn.TabPage.prototype.onSelected=function(){this.host.onTabPageSelected(this);};dockspawn.TabPage.prototype.setSelected=function(flag){this.selected=flag;this.handle.setSelected(flag);if(this.selected){this.host.contentElement.appendChild(this.containerElement);// force a resize again
  var width=this.host.contentElement.clientWidth;var height=this.host.contentElement.clientHeight;this.container.resize(width,height);}else{removeNode$1(this.containerElement);}};dockspawn.TabPage.prototype.resize=function(width,height){this.container.resize(width,height);};dockspawn.Dialog=function(panel,dockManager){this.panel=panel;this.zIndexCounter=1000;this.dockManager=dockManager;this.eventListener=dockManager;this._initialize();};dockspawn.Dialog.fromElement=function(id,dockManager){return new dockspawn.Dialog(new dockspawn.PanelContainer(document.getElementById(id),dockManager),dockManager);};dockspawn.Dialog.prototype._initialize=function(){this.panel.floatingDialog=this;this.elementDialog=document.createElement('div');this.elementDialog.appendChild(this.panel.elementPanel);this.draggable=new dockspawn.DraggableContainer(this,this.panel,this.elementDialog,this.panel.elementTitle);this.resizable=new dockspawn.ResizableContainer(this,this.draggable,this.draggable.topLevelElement);document.body.appendChild(this.elementDialog);this.elementDialog.classList.add("dialog-floating");this.elementDialog.classList.add("rounded-corner-top");this.panel.elementTitle.classList.add("rounded-corner-top");this.mouseDownHandler=new dockspawn.EventHandler(this.elementDialog,'mousedown',this.onMouseDown.bind(this));this.resize(this.panel.elementPanel.clientWidth,this.panel.elementPanel.clientHeight);this.bringToFront();};dockspawn.Dialog.prototype.setPosition=function(x,y){this.elementDialog.style.left=x+"px";this.elementDialog.style.top=y+"px";};dockspawn.Dialog.prototype.onMouseDown=function(e){this.bringToFront();};dockspawn.Dialog.prototype.destroy=function(){if(this.mouseDownHandler){this.mouseDownHandler.cancel();delete this.mouseDownHandler;}this.elementDialog.classList.remove("rounded-corner-top");this.panel.elementTitle.classList.remove("rounded-corner-top");removeNode$1(this.elementDialog);this.draggable.removeDecorator();removeNode$1(this.panel.elementPanel);delete this.panel.floatingDialog;};dockspawn.Dialog.prototype.resize=function(width,height){this.resizable.resize(width,height);};dockspawn.Dialog.prototype.setTitle=function(title){this.panel.setTitle(title);};dockspawn.Dialog.prototype.setTitleIcon=function(iconName){this.panel.setTitleIcon(iconName);};dockspawn.Dialog.prototype.bringToFront=function(){this.elementDialog.style.zIndex=this.zIndexCounter++;};dockspawn.DraggableContainer=function(dialog,delegate,topLevelElement,dragHandle){this.dialog=dialog;this.delegate=delegate;this.containerElement=delegate.containerElement;this.dockManager=delegate.dockManager;this.topLevelElement=topLevelElement;this.containerType=delegate.containerType;this.mouseDownHandler=new dockspawn.EventHandler(dragHandle,'mousedown',this.onMouseDown.bind(this));this.topLevelElement.style.marginLeft=topLevelElement.offsetLeft+"px";this.topLevelElement.style.marginTop=topLevelElement.offsetTop+"px";this.minimumAllowedChildNodes=delegate.minimumAllowedChildNodes;};dockspawn.DraggableContainer.prototype.destroy=function(){this.removeDecorator();this.delegate.destroy();};dockspawn.DraggableContainer.prototype.saveState=function(state){this.delegate.saveState(state);};dockspawn.DraggableContainer.prototype.loadState=function(state){this.delegate.loadState(state);};dockspawn.DraggableContainer.prototype.setActiveChild=function(child){};Object.defineProperty(dockspawn.DraggableContainer.prototype,"width",{get:function get(){return this.delegate.width;}});Object.defineProperty(dockspawn.DraggableContainer.prototype,"height",{get:function get(){return this.delegate.height;}});dockspawn.DraggableContainer.prototype.name=function(value){if(value){this.delegate.name=value;}return this.delegate.name;};dockspawn.DraggableContainer.prototype.resize=function(width,height){this.delegate.resize(width,height);};dockspawn.DraggableContainer.prototype.performLayout=function(children){this.delegate.performLayout(children);};dockspawn.DraggableContainer.prototype.removeDecorator=function(){if(this.mouseDownHandler){this.mouseDownHandler.cancel();delete this.mouseDownHandler;}};dockspawn.DraggableContainer.prototype.onMouseDown=function(event){this._startDragging(event);this.previousMousePosition={x:event.pageX,y:event.pageY};if(this.mouseMoveHandler){this.mouseMoveHandler.cancel();delete this.mouseMoveHandler;}if(this.mouseUpHandler){this.mouseUpHandler.cancel();delete this.mouseUpHandler;}this.mouseMoveHandler=new dockspawn.EventHandler(window,'mousemove',this.onMouseMove.bind(this));this.mouseUpHandler=new dockspawn.EventHandler(window,'mouseup',this.onMouseUp.bind(this));};dockspawn.DraggableContainer.prototype.onMouseUp=function(event){this._stopDragging(event);this.mouseMoveHandler.cancel();delete this.mouseMoveHandler;this.mouseUpHandler.cancel();delete this.mouseUpHandler;};dockspawn.DraggableContainer.prototype._startDragging=function(event){if(this.dialog.eventListener){this.dialog.eventListener.onDialogDragStarted(this.dialog,event);}document.body.classList.add("disable-selection");};dockspawn.DraggableContainer.prototype._stopDragging=function(event){if(this.dialog.eventListener){this.dialog.eventListener.onDialogDragEnded(this.dialog,event);}document.body.classList.remove("disable-selection");};dockspawn.DraggableContainer.prototype.onMouseMove=function(event){var currentMousePosition=new Point(event.pageX,event.pageY);var dx=Math.floor(currentMousePosition.x-this.previousMousePosition.x);var dy=Math.floor(currentMousePosition.y-this.previousMousePosition.y);this._performDrag(dx,dy);this.previousMousePosition=currentMousePosition;};dockspawn.DraggableContainer.prototype._performDrag=function(dx,dy){var left=dx+getPixels(this.topLevelElement.style.marginLeft);var top=dy+getPixels(this.topLevelElement.style.marginTop);this.topLevelElement.style.marginLeft=left+"px";this.topLevelElement.style.marginTop=top+"px";};/**
   * Decorates a dock container with resizer handles around its base element
   * This enables the container to be resized from all directions
   */dockspawn.ResizableContainer=function(dialog,delegate,topLevelElement){this.dialog=dialog;this.delegate=delegate;this.containerElement=delegate.containerElement;this.dockManager=delegate.dockManager;this.topLevelElement=topLevelElement;this.containerType=delegate.containerType;this.topLevelElement.style.marginLeft=this.topLevelElement.offsetLeft+"px";this.topLevelElement.style.marginTop=this.topLevelElement.offsetTop+"px";this.minimumAllowedChildNodes=delegate.minimumAllowedChildNodes;this._buildResizeHandles();this.readyToProcessNextResize=true;};dockspawn.ResizableContainer.prototype.setActiveChild=function(child){};dockspawn.ResizableContainer.prototype._buildResizeHandles=function(){this.resizeHandles=[];//    this._buildResizeHandle(true, false, true, false); // Dont need the corner resizer near the close button
  this._buildResizeHandle(false,true,true,false);this._buildResizeHandle(true,false,false,true);this._buildResizeHandle(false,true,false,true);this._buildResizeHandle(true,false,false,false);this._buildResizeHandle(false,true,false,false);this._buildResizeHandle(false,false,true,false);this._buildResizeHandle(false,false,false,true);};dockspawn.ResizableContainer.prototype._buildResizeHandle=function(east,west,north,south){var handle=new ResizeHandle();handle.east=east;handle.west=west;handle.north=north;handle.south=south;// Create an invisible div for the handle
  handle.element=document.createElement('div');this.topLevelElement.appendChild(handle.element);// Build the class name for the handle
  var verticalClass="";var horizontalClass="";if(north){verticalClass="n";}if(south){verticalClass="s";}if(east){horizontalClass="e";}if(west){horizontalClass="w";}var cssClass="resize-handle-"+verticalClass+horizontalClass;if(verticalClass.length>0&&horizontalClass.length>0){handle.corner=true;}handle.element.classList.add(handle.corner?"resize-handle-corner":"resize-handle");handle.element.classList.add(cssClass);this.resizeHandles.push(handle);var self=this;handle.mouseDownHandler=new dockspawn.EventHandler(handle.element,'mousedown',function(e){self.onMouseDown(handle,e);});};dockspawn.ResizableContainer.prototype.saveState=function(state){this.delegate.saveState(state);};dockspawn.ResizableContainer.prototype.loadState=function(state){this.delegate.loadState(state);};Object.defineProperty(dockspawn.ResizableContainer.prototype,"width",{get:function get(){return this.delegate.width;}});Object.defineProperty(dockspawn.ResizableContainer.prototype,"height",{get:function get(){return this.delegate.height;}});dockspawn.ResizableContainer.prototype.name=function(value){if(value){this.delegate.name=value;}return this.delegate.name;};dockspawn.ResizableContainer.prototype.resize=function(width,height){this.delegate.resize(width,height);this._adjustResizeHandles(width,height);};dockspawn.ResizableContainer.prototype._adjustResizeHandles=function(width,height){var self=this;this.resizeHandles.forEach(function(handle){handle.adjustSize(self.topLevelElement,width,height);});};dockspawn.ResizableContainer.prototype.performLayout=function(children){this.delegate.performLayout(children);};dockspawn.ResizableContainer.prototype.destroy=function(){this.removeDecorator();this.delegate.destroy();};dockspawn.ResizableContainer.prototype.removeDecorator=function(){};dockspawn.ResizableContainer.prototype.onMouseMoved=function(handle,e){if(!this.readyToProcessNextResize){return;}this.readyToProcessNextResize=false;//    window.requestLayoutFrame(() {
  this.dockManager.suspendLayout();var currentMousePosition=new Point(e.pageX,e.pageY);var dx=Math.floor(currentMousePosition.x-this.previousMousePosition.x);var dy=Math.floor(currentMousePosition.y-this.previousMousePosition.y);this._performDrag(handle,dx,dy);this.previousMousePosition=currentMousePosition;this.readyToProcessNextResize=true;this.dockManager.resumeLayout();//    });
  };dockspawn.ResizableContainer.prototype.onMouseDown=function(handle,event){this.previousMousePosition=new Point(event.pageX,event.pageY);if(handle.mouseMoveHandler){handle.mouseMoveHandler.cancel();delete handle.mouseMoveHandler;}if(handle.mouseUpHandler){handle.mouseUpHandler.cancel();delete handle.mouseUpHandler;}// Create the mouse event handlers
  var self=this;handle.mouseMoveHandler=new dockspawn.EventHandler(window,'mousemove',function(e){self.onMouseMoved(handle,e);});handle.mouseUpHandler=new dockspawn.EventHandler(window,'mouseup',function(e){self.onMouseUp(handle,e);});document.body.classList.add("disable-selection");};dockspawn.ResizableContainer.prototype.onMouseUp=function(handle,event){handle.mouseMoveHandler.cancel();handle.mouseUpHandler.cancel();delete handle.mouseMoveHandler;delete handle.mouseUpHandler;document.body.classList.remove("disable-selection");};dockspawn.ResizableContainer.prototype._performDrag=function(handle,dx,dy){var bounds={};bounds.left=getPixels(this.topLevelElement.style.marginLeft);bounds.top=getPixels(this.topLevelElement.style.marginTop);bounds.width=this.topLevelElement.clientWidth;bounds.height=this.topLevelElement.clientHeight;if(handle.east){this._resizeEast(dx,bounds);}if(handle.west){this._resizeWest(dx,bounds);}if(handle.north){this._resizeNorth(dy,bounds);}if(handle.south){this._resizeSouth(dy,bounds);}};dockspawn.ResizableContainer.prototype._resizeWest=function(dx,bounds){this._resizeContainer(dx,0,-dx,0,bounds);};dockspawn.ResizableContainer.prototype._resizeEast=function(dx,bounds){this._resizeContainer(0,0,dx,0,bounds);};dockspawn.ResizableContainer.prototype._resizeNorth=function(dy,bounds){this._resizeContainer(0,dy,0,-dy,bounds);};dockspawn.ResizableContainer.prototype._resizeSouth=function(dy,bounds){this._resizeContainer(0,0,0,dy,bounds);};dockspawn.ResizableContainer.prototype._resizeContainer=function(leftDelta,topDelta,widthDelta,heightDelta,bounds){bounds.left+=leftDelta;bounds.top+=topDelta;bounds.width+=widthDelta;bounds.height+=heightDelta;var minWidth=50;// TODO: Move to external configuration
  var minHeight=50;// TODO: Move to external configuration
  bounds.width=Math.max(bounds.width,minWidth);bounds.height=Math.max(bounds.height,minHeight);this.topLevelElement.style.marginLeft=bounds.left+"px";this.topLevelElement.style.marginTop=bounds.top+"px";this.resize(bounds.width,bounds.height);};function ResizeHandle(){this.element=undefined;this.handleSize=6;// TODO: Get this from DOM
  this.cornerSize=12;// TODO: Get this from DOM
  this.east=false;this.west=false;this.north=false;this.south=false;this.corner=false;}ResizeHandle.prototype.adjustSize=function(container,clientWidth,clientHeight){if(this.corner){if(this.west){this.element.style.left="0px";}if(this.east){this.element.style.left=clientWidth-this.cornerSize+"px";}if(this.north){this.element.style.top="0px";}if(this.south){this.element.style.top=clientHeight-this.cornerSize+"px";}}else{if(this.west){this.element.style.left="0px";this.element.style.top=this.cornerSize+"px";}if(this.east){this.element.style.left=clientWidth-this.handleSize+"px";this.element.style.top=this.cornerSize+"px";}if(this.north){this.element.style.left=this.cornerSize+"px";this.element.style.top="0px";}if(this.south){this.element.style.left=this.cornerSize+"px";this.element.style.top=clientHeight-this.handleSize+"px";}if(this.west||this.east){this.element.style.height=clientHeight-this.cornerSize*2+"px";}else{this.element.style.width=clientWidth-this.cornerSize*2+"px";}}};dockspawn.Exception=function(message){this.message=message;};dockspawn.Exception.prototype.toString=function(){return this.message;};/**
   * Dock manager manages all the dock panels in a hierarchy, similar to visual studio.
   * It owns a Html Div element inside which all panels are docked
   * Initially the document manager takes up the central space and acts as the root node
   */dockspawn.DockManager=function(element){if(element===undefined){throw new dockspawn.Exception("Invalid Dock Manager element provided");}this.element=element;this.context=this.dockWheel=this.layoutEngine=this.mouseMoveHandler=undefined;this.layoutEventListeners=[];};dockspawn.DockManager.prototype.initialize=function(){this.context=new dockspawn.DockManagerContext(this);var documentNode=new dockspawn.DockNode(this.context.documentManagerView);this.context.model.rootNode=documentNode;this.context.model.documentManagerNode=documentNode;this.setRootNode(this.context.model.rootNode);// Resize the layout
  this.resize(this.element.clientWidth,this.element.clientHeight);this.dockWheel=new dockspawn.DockWheel(this);this.layoutEngine=new dockspawn.DockLayoutEngine(this);this.rebuildLayout(this.context.model.rootNode);};dockspawn.DockManager.prototype.rebuildLayout=function(node){var self=this;node.children.forEach(function(child){self.rebuildLayout(child);});node.performLayout();};dockspawn.DockManager.prototype.invalidate=function(){this.resize(this.element.clientWidth,this.element.clientHeight);};dockspawn.DockManager.prototype.resize=function(width,height){this.element.style.width=width+"px";this.element.style.height=height+"px";this.context.model.rootNode.container.resize(width,height);};/**
   * Reset the dock model . This happens when the state is loaded from json
   */dockspawn.DockManager.prototype.setModel=function(model){removeNode$1(this.context.documentManagerView.containerElement);this.context.model=model;this.setRootNode(model.rootNode);this.rebuildLayout(model.rootNode);this.invalidate();};dockspawn.DockManager.prototype.setRootNode=function(node){if(this.context.model.rootNode){}// detach it from the dock manager's base element
  //      context.model.rootNode.detachFromParent();
  // Attach the new node to the dock manager's base element and set as root node
  node.detachFromParent();this.context.model.rootNode=node;this.element.appendChild(node.container.containerElement);};dockspawn.DockManager.prototype.onDialogDragStarted=function(sender,e){this.dockWheel.activeNode=this._findNodeOnPoint(e.pageX,e.pageY);this.dockWheel.activeDialog=sender;this.dockWheel.showWheel();if(this.mouseMoveHandler){this.mouseMoveHandler.cancel();delete this.mouseMoveHandler;}this.mouseMoveHandler=new dockspawn.EventHandler(window,'mousemove',this.onMouseMoved.bind(this));};dockspawn.DockManager.prototype.onDialogDragEnded=function(sender,e){if(this.mouseMoveHandler){this.mouseMoveHandler.cancel();delete this.mouseMoveHandler;}this.dockWheel.onDialogDropped(sender);this.dockWheel.hideWheel();delete this.dockWheel.activeDialog;};dockspawn.DockManager.prototype.onMouseMoved=function(e){this.dockWheel.activeNode=this._findNodeOnPoint(e.clientX,e.clientY);};/**
   * Perform a DFS on the dock model's tree to find the
   * deepest level panel (i.e. the top-most non-overlapping panel)
   * that is under the mouse cursor
   * Retuns null if no node is found under this point
   */dockspawn.DockManager.prototype._findNodeOnPoint=function(x,y){var stack=[];stack.push(this.context.model.rootNode);var bestMatch;while(stack.length>0){var topNode=stack.pop();if(isPointInsideNode(x,y,topNode)){// This node contains the point.
  bestMatch=topNode;// Keep looking future down
  [].push.apply(stack,topNode.children);}}return bestMatch;};/** Dock the [dialog] to the left of the [referenceNode] node */dockspawn.DockManager.prototype.dockDialogLeft=function(referenceNode,dialog){return this._requestDockDialog(referenceNode,dialog,this.layoutEngine.dockLeft.bind(this.layoutEngine));};/** Dock the [dialog] to the right of the [referenceNode] node */dockspawn.DockManager.prototype.dockDialogRight=function(referenceNode,dialog){return this._requestDockDialog(referenceNode,dialog,this.layoutEngine.dockRight.bind(this.layoutEngine));};/** Dock the [dialog] above the [referenceNode] node */dockspawn.DockManager.prototype.dockDialogUp=function(referenceNode,dialog){return this._requestDockDialog(referenceNode,dialog,this.layoutEngine.dockUp.bind(this.layoutEngine));};/** Dock the [dialog] below the [referenceNode] node */dockspawn.DockManager.prototype.dockDialogDown=function(referenceNode,dialog){return this._requestDockDialog(referenceNode,dialog,this.layoutEngine.dockDown.bind(this.layoutEngine));};/** Dock the [dialog] as a tab inside the [referenceNode] node */dockspawn.DockManager.prototype.dockDialogFill=function(referenceNode,dialog){return this._requestDockDialog(referenceNode,dialog,this.layoutEngine.dockFill.bind(this.layoutEngine));};/** Dock the [container] to the left of the [referenceNode] node */dockspawn.DockManager.prototype.dockLeft=function(referenceNode,container,ratio){return this._requestDockContainer(referenceNode,container,this.layoutEngine.dockLeft.bind(this.layoutEngine),ratio);};/** Dock the [container] to the right of the [referenceNode] node */dockspawn.DockManager.prototype.dockRight=function(referenceNode,container,ratio){return this._requestDockContainer(referenceNode,container,this.layoutEngine.dockRight.bind(this.layoutEngine),ratio);};/** Dock the [container] above the [referenceNode] node */dockspawn.DockManager.prototype.dockUp=function(referenceNode,container,ratio){return this._requestDockContainer(referenceNode,container,this.layoutEngine.dockUp.bind(this.layoutEngine),ratio);};/** Dock the [container] below the [referenceNode] node */dockspawn.DockManager.prototype.dockDown=function(referenceNode,container,ratio){return this._requestDockContainer(referenceNode,container,this.layoutEngine.dockDown.bind(this.layoutEngine),ratio);};/** Dock the [container] as a tab inside the [referenceNode] node */dockspawn.DockManager.prototype.dockFill=function(referenceNode,container){return this._requestDockContainer(referenceNode,container,this.layoutEngine.dockFill.bind(this.layoutEngine));};dockspawn.DockManager.prototype._requestDockDialog=function(referenceNode,dialog,layoutDockFunction){// Get the active dialog that was dragged on to the dock wheel
  var panel=dialog.panel;var newNode=new dockspawn.DockNode(panel);panel.prepareForDocking();dialog.destroy();layoutDockFunction(referenceNode,newNode);this.invalidate();return newNode;};dockspawn.DockManager.prototype._requestDockContainer=function(referenceNode,container,layoutDockFunction,ratio){// Get the active dialog that was dragged on to the dock wheel
  var newNode=new dockspawn.DockNode(container);if(container.containerType=="panel"){var panel=container;panel.prepareForDocking();removeNode$1(panel.elementPanel);}layoutDockFunction(referenceNode,newNode);if(ratio&&newNode.parent&&(newNode.parent.container.containerType=="vertical"||newNode.parent.container.containerType=="horizontal")){var splitter=newNode.parent.container;splitter.setContainerRatio(container,ratio);}this.rebuildLayout(this.context.model.rootNode);this.invalidate();return newNode;};/**
   * Undocks a panel and converts it into a floating dialog window
   * It is assumed that only leaf nodes (panels) can be undocked
   */dockspawn.DockManager.prototype.requestUndockToDialog=function(container,event,dragOffset){var node=this._findNodeFromContainer(container);this.layoutEngine.undock(node);// Create a new dialog window for the undocked panel
  var dialog=new dockspawn.Dialog(node.container,this);// Adjust the relative position
  var dialogWidth=dialog.elementDialog.clientWidth;if(dragOffset.x>dialogWidth){dragOffset.x=0.75*dialogWidth;}dialog.setPosition(event.clientX-dragOffset.x,event.clientY-dragOffset.y);dialog.draggable.onMouseDown(event);return dialog;};/** Undocks a panel and converts it into a floating dialog window
   * It is assumed that only leaf nodes (panels) can be undocked
   */dockspawn.DockManager.prototype.requestUndock=function(container){var node=this._findNodeFromContainer(container);this.layoutEngine.undock(node);};/**
   * Removes a dock container from the dock layout hierarcy
   * Returns the node that was removed from the dock tree
   */dockspawn.DockManager.prototype.requestRemove=function(container){var node=this._findNodeFromContainer(container);var parent=node.parent;node.detachFromParent();if(parent){this.rebuildLayout(parent);}return node;};/** Finds the node that owns the specified [container] */dockspawn.DockManager.prototype._findNodeFromContainer=function(container){//this.context.model.rootNode.debug_DumpTree();
  var stack=[];stack.push(this.context.model.rootNode);while(stack.length>0){var topNode=stack.pop();if(topNode.container===container){return topNode;}[].push.apply(stack,topNode.children);}throw new dockspawn.Exception("Cannot find dock node belonging to the element");};dockspawn.DockManager.prototype.addLayoutListener=function(listener){this.layoutEventListeners.push(listener);};dockspawn.DockManager.prototype.removeLayoutListener=function(listener){this.layoutEventListeners.splice(this.layoutEventListeners.indexOf(listener),1);};dockspawn.DockManager.prototype.suspendLayout=function(){var self=this;this.layoutEventListeners.forEach(function(listener){if(listener.onSuspendLayout){listener.onSuspendLayout(self);}});};dockspawn.DockManager.prototype.resumeLayout=function(){var self=this;this.layoutEventListeners.forEach(function(listener){if(listener.onResumeLayout){listener.onResumeLayout(self);}});};dockspawn.DockManager.prototype.notifyOnDock=function(dockNode){var self=this;this.layoutEventListeners.forEach(function(listener){if(listener.onDock){listener.onDock(self,dockNode);}});};dockspawn.DockManager.prototype.notifyOnUnDock=function(dockNode){var self=this;this.layoutEventListeners.forEach(function(listener){if(listener.onUndock){listener.onUndock(self,dockNode);}});};dockspawn.DockManager.prototype.saveState=function(){var serializer=new dockspawn.DockGraphSerializer();return serializer.serialize(this.context.model);};dockspawn.DockManager.prototype.loadState=function(json){var deserializer=new dockspawn.DockGraphDeserializer(this);this.context.model=deserializer.deserialize(json);this.setModel(this.context.model);};//typedef void LayoutEngineDockFunction(dockspawn.DockNode referenceNode, dockspawn.DockNode newNode);
  /**
   * The Dock Manager notifies the listeners of layout changes so client containers that have
   * costly layout structures can detach and reattach themself to avoid reflow
   *///abstract class LayoutEventListener {
  //void onSuspendLayout(dockspawn.DockManager dockManager);
  //void onResumeLayout(dockspawn.DockManager dockManager);
  //}
  dockspawn.DockLayoutEngine=function(dockManager){this.dockManager=dockManager;};/** docks the [newNode] to the left of [referenceNode] */dockspawn.DockLayoutEngine.prototype.dockLeft=function(referenceNode,newNode){this._performDock(referenceNode,newNode,"horizontal",true);};/** docks the [newNode] to the right of [referenceNode] */dockspawn.DockLayoutEngine.prototype.dockRight=function(referenceNode,newNode){this._performDock(referenceNode,newNode,"horizontal",false);};/** docks the [newNode] to the top of [referenceNode] */dockspawn.DockLayoutEngine.prototype.dockUp=function(referenceNode,newNode){this._performDock(referenceNode,newNode,"vertical",true);};/** docks the [newNode] to the bottom of [referenceNode] */dockspawn.DockLayoutEngine.prototype.dockDown=function(referenceNode,newNode){this._performDock(referenceNode,newNode,"vertical",false);};/** docks the [newNode] by creating a new tab inside [referenceNode] */dockspawn.DockLayoutEngine.prototype.dockFill=function(referenceNode,newNode){this._performDock(referenceNode,newNode,"fill",false);};dockspawn.DockLayoutEngine.prototype.undock=function(node){var parentNode=node.parent;if(!parentNode){throw new dockspawn.Exception("Cannot undock.  panel is not a leaf node");}// Get the position of the node relative to it's siblings
  var siblingIndex=parentNode.children.indexOf(node);// Detach the node from the dock manager's tree hierarchy
  node.detachFromParent();// Fix the node's parent hierarchy
  if(parentNode.children.length<parentNode.container.minimumAllowedChildNodes){// If the child count falls below the minimum threshold, destroy the parent and merge
  // the children with their grandparents
  var grandParent=parentNode.parent;for(var i=0;i<parentNode.children.length;i++){var otherChild=parentNode.children[i];if(grandParent){// parent node is not a root node
  grandParent.addChildAfter(parentNode,otherChild);parentNode.detachFromParent();parentNode.container.destroy();grandParent.performLayout();}else{// Parent is a root node.
  // Make the other child the root node
  parentNode.detachFromParent();parentNode.container.destroy();this.dockManager.setRootNode(otherChild);}}}else{// the node to be removed has 2 or more other siblings. So it is safe to continue
  // using the parent composite container.
  parentNode.performLayout();// Set the next sibling as the active child (e.g. for a Tab host, it would select it as the active tab)
  if(parentNode.children.length>0){var nextActiveSibling=parentNode.children[Math.max(0,siblingIndex-1)];parentNode.container.setActiveChild(nextActiveSibling.container);}}this.dockManager.invalidate();this.dockManager.notifyOnUnDock(node);};dockspawn.DockLayoutEngine.prototype._performDock=function(referenceNode,newNode,direction,insertBeforeReference){if(referenceNode.parent&&referenceNode.parent.container.containerType=="fill"){referenceNode=referenceNode.parent;}if(direction=="fill"&&referenceNode.container.containerType=="fill"){referenceNode.addChild(newNode);referenceNode.performLayout();referenceNode.container.setActiveChild(newNode.container);return;}// Check if reference node is root node
  var model=this.dockManager.context.model;if(referenceNode===model.rootNode){var compositeContainer=this._createDockContainer(direction,newNode,referenceNode);var compositeNode=new dockspawn.DockNode(compositeContainer);if(insertBeforeReference){compositeNode.addChild(newNode);compositeNode.addChild(referenceNode);}else{compositeNode.addChild(referenceNode);compositeNode.addChild(newNode);}// Attach the root node to the dock manager's DOM
  this.dockManager.setRootNode(compositeNode);this.dockManager.rebuildLayout(this.dockManager.context.model.rootNode);compositeNode.container.setActiveChild(newNode.container);return;}if(referenceNode.parent.container.containerType!=direction){var referenceParent=referenceNode.parent;// Get the dimensions of the reference node, for resizing later on
  var referenceNodeWidth=referenceNode.container.containerElement.clientWidth;var referenceNodeHeight=referenceNode.container.containerElement.clientHeight;// Get the dimensions of the reference node, for resizing later on
  var referenceNodeParentWidth=referenceParent.container.containerElement.clientWidth;var referenceNodeParentHeight=referenceParent.container.containerElement.clientHeight;// Replace the reference node with a new composite node with the reference and new node as it's children
  var compositeContainer=this._createDockContainer(direction,newNode,referenceNode);var compositeNode=new dockspawn.DockNode(compositeContainer);referenceParent.addChildAfter(referenceNode,compositeNode);referenceNode.detachFromParent();removeNode$1(referenceNode.container.containerElement);if(insertBeforeReference){compositeNode.addChild(newNode);compositeNode.addChild(referenceNode);}else{compositeNode.addChild(referenceNode);compositeNode.addChild(newNode);}referenceParent.performLayout();compositeNode.performLayout();compositeNode.container.setActiveChild(newNode.container);compositeNode.container.resize(referenceNodeWidth,referenceNodeHeight);referenceParent.container.resize(referenceNodeParentWidth,referenceNodeParentHeight);}else{// Add as a sibling, since the parent of the reference node is of the right composite type
  var referenceParent=referenceNode.parent;if(insertBeforeReference){referenceParent.addChildBefore(referenceNode,newNode);}else{referenceParent.addChildAfter(referenceNode,newNode);}referenceParent.performLayout();referenceParent.container.setActiveChild(newNode.container);}// force resize the panel
  var containerWidth=newNode.container.containerElement.clientWidth;var containerHeight=newNode.container.containerElement.clientHeight;newNode.container.resize(containerWidth,containerHeight);this.dockManager.notifyOnDock(newNode);};dockspawn.DockLayoutEngine.prototype._forceResizeCompositeContainer=function(container){var width=container.containerElement.clientWidth;var height=container.containerElement.clientHeight;container.resize(width,height);};dockspawn.DockLayoutEngine.prototype._createDockContainer=function(containerType,newNode,referenceNode){if(containerType=="horizontal"){return new dockspawn.HorizontalDockContainer(this.dockManager,[newNode.container,referenceNode.container]);}if(containerType=="vertical"){return new dockspawn.VerticalDockContainer(this.dockManager,[newNode.container,referenceNode.container]);}if(containerType=="fill"){return new dockspawn.FillDockContainer(this.dockManager);}throw new dockspawn.Exception("Failed to create dock container of type: "+containerType);};/**
   * Gets the bounds of the new node if it were to dock with the specified configuration
   * The state is not modified in this function.  It is used for showing a preview of where
   * the panel would be docked when hovered over a dock wheel button
   */dockspawn.DockLayoutEngine.prototype.getDockBounds=function(referenceNode,containerToDock,direction,insertBeforeReference){var compositeNode;// The node that contains the splitter / fill node
  var childCount;var childPosition;if(direction=="fill"){// Since this is a fill operation, the highlight bounds is the same as the reference node
  // TODO: Create a tab handle highlight to show that it's going to be docked in a tab
  var targetElement=referenceNode.container.containerElement;var bounds=new Rectangle();bounds.x=targetElement.offsetLeft;bounds.y=targetElement.offsetTop;bounds.width=targetElement.clientWidth;bounds.height=targetElement.clientHeight;return bounds;}if(referenceNode.parent&&referenceNode.parent.container.containerType=="fill")// Ignore the fill container's child and move one level up
  {referenceNode=referenceNode.parent;}// Flag to indicate of the renference node was replaced with a new composite node with 2 children
  var hierarchyModified=false;if(referenceNode.parent&&referenceNode.parent.container.containerType==direction){// The parent already is of the desired composite type.  Will be inserted as sibling to the reference node
  compositeNode=referenceNode.parent;childCount=compositeNode.children.length;childPosition=compositeNode.children.indexOf(referenceNode)+(insertBeforeReference?0:1);}else{// The reference node will be replaced with a new composite node of the desired type with 2 children
  compositeNode=referenceNode;childCount=1;// The newly inserted composite node will contain the reference node
  childPosition=insertBeforeReference?0:1;hierarchyModified=true;}var splitBarSize=5;// TODO: Get from DOM
  var targetPanelSize=0;var targetPanelStart=0;if(direction=="vertical"||direction=="horizontal"){// Existing size of the composite container (without the splitter bars).
  // This will also be the final size of the composite (splitter / fill)
  // container after the new panel has been docked
  var compositeSize=this._getVaringDimension(compositeNode.container,direction)-(childCount-1)*splitBarSize;// size of the newly added panel
  var newPanelOriginalSize=this._getVaringDimension(containerToDock,direction);var scaleMultiplier=compositeSize/(compositeSize+newPanelOriginalSize);// Size of the panel after it has been docked and scaled
  targetPanelSize=newPanelOriginalSize*scaleMultiplier;if(hierarchyModified){targetPanelStart=insertBeforeReference?0:compositeSize*scaleMultiplier;}else{for(var i=0;i<childPosition;i++){targetPanelStart+=this._getVaringDimension(compositeNode.children[i].container,direction);}targetPanelStart*=scaleMultiplier;}}var bounds=new Rectangle();if(direction=="vertical"){bounds.x=compositeNode.container.containerElement.offsetLeft;bounds.y=compositeNode.container.containerElement.offsetTop+targetPanelStart;bounds.width=compositeNode.container.width;bounds.height=targetPanelSize;}else if(direction=="horizontal"){bounds.x=compositeNode.container.containerElement.offsetLeft+targetPanelStart;bounds.y=compositeNode.container.containerElement.offsetTop;bounds.width=targetPanelSize;bounds.height=compositeNode.container.height;}return bounds;};dockspawn.DockLayoutEngine.prototype._getVaringDimension=function(container,direction){if(direction=="vertical"){return container.height;}if(direction=="horizontal"){return container.width;}return 0;};dockspawn.DockManagerContext=function(dockManager){this.dockManager=dockManager;this.model=new dockspawn.DockModel();this.documentManagerView=new dockspawn.DocumentManagerContainer(this.dockManager);};/**
   * The Dock Model contains the tree hierarchy that represents the state of the
   * panel placement within the dock manager.
   */dockspawn.DockModel=function(){this.rootNode=this.documentManagerNode=undefined;};dockspawn.DockNode=function(container){/** The dock container represented by this node */this.container=container;this.children=[];};dockspawn.DockNode.prototype.detachFromParent=function(){if(this.parent){this.parent.removeChild(this);delete this.parent;}};dockspawn.DockNode.prototype.removeChild=function(childNode){var index=this.children.indexOf(childNode);if(index>=0){this.children.splice(index,1);}};dockspawn.DockNode.prototype.addChild=function(childNode){childNode.detachFromParent();childNode.parent=this;this.children.push(childNode);};dockspawn.DockNode.prototype.addChildBefore=function(referenceNode,childNode){this._addChildWithDirection(referenceNode,childNode,true);};dockspawn.DockNode.prototype.addChildAfter=function(referenceNode,childNode){this._addChildWithDirection(referenceNode,childNode,false);};dockspawn.DockNode.prototype._addChildWithDirection=function(referenceNode,childNode,before){// Detach this node from it's parent first
  childNode.detachFromParent();childNode.parent=this;var referenceIndex=this.children.indexOf(referenceNode);var preList=this.children.slice(0,referenceIndex);var postList=this.children.slice(referenceIndex+1,this.children.length);this.children=preList.slice(0);if(before){this.children.push(childNode);this.children.push(referenceNode);}else{this.children.push(referenceNode);this.children.push(childNode);}Array.prototype.push.apply(this.children,postList);};dockspawn.DockNode.prototype.performLayout=function(){var childContainers=this.children.map(function(childNode){return childNode.container;});this.container.performLayout(childContainers);};dockspawn.DockNode.prototype.debug_DumpTree=function(indent){if(indent===undefined){indent=0;}var message=this.container.name;for(var i=0;i<indent;i++){message="\t"+message;}var parentType=this.parent===undefined?"null":this.parent.container.containerType;console.log(">>"+message+" ["+parentType+"]");this.children.forEach(function(childNode){childNode.debug_DumpTree(indent+1);});};/**
   * Manages the dock overlay buttons that are displayed over the dock manager
   */dockspawn.DockWheel=function(dockManager){this.dockManager=dockManager;this.elementMainWheel=document.createElement("div");// Contains the main wheel's 5 dock buttons
  this.elementSideWheel=document.createElement("div");// Contains the 4 buttons on the side
  this.wheelItems={};var wheelTypes=["left","right","top","down","fill",// Main dock wheel buttons
  "left-s","right-s","top-s","down-s"// Buttons on the extreme 4 sides
  ];var self=this;wheelTypes.forEach(function(wheelType){self.wheelItems[wheelType]=new DockWheelItem(self,wheelType);if(wheelType.substr(-2,2)=="-s")// Side button
  {self.elementSideWheel.appendChild(self.wheelItems[wheelType].element);}else// Main dock wheel button
  {self.elementMainWheel.appendChild(self.wheelItems[wheelType].element);}});var zIndex=100000;this.elementMainWheel.classList.add("dock-wheel-base");this.elementSideWheel.classList.add("dock-wheel-base");this.elementMainWheel.style.zIndex=zIndex+1;this.elementSideWheel.style.zIndex=zIndex;this.elementPanelPreview=document.createElement("div");// Used for showing the preview of where the panel would be docked
  this.elementPanelPreview.classList.add("dock-wheel-panel-preview");this.elementPanelPreview.style.zIndex=zIndex-1;this.activeDialog=undefined;// The dialog being dragged, when the wheel is visible
  this._activeNode=undefined;this._visible=false;};/** The node over which the dock wheel is being displayed on */Object.defineProperty(dockspawn.DockWheel.prototype,"activeNode",{get:function get(){return this._activeNode;},set:function set(value){var previousValue=this._activeNode;this._activeNode=value;if(previousValue!==this._activeNode){// The active node has been changed.
  // Reattach the wheel to the new node's element and show it again
  if(this._visible){this.showWheel();}}}});dockspawn.DockWheel.prototype.showWheel=function(){this._visible=true;if(!this.activeNode){// No active node selected. make sure the wheel is invisible
  removeNode$1(this.elementMainWheel);removeNode$1(this.elementSideWheel);return;}var element=this.activeNode.container.containerElement;var containerWidth=element.clientWidth;var containerHeight=element.clientHeight;var baseX=Math.floor(containerWidth/2)+element.offsetLeft;var baseY=Math.floor(containerHeight/2)+element.offsetTop;this.elementMainWheel.style.left=baseX+"px";this.elementMainWheel.style.top=baseY+"px";// The positioning of the main dock wheel buttons is done automatically through CSS
  // Dynamically calculate the positions of the buttons on the extreme sides of the dock manager
  var sideMargin=20;var dockManagerWidth=this.dockManager.element.clientWidth;var dockManagerHeight=this.dockManager.element.clientHeight;var dockManagerOffsetX=this.dockManager.element.offsetLeft;var dockManagerOffsetY=this.dockManager.element.offsetTop;removeNode$1(this.elementMainWheel);removeNode$1(this.elementSideWheel);element.appendChild(this.elementMainWheel);this.dockManager.element.appendChild(this.elementSideWheel);this._setWheelButtonPosition("left-s",sideMargin,-dockManagerHeight/2);this._setWheelButtonPosition("right-s",dockManagerWidth-sideMargin*2,-dockManagerHeight/2);this._setWheelButtonPosition("top-s",dockManagerWidth/2,-dockManagerHeight+sideMargin);this._setWheelButtonPosition("down-s",dockManagerWidth/2,-sideMargin);};dockspawn.DockWheel.prototype._setWheelButtonPosition=function(wheelId,left,top){var item=this.wheelItems[wheelId];var itemHalfWidth=item.element.clientWidth/2;var itemHalfHeight=item.element.clientHeight/2;var x=Math.floor(left-itemHalfWidth);var y=Math.floor(top-itemHalfHeight);//    item.element.style.left = "${x}px";
  //    item.element.style.top = "${y}px";
  item.element.style.marginLeft=x+"px";item.element.style.marginTop=y+"px";};dockspawn.DockWheel.prototype.hideWheel=function(){this._visible=false;this.activeNode=undefined;removeNode$1(this.elementMainWheel);removeNode$1(this.elementSideWheel);removeNode$1(this.elementPanelPreview);// deactivate all wheels
  for(var wheelType in this.wheelItems){this.wheelItems[wheelType].active=false;}};dockspawn.DockWheel.prototype.onMouseOver=function(wheelItem,e){if(!this.activeDialog){return;}// Display the preview panel to show where the panel would be docked
  var rootNode=this.dockManager.context.model.rootNode;var bounds;if(wheelItem.id=="top"){bounds=this.dockManager.layoutEngine.getDockBounds(this.activeNode,this.activeDialog.panel,"vertical",true);}else if(wheelItem.id=="down"){bounds=this.dockManager.layoutEngine.getDockBounds(this.activeNode,this.activeDialog.panel,"vertical",false);}else if(wheelItem.id=="left"){bounds=this.dockManager.layoutEngine.getDockBounds(this.activeNode,this.activeDialog.panel,"horizontal",true);}else if(wheelItem.id=="right"){bounds=this.dockManager.layoutEngine.getDockBounds(this.activeNode,this.activeDialog.panel,"horizontal",false);}else if(wheelItem.id=="fill"){bounds=this.dockManager.layoutEngine.getDockBounds(this.activeNode,this.activeDialog.panel,"fill",false);}else if(wheelItem.id=="top-s"){bounds=this.dockManager.layoutEngine.getDockBounds(rootNode,this.activeDialog.panel,"vertical",true);}else if(wheelItem.id=="down-s"){bounds=this.dockManager.layoutEngine.getDockBounds(rootNode,this.activeDialog.panel,"vertical",false);}else if(wheelItem.id=="left-s"){bounds=this.dockManager.layoutEngine.getDockBounds(rootNode,this.activeDialog.panel,"horizontal",true);}else if(wheelItem.id=="right-s"){bounds=this.dockManager.layoutEngine.getDockBounds(rootNode,this.activeDialog.panel,"horizontal",false);}if(bounds){this.dockManager.element.appendChild(this.elementPanelPreview);this.elementPanelPreview.style.left=Math.round(bounds.x)+"px";this.elementPanelPreview.style.top=Math.round(bounds.y)+"px";this.elementPanelPreview.style.width=Math.round(bounds.width)+"px";this.elementPanelPreview.style.height=Math.round(bounds.height)+"px";}};dockspawn.DockWheel.prototype.onMouseOut=function(wheelItem,e){removeNode$1(this.elementPanelPreview);};/**
   * Called if the dialog is dropped in a dock panel.
   * The dialog might not necessarily be dropped in one of the dock wheel buttons,
   * in which case the request will be ignored
   */dockspawn.DockWheel.prototype.onDialogDropped=function(dialog){// Check if the dialog was dropped in one of the wheel items
  var wheelItem=this._getActiveWheelItem();if(wheelItem){this._handleDockRequest(wheelItem,dialog);}};/**
   * Returns the wheel item which has the mouse cursor on top of it
   */dockspawn.DockWheel.prototype._getActiveWheelItem=function(){for(var wheelType in this.wheelItems){var wheelItem=this.wheelItems[wheelType];if(wheelItem.active){return wheelItem;}}return undefined;};dockspawn.DockWheel.prototype._handleDockRequest=function(wheelItem,dialog){if(!this.activeNode){return;}if(wheelItem.id=="left"){this.dockManager.dockDialogLeft(this.activeNode,dialog);}else if(wheelItem.id=="right"){this.dockManager.dockDialogRight(this.activeNode,dialog);}else if(wheelItem.id=="top"){this.dockManager.dockDialogUp(this.activeNode,dialog);}else if(wheelItem.id=="down"){this.dockManager.dockDialogDown(this.activeNode,dialog);}else if(wheelItem.id=="fill"){this.dockManager.dockDialogFill(this.activeNode,dialog);}else if(wheelItem.id=="left-s"){this.dockManager.dockDialogLeft(this.dockManager.context.model.rootNode,dialog);}else if(wheelItem.id=="right-s"){this.dockManager.dockDialogRight(this.dockManager.context.model.rootNode,dialog);}else if(wheelItem.id=="top-s"){this.dockManager.dockDialogUp(this.dockManager.context.model.rootNode,dialog);}else if(wheelItem.id=="down-s"){this.dockManager.dockDialogDown(this.dockManager.context.model.rootNode,dialog);}};function DockWheelItem(wheel,id){this.wheel=wheel;this.id=id;var wheelType=id.replace("-s","");this.element=document.createElement("div");this.element.classList.add("dock-wheel-item");this.element.classList.add("disable-selection");this.element.classList.add("dock-wheel-"+wheelType);this.element.classList.add("dock-wheel-"+wheelType+"-icon");this.hoverIconClass="dock-wheel-"+wheelType+"-icon-hover";this.mouseOverHandler=new dockspawn.EventHandler(this.element,'mouseover',this.onMouseMoved.bind(this));this.mouseOutHandler=new dockspawn.EventHandler(this.element,'mouseout',this.onMouseOut.bind(this));this.active=false;// Becomes active when the mouse is hovered over it
  }DockWheelItem.prototype.onMouseMoved=function(e){this.active=true;this.element.classList.add(this.hoverIconClass);this.wheel.onMouseOver(this,e);};DockWheelItem.prototype.onMouseOut=function(e){this.active=false;this.element.classList.remove(this.hoverIconClass);this.wheel.onMouseOut(this,e);};dockspawn.FillDockContainer=function(dockManager,tabStripDirection){if(arguments.length==0){return;}if(tabStripDirection===undefined){tabStripDirection=dockspawn.TabHost.DIRECTION_BOTTOM;}this.dockManager=dockManager;this.tabOrientation=tabStripDirection;this.name=getNextId("fill_");this.element=document.createElement("div");this.containerElement=this.element;this.containerType="fill";this.minimumAllowedChildNodes=2;this.element.classList.add("dock-container");this.element.classList.add("dock-container-fill");this.tabHost=new dockspawn.TabHost(this.tabOrientation);this.element.appendChild(this.tabHost.hostElement);};dockspawn.FillDockContainer.prototype.setActiveChild=function(child){this.tabHost.setActiveTab(child);};dockspawn.FillDockContainer.prototype.resize=function(width,height){this.element.style.width=width+"px";this.element.style.height=height+"px";this.tabHost.resize(width,height);};dockspawn.FillDockContainer.prototype.performLayout=function(children){this.tabHost.performLayout(children);};dockspawn.FillDockContainer.prototype.destroy=function(){if(removeNode$1(this.element)){delete this.element;}};dockspawn.FillDockContainer.prototype.saveState=function(state){state.width=this.width;state.height=this.height;};dockspawn.FillDockContainer.prototype.loadState=function(state){this.width=state.width;this.height=state.height;};Object.defineProperty(dockspawn.FillDockContainer.prototype,"width",{get:function get(){return this.element.clientWidth;},set:function set(value){this.element.style.width=value+"px";}});Object.defineProperty(dockspawn.FillDockContainer.prototype,"height",{get:function get(){return this.element.clientHeight;},set:function set(value){this.element.style.height=value+"px";}});/**
   * The document manager is then central area of the dock layout hierarchy.
   * This is where more important panels are placed (e.g. the text editor in an IDE,
   * 3D view in a modelling package etc
   */dockspawn.DocumentManagerContainer=function(dockManager){dockspawn.FillDockContainer.call(this,dockManager,dockspawn.TabHost.DIRECTION_TOP);this.minimumAllowedChildNodes=0;this.element.classList.add("document-manager");this.tabHost.createTabPage=this._createDocumentTabPage;this.tabHost.displayCloseButton=true;};dockspawn.DocumentManagerContainer.prototype=new dockspawn.FillDockContainer();dockspawn.DocumentManagerContainer.prototype.constructor=dockspawn.DocumentManagerContainer;dockspawn.DocumentManagerContainer.prototype._createDocumentTabPage=function(tabHost,container){return new dockspawn.DocumentTabPage(tabHost,container);};dockspawn.DocumentManagerContainer.prototype.saveState=function(state){dockspawn.FillDockContainer.prototype.saveState.call(this,state);state.documentManager=true;};/** Returns the selected document tab */dockspawn.DocumentManagerContainer.prototype.selectedTab=function(){return this.tabHost.activeTab;};/**
   * Specialized tab page that doesn't display the panel's frame when docked in a tab page
   */dockspawn.DocumentTabPage=function(host,container){dockspawn.TabPage.call(this,host,container);// If the container is a panel, extract the content element and set it as the tab's content
  if(this.container.containerType=="panel"){this.panel=container;this.containerElement=this.panel.elementContent;// detach the container element from the panel's frame.
  // It will be reattached when this tab page is destroyed
  // This enables the panel's frame (title bar etc) to be hidden
  // inside the tab page
  removeNode$1(this.containerElement);}};dockspawn.DocumentTabPage.prototype=new dockspawn.TabPage();dockspawn.DocumentTabPage.prototype.constructor=dockspawn.DocumentTabPage;dockspawn.DocumentTabPage.prototype.destroy=function(){dockspawn.TabPage.prototype.destroy.call(this);// Restore the panel content element back into the panel frame
  removeNode$1(this.containerElement);this.panel.elementContentHost.appendChild(this.containerElement);};/**
   * A splitter panel manages the child containers inside it with splitter bars.
   * It can be stacked horizontally or vertically
   */dockspawn.SplitterPanel=function(childContainers,stackedVertical){this.childContainers=childContainers;this.stackedVertical=stackedVertical;this.panelElement=document.createElement('div');this.spiltterBars=[];this._buildSplitterDOM();};dockspawn.SplitterPanel.prototype._buildSplitterDOM=function(){if(this.childContainers.length<=1){throw new dockspawn.Exception("Splitter panel should contain atleast 2 panels");}this.spiltterBars=[];for(var i=0;i<this.childContainers.length-1;i++){var previousContainer=this.childContainers[i];var nextContainer=this.childContainers[i+1];var splitterBar=new dockspawn.SplitterBar(previousContainer,nextContainer,this.stackedVertical);this.spiltterBars.push(splitterBar);// Add the container and split bar to the panel's base div element
  this._insertContainerIntoPanel(previousContainer);this.panelElement.appendChild(splitterBar.barElement);}this._insertContainerIntoPanel(this.childContainers.slice(-1)[0]);};dockspawn.SplitterPanel.prototype.performLayout=function(children){this.removeFromDOM();// rebuild
  this.childContainers=children;this._buildSplitterDOM();};dockspawn.SplitterPanel.prototype.removeFromDOM=function(){this.childContainers.forEach(function(container){if(container.containerElement){container.containerElement.classList.remove("splitter-container-vertical");container.containerElement.classList.remove("splitter-container-horizontal");removeNode$1(container.containerElement);}});this.spiltterBars.forEach(function(bar){removeNode$1(bar.barElement);});};dockspawn.SplitterPanel.prototype.destroy=function(){this.removeFromDOM();this.panelElement.parentNode.removeChild(this.panelElement);};dockspawn.SplitterPanel.prototype._insertContainerIntoPanel=function(container){if(!container){console.log('undefined');}removeNode$1(container.containerElement);this.panelElement.appendChild(container.containerElement);container.containerElement.classList.add(this.stackedVertical?"splitter-container-vertical":"splitter-container-horizontal");};/**
   * Sets the percentage of space the specified [container] takes in the split panel
   * The percentage is specified in [ratio] and is between 0..1
   */dockspawn.SplitterPanel.prototype.setContainerRatio=function(container,ratio){var splitPanelSize=this.stackedVertical?this.panelElement.clientHeight:this.panelElement.clientWidth;var newContainerSize=splitPanelSize*ratio;var barSize=this.stackedVertical?this.spiltterBars[0].barElement.clientHeight:this.spiltterBars[0].barElement.clientWidth;var otherPanelSizeQuota=splitPanelSize-newContainerSize-barSize*this.spiltterBars.length;var otherPanelScaleMultipler=otherPanelSizeQuota/splitPanelSize;for(var i=0;i<this.childContainers.length;i++){var child=this.childContainers[i];var size;if(child!==container){size=this.stackedVertical?child.containerElement.clientHeight:child.containerElement.clientWidth;size*=otherPanelScaleMultipler;}else{size=newContainerSize;}if(this.stackedVertical){child.resize(child.width,Math.floor(size));}else{child.resize(Math.floor(size),child.height);}}};dockspawn.SplitterPanel.prototype.resize=function(width,height){if(this.childContainers.length<=1){return;}// Adjust the fixed dimension that is common to all (i.e. width, if stacked vertical; height, if stacked horizontally)
  for(var i=0;i<this.childContainers.length;i++){var childContainer=this.childContainers[i];if(this.stackedVertical){childContainer.resize(width,childContainer.height);}else{childContainer.resize(childContainer.width,height);}if(i<this.spiltterBars.length){var splitBar=this.spiltterBars[i];if(this.stackedVertical){splitBar.barElement.style.width=width+"px";}else{splitBar.barElement.style.height=height+"px";}}}// Adjust the varying dimension
  var totalChildPanelSize=0;// Find out how much space existing child containers take up (excluding the splitter bars)
  var self=this;this.childContainers.forEach(function(container){var size=self.stackedVertical?container.height:container.width;totalChildPanelSize+=size;});// Get the thickness of the bar
  var barSize=this.stackedVertical?this.spiltterBars[0].barElement.clientHeight:this.spiltterBars[0].barElement.clientWidth;// Find out how much space existing child containers will take after being resized (excluding the splitter bars)
  var targetTotalChildPanelSize=this.stackedVertical?height:width;targetTotalChildPanelSize-=barSize*this.spiltterBars.length;// Get the scale multiplier
  totalChildPanelSize=Math.max(totalChildPanelSize,1);var scaleMultiplier=targetTotalChildPanelSize/totalChildPanelSize;// Update the size with this multiplier
  var updatedTotalChildPanelSize=0;for(var i=0;i<this.childContainers.length;i++){var child=this.childContainers[i];var original=this.stackedVertical?child.containerElement.clientHeight:child.containerElement.clientWidth;var newSize=Math.floor(original*scaleMultiplier);updatedTotalChildPanelSize+=newSize;// If this is the last node, add any extra pixels to fix the rounding off errors and match the requested size
  if(i==this.childContainers.length-1){newSize+=targetTotalChildPanelSize-updatedTotalChildPanelSize;}// Set the size of the panel
  if(this.stackedVertical){child.resize(child.width,newSize);}else{child.resize(newSize,child.height);}}this.panelElement.style.width=width+"px";this.panelElement.style.height=height+"px";};dockspawn.SplitterDockContainer=function(name,dockManager,childContainers){// for prototype inheritance purposes only
  if(arguments.length==0){return;}this.name=name;this.dockManager=dockManager;this.splitterPanel=new dockspawn.SplitterPanel(childContainers,this.stackedVertical);this.containerElement=this.splitterPanel.panelElement;this.minimumAllowedChildNodes=2;};dockspawn.SplitterDockContainer.prototype.resize=function(width,height){//    if (_cachedWidth == _cachedWidth && _cachedHeight == _height) {
  //      // No need to resize
  //      return;
  //    }
  this.splitterPanel.resize(width,height);this._cachedWidth=width;this._cachedHeight=height;};dockspawn.SplitterDockContainer.prototype.performLayout=function(childContainers){this.splitterPanel.performLayout(childContainers);};dockspawn.SplitterDockContainer.prototype.setActiveChild=function(child){};dockspawn.SplitterDockContainer.prototype.destroy=function(){this.splitterPanel.destroy();};/**
   * Sets the percentage of space the specified [container] takes in the split panel
   * The percentage is specified in [ratio] and is between 0..1
   */dockspawn.SplitterDockContainer.prototype.setContainerRatio=function(container,ratio){this.splitterPanel.setContainerRatio(container,ratio);this.resize(this.width,this.height);};dockspawn.SplitterDockContainer.prototype.saveState=function(state){state.width=this.width;state.height=this.height;};dockspawn.SplitterDockContainer.prototype.loadState=function(state){this.resize(state.width,state.height);};Object.defineProperty(dockspawn.SplitterDockContainer.prototype,"width",{get:function get(){if(this._cachedWidth===undefined){this._cachedWidth=this.splitterPanel.panelElement.clientWidth;}return this._cachedWidth;}});Object.defineProperty(dockspawn.SplitterDockContainer.prototype,"height",{get:function get(){if(this._cachedHeight===undefined){this._cachedHeight=this.splitterPanel.panelElement.clientHeight;}return this._cachedHeight;}});dockspawn.HorizontalDockContainer=function(dockManager,childContainers){this.stackedVertical=false;dockspawn.SplitterDockContainer.call(this,getNextId("horizontal_splitter_"),dockManager,childContainers);this.containerType="horizontal";};dockspawn.HorizontalDockContainer.prototype=new dockspawn.SplitterDockContainer();dockspawn.HorizontalDockContainer.prototype.constructor=dockspawn.HorizontalDockContainer;/**
   * This dock container wraps the specified element on a panel frame with a title bar and close button
   */dockspawn.PanelContainer=function(elementContent,dockManager,title){if(!title){title="Panel";}this.elementContent=elementContent;this.dockManager=dockManager;this.title=title;this.containerType="panel";this.iconName="fa fa-arrow-circle-right";this.minimumAllowedChildNodes=0;this._floatingDialog=undefined;this._initialize();};Object.defineProperty(dockspawn.PanelContainer.prototype,"floatingDialog",{get:function get(){return this._floatingDialog;},set:function set(value){this._floatingDialog=value;var canUndock=this._floatingDialog===undefined;this.undockInitiator.enabled=canUndock;}});dockspawn.PanelContainer.loadFromState=function(state,dockManager){var elementName=state.element;var elementContent=document.getElementById(elementName);var ret=new dockspawn.PanelContainer(elementContent,dockManager);ret.elementContent=elementContent;ret._initialize();ret.loadState(state);return ret;};dockspawn.PanelContainer.prototype.saveState=function(state){state.element=this.elementContent.id;state.width=this.width;state.height=this.height;};dockspawn.PanelContainer.prototype.loadState=function(state){this.width=state.width;this.height=state.height;this.resize(this.width,this.height);};dockspawn.PanelContainer.prototype.setActiveChild=function(child){};Object.defineProperty(dockspawn.PanelContainer.prototype,"containerElement",{get:function get(){return this.elementPanel;}});dockspawn.PanelContainer.prototype._initialize=function(){this.name=getNextId("panel_");this.elementPanel=document.createElement('div');this.elementTitle=document.createElement('div');this.elementTitleText=document.createElement('div');this.elementContentHost=document.createElement('div');this.elementButtonClose=document.createElement('div');this.elementPanel.appendChild(this.elementTitle);this.elementTitle.appendChild(this.elementTitleText);this.elementTitle.appendChild(this.elementButtonClose);this.elementButtonClose.innerHTML='<i class="fa fa-times"></i>';this.elementButtonClose.classList.add("panel-titlebar-button-close");this.elementPanel.appendChild(this.elementContentHost);this.elementPanel.classList.add("panel-base");this.elementTitle.classList.add("panel-titlebar");this.elementTitle.classList.add("disable-selection");this.elementTitleText.classList.add("panel-titlebar-text");this.elementContentHost.classList.add("panel-content");// set the size of the dialog elements based on the panel's size
  var panelWidth=this.elementContent.clientWidth;var panelHeight=this.elementContent.clientHeight;var titleHeight=this.elementTitle.clientHeight;this._setPanelDimensions(panelWidth,panelHeight+titleHeight);// Add the panel to the body
  document.body.appendChild(this.elementPanel);this.closeButtonClickedHandler=new dockspawn.EventHandler(this.elementButtonClose,'click',this.onCloseButtonClicked.bind(this));removeNode$1(this.elementContent);this.elementContentHost.appendChild(this.elementContent);// Extract the title from the content element's attribute
  var contentTitle=this.elementContent.getAttribute('caption');var contentIcon=this.elementContent.getAttribute('icon');if(contentTitle!=null){this.title=contentTitle;}if(contentIcon!=null){this.iconName=contentIcon;}this._updateTitle();this.undockInitiator=new dockspawn.UndockInitiator(this.elementTitle,this.performUndockToDialog.bind(this));delete this.floatingDialog;};dockspawn.PanelContainer.prototype.destroy=function(){removeNode$1(this.elementPanel);if(this.closeButtonClickedHandler){this.closeButtonClickedHandler.cancel();delete this.closeButtonClickedHandler;}};/**
   * Undocks the panel and and converts it to a dialog box
   */dockspawn.PanelContainer.prototype.performUndockToDialog=function(e,dragOffset){this.undockInitiator.enabled=false;return this.dockManager.requestUndockToDialog(this,e,dragOffset);};/**
   * Undocks the container and from the layout hierarchy
   * The container would be removed from the DOM
   */dockspawn.PanelContainer.prototype.performUndock=function(){this.undockInitiator.enabled=false;this.dockManager.requestUndock(this);};dockspawn.PanelContainer.prototype.prepareForDocking=function(){this.undockInitiator.enabled=true;};Object.defineProperty(dockspawn.PanelContainer.prototype,"width",{get:function get(){return this._cachedWidth;},set:function set(value){if(value!==this._cachedWidth){this._cachedWidth=value;this.elementPanel.style.width=value+"px";}}});Object.defineProperty(dockspawn.PanelContainer.prototype,"height",{get:function get(){return this._cachedHeight;},set:function set(value){if(value!==this._cachedHeight){this._cachedHeight=value;this.elementPanel.style.height=value+"px";}}});dockspawn.PanelContainer.prototype.resize=function(width,height){if(this._cachedWidth==width&&this._cachedHeight==height){// Already in the desired size
  return;}this._setPanelDimensions(width,height);this._cachedWidth=width;this._cachedHeight=height;};dockspawn.PanelContainer.prototype._setPanelDimensions=function(width,height){this.elementTitle.style.width=width+"px";this.elementContentHost.style.width=width+"px";this.elementContent.style.width=width+"px";this.elementPanel.style.width=width+"px";var titleBarHeight=this.elementTitle.clientHeight;var contentHeight=height-titleBarHeight;this.elementContentHost.style.height=contentHeight+"px";this.elementContent.style.height=contentHeight+"px";this.elementPanel.style.height=height+"px";};dockspawn.PanelContainer.prototype.setTitle=function(title){this.title=title;this._updateTitle();if(this.onTitleChanged){this.onTitleChanged(this,title);}};dockspawn.PanelContainer.prototype.setTitleIcon=function(iconName){this.iconName=iconName;this._updateTitle();};dockspawn.PanelContainer.prototype._updateTitle=function(){this.elementTitleText.innerHTML='<i class="'+this.iconName+'"></i> '+this.title;};dockspawn.PanelContainer.prototype.getRawTitle=function(){return this.elementTitleText.innerHTML;};dockspawn.PanelContainer.prototype.performLayout=function(children){};dockspawn.PanelContainer.prototype.onCloseButtonClicked=function(e){if(this.floatingDialog){this.floatingDialog.destroy();}else{this.performUndock();this.destroy();}};dockspawn.VerticalDockContainer=function(dockManager,childContainers){this.stackedVertical=true;dockspawn.SplitterDockContainer.call(this,getNextId("vertical_splitter_"),dockManager,childContainers);this.containerType="vertical";};dockspawn.VerticalDockContainer.prototype=new dockspawn.SplitterDockContainer();dockspawn.VerticalDockContainer.prototype.constructor=dockspawn.VerticalDockContainer;dockspawn.SplitterBar=function(previousContainer,nextContainer,stackedVertical){this.previousContainer=previousContainer;// The panel to the left/top side of the bar, depending on the bar orientation
  this.nextContainer=nextContainer;// The panel to the right/bottom side of the bar, depending on the bar orientation
  this.stackedVertical=stackedVertical;this.barElement=document.createElement('div');this.barElement.classList.add(stackedVertical?"splitbar-horizontal":"splitbar-vertical");this.mouseDownHandler=new dockspawn.EventHandler(this.barElement,'mousedown',this.onMouseDown.bind(this));this.minPanelSize=50;// TODO: Get from container configuration
  this.readyToProcessNextDrag=true;};dockspawn.SplitterBar.prototype.onMouseDown=function(e){this._startDragging(e);};dockspawn.SplitterBar.prototype.onMouseUp=function(e){this._stopDragging(e);};dockspawn.SplitterBar.prototype.onMouseMoved=function(e){if(!this.readyToProcessNextDrag){return;}this.readyToProcessNextDrag=false;var dockManager=this.previousContainer.dockManager;dockManager.suspendLayout();var dx=e.pageX-this.previousMouseEvent.pageX;var dy=e.pageY-this.previousMouseEvent.pageY;this._performDrag(dx,dy);this.previousMouseEvent=e;this.readyToProcessNextDrag=true;dockManager.resumeLayout();};dockspawn.SplitterBar.prototype._performDrag=function(dx,dy){var previousWidth=this.previousContainer.containerElement.clientWidth;var previousHeight=this.previousContainer.containerElement.clientHeight;var nextWidth=this.nextContainer.containerElement.clientWidth;var nextHeight=this.nextContainer.containerElement.clientHeight;var previousPanelSize=this.stackedVertical?previousHeight:previousWidth;var nextPanelSize=this.stackedVertical?nextHeight:nextWidth;var deltaMovement=this.stackedVertical?dy:dx;var newPreviousPanelSize=previousPanelSize+deltaMovement;var newNextPanelSize=nextPanelSize-deltaMovement;if(newPreviousPanelSize<this.minPanelSize||newNextPanelSize<this.minPanelSize){// One of the panels is smaller than it should be.
  // In that case, check if the small panel's size is being increased
  var continueProcessing=newPreviousPanelSize<this.minPanelSize&&newPreviousPanelSize>previousPanelSize||newNextPanelSize<this.minPanelSize&&newNextPanelSize>nextPanelSize;if(!continueProcessing){return;}}if(this.stackedVertical){this.previousContainer.resize(previousWidth,newPreviousPanelSize);this.nextContainer.resize(nextWidth,newNextPanelSize);}else{this.previousContainer.resize(newPreviousPanelSize,previousHeight);this.nextContainer.resize(newNextPanelSize,nextHeight);}};dockspawn.SplitterBar.prototype._startDragging=function(e){disableGlobalTextSelection();if(this.mouseMovedHandler){this.mouseMovedHandler.cancel();delete this.mouseMovedHandler;}if(this.mouseUpHandler){this.mouseUpHandler.cancel();delete this.mouseUpHandler;}this.mouseMovedHandler=new dockspawn.EventHandler(window,'mousemove',this.onMouseMoved.bind(this));this.mouseUpHandler=new dockspawn.EventHandler(window,'mouseup',this.onMouseUp.bind(this));this.previousMouseEvent=e;};dockspawn.SplitterBar.prototype._stopDragging=function(e){enableGlobalTextSelection();document.body.classList.remove("disable-selection");if(this.mouseMovedHandler){this.mouseMovedHandler.cancel();delete this.mouseMovedHandler;}if(this.mouseUpHandler){this.mouseUpHandler.cancel();delete this.mouseUpHandler;}};/**
   * Deserializes the dock layout hierarchy from JSON and creates a dock hierarhcy graph
   */dockspawn.DockGraphDeserializer=function(dockManager){this.dockManager=dockManager;};dockspawn.DockGraphDeserializer.prototype.deserialize=function(json){var graphInfo=JSON.parse(_json);var model=new dockspawn.DockModel();model.rootNode=this._buildGraph(graphInfo);return model;};dockspawn.DockGraphDeserializer.prototype._buildGraph=function(nodeInfo){var childrenInfo=nodeInfo.children;var children=[];var self=this;childrenInfo.forEach(function(childInfo){var childNode=self._buildGraph(childInfo);children.push(childNode);});// Build the container owned by this node
  var container=this._createContainer(nodeInfo,children);// Build the node for this container and attach it's children
  var node=new dockspawn.DockNode(container);node.children=children;node.children.forEach(function(childNode){childNode.parent=node;});return node;};dockspawn.DockGraphDeserializer.prototype._createContainer=function(nodeInfo,children){var containerType=nodeInfo.containerType;var containerState=nodeInfo.state;var container;var childContainers=[];children.forEach(function(childNode){childContainers.push(childNode.container);});childContainers=[];if(containerType=="panel"){container=new dockspawn.PanelContainer.loadFromState(containerState,this.dockManager);}else if(containerType=="horizontal"){container=new dockspawn.HorizontalDockContainer(this.dockManager,childContainers);}else if(containerType=="vertical"){container=new dockspawn.VerticalDockContainer(this.dockManager,childContainers);}else if(containerType=="fill"){// Check if this is a document manager
  // TODO: Layout engine compares the string "fill", so cannot create another subclass type
  // called document_manager and have to resort to this hack. use RTTI in layout engine
  var typeDocumentManager=containerState.documentManager;if(typeDocumentManager){container=new DocumentManagerContainer(this.dockManager);}else{container=new dockspawn.FillDockContainer(this.dockManager);}}else{throw new dockspawn.Exception("Cannot create dock container of unknown type: "+containerType);}// Restore the state of the container
  container.loadState(containerState);container.performLayout(childContainers);return container;};/**
   * The serializer saves / loads the state of the dock layout hierarchy
   */dockspawn.DockGraphSerializer=function(){};dockspawn.DockGraphSerializer.prototype.serialize=function(model){var graphInfo=this._buildGraphInfo(model.rootNode);return JSON.stringify(graphInfo);};dockspawn.DockGraphSerializer.prototype._buildGraphInfo=function(node){var nodeState={};node.container.saveState(nodeState);var childrenInfo=[];var self=this;node.childNodes.forEach(function(childNode){childrenInfo.push(self._buildGraphInfo(childNode));});var nodeInfo={};nodeInfo.containerType=node.container.containerType;nodeInfo.state=nodeState;nodeInfo.children=childrenInfo;return nodeInfo;};function getPixels(pixels){if(pixels==null){return 0;}return parseInt(pixels.replace("px",""));}function disableGlobalTextSelection(){document.body.classList.add("disable-selection");}function enableGlobalTextSelection(){document.body.classList.remove("disable-selection");}function isPointInsideNode(px,py,node){var element=node.container.containerElement;var x=element.offsetLeft;var y=element.offsetTop;var width=element.clientWidth;var height=element.clientHeight;return px>=x&&px<=x+width&&py>=y&&py<=y+height;}function Rectangle(){//    num x;
  //    num y;
  //    num width;
  //    num height;
  }function getNextId(prefix){return prefix+getNextId.counter++;}getNextId.counter=0;function removeNode$1(node){if(node.parentNode==null){return false;}node.parentNode.removeChild(node);return true;}function Point(x,y){this.x=x;this.y=y;}dockspawn.EventHandler=function(source,eventName,target){// wrap the target
  this.target=target;this.eventName=eventName;this.source=source;this.source.addEventListener(eventName,this.target);};dockspawn.EventHandler.prototype.cancel=function(){this.source.removeEventListener(this.eventName,this.target);};/**
   * Listens for events on the [element] and notifies the [listener]
   * if an undock event has been invoked.  An undock event is invoked
   * when the user clicks on the event and drags is beyond the
   * specified [thresholdPixels]
   */dockspawn.UndockInitiator=function(element,listener,thresholdPixels){if(!thresholdPixels){thresholdPixels=10;}this.element=element;this.listener=listener;this.thresholdPixels=thresholdPixels;this._enabled=false;};Object.defineProperty(dockspawn.UndockInitiator.prototype,"enabled",{get:function get(){return this._enabled;},set:function set(value){this._enabled=value;if(this._enabled){if(this.mouseDownHandler){this.mouseDownHandler.cancel();delete this.mouseDownHandler;}this.mouseDownHandler=new dockspawn.EventHandler(this.element,'mousedown',this.onMouseDown.bind(this));}else{if(this.mouseDownHandler){this.mouseDownHandler.cancel();delete this.mouseDownHandler;}if(this.mouseUpHandler){this.mouseUpHandler.cancel();delete this.mouseUpHandler;}if(this.mouseMoveHandler){this.mouseMoveHandler.cancel();delete this.mouseMoveHandler;}}}});dockspawn.UndockInitiator.prototype.onMouseDown=function(e){// Make sure we dont do this on floating dialogs
  if(this.enabled){if(this.mouseUpHandler){this.mouseUpHandler.cancel();delete this.mouseUpHandler;}if(this.mouseMoveHandler){this.mouseMoveHandler.cancel();delete this.mouseMoveHandler;}this.mouseUpHandler=new dockspawn.EventHandler(window,'mouseup',this.onMouseUp.bind(this));this.mouseMoveHandler=new dockspawn.EventHandler(window,'mousemove',this.onMouseMove.bind(this));this.dragStartPosition=new Point(e.pageX,e.pageY);}};dockspawn.UndockInitiator.prototype.onMouseUp=function(e){if(this.mouseUpHandler){this.mouseUpHandler.cancel();delete this.mouseUpHandler;}if(this.mouseMoveHandler){this.mouseMoveHandler.cancel();delete this.mouseMoveHandler;}};dockspawn.UndockInitiator.prototype.onMouseMove=function(e){var position=new Point(e.pageX,e.pageY);var dx=position.x-this.dragStartPosition.x;var dy=position.y-this.dragStartPosition.y;var distance=Math.sqrt(dx*dx+dy*dy);if(distance>this.thresholdPixels){this.enabled=false;this._requestUndock(e);}};dockspawn.UndockInitiator.prototype._requestUndock=function(e){var dragOffsetX=this.dragStartPosition.x-this.element.offsetLeft;var dragOffsetY=this.dragStartPosition.y-this.element.offsetTop;var dragOffset=new Point(dragOffsetX,dragOffsetY);this.listener(e,dragOffset);};var commonjsGlobal=typeof window!=='undefined'?window:typeof global!=='undefined'?global:typeof self!=='undefined'?self:{};function createCommonjsModule(fn,module){return module={exports:{}}, fn(module,module.exports), module.exports;}var stats_min=createCommonjsModule(function(module,exports){// stats.js - http://github.com/mrdoob/stats.js
  (function(f,e){module.exports=e();})(commonjsGlobal,function(){var f=function f(){function e(a){c.appendChild(a.dom);return a;}function u(a){for(var d=0;d<c.children.length;d++){c.children[d].style.display=d===a?"block":"none";}l=a;}var l=0,c=document.createElement("div");c.style.cssText="position:fixed;top:0;left:0;cursor:pointer;opacity:0.9;z-index:10000";c.addEventListener("click",function(a){a.preventDefault();u(++l%c.children.length);},!1);var k=(performance||Date).now(),g=k,a=0,r=e(new f.Panel("FPS","#0ff","#002")),h=e(new f.Panel("MS","#0f0","#020"));if(self.performance&&self.performance.memory)var t=e(new f.Panel("MB","#f08","#201"));u(0);return{REVISION:16,dom:c,addPanel:e,showPanel:u,begin:function begin(){k=(performance||Date).now();},end:function end(){a++;var c=(performance||Date).now();h.update(c-k,200);if(c>g+1E3&&(r.update(1E3*a/(c-g),100), g=c, a=0, t)){var d=performance.memory;t.update(d.usedJSHeapSize/1048576,d.jsHeapSizeLimit/1048576);}return c;},update:function update(){k=this.end();},domElement:c,setMode:u};};f.Panel=function(e,f,l){var c=Infinity,k=0,g=Math.round,a=g(window.devicePixelRatio||1),r=80*a,h=48*a,t=3*a,v=2*a,d=3*a,m=15*a,n=74*a,p=30*a,q=document.createElement("canvas");q.width=r;q.height=h;q.style.cssText="width:80px;height:48px";var b=q.getContext("2d");b.font="bold "+9*a+"px Helvetica,Arial,sans-serif";b.textBaseline="top";b.fillStyle=l;b.fillRect(0,0,r,h);b.fillStyle=f;b.fillText(e,t,v);b.fillRect(d,m,n,p);b.fillStyle=l;b.globalAlpha=.9;b.fillRect(d,m,n,p);return{dom:q,update:function update(h,w){c=Math.min(c,h);k=Math.max(k,h);b.fillStyle=l;b.globalAlpha=1;b.fillRect(0,0,r,m);b.fillStyle=f;b.fillText(g(h)+" "+e+" ("+g(c)+"-"+g(k)+")",t,v);b.drawImage(q,d+a,m,n-a,p,d,m,n-a,p);b.fillRect(d+n-a,m,a,p);b.fillStyle=l;b.globalAlpha=.9;b.fillRect(d+n-a,m,a,g((1-h/w)*p));}};};return f;});});/**
   * @author [Tristan Valcke]{@link https://github.com/Itee}
   * @license [BSD-3-Clause]{@link https://opensource.org/licenses/BSD-3-Clause}
   *
   * @class TOrbitControlsHelper
   * @classdesc Todo...
   * @example Todo...
   *
   */function TOrbitControlsHelper(orbitControls){if(!orbitControls){throw new Error('Unable to create TOrbitControlsHelper for null or undefined controller !');}if(!orbitControls instanceof OrbitControls){throw new Error('Parameter need to be an OrbitControls !');}var RADIUS=2;var RADIALS=16;var CIRCLES=2;var DIVISIONS=64;var color1=new Color$1(0x444444);var color2=new Color$1(0x888888);var vertices=[];var colors=[];var x,z;var v,i,j,r,color;// create the radials
  for(i=0;i<=RADIALS;i++){v=i/RADIALS*(Math.PI*2);x=Math.sin(v)*RADIUS;z=Math.cos(v)*RADIUS;vertices.push(0,0,0);vertices.push(x,0,z);color=i&1?color1:color2;colors.push(color.r,color.g,color.b);colors.push(color.r,color.g,color.b);}// create the circles
  for(i=0;i<=CIRCLES;i++){color=i&1?color1:color2;r=RADIUS-RADIUS/CIRCLES*i;for(j=0;j<DIVISIONS;j++){// first vertex
  v=j/DIVISIONS*(Math.PI*2);x=Math.sin(v)*r;z=Math.cos(v)*r;vertices.push(x,0,z);colors.push(color.r,color.g,color.b);// second vertex
  v=(j+1)/DIVISIONS*(Math.PI*2);x=Math.sin(v)*r;z=Math.cos(v)*r;vertices.push(x,0,z);colors.push(color.r,color.g,color.b);}// create axis
  vertices.push(-1,0,0,1,0,0,0,-1,0,0,1,0,0,0,-1,0,0,1);colors.push(1,0,0,1,0.6,0,0,1,0,0.6,1,0,0,0,1,0,0.6,1);}var geometry=new BufferGeometry();geometry.addAttribute('position',new Float32BufferAttribute(vertices,3));geometry.addAttribute('color',new Float32BufferAttribute(colors,3));var material=new LineBasicMaterial$1({vertexColors:VertexColors});material.transparent=true;material.opacity=0.0;LineSegments.call(this,geometry,material);this.control=orbitControls;this.control.addEventListener('start',this.startOpacityAnimation.bind(this));this.control.addEventListener('change',this.updateHelperPosition.bind(this));this.control.addEventListener('end',this.endOpacityAnimation.bind(this));this.intervalId=undefined;}TOrbitControlsHelper.prototype=Object.assign(Object.create(LineSegments.prototype),{constructor:TOrbitControlsHelper,updateHelperPosition:function updateHelperPosition(){var target=this.control.target;this.position.x=target.x;this.position.y=target.y;this.position.z=target.z;},startOpacityAnimation:function startOpacityAnimation(){// In case fade off is running, kill it an restore opacity to 1
  if(this.intervalId!==undefined){clearInterval(this.intervalId);this.intervalId=undefined;}this.material.opacity=1.0;},endOpacityAnimation:function endOpacityAnimation(){// Manage transparency interval
  this.intervalId=setInterval(function(){if(this.material.opacity<=0.0){this.material.opacity=0.0;clearInterval(this.intervalId);this.intervalId=undefined;}else{this.material.opacity-=0.1;}}.bind(this),100);}});/**
   * @author [Tristan Valcke]{@link https://github.com/Itee}
   * @license [BSD-3-Clause]{@link https://opensource.org/licenses/BSD-3-Clause}
   *
   * @class TViewport
   * @classdesc The TViewport allow to manage in an easier way a webgl TViewport containing by default:<br>
   * scene, camera, camera controllers, camera effects, lights, renderder, and some helper
   *
   * @requires three.PCFSoftShadowMap
   * @requires three.Scene
   * @requires three.PerspectiveCamera
   * @requires three.WebGLRenderer
   * @requires three.FogExp2
   * @requires three.DirectionalLight
   * @requires three.Raycaster
   * @requires three.Vector2
   * @requires three.Color
   * @requires three.MeshPhongMaterial
   * @requires three.ArrowHelper
   * @requires three.OrbitControls(modularized)
   * @requires three.AnaglyphEffect(modularized)
   * @requires three.StereoEffect(modularized)
   * @requires stats.Stats
   * @requires objects3d.TOrbitControlsHelper
   *
   * @example Todo
   *
   *//* eslint-env browser *//* global $ *//**
   *
   * @param container
   * @constructor
   */function TViewport(container){// First check if the given container exist, else throw an error
  if(container===null||typeof container==='undefined'||container.length===0){throw new Error('Required an container or a template to be create !');}this.container=container;this.containerWidth=this.container.clientWidth;//outerWidth(true)
  this.containerHeight=this.container.clientHeight;//height()
  this.view=$(TViewport.getTemplate());this.scene=new Scene();//    this.scene.add( new GridHelper(100, 100) )
  this.camera=new PerspectiveCamera();this.orbitControl=new OrbitControls(this.camera,this.view.get(0));this.orbitControl.maxDistance=2000;this.orbitControlHelper=new TOrbitControlsHelper(this.orbitControl);this.scene.add(this.orbitControlHelper);this.cameraControl=this.orbitControl;this.cameraControlType='orbital';this.cameraControl.enabled=true;this.cameraEffect='normal';// Base renderer
  this.webGLRenderer=new WebGLRenderer({antialias:true});// Anaglyph effect
  this.anaglyphEffectRenderer=new AnaglyphEffect(this.webGLRenderer,this.containerWidth,this.containerHeight);// Creates the Stereo Effect for the VR experience.
  this.stereoEffectRenderer=new StereoEffect(this.webGLRenderer);// Current renderer
  this.renderer=this.webGLRenderer;$(this.webGLRenderer.domElement).appendTo(this.view);this.measuring=false;this.mouse=new Vector2$1();this.isRaycastable=false;this.raycaster=new Raycaster();this.raycastables=[];this.intersection=undefined;//    this.baseColor       = new Color( 0.7, 0.5, 0.1 )
  //    this.intersectColor  = new Color( 0.1, 0.5, 0.7 )
  this.backupIntersectedMaterial=undefined;this.backupSelectedMaterial=undefined;this.intersectMaterial=new MeshPhongMaterial({color:new Color$1(0.1,0.5,0.7)});this.selected=undefined;//    this.selectedOutline = undefined
  this.settings={camera:{fov:50,aspect:this.containerWidth/this.containerHeight,near:0.01,far:10000,position:{x:5.0,y:2.0,z:-5.0},target:{x:0.0,y:0.0,z:0.0}},showStat:true//    this.clock = new Clock()
  };this.view.appendTo(this.container);init.call(this);if(this.settings.showStat){this.stats=new stats_min();this.stats.domElement.style.position='absolute';this.stats.domElement.style.top=null;this.stats.domElement.style.left=null;this.stats.domElement.style.right='0px';this.stats.domElement.style.bottom='0px';this.container.appendChild(this.stats.domElement);}this.autorun=true;this.toggleCam=true;this.updateSizes();this.update();function init(){initCamera.call(this);initLight.call(this);initRender.call(this);initEvent.call(this);}function initCamera(){this.camera.fov=this.settings.camera.fov;this.camera.aspect=this.settings.camera.aspect;this.camera.near=this.settings.camera.near;this.camera.far=this.settings.camera.far;this.camera.position.x=this.settings.camera.position.x;this.camera.position.y=this.settings.camera.position.y;this.camera.position.z=this.settings.camera.position.z;}function initLight(){//        this.scene.add( new AmbientLight( 0xffffff ) );
  //        this.light = new SpotLight( 0x777777 )
  //        this.light.position.set( -700.0, 1800.0, 2000.0 )
  //        this.light.castShadow            = true
  //        this.light.shadow.mapSize.width  = 2048
  //        this.light.shadow.mapSize.height = 2048
  this.light=new DirectionalLight(0xFFFFFF);this.light.position.set(-70.0,180.0,200.0);this.light.castShadow=true;this.light.shadow.mapSize.width=2048;this.light.shadow.mapSize.height=2048;//        var lightHelper = new DirectionalLightHelper( this.light, 200, new Color(0.3, 0.5, 0.7) )
  //        this.scene.add( lightHelper )
  this.scene.add(this.light);//        this.scene.add( this.light )
  }function initRender(){this.webGLRenderer.setClearColor(0x777777);this.webGLRenderer.autoClear=true;this.webGLRenderer.shadowMap.enabled=true;this.webGLRenderer.shadowMap.yype=PCFSoftShadowMap;}function initEvent(){var self=this;window.addEventListener('resize',self.updateSizes.bind(self),true);self.view[0].addEventListener('mousemove',this.updateRaycasting.bind(this),false);self.view[0].addEventListener('mousedown',this.selectObject.bind(this),false);self.orbitControl.addEventListener('rotate',self.decimateVisibleMeshes.bind(self),true);self.orbitControl.addEventListener('pan',self.decimateVisibleMeshes.bind(self),true);self.orbitControl.addEventListener('zoom',self.decimateVisibleMeshes.bind(self),true);self.orbitControl.addEventListener('end',self.populateVisibleMeshes.bind(self),true);}}// Static methods
  Object.assign(TViewport,{getTemplate:function getTemplate(){return''+'<div class="webglViewport">'+'	<div id="tablet-controls-panel">'+'       <div id="progressBar" class="progress">'+'           <div class="progress-bar" role="progressbar" aria-valuenow="0" aria-valuemin="0" aria-valuemax="100" style="width:0%">'+'               <span class="sr-only">0%</span>'+'           </div>'+'       </div>'+//            '		<div class="control">' +
  //            '			<a id="move-forward" data-toggle="tooltip" title="Avancer">' +
  //            '				<i class="fa fa-arrow-circle-up fa-4x"></i>' +
  //            '			</a>' +
  //            '		</div>' +
  //            '		<div class="control">' +
  //            '			<a id="move-backward" data-toggle="tooltip" title="Reculer">' +
  //            '				<i class="fa fa-arrow-circle-down fa-4x"></i>' +
  //            '			</a>' +
  //            '		</div>' +
  '	</div>'+'	<div id="camera-coordinates" style="color: white; position: absolute; top: 0px; margin-left: 10px;"></div>'+'</div>';}});// Public methods
  Object.assign(TViewport.prototype,EventDispatcher.prototype,{toggleAutorun:function toggleAutorun(){// Toggle running state
  this.autorun=!this.autorun;// Restart loop if wanted
  if(this.autorun){this.update();}},toggleCamera:function toggleCamera(){this.toggleCam=!this.toggleCam;},update:function update(forceUpdate){if(this.stats){this.stats.begin();}// Break loop if wanted
  if(this.autorun||forceUpdate){requestAnimationFrame(this.update.bind(this));if(this.cameraControl instanceof OrbitControls){this.camera.updateProjectionMatrix();}//            var avatar = this.scene.getObjectByName( 'Avatar' )
  //            if ( avatar && avatar.mixer ) {
  //
  //                avatar.mixer.update( this.clock.getDelta() )
  //
  //            }
  this.renderer.render(this.scene,this.camera);//            if ( this.cameraEffect === 'normal' ) {
  //                this.webGLRenderer.render( this.scene, this.camera )
  //            } else if ( this.cameraEffect === 'anaglyph' ) {
  //                this.anaglyphEffectRenderer.render( this.scene, this.camera )
  //            } else if ( this.cameraEffect === 'vr' ) {
  //                this.stereoEffectRenderer.render( this.scene, this.camera )
  //            } else {
  //                console.error( 'Unknown camera effect: ' + this.cameraEffect )
  //                this.webGLRenderer.render( this.scene, this.camera )
  //            }
  }if(this.stats){this.stats.end();}},updateSizes:function updateSizes(){this.containerWidth=this.container.clientWidth;this.containerHeight=this.container.clientHeight;this.webGLRenderer.setSize(this.containerWidth,this.containerHeight);// required for correct camera position at init...
  this.camera.aspect=this.containerWidth/this.containerHeight;this.camera.updateProjectionMatrix();},addRaycastables:function addRaycastables(objects){for(var intersectableIndex=0,numberOfIntersectables=objects.length;intersectableIndex<numberOfIntersectables;intersectableIndex++){this.raycastables.push(objects[intersectableIndex]);}},updateRaycasting:function updateRaycasting(event){if(!this.isRaycastable){if(this.intersection){//                this.intersection.object.material.color.copy( this.baseColor )
  this.intersection=null;document.body.style.cursor='auto';}return;}event.preventDefault();var xMouseOnContainer=event.layerX||event.offsetX||0;var yMouseOnContainer=event.layerY||event.offsetY||0;this.mouse.x=xMouseOnContainer/this.container.clientWidth*2-1;this.mouse.y=-(yMouseOnContainer/this.container.clientHeight)*2+1;this.raycaster.setFromCamera(this.mouse,this.camera);var showRay=false;if(showRay){var ray=this.raycaster.ray;if(this.ray){this.scene.remove(this.ray);}this.ray=new ArrowHelper(ray.direction,ray.origin,10,0x115577);this.scene.add(this.ray);}var intersections=undefined;if(this.measuring){var meshesGroup=this.scene.getObjectByName('MeshesGroup');var meshes=meshesGroup?meshesGroup.children:[];//			var pointcloudGroup = this.scene.getObjectByName( 'PointClouds' )
  //			var pointcloud      = ( pointcloudGroup ) ? pointcloudGroup.children : []
  //
  //			var objectToIntersect = meshes.concat( pointcloud )
  intersections=this.raycaster.intersectObjects(meshes,true);//			intersections = this.raycaster.intersectObjects( objectToIntersect, true )
  if(intersections.length>0){this.intersection=intersections[0];// Keep only closest intersected object
  this.dispatchEvent({type:'intersectPoint'});}else if(this.intersection){this.intersection=null;}}else{intersections=this.raycaster.intersectObjects(this.raycastables);if(intersections.length>0){if(!this.intersection){this.intersection=intersections[0];this.backupIntersectedMaterial=this.intersection.object.material;this.intersection.object.material=this.intersectMaterial;}else if(this.intersection.object.uuid!==intersections[0].object.uuid){this.intersection.object.material=this.backupIntersectedMaterial;this.intersection=intersections[0];this.backupIntersectedMaterial=this.intersection.object.material;this.intersection.object.material=this.intersectMaterial;}document.body.style.cursor='pointer';}else if(this.intersection){this.intersection.object.material=this.backupIntersectedMaterial;this.intersection=null;document.body.style.cursor='auto';}}},selectObject:function selectObject(clickEvent){if(this.measuring){if(this.intersection){if(clickEvent.button===0){this.dispatchEvent({type:'newClickedPoint'});}else if(clickEvent.button===2){this.intersection=null;this.dispatchEvent({type:'measureEnd'});}else{}}else{console.warn('Unable to get hit position for undefined intersection objects !!!');}}else{if(clickEvent.button===0){if(this.intersection){clickEvent.preventDefault();if(this.selected!==this.intersection.object){if(this.selected){this.selected.material=this.backupSelectedMaterial;this.selected=null;this.backupSelectedMaterial=null;//                            this.scene.remove( this.selectedOutline )
  }this.selected=this.intersection.object;this.backupSelectedMaterial=this.backupIntersectedMaterial;this.backupIntersectedMaterial=this.intersectMaterial;//                        this.selected.material = this.intersectMaterial
  //                        var selectedGeometry = this.selected.geometry
  //
  //                        var outlineMaterial = new MeshBasicMaterial( {
  //                            color: 0x115577,
  //                            side:  BackSide
  //                        } )
  //
  //                        this.selectedOutline = new Mesh( selectedGeometry, outlineMaterial )
  //                        //                    this.selectedOutline.matrix.copy( this.selected.matrix )
  //                        this.selectedOutline.position.copy( this.selected.position )
  //                        this.selectedOutline.quaternion.copy( this.selected.quaternion )
  //                        this.selectedOutline.scale.set( 1.1, 1.0, 1.1 )
  //
  //                        this.scene.add( this.selectedOutline )
  this.dispatchEvent({type:'objectSelected'});}}else if(this.selected){this.selected.material=this.backupSelectedMaterial;this.selected=null;this.backupSelectedMaterial=null;//                    this.scene.remove( this.selectedOutline )
  //                    this.selected = null
  }}}},setCameraPosition:function setCameraPosition(position){var cameraControllerType=this.cameraControlType;if(cameraControllerType==='orbital'){this.camera.position.x=position.x;this.camera.position.y=position.y;this.camera.position.z=position.z;this.cameraControl.target.x=position.x;this.cameraControl.target.y=0;this.cameraControl.target.z=position.z;this.cameraControl.update();}else if(cameraControllerType==='path'){this.cameraControl.goTo(position);}else{console.error("Unable to change camera position, unknown camera controller type !");}},setCameraEffect:function setCameraEffect(cameraEffect){var trimmedEffectName=cameraEffect.trim(' ');// In case we were in vr, reset renderer size
  if(this.cameraEffect===trimmedEffectName){return;}else if(trimmedEffectName==='normal'){this.renderer=this.webGLRenderer;}else if(trimmedEffectName==='vr'){this.renderer=this.stereoEffectRenderer;}else if(trimmedEffectName==='anaglyph'){this.renderer=this.anaglyphEffectRenderer;}else{this.renderer=this.webGLRenderer;}this.renderer.setSize(this.containerWidth,this.containerHeight);this.cameraEffect=trimmedEffectName;},setCameraControls:function setCameraControls(cameraControlType){var currentCameraPosition=this.camera.position;if(cameraControlType==="orbital"){this.cameraControlType=cameraControlType;this.cameraControl.enabled=false;this.scene.fog=null;this.cameraControl=this.orbitControl;this.cameraControl.enabled=true;this.camera.far=60;this.camera.updateProjectionMatrix();// Set target to previous camera position
  this.cameraControl.target.x=currentCameraPosition.x;this.cameraControl.target.y=currentCameraPosition.y;this.cameraControl.target.z=currentCameraPosition.z;this.cameraControl.object.position.x+=10;this.cameraControl.object.position.y+=5;this.cameraControl.object.position.z+=10;this.scene.add(this.orbitControlHelper);this.cameraControl.update();}else if(mode==="avatar"){// Set target to previous camera position
  this.cameraControl.object.position.x=this.cameraControl.target.x;this.cameraControl.object.position.y=this.cameraControl.target.y;this.cameraControl.object.position.z=this.cameraControl.target.z;this.cameraControl.target.x=currentCameraPosition.x;this.cameraControl.target.y=currentCameraPosition.y;this.cameraControl.target.z=currentCameraPosition.z;this.scene.remove(this.orbitControlHelper);this.cameraControl.update();}else if(cameraControlType==="path"){this.cameraControlType=cameraControlType;this.cameraControl.enabled=false;this.scene.fog=new FogExp2(0x000000,0.2);this.camera.far=10;this.camera.updateProjectionMatrix();}else{console.error("Invalid camera controller: "+cameraControlType);}},setGroupVisibility:function setGroupVisibility(groupName,visibility){var group=this.scene.getObjectByName(groupName);if(group){group.visible=visibility;for(var childIndex=0,numberOfChilds=group.children.length;childIndex<numberOfChilds;childIndex++){group.children[childIndex].visible=visibility;}}},decimateVisibleMeshes:function decimateVisibleMeshes(){//todo: recursive search against currently visible group and cache hide mesh for repopulate later !!!
  var decimateValue=0.9;var groups=this.scene.children.filter(function(child){return child.type==='Group';});if(!groups||groups.length===0){return;}var subGroup=groups[0].children.filter(function(child){return child.type==='Group';});if(!subGroup||subGroup.length===0){return;}var subSubGroup=subGroup[0].children.filter(function(child){return child.type==='Group';});if(!subSubGroup||subSubGroup.length===0){return;}var meshes=subSubGroup[0].children.filter(function(child){return child.isMesh;});if(!meshes||meshes.length===0){return;}var numberOfMeshesToHide=Math.round(meshes.length*decimateValue);for(var meshIndex=0;meshIndex<numberOfMeshesToHide;meshIndex++){meshes[meshIndex].visible=false;}},populateVisibleMeshes:function populateVisibleMeshes(){var groups=this.scene.children.filter(function(child){return child.type==='Group';});if(!groups||groups.length===0){return;}var subGroup=groups[0].children.filter(function(child){return child.type==='Group';});if(!subGroup||subGroup.length===0){return;}var subSubGroup=subGroup[0].children.filter(function(child){return child.type==='Group';});if(!subSubGroup||subSubGroup.length===0){return;}var meshes=subSubGroup[0].children.filter(function(child){return child.isMesh;});if(!meshes||meshes.length===0){return;}var numberOfMeshes=meshes.length;for(var meshIndex=0;meshIndex<numberOfMeshes;meshIndex++){meshes[meshIndex].visible=true;}}});/**
   * @author [Tristan Valcke]{@link https://github.com/Itee}
   * @license [BSD-3-Clause]{@link https://opensource.org/licenses/BSD-3-Clause}
   *
   * @class TOrchestrator
   * @classdesc Todo...
   * @example Todo...
   *
   *//**
   *
   * @constructor
   */function TOrchestrator(){this.requestQueue=[];this.minSimultaneousRequest=3;this.maxSimultaneousRequest=6;this._numberOfRunningRequest=0;this._processQueue=[];this._inProcessing=false;}Object.assign(TOrchestrator.prototype,{/**
               * @public
               * @memberOf TOrchestrator.prototype
               */processQueue:function processQueue(){var self=this;var request=void 0;var requestSkull=void 0;this._inProcessing=true;while(self.requestQueue.length>0){if(self._numberOfRunningRequest>=self.maxSimultaneousRequest){break;}requestSkull=self.requestQueue.pop();self._processQueue.push(requestSkull);request=new XMLHttpRequest();request.responseType=requestSkull.responseType;request.onload=function closureEndRequest(){var _reqSkull=requestSkull;return function _checkEndRequest(loadEvent){var processedRequestIndex=self._processQueue.indexOf(_reqSkull);if(processedRequestIndex>-1){self._processQueue.splice(processedRequestIndex,1);}self._numberOfRunningRequest--;_reqSkull.onLoad(loadEvent);if(self._numberOfRunningRequest<=self.minSimultaneousRequest){self.processQueue();}};}();request.onprogress=requestSkull.onProgress;request.onerror=requestSkull.onError;request.open(requestSkull.method,requestSkull.url);request.setRequestHeader("Content-Type","application/json");var dataToSend=requestSkull.data&&requestSkull.responseType==='json'?JSON.stringify(requestSkull.data):requestSkull.data;request.send(dataToSend);self._numberOfRunningRequest++;}self._inProcessing=false;},/**
               * @public
               * @memberOf TOrchestrator.prototype
               *
               * @param newRequest
               */queue:function queue(newRequest){var _this=this;// Check if request for same url already exist
  var skipNewRequest=false;var _loop=function _loop(requestIndex,numberOfRequest){var request=_this.requestQueue[requestIndex];if(request.method!==newRequest.method){return"continue";}if(request.url!==newRequest.url){return"continue";}if(request.data!==newRequest.data){return"continue";}// Wrap callback of existing request with new request
  var requestOnLoad=request.onLoad;request.onLoad=function(onLoadEvent){requestOnLoad(onLoadEvent);newRequest.onLoad(onLoadEvent);};var requestOnProgress=request.onProgress;request.onProgress=function(onProgressEvent){requestOnProgress(onProgressEvent);newRequest.onProgress(onProgressEvent);};var requestOnError=request.onError;request.onError=function(onErrorEvent){requestOnError(onErrorEvent);newRequest.onError(onErrorEvent);};skipNewRequest=true;};for(var requestIndex=0,numberOfRequest=this.requestQueue.length;requestIndex<numberOfRequest;requestIndex++){var _ret=_loop(requestIndex,numberOfRequest);if(_ret==="continue")continue;}var _loop2=function _loop2(requestIndex,numberOfRequest){var request=_this._processQueue[requestIndex];if(request.method!==newRequest.method){return"continue";}if(request.url!==newRequest.url){return"continue";}if(request.data!==newRequest.data){return"continue";}// Wrap callback of existing request with new request
  var requestOnLoad=request.onLoad;request.onLoad=function(onLoadEvent){requestOnLoad(onLoadEvent);newRequest.onLoad(onLoadEvent);};var requestOnProgress=request.onProgress;request.onProgress=function(onProgressEvent){requestOnProgress(onProgressEvent);newRequest.onProgress(onProgressEvent);};var requestOnError=request.onError;request.onError=function(onErrorEvent){requestOnError(onErrorEvent);newRequest.onError(onErrorEvent);};skipNewRequest=true;};for(var requestIndex=0,numberOfRequest=this._processQueue.length;requestIndex<numberOfRequest;requestIndex++){var _ret2=_loop2(requestIndex,numberOfRequest);if(_ret2==="continue")continue;}if(skipNewRequest){return;}this.requestQueue.push(newRequest);if(!this._inProcessing){this.processQueue();}}});var singletonInstance=new TOrchestrator();/**
   * @author [Tristan Valcke]{@link https://github.com/Itee}
   * @license [BSD-3-Clause]{@link https://opensource.org/licenses/BSD-3-Clause}
   *
   * @class TErrorManager
   * @classdesc TCache is a simple javascript object whose purpose is to store some ket/value data to future usage. It could be enable/disable.
   *
   * @example
   * var cache = new TCache()
   * cache.add( 'foo', 'bar' )
   * console.log( cache.get('foo') ) // 'bar'
   *//**
   * @class Super class cache!
   */var TCache=function(){/**
       * @constructor
       */function TCache(){classCallCheck(this,TCache);this._cache={};}/**
       * Allow to add new key value pair, the key cannot be null, undefined, or an empty string.
       * In case the key already exist, the value will be overwritten.
       *
       * @param key
       * @param file
       */createClass(TCache,[{key:"add",value:function add(key,file){this._cache[key]=file;}/**
           * Return the value associated to the key.
           *
           * @param key
           * @returns {*}
           */},{key:"get",value:function get$$1(key){return this._cache[key];}/**
           * Remove to value from the cache. Does nothing if the key does not exist.
           *
           * @param key
           */},{key:"remove",value:function remove(key){delete this._cache[key];}/**
           * Clear the cache and reset it to an empty object.
           */},{key:"clear",value:function clear(){this._cache={};}}]);return TCache;}();/**
   * @author [Tristan Valcke]{@link https://github.com/Itee}
   * @license [BSD-3-Clause]{@link https://opensource.org/licenses/BSD-3-Clause}
   *
   * @class TDataBaseManager
   * @classdesc The base class of database managers. Give the basic interface about database call.
   *
   * @requires {@link HttpVerb}
   * @requires {@link ResponseType}
   * @requires {@link HttpStatusCode}
   * @requires {@link TOrchestrator}
   * @requires {@link TCache}
   *
   * @example Todo
   *
   */function TDataBaseManager(){var _basePath='/';var _responseType=ResponseType.Json;// Todo: progress and error manager
  this.progressManager=null;this.errorManager=null;Object.defineProperties(this,{basePath:{enumerable:true,get:function get(){return _basePath;},set:function set(basePath){if(!basePath){throw new Error('TDataBaseManager: basePath cannot be null or undefined !');}if(typeof basePath!=='string'){throw new Error('TDataBaseManager: basePath is expected to be a string !');}if(basePath.length===0){throw new Error('TDataBaseManager: basePath cannot be an empty string !');}if(!/\S/.test(basePath)){throw new Error('TDataBaseManager: basePath cannot contain only whithspace !');}_basePath=basePath;}},responseType:{enumerable:true,get:function get(){return _responseType;},set:function set(responseType){if(!responseType){throw new Error('TDataBaseManager: basePath cannot be null or undefined !');}if(typeof responseType!=='string'){throw new Error('TDataBaseManager: basePath is expected to be a string !');}_responseType=responseType;}},_cache:{value:new TCache()}});}// Static Private properties
  Object.defineProperties(TDataBaseManager,{/**
       * @static
       * @private
       * @memberOf TDataBaseManager
       * @description The orchestrator singleton instance that will manage and perform database request from all managers.
       */_orchestrator:{value:singletonInstance},/**
       * @static
       * @private
       * @function
       * @memberOf TDataBaseManager
       * @description This static private method will check the server response status code, and perform the associated action.
       * @param {number} status - The server response status code to check.
       */_statusOk:{value:function value(status){var statusOk=false;if(status===HttpStatusCode.NoContent){console.warn('Unable to retrieve data...');}else if(status!==HttpStatusCode.Ok){console.error('An error occurs when retrieve data from database !!!');}else{statusOk=true;}return statusOk;}}});// Static Public methods
  Object.assign(TDataBaseManager,{/**
       * @static
       * @function
       * @memberOf TDataBaseManager
       * @description Will queue an XMLHttpRequest to the orchestrator binding the callbacks to the server response.
       *
       * @param {HttpVerb} method - The method to use for this request.
       * @param {string} url - The URL to call.
       * @param {object} data - The data to sent to the server.
       * @param {function} onLoad - The onLoad callback, which is call when server respond with success to the request.
       * @param {function} onProgress - The onProgress callback, which is call during the response incoming.
       * @param {function} onError - The onError callback, which is call when server respond with an error to the request.
       * @param {ResponseType} responseType - Allow to set the expected response type.
       */requestServer:function requestServer(method,url,data,onLoad,onProgress,onError,responseType){TDataBaseManager._orchestrator.queue({method:method,url:url,data:data,onLoad:onLoad,onProgress:onProgress,onError:onError,responseType:responseType});}});/// Instance
  // private properties
  Object.defineProperties(TDataBaseManager.prototype,{//// Events
  /**
       * @private
       * @function
       * @memberOf TDataBaseManager.prototype
       * @description The private _onLoad method allow to process the server response in an abstract way to check against error and wrong status code.
       * It will bind user callback on each type of returns, and dispatch in sub methods in function of the response type.
       *
       * @param {function} onLoadCallback - The onLoad callback, which is call when server respond with success to the request.
       * @param {function} onProgressCallback - The onProgress callback, which is call during the response incoming.
       * @param {function} onErrorCallback - The onError callback, which is call when server respond with an error to the request.
       * @param {object} loadEvent - The server response object to parse.
       */_onLoad:{value:function _onLoad(onLoadCallback,onProgressCallback,onErrorCallback,loadEvent){var target=loadEvent.target;var status=target.status;var response=target.response;var responseType=target.responseType;if(!TDataBaseManager._statusOk(status)){return;}if(!response){console.error('TDataBaseManager.onLoad: No data receive !');return;}switch(responseType){case ResponseType.ArrayBuffer:this._onArrayBuffer(response,onLoadCallback,this._onProgress.bind(this,onProgressCallback),this._onError.bind(this,onErrorCallback));break;case ResponseType.Blob:this._onBlob(response,onLoadCallback,this._onProgress.bind(this,onProgressCallback),this._onError.bind(this,onErrorCallback));break;case ResponseType.Json:this._onJson(response,onLoadCallback,this._onProgress.bind(this,onProgressCallback),this._onError.bind(this,onErrorCallback));break;case ResponseType.DOMString:case ResponseType.Default:this._onText(response,onLoadCallback,this._onProgress.bind(this,onProgressCallback),this._onError.bind(this,onErrorCallback));break;default:throw new Error('Unknown response type: '+responseType);break;}}},/**
       * @private
       * @function
       * @memberOf TDataBaseManager.prototype
       * @description The private _onProgress method will handle all progress event from server and submit them to the progressManager if exist else to the user onProgressCallback
       *
       * @param {function} onProgressCallback - The onProgress callback, which is call during the response incoming.
       * @param {object} progressEvent - The server progress event.
       */_onProgress:{value:function _onProgress(onProgressCallback,progressEvent){if(this.progressManager){this.progressManager.update(onProgressCallback,progressEvent);}else if(onProgressCallback){onProgressCallback(progressEvent);}else{//console.log( progressEvent )
  }}},/**
       * @private
       * @function
       * @memberOf TDataBaseManager.prototype
       * @description The private _onError method will handle all error event from server and submit them to the errorManager if exist else to the user onErrorCallback
       *
       * @param {function} onErrorCallback - The onError callback, which is call when server respond with an error to the request.
       * @param {object} errorEvent - A server error event
       */_onError:{value:function _onError(onErrorCallback,errorEvent){if(this.errorManager){this.errorManager.update(onErrorCallback,errorEvent);}else if(onErrorCallback){onErrorCallback(errorEvent);}else{console.error(errorEvent);}}},//// Data parsing
  // Expect that methods were reimplemented when TDataBaseManager is inherited
  /**
       * @private
       * @abstract
       * @function
       * @memberOf TDataBaseManager.prototype
       * @description The abstract private _onArrayBuffer method must be overridden in case the parser expect an array buffer as input data.
       *
       * @param {ArrayBuffer} data - The retrieved data to parse.
       * @param {function} onSuccess - The onLoad callback, which is call when parser parse with success the data.
       * @param {function} onProgress - The onProgress callback, which is call during the parsing.
       * @param {function} onError - The onError callback, which is call when parser throw an error during parsing.
       */_onArrayBuffer:{value:function _onArrayBufferDefault(data,onSuccess,onProgress,onError){throw new Error('TDataBaseManager: _onArrayBuffer methods must be reimplemented !');}},/**
       * @private
       * @abstract
       * @function
       * @memberOf TDataBaseManager.prototype
       * @description The abstract private _onBlob method must be overridden in case the parser expect a blob as input data.
       *
       * @param {Blob} data - The retrieved data to parse.
       * @param {function} onSuccess - The onLoad callback, which is call when parser parse with success the data.
       * @param {function} onProgress - The onProgress callback, which is call during the parsing.
       * @param {function} onError - The onError callback, which is call when parser throw an error during parsing.
       */_onBlob:{value:function _onBlobDefault(data,onSuccess,onProgress,onError){throw new Error('TDataBaseManager: _onBlob methods must be reimplemented !');}},/**
       * @private
       * @abstract
       * @function
       * @memberOf TDataBaseManager.prototype
       * @description The abstract private _onJson method must be overridden in case the parser expect json as input data.
       *
       * @param {json} data - The retrieved data to parse.
       * @param {function} onSuccess - The onLoad callback, which is call when parser parse with success the data.
       * @param {function} onProgress - The onProgress callback, which is call during the parsing.
       * @param {function} onError - The onError callback, which is call when parser throw an error during parsing.
       */_onJson:{value:function _onJsonDefault(data,onSuccess,onProgress,onError){throw new Error('TDataBaseManager: _onJson methods must be reimplemented !');}},/**
       * @private
       * @abstract
       * @function
       * @memberOf TDataBaseManager.prototype
       * @description The abstract private _onText method must be overridden in case the parser expect a string/text as input data.
       *
       * @param {string} data - The retrieved data to parse.
       * @param {function} onSuccess - The onLoad callback, which is call when parser parse with success the data.
       * @param {function} onProgress - The onProgress callback, which is call during the parsing.
       * @param {function} onError - The onError callback, which is call when parser throw an error during parsing.
       */_onText:{value:function _onTextDefault(data,onSuccess,onProgress,onError){throw new Error('TDataBaseManager: _onText methods must be reimplemented !');}},// REST Api calls
  /**
       * @private
       * @function
       * @memberOf TDataBaseManager.prototype
       * @description The private _create method allow to format a server request to create objects with the given data and get creation result with given callbacks.
       *
       * @param {object} data - The data to send.
       * @param {function} onLoadCallback - The onLoad callback, which is call when server respond with success to the request.
       * @param {function} onProgressCallback - The onProgress callback, which is call during the response incoming.
       * @param {function} onErrorCallback - The onError callback, which is call when server respond with an error to the request.
       */_create:{value:function _create(data,onLoadCallback,onProgressCallback,onErrorCallback){TDataBaseManager.requestServer(HttpVerb.Create,this.basePath,data,this._onLoad.bind(this,onLoadCallback,onProgressCallback,onErrorCallback),this._onProgress.bind(this,onProgressCallback),this._onError.bind(this,onErrorCallback),this.responseType);}},/**
       * @private
       * @function
       * @memberOf TDataBaseManager.prototype
       * @description The private _readSome method will format a server request to get objects with id in the ids array.
       *
       * @param {array.<string>} ids - The ids of objects to retrieve.
       * @param {function} onLoadCallback - The onLoad callback, which is call when server respond with success to the request.
       * @param {function} onProgressCallback - The onProgress callback, which is call during the response incoming.
       * @param {function} onErrorCallback - The onError callback, which is call when server respond with an error to the request.
       */_readSome:{value:function _readSome(ids,onLoadCallback,onProgressCallback,onErrorCallback){var self=this;var results=[];var cachedResult=undefined;var id=undefined;for(var idIndex=0,numberOfIds=ids.length;idIndex<numberOfIds;idIndex++){id=ids[idIndex];cachedResult=this._cache.get(id);if(!cachedResult){break;}results.push(cachedResult);}if(results.length===ids.length){onLoadCallback(results);}else{var cacheOnLoadResult=function cacheOnLoadResult(results){var result=undefined;for(var resultIndex=0,numberOfResults=results.length;resultIndex<numberOfResults;resultIndex++){result=results[resultIndex];self._cache.add(ids[resultIndex],result);}onLoadCallback(results);};TDataBaseManager.requestServer(HttpVerb.Read,this.basePath,ids,this._onLoad.bind(this,cacheOnLoadResult,onProgressCallback,onErrorCallback),this._onProgress.bind(this,onProgressCallback),this._onError.bind(this,onErrorCallback),this.responseType);}}},/**
       * @private
       * @function
       * @memberOf TDataBaseManager.prototype
       * @description The private _updateOne method will format a server request to get a single object with the given id.
       *
       * @param {string} id - The object's id of the object to retrieve.
       * @param {function} onLoadCallback - The onLoad callback, which is call when server respond with success to the request.
       * @param {function} onProgressCallback - The onProgress callback, which is call during the response incoming.
       * @param {function} onErrorCallback - The onError callback, which is call when server respond with an error to the request.
       */_readOne:{value:function _readOne(id,onLoadCallback,onProgressCallback,onErrorCallback){var self=this;var cachedValue=this._cache.get(id);if(cachedValue){onLoadCallback(cachedValue);}else{var cacheOnLoadResult=function cacheOnLoadResult(result){self._cache.add(id,result[0]);onLoadCallback(result);};TDataBaseManager.requestServer(HttpVerb.Read,this.basePath+'/'+id,null,this._onLoad.bind(this,cacheOnLoadResult,onProgressCallback,onErrorCallback),this._onProgress.bind(this,onProgressCallback),this._onError.bind(this,onErrorCallback),this.responseType);}}},//Todo: where are update datas ?
  /**
       * @private
       * @function
       * @memberOf TDataBaseManager.prototype
       * @description The private _updateSome method will format a server request to update objects with id in the ids array.
       *
       * @param {array.<string>} ids - The ids of objects to update.
       * @param {function} onLoadCallback - The onLoad callback, which is call when server respond with success to the request.
       * @param {function} onProgressCallback - The onProgress callback, which is call during the response incoming.
       * @param {function} onErrorCallback - The onError callback, which is call when server respond with an error to the request.
       */_updateSome:{value:function _updateSome(ids,onLoadCallback,onProgressCallback,onErrorCallback){TDataBaseManager.requestServer(HttpVerb.Update,this.basePath,ids,this._onLoad.bind(this,onLoadCallback,onProgressCallback,onErrorCallback),this._onProgress.bind(this,onProgressCallback),this._onError.bind(this,onErrorCallback),this.responseType);}},//Todo: where are update datas ?
  /**
       * @private
       * @function
       * @memberOf TDataBaseManager.prototype
       * @description The private _updateOne method will format a server request to update a single object with the given id.
       *
       * @param {string} id - The object's id of the object to update.
       * @param {function} onLoadCallback - The onLoad callback, which is call when server respond with success to the request.
       * @param {function} onProgressCallback - The onProgress callback, which is call during the response incoming.
       * @param {function} onErrorCallback - The onError callback, which is call when server respond with an error to the request.
       */_updateOne:{value:function _updateOne(id,onLoadCallback,onProgressCallback,onErrorCallback){TDataBaseManager.requestServer(HttpVerb.Update,this.basePath+'/'+id,null,this._onLoad.bind(this,onLoadCallback,onProgressCallback,onErrorCallback),this._onProgress.bind(this,onProgressCallback),this._onError.bind(this,onErrorCallback),this.responseType);}},/**
       * @private
       * @function
       * @memberOf TDataBaseManager.prototype
       * @description The private _deleteSome method will format a server request to delete objects with id in the ids array.
       *
       * @param {array.<string>} ids - The ids of objects to delete.
       * @param {function} onLoadCallback - The onLoad callback, which is call when server respond with success to the request.
       * @param {function} onProgressCallback - The onProgress callback, which is call during the response incoming.
       * @param {function} onErrorCallback - The onError callback, which is call when server respond with an error to the request.
       */_deleteSome:{value:function _deleteSome(ids,onLoadCallback,onProgressCallback,onErrorCallback){TDataBaseManager.requestServer(HttpVerb.Delete,this.basePath,ids,this._onLoad.bind(this,onLoadCallback,onProgressCallback,onErrorCallback),this._onProgress.bind(this,onProgressCallback),this._onError.bind(this,onErrorCallback),this.responseType);}},/**
       * @private
       * @function
       * @memberOf TDataBaseManager.prototype
       * @description The private _deleteOne method will format a server request to delete a single object with the given id.
       *
       * @param {string} id - The object's id of the object to delete.
       * @param {function} onLoadCallback - The onLoad callback, which is call when server respond with success to the request.
       * @param {function} onProgressCallback - The onProgress callback, which is call during the response incoming.
       * @param {function} onErrorCallback - The onError callback, which is call when server respond with an error to the request.
       */_deleteOne:{value:function _deleteOne(id,onLoadCallback,onProgressCallback,onErrorCallback){TDataBaseManager.requestServer(HttpVerb.Delete,this.basePath+'/'+id,null,this._onLoad.bind(this,onLoadCallback,onProgressCallback,onErrorCallback),this._onProgress.bind(this,onProgressCallback),this._onError.bind(this,onErrorCallback),this.responseType);}}});// Public interface
  Object.assign(TDataBaseManager.prototype,{/**
       * @function
       * @memberOf TDataBaseManager.prototype
       * @description The create method allow to create a new ressource on the server. Providing a single object that match a database schema, or an array of them.
       *
       * @param {object|array.<object>} data - The data to send for create new objects.
       * @param {function} onLoadCallback - The onLoad callback, which is call when server respond with success to the request.
       * @param {function} onProgressCallback - The onProgress callback, which is call during the response incoming.
       * @param {function} onErrorCallback - The onError callback, which is call when server respond with an error to the request.
       */create:function create(data,onLoadCallback,onProgressCallback,onErrorCallback){var dataArray=[];var onError=onErrorCallback||function(error){console.error(error);};if(!data){onError('TDataBaseManager.create: Data cannot be null or undefined !');}if(Array.isArray(data)){if(data.length===0){onError('TDataBaseManager.create: Array of data cannot be empty !');}dataArray=data;}else{dataArray.push(data);}this._create(dataArray,onLoadCallback,onProgressCallback,onError);},/**
       * @function
       * @memberOf TDataBaseManager.prototype
       * @description The read method allow to retrieve data from the server, using a single id or an array of them.
       *
       * @param {string|array.<string>} ids - The ids of objects to retrieve.
       * @param {function} onLoadCallback - The onLoad callback, which is call when server respond with success to the request.
       * @param {function} onProgressCallback - The onProgress callback, which is call during the response incoming.
       * @param {function} onErrorCallback - The onError callback, which is call when server respond with an error to the request.
       */read:function read(ids,onLoadCallback,onProgressCallback,onErrorCallback){var onError=onErrorCallback||function(error){console.error(error);};if(!ids){onError('TDataBaseManager.read: Ids cannot be null or undefined !');}if(Array.isArray(ids)){if(ids.length===0){onError('TDataBaseManager.read: Array of data cannot be empty !');}if(ids.length===1){this._readOne(ids[0],onLoadCallback,onProgressCallback,onError);}else{// Todo: allow to set bunch size
  var _BUNCH_SIZE=500;var idBunch=[];var id=undefined;for(var idIndex=0,numberOfIds=ids.length;idIndex<numberOfIds;idIndex++){id=ids[idIndex];idBunch.push(id);if(idBunch.length===_BUNCH_SIZE||idIndex===numberOfIds-1){this._readSome(idBunch,onLoadCallback,onProgressCallback,onError);idBunch=[];}}}}else if(typeof ids==='string'){this._readOne(ids,onLoadCallback,onProgressCallback,onError);}else{onError('TDataBaseManager.read: Expected string id or array of string id !');}},/**
       * @function
       * @memberOf TDataBaseManager.prototype
       * @description The update method allow to update data on the server, using a single id or an array of them, and a corresponding object about the data to update.
       *
       * @param {string|array.<string>} ids - The ids of objects to update.
       * @param {object} data - The update data ( need to match the related database schema ! ). In case of multiple ids they will be updated with the same given data.
       * @param {function} onLoadCallback - The onLoad callback, which is call when server respond with success to the request.
       * @param {function} onProgressCallback - The onProgress callback, which is call during the response incoming.
       * @param {function} onErrorCallback - The onError callback, which is call when server respond with an error to the request.
       */update:function update(ids,data,onLoadCallback,onProgressCallback,onErrorCallback){var onError=onErrorCallback||function(error){console.error(error);};if(!ids){onError('TDataBaseManager.update: Ids cannot be null or undefined !');}if(!data){onError('TDataBaseManager.update: Data cannot be null or undefined !');}if(Array.isArray(ids)){this._updateSome(ids,onLoadCallback,onProgressCallback,onError);}else if(typeof ids==='string'){this._updateOne(ids,onLoadCallback,onProgressCallback,onError);}else{onError('TDataBaseManager.update: Expected string id or array of string id !');}},/**
       * @function
       * @memberOf TDataBaseManager.prototype
       * @description The delete method allow to remove data from the server, using a single id or an array of them.
       *
       * @param {string|array.<string>} ids - The ids of objects to delete.
       * @param {function} onLoadCallback - The onLoad callback, which is call when server respond with success to the request.
       * @param {function} onProgressCallback - The onProgress callback, which is call during the response incoming.
       * @param {function} onErrorCallback - The onError callback, which is call when server respond with an error to the request.
       */delete:function _delete(ids,onLoadCallback,onProgressCallback,onErrorCallback){var onError=onErrorCallback||function(error){console.error(error);};if(!ids){onError('TDataBaseManager.delete: Ids data cannot be null or undefined !');}if(Array.isArray(ids)){this._deleteSome(ids,onLoadCallback,onProgressCallback,onError);}else if(typeof ids==='string'){this._deleteOne(ids,onLoadCallback,onProgressCallback,onError);}else{onError('TDataBaseManager.delete: Expected string id or array of string id !');}}});/**
   * @author [Tristan Valcke]{@link https://github.com/Itee}
   * @license [BSD-3-Clause]{@link https://opensource.org/licenses/BSD-3-Clause}
   *
   * @class TGeometriesManager
   * @classdesc Todo...
   * @example Todo...
   *
   * @requires {@link TDataBaseManager}
   * @requires '../../../node_modules/three/src/core/Geometry'
   * @requires { BufferGeometry } from 'three'
   * @requires '../../../node_modules/three/src/core/BufferAttribute'
   *
   *//**
   *
   * @constructor
   */function TGeometriesManager(){TDataBaseManager.call(this);this.basePath='/geometries';}TGeometriesManager.prototype=Object.assign(Object.create(TDataBaseManager.prototype),{constructor:TGeometriesManager,/**
               * @public
               * @memberOf TGeometriesManager.prototype
               *
               * @param jsonGeometry
               * @param onError
               * @returns {*}
               */convertJsonToGeometry:function convertJsonToGeometry(jsonGeometry,onError){var geometry=null;if(jsonGeometry.isGeometry){geometry=new Geometry();geometry.uuid=jsonGeometry.uuid;geometry.name=jsonGeometry.name;geometry.type=jsonGeometry.type;var vertices=[];var vertex=undefined;for(var index=0,numberOfVertices=jsonGeometry.vertices.length;index<numberOfVertices;++index){vertex=jsonGeometry.vertices[index];vertices.push(new Vector3(vertex.x/100,vertex.y/100,vertex.z/100));}geometry.vertices=vertices;//                geometry.colors                  = jsonGeometry.colors
  var faces=[];var face=undefined;for(var faceIndex=0,numberOfFaces=jsonGeometry.faces.length;faceIndex<numberOfFaces;faceIndex++){face=jsonGeometry.faces[faceIndex];faces.push(new Face3(face.a,face.b,face.c,face.normal,face.color,face.materialIndex));}geometry.faces=faces;//                geometry.faceVertexUvs           = [ [ Number ] ]
  geometry.morphTargets=[];geometry.morphNormals=[];geometry.skinWeights=[];geometry.skinIndices=[];geometry.lineDistances=[];//                geometry.computeBoundingBox()
  //                geometry.boundingBox.min.x       = jsonGeometry.boundingBox.min.x
  //                geometry.boundingBox.min.y       = jsonGeometry.boundingBox.min.y
  //                geometry.boundingBox.min.z       = jsonGeometry.boundingBox.min.z
  //                geometry.boundingBox.max.x       = jsonGeometry.boundingBox.max.x
  //                geometry.boundingBox.max.y       = jsonGeometry.boundingBox.max.y
  //                geometry.boundingBox.max.z       = jsonGeometry.boundingBox.max.z
  //
  //                geometry.computeBoundingSphere()
  //                geometry.boundingSphere.center.x = jsonGeometry.boundingSphere.center.x
  //                geometry.boundingSphere.center.y = jsonGeometry.boundingSphere.center.y
  //                geometry.boundingSphere.center.z = jsonGeometry.boundingSphere.center.z
  //                geometry.boundingSphere.radius                  = jsonGeometry.boundingSphere.radius
  geometry.elementsNeedUpdate=true;//jsonGeometry.elementsNeedUpdate
  geometry.verticesNeedUpdate=true;//jsonGeometry.verticesNeedUpdate
  geometry.uvsNeedUpdate=true;//jsonGeometry.uvsNeedUpdate
  geometry.normalsNeedUpdate=true;//jsonGeometry.normalsNeedUpdate
  geometry.colorsNeedUpdate=true;//jsonGeometry.colorsNeedUpdate
  geometry.lineDistancesNeedUpdate=true;//jsonGeometry.lineDistancesNeedUpdate
  geometry.groupsNeedUpdate=true;//jsonGeometry.groupsNeedUpdate
  }else if(jsonGeometry.isBufferGeometry){geometry=new BufferGeometry();geometry.uuid=jsonGeometry.uuid;geometry.name=jsonGeometry.name;geometry.type=jsonGeometry.type;//            geometry.drawRange = jsonGeometry.drawRange
  geometry.groups=jsonGeometry.groups;// Extract attributes
  var jsonGeometryAttributes=jsonGeometry.attributes;if(jsonGeometryAttributes){var attributes={};// TODO: make the other attribs or using loop over them !!
  var positionAttributes=jsonGeometryAttributes.position;if(positionAttributes){attributes['position']=new BufferAttribute(new Float32Array(positionAttributes.array),positionAttributes.itemSize,positionAttributes.normalized);}geometry.attributes=attributes;}// Extract index
  var jsonGeometryIndexes=jsonGeometry.index;if(jsonGeometryIndexes){geometry.index=new BufferAttribute(new Uint32Array(jsonGeometryIndexes.array),jsonGeometryIndexes.itemSize,jsonGeometryIndexes.normalized);}}else{onError('Unable to retrieve geometry type !!!');}geometry.computeFaceNormals();geometry.computeVertexNormals();// TCache geometry for future use
  //        this._cache.add( jsonGeometry._id, geometry )
  return geometry;}});Object.defineProperties(TGeometriesManager.prototype,{_onJson:{value:function _onJson(jsonData,onSuccess,onProgress,onError){var geometries={};if(Array.isArray(jsonData)){var data=undefined;var geometry=undefined;for(var dataIndex=0,numberOfDatas=jsonData.length;dataIndex<numberOfDatas;dataIndex++){data=jsonData[dataIndex];geometry=this.convertJsonToGeometry(data,onError);if(geometry){geometries[data._id]=geometry;}onProgress(dataIndex/numberOfDatas);}}else{geometries[jsonData._id]=this.convertJsonToGeometry(jsonData,onError);onProgress(1.0);}onSuccess(geometries);}}});/**
   * @author [Tristan Valcke]{@link https://github.com/Itee}
   * @license [BSD-3-Clause]{@link https://opensource.org/licenses/BSD-3-Clause}
   *
   * @class TScenesManager
   * @classdesc Todo...
   * @example Todo...
   * @requires TDataBaseManager
   *
   *//**
   *
   * @constructor
   */function TMaterialsManager(){TDataBaseManager.call(this);this.basePath='/materials';}TMaterialsManager.prototype=Object.assign(Object.create(TDataBaseManager.prototype),{constructor:TMaterialsManager,convertJsonToMaterial:function convertJsonToMaterial(jsonMaterial){var materialType=jsonMaterial.type;var material=undefined;switch(materialType){case'MeshPhongMaterial':{material=new MeshPhongMaterial();material.uuid=jsonMaterial.uuid;material.name=jsonMaterial.name;material.type=jsonMaterial.type;material.fog=jsonMaterial.fog;material.lights=jsonMaterial.lights;material.blending=jsonMaterial.blending;material.side=jsonMaterial.side;material.flatShading=jsonMaterial.flatShading;material.vertexColors=jsonMaterial.vertexColors;material.opacity=jsonMaterial.opacity;material.transparent=jsonMaterial.transparent;material.blendSrc=jsonMaterial.blendSrc;material.blendDst=jsonMaterial.blendDst;material.blendEquation=jsonMaterial.blendEquation;material.blendSrcAlpha=jsonMaterial.blendSrcAlpha;material.blendDstAlpha=jsonMaterial.blendDstAlpha;material.blendEquationAlpha=jsonMaterial.blendEquationAlpha;material.depthFunc=jsonMaterial.depthFunc;material.depthTest=jsonMaterial.depthTest;material.depthWrite=jsonMaterial.depthWrite;material.clippingPlanes=jsonMaterial.clippingPlanes;material.clipIntersection=jsonMaterial.clipIntersection;material.clipShadows=jsonMaterial.clipShadows;material.colorWrite=jsonMaterial.colorWrite;material.precision=jsonMaterial.precision;material.polygonOffset=jsonMaterial.polygonOffset;material.polygonOffsetFactor=jsonMaterial.polygonOffsetFactor;material.polygonOffsetUnits=jsonMaterial.polygonOffsetUnits;material.dithering=jsonMaterial.dithering;material.alphaTest=jsonMaterial.alphaTest;material.premultipliedAlpha=jsonMaterial.premultipliedAlpha;material.overdraw=jsonMaterial.overdraw;material.visible=jsonMaterial.visible;material.userData=jsonMaterial.userData;material.needsUpdate=jsonMaterial.needsUpdate;material.color=new Color$1(jsonMaterial.color.r,jsonMaterial.color.g,jsonMaterial.color.b);material.specular=new Color$1(jsonMaterial.specular.r,jsonMaterial.specular.g,jsonMaterial.specular.b);material.shininess=jsonMaterial.shininess;material.map=jsonMaterial.map;material.lightMap=jsonMaterial.lightMap;material.lightMapIntensity=jsonMaterial.lightMapIntensity;material.aoMap=jsonMaterial.aoMap;material.aoMapIntensity=jsonMaterial.aoMapIntensity;material.emissive=new Color$1(jsonMaterial.emissive.r,jsonMaterial.emissive.g,jsonMaterial.emissive.b);material.emissiveIntensity=jsonMaterial.emissiveIntensity;material.emissiveMap=jsonMaterial.emissiveMap;material.bumpMap=jsonMaterial.bumpMap;material.bumpScale=jsonMaterial.bumpScale;material.normalMap=jsonMaterial.normalMap;material.normalScale=jsonMaterial.normalScale;material.displacementMap=jsonMaterial.displacementMap;material.displacementScale=jsonMaterial.displacementScale;material.displacementBias=jsonMaterial.displacementBias;material.specularMap=jsonMaterial.specularMap;material.alphaMap=jsonMaterial.alphaMap;material.envMap=jsonMaterial.alphaMap;material.combine=jsonMaterial.combine;material.reflectivity=jsonMaterial.reflectivity;material.refractionRatio=jsonMaterial.refractionRatio;material.wireframe=jsonMaterial.wireframe;material.wireframeLinewidth=jsonMaterial.wireframeLinewidth;material.wireframeLinecap=jsonMaterial.wireframeLinecap;material.wireframeLinejoin=jsonMaterial.wireframeLinejoin;material.skinning=jsonMaterial.skinning;material.morphTargets=jsonMaterial.morphTargets;material.morphNormals=jsonMaterial.morphNormals;}break;case'LineBasicMaterial':{material=new LineBasicMaterial$1();material.uuid=jsonMaterial.uuid;material.name=jsonMaterial.name;material.type=jsonMaterial.type;material.color=new Color$1(jsonMaterial.color.r,jsonMaterial.color.g,jsonMaterial.color.b);}break;default:console.error('Unknown material type !');break;}return material;}});Object.defineProperties(TMaterialsManager.prototype,{_onJson:{value:function _onJson(jsonData,onSuccess,onProgress,onError){var materials={};if(Array.isArray(jsonData)){var data=undefined;var material=undefined;for(var dataIndex=0,numberOfDatas=jsonData.length;dataIndex<numberOfDatas;dataIndex++){data=jsonData[dataIndex];material=this.convertJsonToMaterial(data,onError);if(material){materials[data._id]=material;}onProgress(dataIndex/numberOfDatas);}}else{materials[jsonData._id]=this.convertJsonToMaterial(jsonData,onError);onProgress(1.0);}onSuccess(materials);}}});/**
   * @author [Tristan Valcke]{@link https://github.com/Itee}
   * @license [BSD-3-Clause]{@link https://opensource.org/licenses/BSD-3-Clause}
   *
   * @class TScenesManager
   * @classdesc Todo...
   * @example Todo...
   *
   *//**
   *
   * @constructor
   */function TObjectsManager(){TDataBaseManager.call(this);this.basePath='/objects';}TObjectsManager.prototype=Object.assign(Object.create(TDataBaseManager.prototype),{constructor:TObjectsManager,convertJsonToObject3D:function convertJsonToObject3D(jsonData,onError){// Todo factory
  var data=jsonData;var objectType=data.type;if(objectType==='Object3D'){var object3d=new Object3D();object3d.uuid=data.uuid;object3d.name=data.name;object3d.type=data.type;object3d.parent=data.parent;object3d.children=[];object3d.up.x=data.up.x;object3d.up.y=data.up.y;object3d.up.z=data.up.z;object3d.position.x=data.position.x;object3d.position.y=data.position.y;object3d.position.z=data.position.z;object3d.rotation.x=data.rotation.x;object3d.rotation.y=data.rotation.y;object3d.rotation.z=data.rotation.z;object3d.rotation.order=data.rotation.order;object3d.quaternion.x=data.quaternion.x;object3d.quaternion.y=data.quaternion.y;object3d.quaternion.z=data.quaternion.z;object3d.quaternion.w=data.quaternion.w;object3d.scale.x=data.scale.x;object3d.scale.y=data.scale.y;object3d.scale.z=data.scale.z;object3d.modelViewMatrix.fromArray(data.modelViewMatrix);object3d.normalMatrix.fromArray(data.normalMatrix);object3d.matrix.fromArray(data.matrix);object3d.matrixWorld.fromArray(data.matrixWorld);object3d.matrixAutoUpdate=data.matrixAutoUpdate;object3d.matrixWorldNeedsUpdate=data.matrixWorldNeedsUpdate;object3d.layers.mask=data.layers;object3d.visible=data.visible;object3d.castShadow=data.castShadow;object3d.receiveShadow=data.receiveShadow;object3d.frustumCulled=data.frustumCulled;object3d.renderOrder=data.renderOrder;object3d.userData=data.userData;return object3d;}else if(objectType==='LineSegments'){var segment=new LineSegments();segment.uuid=data.uuid;segment.name=data.name;segment.type=data.type;segment.parent=null;//data.parent
  segment.children=data.children;segment.up.x=data.up.x;segment.up.y=data.up.y;segment.up.z=data.up.z;segment.position.x=data.position.x;segment.position.y=data.position.y;segment.position.z=data.position.z;segment.rotation.x=data.rotation.x;segment.rotation.y=data.rotation.y;segment.rotation.z=data.rotation.z;segment.rotation.order=data.rotation.order;segment.quaternion.x=data.quaternion.x;segment.quaternion.y=data.quaternion.y;segment.quaternion.z=data.quaternion.z;segment.quaternion.w=data.quaternion.w;segment.scale.x=data.scale.x;segment.scale.y=data.scale.y;segment.scale.z=data.scale.z;segment.modelViewMatrix.fromArray(data.modelViewMatrix);segment.normalMatrix.fromArray(data.normalMatrix);segment.matrix.fromArray(data.matrix);segment.matrixWorld.fromArray(data.matrixWorld);segment.matrixAutoUpdate=data.matrixAutoUpdate;segment.matrixWorldNeedsUpdate=data.matrixWorldNeedsUpdate;segment.layers.mask=data.layers;segment.visible=data.visible;segment.castShadow=data.castShadow;segment.receiveShadow=data.receiveShadow;segment.frustumCulled=data.frustumCulled;segment.renderOrder=data.renderOrder;segment.userData=data.userData||{};segment.geometry=data.geometry;segment.material=data.material;// Required for carl source
  segment.userData['id']=data._id;return mesh;}else if(objectType==='Mesh'){var mesh=new Mesh();mesh.uuid=data.uuid;mesh.name=data.name;mesh.type=data.type;mesh.parent=null;//data.parent
  mesh.children=data.children;mesh.up.x=data.up.x;mesh.up.y=data.up.y;mesh.up.z=data.up.z;mesh.position.x=data.position.x;mesh.position.y=data.position.y;mesh.position.z=data.position.z;mesh.rotation.x=data.rotation.x;mesh.rotation.y=data.rotation.y;mesh.rotation.z=data.rotation.z;mesh.rotation.order=data.rotation.order;mesh.quaternion.x=data.quaternion.x;mesh.quaternion.y=data.quaternion.y;mesh.quaternion.z=data.quaternion.z;mesh.quaternion.w=data.quaternion.w;mesh.scale.x=data.scale.x;mesh.scale.y=data.scale.y;mesh.scale.z=data.scale.z;mesh.modelViewMatrix.fromArray(data.modelViewMatrix);mesh.normalMatrix.fromArray(data.normalMatrix);mesh.matrix.fromArray(data.matrix);mesh.matrixWorld.fromArray(data.matrixWorld);mesh.matrixAutoUpdate=data.matrixAutoUpdate;mesh.matrixWorldNeedsUpdate=data.matrixWorldNeedsUpdate;mesh.layers.mask=data.layers;mesh.visible=data.visible;mesh.castShadow=data.castShadow;mesh.receiveShadow=data.receiveShadow;mesh.frustumCulled=data.frustumCulled;mesh.renderOrder=data.renderOrder;mesh.userData=data.userData||{};mesh.geometry=data.geometry;mesh.material=data.material;// Required for carl source
  mesh.userData['id']=jsonData._id;return mesh;//            //            mesh.geometry = self.convertJsonToGeometry( data.geometry )
  //            //            mesh.material = self.convertJsonToMaterial( data.material )
  //
  //            var haveGeometry = false
  //            self.retrieveGeometryFor( mesh, data.geometry, function ( geometry ) {
  //
  //                mesh.geometry = geometry
  //                haveGeometry  = true
  //
  //                if ( !haveGeometry || !haveMaterial ) { return }
  //
  //                callback( mesh )
  //
  //            } )
  //
  //            var haveMaterial = false
  //            self.retrieveMaterialFor( mesh, data.material, function ( materials ) {
  //
  //                mesh.material = materials
  //                haveMaterial  = true
  //
  //                if ( !haveGeometry || !haveMaterial ) { return }
  //
  //                callback( mesh )
  //
  //            } )
  }else{onError("Non managed object type: "+objectType);}}});Object.defineProperties(TObjectsManager.prototype,{_onJson:{value:function _onJson(jsonData,onSuccess,onProgress,onError){if(Array.isArray(jsonData)){var objects=[];var object=undefined;var data=undefined;for(var dataIndex=0,numberOfDatas=jsonData.length;dataIndex<numberOfDatas;dataIndex++){data=jsonData[dataIndex];object=this.convertJsonToObject3D(data,onError);if(object){objects.push(object);}onProgress(dataIndex/numberOfDatas);}onSuccess(objects);}else{var _object=this.convertJsonToObject3D(jsonData,onError);onProgress(1.0);onSuccess(_object);}}}});/**
   * @author [Tristan Valcke]{@link https://github.com/Itee}
   * @license [BSD-3-Clause]{@link https://opensource.org/licenses/BSD-3-Clause}
   *
   * @class TPointsManager
   * @classdesc The TPointsManager allow to get and dump, in a webglviewport, cloud data retrieve from Itee server
   * @example Todo
   *
   *//* eslint-env browser *//* eslint no-unused-vars: warn *//* global $ *//**
   *
   * @param viewport
   * @constructor
   */function TPointsManager(viewport){if(!viewport){throw new Error('Unable to create point cloud manager for null or undefined viewport !');}this._pointCloudsDataMap=new Map();this._cameraDistanceMax=10.0;this._cameraDistanceMin=1.0;this._samplingMax=100;this._samplingMin=0.0;this._viewport=viewport;this._globalOffset={x:0,y:0,z:0};this._pointCloudGroup=new Group();this._pointCloudGroup.name='PointClouds';this._viewport.scene.add(this._pointCloudGroup);}Object.assign(TPointsManager,{});Object.assign(TPointsManager.prototype,{setGlobalOffset:function setGlobalOffset(globalOffset){this._globalOffset=globalOffset;},setMinimumSamplingLimit:function setMinimumSamplingLimit(sampling){this._samplingMin=sampling;},setMaximumSamplingLimit:function setMaximumSamplingLimit(sampling){this._samplingMax=sampling;},/**
           *
           */getPointClouds:function getPointClouds(onSuccess){var self=this;$.ajax({type:'GET',url:'/worldcells/',dataType:'json',cache:false,success:function success(worldCells){if(!worldCells||worldCells.length===0){console.warn('Unable to find world cells !');return;}// Create the main point cloud data tree
  self.createPointCloudDataMap(worldCells);onSuccess();},error:function error(jqXHR,textStatus,errorThrown){console.log('ERRORS: '+textStatus);}});},createPointCloudDataMap:function createPointCloudDataMap(worldCells){var cell=undefined;for(var cellIndex=0,numberOfCells=worldCells.length;cellIndex<numberOfCells;cellIndex++){cell=worldCells[cellIndex];var pointClouds=cell.cubeDataPoint;var pointCloud=undefined;var pointCloudId=undefined;for(var pointCloudIndex=0,numberOfPointClouds=pointClouds.length;pointCloudIndex<numberOfPointClouds;pointCloudIndex++){pointCloud=pointClouds[pointCloudIndex];pointCloudId=pointCloud.id;this._pointCloudsDataMap.set(pointCloudId,{id:pointCloudId,parentCellId:cell.id,coordinates:{x:pointCloud.coordinates.x+cell.lambertCoordinates.x,y:pointCloud.coordinates.y+cell.lambertCoordinates.y,z:pointCloud.coordinates.z+cell.lambertCoordinates.z},sampling:0.0,previousSampling:0.0,needIncrease:false,// Only if sampling grows
  needDecrease:false// Only if sampling decrease
  });}}},updatePointClouds:function updatePointClouds(cameraWorldPosition){var cloudIdsToIncreaseData=[];var cloudIdsToDecreaseData=[];this._pointCloudsDataMap.forEach(function(pointCloud){this.updatePointCloudSampling(pointCloud,cameraWorldPosition);if(pointCloud.needIncrease){cloudIdsToIncreaseData.push(pointCloud.id);}else if(pointCloud.needDecrease){cloudIdsToDecreaseData.push(pointCloud.id);}else{// nothings
  }}.bind(this));this.increasePointCloudData(cloudIdsToIncreaseData);this.decreasePointCloudData(cloudIdsToDecreaseData);},updatePointCloudSampling:function updatePointCloudSampling(pointCloud,cameraWorldPosition){var pointCloudWorldCoordinates={x:pointCloud.coordinates.x-this._globalOffset.x,y:pointCloud.coordinates.z-this._globalOffset.z,z:-(pointCloud.coordinates.y-this._globalOffset.y)// TODO: Could be only power of two instead of a Sqrt !!!
  };var distanceToCamera=Math.sqrt(Math.pow(pointCloudWorldCoordinates.x-cameraWorldPosition.x,2)+Math.pow(pointCloudWorldCoordinates.y-cameraWorldPosition.y,2)+Math.pow(pointCloudWorldCoordinates.z-cameraWorldPosition.z,2));var sampling=this.getSamplingForDistanceToCamera(distanceToCamera);if(sampling>pointCloud.sampling){pointCloud.needIncrease=true;pointCloud.needDecrease=false;}else if(sampling<pointCloud.sampling){pointCloud.needIncrease=false;pointCloud.needDecrease=true;}else{pointCloud.needIncrease=false;pointCloud.needDecrease=false;}pointCloud.previousSampling=pointCloud.sampling;pointCloud.sampling=sampling;},/**
           *
           * @param distanceToCamera
           * @returns {number}
           */getSamplingForDistanceToCamera:function getSamplingForDistanceToCamera(distanceToCamera){// If camera is out limits set default value
  if(distanceToCamera<this._cameraDistanceMin){return this._samplingMax;}if(distanceToCamera>this._cameraDistanceMax){return this._samplingMin;}//        var result = (-10 * distanceToCamera) + 100
  var result=100/Math.pow(distanceToCamera,2);// Round at 2 digit
  var sampling=Math.round(result*100)/100;// Limits sampling in case where function return value outer limits
  if(sampling<this._samplingMin){sampling=this._samplingMin;}if(sampling>this._samplingMax){sampling=this._samplingMax;}return sampling;},increasePointCloudData:function increasePointCloudData(cloudIds){if(cloudIds.length===0){return;}console.log('numberOfBuffers to increase: '+cloudIds.length);var self=this;var url='/pointclouds/';var samplingTable=this.createSamplingTable(cloudIds);var jsonData=strMapToJson(samplingTable);//        this.requestDataBuffer( url, samplingTable, callback )
  var request=new XMLHttpRequest();request.responseType='arraybuffer';request.onload=onLoad;request.open('POST',url,true);request.setRequestHeader('Content-Type','application/json');request.send(jsonData);function onLoad(data){var arrayBuffer=data.target.response;if(arrayBuffer.byteLength<=4){return;}var buffer=new DataView(arrayBuffer);var numberOfBuffers=buffer.getUint32(0);if(numberOfBuffers===0){return;}//            console.log( 'numberOfBuffers to extract: ' + numberOfBuffers )
  var NUMBER_OF_BUFFER_VALUE_BYTES_LENGTH=4;// UInt32
  var SIZES_OF_BUFFER_ARRAY_BYTES_LENGTH=numberOfBuffers*4;// UInt32
  var dataOffset=NUMBER_OF_BUFFER_VALUE_BYTES_LENGTH+SIZES_OF_BUFFER_ARRAY_BYTES_LENGTH;var bufferLength=0;var byteArray=undefined;for(var bufferIndex=4;bufferIndex<=SIZES_OF_BUFFER_ARRAY_BYTES_LENGTH;bufferIndex+=4){bufferLength=buffer.getUint32(bufferIndex);byteArray=new Uint8Array(arrayBuffer,dataOffset,bufferLength);self.addPointsFromBuffer(byteArray);dataOffset+=bufferLength;}}function strMapToJson(strMap){return JSON.stringify(strMapToObj(strMap));}function strMapToObj(strMap){var obj=Object.create(null);strMap.forEach(function(value,key){obj[key]=value;});return obj;}},decreasePointCloudData:function decreasePointCloudData(cloudIds){if(cloudIds.length===0){return;}console.log('numberOfBuffers to decrease: '+cloudIds.length);var self=this;console.log("Number of children (base): "+self._pointCloudGroup.children.length);cloudIds.forEach(function(cloudId){var pointCloud3D=self._pointCloudGroup.getObjectByName(cloudId);if(!pointCloud3D){return;}// Get sampling delta to apply
  var pointCloud=self._pointCloudsDataMap.get(cloudId);var sampling=pointCloud.sampling;var previousSampling=pointCloud.previousSampling;var positionBufferAttribute=pointCloud3D.geometry.getAttribute('position');var colorBufferAttribute=pointCloud3D.geometry.getAttribute('color');// Apply delta sampling to 3d object geometry
  var numberOfPoints=positionBufferAttribute.count;if(numberOfPoints===0){return;}// If already empty return
  var numberOfRestPoints=Math.round(numberOfPoints*sampling/previousSampling);var positionSlicedArray=positionBufferAttribute.array.slice(0,numberOfRestPoints*3);positionBufferAttribute.setArray(positionSlicedArray);positionBufferAttribute.needsUpdate=true;var colorSlicedArray=colorBufferAttribute.array.slice(0,numberOfRestPoints*3);colorBufferAttribute.setArray(colorSlicedArray);colorBufferAttribute.needsUpdate=true;});},createSamplingTable:function createSamplingTable(cloudIds){var samplingTable=new Map();var sampling=undefined;cloudIds.forEach(function(cloudId){sampling=this._pointCloudsDataMap.get(cloudId).sampling;samplingTable.set(cloudId,sampling);}.bind(this));return samplingTable;},requestDataBuffer:function requestDataBuffer(url,dataToSend,cloud){var self=this;var oReq=new XMLHttpRequest();oReq.open('POST',url,true);oReq.setRequestHeader('Content-Type','application/json');oReq.responseType='arraybuffer';oReq.onload=function(oEvent){var arrayBuffer=oEvent.target.response;if(arrayBuffer.byteLength<=4){return;}var buffer=new DataView(arrayBuffer);var numberOfBuffers=buffer.getUint32(0);if(numberOfBuffers===0){return;}console.log('numberOfBuffers to extract: '+numberOfBuffers);var NUMBER_OF_BUFFER_VALUE_BYTES_LENGTH=4;// UInt32
  var SIZES_OF_BUFFER_ARRAY_BYTES_LENGTH=numberOfBuffers*4;// UInt32
  var dataOffset=NUMBER_OF_BUFFER_VALUE_BYTES_LENGTH+SIZES_OF_BUFFER_ARRAY_BYTES_LENGTH;var bufferLength=0;var byteArray=undefined;for(var bufferIndex=4;bufferIndex<=SIZES_OF_BUFFER_ARRAY_BYTES_LENGTH;bufferIndex+=4){bufferLength=buffer.getUint32(bufferIndex);byteArray=new Uint8Array(arrayBuffer,dataOffset,bufferLength);self.addPointsFromBuffer(byteArray,cloud);dataOffset+=bufferLength;}};oReq.send(JSON.stringify(dataToSend));},/**
           *
           * @param boundingBox
           * @param dataBuffer
           */addPointsFromBuffer:function addPointsFromBuffer(dataBuffer){if(!dataBuffer){console.error('No cube data to add on gpu !');return;}var CUBE_ID_BYTES_LENGTH=24;var cloudPointId='';for(var charIndex=0;charIndex<CUBE_ID_BYTES_LENGTH;++charIndex){cloudPointId+=String.fromCharCode(dataBuffer[charIndex]);}var CUBE_POSITION_BYTES_LENGTH=3;var HEADER_SIZE=CUBE_ID_BYTES_LENGTH+CUBE_POSITION_BYTES_LENGTH;var POINT_POSITION_BYTES_LENGTH=3;var POINT_COLOR_BYTES_LENGTH=3;var POINT_DATA_BYTES_LENGTH=POINT_POSITION_BYTES_LENGTH+POINT_COLOR_BYTES_LENGTH;var bufferSize=dataBuffer.length;var numberOfPoint=(bufferSize-HEADER_SIZE)/POINT_DATA_BYTES_LENGTH;var positions=new Float32Array(numberOfPoint*POINT_POSITION_BYTES_LENGTH);var colors=new Float32Array(numberOfPoint*POINT_COLOR_BYTES_LENGTH);var pointCloudData=this._pointCloudsDataMap.get(cloudPointId);var pointCloudCoordinates=pointCloudData.coordinates;var bufferIndex=0;var bufferDataIndex=HEADER_SIZE;for(var i=0;i<numberOfPoint;i++){// positions
  positions[bufferIndex]=dataBuffer[bufferDataIndex]/1000+pointCloudCoordinates.x-this._globalOffset.x;positions[bufferIndex+1]=dataBuffer[bufferDataIndex+1]/1000+pointCloudCoordinates.y-this._globalOffset.y;positions[bufferIndex+2]=dataBuffer[bufferDataIndex+2]/1000+pointCloudCoordinates.z-this._globalOffset.z;// colors
  colors[bufferIndex]=dataBuffer[bufferDataIndex+3]/255;colors[bufferIndex+1]=dataBuffer[bufferDataIndex+4]/255;colors[bufferIndex+2]=dataBuffer[bufferDataIndex+5]/255;bufferIndex+=3;bufferDataIndex+=6;}// If object already exist update it else create
  var pointCloud=this._pointCloudGroup.getObjectByName(cloudPointId);if(pointCloud){var positionBufferAttribute=pointCloud.geometry.getAttribute('position');positionBufferAttribute.setArray(positions);positionBufferAttribute.needsUpdate=true;var colorBufferAttribute=pointCloud.geometry.getAttribute('color');colorBufferAttribute.setArray(colors);colorBufferAttribute.needsUpdate=true;}else{var positionBufferAttribute=new BufferAttribute(positions,3);var colorBufferAttribute=new BufferAttribute(colors,3);var geometry=new BufferGeometry();geometry.addAttribute('position',positionBufferAttribute);geometry.addAttribute('color',colorBufferAttribute);var material=new PointsMaterial({size:0.005,vertexColors:true});var particleSystem=new Points(geometry,material);particleSystem.name=cloudPointId;particleSystem.rotation.x-=Math.PI/2;//convert obj [y forward / z up] as [-z forward / y up]
  this._pointCloudGroup.add(particleSystem);}}});/**
   * @author [Tristan Valcke]{@link https://github.com/Itee}
   * @license [BSD-3-Clause]{@link https://opensource.org/licenses/BSD-3-Clause}
   *
   *
   * @class TScenesManager
   * @classdesc Todo...
   * @example Todo...
   *
   * @requires TDataBaseManager
   *
   *//**
   *
   * @constructor
   */function TScenesManager(){TDataBaseManager.call(this);this.basePath='/scenes';}TScenesManager.prototype=Object.assign(Object.create(TDataBaseManager.prototype),{constructor:TScenesManager});Object.defineProperties(TScenesManager.prototype,{_onJson:{value:function _onJson(jsonData,onSuccess,onProgress,onError){onSuccess(jsonData);}}});/**
   * @author [Tristan Valcke]{@link https://github.com/Itee}
   * @license [BSD-3-Clause]{@link https://opensource.org/licenses/BSD-3-Clause}
   *
   * @file Intermediary export file for managers/databases folder
   *
   *///export { MeshManager } from './MeshManager' // Todo: Remove when merged in TObjectsManager
  /**
   * @author [Tristan Valcke]{@link https://github.com/Itee}
   * @license [BSD-3-Clause]{@link https://opensource.org/licenses/BSD-3-Clause}
   *
   * @class TApplication
   * @classdesc The TApplication is the base Itee application, it will load the required environement and start the dialog with the Itee server.
   * @example Todo...
   *
   *//* eslint-env browser *//* global $, H, URL *///import { SplitModifier } from '../../build/tmp/SplitModifier'
  //TMP
  var imageLoader=new ImageLoader();var RAD_TO_DEG_PI=180/Math.PI;// Usefull for shot updates
  var frustum=new Frustum();var cameraViewProjectionMatrix=new Matrix4();var OFFSET_CORRECTOR={x:0.48,y:0.31};var LAMBERT_NORD_OFFSET={x:600200,y:131400,z:60// Camera position =>
  // x: -0.0007484443485736847
  // y: 10.24522892416233
  // z: -0.000806964111538799
  // 651543.533,6864982.935
  };var LAMBERT_NINETY_THREE_OFFSET={x:651543.533,y:6864982.935};function convertWebglVectorToTopologicVector(vector){return new Vector3$1(vector.x,-vector.z,vector.y);}function convertWebGLCoordinatesToLambert93Coordinates(coordinates){return new Vector3$1(coordinates.x+LAMBERT_NINETY_THREE_OFFSET.x+OFFSET_CORRECTOR.x,-coordinates.z+LAMBERT_NINETY_THREE_OFFSET.y+OFFSET_CORRECTOR.y,coordinates.y);}function convertLambert93CoordinatesToWebGLCoordinates(coordinates){return new Vector3$1(coordinates.x-LAMBERT_NINETY_THREE_OFFSET.x-OFFSET_CORRECTOR.x,0,-(coordinates.y-LAMBERT_NINETY_THREE_OFFSET.y-OFFSET_CORRECTOR.y));}//
  function convertWebGLRotationToTopologicalYawPitch(vectorDir){function getYaw(vector){return Math.atan2(vector.y,vector.x);}function getPitch(vector){return Math.asin(vector.z);}function radiansToDegrees(radians){return radians*RAD_TO_DEG_PI;}var topoVectorDir=convertWebglVectorToTopologicVector(vectorDir);return{yaw:-(radiansToDegrees(getYaw(topoVectorDir))-90),pitch:radiansToDegrees(getPitch(topoVectorDir))};}function createInterval(particles,path,interval){var globalOffset=0;setInterval(function(){var moveOffset=0.1;var DELTA_BETWEEN_PARTICLE=1;// meter
  if(globalOffset>=DELTA_BETWEEN_PARTICLE){globalOffset=0;}else if(globalOffset+moveOffset>DELTA_BETWEEN_PARTICLE){// Avoid final gap jump before new "loop"
  globalOffset=DELTA_BETWEEN_PARTICLE;}else{globalOffset+=moveOffset;}var pathLength=path.getLength();var localOffset=globalOffset;var normalizedOffset=undefined;var particle=undefined;var newPosition=undefined;for(var i=0,numberOfParticles=particles.children.length;i<numberOfParticles;i++){particle=particles.children[i];normalizedOffset=localOffset/pathLength;// End of path ( last particle could go to void, but got an error with getPointAt)
  if(normalizedOffset>1){normalizedOffset=0;}newPosition=path.getPointAt(normalizedOffset);newPosition.y+=0.1;particle.position.copy(newPosition);localOffset+=DELTA_BETWEEN_PARTICLE;}},interval);}/**
   *
   * @param container
   * @param parameters
   * @param onReady
   * @constructor
   */function TApplication(container,parameters,onReady){if(!container){console.error("Undefined or null container:"+container);return;}if(!parameters){console.error("Undefined or null parameters:"+parameters);return;}if(!onReady){console.error("Undefined or null onReady:"+onReady);return;}console.time("TApplication");console.log("Starting TApplication...");var self=this;var _parameters={gui:{orientation:'vertical',limit:100,position:'50%'// if there is no percentage it interpret it as pixels
  },webGLEnable:true,webGL:{camera:null,modelEnable:true,model:{files:[],textureResolution:'',allowGround:true},tigerEnable:false,tiger:{},caimanEnable:false,caiman:{},cloudPointEnable:false,cloudPoint:{},pathEnable:false,path:{},shotsEnable:false,shots:{},avatarEnable:false,avatarParams:{}// Recursive merging parameter
  }};extend(_parameters,parameters);this.viewer='';this.previousImageShot=undefined;this.thumbnailPanel=document.getElementById('thumbnailPanel');this.dataPanel=document.getElementById('dataPanel');this.universalLoader=new TUniversalLoader();this.meshManager=undefined;this.meshManagerPathResolutionMap=[{min:15,max:Infinity,value:0},{min:5,max:15,value:256},{min:0,max:5,value:4096}];this.meshManagerOrbitalResolutionMap=[{min:30,max:Infinity,value:0},{min:20,max:30,value:256},{min:10,max:20,value:1024},{min:5,max:10,value:2048},{min:0,max:5,value:4096}];this.updateMeshTimeout=undefined;this.pointCloudManager=undefined;this.updatePointCloudTimeout=undefined;function _initGUI(parameters){var _parameters=parameters||{toolbar:null,content:null,viewport:{type:'webgl',options:{effect:['anaglyph','etc']}},tools:null,modals:null};_initToolBar.call(self,_parameters);_initContent.call(self,_parameters);_initWebGLViewport.call(self,_parameters);_initTools.call(self,_parameters);_initModals.call(self,_parameters);// Init modals
  function _initToolBar(parameters){var _this=this;$('#importBtn').on("click",function(event){self.popupImportFilesModal.call(self);});this.toggleXRay=false;$("#xRayBtn").on("click",function(event){self.toggleXRay=!self.toggleXRay;self.changeMaterialSide.call(self,self.webglViewport.scene.children,self.toggleXRay);});$("#selectBtn").on("click",function(event){self.webglViewport.isRaycastable=!self.webglViewport.isRaycastable;});$('#cameraMode').find('li').on('click',function(event){var cameraMode=$(_this).find('a').attr('data-value');self.setCameraMode.call(self,cameraMode);});$('#renderEffectDropDown').find('li').on('click',function(event){var renderEffect=$(_this).find('a').attr('data-value');self.setRendersEffect.call(self,renderEffect);});this.detailBtn=$("#detailBtn");this.detailBtn.on("click",function(event){var carlId=event.currentTarget.value.slice(0,-4).toUpperCase();getBoxDetail(carlId);//                parent.postMessage( `GISDetailAction#-#${carlId};com.carl.xnet.equipment.backend.bean.BoxBean#+#`, '*' )
  });this.createBtn=$("#createBtn");this.createBtn.on("click",function(event){var carlId=event.currentTarget.value.slice(0,-4).toUpperCase();parent.postMessage('CREATE_WO#-#'+carlId+';com.carl.xnet.equipment.backend.bean.BoxBean#+#','*');});}function _initContent(parameters){// Docking view
  // Convert a div to a dock manager.  Panels can then be docked on to it
  this.mainContainer=new dockspawn.DockManager(container);this.mainContainer.initialize();window.addEventListener('resize',function(){// Important: need to reset the mainContainer size else DockManager will get false dimension
  self.mainContainer.element.style.width='100%';self.mainContainer.element.style.height='100%';self.mainContainer.invalidate();},true);// Convert existing elements on the page into "Panels".
  // They can then be docked on to the dock manager
  // Panels get a titlebar and a close button, and can also be
  // converted to a floating dialog box which can be dragged / resized
  this.treeView=new dockspawn.PanelContainer(document.getElementById("treeViewContainer"),this.mainContainer,'Projet');this.webglViewportDockContainer=new dockspawn.PanelContainer(document.getElementById("webglViewportContainer"),this.mainContainer,'Maquette');// Dock the panels on the dock manager
  var documentNode=this.mainContainer.context.model.documentManagerNode;var solutionNode=this.mainContainer.dockLeft(documentNode,this.treeView,0.20);var outlineNode=this.mainContainer.dockFill(documentNode,this.webglViewportDockContainer);}function _initWebGLViewport(parameters){parameters=parameters||{};this.webglViewportContainer=document.getElementById('webglViewportContainer');this.webglViewport=new TWebGLViewport(this.webglViewportContainer);this.webglViewportContainer.addEventListener('panelResize',this.webglViewport.updateSizes.bind(this.webglViewport));//        this.webglViewport.toggleAutorun()
  var camera=parameters.camera;if(camera){var cameraPosition=camera.position;if(cameraPosition){this.webglViewport.camera.position.set(cameraPosition.x,cameraPosition.y,cameraPosition.z);}var cameraTarget=camera.target;if(cameraTarget){var target=new Vector3$1(cameraTarget.x,cameraTarget.y,cameraTarget.z);this.webglViewport.camera.lookAt(target);this.webglViewport.cameraControl.target=target;}}this.webglViewport.scene.add(new AmbientLight(0x999999,0.8));this.progressBar=$('#progressBar .progress-bar');this.progressBar.parent().css("display","none");}function _initTools(parameters){// Measure Tool
  this.measureTools=$('#measureTools').find('li');this.measureTools.on('click',function(event){var selectedTool=$(this).find('a').attr('data-value');self.startMeasure(selectedTool);self.webglViewport.isRaycastable=selectedTool!=="clear";});this.measureMode=undefined;this.measureCounter=0;this.currentMeasureGroup=undefined;// Split Tool
  //        this.globalPlane = new SplitModifier( 100 );
  //            this.splitToolButton = document.getElementById( 'splitBtn' )
  //            if ( this.splitToolButton !== null && this.splitToolButton !== undefined ) {
  //
  //                this.globalPlane = new TSplitModifier( 400, 400, 1, 1 )
  //
  //                this.splitToolToggle      = false;
  //                this.spliterSliderControl = new Slider( "#spliterSliderControl", {
  //                    reversed:         true,
  //                    min:              -50,
  //                    max:              85,
  //                    value:            0,
  //                    orientation:      'vertical',
  //                    tooltip_position: 'left',
  //                    precision:        2
  //                } );
  //                this.spliterSliderControl.on( "slide", function ( sliderValue ) {
  //
  //                    self.globalPlane.position.y = sliderValue;
  //
  //                } );
  //
  //                self.spliterSliderControl.$sliderElem[ 0 ].style.display = 'none';
  //
  //                this.splitToolButton.onclick = function ( event ) {
  //
  //                    this.splitter      = new TSplitModifier( 400 )
  //                    this.splitter.name = "TheSplitter"
  //
  //                    this.splitterControl = new TransformControls( this.webglViewport.camera, this.webglViewport.webGLRenderer.domElement );
  //                    this.splitterControl.addEventListener( 'objectChange', this.splitter.update.bind( this.splitter ) );
  //                    this.splitterControl.addEventListener( 'change', this.webglViewport.update.bind( this.webglViewport ) );
  //
  //                    this.splitterControl.attach( this.splitter );
  //                    this.webglViewport.scene.add( this.splitterControl );
  //
  //                    let splittedChildren = []
  //                    let nonMeshChildren  = []
  //                    const baseChildren   = this.webglViewport.scene.children
  //                    for ( let i = 0, numChild = baseChildren.length ; i < numChild ; i++ ) {
  //                        let child = baseChildren[ i ]
  //
  //                        var objectType = child.type
  //                        if ( objectType !== 'Group' && objectType !== 'Mesh' ) {
  //                            nonMeshChildren.push( child )
  //                            continue
  //                        }
  //
  //                        splittedChildren.push( this.splitter.add( child ) )
  //
  //                    }
  //
  //                    this.webglViewport.scene.children = []
  //                    this.webglViewport.scene.add( nonMeshChildren )
  //                    this.webglViewport.scene.add( splittedChildren )
  //                    this.webglViewport.scene.add( this.splitter )
  //
  //                }.bind( this )
  //
  //            } else {
  //
  //                console.error( 'split button does not exist !' );
  //
  //            }
  // OR
  this.globalPlane=new Plane(new Vector3$1(0,-1,0),0.8);this.splitToolButton=document.getElementById('splitBtn');if(this.splitToolButton!==null&&this.splitToolButton!==undefined){this.splitToolToggle=false;this.spliterSliderControl=new Slider("#spliterSliderControl",{reversed:true,min:-50,max:85,value:0,orientation:'vertical',tooltip_position:'left',precision:2});this.spliterSliderControl.on("slide",function(sliderValue){//                self.globalPlane.position.y = sliderValue / 10;
  self.globalPlane.constant=sliderValue;});self.spliterSliderControl.$sliderElem[0].style.display='none';this.splitToolButton.onclick=function(event){self.splitToolToggle=!self.splitToolToggle;self.spliterSliderControl.$sliderElem[0].style.display=self.splitToolToggle?'block':'none';self.globalPlane.visible=self.splitToolToggle;self.webglViewport.renderer.clippingPlanes=self.splitToolToggle?[self.globalPlane]:[];//OR
  //                if( self.splitToolToggle ) {
  //
  //                    var group = self.webglViewport.scene.getObjectByName( 'MeshesGroup' )
  //                    if ( ! group ) return;
  //
  //                    self.webglViewport.scene.remove( group );
  //
  //                    var splittedGroup = self.globalPlane.add( group )
  //                    self.webglViewport.scene.add( splittedGroup )
  //
  //                } else {
  //
  //
  //
  //                }
  event.preventDefault();};}else{console.error('split button does not exist !');}}function _initModals(parameters){this.importFilesModalView=$('#importFilesModal');this.importFilesModalView.modal({keyboard:false,show:false});this.validateImportFilesModal=$('#validateImportFilesModal');this.validateImportFilesModal.on("click",function(){var importInput=$("#importInput");var files=importInput[0].files;var numberOfFiles=files.length;console.log("numberOfFiles: "+numberOfFiles);var filesUrls=[];var fileUrl='';var fileIndex=undefined;var fileObject=undefined;for(fileIndex=0;fileIndex<numberOfFiles;++fileIndex){fileObject=files[fileIndex];fileUrl=URL.createObjectURL(fileObject)+'/'+fileObject.name;filesUrls.push({url:fileUrl});}self.loadObjectFromURL(filesUrls);});this.imageShotModalView=$('#imageShotModal');this.imageShotModalView.modal({keyboard:false,show:false});this.selectedObjectModalView=$('#selectedObjectModal');this.selectedObjectModalView.modal({keyboard:false,show:false});}}var _modelReady=false;function _initModelData(parameters){var _parameters=parameters||{companiesIds:null,sitesIds:null,buildingsIds:null,scenesIds:null,objectsIds:null,lookAtObjectWithId:null};self.companiesManager=new TDataBaseManager();self.sitesManager=new TDataBaseManager();self.buildingsManager=new TDataBaseManager();self.scenesManager=new TScenesManager();self.objectsManager=new TObjectsManager();self.geometriesManager=new TGeometriesManager();self.materialsManager=new TMaterialsManager();_initCompanies(_parameters.companiesIds);_initSitesOf(_parameters.sitesIds);_initBuildingsOf(_parameters.buildingsIds,null,true);_initScenesOf(_parameters.scenesIds,null,true);_initObjectsOf(_parameters.objectsIds,null,true);var lookAtObjectWithId=_parameters.lookAtObjectWithId;if(lookAtObjectWithId){self.objectsManager.read(lookAtObjectWithId,function(objects){// Create geometries and materials list
  var geometriesIds=[];var materialsIds=[];var object=undefined;for(var objectIndex=0,numberOfObjects=objects.length;objectIndex<numberOfObjects;objectIndex++){object=objects[objectIndex];object.visible=true;if(object.children.length>0){_initObjectsOf(object.children,object,visible);object.children=[];}geometriesIds.push(object.geometry);Array.prototype.push.apply(materialsIds,object.material);}geometriesIds=uniq(geometriesIds);materialsIds=uniq(materialsIds);self.geometriesManager.read(geometriesIds,function(geometries){var object=undefined;for(var _objectIndex=0,_numberOfObjects=objects.length;_objectIndex<_numberOfObjects;_objectIndex++){object=objects[_objectIndex];object.geometry=geometries[object.geometry];objectReady(object);}});self.materialsManager.read(materialsIds,function(materials){var object=undefined;var objectMaterial=undefined;for(var _objectIndex2=0,_numberOfObjects2=objects.length;_objectIndex2<_numberOfObjects2;_objectIndex2++){object=objects[_objectIndex2];objectMaterial=object.material;if(Array.isArray(objectMaterial)){// Take care about the multi material order
  object.material=[];var materialId=undefined;for(var materialIndex=0,numberOfMaterials=objectMaterial.length;materialIndex<numberOfMaterials;materialIndex++){materialId=objectMaterial[materialIndex];object.material.push(materials[materialId]);}}else{object.material=materials[object.material];}objectReady(object);}});function objectReady(object){if(typeof object.geometry!=='string'&&typeof object.material[0]!=='string'){// Care trick here: parent will be override under scene.add so keep parent id before
  var parentId=object.parent;// Update carl batiment button value
  // Care parent will not be the scene for ever !!!
  self.detailBtn.val(parentId);self.createBtn.val(parentId);object.parent=null;self.webglViewport.scene.add(object);if(object.type==='Mesh'){self.webglViewport.addRaycastables([object]);}// Object have no position from revit export so comput bounding sphere an get center !
  var objectPosition=object.position;object.geometry.computeBoundingSphere();var boundingSphereRadius=object.geometry.boundingSphere.radius;self.webglViewport.camera.position.x=objectPosition.x+boundingSphereRadius;self.webglViewport.camera.position.y=objectPosition.y+boundingSphereRadius;self.webglViewport.camera.position.z=objectPosition.z+boundingSphereRadius;self.webglViewport.camera.updateProjectionMatrix();self.webglViewport.orbitControl.target.x=objectPosition.x;self.webglViewport.orbitControl.target.y=objectPosition.y;self.webglViewport.orbitControl.target.z=objectPosition.z;self.webglViewport.orbitControl.update();_initScenesOf(parentId,null,true);}}function uniq(a){var seen={};return a.filter(function(item){return seen.hasOwnProperty(item)?false:seen[item]=true;});}});}function _initCompanies(companiesIds){if(!companiesIds){return;}self.companiesManager.read(companiesIds,function(companies){var company=undefined;for(var companyIndex=0,numberOfCompanies=companies.length;companyIndex<numberOfCompanies;companyIndex++){company=companies[companyIndex];_initSitesOf(company.sites);}});}function _initSitesOf(sitesIds){if(!sitesIds){return;}self.sitesManager.read(sitesIds,function(sites){var site=undefined;for(var siteIndex=0,numberOfSites=sites.length;siteIndex<numberOfSites;siteIndex++){site=sites[siteIndex];var siteGroup=new Group();siteGroup['_id']=site._id;siteGroup.name=site.name;siteGroup.visible=siteIndex===0;// These are the main group for the webgl view
  self.webglViewport.scene.add(siteGroup);self.webglViewport.addRaycastables([siteGroup]);// Create new base tree item
  var objectTreeViewItem=self.insertTreeViewItem(siteGroup._id,siteGroup.name,null,siteGroup.visible);objectTreeViewItem.find('#'+siteGroup._id+'VisibilityCheckbox').on('change',function(event){siteGroup.visible=this.checked;});_initBuildingsOf(site.buildings,siteGroup,siteGroup.visible);}});}function _initBuildingsOf(buildingsIds,site,visible){if(!buildingsIds){return;}self.buildingsManager.read(buildingsIds,function(buildings){var building=undefined;for(var buildingIndex=0,numberOfBuildings=buildings.length;buildingIndex<numberOfBuildings;buildingIndex++){building=buildings[buildingIndex];if(buildingIndex===0){// Update carl batiment button value
  self.detailBtn.val(buildingsIds);self.createBtn.val(buildingsIds);}var buildingGroup=new Group();buildingGroup['_id']=building._id;buildingGroup.name=building.name;buildingGroup.visible=visible&&buildingIndex===0;var parentId=undefined;if(site){site.add(buildingGroup);parentId=site._id;}else{self.webglViewport.scene.add(buildingGroup);self.webglViewport.addRaycastables([buildingGroup]);}// Create new base tree item
  var objectTreeViewItem=self.insertTreeViewItem(buildingGroup._id,buildingGroup.name,parentId,buildingGroup.visible);objectTreeViewItem.find('#'+buildingGroup._id+'VisibilityCheckbox').on('change',_toggleObjectVisibility(buildingGroup));_initScenesOf(building.scenes,buildingGroup,buildingGroup.visible);}});}function _initScenesOf(scenesIds,building,visible){if(!scenesIds){return;}self.scenesManager.read(scenesIds,function(scenes){var scene=undefined;for(var sceneIndex=0,numberOfScenes=scenes.length;sceneIndex<numberOfScenes;sceneIndex++){scene=scenes[sceneIndex];var sceneGroup=new Group();sceneGroup['_id']=scene._id;sceneGroup.name=scene.name;sceneGroup.visible=visible&&scene.layers===1;var parentId=undefined;if(building){building.add(sceneGroup);parentId=building._id;}else{self.webglViewport.scene.add(sceneGroup);self.webglViewport.addRaycastables([sceneGroup]);}// Create new base tree item
  var objectTreeViewItem=self.insertTreeViewItem(sceneGroup._id,sceneGroup.name,parentId,sceneGroup.visible);objectTreeViewItem.find('#'+sceneGroup._id+'VisibilityCheckbox').on('change',_toggleObjectVisibility(sceneGroup));if(scene.layers===1){_initObjectsOf(scene.children,sceneGroup,true);// set children visible by default due to non recursive visible settings
  //                    _initObjectsOf( scene.children, sceneGroup, sceneIsVisible )
  }else{sceneGroup['childrenIds']=scene.children;}}});}function _initObjectsOf(objectsIds,scene,visible){if(!objectsIds){return;}self.objectsManager.read(objectsIds,function(objects){// Create geometries and materials list
  var geometriesIds=[];var materialsIds=[];var object=undefined;for(var objectIndex=0,numberOfObjects=objects.length;objectIndex<numberOfObjects;objectIndex++){object=objects[objectIndex];object.visible=visible;if(object.children.length>0){_initObjectsOf(object.children,object,visible);object.children=[];}geometriesIds.push(object.geometry);Array.prototype.push.apply(materialsIds,object.material);}geometriesIds=uniq(geometriesIds);materialsIds=uniq(materialsIds);self.geometriesManager.read(geometriesIds,function(geometries){var object=undefined;for(var _objectIndex3=0,_numberOfObjects3=objects.length;_objectIndex3<_numberOfObjects3;_objectIndex3++){object=objects[_objectIndex3];object.geometry=geometries[object.geometry];objectReady(object);}});self.materialsManager.read(materialsIds,function(materials){var object=undefined;var objectMaterial=undefined;for(var _objectIndex4=0,_numberOfObjects4=objects.length;_objectIndex4<_numberOfObjects4;_objectIndex4++){object=objects[_objectIndex4];objectMaterial=object.material;if(Array.isArray(objectMaterial)){// Take care about the multi material order
  object.material=[];var materialId=undefined;for(var materialIndex=0,numberOfMaterials=objectMaterial.length;materialIndex<numberOfMaterials;materialIndex++){materialId=objectMaterial[materialIndex];object.material.push(materials[materialId]);}}else{object.material=materials[object.material];}objectReady(object);}});function objectReady(object){if(typeof object.geometry!=='string'&&typeof object.material[0]!=='string'){// Fix undefined parent to null to avoid three error
  if(object.parent===undefined||typeof object.parent==='string'){object.parent=null;}if(scene){scene.add(object);}else{self.webglViewport.scene.add(object);self.webglViewport.addRaycastables([object]);}}}function uniq(a){var seen={};return a.filter(function(item){return seen.hasOwnProperty(item)?false:seen[item]=true;});}});}function _toggleObjectVisibility(object){var _object=object;return function(event){_object.visible=this.checked;// if scene layers === 0
  if(_object.visible===true&&_object.type==='Group'&&_object.childrenIds){var childrenIds=_object.childrenIds;delete _object.childrenIds;_initObjectsOf(childrenIds,_object,true);}};}}function _initPointCloudData(parameters){parameters=parameters||{};if(parameters.fromDatabase){self.pointCloudManager=new PointCloudManager(this.webglViewport);self.pointCloudManager.setGlobalOffset(LAMBERT_NORD_OFFSET);if(parameters.samplingMin){self.pointCloudManager.setMinimumSamplingLimit(parameters.samplingMin);}self.pointCloudManager.getPointClouds(function(){_checkReady();});}}var _avatarReady=false;function _initAvatarData(parameters){parameters=parameters||{};var jsonLoader=new JSONLoader();//        jsonLoader.load( 'resources/models/json/oko/Oko_textured.json', function ( geometry, materials ) {
  //        jsonLoader.load( 'resources/models/json/oko/Oko_join.json', function ( geometry, materials ) {
  jsonLoader.load('resources/models/json/John/John.json',function(geometry,materials){//        jsonLoader.load( 'resources/models/json/Ethan/Ethan_idle.json', function ( geometry, materials ) {
  //        jsonLoader.load( 'resources/models/json/Ethan/Ethan_idle_centered.json', function ( geometry, materials ) {
  materials.visible=true;var mesh=undefined;if(geometry.bones&&geometry.bones.length>0){mesh=new SkinnedMesh(geometry,materials);}else{mesh=new Mesh(geometry,materials);}mesh.name='Avatar';var rad=115*Math.PI/180;mesh.rotateY(rad);onLoad(mesh);});//        var objectLoader = new ObjectLoader()
  //        objectLoader.load( 'resources/models/json/materials.json', function ( object ) {
  //
  //            self.webglViewport.scene.add( object )
  //
  //        } )
  var _recenter=true;var _setDoubleSide=false;var _displayCenter=false;var _displayBoundingBox=false;var _displayWire=false;var _displaySkeleton=false;var _manageAnimation=true;var currentActionIndex=undefined;var skeletonHelper=undefined;var mixers=[];var actions=[];function onLoad(object){if(!object){console.error('Something when wrong... Object is null or undefined !');return;}else if(object instanceof Group||object instanceof Scene){var child=undefined;while(object.children.length>0){child=object.children[object.children.length-1];_processObject(child);}}else if(object instanceof Object3D){_processObject(object);}else if(object.skeleton&&object.clip){skeletonHelper=new SkeletonHelper(object.skeleton.bones[0]);skeletonHelper.skeleton=object.skeleton;// allow animation mixer to bind to SkeletonHelper directly
  skeletonHelper.update();self.webglViewport.scene.add(skeletonHelper);// play animation
  var mixer=new AnimationMixer(skeletonHelper);mixer.clipAction(object.clip).setEffectiveWeight(1.0).play();mixers.push(mixer);}else{console.warn('Unknown object type !!!');}function _processObject(object){if(_recenter){_recenterGeometry(object);}if(_setDoubleSide){_setDoubleSidedMaterial(object);}if(_displayCenter){_addCenterHelper(object);}if(_displayBoundingBox){_addBoundingBoxHelper(object);}if(_displayWire){_addWire(object);}if(_displaySkeleton){_addSkeletonHelper(object);}if(_manageAnimation){_addAnimations(object);}//					var position = getNextPosition()
  //					object.position.copy( position )
  self.webglViewport.scene.add(object);_avatarReady=true;_checkReady();}function _recenterGeometry(object){//						if( ! object.geometry.boundingBox ) { object.geometry.computeBoundingBox() }
  //
  //						var center = object.geometry.boundingBox.getCenter()
  //						var negCenter = center.negate()
  var offset=object.geometry.center();var bb=object.geometry.boundingBox;var bbMin=bb.min.negate();object.geometry.translate(0,bbMin.y,0);}function _setDoubleSidedMaterial(object){if('material'in object){object.material.side=Constants.DoubleSide;object.material.opacity=1;}else{console.warn('No material found !');}}function _addWire(object){var wireframe=new LineSegments(new WireframeGeometry(object.geometry),new LineBasicMaterial$1({color:0xffffff,linewidth:1}));self.webglViewport.scene.add(wireframe);}function _addCenterHelper(object){if(!object.geometry.boundingBox){object.geometry.computeBoundingBox();}var center=object.geometry.boundingBox.getCenter();var axisHelper=new AxisHelper(5);axisHelper.position.copy(center);self.webglViewport.scene.add(axisHelper);}function _addBoundingBoxHelper(object){var boundingBoxHelper=new BoxHelper(object);self.webglViewport.scene.add(boundingBoxHelper);}function _addSkeletonHelper(object){if(object.skeleton&&object.skeleton.bones&&object.skeleton.bones.length>0){skeletonHelper=new SkeletonHelper(object);skeletonHelper.material.linewidth=3;skeletonHelper.update();self.webglViewport.scene.add(skeletonHelper);var helper2=new SkeletonHelper(object.skeleton.bones[0]);helper2.material.linewidth=3;helper2.update();self.webglViewport.scene.add(helper2);}else if(object.geometry&&object.geometry.bones&&object.geometry.bones.length>0){// Create Skeleton from geometry bones
  //							object.skeleton = new THREE.Skeleton( object.geometry.bones )
  //							var helper = new THREE.SkeletonHelper( object.geometry.bones[ 0 ] )
  //							helper.material.linewidth = 3
  //							helper.update()
  //
  //							scene.add( helper )
  console.warn('Unable to process skeleton from geometry !');}else{console.warn('No skeleton founds !');}}function _addAnimations(object){if(object.animations&&object.animations.length>0){object.mixer=new AnimationMixer(object);//                    mixers.push( object.mixer )
  var action=object.mixer.clipAction(object.animations[1]);action.setEffectiveWeight(1.0);action.play();}else if(object.geometry.animations&&object.geometry.animations.length>0){object.mixer=new AnimationMixer(object);//                    mixers.push( object.mixer )
  var anim=undefined;var action=undefined;for(var animIndex=0,numberOfAnims=object.geometry.animations.length;animIndex<numberOfAnims;animIndex++){anim=object.geometry.animations[animIndex];action=object.mixer.clipAction(anim);actions.push(action);}currentActionIndex=0;actions[currentActionIndex].play();}else{console.warn('No animations founds !');//							var url = 'models/bvh/01/01_01.bvh'
  //
  //							var bvhLoader = new THREE.BVHLoader( manager )
  //							bvhLoader.load(
  //									url,
  //									onLoad,
  ////									function( animation ) {
  ////
  ////										object.mixer = new THREE.AnimationMixer( object )
  ////										mixers.push( object.mixer )
  ////
  ////										var action = object.mixer.clipAction( animation.clip )
  ////										action.setEffectiveWeight( 1.0 )
  ////										action.play()
  ////
  ////									},
  //									onProgress,
  //									onError
  //							)
  }}}}function _initRemoteFiles(files){if(!files){return;}self.universalLoader.load(files,self.addObjectToModel.bind(self));}function _initListener(){window.addEventListener('message',function(event){console.log(event.data);// IMPORTANT: Check the origin of the data!
  if(~event.origin.indexOf('http://yoursite.com')){// The data has been sent from your site
  // The data sent with postMessage is stored in event.data
  console.log(event.data);}else{// The data hasn't been sent from your site!
  // Be careful! Do not use it.
  return;}});// Update meshes
  //        self.webglViewport.orbitControl.addEventListener( 'end', self.updateMeshResolution.bind( self ) )
  // Update point cloud
  //        self.webglViewport.orbitControl.addEventListener( 'end', self.updatePointCloudDensity.bind( self ) )
  //
  self.webglViewport.addEventListener('objectSelected',self.popupSelectedObjectModal.bind(self));self.webglViewport.addEventListener('newClickedPoint',self.updateMeasure.bind(self));self.webglViewport.addEventListener('intersectPoint',self.updateTemporaryMeasure.bind(self));self.webglViewport.addEventListener('measureEnd',self.endMeasure.bind(self));window.addEventListener("keydown",function(event){if(event.defaultPrevented){return;// Should do nothing if the key event was already consumed.
  }switch(event.key){case"2":self.webglViewport.camera.position.x=160+0;self.webglViewport.camera.position.y=15+0;self.webglViewport.camera.position.z=70+250;self.webglViewport.orbitControl.target.x=160;self.webglViewport.orbitControl.target.y=15;self.webglViewport.orbitControl.target.z=70;break;case"4":self.webglViewport.camera.position.x=160-250;self.webglViewport.camera.position.y=15+0;self.webglViewport.camera.position.z=70+0;self.webglViewport.orbitControl.target.x=160;self.webglViewport.orbitControl.target.y=15;self.webglViewport.orbitControl.target.z=70;break;case"5":self.webglViewport.camera.position.x=160+0;self.webglViewport.camera.position.y=15+250;self.webglViewport.camera.position.z=70+0;self.webglViewport.orbitControl.target.x=160;self.webglViewport.orbitControl.target.y=15;self.webglViewport.orbitControl.target.z=70;break;case"6":self.webglViewport.camera.position.x=160+250;self.webglViewport.camera.position.y=15+0;self.webglViewport.camera.position.z=70+0;self.webglViewport.orbitControl.target.x=160;self.webglViewport.orbitControl.target.y=15;self.webglViewport.orbitControl.target.z=70;break;case"8":self.webglViewport.camera.position.x=160+0;self.webglViewport.camera.position.y=15+0;self.webglViewport.camera.position.z=70-250;self.webglViewport.orbitControl.target.x=160;self.webglViewport.orbitControl.target.y=15;self.webglViewport.orbitControl.target.z=70;break;default:return;// Quit when this doesn't handle the key event.
  }self.webglViewport.orbitControl.update();// Consume the event for suppressing "double action".
  event.preventDefault();},true);}function _checkReady(){if(parameters.webGL.modelEnable){if(!_modelReady){return;}}if(parameters.webGL.avatarEnable){if(!_avatarReady){return;}}console.timeEnd("TApplication");//        self.webglViewport.toggleAutorun()
  onReady();}(function(){_initGUI.call(self,_parameters.gui);// Todo: initData.call( self, parameters.datas )
  // model: {
  //      database: {...ids},
  //      files: [...urls]
  // }
  _initModelData.call(self,parameters.model);_initPointCloudData.call(self,parameters.pointCloud);_initAvatarData.call(self,parameters.avatarParams);_initRemoteFiles.call(self,parameters.files);_initListener.call(self);})();}/**
   * Static methods
   */Object.assign(TApplication,{// Todo: String helper
  /**
       * @static
       * @public
       * @memberOf TApplication
       */diacriticsMap:function(){/*
           Licensed under the Apache License, Version 2.0 (the "License");
           you may not use this file except in compliance with the License.
           You may obtain a copy of the License at
             http://www.apache.org/licenses/LICENSE-2.0
             Unless required by applicable law or agreed to in writing, software
           distributed under the License is distributed on an "AS IS" BASIS,
           WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
           See the License for the specific language governing permissions and
           limitations under the License.
           */var defaultDiacriticsRemovalMap=[{'base':'A','letters':'A\u24B6\uFF21\xC0\xC1\xC2\u1EA6\u1EA4\u1EAA\u1EA8\xC3\u0100\u0102\u1EB0\u1EAE\u1EB4\u1EB2\u0226\u01E0\xC4\u01DE\u1EA2\xC5\u01FA\u01CD\u0200\u0202\u1EA0\u1EAC\u1EB6\u1E00\u0104\u023A\u2C6F'},{'base':'AA','letters':'\uA732'},{'base':'AE','letters':'\xC6\u01FC\u01E2'},{'base':'AO','letters':'\uA734'},{'base':'AU','letters':'\uA736'},{'base':'AV','letters':'\uA738\uA73A'},{'base':'AY','letters':'\uA73C'},{'base':'B','letters':'B\u24B7\uFF22\u1E02\u1E04\u1E06\u0243\u0182\u0181'},{'base':'C','letters':'C\u24B8\uFF23\u0106\u0108\u010A\u010C\xC7\u1E08\u0187\u023B\uA73E'},{'base':'D','letters':'D\u24B9\uFF24\u1E0A\u010E\u1E0C\u1E10\u1E12\u1E0E\u0110\u018B\u018A\u0189\uA779\xD0'},{'base':'DZ','letters':'\u01F1\u01C4'},{'base':'Dz','letters':'\u01F2\u01C5'},{'base':'E','letters':'E\u24BA\uFF25\xC8\xC9\xCA\u1EC0\u1EBE\u1EC4\u1EC2\u1EBC\u0112\u1E14\u1E16\u0114\u0116\xCB\u1EBA\u011A\u0204\u0206\u1EB8\u1EC6\u0228\u1E1C\u0118\u1E18\u1E1A\u0190\u018E'},{'base':'F','letters':'F\u24BB\uFF26\u1E1E\u0191\uA77B'},{'base':'G','letters':'G\u24BC\uFF27\u01F4\u011C\u1E20\u011E\u0120\u01E6\u0122\u01E4\u0193\uA7A0\uA77D\uA77E'},{'base':'H','letters':'H\u24BD\uFF28\u0124\u1E22\u1E26\u021E\u1E24\u1E28\u1E2A\u0126\u2C67\u2C75\uA78D'},{'base':'I','letters':'I\u24BE\uFF29\xCC\xCD\xCE\u0128\u012A\u012C\u0130\xCF\u1E2E\u1EC8\u01CF\u0208\u020A\u1ECA\u012E\u1E2C\u0197'},{'base':'J','letters':'J\u24BF\uFF2A\u0134\u0248'},{'base':'K','letters':'K\u24C0\uFF2B\u1E30\u01E8\u1E32\u0136\u1E34\u0198\u2C69\uA740\uA742\uA744\uA7A2'},{'base':'L','letters':'L\u24C1\uFF2C\u013F\u0139\u013D\u1E36\u1E38\u013B\u1E3C\u1E3A\u0141\u023D\u2C62\u2C60\uA748\uA746\uA780'},{'base':'LJ','letters':'\u01C7'},{'base':'Lj','letters':'\u01C8'},{'base':'M','letters':'M\u24C2\uFF2D\u1E3E\u1E40\u1E42\u2C6E\u019C'},{'base':'N','letters':'N\u24C3\uFF2E\u01F8\u0143\xD1\u1E44\u0147\u1E46\u0145\u1E4A\u1E48\u0220\u019D\uA790\uA7A4'},{'base':'NJ','letters':'\u01CA'},{'base':'Nj','letters':'\u01CB'},{'base':'O','letters':'O\u24C4\uFF2F\xD2\xD3\xD4\u1ED2\u1ED0\u1ED6\u1ED4\xD5\u1E4C\u022C\u1E4E\u014C\u1E50\u1E52\u014E\u022E\u0230\xD6\u022A\u1ECE\u0150\u01D1\u020C\u020E\u01A0\u1EDC\u1EDA\u1EE0\u1EDE\u1EE2\u1ECC\u1ED8\u01EA\u01EC\xD8\u01FE\u0186\u019F\uA74A\uA74C'},{'base':'OI','letters':'\u01A2'},{'base':'OO','letters':'\uA74E'},{'base':'OU','letters':'\u0222'},{'base':'OE','letters':'\x8C\u0152'},{'base':'oe','letters':'\x9C\u0153'},{'base':'P','letters':'P\u24C5\uFF30\u1E54\u1E56\u01A4\u2C63\uA750\uA752\uA754'},{'base':'Q','letters':'Q\u24C6\uFF31\uA756\uA758\u024A'},{'base':'R','letters':'R\u24C7\uFF32\u0154\u1E58\u0158\u0210\u0212\u1E5A\u1E5C\u0156\u1E5E\u024C\u2C64\uA75A\uA7A6\uA782'},{'base':'S','letters':'S\u24C8\uFF33\u1E9E\u015A\u1E64\u015C\u1E60\u0160\u1E66\u1E62\u1E68\u0218\u015E\u2C7E\uA7A8\uA784'},{'base':'T','letters':'T\u24C9\uFF34\u1E6A\u0164\u1E6C\u021A\u0162\u1E70\u1E6E\u0166\u01AC\u01AE\u023E\uA786'},{'base':'TZ','letters':'\uA728'},{'base':'U','letters':'U\u24CA\uFF35\xD9\xDA\xDB\u0168\u1E78\u016A\u1E7A\u016C\xDC\u01DB\u01D7\u01D5\u01D9\u1EE6\u016E\u0170\u01D3\u0214\u0216\u01AF\u1EEA\u1EE8\u1EEE\u1EEC\u1EF0\u1EE4\u1E72\u0172\u1E76\u1E74\u0244'},{'base':'V','letters':'V\u24CB\uFF36\u1E7C\u1E7E\u01B2\uA75E\u0245'},{'base':'VY','letters':'\uA760'},{'base':'W','letters':'W\u24CC\uFF37\u1E80\u1E82\u0174\u1E86\u1E84\u1E88\u2C72'},{'base':'X','letters':'X\u24CD\uFF38\u1E8A\u1E8C'},{'base':'Y','letters':'Y\u24CE\uFF39\u1EF2\xDD\u0176\u1EF8\u0232\u1E8E\u0178\u1EF6\u1EF4\u01B3\u024E\u1EFE'},{'base':'Z','letters':'Z\u24CF\uFF3A\u0179\u1E90\u017B\u017D\u1E92\u1E94\u01B5\u0224\u2C7F\u2C6B\uA762'},{'base':'a','letters':'a\u24D0\uFF41\u1E9A\xE0\xE1\xE2\u1EA7\u1EA5\u1EAB\u1EA9\xE3\u0101\u0103\u1EB1\u1EAF\u1EB5\u1EB3\u0227\u01E1\xE4\u01DF\u1EA3\xE5\u01FB\u01CE\u0201\u0203\u1EA1\u1EAD\u1EB7\u1E01\u0105\u2C65\u0250'},{'base':'aa','letters':'\uA733'},{'base':'ae','letters':'\xE6\u01FD\u01E3'},{'base':'ao','letters':'\uA735'},{'base':'au','letters':'\uA737'},{'base':'av','letters':'\uA739\uA73B'},{'base':'ay','letters':'\uA73D'},{'base':'b','letters':'b\u24D1\uFF42\u1E03\u1E05\u1E07\u0180\u0183\u0253'},{'base':'c','letters':'c\u24D2\uFF43\u0107\u0109\u010B\u010D\xE7\u1E09\u0188\u023C\uA73F\u2184'},{'base':'d','letters':'d\u24D3\uFF44\u1E0B\u010F\u1E0D\u1E11\u1E13\u1E0F\u0111\u018C\u0256\u0257\uA77A'},{'base':'dz','letters':'\u01F3\u01C6'},{'base':'e','letters':'e\u24D4\uFF45\xE8\xE9\xEA\u1EC1\u1EBF\u1EC5\u1EC3\u1EBD\u0113\u1E15\u1E17\u0115\u0117\xEB\u1EBB\u011B\u0205\u0207\u1EB9\u1EC7\u0229\u1E1D\u0119\u1E19\u1E1B\u0247\u025B\u01DD'},{'base':'f','letters':'f\u24D5\uFF46\u1E1F\u0192\uA77C'},{'base':'g','letters':'g\u24D6\uFF47\u01F5\u011D\u1E21\u011F\u0121\u01E7\u0123\u01E5\u0260\uA7A1\u1D79\uA77F'},{'base':'h','letters':'h\u24D7\uFF48\u0125\u1E23\u1E27\u021F\u1E25\u1E29\u1E2B\u1E96\u0127\u2C68\u2C76\u0265'},{'base':'hv','letters':'\u0195'},{'base':'i','letters':'i\u24D8\uFF49\xEC\xED\xEE\u0129\u012B\u012D\xEF\u1E2F\u1EC9\u01D0\u0209\u020B\u1ECB\u012F\u1E2D\u0268\u0131'},{'base':'j','letters':'j\u24D9\uFF4A\u0135\u01F0\u0249'},{'base':'k','letters':'k\u24DA\uFF4B\u1E31\u01E9\u1E33\u0137\u1E35\u0199\u2C6A\uA741\uA743\uA745\uA7A3'},{'base':'l','letters':'l\u24DB\uFF4C\u0140\u013A\u013E\u1E37\u1E39\u013C\u1E3D\u1E3B\u017F\u0142\u019A\u026B\u2C61\uA749\uA781\uA747'},{'base':'lj','letters':'\u01C9'},{'base':'m','letters':'m\u24DC\uFF4D\u1E3F\u1E41\u1E43\u0271\u026F'},{'base':'n','letters':'n\u24DD\uFF4E\u01F9\u0144\xF1\u1E45\u0148\u1E47\u0146\u1E4B\u1E49\u019E\u0272\u0149\uA791\uA7A5'},{'base':'nj','letters':'\u01CC'},{'base':'o','letters':'o\u24DE\uFF4F\xF2\xF3\xF4\u1ED3\u1ED1\u1ED7\u1ED5\xF5\u1E4D\u022D\u1E4F\u014D\u1E51\u1E53\u014F\u022F\u0231\xF6\u022B\u1ECF\u0151\u01D2\u020D\u020F\u01A1\u1EDD\u1EDB\u1EE1\u1EDF\u1EE3\u1ECD\u1ED9\u01EB\u01ED\xF8\u01FF\u0254\uA74B\uA74D\u0275'},{'base':'oi','letters':'\u01A3'},{'base':'ou','letters':'\u0223'},{'base':'oo','letters':'\uA74F'},{'base':'p','letters':'p\u24DF\uFF50\u1E55\u1E57\u01A5\u1D7D\uA751\uA753\uA755'},{'base':'q','letters':'q\u24E0\uFF51\u024B\uA757\uA759'},{'base':'r','letters':'r\u24E1\uFF52\u0155\u1E59\u0159\u0211\u0213\u1E5B\u1E5D\u0157\u1E5F\u024D\u027D\uA75B\uA7A7\uA783'},{'base':'s','letters':'s\u24E2\uFF53\xDF\u015B\u1E65\u015D\u1E61\u0161\u1E67\u1E63\u1E69\u0219\u015F\u023F\uA7A9\uA785\u1E9B'},{'base':'t','letters':'t\u24E3\uFF54\u1E6B\u1E97\u0165\u1E6D\u021B\u0163\u1E71\u1E6F\u0167\u01AD\u0288\u2C66\uA787'},{'base':'tz','letters':'\uA729'},{'base':'u','letters':'u\u24E4\uFF55\xF9\xFA\xFB\u0169\u1E79\u016B\u1E7B\u016D\xFC\u01DC\u01D8\u01D6\u01DA\u1EE7\u016F\u0171\u01D4\u0215\u0217\u01B0\u1EEB\u1EE9\u1EEF\u1EED\u1EF1\u1EE5\u1E73\u0173\u1E77\u1E75\u0289'},{'base':'v','letters':'v\u24E5\uFF56\u1E7D\u1E7F\u028B\uA75F\u028C'},{'base':'vy','letters':'\uA761'},{'base':'w','letters':'w\u24E6\uFF57\u1E81\u1E83\u0175\u1E87\u1E85\u1E98\u1E89\u2C73'},{'base':'x','letters':'x\u24E7\uFF58\u1E8B\u1E8D'},{'base':'y','letters':'y\u24E8\uFF59\u1EF3\xFD\u0177\u1EF9\u0233\u1E8F\xFF\u1EF7\u1E99\u1EF5\u01B4\u024F\u1EFF'},{'base':'z','letters':'z\u24E9\uFF5A\u017A\u1E91\u017C\u017E\u1E93\u1E95\u01B6\u0225\u0240\u2C6C\uA763'}];var diacriticsMap={};for(var i=0;i<defaultDiacriticsRemovalMap.length;i++){var letters=defaultDiacriticsRemovalMap[i].letters;for(var j=0;j<letters.length;j++){diacriticsMap[letters[j]]=defaultDiacriticsRemovalMap[i].base;}}return diacriticsMap;}(),/**
       * @static
       * @public
       * @memberOf TApplication
       *
       * @param string
       */removeDiacritics:function removeDiacritics(string){return string.replace(/[^\u0000-\u007E]/g,function(a){return TApplication.diacriticsMap[a]||a;});},createParticularEmbranchmentGroup:function createParticularEmbranchmentGroup(particularEmbranchments,color,generateSpritId,filters){if(!particularEmbranchments){console.error("Unable to create particular embranchment group with null or undefined particular embranchment !!!");return;}color=color||0xffffff;generateSpritId=generateSpritId||false;filters=filters||null;var particularEmbranchmentGroup=new Group();var particularEmbranchment={};var coordinates=[];var properties={};var rotation=0;var bpId=0;var deltaRotX=0;var deltaRotY=0;var lineStart=undefined;var lineEnd=undefined;var path=undefined;var geometry=undefined;var material=undefined;var mesh=undefined;var sprit=undefined;for(var index=0,numberOfBP=particularEmbranchments.length;index<numberOfBP;++index){particularEmbranchment=particularEmbranchments[index];coordinates=particularEmbranchment.geometry.coordinates;properties=particularEmbranchment.properties;bpId=properties.ID_BP;// Filter required id
  if(filters&&filters.includes(bpId)===false){continue;}rotation=_Math.degToRad(properties.ROTATION);deltaRotX=Math.cos(rotation);deltaRotY=-Math.sin(rotation);lineStart=new Vector3$1(coordinates[0]-600200,coordinates[1]-131400,coordinates[2]-60);lineEnd=new Vector3$1(coordinates[0]-600200+deltaRotY,coordinates[1]-131400+deltaRotX,coordinates[2]-60);path=new LineCurve(lineStart,lineEnd);geometry=new TubeGeometry(path,1,0.05,8,false);var firstPoint=geometry.vertices[0];var lastPoint=geometry.vertices[geometry.vertices.length-1];material=new MeshLambertMaterial$1({color:color,side:DoubleSide});mesh=new Mesh(geometry,material);mesh.userData={id:bpId,borough:properties.ARRONDISSE,district:properties.CIRCONSCRI,sectionId:properties.ID_TRONCON,streetName:properties.NOM_VOIE,postCode:properties.NUM_POSTAL,type:properties.TYPE_BP,tubeType:properties.TYPE_CANA,rejectionType:properties.TYPE_REJET,position:{x:Math.round(properties.X*100)/100,y:Math.round(properties.Y*100)/100,z:Math.round(properties.Z*100)/100// TRANSFORME ZUP/YFOR to YUP/-ZFOR
  // Convert Y forward Z up to Y up - Z forward
  }};mesh.geometry.rotateX(-(Math.PI/2));var boundingSphereCenter=mesh.geometry.center().negate();// Recenter geometry to mesh
  mesh.position.copy(boundingSphereCenter);// Set previous geometry center as mesh position
  // Create ID sprit
  if(generateSpritId){sprit=TApplication.createSprite("BP: "+bpId);sprit.position.x=(firstPoint.x+lastPoint.x)/2;sprit.position.y=(firstPoint.y+lastPoint.y)/2+0.2;sprit.position.z=(firstPoint.z+lastPoint.z)/2;mesh.add(sprit);}particularEmbranchmentGroup.add(mesh);}//	particularEmbranchmentGroup.rotation.x -= Math.PI / 2
  return particularEmbranchmentGroup;},createNodesGroup:function createNodesGroup(nodes,color,generateSpritId,filters){if(!nodes){console.error("Unable to create node group with null or undefined nodes !!!");return;}color=color||0xffffff;generateSpritId=generateSpritId||false;filters=filters||null;var nodesGroup=new Group();var node={};var coordinates=[];var nodeId=0;var position=null;var geometry=null;var material=null;var mesh=null;var sprit=null;for(var index=0,numberOfBP=nodes.length;index<numberOfBP;++index){node=nodes[index];coordinates=node.geometry.coordinates;nodeId=node.properties.IDENTIFIAN;// Filter required id
  if(filters&&filters.includes(nodeId)===false){continue;}position=new Vector3$1(coordinates[0]-600200,coordinates[1]-131400,coordinates[2]-60);geometry=new SphereBufferGeometry(0.1,16,16);geometry.translate(position.x,position.y,position.z);material=new MeshLambertMaterial$1({color:color,side:FrontSide});mesh=new Mesh(geometry,material);mesh.userData=node.properties;mesh.userData.position={x:Math.round(coordinates[0]*100)/100,y:Math.round(coordinates[1]*100)/100,z:Math.round(coordinates[2]*100)/100// TRANSFORME ZUP/YFOR to YUP/-ZFOR
  // Convert Y forward Z up to Y up - Z forward
  };mesh.geometry.rotateX(-(Math.PI/2));var boundingSphereCenter=mesh.geometry.center().negate();// Recenter geometry to mesh
  mesh.position.copy(boundingSphereCenter);// Set previous geometry center as mesh position
  // Create ID sprit
  if(generateSpritId){if(!geometry.boundingSphere){geometry.computeBoundingSphere();}sprit=TApplication.createSprite("N: "+nodeId);sprit.position.x=geometry.boundingSphere.center.x;sprit.position.y=geometry.boundingSphere.center.y;sprit.position.z=geometry.boundingSphere.center.z;//                sprit.scale.x = 0.7
  //                sprit.scale.y = 0.7
  //                sprit.scale.z = 0.7
  mesh.add(sprit);}nodesGroup.add(mesh);}return nodesGroup;},createSectionGroup:function createSectionGroup(sections,color,generateSpritId,filters){if(!sections){console.error("Unable to create section group with null or undefined sections !!!");return;}color=color||0xffffff;generateSpritId=generateSpritId||false;filters=filters||null;var sectionGroup=new Group();var section={};var coordinates=[];var coordinate=[];var sectionId=0;var firstPoint=undefined;var lastPoint=undefined;var geometry=undefined;var material=undefined;var line=undefined;var sprit=undefined;for(var index=0,numberOfSections=sections.length;index<numberOfSections;++index){section=sections[index];coordinates=section.geometry.coordinates;sectionId=section.properties.ASSET_ID;// Filter required id
  if(filters&&filters.includes(sectionId)===false){continue;}geometry=new Geometry();for(var coordinateIndex=0,numberOfPoints=coordinates.length;coordinateIndex<numberOfPoints;++coordinateIndex){coordinate=coordinates[coordinateIndex];geometry.vertices.push(new Vector3$1(coordinate[0]-600200,coordinate[1]-131400,coordinate[2]-60));}material=new LineBasicMaterial$1({color:color});line=new Line$1(geometry,material);line.name=sectionId;line.userData={borough:section.properties.ARRONDISSE,district:section.properties.CIRCONSCRI,lastVisit:section.properties.DATE_DERNI,length:section.properties.LONGUEUR,streetName:section.properties.NOM_VOIE,regulated:section.properties.REGULE,type:section.properties.TYPE,effluentsType:section.properties.TYPE_EFFLU// TRANSFORME ZUP/YFOR to YUP/-ZFOR
  // Convert Y forward Z up to Y up - Z forward
  };line.geometry.rotateX(-(Math.PI/2));//            var boundingSphereCenter = line.geometry.center().negate() // Recenter geometry to mesh
  //            line.position.copy( boundingSphereCenter ) // Set previous geometry center as mesh position
  // Create ID sprit
  if(generateSpritId){firstPoint=geometry.vertices[0];lastPoint=geometry.vertices[geometry.vertices.length-1];sprit=TApplication.createSprite("T: "+sectionId);sprit.position.x=(firstPoint.x+lastPoint.x)/2;sprit.position.y=(firstPoint.y+lastPoint.y)/2+0.2;sprit.position.z=(firstPoint.z+lastPoint.z)/2;sprit.scale.x=2.5;sprit.scale.y=2.5;sprit.scale.z=2.5;line.add(sprit);}sectionGroup.add(line);}return sectionGroup;},createPathGroup:function createPathGroup(pathFile,color,generateSpritId,filters){if(!pathFile){console.error("Unable to create path group with null or undefined paths !!!");return;}color=color||0xffffff;generateSpritId=generateSpritId||false;filters=filters||null;var pathGroup=new Group();var lines=pathFile.split('\n');var numberOfLines=lines.length;var line=undefined;var words=undefined;var geometry=undefined;var material=undefined;var path=undefined;var pathId=undefined;for(var i=0;i<numberOfLines;i++){line=lines[i];words=line.split(" ");if(words.length===1){geometry=new Geometry();material=new LineBasicMaterial$1({color:color});}else if(words.length===2){pathId=words[1].replace(/(\r\n|\n|\r)/gm,"");geometry.rotateX(-(Math.PI/2));path=new Line$1(geometry,material);path.name=pathId;// Filter path on id
  if(filters&&filters.includes(pathId)===false){continue;}// Create Sprit if required with id
  // Create ID sprit
  if(generateSpritId){var firstPoint=geometry.vertices[0];var lastPoint=geometry.vertices[geometry.vertices.length-1];var sprit=TApplication.createSprite("P: "+pathId);sprit.position.x=(firstPoint.x+lastPoint.x)/2;sprit.position.y=(firstPoint.y+lastPoint.y)/2-0.5;sprit.position.z=(firstPoint.z+lastPoint.z)/2;sprit.scale.x=7;sprit.scale.y=7;sprit.scale.z=7;path.add(sprit);}pathGroup.add(path);}else if(words.length===3){geometry.vertices.push(new Vector3$1(parseFloat(words[0])-600200,parseFloat(words[1])-131400,parseFloat(words[2])-60));}else{console.error("Invalid words: "+words);}}return pathGroup;},createSprite:function createSprite(message,parameters){var spriteSideLength=parameters&&parameters.spriteSideLength?parameters.spriteSideLength:300;var fontFace=parameters&&parameters.fontFace?parameters.fontFace:"Arial";var fontSize=parameters&&parameters.fontSize?parameters.fontSize:"32";var textColor=parameters&&parameters.textColor?parameters.textColor:"white";var spriteCenter=spriteSideLength/2;var canvas=document.createElement('canvas');canvas.width=spriteSideLength;canvas.height=spriteSideLength;// get size data (height depends only on font size)
  var context=canvas.getContext('2d');context.font="Bold "+fontSize+"px "+fontFace;var textWidth=Math.round(context.measureText(message).width);context.fillStyle=textColor;context.fillText(message,spriteCenter-textWidth/2,spriteCenter+Number.parseInt(fontSize)/2);// canvas contents will be used for a texture
  var texture=new Texture$1(canvas);texture.minFilter=LinearFilter;texture.mapping=UVMapping;texture.needsUpdate=true;var spriteMaterial=new SpriteMaterial({map:texture});return new Sprite(spriteMaterial);},createFlowParticlesGroup:function createFlowParticlesGroup(splinePaths){if(!splinePaths){console.error("Unable to create flow particles group with null or undefined spline paths !!!");return;}var flowsGroup=new Group();var numberOfParticlesForPath=undefined;var path=undefined;var pathPoints=undefined;var particule=undefined;var flowParticles=undefined;var point=undefined;var flowParticulTexture=new Texture$1(particleTexture);flowParticulTexture.minFilter=LinearFilter;flowParticulTexture.needsUpdate=true;var flowMaterial=new SpriteMaterial({map:flowParticulTexture,color:new Color(0x4286f4),blending:AdditiveBlending});for(var pathIndex=0,numberOfPaths=splinePaths.length;pathIndex<numberOfPaths;pathIndex++){path=splinePaths[pathIndex];flowParticles=new Group();numberOfParticlesForPath=Math.ceil(path.getLength());pathPoints=path.getSpacedPoints(numberOfParticlesForPath);for(var i=0;i<numberOfParticlesForPath;i++){point=pathPoints[i];particule=new Sprite(flowMaterial);particule.position.x=point.x;particule.position.y=point.y;particule.position.z=point.z;particule.scale.x=0.5;particule.scale.y=0.5;particule.scale.z=0.5;flowParticles.add(particule);}createInterval(flowParticles,path,100);flowsGroup.add(flowParticles);}return flowsGroup;},computeSplinePath:function computeSplinePath(meshGroup,debug){if(!meshGroup){console.error("Unable to compute spline path with null or undefined linear meshes !!!");return;}debug=debug||false;var splinePaths=[];var splinePath=undefined;var mesh=undefined;for(var sectionIndex=0,numberOfSection=meshGroup.children.length;sectionIndex<numberOfSection;sectionIndex++){mesh=meshGroup.children[sectionIndex];splinePath=new CatmullRomCurve3(mesh.geometry.vertices);splinePath.type="catmullrom";splinePath.tension=0.05;splinePath.name=mesh.name;if(debug){var splineMaterial=new LineBasicMaterial$1({color:0xff00f0});var splinePoints=splinePath.getPoints(500);var splineGeometry=new Geometry();for(var i=0;i<splinePoints.length;i++){splineGeometry.vertices.push(splinePoints[i]);}var spline=new Line$1(splineGeometry,splineMaterial);meshGroup.add(spline);}splinePaths.push(splinePath);}return splinePaths;}});/**
   * Public methods
   */Object.assign(TApplication.prototype,{/**
       * @memberOf TApplication.prototype
       */initRequest:function initRequest(){var request=new XMLHttpRequest();request.onreadystatechange=function onReadyStateChange(){if(request.readyState===4){if(request.status===200){var response=JSON.parse(request.response);console.log(response);}else{var response=JSON.parse(request.response);console.error(response);}}};request.onprogress=function onProgress(progressEvent){console.log(progressEvent);};request.onload=function onLoad(loadEvent){console.log(loadEvent);};request.onerror=function onError(error){console.error(error);};request.open('GET','turlututu');},// Public methods
  addObjectToModel:function addObjectToModel(object){if(!object){console.error('TApplication: Unable to add null or undefined object !!!');return;}this.insertTreeViewItem2(object);this.webglViewport.scene.add(object);this.webglViewport.raycastables.push(object);},// TreeView
  insertTreeViewItem2:function insertTreeViewItem2(object){var isCheckedByDefault=arguments.length>1&&arguments[1]!==undefined?arguments[1]:true;var recursive=arguments.length>2&&arguments[2]!==undefined?arguments[2]:true;var itemId=object.uuid;var itemName=object.name===""?itemId:object.name;var parentId=object.parent===null?'treeViewContainer':object.parent.uuid;var checked=isCheckedByDefault?'checked="checked"':'';var domElement='<li id="'+itemId+'">\n                                <input type="checkbox" id="'+itemId+'ExpandCheckbox" />\n                                    <label>\n                                        <input type="checkbox" id="'+itemId+'VisibilityCheckbox" '+checked+' />\n                                        <span></span>\n                                    </label>   \n                                    <label for="'+itemId+'ExpandCheckbox">'+itemName+'</label>   \n                                    <ul class="children"></ul>\n                            </li>';var item=$(domElement);item.find('#'+itemId+'VisibilityCheckbox').on('click',function toggleVisibility(){object.visible=this.checked;});$('#'+parentId).children('.children').append(item);if(recursive){var children=object.children;for(var childIndex=0,numberOfChildren=children.length;childIndex<numberOfChildren;childIndex++){this.insertTreeViewItem2(children[childIndex]);}}},/**
       * @memberOf TApplication.prototype
       */insertTreeViewItem:function insertTreeViewItem(itemId,itemName,parentId,isCheckedByDefault){if(itemName===""){itemName=itemId;}parentId=parentId||'treeViewContainer';var concatedParentName=parentId.replace(/\s/g,'');var undottedParentName=concatedParentName.replace(/\./g,'');var unslashedParentName=undottedParentName.replace(/\//g,'');var unsquaredParentName=unslashedParentName.replace(/[\[\]@]+/g,'');var selectableParentName=unsquaredParentName.replace(/[<{(')}>]/g,'');var cleanParentName=TApplication.removeDiacritics(selectableParentName);var checked=isCheckedByDefault?'checked="checked"':'';var domElement=''+(''+'<li id="'+itemId+'">'+'   <input type="checkbox" id="'+itemId+'ExpandCheckbox" />'+'   <label>'+'       <input type="checkbox" id="'+itemId+'VisibilityCheckbox" '+checked+' /><span></span>'+'   </label>'+'   <label for="'+itemId+'ExpandCheckbox">'+itemName+'</label>'+'   <ul class="children"></ul>'+'</li>');var item=$(domElement);$('#'+cleanParentName).children('.children').append(item);return item;},/**
       * @memberOf TApplication.prototype
       */changeMaterialSide:function changeMaterialSide(objects,xRayActive){var object=undefined;for(var objectIndex=0,numberOfObjects=objects.length;objectIndex<numberOfObjects;++objectIndex){object=objects[objectIndex];if(object.type==='Mesh'){object.material.side=xRayActive?BackSide:FrontSide;}else if(object.type==='Group'){this.changeMaterialSide.call(this,object.children,xRayActive);}}},// Layers
  /**
       * @memberOf TApplication.prototype
       */setLayerGroupVisibility:function setLayerGroupVisibility(groupName,visibility){if(groupName==='tigre'){this.geomapViewer.layerGroupSetVisible('Tigre',visibility,function(){this.geomapViewer.mapRefresh();},this);this.webglViewport.setGroupVisibility('TigerParticularEmbranchments',visibility);this.webglViewport.setGroupVisibility('TigerNodes',visibility);this.webglViewport.setGroupVisibility('TigerSections',visibility);}else if(groupName==='caiman'){this.geomapViewer.layerGroupSetVisible('Caiman',visibility,function(){this.geomapViewer.mapRefresh();},this);this.webglViewport.setGroupVisibility('CaimanParticularEmbranchments',visibility);this.webglViewport.setGroupVisibility('CaimanNodes',visibility);this.webglViewport.setGroupVisibility('CaimanSections',visibility);}else if(groupName==='radier'){this.webglViewport.setGroupVisibility('radierGroup',visibility);}else if(groupName==='surface'){this.webglViewport.setGroupVisibility('GroundLayer',visibility);this.updateMeshResolution(0);}else if(groupName==='maçonnerie'){this.webglViewport.setGroupVisibility('UndergroundLayer',visibility);this.updateMeshResolution(0);}else if(groupName==='nuage'){this.webglViewport.setGroupVisibility('PointClouds',visibility);}else if(groupName==='flow'){this.webglViewport.setGroupVisibility('flowParticles',visibility);}else{this.webglViewport.setGroupVisibility(groupName,visibility);}},/**
       * @memberOf TApplication.prototype
       */loadObjectFromURL:function loadObjectFromURL(filesUrls){this.universalLoader.load(filesUrls,this.addObjectToModel.bind(this));},/**
       * @memberOf TApplication.prototype
       */updateDataPanel:function updateDataPanel(){// Todo make it efficient !!!
  // Get curve distance from start of path to current camera position
  var distanceFromStart=this.webglViewport.pathControl.getDistanceFromStart();// Get closest section and get his data to display
  var sections=this.webglViewport.scene.getObjectByName('CaimanSections');if(!sections){console.error("Unable to update data panel with null sections !");return;}var cameraPosition=this.webglViewport.pathControl.camera.position;var tinyestDistanceToCamera=Infinity;var distanceToCamera=undefined;var section=undefined;var closestSectionId=undefined;var vertice=undefined;for(var sectionIndex=0,numberOfSections=sections.children.length;sectionIndex<numberOfSections;sectionIndex++){section=sections.children[sectionIndex];for(var i=0,numberOfVertices=section.geometry.vertices.length;i<numberOfVertices;i++){vertice=section.geometry.vertices[i];distanceToCamera=cameraPosition.distanceTo(vertice);if(distanceToCamera<tinyestDistanceToCamera){tinyestDistanceToCamera=distanceToCamera;closestSectionId=sectionIndex;// Arrow helpers
  //                    var direction = new Vector3().subVectors( vertice, cameraPosition ).normalize()
  //                    var arrow = new ArrowHelper( direction, cameraPosition, distanceToCamera )
  //                    this.webglViewport.scene.add( arrow )
  }}}var sectionData=sections.children[closestSectionId].userData;// Clear dataPanel content
  this.resetDataPanel();// Fill content
  var paragraph=null;paragraph=document.createElement('p');paragraph.textContent="Distance: "+distanceFromStart.toFixed(2)+" m";this.dataPanel.appendChild(paragraph);paragraph=document.createElement('p');paragraph.textContent="Arrondissement: "+sectionData.borough;this.dataPanel.appendChild(paragraph);paragraph=document.createElement('p');paragraph.textContent="Circonscription: "+sectionData.district;this.dataPanel.appendChild(paragraph);paragraph=document.createElement('p');paragraph.textContent="Nom de voie: "+sectionData.streetName;this.dataPanel.appendChild(paragraph);paragraph=document.createElement('p');paragraph.textContent="Type: "+sectionData.type;this.dataPanel.appendChild(paragraph);paragraph=document.createElement('p');paragraph.textContent="Type d'effluent: "+sectionData.effluentsType;this.dataPanel.appendChild(paragraph);paragraph=document.createElement('p');paragraph.textContent="Longueur: "+sectionData.length.toFixed(2)+" m";this.dataPanel.appendChild(paragraph);paragraph=document.createElement('p');paragraph.textContent="Dernière visite: "+sectionData.lastVisit;this.dataPanel.appendChild(paragraph);paragraph=document.createElement('p');var regulatedStringState=sectionData.regulated==0?'Non':'Oui';paragraph.textContent="Regulé: "+regulatedStringState;this.dataPanel.appendChild(paragraph);},/**
       * @memberOf TApplication.prototype
       */resetDataPanel:function resetDataPanel(){this.dataPanel.innerHTML="";},/**
       * @memberOf TApplication.prototype
       */startMeasure:function startMeasure(measureMode){this.webglViewport.view[0].className="crosshair";var measureGroup=this.webglViewport.scene.getObjectByName('MeasureGroup');if(!measureGroup){measureGroup=new Group();measureGroup.name='MeasureGroup';this.webglViewport.scene.add(measureGroup);}this.measureMode=measureMode;this.webglViewport.measuring=true;if(this.measureMode==='segment'){this.currentMeasureGroup=new Group();this.currentMeasureGroup.name='Segment.'+this.measureCounter;}else if(this.measureMode==='polyline'){this.currentMeasureGroup=new Group();this.currentMeasureGroup.name='PolyLigne.'+this.measureCounter;}else if(this.measureMode==='polysegment'){this.currentMeasureGroup=new Group();this.currentMeasureGroup.name='PolySegment.'+this.measureCounter;}else if(this.measureMode==='clear'){this.endMeasure();this.removeMeasure();}else{}//TODO: check other measure tools !!!
  //Todo: in function of measure type change subGroup
  measureGroup.add(this.currentMeasureGroup);},/**
       * @memberOf TApplication.prototype
       */updateTemporaryMeasure:function updateTemporaryMeasure(event){var self=this;var intersectionPoint=this.webglViewport.intersection.point;var measureGroupChildren=this.currentMeasureGroup.children;if(this.measureMode==='segment'){var lastMeasurePoint=measureGroupChildren[measureGroupChildren.length-1];if(lastMeasurePoint){//update temp line
  var temporaryMeasureLine=this.webglViewport.scene.getObjectByName('TemporaryMeasureLine');if(!temporaryMeasureLine){temporaryMeasureLine=createTemporaryMeasureLine();}updateTemporaryMeasureLine();// update temp distance label
  updateTemporaryMeasureDistanceLabel(temporaryMeasureLine);}var temporaryMeasurePoint=this.webglViewport.scene.getObjectByName('TemporaryMeasurePoint');if(!temporaryMeasurePoint){temporaryMeasurePoint=createTemporaryMeasurePoint();}updateTemporaryMeasurePoint(intersectionPoint);}else if(this.measureMode==='polyline'){var lastMeasurePoint=measureGroupChildren[measureGroupChildren.length-1];if(lastMeasurePoint){//update temp line
  var temporaryMeasureLine=this.webglViewport.scene.getObjectByName('TemporaryMeasureLine');if(!temporaryMeasureLine){temporaryMeasureLine=createTemporaryMeasureLine();}updateTemporaryMeasureLine();// update temp distance label
  updateTemporaryMeasureDistanceLabel(temporaryMeasureLine);}var temporaryMeasurePoint=this.webglViewport.scene.getObjectByName('TemporaryMeasurePoint');if(!temporaryMeasurePoint){temporaryMeasurePoint=createTemporaryMeasurePoint();}updateTemporaryMeasurePoint(intersectionPoint);}else if(this.measureMode==='polysegment'){var lastMeasurePoint=measureGroupChildren[0];if(lastMeasurePoint){//update temp line
  var temporaryMeasureLine=this.webglViewport.scene.getObjectByName('TemporaryMeasureLine');if(!temporaryMeasureLine){temporaryMeasureLine=createTemporaryMeasureLine();}updateTemporaryMeasureLine();// update temp distance label
  updateTemporaryMeasureDistanceLabel(temporaryMeasureLine);}var temporaryMeasurePoint=this.webglViewport.scene.getObjectByName('TemporaryMeasurePoint');if(!temporaryMeasurePoint){temporaryMeasurePoint=createTemporaryMeasurePoint();}updateTemporaryMeasurePoint(intersectionPoint);}else{//TODO: check other measure tools !!!
  }function createTemporaryMeasureLine(){var geometry=new Geometry();geometry.vertices.push(new Vector3$1());geometry.vertices.push(new Vector3$1());var material=new LineBasicMaterial$1({color:0x4286f4});var temporaryMeasureLine=new Line$1(geometry,material);temporaryMeasureLine.name='TemporaryMeasureLine';self.webglViewport.scene.add(temporaryMeasureLine);return temporaryMeasureLine;}function updateTemporaryMeasureLine(){temporaryMeasureLine.geometry.vertices[0]=lastMeasurePoint.position.clone();temporaryMeasureLine.geometry.vertices[1]=intersectionPoint.clone();temporaryMeasureLine.geometry.verticesNeedUpdate=true;}function updateTemporaryMeasureDistanceLabel(temporaryMeasureLine){var temporaryMeasureDistanceLabel=self.webglViewport.scene.getObjectByName('TemporaryMeasureDistanceLabel');if(temporaryMeasureDistanceLabel){temporaryMeasureLine.remove(temporaryMeasureDistanceLabel);}var lastMeasurePointPosition=lastMeasurePoint.position;var distance=lastMeasurePointPosition.distanceTo(intersectionPoint);var sprit=TApplication.createSprite(distance.toFixed(3)+'m');sprit.name='TemporaryMeasureDistanceLabel';sprit.position.x=(lastMeasurePointPosition.x+intersectionPoint.x)/2;sprit.position.y=(lastMeasurePointPosition.y+intersectionPoint.y)/2+0.2;sprit.position.z=(lastMeasurePointPosition.z+intersectionPoint.z)/2;temporaryMeasureLine.add(sprit);}function createTemporaryMeasurePoint(){var geometry=new SphereBufferGeometry(0.01,3,3);var material=new MeshLambertMaterial$1({color:0x4286f4,side:FrontSide});var temporaryMeasurePoint=new Mesh(geometry,material);temporaryMeasurePoint.name='TemporaryMeasurePoint';self.webglViewport.scene.add(temporaryMeasurePoint);return temporaryMeasurePoint;}function updateTemporaryMeasurePoint(newPosition){temporaryMeasurePoint.position.copy(newPosition);}},/**
       * @memberOf TApplication.prototype
       */removeTemporaryMeasure:function removeTemporaryMeasure(){this.webglViewport.scene.remove(this.webglViewport.scene.getObjectByName('TemporaryMeasurePoint'));this.webglViewport.scene.remove(this.webglViewport.scene.getObjectByName('TemporaryMeasureLine'));this.webglViewport.scene.remove(this.webglViewport.scene.getObjectByName('TemporaryMeasureDistanceLabel'));},/**
       * @memberOf TApplication.prototype
       */updateMeasure:function updateMeasure(event){var intersectionPoint=this.webglViewport.intersection.point;var measureGroupChildren=this.currentMeasureGroup.children;if(this.measureMode==='segment'){var lastMeasurePoint=measureGroupChildren[measureGroupChildren.length-1];if(lastMeasurePoint){//update line
  var newMeasureLine=createMeasureLine();this.currentMeasureGroup.add(newMeasureLine);// update distance label
  createMeasureDistanceLabel(newMeasureLine);}var measurePoint=createMeasurePoint();this.currentMeasureGroup.add(measurePoint);if(measureGroupChildren.length===3){this.removeTemporaryMeasure();this.startMeasure(this.measureMode);}}else if(this.measureMode==='polyline'){var lastMeasurePoint=measureGroupChildren[measureGroupChildren.length-1];if(lastMeasurePoint){//update line
  var newMeasureLine=createMeasureLine();this.currentMeasureGroup.add(newMeasureLine);// update distance label
  createMeasureDistanceLabel(newMeasureLine);}var measurePoint=createMeasurePoint();this.currentMeasureGroup.add(measurePoint);}else if(this.measureMode==='polysegment'){var lastMeasurePoint=measureGroupChildren[0];if(lastMeasurePoint){//update line
  var newMeasureLine=createMeasureLine();this.currentMeasureGroup.add(newMeasureLine);// update distance label
  createMeasureDistanceLabel(newMeasureLine);}var measurePoint=createMeasurePoint();this.currentMeasureGroup.add(measurePoint);}else{//TODO: check other measure tools !!!
  }function createMeasureLine(){var geometry=new Geometry();geometry.vertices.push(lastMeasurePoint.position.clone());geometry.vertices.push(intersectionPoint.clone());var material=new LineBasicMaterial$1({color:0x4286f4});return new Line$1(geometry,material);}function createMeasureDistanceLabel(measureLine){var lastMeasurePointPosition=lastMeasurePoint.position;var distance=lastMeasurePointPosition.distanceTo(intersectionPoint);var sprit=TApplication.createSprite(distance.toFixed(3)+'m');sprit.position.x=(lastMeasurePointPosition.x+intersectionPoint.x)/2;sprit.position.y=(lastMeasurePointPosition.y+intersectionPoint.y)/2+0.2;sprit.position.z=(lastMeasurePointPosition.z+intersectionPoint.z)/2;measureLine.add(sprit);}function createMeasurePoint(){var geometry=new SphereBufferGeometry(0.01,3,3);var material=new MeshLambertMaterial$1({color:0x4286f4,side:FrontSide});var point=new Mesh(geometry,material);point.position.copy(intersectionPoint);return point;}},/**
       * @memberOf TApplication.prototype
       */endMeasure:function endMeasure(){this.webglViewport.view[0].className="";this.webglViewport.measuring=false;// Remove temp measure
  this.removeTemporaryMeasure();// Increment measure group counter
  this.measureCounter++;},/**
       * @memberOf TApplication.prototype
       */removeMeasure:function removeMeasure(){while(this.measureCounter>=0){var measureGroup=this.webglViewport.scene.getObjectByName('MeasureGroup');this.webglViewport.scene.remove(measureGroup);this.measureCounter=-1;//            var segmentToRemove = this.webglViewport.scene.getObjectByName( 'Segment.' + this.measureCounter )
  //            this.webglViewport.scene.remove( segmentToRemove )
  //
  //            var polylineToRemove = this.webglViewport.scene.getObjectByName( 'PolyLigne.' + this.measureCounter )
  //            this.webglViewport.scene.remove( polylineToRemove )
  //
  //            var polysegmentToRemove = this.webglViewport.scene.getObjectByName( 'PolySegment.' + this.measureCounter )
  //            this.webglViewport.scene.remove( polysegmentToRemove )
  //
  //            this.measureCounter--
  }},/**
       * @memberOf TApplication.prototype
       */updateImageShot:function updateImageShot(){//Todo: Think of the fact that the shots are low compared to the camera position
  var shotGroup=this.webglViewport.scene.getObjectByName('shotGroup');if(!shotGroup){console.error("Unable to update images shot with null shots !");return;}var camera=this.webglViewport.camera;// every time the camera or objects change position (or every frame)
  camera.updateMatrixWorld();// make sure the camera matrix is updated
  camera.matrixWorldInverse.getInverse(camera.matrixWorld);cameraViewProjectionMatrix.multiplyMatrices(camera.projectionMatrix,camera.matrixWorldInverse);frustum.setFromMatrix(cameraViewProjectionMatrix);var MAXIMUM_DISTANCE_TO=4;//m use SQUARED distance for perf
  var cameraPosition=camera.getWorldPosition();var cameraDirection=camera.getWorldDirection();var shots=shotGroup.children;var shot=undefined;var bestShot=undefined;var distanceToCamera=undefined;var shotPosition=undefined;var shotOrientation=undefined;var dotProduct=undefined;var result=undefined;var bestResult=Infinity;for(var shotIndex=0,numberOfShots=shots.length;shotIndex<numberOfShots;shotIndex++){shot=shots[shotIndex];if(!frustum.intersectsObject(shot)){continue;}shotPosition=shot.getWorldPosition();distanceToCamera=shotPosition.distanceToSquared(cameraPosition);if(distanceToCamera>MAXIMUM_DISTANCE_TO){continue;}shotOrientation=shot.getWorldDirection();dotProduct=shotOrientation.dot(cameraDirection);if(dotProduct>0){continue;}result=dotProduct/distanceToCamera;if(result<bestResult){bestResult=result;bestShot=shot;}}if(bestShot&&this.previousImageShot!==bestShot){this.previousImageShot=bestShot;//			shot.visible   = true
  //			var shotDirAxe = new ArrowHelper( bestShot.getWorldDirection(), bestShot.getWorldPosition(), 1, 0x00ffff )
  //			this.webglViewport.scene.add( shotDirAxe )
  //			shot.material.map        = imageLoader.load( "resources/images/none_image.png" )
  //			shot.material.needUpdate = true
  this.thumbnailPanel.innerHTML="";var thumbnails=imageLoader.load(bestShot.userData.filePath+"LD/"+bestShot.name);var link=document.createElement('a');link.appendChild(thumbnails);link.onclick=function(){this.popupImageShotModal();}.bind(this);this.thumbnailPanel.appendChild(link);}},/**
       * @memberOf TApplication.prototype
       */popupImportFilesModal:function popupImportFilesModal(){var self=this;self.importFilesModalView.modal('show');},/**
       * @memberOf TApplication.prototype
       */popupImageShotModal:function popupImageShotModal(){var self=this;var previousImageShot=self.previousImageShot;var url=previousImageShot.userData.filePath+'HD/'+previousImageShot.name;imageLoader.load(url,function onLoad(imageHD){if(!imageHD){console.error("Unable to display empty or null hd image !");return;}var link=document.createElement('a');link.setAttribute('href',self.previousImageShot.userData.filePath+"HD/"+self.previousImageShot.name);link.setAttribute('target',"_blank");link.appendChild(imageHD);var modalContent=document.getElementById('imageShotModalContent');while(modalContent.lastChild){modalContent.removeChild(modalContent.lastChild);}modalContent.appendChild(link);self.imageShotModalView.modal('show');});},/**
       * @memberOf TApplication.prototype
       */popupSelectedObjectModal:function popupSelectedObjectModal(){var selectedObject=this.webglViewport.selected;var userData=selectedObject.userData||selectedObject.parent.userData;var ul=document.createElement('ul');processDataObject(userData,ul);var carlId=userData.id.slice(0,-4).toUpperCase();var modalHeader=document.getElementById('selectedObjectHeader');modalHeader.innerHTML="";modalHeader.appendChild(createHeaderTitle(selectedObject.name));modalHeader.appendChild(createHeaderButtons(carlId));var selectedObjectContent=document.getElementById('selectedObjectContent');selectedObjectContent.innerHTML="";selectedObjectContent.appendChild(ul);this.selectedObjectModalView.modal('show');function processDataObject(dataObject,container){for(var dataName in dataObject){if(dataName==='revit_id'){continue;}var data=dataObject[dataName];var liElement=document.createElement('li');var titleElement=document.createElement('b');titleElement.innerText=dataName+': ';if((typeof data==='undefined'?'undefined':_typeof(data))==='object'){liElement.appendChild(titleElement);var ulElement=document.createElement('ul');processDataObject(data,ulElement);liElement.appendChild(ulElement);}else{liElement.appendChild(titleElement);var dataElement=document.createElement('span');dataElement.innerText=data;liElement.appendChild(dataElement);}container.appendChild(liElement);}}function createHeaderTitle(title){var headerTitle=document.createElement('h4');headerTitle.classList.add('modal-title');headerTitle.innerHTML=title||'Selection';headerTitle.style.display='inline-block';headerTitle.style.width='20%';return headerTitle;}function createHeaderButtons(carlId){var buttonsContainer=document.createElement('div');buttonsContainer.style.display='inline-block';buttonsContainer.style.width='80%';buttonsContainer.style.textAlign='right';var editButton=createButton(carlId,'pencil','Détails équipement');editButton.onclick=function(event){var carlId=event.currentTarget.value;parent.postMessage('GISDetailAction#-#'+carlId+';com.carl.xnet.equipment.backend.bean.MaterialBean#+#','*');};buttonsContainer.appendChild(editButton);var historyButton=createButton(carlId,'history','Historique d\'intervention');historyButton.onclick=function(event){var carlId=event.currentTarget.value;parent.postMessage('WOViewAction#-#'+carlId+';com.carl.xnet.equipment.backend.bean.MaterialBean#+#','*');};buttonsContainer.appendChild(historyButton);var createInterButton=createButton(carlId,'flash','Création d\'intervention');createInterButton.onclick=function(event){var carlId=event.currentTarget.value;parent.postMessage('CREATE_WO#-#'+carlId+';com.carl.xnet.equipment.backend.bean.MaterialBean#+#','*');};buttonsContainer.appendChild(createInterButton);return buttonsContainer;}function createButton(idValue,iconName,toolTip){var button=document.createElement('button');button.classList.add('btn');button.setAttribute('title',toolTip);button.setAttribute('value',idValue);button.style.marginLeft='5px';var icon=document.createElement('i');icon.classList.add('fa');icon.classList.add('fa-'+iconName);button.appendChild(icon);return button;}},/**
       * @memberOf TApplication.prototype
       */updatePointCloudDensity:function updatePointCloudDensity()/*delay*/{var cameraPosition=this.webglViewport.camera.getWorldPosition();var delay=500;if(this.pointCloudManager){clearTimeout(this.updatePointCloudTimeout);this.updatePointCloudTimeout=setTimeout(this.pointCloudManager.updatePointClouds.bind(this.pointCloudManager),delay,cameraPosition);}},/**
       * @memberOf TApplication.prototype
       */updateMeshResolution:function updateMeshResolution()/*delay*/{var delay=500;if(this.meshManager){clearTimeout(this.updateMeshTimeout);this.updateMeshTimeout=setTimeout(this.meshManager.updateMeshes.bind(this.meshManager),delay);}},/**
       * @memberOf TApplication.prototype
       */updateAvatar:function updateAvatar(){var avatar=this.webglViewport.scene.getObjectByName("Avatar");if(!avatar){return;}var cameraControllerType=this.webglViewport.cameraControlType;if(cameraControllerType==='orbital'){avatar.visible=true;}else if(cameraControllerType==='path'){avatar.visible=false;// CAMERA PART
  var cameraPosition=this.webglViewport.camera.getWorldPosition();var cameraDirection=this.webglViewport.camera.getWorldDirection();// CameraHelper
  //            var cameraDirectionHelper = new ArrowHelper( cameraDirection, cameraPosition, 1 )
  //            cameraDirectionHelper.name = 'cameraDirectionHelper'
  //            this.webglViewport.scene.remove( this.webglViewport.scene.getObjectByName('cameraDirectionHelper') )
  //            this.webglViewport.scene.add( cameraDirectionHelper )
  // PATH PART
  var currentPathPosition=this.webglViewport.pathControl.getCurrentPathPosition();var nextPathPosition=this.webglViewport.pathControl.getNextPathPosition();var pathDirection=new Vector3$1();pathDirection.subVectors(nextPathPosition,currentPathPosition);pathDirection.normalize();// Path Helper
  //            var pathDirectionHelper = new ArrowHelper( pathDirection, currentPathPosition, 1 )
  //            pathDirectionHelper.name = 'pathDirectionHelper'
  //            this.webglViewport.scene.remove( this.webglViewport.scene.getObjectByName('pathDirectionHelper') )
  //            this.webglViewport.scene.add( pathDirectionHelper )
  avatar.position.copy(currentPathPosition);if(cameraDirection.dot(pathDirection)>0){avatar.lookAt(nextPathPosition);}else{avatar.lookAt(nextPathPosition.negate());}var rad=115*Math.PI/180;avatar.rotateY(rad);}},/**
       * @memberOf TApplication.prototype
       */setCameraMode:function setCameraMode(mode){this.webglViewport.setCameraControls(mode);if(mode==="avatar"){}else{//            this.meshManager.setResolutionMap( this.meshManagerOrbitalResolutionMap )
  //            this.updateMeshResolution()
  //            this.updatePointCloudDensity()
  this.resetDataPanel();//            this.updateAvatar()
  }},/**
       * @memberOf TApplication.prototype
       */setRendersEffect:function setRendersEffect(effect){this.webglViewport.setCameraEffect(effect);},/**
       * @memberOf TApplication.prototype
       */askUserForPosition:function askUserForPosition(){var self=this;this.geomapViewer.digitizePoint("Cliquer sur la carte",true,function(event){//Do something with the geometry
  var geometry=event.geometry;if(!geometry){console.warn("Unable to find geometry in tiger event !");return;}var coordinates=geometry.coordinate;if(!coordinates){console.warn("Unable to find coordinates in tiger geometry !");return;}var scale=100;// convert Lambert 93 coords to local webgl coords
  // WebGl is Y up and -Z forward !
  var webglCoordinates=convertLambert93CoordinatesToWebGLCoordinates(coordinates);webglCoordinates.y=scale/3;this.geomapViewer.zoomToView(coordinates.x,coordinates.y,scale,function(event){},this);self.webglViewport.setCameraPosition(webglCoordinates);},self);},/**
       * @memberOf TApplication.prototype
       */setMapViewer:function setMapViewer(viewer){this.viewer=viewer;this.updateMapViewer();},/**
       * Update camera viewers
       *
       * @memberOf TApplication.prototype
       */updateMapViewer:function updateMapViewer(){this.updateMapViewerPosition();this.updateMapViewerOrientation();this.updateMapViewerDisplay();},/**
       * Update camera position
       *
       * @memberOf TApplication.prototype
       */updateMapViewerPosition:function updateMapViewerPosition(){var cameraPosition=this.webglViewport.camera.position;if(!cameraPosition){console.warn("Unable to find coordinates of webgl camera !");return;}var viewer=this.viewer;if(viewer==='2d'){if(!this.geomapViewer){return;}// convert local webgl coords to Lambert 93 coords
  var lambertCoordinates=convertWebGLCoordinatesToLambert93Coordinates(cameraPosition);var scale=150;var mySymbol={"x":lambertCoordinates.x,"y":lambertCoordinates.y,"color":"00FF00","size":"25pt","symbol":"f1eb"};this.geomapViewer.zoomToView(lambertCoordinates.x,lambertCoordinates.y,scale,function(event){},this);this.geomapViewer.symbolDraw("mySymbolLayer",mySymbol,true);}else if(viewer==='3d'){var currentLocation=this.rlensViewer.getLocation();if(!currentLocation||this.previousLocation.id!==currentLocation.id){this.rlensViewer.setLocation('2 Boulevard Saint Michel, Paris').then(function(location){this.previousLocation=location;}.bind(this)).catch(function(e){console.error(e);});}}else{console.error("Unable to set rotation, unknown viewer: "+this.viewer);}},/**
       * Update camera orientation
       * @memberOf TApplication.prototype
       */updateMapViewerOrientation:function updateMapViewerOrientation(){var cameraWorldDirection=this.webglViewport.camera.getWorldDirection();if(!cameraWorldDirection){console.error('Invalid direction vector !!!');return;}var viewer=this.viewer;if(this.viewer==='2d'){if(!this.geomapViewer){return;}var position=convertWebGLCoordinatesToLambert93Coordinates(this.webglViewport.camera.position);var rotation=convertWebGLRotationToTopologicalYawPitch(cameraWorldDirection);var cameraSymbol={"x":position.x,"y":position.y,"rotation":rotation.yaw,"color":"00FF00","size":"25pt","symbol":"f1eb"};if(this.webglViewport.cameraControlType==='path'){this.geomapViewer.zoomToView(position.x,position.y,150,function(event){},this);}else if(this.webglViewport.cameraControlType==='orbital'){//Todo: Center on target and set correct scale in function of camera to target distance
  }this.geomapViewer.symbolDraw("mySymbolLayer",cameraSymbol,true);}else if(this.viewer==='3d'){if(this.previousLocation){var rotation=convertWebGLRotationToTopologicalYawPitch(cameraWorldDirection);var yawPitch=new H.realitylens.YawPitch(rotation);this.rlensViewer.setViewDirection(yawPitch,0);}}else{console.error("Unable to set rotation, unknown viewer: "+this.viewer);}},/**
       * @memberOf TApplication.prototype
       */updateMapViewerDisplay:function updateMapViewerDisplay(){if(!this.geomapViewer&&!this.rlensPanel){return;}else if(this.geomapViewer&&!this.rlensPanel){this.geomapPanel.style.display='block';return;}else if(!this.geomapViewer&&this.rlensPanel){this.rlensPanel.style.display='block';return;}var viewer=this.viewer;if(viewer==='2d'){this.rlensPanel.style.display='none';this.geomapPanel.style.display='block';}else if(viewer==='3d'){this.geomapPanel.style.display='none';this.rlensPanel.style.display='block';}else{this.rlensPanel.style.display='none';this.geomapPanel.style.display='none';console.error('Invalid map viewer options !!! Available options are: 2d or 3d.');}}});/**
   * @author [Tristan Valcke]{@link https://github.com/Itee}
   * @license [BSD-3-Clause]{@link https://opensource.org/licenses/BSD-3-Clause}
   *
   * @file Intermediary export file for cores folder
   *
   *//**
   * @author [Tristan Valcke]{@link https://github.com/Itee}
   * @license [BSD-3-Clause]{@link https://opensource.org/licenses/BSD-3-Clause}
   *
   * @file Intermediary export file for objects3d folder
   *
   *//*
  object-assign
  (c) Sindre Sorhus
  @license MIT
  *//* eslint-disable no-unused-vars */var getOwnPropertySymbols=Object.getOwnPropertySymbols;var hasOwnProperty=Object.prototype.hasOwnProperty;var propIsEnumerable=Object.prototype.propertyIsEnumerable;function toObject(val){if(val===null||val===undefined){throw new TypeError('Object.assign cannot be called with null or undefined');}return Object(val);}function shouldUseNative(){try{if(!Object.assign){return false;}// Detect buggy property enumeration order in older V8 versions.
  // https://bugs.chromium.org/p/v8/issues/detail?id=4118
  var test1=new String('abc');// eslint-disable-line no-new-wrappers
  test1[5]='de';if(Object.getOwnPropertyNames(test1)[0]==='5'){return false;}// https://bugs.chromium.org/p/v8/issues/detail?id=3056
  var test2={};for(var i=0;i<10;i++){test2['_'+String.fromCharCode(i)]=i;}var order2=Object.getOwnPropertyNames(test2).map(function(n){return test2[n];});if(order2.join('')!=='0123456789'){return false;}// https://bugs.chromium.org/p/v8/issues/detail?id=3056
  var test3={};'abcdefghijklmnopqrst'.split('').forEach(function(letter){test3[letter]=letter;});if(Object.keys(Object.assign({},test3)).join('')!=='abcdefghijklmnopqrst'){return false;}return true;}catch(err){// We don't expect any of the above to throw, but better to be safe.
  return false;}}var objectAssign=shouldUseNative()?Object.assign:function(target,source){var from;var to=toObject(target);var symbols;for(var s=1;s<arguments.length;s++){from=Object(arguments[s]);for(var key in from){if(hasOwnProperty.call(from,key)){to[key]=from[key];}}if(getOwnPropertySymbols){symbols=getOwnPropertySymbols(from);for(var i=0;i<symbols.length;i++){if(propIsEnumerable.call(from,symbols[i])){to[symbols[i]]=from[symbols[i]];}}}}return to;};/**
   * Copyright (c) 2013-present, Facebook, Inc.
   *
   * This source code is licensed under the MIT license found in the
   * LICENSE file in the root directory of this source tree.
   *
   */var emptyObject={};{Object.freeze(emptyObject);}var emptyObject_1=emptyObject;/**
   * Copyright (c) 2013-present, Facebook, Inc.
   *
   * This source code is licensed under the MIT license found in the
   * LICENSE file in the root directory of this source tree.
   *
   * 
   */function makeEmptyFunction(arg){return function(){return arg;};}/**
   * This function accepts and discards inputs; it has no side effects. This is
   * primarily useful idiomatically for overridable function endpoints which
   * always need to be callable, since JS lacks a null-call idiom ala Cocoa.
   */var emptyFunction=function emptyFunction(){};emptyFunction.thatReturns=makeEmptyFunction;emptyFunction.thatReturnsFalse=makeEmptyFunction(false);emptyFunction.thatReturnsTrue=makeEmptyFunction(true);emptyFunction.thatReturnsNull=makeEmptyFunction(null);emptyFunction.thatReturnsThis=function(){return this;};emptyFunction.thatReturnsArgument=function(arg){return arg;};var emptyFunction_1=emptyFunction;var q="function"===typeof Symbol&&Symbol["for"];var r=q?Symbol["for"]("react.element"):60103;var t=q?Symbol["for"]("react.call"):60104;var u=q?Symbol["for"]("react.return"):60105;var v=q?Symbol["for"]("react.portal"):60106;var w=q?Symbol["for"]("react.fragment"):60107;var x="function"===typeof Symbol&&Symbol.iterator;function y(a){for(var b=arguments.length-1,e="Minified React error #"+a+"; visit http://facebook.github.io/react/docs/error-decoder.html?invariant\x3d"+a,c=0;c<b;c++){e+="\x26args[]\x3d"+encodeURIComponent(arguments[c+1]);}b=Error(e+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings.");b.name="Invariant Violation";b.framesToPop=1;throw b;}var z={isMounted:function isMounted(){return!1;},enqueueForceUpdate:function enqueueForceUpdate(){},enqueueReplaceState:function enqueueReplaceState(){},enqueueSetState:function enqueueSetState(){}};function A(a,b,e){this.props=a;this.context=b;this.refs=emptyObject_1;this.updater=e||z;}A.prototype.isReactComponent={};A.prototype.setState=function(a,b){"object"!==(typeof a==='undefined'?'undefined':_typeof(a))&&"function"!==typeof a&&null!=a?y("85"):void 0;this.updater.enqueueSetState(this,a,b,"setState");};A.prototype.forceUpdate=function(a){this.updater.enqueueForceUpdate(this,a,"forceUpdate");};function B(a,b,e){this.props=a;this.context=b;this.refs=emptyObject_1;this.updater=e||z;}function C(){}C.prototype=A.prototype;var D=B.prototype=new C();D.constructor=B;objectAssign(D,A.prototype);D.isPureReactComponent=!0;function E(a,b,e){this.props=a;this.context=b;this.refs=emptyObject_1;this.updater=e||z;}var F=E.prototype=new C();F.constructor=E;objectAssign(F,A.prototype);F.unstable_isAsyncReactComponent=!0;F.render=function(){return this.props.children;};var G={current:null};var H$1=Object.prototype.hasOwnProperty;var I={key:!0,ref:!0,__self:!0,__source:!0};function J(a,b,e){var c,d={},g=null,k=null;if(null!=b)for(c in void 0!==b.ref&&(k=b.ref), void 0!==b.key&&(g=""+b.key), b){H$1.call(b,c)&&!I.hasOwnProperty(c)&&(d[c]=b[c]);}var f=arguments.length-2;if(1===f)d.children=e;else if(1<f){for(var h=Array(f),l=0;l<f;l++){h[l]=arguments[l+2];}d.children=h;}if(a&&a.defaultProps)for(c in f=a.defaultProps, f){void 0===d[c]&&(d[c]=f[c]);}return{$$typeof:r,type:a,key:g,ref:k,props:d,_owner:G.current};}function K(a){return"object"===(typeof a==='undefined'?'undefined':_typeof(a))&&null!==a&&a.$$typeof===r;}function escape(a){var b={"\x3d":"\x3d0",":":"\x3d2"};return"$"+(""+a).replace(/[=:]/g,function(a){return b[a];});}var L=/\/+/g;var M=[];function N(a,b,e,c){if(M.length){var d=M.pop();d.result=a;d.keyPrefix=b;d.func=e;d.context=c;d.count=0;return d;}return{result:a,keyPrefix:b,func:e,context:c,count:0};}function O(a){a.result=null;a.keyPrefix=null;a.func=null;a.context=null;a.count=0;10>M.length&&M.push(a);}function P(a,b,e,c){var d=typeof a==='undefined'?'undefined':_typeof(a);if("undefined"===d||"boolean"===d)a=null;var g=!1;if(null===a)g=!0;else switch(d){case"string":case"number":g=!0;break;case"object":switch(a.$$typeof){case r:case t:case u:case v:g=!0;}}if(g)return e(c,a,""===b?"."+Q(a,0):b), 1;g=0;b=""===b?".":b+":";if(Array.isArray(a))for(var k=0;k<a.length;k++){d=a[k];var f=b+Q(d,k);g+=P(d,f,e,c);}else if(null===a||"undefined"===typeof a?f=null:(f=x&&a[x]||a["@@iterator"], f="function"===typeof f?f:null), "function"===typeof f)for(a=f.call(a), k=0;!(d=a.next()).done;){d=d.value, f=b+Q(d,k++), g+=P(d,f,e,c);}else"object"===d&&(e=""+a, y("31","[object Object]"===e?"object with keys {"+Object.keys(a).join(", ")+"}":e,""));return g;}function Q(a,b){return"object"===(typeof a==='undefined'?'undefined':_typeof(a))&&null!==a&&null!=a.key?escape(a.key):b.toString(36);}function R(a,b){a.func.call(a.context,b,a.count++);}function S(a,b,e){var c=a.result,d=a.keyPrefix;a=a.func.call(a.context,b,a.count++);Array.isArray(a)?T(a,c,e,emptyFunction_1.thatReturnsArgument):null!=a&&(K(a)&&(b=d+(!a.key||b&&b.key===a.key?"":(""+a.key).replace(L,"$\x26/")+"/")+e, a={$$typeof:r,type:a.type,key:b,ref:a.ref,props:a.props,_owner:a._owner}), c.push(a));}function T(a,b,e,c,d){var g="";null!=e&&(g=(""+e).replace(L,"$\x26/")+"/");b=N(b,g,c,d);null==a||P(a,"",S,b);O(b);}var U={Children:{map:function map(a,b,e){if(null==a)return a;var c=[];T(a,c,null,b,e);return c;},forEach:function forEach(a,b,e){if(null==a)return a;b=N(null,null,b,e);null==a||P(a,"",R,b);O(b);},count:function count(a){return null==a?0:P(a,"",emptyFunction_1.thatReturnsNull,null);},toArray:function toArray$$1(a){var b=[];T(a,b,null,emptyFunction_1.thatReturnsArgument);return b;},only:function only(a){K(a)?void 0:y("143");return a;}},Component:A,PureComponent:B,unstable_AsyncComponent:E,Fragment:w,createElement:J,cloneElement:function cloneElement(a,b,e){var c=objectAssign({},a.props),d=a.key,g=a.ref,k=a._owner;if(null!=b){void 0!==b.ref&&(g=b.ref, k=G.current);void 0!==b.key&&(d=""+b.key);if(a.type&&a.type.defaultProps)var f=a.type.defaultProps;for(h in b){H$1.call(b,h)&&!I.hasOwnProperty(h)&&(c[h]=void 0===b[h]&&void 0!==f?f[h]:b[h]);}}var h=arguments.length-2;if(1===h)c.children=e;else if(1<h){f=Array(h);for(var l=0;l<h;l++){f[l]=arguments[l+2];}c.children=f;}return{$$typeof:r,type:a.type,key:d,ref:g,props:c,_owner:k};},createFactory:function createFactory(a){var b=J.bind(null,a);b.type=a;return b;},isValidElement:K,version:"16.2.0",__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED:{ReactCurrentOwner:G,assign:objectAssign}};var V=Object.freeze({default:U});var W=V&&U||V;var react_production_min=W["default"]?W["default"]:W;/**
   * Copyright (c) 2013-present, Facebook, Inc.
   *
   * This source code is licensed under the MIT license found in the
   * LICENSE file in the root directory of this source tree.
   *
   *//**
   * Use invariant() to assert state which your program assumes to be true.
   *
   * Provide sprintf-style format (only %s is supported) and arguments
   * to provide information about what broke and what you were
   * expecting.
   *
   * The invariant message will be stripped in production, but the invariant
   * will remain to ensure logic does not differ in production.
   */var validateFormat=function validateFormat(format){};{validateFormat=function validateFormat(format){if(format===undefined){throw new Error('invariant requires an error message argument');}};}function invariant(condition,format,a,b,c,d,e,f){validateFormat(format);if(!condition){var error;if(format===undefined){error=new Error('Minified exception occurred; use the non-minified dev environment '+'for the full error message and additional helpful warnings.');}else{var args=[a,b,c,d,e,f];var argIndex=0;error=new Error(format.replace(/%s/g,function(){return args[argIndex++];}));error.name='Invariant Violation';}error.framesToPop=1;// we don't care about invariant's own frame
  throw error;}}var invariant_1=invariant;/**
   * Similar to invariant but only logs a warning if the condition is not met.
   * This can be used to log issues in development environments in critical
   * paths. Removing the logging code for production environments will keep the
   * same logic and follow the same code paths.
   */var warning=emptyFunction_1;{var printWarning=function printWarning(format){for(var _len=arguments.length,args=Array(_len>1?_len-1:0),_key=1;_key<_len;_key++){args[_key-1]=arguments[_key];}var argIndex=0;var message='Warning: '+format.replace(/%s/g,function(){return args[argIndex++];});if(typeof console!=='undefined'){console.error(message);}try{// --- Welcome to debugging React ---
  // This error was thrown as a convenience so that you can use this stack
  // to find the callsite that caused this warning to fire.
  throw new Error(message);}catch(x){}};warning=function warning(condition,format){if(format===undefined){throw new Error('`warning(condition, format, ...args)` requires a warning '+'message argument');}if(format.indexOf('Failed Composite propType: ')===0){return;// Ignore CompositeComponent proptype check.
  }if(!condition){for(var _len2=arguments.length,args=Array(_len2>2?_len2-2:0),_key2=2;_key2<_len2;_key2++){args[_key2-2]=arguments[_key2];}printWarning.apply(undefined,[format].concat(args));}};}var warning_1=warning;/**
   * Copyright (c) 2013-present, Facebook, Inc.
   *
   * This source code is licensed under the MIT license found in the
   * LICENSE file in the root directory of this source tree.
   */var ReactPropTypesSecret='SECRET_DO_NOT_PASS_THIS_OR_YOU_WILL_BE_FIRED';var ReactPropTypesSecret_1=ReactPropTypesSecret;{var invariant$2=invariant_1;var warning$2=warning_1;var ReactPropTypesSecret$2=ReactPropTypesSecret_1;var loggedTypeFailures={};}/**
   * Assert that the values match with the type specs.
   * Error messages are memorized and will only be shown once.
   *
   * @param {object} typeSpecs Map of name to a ReactPropType
   * @param {object} values Runtime values that need to be type-checked
   * @param {string} location e.g. "prop", "context", "child context"
   * @param {string} componentName Name of the component for error messages.
   * @param {?Function} getStack Returns the component stack.
   * @private
   */function checkPropTypes(typeSpecs,values,location,componentName,getStack){{for(var typeSpecName in typeSpecs){if(typeSpecs.hasOwnProperty(typeSpecName)){var error;// Prop type validation may throw. In case they do, we don't want to
  // fail the render phase where it didn't fail before. So we log it.
  // After these have been cleaned up, we'll let them throw.
  try{// This is intentionally an invariant that gets caught. It's the same
  // behavior as without this statement except with a better message.
  invariant$2(typeof typeSpecs[typeSpecName]==='function','%s: %s type `%s` is invalid; it must be a function, usually from '+'the `prop-types` package, but received `%s`.',componentName||'React class',location,typeSpecName,_typeof(typeSpecs[typeSpecName]));error=typeSpecs[typeSpecName](values,typeSpecName,componentName,location,null,ReactPropTypesSecret$2);}catch(ex){error=ex;}warning$2(!error||error instanceof Error,'%s: type specification of %s `%s` is invalid; the type checker '+'function must return `null` or an `Error` but returned a %s. '+'You may have forgotten to pass an argument to the type checker '+'creator (arrayOf, instanceOf, objectOf, oneOf, oneOfType, and '+'shape all require an argument).',componentName||'React class',location,typeSpecName,typeof error==='undefined'?'undefined':_typeof(error));if(error instanceof Error&&!(error.message in loggedTypeFailures)){// Only monitor this failure once because there tends to be a lot of the
  // same error.
  loggedTypeFailures[error.message]=true;var stack=getStack?getStack():'';warning$2(false,'Failed %s type: %s%s',location,error.message,stack!=null?stack:'');}}}}}var checkPropTypes_1=checkPropTypes;var react_development=createCommonjsModule(function(module){/** @license React v16.2.0
     * react.development.js
     *
     * Copyright (c) 2013-present, Facebook, Inc.
     *
     * This source code is licensed under the MIT license found in the
     * LICENSE file in the root directory of this source tree.
     */{(function(){var _assign=objectAssign;var emptyObject=emptyObject_1;var invariant=invariant_1;var warning=warning_1;var emptyFunction=emptyFunction_1;var checkPropTypes=checkPropTypes_1;// TODO: this is special because it gets imported during build.
  var ReactVersion='16.2.0';// The Symbol used to tag the ReactElement-like types. If there is no native Symbol
  // nor polyfill, then a plain number is used for performance.
  var hasSymbol=typeof Symbol==='function'&&Symbol['for'];var REACT_ELEMENT_TYPE=hasSymbol?Symbol['for']('react.element'):0xeac7;var REACT_CALL_TYPE=hasSymbol?Symbol['for']('react.call'):0xeac8;var REACT_RETURN_TYPE=hasSymbol?Symbol['for']('react.return'):0xeac9;var REACT_PORTAL_TYPE=hasSymbol?Symbol['for']('react.portal'):0xeaca;var REACT_FRAGMENT_TYPE=hasSymbol?Symbol['for']('react.fragment'):0xeacb;var MAYBE_ITERATOR_SYMBOL=typeof Symbol==='function'&&Symbol.iterator;var FAUX_ITERATOR_SYMBOL='@@iterator';function getIteratorFn(maybeIterable){if(maybeIterable===null||typeof maybeIterable==='undefined'){return null;}var maybeIterator=MAYBE_ITERATOR_SYMBOL&&maybeIterable[MAYBE_ITERATOR_SYMBOL]||maybeIterable[FAUX_ITERATOR_SYMBOL];if(typeof maybeIterator==='function'){return maybeIterator;}return null;}/**
         * WARNING: DO NOT manually require this module.
         * This is a replacement for `invariant(...)` used by the error code system
         * and will _only_ be required by the corresponding babel pass.
         * It always throws.
         *//**
         * Forked from fbjs/warning:
         * https://github.com/facebook/fbjs/blob/e66ba20ad5be433eb54423f2b097d829324d9de6/packages/fbjs/src/__forks__/warning.js
         *
         * Only change is we use console.warn instead of console.error,
         * and do nothing when 'console' is not supported.
         * This really simplifies the code.
         * ---
         * Similar to invariant but only logs a warning if the condition is not met.
         * This can be used to log issues in development environments in critical
         * paths. Removing the logging code for production environments will keep the
         * same logic and follow the same code paths.
         */var lowPriorityWarning=function lowPriorityWarning(){};{var printWarning=function printWarning(format){for(var _len=arguments.length,args=Array(_len>1?_len-1:0),_key=1;_key<_len;_key++){args[_key-1]=arguments[_key];}var argIndex=0;var message='Warning: '+format.replace(/%s/g,function(){return args[argIndex++];});if(typeof console!=='undefined'){console.warn(message);}try{// --- Welcome to debugging React ---
  // This error was thrown as a convenience so that you can use this stack
  // to find the callsite that caused this warning to fire.
  throw new Error(message);}catch(x){}};lowPriorityWarning=function lowPriorityWarning(condition,format){if(format===undefined){throw new Error('`warning(condition, format, ...args)` requires a warning '+'message argument');}if(!condition){for(var _len2=arguments.length,args=Array(_len2>2?_len2-2:0),_key2=2;_key2<_len2;_key2++){args[_key2-2]=arguments[_key2];}printWarning.apply(undefined,[format].concat(args));}};}var lowPriorityWarning$1=lowPriorityWarning;var didWarnStateUpdateForUnmountedComponent={};function warnNoop(publicInstance,callerName){{var constructor=publicInstance.constructor;var componentName=constructor&&(constructor.displayName||constructor.name)||'ReactClass';var warningKey=componentName+'.'+callerName;if(didWarnStateUpdateForUnmountedComponent[warningKey]){return;}warning(false,'%s(...): Can only update a mounted or mounting component. '+'This usually means you called %s() on an unmounted component. '+'This is a no-op.\n\nPlease check the code for the %s component.',callerName,callerName,componentName);didWarnStateUpdateForUnmountedComponent[warningKey]=true;}}/**
         * This is the abstract API for an update queue.
         */var ReactNoopUpdateQueue={/**
           * Checks whether or not this composite component is mounted.
           * @param {ReactClass} publicInstance The instance we want to test.
           * @return {boolean} True if mounted, false otherwise.
           * @protected
           * @final
           */isMounted:function isMounted(publicInstance){return false;},/**
           * Forces an update. This should only be invoked when it is known with
           * certainty that we are **not** in a DOM transaction.
           *
           * You may want to call this when you know that some deeper aspect of the
           * component's state has changed but `setState` was not called.
           *
           * This will not invoke `shouldComponentUpdate`, but it will invoke
           * `componentWillUpdate` and `componentDidUpdate`.
           *
           * @param {ReactClass} publicInstance The instance that should rerender.
           * @param {?function} callback Called after component is updated.
           * @param {?string} callerName name of the calling function in the public API.
           * @internal
           */enqueueForceUpdate:function enqueueForceUpdate(publicInstance,callback,callerName){warnNoop(publicInstance,'forceUpdate');},/**
           * Replaces all of the state. Always use this or `setState` to mutate state.
           * You should treat `this.state` as immutable.
           *
           * There is no guarantee that `this.state` will be immediately updated, so
           * accessing `this.state` after calling this method may return the old value.
           *
           * @param {ReactClass} publicInstance The instance that should rerender.
           * @param {object} completeState Next state.
           * @param {?function} callback Called after component is updated.
           * @param {?string} callerName name of the calling function in the public API.
           * @internal
           */enqueueReplaceState:function enqueueReplaceState(publicInstance,completeState,callback,callerName){warnNoop(publicInstance,'replaceState');},/**
           * Sets a subset of the state. This only exists because _pendingState is
           * internal. This provides a merging strategy that is not available to deep
           * properties which is confusing. TODO: Expose pendingState or don't use it
           * during the merge.
           *
           * @param {ReactClass} publicInstance The instance that should rerender.
           * @param {object} partialState Next partial state to be merged with state.
           * @param {?function} callback Called after component is updated.
           * @param {?string} Name of the calling function in the public API.
           * @internal
           */enqueueSetState:function enqueueSetState(publicInstance,partialState,callback,callerName){warnNoop(publicInstance,'setState');}};/**
         * Base class helpers for the updating state of a component.
         */function Component(props,context,updater){this.props=props;this.context=context;this.refs=emptyObject;// We initialize the default updater but the real one gets injected by the
  // renderer.
  this.updater=updater||ReactNoopUpdateQueue;}Component.prototype.isReactComponent={};/**
         * Sets a subset of the state. Always use this to mutate
         * state. You should treat `this.state` as immutable.
         *
         * There is no guarantee that `this.state` will be immediately updated, so
         * accessing `this.state` after calling this method may return the old value.
         *
         * There is no guarantee that calls to `setState` will run synchronously,
         * as they may eventually be batched together.  You can provide an optional
         * callback that will be executed when the call to setState is actually
         * completed.
         *
         * When a function is provided to setState, it will be called at some point in
         * the future (not synchronously). It will be called with the up to date
         * component arguments (state, props, context). These values can be different
         * from this.* because your function may be called after receiveProps but before
         * shouldComponentUpdate, and this new state, props, and context will not yet be
         * assigned to this.
         *
         * @param {object|function} partialState Next partial state or function to
         *        produce next partial state to be merged with current state.
         * @param {?function} callback Called after state is updated.
         * @final
         * @protected
         */Component.prototype.setState=function(partialState,callback){!((typeof partialState==='undefined'?'undefined':_typeof(partialState))==='object'||typeof partialState==='function'||partialState==null)?invariant(false,'setState(...): takes an object of state variables to update or a function which returns an object of state variables.'):void 0;this.updater.enqueueSetState(this,partialState,callback,'setState');};/**
         * Forces an update. This should only be invoked when it is known with
         * certainty that we are **not** in a DOM transaction.
         *
         * You may want to call this when you know that some deeper aspect of the
         * component's state has changed but `setState` was not called.
         *
         * This will not invoke `shouldComponentUpdate`, but it will invoke
         * `componentWillUpdate` and `componentDidUpdate`.
         *
         * @param {?function} callback Called after update is complete.
         * @final
         * @protected
         */Component.prototype.forceUpdate=function(callback){this.updater.enqueueForceUpdate(this,callback,'forceUpdate');};/**
         * Deprecated APIs. These APIs used to exist on classic React classes but since
         * we would like to deprecate them, we're not going to move them over to this
         * modern base class. Instead, we define a getter that warns if it's accessed.
         */{var deprecatedAPIs={isMounted:['isMounted','Instead, make sure to clean up subscriptions and pending requests in '+'componentWillUnmount to prevent memory leaks.'],replaceState:['replaceState','Refactor your code to use setState instead (see '+'https://github.com/facebook/react/issues/3236).']};var defineDeprecationWarning=function defineDeprecationWarning(methodName,info){Object.defineProperty(Component.prototype,methodName,{get:function get$$1(){lowPriorityWarning$1(false,'%s(...) is deprecated in plain JavaScript React classes. %s',info[0],info[1]);return undefined;}});};for(var fnName in deprecatedAPIs){if(deprecatedAPIs.hasOwnProperty(fnName)){defineDeprecationWarning(fnName,deprecatedAPIs[fnName]);}}}/**
         * Base class helpers for the updating state of a component.
         */function PureComponent(props,context,updater){// Duplicated from Component.
  this.props=props;this.context=context;this.refs=emptyObject;// We initialize the default updater but the real one gets injected by the
  // renderer.
  this.updater=updater||ReactNoopUpdateQueue;}function ComponentDummy(){}ComponentDummy.prototype=Component.prototype;var pureComponentPrototype=PureComponent.prototype=new ComponentDummy();pureComponentPrototype.constructor=PureComponent;// Avoid an extra prototype jump for these methods.
  _assign(pureComponentPrototype,Component.prototype);pureComponentPrototype.isPureReactComponent=true;function AsyncComponent(props,context,updater){// Duplicated from Component.
  this.props=props;this.context=context;this.refs=emptyObject;// We initialize the default updater but the real one gets injected by the
  // renderer.
  this.updater=updater||ReactNoopUpdateQueue;}var asyncComponentPrototype=AsyncComponent.prototype=new ComponentDummy();asyncComponentPrototype.constructor=AsyncComponent;// Avoid an extra prototype jump for these methods.
  _assign(asyncComponentPrototype,Component.prototype);asyncComponentPrototype.unstable_isAsyncReactComponent=true;asyncComponentPrototype.render=function(){return this.props.children;};/**
         * Keeps track of the current owner.
         *
         * The current owner is the component who should own any components that are
         * currently being constructed.
         */var ReactCurrentOwner={/**
           * @internal
           * @type {ReactComponent}
           */current:null};var hasOwnProperty=Object.prototype.hasOwnProperty;var RESERVED_PROPS={key:true,ref:true,__self:true,__source:true};var specialPropKeyWarningShown;var specialPropRefWarningShown;function hasValidRef(config){{if(hasOwnProperty.call(config,'ref')){var getter=Object.getOwnPropertyDescriptor(config,'ref').get;if(getter&&getter.isReactWarning){return false;}}}return config.ref!==undefined;}function hasValidKey(config){{if(hasOwnProperty.call(config,'key')){var getter=Object.getOwnPropertyDescriptor(config,'key').get;if(getter&&getter.isReactWarning){return false;}}}return config.key!==undefined;}function defineKeyPropWarningGetter(props,displayName){var warnAboutAccessingKey=function warnAboutAccessingKey(){if(!specialPropKeyWarningShown){specialPropKeyWarningShown=true;warning(false,'%s: `key` is not a prop. Trying to access it will result '+'in `undefined` being returned. If you need to access the same '+'value within the child component, you should pass it as a different '+'prop. (https://fb.me/react-special-props)',displayName);}};warnAboutAccessingKey.isReactWarning=true;Object.defineProperty(props,'key',{get:warnAboutAccessingKey,configurable:true});}function defineRefPropWarningGetter(props,displayName){var warnAboutAccessingRef=function warnAboutAccessingRef(){if(!specialPropRefWarningShown){specialPropRefWarningShown=true;warning(false,'%s: `ref` is not a prop. Trying to access it will result '+'in `undefined` being returned. If you need to access the same '+'value within the child component, you should pass it as a different '+'prop. (https://fb.me/react-special-props)',displayName);}};warnAboutAccessingRef.isReactWarning=true;Object.defineProperty(props,'ref',{get:warnAboutAccessingRef,configurable:true});}/**
         * Factory method to create a new React element. This no longer adheres to
         * the class pattern, so do not use new to call it. Also, no instanceof check
         * will work. Instead test $$typeof field against Symbol.for('react.element') to check
         * if something is a React Element.
         *
         * @param {*} type
         * @param {*} key
         * @param {string|object} ref
         * @param {*} self A *temporary* helper to detect places where `this` is
         * different from the `owner` when React.createElement is called, so that we
         * can warn. We want to get rid of owner and replace string `ref`s with arrow
         * functions, and as long as `this` and owner are the same, there will be no
         * change in behavior.
         * @param {*} source An annotation object (added by a transpiler or otherwise)
         * indicating filename, line number, and/or other information.
         * @param {*} owner
         * @param {*} props
         * @internal
         */var ReactElement=function ReactElement(type,key,ref,self,source,owner,props){var element={// This tag allow us to uniquely identify this as a React Element
  $$typeof:REACT_ELEMENT_TYPE,// Built-in properties that belong on the element
  type:type,key:key,ref:ref,props:props,// Record the component responsible for creating this element.
  _owner:owner};{// The validation flag is currently mutative. We put it on
  // an external backing store so that we can freeze the whole object.
  // This can be replaced with a WeakMap once they are implemented in
  // commonly used development environments.
  element._store={};// To make comparing ReactElements easier for testing purposes, we make
  // the validation flag non-enumerable (where possible, which should
  // include every environment we run tests in), so the test framework
  // ignores it.
  Object.defineProperty(element._store,'validated',{configurable:false,enumerable:false,writable:true,value:false});// self and source are DEV only properties.
  Object.defineProperty(element,'_self',{configurable:false,enumerable:false,writable:false,value:self});// Two elements created in two different places should be considered
  // equal for testing purposes and therefore we hide it from enumeration.
  Object.defineProperty(element,'_source',{configurable:false,enumerable:false,writable:false,value:source});if(Object.freeze){Object.freeze(element.props);Object.freeze(element);}}return element;};/**
         * Create and return a new ReactElement of the given type.
         * See https://reactjs.org/docs/react-api.html#createelement
         */function createElement(type,config,children){var propName;// Reserved names are extracted
  var props={};var key=null;var ref=null;var self=null;var source=null;if(config!=null){if(hasValidRef(config)){ref=config.ref;}if(hasValidKey(config)){key=''+config.key;}self=config.__self===undefined?null:config.__self;source=config.__source===undefined?null:config.__source;// Remaining properties are added to a new props object
  for(propName in config){if(hasOwnProperty.call(config,propName)&&!RESERVED_PROPS.hasOwnProperty(propName)){props[propName]=config[propName];}}}// Children can be more than one argument, and those are transferred onto
  // the newly allocated props object.
  var childrenLength=arguments.length-2;if(childrenLength===1){props.children=children;}else if(childrenLength>1){var childArray=Array(childrenLength);for(var i=0;i<childrenLength;i++){childArray[i]=arguments[i+2];}{if(Object.freeze){Object.freeze(childArray);}}props.children=childArray;}// Resolve default props
  if(type&&type.defaultProps){var defaultProps=type.defaultProps;for(propName in defaultProps){if(props[propName]===undefined){props[propName]=defaultProps[propName];}}}{if(key||ref){if(typeof props.$$typeof==='undefined'||props.$$typeof!==REACT_ELEMENT_TYPE){var displayName=typeof type==='function'?type.displayName||type.name||'Unknown':type;if(key){defineKeyPropWarningGetter(props,displayName);}if(ref){defineRefPropWarningGetter(props,displayName);}}}}return ReactElement(type,key,ref,self,source,ReactCurrentOwner.current,props);}/**
         * Return a function that produces ReactElements of a given type.
         * See https://reactjs.org/docs/react-api.html#createfactory
         */function cloneAndReplaceKey(oldElement,newKey){var newElement=ReactElement(oldElement.type,newKey,oldElement.ref,oldElement._self,oldElement._source,oldElement._owner,oldElement.props);return newElement;}/**
         * Clone and return a new ReactElement using element as the starting point.
         * See https://reactjs.org/docs/react-api.html#cloneelement
         */function cloneElement(element,config,children){var propName;// Original props are copied
  var props=_assign({},element.props);// Reserved names are extracted
  var key=element.key;var ref=element.ref;// Self is preserved since the owner is preserved.
  var self=element._self;// Source is preserved since cloneElement is unlikely to be targeted by a
  // transpiler, and the original source is probably a better indicator of the
  // true owner.
  var source=element._source;// Owner will be preserved, unless ref is overridden
  var owner=element._owner;if(config!=null){if(hasValidRef(config)){// Silently steal the ref from the parent.
  ref=config.ref;owner=ReactCurrentOwner.current;}if(hasValidKey(config)){key=''+config.key;}// Remaining properties override existing props
  var defaultProps;if(element.type&&element.type.defaultProps){defaultProps=element.type.defaultProps;}for(propName in config){if(hasOwnProperty.call(config,propName)&&!RESERVED_PROPS.hasOwnProperty(propName)){if(config[propName]===undefined&&defaultProps!==undefined){// Resolve default props
  props[propName]=defaultProps[propName];}else{props[propName]=config[propName];}}}}// Children can be more than one argument, and those are transferred onto
  // the newly allocated props object.
  var childrenLength=arguments.length-2;if(childrenLength===1){props.children=children;}else if(childrenLength>1){var childArray=Array(childrenLength);for(var i=0;i<childrenLength;i++){childArray[i]=arguments[i+2];}props.children=childArray;}return ReactElement(element.type,key,ref,self,source,owner,props);}/**
         * Verifies the object is a ReactElement.
         * See https://reactjs.org/docs/react-api.html#isvalidelement
         * @param {?object} object
         * @return {boolean} True if `object` is a valid component.
         * @final
         */function isValidElement(object){return(typeof object==='undefined'?'undefined':_typeof(object))==='object'&&object!==null&&object.$$typeof===REACT_ELEMENT_TYPE;}var ReactDebugCurrentFrame={};{// Component that is being worked on
  ReactDebugCurrentFrame.getCurrentStack=null;ReactDebugCurrentFrame.getStackAddendum=function(){var impl=ReactDebugCurrentFrame.getCurrentStack;if(impl){return impl();}return null;};}var SEPARATOR='.';var SUBSEPARATOR=':';/**
         * Escape and wrap key so it is safe to use as a reactid
         *
         * @param {string} key to be escaped.
         * @return {string} the escaped key.
         */function escape(key){var escapeRegex=/[=:]/g;var escaperLookup={'=':'=0',':':'=2'};var escapedString=(''+key).replace(escapeRegex,function(match){return escaperLookup[match];});return'$'+escapedString;}/**
         * TODO: Test that a single child and an array with one item have the same key
         * pattern.
         */var didWarnAboutMaps=false;var userProvidedKeyEscapeRegex=/\/+/g;function escapeUserProvidedKey(text){return(''+text).replace(userProvidedKeyEscapeRegex,'$&/');}var POOL_SIZE=10;var traverseContextPool=[];function getPooledTraverseContext(mapResult,keyPrefix,mapFunction,mapContext){if(traverseContextPool.length){var traverseContext=traverseContextPool.pop();traverseContext.result=mapResult;traverseContext.keyPrefix=keyPrefix;traverseContext.func=mapFunction;traverseContext.context=mapContext;traverseContext.count=0;return traverseContext;}else{return{result:mapResult,keyPrefix:keyPrefix,func:mapFunction,context:mapContext,count:0};}}function releaseTraverseContext(traverseContext){traverseContext.result=null;traverseContext.keyPrefix=null;traverseContext.func=null;traverseContext.context=null;traverseContext.count=0;if(traverseContextPool.length<POOL_SIZE){traverseContextPool.push(traverseContext);}}/**
         * @param {?*} children Children tree container.
         * @param {!string} nameSoFar Name of the key path so far.
         * @param {!function} callback Callback to invoke with each child found.
         * @param {?*} traverseContext Used to pass information throughout the traversal
         * process.
         * @return {!number} The number of children in this subtree.
         */function traverseAllChildrenImpl(children,nameSoFar,callback,traverseContext){var type=typeof children==='undefined'?'undefined':_typeof(children);if(type==='undefined'||type==='boolean'){// All of the above are perceived as null.
  children=null;}var invokeCallback=false;if(children===null){invokeCallback=true;}else{switch(type){case'string':case'number':invokeCallback=true;break;case'object':switch(children.$$typeof){case REACT_ELEMENT_TYPE:case REACT_CALL_TYPE:case REACT_RETURN_TYPE:case REACT_PORTAL_TYPE:invokeCallback=true;}}}if(invokeCallback){callback(traverseContext,children,// If it's the only child, treat the name as if it was wrapped in an array
  // so that it's consistent if the number of children grows.
  nameSoFar===''?SEPARATOR+getComponentKey(children,0):nameSoFar);return 1;}var child;var nextName;var subtreeCount=0;// Count of children found in the current subtree.
  var nextNamePrefix=nameSoFar===''?SEPARATOR:nameSoFar+SUBSEPARATOR;if(Array.isArray(children)){for(var i=0;i<children.length;i++){child=children[i];nextName=nextNamePrefix+getComponentKey(child,i);subtreeCount+=traverseAllChildrenImpl(child,nextName,callback,traverseContext);}}else{var iteratorFn=getIteratorFn(children);if(typeof iteratorFn==='function'){{// Warn about using Maps as children
  if(iteratorFn===children.entries){warning(didWarnAboutMaps,'Using Maps as children is unsupported and will likely yield '+'unexpected results. Convert it to a sequence/iterable of keyed '+'ReactElements instead.%s',ReactDebugCurrentFrame.getStackAddendum());didWarnAboutMaps=true;}}var iterator=iteratorFn.call(children);var step;var ii=0;while(!(step=iterator.next()).done){child=step.value;nextName=nextNamePrefix+getComponentKey(child,ii++);subtreeCount+=traverseAllChildrenImpl(child,nextName,callback,traverseContext);}}else if(type==='object'){var addendum='';{addendum=' If you meant to render a collection of children, use an array '+'instead.'+ReactDebugCurrentFrame.getStackAddendum();}var childrenString=''+children;invariant(false,'Objects are not valid as a React child (found: %s).%s',childrenString==='[object Object]'?'object with keys {'+Object.keys(children).join(', ')+'}':childrenString,addendum);}}return subtreeCount;}/**
         * Traverses children that are typically specified as `props.children`, but
         * might also be specified through attributes:
         *
         * - `traverseAllChildren(this.props.children, ...)`
         * - `traverseAllChildren(this.props.leftPanelChildren, ...)`
         *
         * The `traverseContext` is an optional argument that is passed through the
         * entire traversal. It can be used to store accumulations or anything else that
         * the callback might find relevant.
         *
         * @param {?*} children Children tree object.
         * @param {!function} callback To invoke upon traversing each child.
         * @param {?*} traverseContext Context for traversal.
         * @return {!number} The number of children in this subtree.
         */function traverseAllChildren(children,callback,traverseContext){if(children==null){return 0;}return traverseAllChildrenImpl(children,'',callback,traverseContext);}/**
         * Generate a key string that identifies a component within a set.
         *
         * @param {*} component A component that could contain a manual key.
         * @param {number} index Index that is used if a manual key is not provided.
         * @return {string}
         */function getComponentKey(component,index){// Do some typechecking here since we call this blindly. We want to ensure
  // that we don't block potential future ES APIs.
  if((typeof component==='undefined'?'undefined':_typeof(component))==='object'&&component!==null&&component.key!=null){// Explicit key
  return escape(component.key);}// Implicit key determined by the index in the set
  return index.toString(36);}function forEachSingleChild(bookKeeping,child,name){var func=bookKeeping.func,context=bookKeeping.context;func.call(context,child,bookKeeping.count++);}/**
         * Iterates through children that are typically specified as `props.children`.
         *
         * See https://reactjs.org/docs/react-api.html#react.children.foreach
         *
         * The provided forEachFunc(child, index) will be called for each
         * leaf child.
         *
         * @param {?*} children Children tree container.
         * @param {function(*, int)} forEachFunc
         * @param {*} forEachContext Context for forEachContext.
         */function forEachChildren(children,forEachFunc,forEachContext){if(children==null){return children;}var traverseContext=getPooledTraverseContext(null,null,forEachFunc,forEachContext);traverseAllChildren(children,forEachSingleChild,traverseContext);releaseTraverseContext(traverseContext);}function mapSingleChildIntoContext(bookKeeping,child,childKey){var result=bookKeeping.result,keyPrefix=bookKeeping.keyPrefix,func=bookKeeping.func,context=bookKeeping.context;var mappedChild=func.call(context,child,bookKeeping.count++);if(Array.isArray(mappedChild)){mapIntoWithKeyPrefixInternal(mappedChild,result,childKey,emptyFunction.thatReturnsArgument);}else if(mappedChild!=null){if(isValidElement(mappedChild)){mappedChild=cloneAndReplaceKey(mappedChild,// Keep both the (mapped) and old keys if they differ, just as
  // traverseAllChildren used to do for objects as children
  keyPrefix+(mappedChild.key&&(!child||child.key!==mappedChild.key)?escapeUserProvidedKey(mappedChild.key)+'/':'')+childKey);}result.push(mappedChild);}}function mapIntoWithKeyPrefixInternal(children,array,prefix,func,context){var escapedPrefix='';if(prefix!=null){escapedPrefix=escapeUserProvidedKey(prefix)+'/';}var traverseContext=getPooledTraverseContext(array,escapedPrefix,func,context);traverseAllChildren(children,mapSingleChildIntoContext,traverseContext);releaseTraverseContext(traverseContext);}/**
         * Maps children that are typically specified as `props.children`.
         *
         * See https://reactjs.org/docs/react-api.html#react.children.map
         *
         * The provided mapFunction(child, key, index) will be called for each
         * leaf child.
         *
         * @param {?*} children Children tree container.
         * @param {function(*, int)} func The map function.
         * @param {*} context Context for mapFunction.
         * @return {object} Object containing the ordered map of results.
         */function mapChildren(children,func,context){if(children==null){return children;}var result=[];mapIntoWithKeyPrefixInternal(children,result,null,func,context);return result;}/**
         * Count the number of children that are typically specified as
         * `props.children`.
         *
         * See https://reactjs.org/docs/react-api.html#react.children.count
         *
         * @param {?*} children Children tree container.
         * @return {number} The number of children.
         */function countChildren(children,context){return traverseAllChildren(children,emptyFunction.thatReturnsNull,null);}/**
         * Flatten a children object (typically specified as `props.children`) and
         * return an array with appropriately re-keyed children.
         *
         * See https://reactjs.org/docs/react-api.html#react.children.toarray
         */function toArray$$1(children){var result=[];mapIntoWithKeyPrefixInternal(children,result,null,emptyFunction.thatReturnsArgument);return result;}/**
         * Returns the first child in a collection of children and verifies that there
         * is only one child in the collection.
         *
         * See https://reactjs.org/docs/react-api.html#react.children.only
         *
         * The current implementation of this function assumes that a single child gets
         * passed without a wrapper, but the purpose of this helper function is to
         * abstract away the particular structure of children.
         *
         * @param {?object} children Child collection structure.
         * @return {ReactElement} The first and only `ReactElement` contained in the
         * structure.
         */function onlyChild(children){!isValidElement(children)?invariant(false,'React.Children.only expected to receive a single React element child.'):void 0;return children;}var describeComponentFrame=function describeComponentFrame(name,source,ownerName){return'\n    in '+(name||'Unknown')+(source?' (at '+source.fileName.replace(/^.*[\\\/]/,'')+':'+source.lineNumber+')':ownerName?' (created by '+ownerName+')':'');};function getComponentName(fiber){var type=fiber.type;if(typeof type==='string'){return type;}if(typeof type==='function'){return type.displayName||type.name;}return null;}/**
         * ReactElementValidator provides a wrapper around a element factory
         * which validates the props passed to the element. This is intended to be
         * used only in DEV and could be replaced by a static type checker for languages
         * that support it.
         */{var currentlyValidatingElement=null;var propTypesMisspellWarningShown=false;var getDisplayName=function getDisplayName(element){if(element==null){return'#empty';}else if(typeof element==='string'||typeof element==='number'){return'#text';}else if(typeof element.type==='string'){return element.type;}else if(element.type===REACT_FRAGMENT_TYPE){return'React.Fragment';}else{return element.type.displayName||element.type.name||'Unknown';}};var getStackAddendum=function getStackAddendum(){var stack='';if(currentlyValidatingElement){var name=getDisplayName(currentlyValidatingElement);var owner=currentlyValidatingElement._owner;stack+=describeComponentFrame(name,currentlyValidatingElement._source,owner&&getComponentName(owner));}stack+=ReactDebugCurrentFrame.getStackAddendum()||'';return stack;};var VALID_FRAGMENT_PROPS=new Map([['children',true],['key',true]]);}function getDeclarationErrorAddendum(){if(ReactCurrentOwner.current){var name=getComponentName(ReactCurrentOwner.current);if(name){return'\n\nCheck the render method of `'+name+'`.';}}return'';}function getSourceInfoErrorAddendum(elementProps){if(elementProps!==null&&elementProps!==undefined&&elementProps.__source!==undefined){var source=elementProps.__source;var fileName=source.fileName.replace(/^.*[\\\/]/,'');var lineNumber=source.lineNumber;return'\n\nCheck your code at '+fileName+':'+lineNumber+'.';}return'';}/**
         * Warn if there's no key explicitly set on dynamic arrays of children or
         * object keys are not valid. This allows us to keep track of children between
         * updates.
         */var ownerHasKeyUseWarning={};function getCurrentComponentErrorInfo(parentType){var info=getDeclarationErrorAddendum();if(!info){var parentName=typeof parentType==='string'?parentType:parentType.displayName||parentType.name;if(parentName){info='\n\nCheck the top-level render call using <'+parentName+'>.';}}return info;}/**
         * Warn if the element doesn't have an explicit key assigned to it.
         * This element is in an array. The array could grow and shrink or be
         * reordered. All children that haven't already been validated are required to
         * have a "key" property assigned to it. Error statuses are cached so a warning
         * will only be shown once.
         *
         * @internal
         * @param {ReactElement} element Element that requires a key.
         * @param {*} parentType element's parent's type.
         */function validateExplicitKey(element,parentType){if(!element._store||element._store.validated||element.key!=null){return;}element._store.validated=true;var currentComponentErrorInfo=getCurrentComponentErrorInfo(parentType);if(ownerHasKeyUseWarning[currentComponentErrorInfo]){return;}ownerHasKeyUseWarning[currentComponentErrorInfo]=true;// Usually the current owner is the offender, but if it accepts children as a
  // property, it may be the creator of the child that's responsible for
  // assigning it a key.
  var childOwner='';if(element&&element._owner&&element._owner!==ReactCurrentOwner.current){// Give the component that originally created this child.
  childOwner=' It was passed a child from '+getComponentName(element._owner)+'.';}currentlyValidatingElement=element;{warning(false,'Each child in an array or iterator should have a unique "key" prop.'+'%s%s See https://fb.me/react-warning-keys for more information.%s',currentComponentErrorInfo,childOwner,getStackAddendum());}currentlyValidatingElement=null;}/**
         * Ensure that every element either is passed in a static location, in an
         * array with an explicit keys property defined, or in an object literal
         * with valid key property.
         *
         * @internal
         * @param {ReactNode} node Statically passed child of any type.
         * @param {*} parentType node's parent's type.
         */function validateChildKeys(node,parentType){if((typeof node==='undefined'?'undefined':_typeof(node))!=='object'){return;}if(Array.isArray(node)){for(var i=0;i<node.length;i++){var child=node[i];if(isValidElement(child)){validateExplicitKey(child,parentType);}}}else if(isValidElement(node)){// This element was passed in a valid location.
  if(node._store){node._store.validated=true;}}else if(node){var iteratorFn=getIteratorFn(node);if(typeof iteratorFn==='function'){// Entry iterators used to provide implicit keys,
  // but now we print a separate warning for them later.
  if(iteratorFn!==node.entries){var iterator=iteratorFn.call(node);var step;while(!(step=iterator.next()).done){if(isValidElement(step.value)){validateExplicitKey(step.value,parentType);}}}}}}/**
         * Given an element, validate that its props follow the propTypes definition,
         * provided by the type.
         *
         * @param {ReactElement} element
         */function validatePropTypes(element){var componentClass=element.type;if(typeof componentClass!=='function'){return;}var name=componentClass.displayName||componentClass.name;var propTypes=componentClass.propTypes;if(propTypes){currentlyValidatingElement=element;checkPropTypes(propTypes,element.props,'prop',name,getStackAddendum);currentlyValidatingElement=null;}else if(componentClass.PropTypes!==undefined&&!propTypesMisspellWarningShown){propTypesMisspellWarningShown=true;warning(false,'Component %s declared `PropTypes` instead of `propTypes`. Did you misspell the property assignment?',name||'Unknown');}if(typeof componentClass.getDefaultProps==='function'){warning(componentClass.getDefaultProps.isReactClassApproved,'getDefaultProps is only used on classic React.createClass '+'definitions. Use a static property named `defaultProps` instead.');}}/**
         * Given a fragment, validate that it can only be provided with fragment props
         * @param {ReactElement} fragment
         */function validateFragmentProps(fragment){currentlyValidatingElement=fragment;var _iteratorNormalCompletion=true;var _didIteratorError=false;var _iteratorError=undefined;try{for(var _iterator=Object.keys(fragment.props)[Symbol.iterator](),_step;!(_iteratorNormalCompletion=(_step=_iterator.next()).done);_iteratorNormalCompletion=true){var key=_step.value;if(!VALID_FRAGMENT_PROPS.has(key)){warning(false,'Invalid prop `%s` supplied to `React.Fragment`. '+'React.Fragment can only have `key` and `children` props.%s',key,getStackAddendum());break;}}}catch(err){_didIteratorError=true;_iteratorError=err;}finally{try{if(!_iteratorNormalCompletion&&_iterator['return']){_iterator['return']();}}finally{if(_didIteratorError){throw _iteratorError;}}}if(fragment.ref!==null){warning(false,'Invalid attribute `ref` supplied to `React.Fragment`.%s',getStackAddendum());}currentlyValidatingElement=null;}function createElementWithValidation(type,props,children){var validType=typeof type==='string'||typeof type==='function'||(typeof type==='undefined'?'undefined':_typeof(type))==='symbol'||typeof type==='number';// We warn in this case but don't throw. We expect the element creation to
  // succeed and there will likely be errors in render.
  if(!validType){var info='';if(type===undefined||(typeof type==='undefined'?'undefined':_typeof(type))==='object'&&type!==null&&Object.keys(type).length===0){info+=' You likely forgot to export your component from the file '+"it's defined in, or you might have mixed up default and named imports.";}var sourceInfo=getSourceInfoErrorAddendum(props);if(sourceInfo){info+=sourceInfo;}else{info+=getDeclarationErrorAddendum();}info+=getStackAddendum()||'';warning(false,'React.createElement: type is invalid -- expected a string (for '+'built-in components) or a class/function (for composite '+'components) but got: %s.%s',type==null?type:typeof type==='undefined'?'undefined':_typeof(type),info);}var element=createElement.apply(this,arguments);// The result can be nullish if a mock or a custom function is used.
  // TODO: Drop this when these are no longer allowed as the type argument.
  if(element==null){return element;}// Skip key warning if the type isn't valid since our key validation logic
  // doesn't expect a non-string/function type and can throw confusing errors.
  // We don't want exception behavior to differ between dev and prod.
  // (Rendering will throw with a helpful message and as soon as the type is
  // fixed, the key warnings will appear.)
  if(validType){for(var i=2;i<arguments.length;i++){validateChildKeys(arguments[i],type);}}if((typeof type==='undefined'?'undefined':_typeof(type))==='symbol'&&type===REACT_FRAGMENT_TYPE){validateFragmentProps(element);}else{validatePropTypes(element);}return element;}function createFactoryWithValidation(type){var validatedFactory=createElementWithValidation.bind(null,type);// Legacy hook TODO: Warn if this is accessed
  validatedFactory.type=type;{Object.defineProperty(validatedFactory,'type',{enumerable:false,get:function get$$1(){lowPriorityWarning$1(false,'Factory.type is deprecated. Access the class directly '+'before passing it to createFactory.');Object.defineProperty(this,'type',{value:type});return type;}});}return validatedFactory;}function cloneElementWithValidation(element,props,children){var newElement=cloneElement.apply(this,arguments);for(var i=2;i<arguments.length;i++){validateChildKeys(arguments[i],newElement.type);}validatePropTypes(newElement);return newElement;}var React={Children:{map:mapChildren,forEach:forEachChildren,count:countChildren,toArray:toArray$$1,only:onlyChild},Component:Component,PureComponent:PureComponent,unstable_AsyncComponent:AsyncComponent,Fragment:REACT_FRAGMENT_TYPE,createElement:createElementWithValidation,cloneElement:cloneElementWithValidation,createFactory:createFactoryWithValidation,isValidElement:isValidElement,version:ReactVersion,__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED:{ReactCurrentOwner:ReactCurrentOwner,// Used by renderers to avoid bundling object-assign twice in UMD bundles:
  assign:_assign}};{_assign(React.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,{// These should not be included in production.
  ReactDebugCurrentFrame:ReactDebugCurrentFrame,// Shim for React DOM 16.0.0 which still destructured (but not used) this.
  // TODO: remove in React 17.0.
  ReactComponentTreeHook:{}});}var React$2=Object.freeze({default:React});var React$3=React$2&&React||React$2;// TODO: decide on the top-level export form.
  // This is hacky but makes it work with both Rollup and Jest.
  var react=React$3['default']?React$3['default']:React$3;module.exports=react;})();}});var react=createCommonjsModule(function(module){{module.exports=react_development;}});/**
   * @author [Tristan Valcke]{@link https://github.com/Itee}
   * @license [BSD-3-Clause]{@link https://opensource.org/licenses/BSD-3-Clause}
   *
   * @class TAppBar
   * @classdesc This is the top application bar that contain 3 sub part, one left, one center and one right. The purpose of this bar container is to display an brand to left, the main menu to center
   *     and login button to the right.
   *
   * @example
   *
   * <TAppBar
   *      left={<TBrand />}
   *      center={<TMenu>...</TMenu>}
   *      right={<TLogingButton />}
   * />
   *
   */var TAppBar$1=function(_React$Component){inherits(TAppBar,_React$Component);function TAppBar(){classCallCheck(this,TAppBar);return possibleConstructorReturn(this,(TAppBar.__proto__||Object.getPrototypeOf(TAppBar)).apply(this,arguments));}createClass(TAppBar,[{key:'render',value:function render(){var _props=this.props,id=_props.id,left=_props.left,center=_props.center,right=_props.right;var _id=id||'tAppBarId';var _style={display:'flex',justifyContent:'space-between'};var _subStyle={display:'flex',alignContent:'center',alignItems:'center'};return react.createElement('t-app-bar',{id:_id,style:_style,className:'tAppBar'},react.createElement('t-app-bar-left',{style:_subStyle,className:'tAppBarPart tAppBarLeft'},left),react.createElement('t-app-bar-center',{style:_subStyle,className:'tAppBarPart tAppBarLCenter'},center),react.createElement('t-app-bar-right',{style:_subStyle,className:'tAppBarPart tAppBarLRight'},right));}}]);return TAppBar;}(react.Component);/**
   * @author [Tristan Valcke]{@link https://github.com/Itee}
   * @license [BSD-3-Clause]{@link https://opensource.org/licenses/BSD-3-Clause}
   *
   * @class TAppBar
   * @classdesc The status bar is design to be on bottom of the page, and should contain some text display and/or data about the application status.
   *
   * @example
   *
   * <TStatusBar>
   *     application ready
   * </TStatusBar>
   *
   */var TStatusBar$1=function(_React$Component){inherits(TStatusBar,_React$Component);function TStatusBar(){classCallCheck(this,TStatusBar);return possibleConstructorReturn(this,(TStatusBar.__proto__||Object.getPrototypeOf(TStatusBar)).apply(this,arguments));}createClass(TStatusBar,[{key:'render',value:function render(){var _props=this.props,id=_props.id,state=_props.state,position=_props.position,children=_props.children;var _id=id||'tStatusBar';var _style={height:'40px',display:'flex',alignItems:'center'};switch(state){case'fixed':_style['position']='fixed';break;case'toggle':break;case'float':_style['position']='absolute';break;default:throw new RangeError('Invalid state parameter: '+state,'TStatusBar');}switch(position){case'top':_style['top']='0px';_style['width']='100%';break;case'right':_style['right']='0px';_style['height']='100%';break;case'bottom':_style['bottom']='0px';_style['width']='100%';break;case'left':_style['left']='0px';_style['height']='100%';break;default:throw new RangeError('Invalid position parameter: '+position,'TStatusBar');}return react.createElement('t-status-bar',{id:_id,style:_style,className:'tStatusBar'},children);}}]);return TStatusBar;}(react.Component);/**
   * @author [Tristan Valcke]{@link https://github.com/Itee}
   * @license [BSD-3-Clause]{@link https://opensource.org/licenses/BSD-3-Clause}
   *
   * @file Todo
   *
   * @example Todo
   *
   */var _instanceCounter=0;var TTitleBar=function(_React$Component){inherits(TTitleBar,_React$Component);function TTitleBar(props){classCallCheck(this,TTitleBar);var _this=possibleConstructorReturn(this,(TTitleBar.__proto__||Object.getPrototypeOf(TTitleBar)).call(this,props));_instanceCounter++;return _this;}/**
       * React lifecycle
       */createClass(TTitleBar,[{key:'componentWillMount',value:function componentWillMount(){}},{key:'componentDidMount',value:function componentDidMount(){}},{key:'componentWillUnmount',value:function componentWillUnmount(){}},{key:'componentWillReceiveProps',value:function componentWillReceiveProps()/*nextProps*/{}},{key:'shouldComponentUpdate',value:function shouldComponentUpdate()/*nextProps, nextState*/{}},{key:'componentWillUpdate',value:function componentWillUpdate()/*nextProps, nextState*/{}},{key:'componentDidUpdate',value:function componentDidUpdate()/*prevProps, prevState*/{}},{key:'render',value:function render(){var _this2=this;var _props=this.props,id=_props.id,className=_props.className;var _id=id||'tTitleBar_'+_instanceCounter;var _style={};var _class=className?'tTitleBar '+className:'tTitleBar';return react.createElement('t-title-bar',{ref:function ref(container){_this2._container=container;},id:_id,style:_style,className:_class});}}]);return TTitleBar;}(react.Component);var factoryWithTypeCheckers=function factoryWithTypeCheckers(isValidElement,throwOnDirectAccess){/* global Symbol */var ITERATOR_SYMBOL=typeof Symbol==='function'&&Symbol.iterator;var FAUX_ITERATOR_SYMBOL='@@iterator';// Before Symbol spec.
  /**
     * Returns the iterator method function contained on the iterable object.
     *
     * Be sure to invoke the function with the iterable as context:
     *
     *     var iteratorFn = getIteratorFn(myIterable);
     *     if (iteratorFn) {
     *       var iterator = iteratorFn.call(myIterable);
     *       ...
     *     }
     *
     * @param {?object} maybeIterable
     * @return {?function}
     */function getIteratorFn(maybeIterable){var iteratorFn=maybeIterable&&(ITERATOR_SYMBOL&&maybeIterable[ITERATOR_SYMBOL]||maybeIterable[FAUX_ITERATOR_SYMBOL]);if(typeof iteratorFn==='function'){return iteratorFn;}}/**
     * Collection of methods that allow declaration and validation of props that are
     * supplied to React components. Example usage:
     *
     *   var Props = require('ReactPropTypes');
     *   var MyArticle = React.createClass({
     *     propTypes: {
     *       // An optional string prop named "description".
     *       description: Props.string,
     *
     *       // A required enum prop named "category".
     *       category: Props.oneOf(['News','Photos']).isRequired,
     *
     *       // A prop named "dialog" that requires an instance of Dialog.
     *       dialog: Props.instanceOf(Dialog).isRequired
     *     },
     *     render: function() { ... }
     *   });
     *
     * A more formal specification of how these methods are used:
     *
     *   type := array|bool|func|object|number|string|oneOf([...])|instanceOf(...)
     *   decl := ReactPropTypes.{type}(.isRequired)?
     *
     * Each and every declaration produces a function with the same signature. This
     * allows the creation of custom validation functions. For example:
     *
     *  var MyLink = React.createClass({
     *    propTypes: {
     *      // An optional string or URI prop named "href".
     *      href: function(props, propName, componentName) {
     *        var propValue = props[propName];
     *        if (propValue != null && typeof propValue !== 'string' &&
     *            !(propValue instanceof URI)) {
     *          return new Error(
     *            'Expected a string or an URI for ' + propName + ' in ' +
     *            componentName
     *          );
     *        }
     *      }
     *    },
     *    render: function() {...}
     *  });
     *
     * @internal
     */var ANONYMOUS='<<anonymous>>';// Important!
  // Keep this list in sync with production version in `./factoryWithThrowingShims.js`.
  var ReactPropTypes={array:createPrimitiveTypeChecker('array'),bool:createPrimitiveTypeChecker('boolean'),func:createPrimitiveTypeChecker('function'),number:createPrimitiveTypeChecker('number'),object:createPrimitiveTypeChecker('object'),string:createPrimitiveTypeChecker('string'),symbol:createPrimitiveTypeChecker('symbol'),any:createAnyTypeChecker(),arrayOf:createArrayOfTypeChecker,element:createElementTypeChecker(),instanceOf:createInstanceTypeChecker,node:createNodeChecker(),objectOf:createObjectOfTypeChecker,oneOf:createEnumTypeChecker,oneOfType:createUnionTypeChecker,shape:createShapeTypeChecker,exact:createStrictShapeTypeChecker};/**
     * inlined Object.is polyfill to avoid requiring consumers ship their own
     * https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Object/is
     *//*eslint-disable no-self-compare*/function is(x,y){// SameValue algorithm
  if(x===y){// Steps 1-5, 7-10
  // Steps 6.b-6.e: +0 != -0
  return x!==0||1/x===1/y;}else{// Step 6.a: NaN == NaN
  return x!==x&&y!==y;}}/*eslint-enable no-self-compare*//**
     * We use an Error-like object for backward compatibility as people may call
     * PropTypes directly and inspect their output. However, we don't use real
     * Errors anymore. We don't inspect their stack anyway, and creating them
     * is prohibitively expensive if they are created too often, such as what
     * happens in oneOfType() for any type before the one that matched.
     */function PropTypeError(message){this.message=message;this.stack='';}// Make `instanceof Error` still work for returned errors.
  PropTypeError.prototype=Error.prototype;function createChainableTypeChecker(validate){{var manualPropTypeCallCache={};var manualPropTypeWarningCount=0;}function checkType(isRequired,props,propName,componentName,location,propFullName,secret){componentName=componentName||ANONYMOUS;propFullName=propFullName||propName;if(secret!==ReactPropTypesSecret_1){if(throwOnDirectAccess){// New behavior only for users of `prop-types` package
  invariant_1(false,'Calling PropTypes validators directly is not supported by the `prop-types` package. '+'Use `PropTypes.checkPropTypes()` to call them. '+'Read more at http://fb.me/use-check-prop-types');}else if("development"!=='production'&&typeof console!=='undefined'){// Old behavior for people using React.PropTypes
  var cacheKey=componentName+':'+propName;if(!manualPropTypeCallCache[cacheKey]&&// Avoid spamming the console because they are often not actionable except for lib authors
  manualPropTypeWarningCount<3){warning_1(false,'You are manually calling a React.PropTypes validation '+'function for the `%s` prop on `%s`. This is deprecated '+'and will throw in the standalone `prop-types` package. '+'You may be seeing this warning due to a third-party PropTypes '+'library. See https://fb.me/react-warning-dont-call-proptypes '+'for details.',propFullName,componentName);manualPropTypeCallCache[cacheKey]=true;manualPropTypeWarningCount++;}}}if(props[propName]==null){if(isRequired){if(props[propName]===null){return new PropTypeError('The '+location+' `'+propFullName+'` is marked as required '+('in `'+componentName+'`, but its value is `null`.'));}return new PropTypeError('The '+location+' `'+propFullName+'` is marked as required in '+('`'+componentName+'`, but its value is `undefined`.'));}return null;}else{return validate(props,propName,componentName,location,propFullName);}}var chainedCheckType=checkType.bind(null,false);chainedCheckType.isRequired=checkType.bind(null,true);return chainedCheckType;}function createPrimitiveTypeChecker(expectedType){function validate(props,propName,componentName,location,propFullName,secret){var propValue=props[propName];var propType=getPropType(propValue);if(propType!==expectedType){// `propValue` being instance of, say, date/regexp, pass the 'object'
  // check, but we can offer a more precise error message here rather than
  // 'of type `object`'.
  var preciseType=getPreciseType(propValue);return new PropTypeError('Invalid '+location+' `'+propFullName+'` of type '+('`'+preciseType+'` supplied to `'+componentName+'`, expected ')+('`'+expectedType+'`.'));}return null;}return createChainableTypeChecker(validate);}function createAnyTypeChecker(){return createChainableTypeChecker(emptyFunction_1.thatReturnsNull);}function createArrayOfTypeChecker(typeChecker){function validate(props,propName,componentName,location,propFullName){if(typeof typeChecker!=='function'){return new PropTypeError('Property `'+propFullName+'` of component `'+componentName+'` has invalid PropType notation inside arrayOf.');}var propValue=props[propName];if(!Array.isArray(propValue)){var propType=getPropType(propValue);return new PropTypeError('Invalid '+location+' `'+propFullName+'` of type '+('`'+propType+'` supplied to `'+componentName+'`, expected an array.'));}for(var i=0;i<propValue.length;i++){var error=typeChecker(propValue,i,componentName,location,propFullName+'['+i+']',ReactPropTypesSecret_1);if(error instanceof Error){return error;}}return null;}return createChainableTypeChecker(validate);}function createElementTypeChecker(){function validate(props,propName,componentName,location,propFullName){var propValue=props[propName];if(!isValidElement(propValue)){var propType=getPropType(propValue);return new PropTypeError('Invalid '+location+' `'+propFullName+'` of type '+('`'+propType+'` supplied to `'+componentName+'`, expected a single ReactElement.'));}return null;}return createChainableTypeChecker(validate);}function createInstanceTypeChecker(expectedClass){function validate(props,propName,componentName,location,propFullName){if(!(props[propName]instanceof expectedClass)){var expectedClassName=expectedClass.name||ANONYMOUS;var actualClassName=getClassName(props[propName]);return new PropTypeError('Invalid '+location+' `'+propFullName+'` of type '+('`'+actualClassName+'` supplied to `'+componentName+'`, expected ')+('instance of `'+expectedClassName+'`.'));}return null;}return createChainableTypeChecker(validate);}function createEnumTypeChecker(expectedValues){if(!Array.isArray(expectedValues)){warning_1(false,'Invalid argument supplied to oneOf, expected an instance of array.');return emptyFunction_1.thatReturnsNull;}function validate(props,propName,componentName,location,propFullName){var propValue=props[propName];for(var i=0;i<expectedValues.length;i++){if(is(propValue,expectedValues[i])){return null;}}var valuesString=JSON.stringify(expectedValues);return new PropTypeError('Invalid '+location+' `'+propFullName+'` of value `'+propValue+'` '+('supplied to `'+componentName+'`, expected one of '+valuesString+'.'));}return createChainableTypeChecker(validate);}function createObjectOfTypeChecker(typeChecker){function validate(props,propName,componentName,location,propFullName){if(typeof typeChecker!=='function'){return new PropTypeError('Property `'+propFullName+'` of component `'+componentName+'` has invalid PropType notation inside objectOf.');}var propValue=props[propName];var propType=getPropType(propValue);if(propType!=='object'){return new PropTypeError('Invalid '+location+' `'+propFullName+'` of type '+('`'+propType+'` supplied to `'+componentName+'`, expected an object.'));}for(var key in propValue){if(propValue.hasOwnProperty(key)){var error=typeChecker(propValue,key,componentName,location,propFullName+'.'+key,ReactPropTypesSecret_1);if(error instanceof Error){return error;}}}return null;}return createChainableTypeChecker(validate);}function createUnionTypeChecker(arrayOfTypeCheckers){if(!Array.isArray(arrayOfTypeCheckers)){warning_1(false,'Invalid argument supplied to oneOfType, expected an instance of array.');return emptyFunction_1.thatReturnsNull;}for(var i=0;i<arrayOfTypeCheckers.length;i++){var checker=arrayOfTypeCheckers[i];if(typeof checker!=='function'){warning_1(false,'Invalid argument supplied to oneOfType. Expected an array of check functions, but '+'received %s at index %s.',getPostfixForTypeWarning(checker),i);return emptyFunction_1.thatReturnsNull;}}function validate(props,propName,componentName,location,propFullName){for(var i=0;i<arrayOfTypeCheckers.length;i++){var checker=arrayOfTypeCheckers[i];if(checker(props,propName,componentName,location,propFullName,ReactPropTypesSecret_1)==null){return null;}}return new PropTypeError('Invalid '+location+' `'+propFullName+'` supplied to '+('`'+componentName+'`.'));}return createChainableTypeChecker(validate);}function createNodeChecker(){function validate(props,propName,componentName,location,propFullName){if(!isNode(props[propName])){return new PropTypeError('Invalid '+location+' `'+propFullName+'` supplied to '+('`'+componentName+'`, expected a ReactNode.'));}return null;}return createChainableTypeChecker(validate);}function createShapeTypeChecker(shapeTypes){function validate(props,propName,componentName,location,propFullName){var propValue=props[propName];var propType=getPropType(propValue);if(propType!=='object'){return new PropTypeError('Invalid '+location+' `'+propFullName+'` of type `'+propType+'` '+('supplied to `'+componentName+'`, expected `object`.'));}for(var key in shapeTypes){var checker=shapeTypes[key];if(!checker){continue;}var error=checker(propValue,key,componentName,location,propFullName+'.'+key,ReactPropTypesSecret_1);if(error){return error;}}return null;}return createChainableTypeChecker(validate);}function createStrictShapeTypeChecker(shapeTypes){function validate(props,propName,componentName,location,propFullName){var propValue=props[propName];var propType=getPropType(propValue);if(propType!=='object'){return new PropTypeError('Invalid '+location+' `'+propFullName+'` of type `'+propType+'` '+('supplied to `'+componentName+'`, expected `object`.'));}// We need to check all keys in case some are required but missing from
  // props.
  var allKeys=objectAssign({},props[propName],shapeTypes);for(var key in allKeys){var checker=shapeTypes[key];if(!checker){return new PropTypeError('Invalid '+location+' `'+propFullName+'` key `'+key+'` supplied to `'+componentName+'`.'+'\nBad object: '+JSON.stringify(props[propName],null,'  ')+'\nValid keys: '+JSON.stringify(Object.keys(shapeTypes),null,'  '));}var error=checker(propValue,key,componentName,location,propFullName+'.'+key,ReactPropTypesSecret_1);if(error){return error;}}return null;}return createChainableTypeChecker(validate);}function isNode(propValue){switch(typeof propValue==='undefined'?'undefined':_typeof(propValue)){case'number':case'string':case'undefined':return true;case'boolean':return!propValue;case'object':if(Array.isArray(propValue)){return propValue.every(isNode);}if(propValue===null||isValidElement(propValue)){return true;}var iteratorFn=getIteratorFn(propValue);if(iteratorFn){var iterator=iteratorFn.call(propValue);var step;if(iteratorFn!==propValue.entries){while(!(step=iterator.next()).done){if(!isNode(step.value)){return false;}}}else{// Iterator will provide entry [k,v] tuples rather than values.
  while(!(step=iterator.next()).done){var entry=step.value;if(entry){if(!isNode(entry[1])){return false;}}}}}else{return false;}return true;default:return false;}}function isSymbol(propType,propValue){// Native Symbol.
  if(propType==='symbol'){return true;}// 19.4.3.5 Symbol.prototype[@@toStringTag] === 'Symbol'
  if(propValue['@@toStringTag']==='Symbol'){return true;}// Fallback for non-spec compliant Symbols which are polyfilled.
  if(typeof Symbol==='function'&&propValue instanceof Symbol){return true;}return false;}// Equivalent of `typeof` but with special handling for array and regexp.
  function getPropType(propValue){var propType=typeof propValue==='undefined'?'undefined':_typeof(propValue);if(Array.isArray(propValue)){return'array';}if(propValue instanceof RegExp){// Old webkits (at least until Android 4.0) return 'function' rather than
  // 'object' for typeof a RegExp. We'll normalize this here so that /bla/
  // passes PropTypes.object.
  return'object';}if(isSymbol(propType,propValue)){return'symbol';}return propType;}// This handles more types than `getPropType`. Only used for error messages.
  // See `createPrimitiveTypeChecker`.
  function getPreciseType(propValue){if(typeof propValue==='undefined'||propValue===null){return''+propValue;}var propType=getPropType(propValue);if(propType==='object'){if(propValue instanceof Date){return'date';}else if(propValue instanceof RegExp){return'regexp';}}return propType;}// Returns a string that is postfixed to a warning about an invalid type.
  // For example, "undefined" or "of type array"
  function getPostfixForTypeWarning(value){var type=getPreciseType(value);switch(type){case'array':case'object':return'an '+type;case'boolean':case'date':case'regexp':return'a '+type;default:return type;}}// Returns class name of the object, if any.
  function getClassName(propValue){if(!propValue.constructor||!propValue.constructor.name){return ANONYMOUS;}return propValue.constructor.name;}ReactPropTypes.checkPropTypes=checkPropTypes_1;ReactPropTypes.PropTypes=ReactPropTypes;return ReactPropTypes;};var propTypes=createCommonjsModule(function(module){/**
     * Copyright (c) 2013-present, Facebook, Inc.
     *
     * This source code is licensed under the MIT license found in the
     * LICENSE file in the root directory of this source tree.
     */{var REACT_ELEMENT_TYPE=typeof Symbol==='function'&&Symbol.for&&Symbol.for('react.element')||0xeac7;var isValidElement=function isValidElement(object){return(typeof object==='undefined'?'undefined':_typeof(object))==='object'&&object!==null&&object.$$typeof===REACT_ELEMENT_TYPE;};// By explicitly using `prop-types` you are opting into new development behavior.
  // http://fb.me/prop-types-in-prod
  var throwOnDirectAccess=true;module.exports=factoryWithTypeCheckers(isValidElement,throwOnDirectAccess);}});/**
   * @author [Tristan Valcke]{@link https://github.com/Itee}
   * @license [BSD-3-Clause]{@link https://opensource.org/licenses/BSD-3-Clause}
   *
   * @class TToolBar
   * @classdesc The TToolBar is a generic container for TToolButtons
   *
   * @example Todo
   *
   */var _instanceCounter$1=0;var TToolBar=function(_React$Component){inherits(TToolBar,_React$Component);function TToolBar(props){classCallCheck(this,TToolBar);var _this=possibleConstructorReturn(this,(TToolBar.__proto__||Object.getPrototypeOf(TToolBar)).call(this,props));_instanceCounter$1++;return _this;}createClass(TToolBar,[{key:'render',value:function render(){var _props=this.props,id=_props.id,className=_props.className;var _id=id||'tToolBar_'+_instanceCounter$1;var _class=className?'tToolBar '+className:'tToolBar';var _style={display:'flex',alignItems:'center'};return react.createElement('t-tool-bar',{id:_id,style:_style,className:_class});}}]);return TToolBar;}(react.Component);TToolBar.propType={id:propTypes.string,className:propTypes.string};/**
   * @author [Tristan Valcke]{@link https://github.com/Itee}
   * @license [BSD-3-Clause]{@link https://opensource.org/licenses/BSD-3-Clause}
   *
   * @file Intermediary export file for uis/displays/bars folder
   *
   *//**
   * @author [Tristan Valcke]{@link https://github.com/Itee}
   * @license [BSD-3-Clause]{@link https://opensource.org/licenses/BSD-3-Clause}
   *
   * @file Todo
   *
   * @example Todo
   *
   */var _instanceCounter$2=0;var TAvatar=function(_React$Component){inherits(TAvatar,_React$Component);function TAvatar(props){classCallCheck(this,TAvatar);var _this=possibleConstructorReturn(this,(TAvatar.__proto__||Object.getPrototypeOf(TAvatar)).call(this,props));_instanceCounter$2++;return _this;}/**
       * React lifecycle
       */createClass(TAvatar,[{key:'componentWillMount',value:function componentWillMount(){}},{key:'componentDidMount',value:function componentDidMount(){}},{key:'componentWillUnmount',value:function componentWillUnmount(){}},{key:'componentWillReceiveProps',value:function componentWillReceiveProps()/*nextProps*/{}},{key:'shouldComponentUpdate',value:function shouldComponentUpdate()/*nextProps, nextState*/{}},{key:'componentWillUpdate',value:function componentWillUpdate()/*nextProps, nextState*/{}},{key:'componentDidUpdate',value:function componentDidUpdate()/*prevProps, prevState*/{}},{key:'render',value:function render(){var _this2=this;var _props=this.props,id=_props.id,className=_props.className;var _id=id||'tAvatar_'+_instanceCounter$2;var _style={};var _class=className?'tAvatar '+className:'tAvatar';return react.createElement('t-avatar',{ref:function ref(container){_this2._container=container;},id:_id,style:_style,className:_class});}}]);return TAvatar;}(react.Component);/**
   * @author [Tristan Valcke]{@link https://github.com/Itee}
   * @license [BSD-3-Clause]{@link https://opensource.org/licenses/BSD-3-Clause}
   *
   * @file Todo
   *
   * @example Todo
   *
   */var _instanceCounter$3=0;var TBadge=function(_React$Component){inherits(TBadge,_React$Component);function TBadge(props){classCallCheck(this,TBadge);var _this=possibleConstructorReturn(this,(TBadge.__proto__||Object.getPrototypeOf(TBadge)).call(this,props));_instanceCounter$3++;return _this;}/**
       * React lifecycle
       */createClass(TBadge,[{key:'componentWillMount',value:function componentWillMount(){}},{key:'componentDidMount',value:function componentDidMount(){}},{key:'componentWillUnmount',value:function componentWillUnmount(){}},{key:'componentWillReceiveProps',value:function componentWillReceiveProps()/*nextProps*/{}},{key:'shouldComponentUpdate',value:function shouldComponentUpdate()/*nextProps, nextState*/{}},{key:'componentWillUpdate',value:function componentWillUpdate()/*nextProps, nextState*/{}},{key:'componentDidUpdate',value:function componentDidUpdate()/*prevProps, prevState*/{}},{key:'render',value:function render(){var _this2=this;var _props=this.props,id=_props.id,className=_props.className;var _id=id||'tBadge_'+_instanceCounter$3;var _style={};var _class=className?'tBadge '+className:'tBadge';return react.createElement('t-badge',{ref:function ref(container){_this2._container=container;},id:_id,style:_style,className:_class});}}]);return TBadge;}(react.Component);/**
   * @author [Tristan Valcke]{@link https://github.com/Itee}
   * @license [BSD-3-Clause]{@link https://opensource.org/licenses/BSD-3-Clause}
   *
   * @file Todo
   *
   * @example Todo
   *
   */var _instanceCounter$4=0;var TCalendar=function(_React$Component){inherits(TCalendar,_React$Component);function TCalendar(props){classCallCheck(this,TCalendar);var _this=possibleConstructorReturn(this,(TCalendar.__proto__||Object.getPrototypeOf(TCalendar)).call(this,props));_instanceCounter$4++;return _this;}/**
       * React lifecycle
       */createClass(TCalendar,[{key:'componentWillMount',value:function componentWillMount(){}},{key:'componentDidMount',value:function componentDidMount(){}},{key:'componentWillUnmount',value:function componentWillUnmount(){}},{key:'componentWillReceiveProps',value:function componentWillReceiveProps()/*nextProps*/{}},{key:'shouldComponentUpdate',value:function shouldComponentUpdate()/*nextProps, nextState*/{}},{key:'componentWillUpdate',value:function componentWillUpdate()/*nextProps, nextState*/{}},{key:'componentDidUpdate',value:function componentDidUpdate()/*prevProps, prevState*/{}},{key:'render',value:function render(){var _this2=this;var _props=this.props,id=_props.id,className=_props.className;var _id=id||'tCalendar_'+_instanceCounter$4;var _style={};var _class=className?'tCalendar '+className:'tCalendar';return react.createElement('t-calendar',{ref:function ref(container){_this2._container=container;},id:_id,style:_style,className:_class});}}]);return TCalendar;}(react.Component);/**
   * @author [Tristan Valcke]{@link https://github.com/Itee}
   * @license [BSD-3-Clause]{@link https://opensource.org/licenses/BSD-3-Clause}
   *
   * @file Todo
   *
   * @example Todo
   *
   */var _instanceCounter$5=0;var TCard=function(_React$Component){inherits(TCard,_React$Component);function TCard(props){classCallCheck(this,TCard);var _this=possibleConstructorReturn(this,(TCard.__proto__||Object.getPrototypeOf(TCard)).call(this,props));_instanceCounter$5++;return _this;}/**
       * React lifecycle
       */createClass(TCard,[{key:'componentWillMount',value:function componentWillMount(){}},{key:'componentDidMount',value:function componentDidMount(){}},{key:'componentWillUnmount',value:function componentWillUnmount(){}},{key:'componentWillReceiveProps',value:function componentWillReceiveProps()/*nextProps*/{}},{key:'shouldComponentUpdate',value:function shouldComponentUpdate()/*nextProps, nextState*/{}},{key:'componentWillUpdate',value:function componentWillUpdate()/*nextProps, nextState*/{}},{key:'componentDidUpdate',value:function componentDidUpdate()/*prevProps, prevState*/{}},{key:'render',value:function render(){var _this2=this;var _props=this.props,id=_props.id,className=_props.className;var _id=id||'tCard_'+_instanceCounter$5;var _style={};var _class=className?'tCard '+className:'tCard';return react.createElement('t-card',{ref:function ref(container){_this2._container=container;},id:_id,style:_style,className:_class});}}]);return TCard;}(react.Component);/**
   * @author [Tristan Valcke]{@link https://github.com/Itee}
   * @license [BSD-3-Clause]{@link https://opensource.org/licenses/BSD-3-Clause}
   *
   * @file Todo
   *
   * @example Todo
   *
   */var _instanceCounter$6=0;var TCode=function(_React$Component){inherits(TCode,_React$Component);function TCode(props){classCallCheck(this,TCode);var _this=possibleConstructorReturn(this,(TCode.__proto__||Object.getPrototypeOf(TCode)).call(this,props));_instanceCounter$6++;return _this;}/**
       * React lifecycle
       */createClass(TCode,[{key:'componentWillMount',value:function componentWillMount(){}},{key:'componentDidMount',value:function componentDidMount(){}},{key:'componentWillUnmount',value:function componentWillUnmount(){}},{key:'componentWillReceiveProps',value:function componentWillReceiveProps()/*nextProps*/{}},{key:'shouldComponentUpdate',value:function shouldComponentUpdate()/*nextProps, nextState*/{}},{key:'componentWillUpdate',value:function componentWillUpdate()/*nextProps, nextState*/{}},{key:'componentDidUpdate',value:function componentDidUpdate()/*prevProps, prevState*/{}},{key:'render',value:function render(){var _this2=this;var _props=this.props,id=_props.id,className=_props.className;var _id=id||'tCode_'+_instanceCounter$6;var _style={};var _class=className?'tCode '+className:'tCode';return react.createElement('t-code',{ref:function ref(container){_this2._container=container;},id:_id,style:_style,className:_class});}}]);return TCode;}(react.Component);/**
   * @author [Tristan Valcke]{@link https://github.com/Itee}
   * @license [BSD-3-Clause]{@link https://opensource.org/licenses/BSD-3-Clause}
   *
   * @class TDateTime
   * @classdesc The TDateTime is design to do...
   *
   * @example
   *
   * <TDateTime></TDateTime>
   *
   *//*eslint-env browser*/var _instanceCounter$7=0;var TDateTime$1=function(_React$Component){inherits(TDateTime,_React$Component);function TDateTime(props){classCallCheck(this,TDateTime);var _this=possibleConstructorReturn(this,(TDateTime.__proto__||Object.getPrototypeOf(TDateTime)).call(this,props));_instanceCounter$7++;_this.state={date:new Date()};_this._timerID=undefined;// Handlers binding
  return _this;}/**
       * Component Life Cycle
       */createClass(TDateTime,[{key:'componentWillMount',value:function componentWillMount(){}},{key:'componentDidMount',value:function componentDidMount(){var _this2=this;this._timerID=setInterval(function(){return _this2.tick();},this.props.refreshInterval);}},{key:'componentWillUnmount',value:function componentWillUnmount(){clearInterval(this._timerID);}},{key:'componentWillReceiveProps',value:function componentWillReceiveProps()/*nextProps*/{}},{key:'shouldComponentUpdate',value:function shouldComponentUpdate()/*nextProps, nextState*/{}},{key:'componentWillUpdate',value:function componentWillUpdate()/*nextProps, nextState*/{}},{key:'componentDidUpdate',value:function componentDidUpdate()/*prevProps, prevState*/{}/**
           * Component Handlers
           *//**
           * Component Methods
           */},{key:'tick',value:function tick(){this.setState({date:new Date()});}/**
           * Component Rendering
           */},{key:'render',value:function render(){var _props=this.props,id=_props.id,className=_props.className;var _id=id||'tDateTime_'+_instanceCounter$7;var _class=className?'tDateTime '+className:'tDateTime';var _style={};return react.createElement('t-date-time',{id:_id,style:_style,className:_class});}}]);return TDateTime;}(react.Component);/**
   * Class props type checking
   */TDateTime$1.defaultProps={refreshInterval:1000};TDateTime$1.propType={id:propTypes.string,className:propTypes.string};/**
   * @author [Tristan Valcke]{@link https://github.com/Itee}
   * @license [BSD-3-Clause]{@link https://opensource.org/licenses/BSD-3-Clause}
   *
   * @file Todo
   *
   * @example Todo
   *
   */var _instanceCounter$8=0;var TDivider=function(_React$Component){inherits(TDivider,_React$Component);function TDivider(props){classCallCheck(this,TDivider);var _this=possibleConstructorReturn(this,(TDivider.__proto__||Object.getPrototypeOf(TDivider)).call(this,props));_instanceCounter$8++;return _this;}/**
       * React lifecycle
       */createClass(TDivider,[{key:'componentWillMount',value:function componentWillMount(){}},{key:'componentDidMount',value:function componentDidMount(){}},{key:'componentWillUnmount',value:function componentWillUnmount(){}},{key:'componentWillReceiveProps',value:function componentWillReceiveProps()/*nextProps*/{}},{key:'shouldComponentUpdate',value:function shouldComponentUpdate()/*nextProps, nextState*/{}},{key:'componentWillUpdate',value:function componentWillUpdate()/*nextProps, nextState*/{}},{key:'componentDidUpdate',value:function componentDidUpdate()/*prevProps, prevState*/{}},{key:'render',value:function render(){var _this2=this;var _props=this.props,id=_props.id,className=_props.className;var _id=id||'tDivider_'+_instanceCounter$8;var _style={};var _class=className?'tDivider '+className:'tDivider';return react.createElement('t-divider',{ref:function ref(container){_this2._container=container;},id:_id,style:_style,className:_class});}}]);return TDivider;}(react.Component);/**
   * @author [Tristan Valcke]{@link https://github.com/Itee}
   * @license [BSD-3-Clause]{@link https://opensource.org/licenses/BSD-3-Clause}
   *
   * @file Todo
   *
   * @example Todo
   *
   */var _instanceCounter$9=0;var TFlag=function(_React$Component){inherits(TFlag,_React$Component);function TFlag(props){classCallCheck(this,TFlag);var _this=possibleConstructorReturn(this,(TFlag.__proto__||Object.getPrototypeOf(TFlag)).call(this,props));_instanceCounter$9++;return _this;}/**
       * React lifecycle
       */createClass(TFlag,[{key:'componentWillMount',value:function componentWillMount(){}},{key:'componentDidMount',value:function componentDidMount(){}},{key:'componentWillUnmount',value:function componentWillUnmount(){}},{key:'componentWillReceiveProps',value:function componentWillReceiveProps()/*nextProps*/{}},{key:'shouldComponentUpdate',value:function shouldComponentUpdate()/*nextProps, nextState*/{}},{key:'componentWillUpdate',value:function componentWillUpdate()/*nextProps, nextState*/{}},{key:'componentDidUpdate',value:function componentDidUpdate()/*prevProps, prevState*/{}},{key:'render',value:function render(){var _this2=this;var _props=this.props,id=_props.id,className=_props.className;var _id=id||'tFlag_'+_instanceCounter$9;var _style={};var _class=className?'tFlag '+className:'tFlag';return react.createElement('t-flag',{ref:function ref(container){_this2._container=container;},id:_id,style:_style,className:_class});}}]);return TFlag;}(react.Component);/**
   * @author [Tristan Valcke]{@link https://github.com/Itee}
   * @license [BSD-3-Clause]{@link https://opensource.org/licenses/BSD-3-Clause}
   *
   * @file Todo
   *
   * @example Todo
   *
   */var _instanceCounter$10=0;var TGraph=function(_React$Component){inherits(TGraph,_React$Component);function TGraph(props){classCallCheck(this,TGraph);var _this=possibleConstructorReturn(this,(TGraph.__proto__||Object.getPrototypeOf(TGraph)).call(this,props));_instanceCounter$10++;return _this;}/**
       * React lifecycle
       */createClass(TGraph,[{key:'componentWillMount',value:function componentWillMount(){}},{key:'componentDidMount',value:function componentDidMount(){}},{key:'componentWillUnmount',value:function componentWillUnmount(){}},{key:'componentWillReceiveProps',value:function componentWillReceiveProps()/*nextProps*/{}},{key:'shouldComponentUpdate',value:function shouldComponentUpdate()/*nextProps, nextState*/{}},{key:'componentWillUpdate',value:function componentWillUpdate()/*nextProps, nextState*/{}},{key:'componentDidUpdate',value:function componentDidUpdate()/*prevProps, prevState*/{}},{key:'render',value:function render(){var _this2=this;var _props=this.props,id=_props.id,className=_props.className;var _id=id||'tGraph_'+_instanceCounter$10;var _style={};var _class=className?'tGraph '+className:'tGraph';return react.createElement('t-graph',{ref:function ref(container){_this2._container=container;},id:_id,style:_style,className:_class});}}]);return TGraph;}(react.Component);/**
   * @author [Tristan Valcke]{@link https://github.com/Itee}
   * @license [BSD-3-Clause]{@link https://opensource.org/licenses/BSD-3-Clause}
   *
   * @file Todo
   *
   * @example Todo
   *
   */var _instanceCounter$11=0;var THeading=function(_React$Component){inherits(THeading,_React$Component);function THeading(props){classCallCheck(this,THeading);var _this=possibleConstructorReturn(this,(THeading.__proto__||Object.getPrototypeOf(THeading)).call(this,props));_instanceCounter$11++;return _this;}/**
       * React lifecycle
       */createClass(THeading,[{key:'componentWillMount',value:function componentWillMount(){}},{key:'componentDidMount',value:function componentDidMount(){}},{key:'componentWillUnmount',value:function componentWillUnmount(){}},{key:'componentWillReceiveProps',value:function componentWillReceiveProps()/*nextProps*/{}},{key:'shouldComponentUpdate',value:function shouldComponentUpdate()/*nextProps, nextState*/{}},{key:'componentWillUpdate',value:function componentWillUpdate()/*nextProps, nextState*/{}},{key:'componentDidUpdate',value:function componentDidUpdate()/*prevProps, prevState*/{}},{key:'render',value:function render(){var _this2=this;var _props=this.props,id=_props.id,className=_props.className;var _id=id||'tHeading_'+_instanceCounter$11;var _style={};var _class=className?'tHeading '+className:'tHeading';return react.createElement('t-heading',{ref:function ref(container){_this2._container=container;},id:_id,style:_style,className:_class});}}]);return THeading;}(react.Component);/**
   * @author [Tristan Valcke]{@link https://github.com/Itee}
   * @license [BSD-3-Clause]{@link https://opensource.org/licenses/BSD-3-Clause}
   *
   * @file Todo
   *
   * @example Todo
   *
   */var _instanceCounter$12=0;var TIcon=function(_React$Component){inherits(TIcon,_React$Component);function TIcon(props){classCallCheck(this,TIcon);var _this=possibleConstructorReturn(this,(TIcon.__proto__||Object.getPrototypeOf(TIcon)).call(this,props));_instanceCounter$12++;return _this;}/**
       * React lifecycle
       */createClass(TIcon,[{key:'componentWillMount',value:function componentWillMount(){}},{key:'componentDidMount',value:function componentDidMount(){}},{key:'componentWillUnmount',value:function componentWillUnmount(){}},{key:'componentWillReceiveProps',value:function componentWillReceiveProps()/*nextProps*/{}},{key:'shouldComponentUpdate',value:function shouldComponentUpdate()/*nextProps, nextState*/{}},{key:'componentWillUpdate',value:function componentWillUpdate()/*nextProps, nextState*/{}},{key:'componentDidUpdate',value:function componentDidUpdate()/*prevProps, prevState*/{}},{key:'render',value:function render(){var _this2=this;var _props=this.props,id=_props.id,className=_props.className;var _id=id||'tIcon_'+_instanceCounter$12;var _style={};var _class=className?'tIcon '+className:'tIcon';return react.createElement('t-icon',{ref:function ref(container){_this2._container=container;},id:_id,style:_style,className:_class});}}]);return TIcon;}(react.Component);/**
   * @author [Tristan Valcke]{@link https://github.com/Itee}
   * @license [BSD-3-Clause]{@link https://opensource.org/licenses/BSD-3-Clause}
   *
   * @file Todo
   *
   * @example Todo
   *
   */var _instanceCounter$13=0;var TLabel=function(_React$Component){inherits(TLabel,_React$Component);function TLabel(props){classCallCheck(this,TLabel);var _this=possibleConstructorReturn(this,(TLabel.__proto__||Object.getPrototypeOf(TLabel)).call(this,props));_instanceCounter$13++;return _this;}/**
       * React lifecycle
       */createClass(TLabel,[{key:'componentWillMount',value:function componentWillMount(){}},{key:'componentDidMount',value:function componentDidMount(){}},{key:'componentWillUnmount',value:function componentWillUnmount(){}},{key:'componentWillReceiveProps',value:function componentWillReceiveProps()/*nextProps*/{}},{key:'shouldComponentUpdate',value:function shouldComponentUpdate()/*nextProps, nextState*/{}},{key:'componentWillUpdate',value:function componentWillUpdate()/*nextProps, nextState*/{}},{key:'componentDidUpdate',value:function componentDidUpdate()/*prevProps, prevState*/{}},{key:'render',value:function render(){var _this2=this;var _props=this.props,id=_props.id,className=_props.className;var _id=id||'tLabel_'+_instanceCounter$13;var _style={};var _class=className?'tLabel '+className:'tLabel';return react.createElement('t-label',{ref:function ref(container){_this2._container=container;},id:_id,style:_style,className:_class});}}]);return TLabel;}(react.Component);/**
   * @author [Tristan Valcke]{@link https://github.com/Itee}
   * @license [BSD-3-Clause]{@link https://opensource.org/licenses/BSD-3-Clause}
   *
   * @file Todo
   *
   * @example Todo
   *
   */var _instanceCounter$14=0;var TLegend=function(_React$Component){inherits(TLegend,_React$Component);function TLegend(props){classCallCheck(this,TLegend);var _this=possibleConstructorReturn(this,(TLegend.__proto__||Object.getPrototypeOf(TLegend)).call(this,props));_instanceCounter$14++;return _this;}/**
       * React lifecycle
       */createClass(TLegend,[{key:'componentWillMount',value:function componentWillMount(){}},{key:'componentDidMount',value:function componentDidMount(){}},{key:'componentWillUnmount',value:function componentWillUnmount(){}},{key:'componentWillReceiveProps',value:function componentWillReceiveProps()/*nextProps*/{}},{key:'shouldComponentUpdate',value:function shouldComponentUpdate()/*nextProps, nextState*/{}},{key:'componentWillUpdate',value:function componentWillUpdate()/*nextProps, nextState*/{}},{key:'componentDidUpdate',value:function componentDidUpdate()/*prevProps, prevState*/{}},{key:'render',value:function render(){var _this2=this;var _props=this.props,id=_props.id,className=_props.className;var _id=id||'tLegend_'+_instanceCounter$14;var _style={};var _class=className?'tLegend '+className:'tLegend';return react.createElement('t-legend',{ref:function ref(container){_this2._container=container;},id:_id,style:_style,className:_class});}}]);return TLegend;}(react.Component);/**
   * @author [Tristan Valcke]{@link https://github.com/Itee}
   * @license [BSD-3-Clause]{@link https://opensource.org/licenses/BSD-3-Clause}
   *
   * @file Todo
   *
   * @example Todo
   *
   */var _instanceCounter$15=0;var TLink=function(_React$Component){inherits(TLink,_React$Component);function TLink(props){classCallCheck(this,TLink);var _this=possibleConstructorReturn(this,(TLink.__proto__||Object.getPrototypeOf(TLink)).call(this,props));_instanceCounter$15++;return _this;}/**
       * React lifecycle
       */createClass(TLink,[{key:'componentWillMount',value:function componentWillMount(){}},{key:'componentDidMount',value:function componentDidMount(){}},{key:'componentWillUnmount',value:function componentWillUnmount(){}},{key:'componentWillReceiveProps',value:function componentWillReceiveProps()/*nextProps*/{}},{key:'shouldComponentUpdate',value:function shouldComponentUpdate()/*nextProps, nextState*/{}},{key:'componentWillUpdate',value:function componentWillUpdate()/*nextProps, nextState*/{}},{key:'componentDidUpdate',value:function componentDidUpdate()/*prevProps, prevState*/{}},{key:'render',value:function render(){var _this2=this;var _props=this.props,id=_props.id,className=_props.className;var _id=id||'tLink_'+_instanceCounter$15;var _style={};var _class=className?'tLink '+className:'tLink';return react.createElement('t-link',{ref:function ref(container){_this2._container=container;},id:_id,style:_style,className:_class});}}]);return TLink;}(react.Component);/**
   * @author [Tristan Valcke]{@link https://github.com/Itee}
   * @license [BSD-3-Clause]{@link https://opensource.org/licenses/BSD-3-Clause}
   *
   * @file Todo
   *
   * @example Todo
   *
   */var _instanceCounter$16=0;var TParagraphe=function(_React$Component){inherits(TParagraphe,_React$Component);function TParagraphe(props){classCallCheck(this,TParagraphe);var _this=possibleConstructorReturn(this,(TParagraphe.__proto__||Object.getPrototypeOf(TParagraphe)).call(this,props));_instanceCounter$16++;return _this;}/**
       * React lifecycle
       */createClass(TParagraphe,[{key:'componentWillMount',value:function componentWillMount(){}},{key:'componentDidMount',value:function componentDidMount(){}},{key:'componentWillUnmount',value:function componentWillUnmount(){}},{key:'componentWillReceiveProps',value:function componentWillReceiveProps()/*nextProps*/{}},{key:'shouldComponentUpdate',value:function shouldComponentUpdate()/*nextProps, nextState*/{}},{key:'componentWillUpdate',value:function componentWillUpdate()/*nextProps, nextState*/{}},{key:'componentDidUpdate',value:function componentDidUpdate()/*prevProps, prevState*/{}},{key:'render',value:function render(){var _this2=this;var _props=this.props,id=_props.id,className=_props.className;var _id=id||'tParagraphe_'+_instanceCounter$16;var _style={};var _class=className?'tParagraphe '+className:'tParagraphe';return react.createElement('t-paragraphe',{ref:function ref(container){_this2._container=container;},id:_id,style:_style,className:_class});}}]);return TParagraphe;}(react.Component);/**
   * @author [Tristan Valcke]{@link https://github.com/Itee}
   * @license [BSD-3-Clause]{@link https://opensource.org/licenses/BSD-3-Clause}
   *
   * @file Todo
   *
   * @example Todo
   *
   */var _instanceCounter$17=0;var TProgress=function(_React$Component){inherits(TProgress,_React$Component);function TProgress(props){classCallCheck(this,TProgress);var _this=possibleConstructorReturn(this,(TProgress.__proto__||Object.getPrototypeOf(TProgress)).call(this,props));_instanceCounter$17++;return _this;}/**
       * React lifecycle
       */createClass(TProgress,[{key:'componentWillMount',value:function componentWillMount(){}},{key:'componentDidMount',value:function componentDidMount(){}},{key:'componentWillUnmount',value:function componentWillUnmount(){}},{key:'componentWillReceiveProps',value:function componentWillReceiveProps()/*nextProps*/{}},{key:'shouldComponentUpdate',value:function shouldComponentUpdate()/*nextProps, nextState*/{}},{key:'componentWillUpdate',value:function componentWillUpdate()/*nextProps, nextState*/{}},{key:'componentDidUpdate',value:function componentDidUpdate()/*prevProps, prevState*/{}},{key:'render',value:function render(){var _this2=this;var _props=this.props,id=_props.id,className=_props.className;var _id=id||'tProgress_'+_instanceCounter$17;var _style={};var _class=className?'tProgress '+className:'tProgress';return react.createElement('t-progress',{ref:function ref(container){_this2._container=container;},id:_id,style:_style,className:_class});}}]);return TProgress;}(react.Component);/**
   * @author [Tristan Valcke]{@link https://github.com/Itee}
   * @license [BSD-3-Clause]{@link https://opensource.org/licenses/BSD-3-Clause}
   *
   * @file Todo
   *
   * @example Todo
   *
   */var _instanceCounter$18=0;var TQuote=function(_React$Component){inherits(TQuote,_React$Component);function TQuote(props){classCallCheck(this,TQuote);var _this=possibleConstructorReturn(this,(TQuote.__proto__||Object.getPrototypeOf(TQuote)).call(this,props));_instanceCounter$18++;return _this;}/**
       * React lifecycle
       */createClass(TQuote,[{key:'componentWillMount',value:function componentWillMount(){}},{key:'componentDidMount',value:function componentDidMount(){}},{key:'componentWillUnmount',value:function componentWillUnmount(){}},{key:'componentWillReceiveProps',value:function componentWillReceiveProps()/*nextProps*/{}},{key:'shouldComponentUpdate',value:function shouldComponentUpdate()/*nextProps, nextState*/{}},{key:'componentWillUpdate',value:function componentWillUpdate()/*nextProps, nextState*/{}},{key:'componentDidUpdate',value:function componentDidUpdate()/*prevProps, prevState*/{}},{key:'render',value:function render(){var _this2=this;var _props=this.props,id=_props.id,className=_props.className;var _id=id||'tQuote_'+_instanceCounter$18;var _style={};var _class=className?'tQuote '+className:'tQuote';return react.createElement('t-quote',{ref:function ref(container){_this2._container=container;},id:_id,style:_style,className:_class});}}]);return TQuote;}(react.Component);/**
   * @author [Tristan Valcke]{@link https://github.com/Itee}
   * @license [BSD-3-Clause]{@link https://opensource.org/licenses/BSD-3-Clause}
   *
   * @file Todo
   *
   * @example Todo
   *
   */var _instanceCounter$19=0;var TSpin=function(_React$Component){inherits(TSpin,_React$Component);function TSpin(props){classCallCheck(this,TSpin);var _this=possibleConstructorReturn(this,(TSpin.__proto__||Object.getPrototypeOf(TSpin)).call(this,props));_instanceCounter$19++;return _this;}/**
       * React lifecycle
       */createClass(TSpin,[{key:'componentWillMount',value:function componentWillMount(){}},{key:'componentDidMount',value:function componentDidMount(){}},{key:'componentWillUnmount',value:function componentWillUnmount(){}},{key:'componentWillReceiveProps',value:function componentWillReceiveProps()/*nextProps*/{}},{key:'shouldComponentUpdate',value:function shouldComponentUpdate()/*nextProps, nextState*/{}},{key:'componentWillUpdate',value:function componentWillUpdate()/*nextProps, nextState*/{}},{key:'componentDidUpdate',value:function componentDidUpdate()/*prevProps, prevState*/{}},{key:'render',value:function render(){var _this2=this;var _props=this.props,id=_props.id,className=_props.className;var _id=id||'tSpin_'+_instanceCounter$19;var _style={};var _class=className?'tSpin '+className:'tSpin';return react.createElement('t-spin',{ref:function ref(container){_this2._container=container;},id:_id,style:_style,className:_class});}}]);return TSpin;}(react.Component);/**
   * @author [Tristan Valcke]{@link https://github.com/Itee}
   * @license [BSD-3-Clause]{@link https://opensource.org/licenses/BSD-3-Clause}
   *
   * @file Todo
   *
   * @example Todo
   *
   */var _instanceCounter$20=0;var TTag=function(_React$Component){inherits(TTag,_React$Component);function TTag(props){classCallCheck(this,TTag);var _this=possibleConstructorReturn(this,(TTag.__proto__||Object.getPrototypeOf(TTag)).call(this,props));_instanceCounter$20++;return _this;}/**
       * React lifecycle
       */createClass(TTag,[{key:'componentWillMount',value:function componentWillMount(){}},{key:'componentDidMount',value:function componentDidMount(){}},{key:'componentWillUnmount',value:function componentWillUnmount(){}},{key:'componentWillReceiveProps',value:function componentWillReceiveProps()/*nextProps*/{}},{key:'shouldComponentUpdate',value:function shouldComponentUpdate()/*nextProps, nextState*/{}},{key:'componentWillUpdate',value:function componentWillUpdate()/*nextProps, nextState*/{}},{key:'componentDidUpdate',value:function componentDidUpdate()/*prevProps, prevState*/{}},{key:'render',value:function render(){var _this2=this;var _props=this.props,id=_props.id,className=_props.className;var _id=id||'tTag_'+_instanceCounter$20;var _style={};var _class=className?'tTag '+className:'tTag';return react.createElement('t-tag',{ref:function ref(container){_this2._container=container;},id:_id,style:_style,className:_class});}}]);return TTag;}(react.Component);/**
   * @author [Tristan Valcke]{@link https://github.com/Itee}
   * @license [BSD-3-Clause]{@link https://opensource.org/licenses/BSD-3-Clause}
   *
   * @file Todo
   *
   * @example Todo
   *
   */var _instanceCounter$21=0;var TTile=function(_React$Component){inherits(TTile,_React$Component);function TTile(props){classCallCheck(this,TTile);var _this=possibleConstructorReturn(this,(TTile.__proto__||Object.getPrototypeOf(TTile)).call(this,props));_instanceCounter$21++;return _this;}/**
       * React lifecycle
       */createClass(TTile,[{key:'componentWillMount',value:function componentWillMount(){}},{key:'componentDidMount',value:function componentDidMount(){}},{key:'componentWillUnmount',value:function componentWillUnmount(){}},{key:'componentWillReceiveProps',value:function componentWillReceiveProps()/*nextProps*/{}},{key:'shouldComponentUpdate',value:function shouldComponentUpdate()/*nextProps, nextState*/{}},{key:'componentWillUpdate',value:function componentWillUpdate()/*nextProps, nextState*/{}},{key:'componentDidUpdate',value:function componentDidUpdate()/*prevProps, prevState*/{}},{key:'render',value:function render(){var _this2=this;var _props=this.props,id=_props.id,className=_props.className;var _id=id||'tTile_'+_instanceCounter$21;var _style={};var _class=className?'tTile '+className:'tTile';return react.createElement('t-tile',{ref:function ref(container){_this2._container=container;},id:_id,style:_style,className:_class});}}]);return TTile;}(react.Component);/**
   * @author [Tristan Valcke]{@link https://github.com/Itee}
   * @license [BSD-3-Clause]{@link https://opensource.org/licenses/BSD-3-Clause}
   *
   * @file Todo
   *
   * @example Todo
   *
   */var _instanceCounter$22=0;var TTimeLine=function(_React$Component){inherits(TTimeLine,_React$Component);function TTimeLine(props){classCallCheck(this,TTimeLine);var _this=possibleConstructorReturn(this,(TTimeLine.__proto__||Object.getPrototypeOf(TTimeLine)).call(this,props));_instanceCounter$22++;return _this;}/**
       * React lifecycle
       */createClass(TTimeLine,[{key:'componentWillMount',value:function componentWillMount(){}},{key:'componentDidMount',value:function componentDidMount(){}},{key:'componentWillUnmount',value:function componentWillUnmount(){}},{key:'componentWillReceiveProps',value:function componentWillReceiveProps()/*nextProps*/{}},{key:'shouldComponentUpdate',value:function shouldComponentUpdate()/*nextProps, nextState*/{}},{key:'componentWillUpdate',value:function componentWillUpdate()/*nextProps, nextState*/{}},{key:'componentDidUpdate',value:function componentDidUpdate()/*prevProps, prevState*/{}},{key:'render',value:function render(){var _this2=this;var _props=this.props,id=_props.id,className=_props.className;var _id=id||'tTimeLine_'+_instanceCounter$22;var _style={};var _class=className?'tTimeLine '+className:'tTimeLine';return react.createElement('t-time-line',{ref:function ref(container){_this2._container=container;},id:_id,style:_style,className:_class});}}]);return TTimeLine;}(react.Component);/**
   * @author [Tristan Valcke]{@link https://github.com/Itee}
   * @license [BSD-3-Clause]{@link https://opensource.org/licenses/BSD-3-Clause}
   *
   * @file Todo
   *
   * @example Todo
   *
   */var _instanceCounter$23=0;var TToolTip=function(_React$Component){inherits(TToolTip,_React$Component);function TToolTip(props){classCallCheck(this,TToolTip);var _this=possibleConstructorReturn(this,(TToolTip.__proto__||Object.getPrototypeOf(TToolTip)).call(this,props));_instanceCounter$23++;return _this;}/**
       * React lifecycle
       */createClass(TToolTip,[{key:'componentWillMount',value:function componentWillMount(){}},{key:'componentDidMount',value:function componentDidMount(){}},{key:'componentWillUnmount',value:function componentWillUnmount(){}},{key:'componentWillReceiveProps',value:function componentWillReceiveProps()/*nextProps*/{}},{key:'shouldComponentUpdate',value:function shouldComponentUpdate()/*nextProps, nextState*/{}},{key:'componentWillUpdate',value:function componentWillUpdate()/*nextProps, nextState*/{}},{key:'componentDidUpdate',value:function componentDidUpdate()/*prevProps, prevState*/{}},{key:'render',value:function render(){var _this2=this;var _props=this.props,id=_props.id,className=_props.className;var _id=id||'tToolTip_'+_instanceCounter$23;var _style={};var _class=className?'tToolTip '+className:'tToolTip';return react.createElement('t-tool-tip',{ref:function ref(container){_this2._container=container;},id:_id,style:_style,className:_class});}}]);return TToolTip;}(react.Component);/**
   * @author [Tristan Valcke]{@link https://github.com/Itee}
   * @license [BSD-3-Clause]{@link https://opensource.org/licenses/BSD-3-Clause}
   *
   * @file Intermediary export file for uis/displays/bases folder
   *
   *//**
   * @author [Tristan Valcke]{@link https://github.com/Itee}
   * @license [BSD-3-Clause]{@link https://opensource.org/licenses/BSD-3-Clause}
   *
   * @file Todo
   *
   * @example Todo
   *
   */var _instanceCounter$24=0;var TAccordion=function(_React$Component){inherits(TAccordion,_React$Component);function TAccordion(props){classCallCheck(this,TAccordion);var _this=possibleConstructorReturn(this,(TAccordion.__proto__||Object.getPrototypeOf(TAccordion)).call(this,props));_instanceCounter$24++;return _this;}/**
       * React lifecycle
       */createClass(TAccordion,[{key:'componentWillMount',value:function componentWillMount(){}},{key:'componentDidMount',value:function componentDidMount(){}},{key:'componentWillUnmount',value:function componentWillUnmount(){}},{key:'componentWillReceiveProps',value:function componentWillReceiveProps()/*nextProps*/{}},{key:'shouldComponentUpdate',value:function shouldComponentUpdate()/*nextProps, nextState*/{}},{key:'componentWillUpdate',value:function componentWillUpdate()/*nextProps, nextState*/{}},{key:'componentDidUpdate',value:function componentDidUpdate()/*prevProps, prevState*/{}},{key:'render',value:function render(){var _this2=this;var _props=this.props,id=_props.id,className=_props.className;var _id=id||'tAccordion_'+_instanceCounter$24;var _style={};var _class=className?'tAccordion '+className:'tAccordion';return react.createElement('t-accordion',{ref:function ref(container){_this2._container=container;},id:_id,style:_style,className:_class});}}]);return TAccordion;}(react.Component);/**
   * @author [Tristan Valcke]{@link https://github.com/Itee}
   * @license [BSD-3-Clause]{@link https://opensource.org/licenses/BSD-3-Clause}
   *
   * @file Todo
   *
   * @example Todo
   *
   */var _instanceCounter$25=0;var TCollapse=function(_React$Component){inherits(TCollapse,_React$Component);function TCollapse(props){classCallCheck(this,TCollapse);var _this=possibleConstructorReturn(this,(TCollapse.__proto__||Object.getPrototypeOf(TCollapse)).call(this,props));_instanceCounter$25++;return _this;}/**
       * React lifecycle
       */createClass(TCollapse,[{key:'componentWillMount',value:function componentWillMount(){}},{key:'componentDidMount',value:function componentDidMount(){}},{key:'componentWillUnmount',value:function componentWillUnmount(){}},{key:'componentWillReceiveProps',value:function componentWillReceiveProps()/*nextProps*/{}},{key:'shouldComponentUpdate',value:function shouldComponentUpdate()/*nextProps, nextState*/{}},{key:'componentWillUpdate',value:function componentWillUpdate()/*nextProps, nextState*/{}},{key:'componentDidUpdate',value:function componentDidUpdate()/*prevProps, prevState*/{}},{key:'render',value:function render(){var _this2=this;var _props=this.props,id=_props.id,className=_props.className;var _id=id||'tCollapse_'+_instanceCounter$25;var _style={};var _class=className?'tCollapse '+className:'tCollapse';return react.createElement('t-collapse',{ref:function ref(container){_this2._container=container;},id:_id,style:_style,className:_class});}}]);return TCollapse;}(react.Component);/**
   * @author [Tristan Valcke]{@link https://github.com/Itee}
   * @license [BSD-3-Clause]{@link https://opensource.org/licenses/BSD-3-Clause}
   *
   * @file Todo
   *
   * @example Todo
   *
   */var _instanceCounter$26=0;var TList=function(_React$Component){inherits(TList,_React$Component);function TList(props){classCallCheck(this,TList);var _this=possibleConstructorReturn(this,(TList.__proto__||Object.getPrototypeOf(TList)).call(this,props));_instanceCounter$26++;return _this;}/**
       * React lifecycle
       */createClass(TList,[{key:'componentWillMount',value:function componentWillMount(){}},{key:'componentDidMount',value:function componentDidMount(){}},{key:'componentWillUnmount',value:function componentWillUnmount(){}},{key:'componentWillReceiveProps',value:function componentWillReceiveProps()/*nextProps*/{}},{key:'shouldComponentUpdate',value:function shouldComponentUpdate()/*nextProps, nextState*/{}},{key:'componentWillUpdate',value:function componentWillUpdate()/*nextProps, nextState*/{}},{key:'componentDidUpdate',value:function componentDidUpdate()/*prevProps, prevState*/{}},{key:'render',value:function render(){var _this2=this;var _props=this.props,id=_props.id,className=_props.className;var _id=id||'tList_'+_instanceCounter$26;var _style={};var _class=className?'tList '+className:'tList';return react.createElement('t-list',{ref:function ref(container){_this2._container=container;},id:_id,style:_style,className:_class});}}]);return TList;}(react.Component);/**
   * @author [Tristan Valcke]{@link https://github.com/Itee}
   * @license [BSD-3-Clause]{@link https://opensource.org/licenses/BSD-3-Clause}
   *
   * @file Todo
   *
   * @example Todo
   *
   */var _instanceCounter$27=0;var TFeed=function(_React$Component){inherits(TFeed,_React$Component);function TFeed(props){classCallCheck(this,TFeed);var _this=possibleConstructorReturn(this,(TFeed.__proto__||Object.getPrototypeOf(TFeed)).call(this,props));_instanceCounter$27++;return _this;}/**
       * React lifecycle
       */createClass(TFeed,[{key:'componentWillMount',value:function componentWillMount(){}},{key:'componentDidMount',value:function componentDidMount(){}},{key:'componentWillUnmount',value:function componentWillUnmount(){}},{key:'componentWillReceiveProps',value:function componentWillReceiveProps()/*nextProps*/{}},{key:'shouldComponentUpdate',value:function shouldComponentUpdate()/*nextProps, nextState*/{}},{key:'componentWillUpdate',value:function componentWillUpdate()/*nextProps, nextState*/{}},{key:'componentDidUpdate',value:function componentDidUpdate()/*prevProps, prevState*/{}},{key:'render',value:function render(){var _this2=this;var _props=this.props,id=_props.id,className=_props.className;var _id=id||'tFeed_'+_instanceCounter$27;var _style={};var _class=className?'tFeed '+className:'tFeed';return react.createElement('t-feed',{ref:function ref(container){_this2._container=container;},id:_id,style:_style,className:_class});}}]);return TFeed;}(react.Component);/**
   * @author [Tristan Valcke]{@link https://github.com/Itee}
   * @license [BSD-3-Clause]{@link https://opensource.org/licenses/BSD-3-Clause}
   *
   * @file Intermediary export file for uis/displays/collections folder
   *
   *//**
   * @author [Tristan Valcke]{@link https://github.com/Itee}
   * @license [BSD-3-Clause]{@link https://opensource.org/licenses/BSD-3-Clause}
   *
   * @file Todo
   *
   * @example Todo
   *
   */var _instanceCounter$28=0;var TDock=function(_React$Component){inherits(TDock,_React$Component);function TDock(props){classCallCheck(this,TDock);var _this=possibleConstructorReturn(this,(TDock.__proto__||Object.getPrototypeOf(TDock)).call(this,props));_instanceCounter$28++;return _this;}/**
       * React lifecycle
       */createClass(TDock,[{key:'componentWillMount',value:function componentWillMount(){}},{key:'componentDidMount',value:function componentDidMount(){}},{key:'componentWillUnmount',value:function componentWillUnmount(){}},{key:'componentWillReceiveProps',value:function componentWillReceiveProps()/*nextProps*/{}},{key:'shouldComponentUpdate',value:function shouldComponentUpdate()/*nextProps, nextState*/{}},{key:'componentWillUpdate',value:function componentWillUpdate()/*nextProps, nextState*/{}},{key:'componentDidUpdate',value:function componentDidUpdate()/*prevProps, prevState*/{}},{key:'render',value:function render(){var _this2=this;var _props=this.props,id=_props.id,className=_props.className;var _id=id||'tDock_'+_instanceCounter$28;var _style={};var _class=className?'tDock '+className:'tDock';return react.createElement('t-dock',{ref:function ref(container){_this2._container=container;},id:_id,style:_style,className:_class});}}]);return TDock;}(react.Component);/**
   * @author [Tristan Valcke]{@link https://github.com/Itee}
   * @license [BSD-3-Clause]{@link https://opensource.org/licenses/BSD-3-Clause}
   *
   * @file Intermediary export file for uis/displays/docks folder
   *
   *//**
   * @author [Tristan Valcke]{@link https://github.com/Itee}
   * @license [BSD-3-Clause]{@link https://opensource.org/licenses/BSD-3-Clause}
   *
   * @file Todo
   *
   * @example Todo
   *
   */var _instanceCounter$29=0;var TCentererLayout=function(_React$Component){inherits(TCentererLayout,_React$Component);function TCentererLayout(props){classCallCheck(this,TCentererLayout);var _this=possibleConstructorReturn(this,(TCentererLayout.__proto__||Object.getPrototypeOf(TCentererLayout)).call(this,props));_instanceCounter$29++;return _this;}/**
       * React lifecycle
       */createClass(TCentererLayout,[{key:'componentWillMount',value:function componentWillMount(){}},{key:'componentDidMount',value:function componentDidMount(){}},{key:'componentWillUnmount',value:function componentWillUnmount(){}},{key:'componentWillReceiveProps',value:function componentWillReceiveProps()/*nextProps*/{}},{key:'shouldComponentUpdate',value:function shouldComponentUpdate()/*nextProps, nextState*/{}},{key:'componentWillUpdate',value:function componentWillUpdate()/*nextProps, nextState*/{}},{key:'componentDidUpdate',value:function componentDidUpdate()/*prevProps, prevState*/{}},{key:'render',value:function render(){var _this2=this;var _props=this.props,id=_props.id,className=_props.className;var _id=id||'tCentererLayout_'+_instanceCounter$29;var _style={};var _class=className?'tCentererLayout '+className:'tCentererLayout';return react.createElement('t-centerer-layout',{ref:function ref(container){_this2._container=container;},id:_id,style:_style,className:_class});}}]);return TCentererLayout;}(react.Component);/**
   * @author [Tristan Valcke]{@link https://github.com/Itee}
   * @license [BSD-3-Clause]{@link https://opensource.org/licenses/BSD-3-Clause}
   *
   * @file Todo
   *
   * @example Todo
   *
   */var _instanceCounter$30=0;var TGridLayout=function(_React$Component){inherits(TGridLayout,_React$Component);function TGridLayout(props){classCallCheck(this,TGridLayout);var _this=possibleConstructorReturn(this,(TGridLayout.__proto__||Object.getPrototypeOf(TGridLayout)).call(this,props));_instanceCounter$30++;return _this;}/**
       * React lifecycle
       */createClass(TGridLayout,[{key:'componentWillMount',value:function componentWillMount(){}},{key:'componentDidMount',value:function componentDidMount(){}},{key:'componentWillUnmount',value:function componentWillUnmount(){}},{key:'componentWillReceiveProps',value:function componentWillReceiveProps()/*nextProps*/{}},{key:'shouldComponentUpdate',value:function shouldComponentUpdate()/*nextProps, nextState*/{}},{key:'componentWillUpdate',value:function componentWillUpdate()/*nextProps, nextState*/{}},{key:'componentDidUpdate',value:function componentDidUpdate()/*prevProps, prevState*/{}},{key:'render',value:function render(){var _this2=this;var _props=this.props,id=_props.id,className=_props.className;var _id=id||'tGridLayout_'+_instanceCounter$30;var _style={};var _class=className?'tGridLayout '+className:'tGridLayout';return react.createElement('t-grid-layout',{ref:function ref(container){_this2._container=container;},id:_id,style:_style,className:_class});}}]);return TGridLayout;}(react.Component);/**
   * @author [Tristan Valcke]{@link https://github.com/Itee}
   * @license [BSD-3-Clause]{@link https://opensource.org/licenses/BSD-3-Clause}
   *
   * @file Todo
   *
   * @example Todo
   *
   */var _instanceCounter$31=0;var THorizontalLayout=function(_React$Component){inherits(THorizontalLayout,_React$Component);function THorizontalLayout(props){classCallCheck(this,THorizontalLayout);var _this=possibleConstructorReturn(this,(THorizontalLayout.__proto__||Object.getPrototypeOf(THorizontalLayout)).call(this,props));_instanceCounter$31++;return _this;}/**
       * React lifecycle
       */createClass(THorizontalLayout,[{key:'componentWillMount',value:function componentWillMount(){}},{key:'componentDidMount',value:function componentDidMount(){}},{key:'componentWillUnmount',value:function componentWillUnmount(){}},{key:'componentWillReceiveProps',value:function componentWillReceiveProps()/*nextProps*/{}},{key:'shouldComponentUpdate',value:function shouldComponentUpdate()/*nextProps, nextState*/{}},{key:'componentWillUpdate',value:function componentWillUpdate()/*nextProps, nextState*/{}},{key:'componentDidUpdate',value:function componentDidUpdate()/*prevProps, prevState*/{}},{key:'render',value:function render(){var _this2=this;var _props=this.props,id=_props.id,className=_props.className;var _id=id||'tHorizontalLayout_'+_instanceCounter$31;var _style={};var _class=className?'tHorizontalLayout '+className:'tHorizontalLayout';return react.createElement('t-horizontal-layout',{ref:function ref(container){_this2._container=container;},id:_id,style:_style,className:_class});}}]);return THorizontalLayout;}(react.Component);/**
   * @author [Tristan Valcke]{@link https://github.com/Itee}
   * @license [BSD-3-Clause]{@link https://opensource.org/licenses/BSD-3-Clause}
   *
   * @file Todo
   *
   * @example Todo
   *
   */var _instanceCounter$32=0;var TJustifiedLayout=function(_React$Component){inherits(TJustifiedLayout,_React$Component);function TJustifiedLayout(props){classCallCheck(this,TJustifiedLayout);var _this=possibleConstructorReturn(this,(TJustifiedLayout.__proto__||Object.getPrototypeOf(TJustifiedLayout)).call(this,props));_instanceCounter$32++;return _this;}/**
       * React lifecycle
       */createClass(TJustifiedLayout,[{key:'componentWillMount',value:function componentWillMount(){}},{key:'componentDidMount',value:function componentDidMount(){}},{key:'componentWillUnmount',value:function componentWillUnmount(){}},{key:'componentWillReceiveProps',value:function componentWillReceiveProps()/*nextProps*/{}},{key:'shouldComponentUpdate',value:function shouldComponentUpdate()/*nextProps, nextState*/{}},{key:'componentWillUpdate',value:function componentWillUpdate()/*nextProps, nextState*/{}},{key:'componentDidUpdate',value:function componentDidUpdate()/*prevProps, prevState*/{}},{key:'render',value:function render(){var _this2=this;var _props=this.props,id=_props.id,className=_props.className;var _id=id||'tJustifiedLayout_'+_instanceCounter$32;var _style={};var _class=className?'tJustifiedLayout '+className:'tJustifiedLayout';return react.createElement('t-justified-layout',{ref:function ref(container){_this2._container=container;},id:_id,style:_style,className:_class});}}]);return TJustifiedLayout;}(react.Component);/**
   * @author [Tristan Valcke]{@link https://github.com/Itee}
   * @license [BSD-3-Clause]{@link https://opensource.org/licenses/BSD-3-Clause}
   *
   * @file Todo
   *
   * @example Todo
   *
   */var _instanceCounter$33=0;var TLayout=function(_React$Component){inherits(TLayout,_React$Component);function TLayout(props){classCallCheck(this,TLayout);var _this=possibleConstructorReturn(this,(TLayout.__proto__||Object.getPrototypeOf(TLayout)).call(this,props));_instanceCounter$33++;return _this;}/**
       * React lifecycle
       */createClass(TLayout,[{key:'componentWillMount',value:function componentWillMount(){}},{key:'componentDidMount',value:function componentDidMount(){}},{key:'componentWillUnmount',value:function componentWillUnmount(){}},{key:'componentWillReceiveProps',value:function componentWillReceiveProps()/*nextProps*/{}},{key:'shouldComponentUpdate',value:function shouldComponentUpdate()/*nextProps, nextState*/{}},{key:'componentWillUpdate',value:function componentWillUpdate()/*nextProps, nextState*/{}},{key:'componentDidUpdate',value:function componentDidUpdate()/*prevProps, prevState*/{}},{key:'render',value:function render(){var _this2=this;var _props=this.props,id=_props.id,className=_props.className;var _id=id||'tLayout_'+_instanceCounter$33;var _style={};var _class=className?'tLayout '+className:'tLayout';return react.createElement('t-layout',{ref:function ref(container){_this2._container=container;},id:_id,style:_style,className:_class});}}]);return TLayout;}(react.Component);/**
   * @author [Tristan Valcke]{@link https://github.com/Itee}
   * @license [BSD-3-Clause]{@link https://opensource.org/licenses/BSD-3-Clause}
   *
   * @file Todo
   *
   * @example Todo
   *
   */var _instanceCounter$34=0;var TVerticalLayout=function(_React$Component){inherits(TVerticalLayout,_React$Component);function TVerticalLayout(props){classCallCheck(this,TVerticalLayout);var _this=possibleConstructorReturn(this,(TVerticalLayout.__proto__||Object.getPrototypeOf(TVerticalLayout)).call(this,props));_instanceCounter$34++;return _this;}/**
       * React lifecycle
       */createClass(TVerticalLayout,[{key:'componentWillMount',value:function componentWillMount(){}},{key:'componentDidMount',value:function componentDidMount(){}},{key:'componentWillUnmount',value:function componentWillUnmount(){}},{key:'componentWillReceiveProps',value:function componentWillReceiveProps()/*nextProps*/{}},{key:'shouldComponentUpdate',value:function shouldComponentUpdate()/*nextProps, nextState*/{}},{key:'componentWillUpdate',value:function componentWillUpdate()/*nextProps, nextState*/{}},{key:'componentDidUpdate',value:function componentDidUpdate()/*prevProps, prevState*/{}},{key:'render',value:function render(){var _this2=this;var _props=this.props,id=_props.id,className=_props.className;var _id=id||'tVerticalLayout_'+_instanceCounter$34;var _style={};var _class=className?'tVerticalLayout '+className:'tVerticalLayout';return react.createElement('t-vertical-layout',{ref:function ref(container){_this2._container=container;},id:_id,style:_style,className:_class});}}]);return TVerticalLayout;}(react.Component);/**
   * @author [Tristan Valcke]{@link https://github.com/Itee}
   * @license [BSD-3-Clause]{@link https://opensource.org/licenses/BSD-3-Clause}
   *
   * @file Intermediary export file for uis/displays/layouts folder
   *
   *//**
   * @author [Tristan Valcke]{@link https://github.com/Itee}
   * @license [BSD-3-Clause]{@link https://opensource.org/licenses/BSD-3-Clause}
   *
   * @file Todo
   *
   * @example Todo
   *
   */var _instanceCounter$35=0;var TAudio=function(_React$Component){inherits(TAudio,_React$Component);function TAudio(props){classCallCheck(this,TAudio);var _this=possibleConstructorReturn(this,(TAudio.__proto__||Object.getPrototypeOf(TAudio)).call(this,props));_instanceCounter$35++;return _this;}/**
       * React lifecycle
       */createClass(TAudio,[{key:'componentWillMount',value:function componentWillMount(){}},{key:'componentDidMount',value:function componentDidMount(){}},{key:'componentWillUnmount',value:function componentWillUnmount(){}},{key:'componentWillReceiveProps',value:function componentWillReceiveProps()/*nextProps*/{}},{key:'shouldComponentUpdate',value:function shouldComponentUpdate()/*nextProps, nextState*/{}},{key:'componentWillUpdate',value:function componentWillUpdate()/*nextProps, nextState*/{}},{key:'componentDidUpdate',value:function componentDidUpdate()/*prevProps, prevState*/{}},{key:'render',value:function render(){var _this2=this;var _props=this.props,id=_props.id,className=_props.className;var _id=id||'tAudio_'+_instanceCounter$35;var _style={};var _class=className?'tAudio '+className:'tAudio';return react.createElement('t-audio',{ref:function ref(container){_this2._container=container;},id:_id,style:_style,className:_class});}}]);return TAudio;}(react.Component);/**
   * @author [Tristan Valcke]{@link https://github.com/Itee}
   * @license [BSD-3-Clause]{@link https://opensource.org/licenses/BSD-3-Clause}
   *
   * @file Todo
   *
   * @example Todo
   *
   */var _instanceCounter$36=0;var TCarousel=function(_React$Component){inherits(TCarousel,_React$Component);function TCarousel(props){classCallCheck(this,TCarousel);var _this=possibleConstructorReturn(this,(TCarousel.__proto__||Object.getPrototypeOf(TCarousel)).call(this,props));_instanceCounter$36++;return _this;}/**
       * React lifecycle
       */createClass(TCarousel,[{key:'componentWillMount',value:function componentWillMount(){}},{key:'componentDidMount',value:function componentDidMount(){}},{key:'componentWillUnmount',value:function componentWillUnmount(){}},{key:'componentWillReceiveProps',value:function componentWillReceiveProps()/*nextProps*/{}},{key:'shouldComponentUpdate',value:function shouldComponentUpdate()/*nextProps, nextState*/{}},{key:'componentWillUpdate',value:function componentWillUpdate()/*nextProps, nextState*/{}},{key:'componentDidUpdate',value:function componentDidUpdate()/*prevProps, prevState*/{}},{key:'render',value:function render(){var _this2=this;var _props=this.props,id=_props.id,className=_props.className;var _id=id||'tCarousel_'+_instanceCounter$36;var _style={};var _class=className?'tCarousel '+className:'tCarousel';return react.createElement('t-carousel',{ref:function ref(container){_this2._container=container;},id:_id,style:_style,className:_class});}}]);return TCarousel;}(react.Component);/**
   * @author [Tristan Valcke]{@link https://github.com/Itee}
   * @license [BSD-3-Clause]{@link https://opensource.org/licenses/BSD-3-Clause}
   *
   * @file Todo
   *
   * @example Todo
   *
   */var _instanceCounter$37=0;var TImage=function(_React$Component){inherits(TImage,_React$Component);function TImage(props){classCallCheck(this,TImage);var _this=possibleConstructorReturn(this,(TImage.__proto__||Object.getPrototypeOf(TImage)).call(this,props));_instanceCounter$37++;return _this;}/**
       * React lifecycle
       */createClass(TImage,[{key:'componentWillMount',value:function componentWillMount(){}},{key:'componentDidMount',value:function componentDidMount(){}},{key:'componentWillUnmount',value:function componentWillUnmount(){}},{key:'componentWillReceiveProps',value:function componentWillReceiveProps()/*nextProps*/{}},{key:'shouldComponentUpdate',value:function shouldComponentUpdate()/*nextProps, nextState*/{}},{key:'componentWillUpdate',value:function componentWillUpdate()/*nextProps, nextState*/{}},{key:'componentDidUpdate',value:function componentDidUpdate()/*prevProps, prevState*/{}},{key:'render',value:function render(){var _this2=this;var _props=this.props,id=_props.id,className=_props.className;var _id=id||'tImage_'+_instanceCounter$37;var _style={};var _class=className?'tImage '+className:'tImage';return react.createElement('t-image',{ref:function ref(container){_this2._container=container;},id:_id,style:_style,className:_class});}}]);return TImage;}(react.Component);/**
   * @author [Tristan Valcke]{@link https://github.com/Itee}
   * @license [BSD-3-Clause]{@link https://opensource.org/licenses/BSD-3-Clause}
   *
   * @file Todo
   *
   * @example Todo
   *
   */var _instanceCounter$38=0;var TMap=function(_React$Component){inherits(TMap,_React$Component);function TMap(props){classCallCheck(this,TMap);var _this=possibleConstructorReturn(this,(TMap.__proto__||Object.getPrototypeOf(TMap)).call(this,props));_instanceCounter$38++;return _this;}/**
       * React lifecycle
       */createClass(TMap,[{key:'componentWillMount',value:function componentWillMount(){}},{key:'componentDidMount',value:function componentDidMount(){}},{key:'componentWillUnmount',value:function componentWillUnmount(){}},{key:'componentWillReceiveProps',value:function componentWillReceiveProps()/*nextProps*/{}},{key:'shouldComponentUpdate',value:function shouldComponentUpdate()/*nextProps, nextState*/{}},{key:'componentWillUpdate',value:function componentWillUpdate()/*nextProps, nextState*/{}},{key:'componentDidUpdate',value:function componentDidUpdate()/*prevProps, prevState*/{}},{key:'render',value:function render(){var _this2=this;var _props=this.props,id=_props.id,className=_props.className;var _id=id||'tMap_'+_instanceCounter$38;var _style={};var _class=className?'tMap '+className:'tMap';return react.createElement('t-map',{ref:function ref(container){_this2._container=container;},id:_id,style:_style,className:_class});}}]);return TMap;}(react.Component);/**
   * @author [Tristan Valcke]{@link https://github.com/Itee}
   * @license [BSD-3-Clause]{@link https://opensource.org/licenses/BSD-3-Clause}
   *
   * @file Todo
   *
   * @example Todo
   *
   */var _instanceCounter$39=0;var TParallax=function(_React$Component){inherits(TParallax,_React$Component);function TParallax(props){classCallCheck(this,TParallax);var _this=possibleConstructorReturn(this,(TParallax.__proto__||Object.getPrototypeOf(TParallax)).call(this,props));_instanceCounter$39++;return _this;}/**
       * React lifecycle
       */createClass(TParallax,[{key:'componentWillMount',value:function componentWillMount(){}},{key:'componentDidMount',value:function componentDidMount(){}},{key:'componentWillUnmount',value:function componentWillUnmount(){}},{key:'componentWillReceiveProps',value:function componentWillReceiveProps()/*nextProps*/{}},{key:'shouldComponentUpdate',value:function shouldComponentUpdate()/*nextProps, nextState*/{}},{key:'componentWillUpdate',value:function componentWillUpdate()/*nextProps, nextState*/{}},{key:'componentDidUpdate',value:function componentDidUpdate()/*prevProps, prevState*/{}},{key:'render',value:function render(){var _this2=this;var _props=this.props,id=_props.id,className=_props.className;var _id=id||'tParallax_'+_instanceCounter$39;var _style={};var _class=className?'tParallax '+className:'tParallax';return react.createElement('t-parallax',{ref:function ref(container){_this2._container=container;},id:_id,style:_style,className:_class});}}]);return TParallax;}(react.Component);/**
   * @author [Tristan Valcke]{@link https://github.com/Itee}
   * @license [BSD-3-Clause]{@link https://opensource.org/licenses/BSD-3-Clause}
   *
   * @file Todo
   *
   * @example Todo
   *
   */var _instanceCounter$40=0;var TVideo=function(_React$Component){inherits(TVideo,_React$Component);function TVideo(props){classCallCheck(this,TVideo);var _this=possibleConstructorReturn(this,(TVideo.__proto__||Object.getPrototypeOf(TVideo)).call(this,props));_instanceCounter$40++;return _this;}/**
       * React lifecycle
       */createClass(TVideo,[{key:'componentWillMount',value:function componentWillMount(){}},{key:'componentDidMount',value:function componentDidMount(){}},{key:'componentWillUnmount',value:function componentWillUnmount(){}},{key:'componentWillReceiveProps',value:function componentWillReceiveProps()/*nextProps*/{}},{key:'shouldComponentUpdate',value:function shouldComponentUpdate()/*nextProps, nextState*/{}},{key:'componentWillUpdate',value:function componentWillUpdate()/*nextProps, nextState*/{}},{key:'componentDidUpdate',value:function componentDidUpdate()/*prevProps, prevState*/{}},{key:'render',value:function render(){var _this2=this;var _props=this.props,id=_props.id,className=_props.className;var _id=id||'tVideo_'+_instanceCounter$40;var _style={};var _class=className?'tVideo '+className:'tVideo';return react.createElement('t-video',{ref:function ref(container){_this2._container=container;},id:_id,style:_style,className:_class});}}]);return TVideo;}(react.Component);/**
   * @author [Tristan Valcke]{@link https://github.com/Itee}
   * @license [BSD-3-Clause]{@link https://opensource.org/licenses/BSD-3-Clause}
   *
   * @file Todo
   *
   * @example Todo
   *
   */var _instanceCounter$41=0;var TViewport3D$1=function(_React$Component){inherits(TViewport3D,_React$Component);function TViewport3D(props){classCallCheck(this,TViewport3D);var _this=possibleConstructorReturn(this,(TViewport3D.__proto__||Object.getPrototypeOf(TViewport3D)).call(this,props));_instanceCounter$41++;return _this;}/**
       * React lifecycle
       */createClass(TViewport3D,[{key:'componentWillMount',value:function componentWillMount(){}},{key:'componentDidMount',value:function componentDidMount(){}},{key:'componentWillUnmount',value:function componentWillUnmount(){}},{key:'componentWillReceiveProps',value:function componentWillReceiveProps()/*nextProps*/{}},{key:'shouldComponentUpdate',value:function shouldComponentUpdate()/*nextProps, nextState*/{}},{key:'componentWillUpdate',value:function componentWillUpdate()/*nextProps, nextState*/{}},{key:'componentDidUpdate',value:function componentDidUpdate()/*prevProps, prevState*/{}},{key:'render',value:function render(){var _this2=this;var _props=this.props,id=_props.id,className=_props.className;var _id=id||'tViewport3D_'+_instanceCounter$41;var _style={};var _class=className?'tViewport3D '+className:'tViewport3D';return react.createElement('t-viewport-3-d',{ref:function ref(container){_this2._container=container;},id:_id,style:_style,className:_class});}}]);return TViewport3D;}(react.Component);/**
   * @author [Tristan Valcke]{@link https://github.com/Itee}
   * @license [BSD-3-Clause]{@link https://opensource.org/licenses/BSD-3-Clause}
   *
   * @file Intermediary export file for uis/displays/medias folder
   *
   *//**
   * @author [Tristan Valcke]{@link https://github.com/Itee}
   * @license [BSD-3-Clause]{@link https://opensource.org/licenses/BSD-3-Clause}
   *
   * @file Todo
   *
   * @example Todo
   *
   */var _instanceCounter$42=0;var TAffix=function(_React$Component){inherits(TAffix,_React$Component);function TAffix(props){classCallCheck(this,TAffix);var _this=possibleConstructorReturn(this,(TAffix.__proto__||Object.getPrototypeOf(TAffix)).call(this,props));_instanceCounter$42++;return _this;}/**
       * React lifecycle
       */createClass(TAffix,[{key:'componentWillMount',value:function componentWillMount(){}},{key:'componentDidMount',value:function componentDidMount(){}},{key:'componentWillUnmount',value:function componentWillUnmount(){}},{key:'componentWillReceiveProps',value:function componentWillReceiveProps()/*nextProps*/{}},{key:'shouldComponentUpdate',value:function shouldComponentUpdate()/*nextProps, nextState*/{}},{key:'componentWillUpdate',value:function componentWillUpdate()/*nextProps, nextState*/{}},{key:'componentDidUpdate',value:function componentDidUpdate()/*prevProps, prevState*/{}},{key:'render',value:function render(){var _this2=this;var _props=this.props,id=_props.id,className=_props.className;var _id=id||'tAffix_'+_instanceCounter$42;var _style={};var _class=className?'tAffix '+className:'tAffix';return react.createElement('t-affix',{ref:function ref(container){_this2._container=container;},id:_id,style:_style,className:_class});}}]);return TAffix;}(react.Component);/**
   * @author [Tristan Valcke]{@link https://github.com/Itee}
   * @license [BSD-3-Clause]{@link https://opensource.org/licenses/BSD-3-Clause}
   *
   * @file Todo
   *
   * @example Todo
   *
   */var _instanceCounter$43=0;var TAnchor=function(_React$Component){inherits(TAnchor,_React$Component);function TAnchor(props){classCallCheck(this,TAnchor);var _this=possibleConstructorReturn(this,(TAnchor.__proto__||Object.getPrototypeOf(TAnchor)).call(this,props));_instanceCounter$43++;return _this;}/**
       * React lifecycle
       */createClass(TAnchor,[{key:'componentWillMount',value:function componentWillMount(){}},{key:'componentDidMount',value:function componentDidMount(){}},{key:'componentWillUnmount',value:function componentWillUnmount(){}},{key:'componentWillReceiveProps',value:function componentWillReceiveProps()/*nextProps*/{}},{key:'shouldComponentUpdate',value:function shouldComponentUpdate()/*nextProps, nextState*/{}},{key:'componentWillUpdate',value:function componentWillUpdate()/*nextProps, nextState*/{}},{key:'componentDidUpdate',value:function componentDidUpdate()/*prevProps, prevState*/{}},{key:'render',value:function render(){var _this2=this;var _props=this.props,id=_props.id,className=_props.className;var _id=id||'tAnchor_'+_instanceCounter$43;var _style={};var _class=className?'tAnchor '+className:'tAnchor';return react.createElement('t-anchor',{ref:function ref(container){_this2._container=container;},id:_id,style:_style,className:_class});}}]);return TAnchor;}(react.Component);/**
   * @author [Tristan Valcke]{@link https://github.com/Itee}
   * @license [BSD-3-Clause]{@link https://opensource.org/licenses/BSD-3-Clause}
   *
   * @file Todo
   *
   * @example Todo
   *
   */var _instanceCounter$44=0;var TBackToTop=function(_React$Component){inherits(TBackToTop,_React$Component);function TBackToTop(props){classCallCheck(this,TBackToTop);var _this=possibleConstructorReturn(this,(TBackToTop.__proto__||Object.getPrototypeOf(TBackToTop)).call(this,props));_instanceCounter$44++;return _this;}/**
       * React lifecycle
       */createClass(TBackToTop,[{key:'componentWillMount',value:function componentWillMount(){}},{key:'componentDidMount',value:function componentDidMount(){}},{key:'componentWillUnmount',value:function componentWillUnmount(){}},{key:'componentWillReceiveProps',value:function componentWillReceiveProps()/*nextProps*/{}},{key:'shouldComponentUpdate',value:function shouldComponentUpdate()/*nextProps, nextState*/{}},{key:'componentWillUpdate',value:function componentWillUpdate()/*nextProps, nextState*/{}},{key:'componentDidUpdate',value:function componentDidUpdate()/*prevProps, prevState*/{}},{key:'render',value:function render(){var _this2=this;var _props=this.props,id=_props.id,className=_props.className;var _id=id||'tBackToTop_'+_instanceCounter$44;var _style={};var _class=className?'tBackToTop '+className:'tBackToTop';return react.createElement('t-back-to-top',{ref:function ref(container){_this2._container=container;},id:_id,style:_style,className:_class});}}]);return TBackToTop;}(react.Component);/**
   * @author [Tristan Valcke]{@link https://github.com/Itee}
   * @license [BSD-3-Clause]{@link https://opensource.org/licenses/BSD-3-Clause}
   *
   * @file Todo
   *
   * @example Todo
   *
   */var _instanceCounter$45=0;var TBrand$1=function(_React$Component){inherits(TBrand,_React$Component);function TBrand(props){classCallCheck(this,TBrand);var _this=possibleConstructorReturn(this,(TBrand.__proto__||Object.getPrototypeOf(TBrand)).call(this,props));_instanceCounter$45++;return _this;}/**
       * React lifecycle
       */createClass(TBrand,[{key:'componentWillMount',value:function componentWillMount(){}},{key:'componentDidMount',value:function componentDidMount(){}},{key:'componentWillUnmount',value:function componentWillUnmount(){}},{key:'componentWillReceiveProps',value:function componentWillReceiveProps()/*nextProps*/{}},{key:'shouldComponentUpdate',value:function shouldComponentUpdate()/*nextProps, nextState*/{}},{key:'componentWillUpdate',value:function componentWillUpdate()/*nextProps, nextState*/{}},{key:'componentDidUpdate',value:function componentDidUpdate()/*prevProps, prevState*/{}},{key:'render',value:function render(){var _this2=this;var _props=this.props,id=_props.id,className=_props.className;var _id=id||'tBrand_'+_instanceCounter$45;var _style={};var _class=className?'tBrand '+className:'tBrand';return react.createElement('t-brand',{ref:function ref(container){_this2._container=container;},id:_id,style:_style,className:_class});}}]);return TBrand;}(react.Component);/**
   * @author [Tristan Valcke]{@link https://github.com/Itee}
   * @license [BSD-3-Clause]{@link https://opensource.org/licenses/BSD-3-Clause}
   *
   * @file Todo
   *
   * @example Todo
   *
   */var _instanceCounter$46=0;var TBreadcrumb=function(_React$Component){inherits(TBreadcrumb,_React$Component);function TBreadcrumb(props){classCallCheck(this,TBreadcrumb);var _this=possibleConstructorReturn(this,(TBreadcrumb.__proto__||Object.getPrototypeOf(TBreadcrumb)).call(this,props));_instanceCounter$46++;return _this;}/**
       * React lifecycle
       */createClass(TBreadcrumb,[{key:'componentWillMount',value:function componentWillMount(){}},{key:'componentDidMount',value:function componentDidMount(){}},{key:'componentWillUnmount',value:function componentWillUnmount(){}},{key:'componentWillReceiveProps',value:function componentWillReceiveProps()/*nextProps*/{}},{key:'shouldComponentUpdate',value:function shouldComponentUpdate()/*nextProps, nextState*/{}},{key:'componentWillUpdate',value:function componentWillUpdate()/*nextProps, nextState*/{}},{key:'componentDidUpdate',value:function componentDidUpdate()/*prevProps, prevState*/{}},{key:'render',value:function render(){var _this2=this;var _props=this.props,id=_props.id,className=_props.className;var _id=id||'tBreadcrumb_'+_instanceCounter$46;var _style={};var _class=className?'tBreadcrumb '+className:'tBreadcrumb';return react.createElement('t-breadcrumb',{ref:function ref(container){_this2._container=container;},id:_id,style:_style,className:_class});}}]);return TBreadcrumb;}(react.Component);/**
   * @author [Tristan Valcke]{@link https://github.com/Itee}
   * @license [BSD-3-Clause]{@link https://opensource.org/licenses/BSD-3-Clause}
   *
   * @file Todo
   *
   * @example Todo
   *
   */var _instanceCounter$47=0;var TDropDownMenu$1=function(_React$Component){inherits(TDropDownMenu,_React$Component);function TDropDownMenu(props){classCallCheck(this,TDropDownMenu);var _this=possibleConstructorReturn(this,(TDropDownMenu.__proto__||Object.getPrototypeOf(TDropDownMenu)).call(this,props));_instanceCounter$47++;return _this;}/**
       * React lifecycle
       */createClass(TDropDownMenu,[{key:'componentWillMount',value:function componentWillMount(){}},{key:'componentDidMount',value:function componentDidMount(){}},{key:'componentWillUnmount',value:function componentWillUnmount(){}},{key:'componentWillReceiveProps',value:function componentWillReceiveProps()/*nextProps*/{}},{key:'shouldComponentUpdate',value:function shouldComponentUpdate()/*nextProps, nextState*/{}},{key:'componentWillUpdate',value:function componentWillUpdate()/*nextProps, nextState*/{}},{key:'componentDidUpdate',value:function componentDidUpdate()/*prevProps, prevState*/{}},{key:'render',value:function render(){var _this2=this;var _props=this.props,id=_props.id,className=_props.className;var _id=id||'tDropDownMenu_'+_instanceCounter$47;var _style={};var _class=className?'tDropDownMenu '+className:'tDropDownMenu';return react.createElement('t-drop-down-menu',{ref:function ref(container){_this2._container=container;},id:_id,style:_style,className:_class});}}]);return TDropDownMenu;}(react.Component);/**
   * @author [Tristan Valcke]{@link https://github.com/Itee}
   * @license [BSD-3-Clause]{@link https://opensource.org/licenses/BSD-3-Clause}
   *
   * @file Todo
   *
   * @example Todo
   *
   */var _instanceCounter$48=0;var TMenu$1=function(_React$Component){inherits(TMenu,_React$Component);function TMenu(props){classCallCheck(this,TMenu);var _this=possibleConstructorReturn(this,(TMenu.__proto__||Object.getPrototypeOf(TMenu)).call(this,props));_instanceCounter$48++;return _this;}/**
       * React lifecycle
       */createClass(TMenu,[{key:'componentWillMount',value:function componentWillMount(){}},{key:'componentDidMount',value:function componentDidMount(){}},{key:'componentWillUnmount',value:function componentWillUnmount(){}},{key:'componentWillReceiveProps',value:function componentWillReceiveProps()/*nextProps*/{}},{key:'shouldComponentUpdate',value:function shouldComponentUpdate()/*nextProps, nextState*/{}},{key:'componentWillUpdate',value:function componentWillUpdate()/*nextProps, nextState*/{}},{key:'componentDidUpdate',value:function componentDidUpdate()/*prevProps, prevState*/{}},{key:'render',value:function render(){var _this2=this;var _props=this.props,id=_props.id,className=_props.className;var _id=id||'tMenu_'+_instanceCounter$48;var _style={};var _class=className?'tMenu '+className:'tMenu';return react.createElement('t-menu',{ref:function ref(container){_this2._container=container;},id:_id,style:_style,className:_class});}}]);return TMenu;}(react.Component);/**
   * @author [Tristan Valcke]{@link https://github.com/Itee}
   * @license [BSD-3-Clause]{@link https://opensource.org/licenses/BSD-3-Clause}
   *
   * @file Todo
   *
   * @example Todo
   *
   */var _instanceCounter$49=0;var TMenuItem$1=function(_React$Component){inherits(TMenuItem,_React$Component);function TMenuItem(props){classCallCheck(this,TMenuItem);var _this=possibleConstructorReturn(this,(TMenuItem.__proto__||Object.getPrototypeOf(TMenuItem)).call(this,props));_instanceCounter$49++;return _this;}/**
       * React lifecycle
       */createClass(TMenuItem,[{key:'componentWillMount',value:function componentWillMount(){}},{key:'componentDidMount',value:function componentDidMount(){}},{key:'componentWillUnmount',value:function componentWillUnmount(){}},{key:'componentWillReceiveProps',value:function componentWillReceiveProps()/*nextProps*/{}},{key:'shouldComponentUpdate',value:function shouldComponentUpdate()/*nextProps, nextState*/{}},{key:'componentWillUpdate',value:function componentWillUpdate()/*nextProps, nextState*/{}},{key:'componentDidUpdate',value:function componentDidUpdate()/*prevProps, prevState*/{}},{key:'render',value:function render(){var _this2=this;var _props=this.props,id=_props.id,className=_props.className;var _id=id||'tMenuItem_'+_instanceCounter$49;var _style={};var _class=className?'tMenuItem '+className:'tMenuItem';return react.createElement('t-menu-item',{ref:function ref(container){_this2._container=container;},id:_id,style:_style,className:_class});}}]);return TMenuItem;}(react.Component);/**
   * @author [Tristan Valcke]{@link https://github.com/Itee}
   * @license [BSD-3-Clause]{@link https://opensource.org/licenses/BSD-3-Clause}
   *
   * @file Todo
   *
   * @example Todo
   *
   */var _instanceCounter$50=0;var TNavbar=function(_React$Component){inherits(TNavbar,_React$Component);function TNavbar(props){classCallCheck(this,TNavbar);var _this=possibleConstructorReturn(this,(TNavbar.__proto__||Object.getPrototypeOf(TNavbar)).call(this,props));_instanceCounter$50++;return _this;}/**
       * React lifecycle
       */createClass(TNavbar,[{key:'componentWillMount',value:function componentWillMount(){}},{key:'componentDidMount',value:function componentDidMount(){}},{key:'componentWillUnmount',value:function componentWillUnmount(){}},{key:'componentWillReceiveProps',value:function componentWillReceiveProps()/*nextProps*/{}},{key:'shouldComponentUpdate',value:function shouldComponentUpdate()/*nextProps, nextState*/{}},{key:'componentWillUpdate',value:function componentWillUpdate()/*nextProps, nextState*/{}},{key:'componentDidUpdate',value:function componentDidUpdate()/*prevProps, prevState*/{}},{key:'render',value:function render(){var _this2=this;var _props=this.props,id=_props.id,className=_props.className;var _id=id||'tNavbar_'+_instanceCounter$50;var _style={};var _class=className?'tNavbar '+className:'tNavbar';return react.createElement('t-navbar',{ref:function ref(container){_this2._container=container;},id:_id,style:_style,className:_class});}}]);return TNavbar;}(react.Component);/**
   * @author [Tristan Valcke]{@link https://github.com/Itee}
   * @license [BSD-3-Clause]{@link https://opensource.org/licenses/BSD-3-Clause}
   *
   * @file Todo
   *
   * @example Todo
   *
   */var _instanceCounter$51=0;var TPagination=function(_React$Component){inherits(TPagination,_React$Component);function TPagination(props){classCallCheck(this,TPagination);var _this=possibleConstructorReturn(this,(TPagination.__proto__||Object.getPrototypeOf(TPagination)).call(this,props));_instanceCounter$51++;return _this;}/**
       * React lifecycle
       */createClass(TPagination,[{key:'componentWillMount',value:function componentWillMount(){}},{key:'componentDidMount',value:function componentDidMount(){}},{key:'componentWillUnmount',value:function componentWillUnmount(){}},{key:'componentWillReceiveProps',value:function componentWillReceiveProps()/*nextProps*/{}},{key:'shouldComponentUpdate',value:function shouldComponentUpdate()/*nextProps, nextState*/{}},{key:'componentWillUpdate',value:function componentWillUpdate()/*nextProps, nextState*/{}},{key:'componentDidUpdate',value:function componentDidUpdate()/*prevProps, prevState*/{}},{key:'render',value:function render(){var _this2=this;var _props=this.props,id=_props.id,className=_props.className;var _id=id||'tPagination_'+_instanceCounter$51;var _style={};var _class=className?'tPagination '+className:'tPagination';return react.createElement('t-pagination',{ref:function ref(container){_this2._container=container;},id:_id,style:_style,className:_class});}}]);return TPagination;}(react.Component);/**
   * @author [Tristan Valcke]{@link https://github.com/Itee}
   * @license [BSD-3-Clause]{@link https://opensource.org/licenses/BSD-3-Clause}
   *
   * @file Todo
   *
   * @example Todo
   *
   */var _instanceCounter$52=0;var TSideBar=function(_React$Component){inherits(TSideBar,_React$Component);function TSideBar(props){classCallCheck(this,TSideBar);var _this=possibleConstructorReturn(this,(TSideBar.__proto__||Object.getPrototypeOf(TSideBar)).call(this,props));_instanceCounter$52++;return _this;}/**
       * React lifecycle
       */createClass(TSideBar,[{key:'componentWillMount',value:function componentWillMount(){}},{key:'componentDidMount',value:function componentDidMount(){}},{key:'componentWillUnmount',value:function componentWillUnmount(){}},{key:'componentWillReceiveProps',value:function componentWillReceiveProps()/*nextProps*/{}},{key:'shouldComponentUpdate',value:function shouldComponentUpdate()/*nextProps, nextState*/{}},{key:'componentWillUpdate',value:function componentWillUpdate()/*nextProps, nextState*/{}},{key:'componentDidUpdate',value:function componentDidUpdate()/*prevProps, prevState*/{}},{key:'render',value:function render(){var _this2=this;var _props=this.props,id=_props.id,className=_props.className;var _id=id||'tSideBar_'+_instanceCounter$52;var _style={};var _class=className?'tSideBar '+className:'tSideBar';return react.createElement('t-side-bar',{ref:function ref(container){_this2._container=container;},id:_id,style:_style,className:_class});}}]);return TSideBar;}(react.Component);/**
   * @author [Tristan Valcke]{@link https://github.com/Itee}
   * @license [BSD-3-Clause]{@link https://opensource.org/licenses/BSD-3-Clause}
   *
   * @file Todo
   *
   * @example Todo
   *
   */var _instanceCounter$53=0;var TStepper=function(_React$Component){inherits(TStepper,_React$Component);function TStepper(props){classCallCheck(this,TStepper);var _this=possibleConstructorReturn(this,(TStepper.__proto__||Object.getPrototypeOf(TStepper)).call(this,props));_instanceCounter$53++;return _this;}/**
       * React lifecycle
       */createClass(TStepper,[{key:'componentWillMount',value:function componentWillMount(){}},{key:'componentDidMount',value:function componentDidMount(){}},{key:'componentWillUnmount',value:function componentWillUnmount(){}},{key:'componentWillReceiveProps',value:function componentWillReceiveProps()/*nextProps*/{}},{key:'shouldComponentUpdate',value:function shouldComponentUpdate()/*nextProps, nextState*/{}},{key:'componentWillUpdate',value:function componentWillUpdate()/*nextProps, nextState*/{}},{key:'componentDidUpdate',value:function componentDidUpdate()/*prevProps, prevState*/{}},{key:'render',value:function render(){var _this2=this;var _props=this.props,id=_props.id,className=_props.className;var _id=id||'tStepper_'+_instanceCounter$53;var _style={};var _class=className?'tStepper '+className:'tStepper';return react.createElement('t-stepper',{ref:function ref(container){_this2._container=container;},id:_id,style:_style,className:_class});}}]);return TStepper;}(react.Component);/**
   * @author [Tristan Valcke]{@link https://github.com/Itee}
   * @license [BSD-3-Clause]{@link https://opensource.org/licenses/BSD-3-Clause}
   *
   * @file Intermediary export file for uis/displays/navigations folder
   *
   *//**
   * @author [Tristan Valcke]{@link https://github.com/Itee}
   * @license [BSD-3-Clause]{@link https://opensource.org/licenses/BSD-3-Clause}
   *
   * @file Todo
   *
   * @example Todo
   *
   */var _instanceCounter$54=0;var TContent$1=function(_React$Component){inherits(TContent,_React$Component);function TContent(props){classCallCheck(this,TContent);var _this=possibleConstructorReturn(this,(TContent.__proto__||Object.getPrototypeOf(TContent)).call(this,props));_instanceCounter$54++;return _this;}/**
       * React lifecycle
       */createClass(TContent,[{key:'componentWillMount',value:function componentWillMount(){}},{key:'componentDidMount',value:function componentDidMount(){}},{key:'componentWillUnmount',value:function componentWillUnmount(){}},{key:'componentWillReceiveProps',value:function componentWillReceiveProps()/*nextProps*/{}},{key:'shouldComponentUpdate',value:function shouldComponentUpdate()/*nextProps, nextState*/{}},{key:'componentWillUpdate',value:function componentWillUpdate()/*nextProps, nextState*/{}},{key:'componentDidUpdate',value:function componentDidUpdate()/*prevProps, prevState*/{}},{key:'render',value:function render(){var _this2=this;var _props=this.props,id=_props.id,className=_props.className;var _id=id||'tContent_'+_instanceCounter$54;var _style={};var _class=className?'tContent '+className:'tContent';return react.createElement('t-content',{ref:function ref(container){_this2._container=container;},id:_id,style:_style,className:_class});}}]);return TContent;}(react.Component);/**
   * @author [Tristan Valcke]{@link https://github.com/Itee}
   * @license [BSD-3-Clause]{@link https://opensource.org/licenses/BSD-3-Clause}
   *
   * @file Todo
   *
   * @example Todo
   *
   */var _instanceCounter$55=0;var TFooter$1=function(_React$Component){inherits(TFooter,_React$Component);function TFooter(props){classCallCheck(this,TFooter);var _this=possibleConstructorReturn(this,(TFooter.__proto__||Object.getPrototypeOf(TFooter)).call(this,props));_instanceCounter$55++;return _this;}/**
       * React lifecycle
       */createClass(TFooter,[{key:'componentWillMount',value:function componentWillMount(){}},{key:'componentDidMount',value:function componentDidMount(){}},{key:'componentWillUnmount',value:function componentWillUnmount(){}},{key:'componentWillReceiveProps',value:function componentWillReceiveProps()/*nextProps*/{}},{key:'shouldComponentUpdate',value:function shouldComponentUpdate()/*nextProps, nextState*/{}},{key:'componentWillUpdate',value:function componentWillUpdate()/*nextProps, nextState*/{}},{key:'componentDidUpdate',value:function componentDidUpdate()/*prevProps, prevState*/{}},{key:'render',value:function render(){var _this2=this;var _props=this.props,id=_props.id,className=_props.className;var _id=id||'tFooter_'+_instanceCounter$55;var _style={};var _class=className?'tFooter '+className:'tFooter';return react.createElement('t-footer',{ref:function ref(container){_this2._container=container;},id:_id,style:_style,className:_class});}}]);return TFooter;}(react.Component);/**
   * @author [Tristan Valcke]{@link https://github.com/Itee}
   * @license [BSD-3-Clause]{@link https://opensource.org/licenses/BSD-3-Clause}
   *
   * @file Todo
   *
   * @example Todo
   *
   */var _instanceCounter$56=0;var THeader$1=function(_React$Component){inherits(THeader,_React$Component);function THeader(props){classCallCheck(this,THeader);var _this=possibleConstructorReturn(this,(THeader.__proto__||Object.getPrototypeOf(THeader)).call(this,props));_instanceCounter$56++;return _this;}/**
       * React lifecycle
       */createClass(THeader,[{key:'componentWillMount',value:function componentWillMount(){}},{key:'componentDidMount',value:function componentDidMount(){}},{key:'componentWillUnmount',value:function componentWillUnmount(){}},{key:'componentWillReceiveProps',value:function componentWillReceiveProps()/*nextProps*/{}},{key:'shouldComponentUpdate',value:function shouldComponentUpdate()/*nextProps, nextState*/{}},{key:'componentWillUpdate',value:function componentWillUpdate()/*nextProps, nextState*/{}},{key:'componentDidUpdate',value:function componentDidUpdate()/*prevProps, prevState*/{}},{key:'render',value:function render(){var _this2=this;var _props=this.props,id=_props.id,className=_props.className;var _id=id||'tHeader_'+_instanceCounter$56;var _style={};var _class=className?'tHeader '+className:'tHeader';return react.createElement('t-header',{ref:function ref(container){_this2._container=container;},id:_id,style:_style,className:_class});}}]);return THeader;}(react.Component);/**
   * @author [Tristan Valcke]{@link https://github.com/Itee}
   * @license [BSD-3-Clause]{@link https://opensource.org/licenses/BSD-3-Clause}
   *
   * @file Todo
   *
   * @example Todo
   *
   */var _instanceCounter$57=0;var TInfinitScroll=function(_React$Component){inherits(TInfinitScroll,_React$Component);function TInfinitScroll(props){classCallCheck(this,TInfinitScroll);var _this=possibleConstructorReturn(this,(TInfinitScroll.__proto__||Object.getPrototypeOf(TInfinitScroll)).call(this,props));_instanceCounter$57++;return _this;}/**
       * React lifecycle
       */createClass(TInfinitScroll,[{key:'componentWillMount',value:function componentWillMount(){}},{key:'componentDidMount',value:function componentDidMount(){}},{key:'componentWillUnmount',value:function componentWillUnmount(){}},{key:'componentWillReceiveProps',value:function componentWillReceiveProps()/*nextProps*/{}},{key:'shouldComponentUpdate',value:function shouldComponentUpdate()/*nextProps, nextState*/{}},{key:'componentWillUpdate',value:function componentWillUpdate()/*nextProps, nextState*/{}},{key:'componentDidUpdate',value:function componentDidUpdate()/*prevProps, prevState*/{}},{key:'render',value:function render(){var _this2=this;var _props=this.props,id=_props.id,className=_props.className;var _id=id||'tInfinitScroll_'+_instanceCounter$57;var _style={};var _class=className?'tInfinitScroll '+className:'tInfinitScroll';return react.createElement('t-infinit-scroll',{ref:function ref(container){_this2._container=container;},id:_id,style:_style,className:_class});}}]);return TInfinitScroll;}(react.Component);/**
   * @author [Tristan Valcke]{@link https://github.com/Itee}
   * @license [BSD-3-Clause]{@link https://opensource.org/licenses/BSD-3-Clause}
   *
   * @file Todo
   *
   * @example Todo
   *
   */var _instanceCounter$58=0;var TSection=function(_React$Component){inherits(TSection,_React$Component);function TSection(props){classCallCheck(this,TSection);var _this=possibleConstructorReturn(this,(TSection.__proto__||Object.getPrototypeOf(TSection)).call(this,props));_instanceCounter$58++;return _this;}/**
       * React lifecycle
       */createClass(TSection,[{key:'componentWillMount',value:function componentWillMount(){}},{key:'componentDidMount',value:function componentDidMount(){}},{key:'componentWillUnmount',value:function componentWillUnmount(){}},{key:'componentWillReceiveProps',value:function componentWillReceiveProps()/*nextProps*/{}},{key:'shouldComponentUpdate',value:function shouldComponentUpdate()/*nextProps, nextState*/{}},{key:'componentWillUpdate',value:function componentWillUpdate()/*nextProps, nextState*/{}},{key:'componentDidUpdate',value:function componentDidUpdate()/*prevProps, prevState*/{}},{key:'render',value:function render(){var _this2=this;var _props=this.props,id=_props.id,className=_props.className;var _id=id||'tSection_'+_instanceCounter$58;var _style={};var _class=className?'tSection '+className:'tSection';return react.createElement('t-section',{ref:function ref(container){_this2._container=container;},id:_id,style:_style,className:_class});}}]);return TSection;}(react.Component);/**
   * @author [Tristan Valcke]{@link https://github.com/Itee}
   * @license [BSD-3-Clause]{@link https://opensource.org/licenses/BSD-3-Clause}
   *
   * @file Intermediary export file for uis/displays/sections folder
   *
   *//**
   * @author [Tristan Valcke]{@link https://github.com/Itee}
   * @license [BSD-3-Clause]{@link https://opensource.org/licenses/BSD-3-Clause}
   *
   * @file Todo
   *
   * @example Todo
   *
   */var _instanceCounter$59=0;var TColumn=function(_React$Component){inherits(TColumn,_React$Component);function TColumn(props){classCallCheck(this,TColumn);var _this=possibleConstructorReturn(this,(TColumn.__proto__||Object.getPrototypeOf(TColumn)).call(this,props));_instanceCounter$59++;return _this;}/**
       * React lifecycle
       */createClass(TColumn,[{key:'componentWillMount',value:function componentWillMount(){}},{key:'componentDidMount',value:function componentDidMount(){}},{key:'componentWillUnmount',value:function componentWillUnmount(){}},{key:'componentWillReceiveProps',value:function componentWillReceiveProps()/*nextProps*/{}},{key:'shouldComponentUpdate',value:function shouldComponentUpdate()/*nextProps, nextState*/{}},{key:'componentWillUpdate',value:function componentWillUpdate()/*nextProps, nextState*/{}},{key:'componentDidUpdate',value:function componentDidUpdate()/*prevProps, prevState*/{}},{key:'render',value:function render(){var _this2=this;var _props=this.props,id=_props.id,className=_props.className;var _id=id||'tColumn_'+_instanceCounter$59;var _style={};var _class=className?'tColumn '+className:'tColumn';return react.createElement('t-column',{ref:function ref(container){_this2._container=container;},id:_id,style:_style,className:_class});}}]);return TColumn;}(react.Component);/**
   * @author [Tristan Valcke]{@link https://github.com/Itee}
   * @license [BSD-3-Clause]{@link https://opensource.org/licenses/BSD-3-Clause}
   *
   * @file Todo
   *
   * @example Todo
   *
   */var _instanceCounter$60=0;var TRow=function(_React$Component){inherits(TRow,_React$Component);function TRow(props){classCallCheck(this,TRow);var _this=possibleConstructorReturn(this,(TRow.__proto__||Object.getPrototypeOf(TRow)).call(this,props));_instanceCounter$60++;return _this;}/**
       * React lifecycle
       */createClass(TRow,[{key:'componentWillMount',value:function componentWillMount(){}},{key:'componentDidMount',value:function componentDidMount(){}},{key:'componentWillUnmount',value:function componentWillUnmount(){}},{key:'componentWillReceiveProps',value:function componentWillReceiveProps()/*nextProps*/{}},{key:'shouldComponentUpdate',value:function shouldComponentUpdate()/*nextProps, nextState*/{}},{key:'componentWillUpdate',value:function componentWillUpdate()/*nextProps, nextState*/{}},{key:'componentDidUpdate',value:function componentDidUpdate()/*prevProps, prevState*/{}},{key:'render',value:function render(){var _this2=this;var _props=this.props,id=_props.id,className=_props.className;var _id=id||'tRow_'+_instanceCounter$60;var _style={};var _class=className?'tRow '+className:'tRow';return react.createElement('t-row',{ref:function ref(container){_this2._container=container;},id:_id,style:_style,className:_class});}}]);return TRow;}(react.Component);/**
   * @author [Tristan Valcke]{@link https://github.com/Itee}
   * @license [BSD-3-Clause]{@link https://opensource.org/licenses/BSD-3-Clause}
   *
   * @file Todo
   *
   * @example Todo
   *
   */var _instanceCounter$61=0;var TTable=function(_React$Component){inherits(TTable,_React$Component);function TTable(props){classCallCheck(this,TTable);var _this=possibleConstructorReturn(this,(TTable.__proto__||Object.getPrototypeOf(TTable)).call(this,props));_instanceCounter$61++;return _this;}/**
       * React lifecycle
       */createClass(TTable,[{key:'componentWillMount',value:function componentWillMount(){}},{key:'componentDidMount',value:function componentDidMount(){}},{key:'componentWillUnmount',value:function componentWillUnmount(){}},{key:'componentWillReceiveProps',value:function componentWillReceiveProps()/*nextProps*/{}},{key:'shouldComponentUpdate',value:function shouldComponentUpdate()/*nextProps, nextState*/{}},{key:'componentWillUpdate',value:function componentWillUpdate()/*nextProps, nextState*/{}},{key:'componentDidUpdate',value:function componentDidUpdate()/*prevProps, prevState*/{}},{key:'render',value:function render(){var _this2=this;var _props=this.props,id=_props.id,className=_props.className;var _id=id||'tTable_'+_instanceCounter$61;var _style={};var _class=className?'tTable '+className:'tTable';return react.createElement('t-table',{ref:function ref(container){_this2._container=container;},id:_id,style:_style,className:_class});}}]);return TTable;}(react.Component);/**
   * @author [Tristan Valcke]{@link https://github.com/Itee}
   * @license [BSD-3-Clause]{@link https://opensource.org/licenses/BSD-3-Clause}
   *
   * @file Todo
   *
   * @example Todo
   *
   */var _instanceCounter$62=0;var TTableHeader=function(_React$Component){inherits(TTableHeader,_React$Component);function TTableHeader(props){classCallCheck(this,TTableHeader);var _this=possibleConstructorReturn(this,(TTableHeader.__proto__||Object.getPrototypeOf(TTableHeader)).call(this,props));_instanceCounter$62++;return _this;}/**
       * React lifecycle
       */createClass(TTableHeader,[{key:'componentWillMount',value:function componentWillMount(){}},{key:'componentDidMount',value:function componentDidMount(){}},{key:'componentWillUnmount',value:function componentWillUnmount(){}},{key:'componentWillReceiveProps',value:function componentWillReceiveProps()/*nextProps*/{}},{key:'shouldComponentUpdate',value:function shouldComponentUpdate()/*nextProps, nextState*/{}},{key:'componentWillUpdate',value:function componentWillUpdate()/*nextProps, nextState*/{}},{key:'componentDidUpdate',value:function componentDidUpdate()/*prevProps, prevState*/{}},{key:'render',value:function render(){var _this2=this;var _props=this.props,id=_props.id,className=_props.className;var _id=id||'tTableHeader_'+_instanceCounter$62;var _style={};var _class=className?'tTableHeader '+className:'tTableHeader';return react.createElement('t-table-header',{ref:function ref(container){_this2._container=container;},id:_id,style:_style,className:_class});}}]);return TTableHeader;}(react.Component);/**
   * @author [Tristan Valcke]{@link https://github.com/Itee}
   * @license [BSD-3-Clause]{@link https://opensource.org/licenses/BSD-3-Clause}
   *
   * @file Intermediary export file for uis/displays/tables folder
   *
   *//**
   * @author [Tristan Valcke]{@link https://github.com/Itee}
   * @license [BSD-3-Clause]{@link https://opensource.org/licenses/BSD-3-Clause}
   *
   * @file Todo
   *
   * @example Todo
   *
   */var _instanceCounter$63=0;var TTab=function(_React$Component){inherits(TTab,_React$Component);function TTab(props){classCallCheck(this,TTab);var _this=possibleConstructorReturn(this,(TTab.__proto__||Object.getPrototypeOf(TTab)).call(this,props));_instanceCounter$63++;return _this;}/**
       * React lifecycle
       */createClass(TTab,[{key:'componentWillMount',value:function componentWillMount(){}},{key:'componentDidMount',value:function componentDidMount(){}},{key:'componentWillUnmount',value:function componentWillUnmount(){}},{key:'componentWillReceiveProps',value:function componentWillReceiveProps()/*nextProps*/{}},{key:'shouldComponentUpdate',value:function shouldComponentUpdate()/*nextProps, nextState*/{}},{key:'componentWillUpdate',value:function componentWillUpdate()/*nextProps, nextState*/{}},{key:'componentDidUpdate',value:function componentDidUpdate()/*prevProps, prevState*/{}},{key:'render',value:function render(){var _this2=this;var _props=this.props,id=_props.id,className=_props.className;var _id=id||'tTab_'+_instanceCounter$63;var _style={};var _class=className?'tTab '+className:'tTab';return react.createElement('t-tab',{ref:function ref(container){_this2._container=container;},id:_id,style:_style,className:_class});}}]);return TTab;}(react.Component);/**
   * @author [Tristan Valcke]{@link https://github.com/Itee}
   * @license [BSD-3-Clause]{@link https://opensource.org/licenses/BSD-3-Clause}
   *
   * @file Todo
   *
   * @example Todo
   *
   */var _instanceCounter$64=0;var TTabLayout=function(_React$Component){inherits(TTabLayout,_React$Component);function TTabLayout(props){classCallCheck(this,TTabLayout);var _this=possibleConstructorReturn(this,(TTabLayout.__proto__||Object.getPrototypeOf(TTabLayout)).call(this,props));_instanceCounter$64++;return _this;}/**
       * React lifecycle
       */createClass(TTabLayout,[{key:'componentWillMount',value:function componentWillMount(){}},{key:'componentDidMount',value:function componentDidMount(){}},{key:'componentWillUnmount',value:function componentWillUnmount(){}},{key:'componentWillReceiveProps',value:function componentWillReceiveProps()/*nextProps*/{}},{key:'shouldComponentUpdate',value:function shouldComponentUpdate()/*nextProps, nextState*/{}},{key:'componentWillUpdate',value:function componentWillUpdate()/*nextProps, nextState*/{}},{key:'componentDidUpdate',value:function componentDidUpdate()/*prevProps, prevState*/{}},{key:'render',value:function render(){var _this2=this;var _props=this.props,id=_props.id,className=_props.className;var _id=id||'tTabLayout_'+_instanceCounter$64;var _style={};var _class=className?'tTabLayout '+className:'tTabLayout';return react.createElement('t-tab-layout',{ref:function ref(container){_this2._container=container;},id:_id,style:_style,className:_class});}}]);return TTabLayout;}(react.Component);/**
   * @author [Tristan Valcke]{@link https://github.com/Itee}
   * @license [BSD-3-Clause]{@link https://opensource.org/licenses/BSD-3-Clause}
   *
   * @file Intermediary export file for uis/displays/tabs folder
   *
   *//**
   * @author [Tristan Valcke]{@link https://github.com/Itee}
   * @license [BSD-3-Clause]{@link https://opensource.org/licenses/BSD-3-Clause}
   *
   * @file Todo
   *
   * @example Todo
   *
   */var _instanceCounter$65=0;var TTree$1=function(_React$Component){inherits(TTree,_React$Component);function TTree(props){classCallCheck(this,TTree);var _this=possibleConstructorReturn(this,(TTree.__proto__||Object.getPrototypeOf(TTree)).call(this,props));_instanceCounter$65++;return _this;}/**
       * React lifecycle
       */createClass(TTree,[{key:'componentWillMount',value:function componentWillMount(){}},{key:'componentDidMount',value:function componentDidMount(){}},{key:'componentWillUnmount',value:function componentWillUnmount(){}},{key:'componentWillReceiveProps',value:function componentWillReceiveProps()/*nextProps*/{}},{key:'shouldComponentUpdate',value:function shouldComponentUpdate()/*nextProps, nextState*/{}},{key:'componentWillUpdate',value:function componentWillUpdate()/*nextProps, nextState*/{}},{key:'componentDidUpdate',value:function componentDidUpdate()/*prevProps, prevState*/{}},{key:'render',value:function render(){var _this2=this;var _props=this.props,id=_props.id,className=_props.className;var _id=id||'tTree_'+_instanceCounter$65;var _style={};var _class=className?'tTree '+className:'tTree';return react.createElement('t-tree',{ref:function ref(container){_this2._container=container;},id:_id,style:_style,className:_class});}}]);return TTree;}(react.Component);/**
   * @author [Tristan Valcke]{@link https://github.com/Itee}
   * @license [BSD-3-Clause]{@link https://opensource.org/licenses/BSD-3-Clause}
   *
   * @file Todo
   *
   * @example Todo
   *
   */var _instanceCounter$66=0;var TTreeItem$1=function(_React$Component){inherits(TTreeItem,_React$Component);function TTreeItem(props){classCallCheck(this,TTreeItem);var _this=possibleConstructorReturn(this,(TTreeItem.__proto__||Object.getPrototypeOf(TTreeItem)).call(this,props));_instanceCounter$66++;return _this;}/**
       * React lifecycle
       */createClass(TTreeItem,[{key:'componentWillMount',value:function componentWillMount(){}},{key:'componentDidMount',value:function componentDidMount(){}},{key:'componentWillUnmount',value:function componentWillUnmount(){}},{key:'componentWillReceiveProps',value:function componentWillReceiveProps()/*nextProps*/{}},{key:'shouldComponentUpdate',value:function shouldComponentUpdate()/*nextProps, nextState*/{}},{key:'componentWillUpdate',value:function componentWillUpdate()/*nextProps, nextState*/{}},{key:'componentDidUpdate',value:function componentDidUpdate()/*prevProps, prevState*/{}},{key:'render',value:function render(){var _this2=this;var _props=this.props,id=_props.id,className=_props.className;var _id=id||'tTreeItem_'+_instanceCounter$66;var _style={};var _class=className?'tTreeItem '+className:'tTreeItem';return react.createElement('t-tree-item',{ref:function ref(container){_this2._container=container;},id:_id,style:_style,className:_class});}}]);return TTreeItem;}(react.Component);/**
   * @author [Tristan Valcke]{@link https://github.com/Itee}
   * @license [BSD-3-Clause]{@link https://opensource.org/licenses/BSD-3-Clause}
   *
   * @file Intermediary export file for uis/displays/trees folder
   *
   *//**
   * @author [Tristan Valcke]{@link https://github.com/Itee}
   * @license [BSD-3-Clause]{@link https://opensource.org/licenses/BSD-3-Clause}
   *
   * @file Intermediary export file for uis/displays folder
   *
   *//**
   * @author [Tristan Valcke]{@link https://github.com/Itee}
   * @license [BSD-3-Clause]{@link https://opensource.org/licenses/BSD-3-Clause}
   *
   * @file Todo
   *
   * @example Todo
   *
   */var _instanceCounter$67=0;var TCheckbox=function(_React$Component){inherits(TCheckbox,_React$Component);function TCheckbox(props){classCallCheck(this,TCheckbox);var _this=possibleConstructorReturn(this,(TCheckbox.__proto__||Object.getPrototypeOf(TCheckbox)).call(this,props));_instanceCounter$67++;return _this;}/**
       * React lifecycle
       */createClass(TCheckbox,[{key:'componentWillMount',value:function componentWillMount(){}},{key:'componentDidMount',value:function componentDidMount(){}},{key:'componentWillUnmount',value:function componentWillUnmount(){}},{key:'componentWillReceiveProps',value:function componentWillReceiveProps()/*nextProps*/{}},{key:'shouldComponentUpdate',value:function shouldComponentUpdate()/*nextProps, nextState*/{}},{key:'componentWillUpdate',value:function componentWillUpdate()/*nextProps, nextState*/{}},{key:'componentDidUpdate',value:function componentDidUpdate()/*prevProps, prevState*/{}},{key:'render',value:function render(){var _this2=this;var _props=this.props,id=_props.id,className=_props.className;var _id=id||'tCheckbox_'+_instanceCounter$67;var _style={};var _class=className?'tCheckbox '+className:'tCheckbox';return react.createElement('t-checkbox',{ref:function ref(container){_this2._container=container;},id:_id,style:_style,className:_class});}}]);return TCheckbox;}(react.Component);/**
   * @author [Tristan Valcke]{@link https://github.com/Itee}
   * @license [BSD-3-Clause]{@link https://opensource.org/licenses/BSD-3-Clause}
   *
   * @file Todo
   *
   * @example Todo
   *
   */var _instanceCounter$68=0;var TDatePicker=function(_React$Component){inherits(TDatePicker,_React$Component);function TDatePicker(props){classCallCheck(this,TDatePicker);var _this=possibleConstructorReturn(this,(TDatePicker.__proto__||Object.getPrototypeOf(TDatePicker)).call(this,props));_instanceCounter$68++;return _this;}/**
       * React lifecycle
       */createClass(TDatePicker,[{key:'componentWillMount',value:function componentWillMount(){}},{key:'componentDidMount',value:function componentDidMount(){}},{key:'componentWillUnmount',value:function componentWillUnmount(){}},{key:'componentWillReceiveProps',value:function componentWillReceiveProps()/*nextProps*/{}},{key:'shouldComponentUpdate',value:function shouldComponentUpdate()/*nextProps, nextState*/{}},{key:'componentWillUpdate',value:function componentWillUpdate()/*nextProps, nextState*/{}},{key:'componentDidUpdate',value:function componentDidUpdate()/*prevProps, prevState*/{}},{key:'render',value:function render(){var _this2=this;var _props=this.props,id=_props.id,className=_props.className;var _id=id||'tDatePicker_'+_instanceCounter$68;var _style={};var _class=className?'tDatePicker '+className:'tDatePicker';return react.createElement('t-date-picker',{ref:function ref(container){_this2._container=container;},id:_id,style:_style,className:_class});}}]);return TDatePicker;}(react.Component);/**
   * @author [Tristan Valcke]{@link https://github.com/Itee}
   * @license [BSD-3-Clause]{@link https://opensource.org/licenses/BSD-3-Clause}
   *
   * @file Todo
   *
   * @example Todo
   *
   */var _instanceCounter$69=0;var TInputGroup=function(_React$Component){inherits(TInputGroup,_React$Component);function TInputGroup(props){classCallCheck(this,TInputGroup);var _this=possibleConstructorReturn(this,(TInputGroup.__proto__||Object.getPrototypeOf(TInputGroup)).call(this,props));_instanceCounter$69++;return _this;}/**
       * React lifecycle
       */createClass(TInputGroup,[{key:'componentWillMount',value:function componentWillMount(){}},{key:'componentDidMount',value:function componentDidMount(){}},{key:'componentWillUnmount',value:function componentWillUnmount(){}},{key:'componentWillReceiveProps',value:function componentWillReceiveProps()/*nextProps*/{}},{key:'shouldComponentUpdate',value:function shouldComponentUpdate()/*nextProps, nextState*/{}},{key:'componentWillUpdate',value:function componentWillUpdate()/*nextProps, nextState*/{}},{key:'componentDidUpdate',value:function componentDidUpdate()/*prevProps, prevState*/{}},{key:'render',value:function render(){var _this2=this;var _props=this.props,id=_props.id,className=_props.className;var _id=id||'tInputGroup_'+_instanceCounter$69;var _style={};var _class=className?'tInputGroup '+className:'tInputGroup';return react.createElement('t-input-group',{ref:function ref(container){_this2._container=container;},id:_id,style:_style,className:_class});}}]);return TInputGroup;}(react.Component);/**
   * @author [Tristan Valcke]{@link https://github.com/Itee}
   * @license [BSD-3-Clause]{@link https://opensource.org/licenses/BSD-3-Clause}
   *
   * @file Todo
   *
   * @example Todo
   *
   */var _instanceCounter$70=0;var TInputNumber=function(_React$Component){inherits(TInputNumber,_React$Component);function TInputNumber(props){classCallCheck(this,TInputNumber);var _this=possibleConstructorReturn(this,(TInputNumber.__proto__||Object.getPrototypeOf(TInputNumber)).call(this,props));_instanceCounter$70++;return _this;}/**
       * React lifecycle
       */createClass(TInputNumber,[{key:'componentWillMount',value:function componentWillMount(){}},{key:'componentDidMount',value:function componentDidMount(){}},{key:'componentWillUnmount',value:function componentWillUnmount(){}},{key:'componentWillReceiveProps',value:function componentWillReceiveProps()/*nextProps*/{}},{key:'shouldComponentUpdate',value:function shouldComponentUpdate()/*nextProps, nextState*/{}},{key:'componentWillUpdate',value:function componentWillUpdate()/*nextProps, nextState*/{}},{key:'componentDidUpdate',value:function componentDidUpdate()/*prevProps, prevState*/{}},{key:'render',value:function render(){var _this2=this;var _props=this.props,id=_props.id,className=_props.className;var _id=id||'tInputNumber_'+_instanceCounter$70;var _style={};var _class=className?'tInputNumber '+className:'tInputNumber';return react.createElement('t-input-number',{ref:function ref(container){_this2._container=container;},id:_id,style:_style,className:_class});}}]);return TInputNumber;}(react.Component);/**
   * @author [Tristan Valcke]{@link https://github.com/Itee}
   * @license [BSD-3-Clause]{@link https://opensource.org/licenses/BSD-3-Clause}
   *
   * @file Todo
   *
   * @example Todo
   *
   */var _instanceCounter$71=0;var TInputText=function(_React$Component){inherits(TInputText,_React$Component);function TInputText(props){classCallCheck(this,TInputText);var _this=possibleConstructorReturn(this,(TInputText.__proto__||Object.getPrototypeOf(TInputText)).call(this,props));_instanceCounter$71++;return _this;}/**
       * React lifecycle
       */createClass(TInputText,[{key:'componentWillMount',value:function componentWillMount(){}},{key:'componentDidMount',value:function componentDidMount(){}},{key:'componentWillUnmount',value:function componentWillUnmount(){}},{key:'componentWillReceiveProps',value:function componentWillReceiveProps()/*nextProps*/{}},{key:'shouldComponentUpdate',value:function shouldComponentUpdate()/*nextProps, nextState*/{}},{key:'componentWillUpdate',value:function componentWillUpdate()/*nextProps, nextState*/{}},{key:'componentDidUpdate',value:function componentDidUpdate()/*prevProps, prevState*/{}},{key:'render',value:function render(){var _this2=this;var _props=this.props,id=_props.id,className=_props.className;var _id=id||'tInputText_'+_instanceCounter$71;var _style={};var _class=className?'tInputText '+className:'tInputText';return react.createElement('t-input-text',{ref:function ref(container){_this2._container=container;},id:_id,style:_style,className:_class});}}]);return TInputText;}(react.Component);/**
   * @author [Tristan Valcke]{@link https://github.com/Itee}
   * @license [BSD-3-Clause]{@link https://opensource.org/licenses/BSD-3-Clause}
   *
   * @file Todo
   *
   * @example Todo
   *
   */var _instanceCounter$72=0;var TOptionGroup=function(_React$Component){inherits(TOptionGroup,_React$Component);function TOptionGroup(props){classCallCheck(this,TOptionGroup);var _this=possibleConstructorReturn(this,(TOptionGroup.__proto__||Object.getPrototypeOf(TOptionGroup)).call(this,props));_instanceCounter$72++;return _this;}/**
       * React lifecycle
       */createClass(TOptionGroup,[{key:'componentWillMount',value:function componentWillMount(){}},{key:'componentDidMount',value:function componentDidMount(){}},{key:'componentWillUnmount',value:function componentWillUnmount(){}},{key:'componentWillReceiveProps',value:function componentWillReceiveProps()/*nextProps*/{}},{key:'shouldComponentUpdate',value:function shouldComponentUpdate()/*nextProps, nextState*/{}},{key:'componentWillUpdate',value:function componentWillUpdate()/*nextProps, nextState*/{}},{key:'componentDidUpdate',value:function componentDidUpdate()/*prevProps, prevState*/{}},{key:'render',value:function render(){var _this2=this;var _props=this.props,id=_props.id,className=_props.className;var _id=id||'tOptionGroup_'+_instanceCounter$72;var _style={};var _class=className?'tOptionGroup '+className:'tOptionGroup';return react.createElement('t-option-group',{ref:function ref(container){_this2._container=container;},id:_id,style:_style,className:_class});}}]);return TOptionGroup;}(react.Component);/**
   * @author [Tristan Valcke]{@link https://github.com/Itee}
   * @license [BSD-3-Clause]{@link https://opensource.org/licenses/BSD-3-Clause}
   *
   * @file Todo
   *
   * @example Todo
   *
   */var _instanceCounter$73=0;var TPassword=function(_React$Component){inherits(TPassword,_React$Component);function TPassword(props){classCallCheck(this,TPassword);var _this=possibleConstructorReturn(this,(TPassword.__proto__||Object.getPrototypeOf(TPassword)).call(this,props));_instanceCounter$73++;return _this;}/**
       * React lifecycle
       */createClass(TPassword,[{key:'componentWillMount',value:function componentWillMount(){}},{key:'componentDidMount',value:function componentDidMount(){}},{key:'componentWillUnmount',value:function componentWillUnmount(){}},{key:'componentWillReceiveProps',value:function componentWillReceiveProps()/*nextProps*/{}},{key:'shouldComponentUpdate',value:function shouldComponentUpdate()/*nextProps, nextState*/{}},{key:'componentWillUpdate',value:function componentWillUpdate()/*nextProps, nextState*/{}},{key:'componentDidUpdate',value:function componentDidUpdate()/*prevProps, prevState*/{}},{key:'render',value:function render(){var _this2=this;var _props=this.props,id=_props.id,className=_props.className;var _id=id||'tPassword_'+_instanceCounter$73;var _style={};var _class=className?'tPassword '+className:'tPassword';return react.createElement('t-password',{ref:function ref(container){_this2._container=container;},id:_id,style:_style,className:_class});}}]);return TPassword;}(react.Component);/**
   * @author [Tristan Valcke]{@link https://github.com/Itee}
   * @license [BSD-3-Clause]{@link https://opensource.org/licenses/BSD-3-Clause}
   *
   * @file Todo
   *
   * @example Todo
   *
   */var _instanceCounter$74=0;var TRating=function(_React$Component){inherits(TRating,_React$Component);function TRating(props){classCallCheck(this,TRating);var _this=possibleConstructorReturn(this,(TRating.__proto__||Object.getPrototypeOf(TRating)).call(this,props));_instanceCounter$74++;return _this;}/**
       * React lifecycle
       */createClass(TRating,[{key:'componentWillMount',value:function componentWillMount(){}},{key:'componentDidMount',value:function componentDidMount(){}},{key:'componentWillUnmount',value:function componentWillUnmount(){}},{key:'componentWillReceiveProps',value:function componentWillReceiveProps()/*nextProps*/{}},{key:'shouldComponentUpdate',value:function shouldComponentUpdate()/*nextProps, nextState*/{}},{key:'componentWillUpdate',value:function componentWillUpdate()/*nextProps, nextState*/{}},{key:'componentDidUpdate',value:function componentDidUpdate()/*prevProps, prevState*/{}},{key:'render',value:function render(){var _this2=this;var _props=this.props,id=_props.id,className=_props.className;var _id=id||'tRating_'+_instanceCounter$74;var _style={};var _class=className?'tRating '+className:'tRating';return react.createElement('t-rating',{ref:function ref(container){_this2._container=container;},id:_id,style:_style,className:_class});}}]);return TRating;}(react.Component);/**
   * @author [Tristan Valcke]{@link https://github.com/Itee}
   * @license [BSD-3-Clause]{@link https://opensource.org/licenses/BSD-3-Clause}
   *
   * @file Todo
   *
   * @example Todo
   *
   */var _instanceCounter$75=0;var TSlider=function(_React$Component){inherits(TSlider,_React$Component);function TSlider(props){classCallCheck(this,TSlider);var _this=possibleConstructorReturn(this,(TSlider.__proto__||Object.getPrototypeOf(TSlider)).call(this,props));_instanceCounter$75++;return _this;}/**
       * React lifecycle
       */createClass(TSlider,[{key:'componentWillMount',value:function componentWillMount(){}},{key:'componentDidMount',value:function componentDidMount(){}},{key:'componentWillUnmount',value:function componentWillUnmount(){}},{key:'componentWillReceiveProps',value:function componentWillReceiveProps()/*nextProps*/{}},{key:'shouldComponentUpdate',value:function shouldComponentUpdate()/*nextProps, nextState*/{}},{key:'componentWillUpdate',value:function componentWillUpdate()/*nextProps, nextState*/{}},{key:'componentDidUpdate',value:function componentDidUpdate()/*prevProps, prevState*/{}},{key:'render',value:function render(){var _this2=this;var _props=this.props,id=_props.id,className=_props.className;var _id=id||'tSlider_'+_instanceCounter$75;var _style={};var _class=className?'tSlider '+className:'tSlider';return react.createElement('t-slider',{ref:function ref(container){_this2._container=container;},id:_id,style:_style,className:_class});}}]);return TSlider;}(react.Component);/**
   * @author [Tristan Valcke]{@link https://github.com/Itee}
   * @license [BSD-3-Clause]{@link https://opensource.org/licenses/BSD-3-Clause}
   *
   * @file Todo
   *
   * @example Todo
   *
   */var _instanceCounter$76=0;var TSwitch=function(_React$Component){inherits(TSwitch,_React$Component);function TSwitch(props){classCallCheck(this,TSwitch);var _this=possibleConstructorReturn(this,(TSwitch.__proto__||Object.getPrototypeOf(TSwitch)).call(this,props));_instanceCounter$76++;return _this;}/**
       * React lifecycle
       */createClass(TSwitch,[{key:'componentWillMount',value:function componentWillMount(){}},{key:'componentDidMount',value:function componentDidMount(){}},{key:'componentWillUnmount',value:function componentWillUnmount(){}},{key:'componentWillReceiveProps',value:function componentWillReceiveProps()/*nextProps*/{}},{key:'shouldComponentUpdate',value:function shouldComponentUpdate()/*nextProps, nextState*/{}},{key:'componentWillUpdate',value:function componentWillUpdate()/*nextProps, nextState*/{}},{key:'componentDidUpdate',value:function componentDidUpdate()/*prevProps, prevState*/{}},{key:'render',value:function render(){var _this2=this;var _props=this.props,id=_props.id,className=_props.className;var _id=id||'tSwitch_'+_instanceCounter$76;var _style={};var _class=className?'tSwitch '+className:'tSwitch';return react.createElement('t-switch',{ref:function ref(container){_this2._container=container;},id:_id,style:_style,className:_class});}}]);return TSwitch;}(react.Component);/**
   * @author [Tristan Valcke]{@link https://github.com/Itee}
   * @license [BSD-3-Clause]{@link https://opensource.org/licenses/BSD-3-Clause}
   *
   * @file Todo
   *
   * @example Todo
   *
   */var _instanceCounter$77=0;var TTextArea=function(_React$Component){inherits(TTextArea,_React$Component);function TTextArea(props){classCallCheck(this,TTextArea);var _this=possibleConstructorReturn(this,(TTextArea.__proto__||Object.getPrototypeOf(TTextArea)).call(this,props));_instanceCounter$77++;return _this;}/**
       * React lifecycle
       */createClass(TTextArea,[{key:'componentWillMount',value:function componentWillMount(){}},{key:'componentDidMount',value:function componentDidMount(){}},{key:'componentWillUnmount',value:function componentWillUnmount(){}},{key:'componentWillReceiveProps',value:function componentWillReceiveProps()/*nextProps*/{}},{key:'shouldComponentUpdate',value:function shouldComponentUpdate()/*nextProps, nextState*/{}},{key:'componentWillUpdate',value:function componentWillUpdate()/*nextProps, nextState*/{}},{key:'componentDidUpdate',value:function componentDidUpdate()/*prevProps, prevState*/{}},{key:'render',value:function render(){var _this2=this;var _props=this.props,id=_props.id,className=_props.className;var _id=id||'tTextArea_'+_instanceCounter$77;var _style={};var _class=className?'tTextArea '+className:'tTextArea';return react.createElement('t-text-area',{ref:function ref(container){_this2._container=container;},id:_id,style:_style,className:_class});}}]);return TTextArea;}(react.Component);/**
   * @author [Tristan Valcke]{@link https://github.com/Itee}
   * @license [BSD-3-Clause]{@link https://opensource.org/licenses/BSD-3-Clause}
   *
   * @file Todo
   *
   * @example Todo
   *
   */var _instanceCounter$78=0;var TTimePicker=function(_React$Component){inherits(TTimePicker,_React$Component);function TTimePicker(props){classCallCheck(this,TTimePicker);var _this=possibleConstructorReturn(this,(TTimePicker.__proto__||Object.getPrototypeOf(TTimePicker)).call(this,props));_instanceCounter$78++;return _this;}/**
       * React lifecycle
       */createClass(TTimePicker,[{key:'componentWillMount',value:function componentWillMount(){}},{key:'componentDidMount',value:function componentDidMount(){}},{key:'componentWillUnmount',value:function componentWillUnmount(){}},{key:'componentWillReceiveProps',value:function componentWillReceiveProps()/*nextProps*/{}},{key:'shouldComponentUpdate',value:function shouldComponentUpdate()/*nextProps, nextState*/{}},{key:'componentWillUpdate',value:function componentWillUpdate()/*nextProps, nextState*/{}},{key:'componentDidUpdate',value:function componentDidUpdate()/*prevProps, prevState*/{}},{key:'render',value:function render(){var _this2=this;var _props=this.props,id=_props.id,className=_props.className;var _id=id||'tTimePicker_'+_instanceCounter$78;var _style={};var _class=className?'tTimePicker '+className:'tTimePicker';return react.createElement('t-time-picker',{ref:function ref(container){_this2._container=container;},id:_id,style:_style,className:_class});}}]);return TTimePicker;}(react.Component);/**
   * @author [Tristan Valcke]{@link https://github.com/Itee}
   * @license [BSD-3-Clause]{@link https://opensource.org/licenses/BSD-3-Clause}
   *
   * @file Intermediary export file for uis/inputs/bases folder
   *
   *//**
   * @author [Tristan Valcke]{@link https://github.com/Itee}
   * @license [BSD-3-Clause]{@link https://opensource.org/licenses/BSD-3-Clause}
   *
   * @file Todo
   *
   * @example Todo
   *
   */var TButton=function(_React$Component){inherits(TButton,_React$Component);function TButton(){classCallCheck(this,TButton);return possibleConstructorReturn(this,(TButton.__proto__||Object.getPrototypeOf(TButton)).apply(this,arguments));}createClass(TButton,[{key:"render",value:function render(){var _props=this.props,label=_props.label,icon=_props.icon,onClickHandler=_props.onClickHandler;if(label&&icon){return react.createElement("button",{className:"btn",onClick:onClickHandler},react.createElement("i",{className:icon}),label);}else if(label&&!icon){return react.createElement("button",{className:"btn",onClick:onClickHandler},label);}else if(!label&&icon){return react.createElement("button",{className:"btn",onClick:onClickHandler},react.createElement("i",{className:icon}));}else{return react.createElement("button",{className:"btn",onClick:onClickHandler});}}}]);return TButton;}(react.Component);/**
   * @author [Tristan Valcke]{@link https://github.com/Itee}
   * @license [BSD-3-Clause]{@link https://opensource.org/licenses/BSD-3-Clause}
   *
   * @file Todo
   *
   * @example Todo
   *
   */var TButtonGroup$1=function(_React$Component){inherits(TButtonGroup,_React$Component);function TButtonGroup(props){classCallCheck(this,TButtonGroup);return possibleConstructorReturn(this,(TButtonGroup.__proto__||Object.getPrototypeOf(TButtonGroup)).call(this,props));}createClass(TButtonGroup,[{key:'render',value:function render(){var props=this.props;var buttonGroupStyle={listStyleType:'none',display:'flex',alignItems:'center',margin:0,padding:0};return react.createElement('ul',{style:buttonGroupStyle},props.children);}}]);return TButtonGroup;}(react.Component);/**
   * @author [Tristan Valcke]{@link https://github.com/Itee}
   * @license [BSD-3-Clause]{@link https://opensource.org/licenses/BSD-3-Clause}
   *
   * @file Todo
   *
   * @example Todo
   *
   */var TLogingButton$1=function(_React$Component){inherits(TLogingButton,_React$Component);function TLogingButton(props){classCallCheck(this,TLogingButton);return possibleConstructorReturn(this,(TLogingButton.__proto__||Object.getPrototypeOf(TLogingButton)).call(this,props));}createClass(TLogingButton,[{key:'render',value:function render(){var _props=this.props,isLogged=_props.isLogged,label=_props.label,round=_props.round,logInHandler=_props.logInHandler,logOutHandler=_props.logOutHandler;if(isLogged){//            const logginStyle = {
  //                padding:         '10px',
  //                color:           'white',
  //                backgroundColor: '#0088ff',
  //                textDecoration:  'none',
  //                borderRadius:    '50%'
  //            }
  //
  //            const iconStyle = {
  //                fontSize:    '3.2em',
  //                marginRight: '11px'
  //            }
  return react.createElement(TDropDownMenu$1,{icon:"fa fa-user-circle-o",align:'right'},react.createElement('a',{href:'#'},'Link 1'),react.createElement('a',{href:'#'},'Link 1'),react.createElement('a',{href:'#'},'Link 1'),react.createElement('a',{onClick:logOutHandler},'D\xE9connexion'))//                <TUserMenu logOutHandler={logOutHandler} />
  ;}else{if(round){var logginStyle={fontSize:'1.6em',padding:'10px',color:'white',marginRight:'10px',backgroundColor:'#0088ff',textDecoration:'none',borderRadius:'50%'};var iconStyle={width:'23px',height:'23px',marginLeft:'3px'};return react.createElement('a',{className:"logginBtn",style:logginStyle,onClick:logInHandler},react.createElement('i',{className:"fa fa-key fa-flip-vertical",style:iconStyle}));}else{var _logginStyle={fontSize:'1.6em',padding:'8px',color:'white',marginRight:'10px',backgroundColor:'#0088ff',textDecoration:'none'};return react.createElement('a',{className:"logginBtn",style:_logginStyle,onClick:logInHandler},react.createElement('i',{className:"fa fa-key fa-flip-vertical"}),label);}}}}]);return TLogingButton;}(react.Component);/**
   * @author [Tristan Valcke]{@link https://github.com/Itee}
   * @license [BSD-3-Clause]{@link https://opensource.org/licenses/BSD-3-Clause}
   *
   * @file Todo
   *
   * @example Todo
   *
   */var _instanceCounter$79=0;var TRadioButton=function(_React$Component){inherits(TRadioButton,_React$Component);function TRadioButton(props){classCallCheck(this,TRadioButton);var _this=possibleConstructorReturn(this,(TRadioButton.__proto__||Object.getPrototypeOf(TRadioButton)).call(this,props));_instanceCounter$79++;return _this;}/**
       * React lifecycle
       */createClass(TRadioButton,[{key:'componentWillMount',value:function componentWillMount(){}},{key:'componentDidMount',value:function componentDidMount(){}},{key:'componentWillUnmount',value:function componentWillUnmount(){}},{key:'componentWillReceiveProps',value:function componentWillReceiveProps()/*nextProps*/{}},{key:'shouldComponentUpdate',value:function shouldComponentUpdate()/*nextProps, nextState*/{}},{key:'componentWillUpdate',value:function componentWillUpdate()/*nextProps, nextState*/{}},{key:'componentDidUpdate',value:function componentDidUpdate()/*prevProps, prevState*/{}},{key:'render',value:function render(){var _this2=this;var _props=this.props,id=_props.id,className=_props.className;var _id=id||'tRadioButton_'+_instanceCounter$79;var _style={};var _class=className?'tRadioButton '+className:'tRadioButton';return react.createElement('t-radio-button',{ref:function ref(container){_this2._container=container;},id:_id,style:_style,className:_class});}}]);return TRadioButton;}(react.Component);/**
   * @author [Tristan Valcke]{@link https://github.com/Itee}
   * @license [BSD-3-Clause]{@link https://opensource.org/licenses/BSD-3-Clause}
   *
   * @file Todo
   *
   * @example Todo
   *
   */var _instanceCounter$80=0;var TSortButton=function(_React$Component){inherits(TSortButton,_React$Component);function TSortButton(props){classCallCheck(this,TSortButton);var _this=possibleConstructorReturn(this,(TSortButton.__proto__||Object.getPrototypeOf(TSortButton)).call(this,props));_instanceCounter$80++;return _this;}/**
       * React lifecycle
       */createClass(TSortButton,[{key:'componentWillMount',value:function componentWillMount(){}},{key:'componentDidMount',value:function componentDidMount(){}},{key:'componentWillUnmount',value:function componentWillUnmount(){}},{key:'componentWillReceiveProps',value:function componentWillReceiveProps()/*nextProps*/{}},{key:'shouldComponentUpdate',value:function shouldComponentUpdate()/*nextProps, nextState*/{}},{key:'componentWillUpdate',value:function componentWillUpdate()/*nextProps, nextState*/{}},{key:'componentDidUpdate',value:function componentDidUpdate()/*prevProps, prevState*/{}},{key:'render',value:function render(){var _this2=this;var _props=this.props,id=_props.id,className=_props.className;var _id=id||'tSortButton_'+_instanceCounter$80;var _style={};var _class=className?'tSortButton '+className:'tSortButton';return react.createElement('t-sort-button',{ref:function ref(container){_this2._container=container;},id:_id,style:_style,className:_class});}}]);return TSortButton;}(react.Component);/**
   * @author [Tristan Valcke]{@link https://github.com/Itee}
   * @license [BSD-3-Clause]{@link https://opensource.org/licenses/BSD-3-Clause}
   *
   * @file Todo
   *
   * @example Todo
   *
   */var TToolButton$1=function(_React$Component){inherits(TToolButton,_React$Component);function TToolButton(props){classCallCheck(this,TToolButton);return possibleConstructorReturn(this,(TToolButton.__proto__||Object.getPrototypeOf(TToolButton)).call(this,props));}createClass(TToolButton,[{key:'componentDidMount',value:function componentDidMount(){}},{key:'componentWillUnmount',value:function componentWillUnmount(){}},{key:'render',value:function render(){var _props=this.props,id=_props.id,label=_props.label,icon=_props.icon,title=_props.title,onClickHandler=_props.onClickHandler;var toolButtonStyle={};var linkStyle={padding:'10px 15px',color:'white'};return react.createElement('li',{id:id,className:'toolbutton',style:toolButtonStyle,onClick:onClickHandler},react.createElement('a',{title:title,style:linkStyle},react.createElement('i',{className:icon}),label));}}]);return TToolButton;}(react.Component);/**
   * @author [Tristan Valcke]{@link https://github.com/Itee}
   * @license [BSD-3-Clause]{@link https://opensource.org/licenses/BSD-3-Clause}
   *
   * @file Intermediary export file for uis/inputs/buttons folder
   *
   *//**
   * @author [Tristan Valcke]{@link https://github.com/Itee}
   * @license [BSD-3-Clause]{@link https://opensource.org/licenses/BSD-3-Clause}
   *
   * @file Todo
   *
   * @example Todo
   *
   */var _instanceCounter$81=0;var TAutoComplete=function(_React$Component){inherits(TAutoComplete,_React$Component);function TAutoComplete(props){classCallCheck(this,TAutoComplete);var _this=possibleConstructorReturn(this,(TAutoComplete.__proto__||Object.getPrototypeOf(TAutoComplete)).call(this,props));_instanceCounter$81++;return _this;}/**
       * React lifecycle
       */createClass(TAutoComplete,[{key:'componentWillMount',value:function componentWillMount(){}},{key:'componentDidMount',value:function componentDidMount(){}},{key:'componentWillUnmount',value:function componentWillUnmount(){}},{key:'componentWillReceiveProps',value:function componentWillReceiveProps()/*nextProps*/{}},{key:'shouldComponentUpdate',value:function shouldComponentUpdate()/*nextProps, nextState*/{}},{key:'componentWillUpdate',value:function componentWillUpdate()/*nextProps, nextState*/{}},{key:'componentDidUpdate',value:function componentDidUpdate()/*prevProps, prevState*/{}},{key:'render',value:function render(){var _this2=this;var _props=this.props,id=_props.id,className=_props.className;var _id=id||'tAutoComplete_'+_instanceCounter$81;var _style={};var _class=className?'tAutoComplete '+className:'tAutoComplete';return react.createElement('t-auto-complete',{ref:function ref(container){_this2._container=container;},id:_id,style:_style,className:_class});}}]);return TAutoComplete;}(react.Component);/**
   * @author [Tristan Valcke]{@link https://github.com/Itee}
   * @license [BSD-3-Clause]{@link https://opensource.org/licenses/BSD-3-Clause}
   *
   * @file Todo
   *
   * @example Todo
   *
   */var _instanceCounter$82=0;var TCascader=function(_React$Component){inherits(TCascader,_React$Component);function TCascader(props){classCallCheck(this,TCascader);var _this=possibleConstructorReturn(this,(TCascader.__proto__||Object.getPrototypeOf(TCascader)).call(this,props));_instanceCounter$82++;return _this;}/**
       * React lifecycle
       */createClass(TCascader,[{key:'componentWillMount',value:function componentWillMount(){}},{key:'componentDidMount',value:function componentDidMount(){}},{key:'componentWillUnmount',value:function componentWillUnmount(){}},{key:'componentWillReceiveProps',value:function componentWillReceiveProps()/*nextProps*/{}},{key:'shouldComponentUpdate',value:function shouldComponentUpdate()/*nextProps, nextState*/{}},{key:'componentWillUpdate',value:function componentWillUpdate()/*nextProps, nextState*/{}},{key:'componentDidUpdate',value:function componentDidUpdate()/*prevProps, prevState*/{}},{key:'render',value:function render(){var _this2=this;var _props=this.props,id=_props.id,className=_props.className;var _id=id||'tCascader_'+_instanceCounter$82;var _style={};var _class=className?'tCascader '+className:'tCascader';return react.createElement('t-cascader',{ref:function ref(container){_this2._container=container;},id:_id,style:_style,className:_class});}}]);return TCascader;}(react.Component);/**
   * @author [Tristan Valcke]{@link https://github.com/Itee}
   * @license [BSD-3-Clause]{@link https://opensource.org/licenses/BSD-3-Clause}
   *
   * @file Todo
   *
   * @example Todo
   *
   */var _instanceCounter$83=0;var TDropZone=function(_React$Component){inherits(TDropZone,_React$Component);function TDropZone(props){classCallCheck(this,TDropZone);var _this=possibleConstructorReturn(this,(TDropZone.__proto__||Object.getPrototypeOf(TDropZone)).call(this,props));_instanceCounter$83++;return _this;}/**
       * React lifecycle
       */createClass(TDropZone,[{key:'componentWillMount',value:function componentWillMount(){}},{key:'componentDidMount',value:function componentDidMount(){}},{key:'componentWillUnmount',value:function componentWillUnmount(){}},{key:'componentWillReceiveProps',value:function componentWillReceiveProps()/*nextProps*/{}},{key:'shouldComponentUpdate',value:function shouldComponentUpdate()/*nextProps, nextState*/{}},{key:'componentWillUpdate',value:function componentWillUpdate()/*nextProps, nextState*/{}},{key:'componentDidUpdate',value:function componentDidUpdate()/*prevProps, prevState*/{}},{key:'render',value:function render(){var _this2=this;var _props=this.props,id=_props.id,className=_props.className;var _id=id||'tDropZone_'+_instanceCounter$83;var _style={};var _class=className?'tDropZone '+className:'tDropZone';return react.createElement('t-drop-zone',{ref:function ref(container){_this2._container=container;},id:_id,style:_style,className:_class});}}]);return TDropZone;}(react.Component);/**
   * @author [Tristan Valcke]{@link https://github.com/Itee}
   * @license [BSD-3-Clause]{@link https://opensource.org/licenses/BSD-3-Clause}
   *
   * @file Todo
   *
   * @example Todo
   *
   */var _instanceCounter$84=0;var TForm=function(_React$Component){inherits(TForm,_React$Component);function TForm(props){classCallCheck(this,TForm);var _this=possibleConstructorReturn(this,(TForm.__proto__||Object.getPrototypeOf(TForm)).call(this,props));_instanceCounter$84++;return _this;}/**
       * React lifecycle
       */createClass(TForm,[{key:'componentWillMount',value:function componentWillMount(){}},{key:'componentDidMount',value:function componentDidMount(){}},{key:'componentWillUnmount',value:function componentWillUnmount(){}},{key:'componentWillReceiveProps',value:function componentWillReceiveProps()/*nextProps*/{}},{key:'shouldComponentUpdate',value:function shouldComponentUpdate()/*nextProps, nextState*/{}},{key:'componentWillUpdate',value:function componentWillUpdate()/*nextProps, nextState*/{}},{key:'componentDidUpdate',value:function componentDidUpdate()/*prevProps, prevState*/{}},{key:'render',value:function render(){var _this2=this;var _props=this.props,id=_props.id,className=_props.className;var _id=id||'tForm_'+_instanceCounter$84;var _style={};var _class=className?'tForm '+className:'tForm';return react.createElement('t-form',{ref:function ref(container){_this2._container=container;},id:_id,style:_style,className:_class});}}]);return TForm;}(react.Component);/**
   * @author [Tristan Valcke]{@link https://github.com/Itee}
   * @license [BSD-3-Clause]{@link https://opensource.org/licenses/BSD-3-Clause}
   *
   * @file Todo
   *
   * @example Todo
   *
   */var _instanceCounter$85=0;var TSearchBar=function(_React$Component){inherits(TSearchBar,_React$Component);function TSearchBar(props){classCallCheck(this,TSearchBar);var _this=possibleConstructorReturn(this,(TSearchBar.__proto__||Object.getPrototypeOf(TSearchBar)).call(this,props));_instanceCounter$85++;return _this;}/**
       * React lifecycle
       */createClass(TSearchBar,[{key:'componentWillMount',value:function componentWillMount(){}},{key:'componentDidMount',value:function componentDidMount(){}},{key:'componentWillUnmount',value:function componentWillUnmount(){}},{key:'componentWillReceiveProps',value:function componentWillReceiveProps()/*nextProps*/{}},{key:'shouldComponentUpdate',value:function shouldComponentUpdate()/*nextProps, nextState*/{}},{key:'componentWillUpdate',value:function componentWillUpdate()/*nextProps, nextState*/{}},{key:'componentDidUpdate',value:function componentDidUpdate()/*prevProps, prevState*/{}},{key:'render',value:function render(){var _this2=this;var _props=this.props,id=_props.id,className=_props.className;var _id=id||'tSearchBar_'+_instanceCounter$85;var _style={};var _class=className?'tSearchBar '+className:'tSearchBar';return react.createElement('t-search-bar',{ref:function ref(container){_this2._container=container;},id:_id,style:_style,className:_class});}}]);return TSearchBar;}(react.Component);/**
   * @author [Tristan Valcke]{@link https://github.com/Itee}
   * @license [BSD-3-Clause]{@link https://opensource.org/licenses/BSD-3-Clause}
   *
   * @file Todo
   *
   * @example Todo
   *
   */var _instanceCounter$86=0;var TTransfer=function(_React$Component){inherits(TTransfer,_React$Component);function TTransfer(props){classCallCheck(this,TTransfer);var _this=possibleConstructorReturn(this,(TTransfer.__proto__||Object.getPrototypeOf(TTransfer)).call(this,props));_instanceCounter$86++;return _this;}/**
       * React lifecycle
       */createClass(TTransfer,[{key:'componentWillMount',value:function componentWillMount(){}},{key:'componentDidMount',value:function componentDidMount(){}},{key:'componentWillUnmount',value:function componentWillUnmount(){}},{key:'componentWillReceiveProps',value:function componentWillReceiveProps()/*nextProps*/{}},{key:'shouldComponentUpdate',value:function shouldComponentUpdate()/*nextProps, nextState*/{}},{key:'componentWillUpdate',value:function componentWillUpdate()/*nextProps, nextState*/{}},{key:'componentDidUpdate',value:function componentDidUpdate()/*prevProps, prevState*/{}},{key:'render',value:function render(){var _this2=this;var _props=this.props,id=_props.id,className=_props.className;var _id=id||'tTransfer_'+_instanceCounter$86;var _style={};var _class=className?'tTransfer '+className:'tTransfer';return react.createElement('t-transfer',{ref:function ref(container){_this2._container=container;},id:_id,style:_style,className:_class});}}]);return TTransfer;}(react.Component);/**
   * @author [Tristan Valcke]{@link https://github.com/Itee}
   * @license [BSD-3-Clause]{@link https://opensource.org/licenses/BSD-3-Clause}
   *
   * @file Todo
   *
   * @example Todo
   *
   */var _instanceCounter$87=0;var TUpload=function(_React$Component){inherits(TUpload,_React$Component);function TUpload(props){classCallCheck(this,TUpload);var _this=possibleConstructorReturn(this,(TUpload.__proto__||Object.getPrototypeOf(TUpload)).call(this,props));_instanceCounter$87++;return _this;}/**
       * React lifecycle
       */createClass(TUpload,[{key:'componentWillMount',value:function componentWillMount(){}},{key:'componentDidMount',value:function componentDidMount(){}},{key:'componentWillUnmount',value:function componentWillUnmount(){}},{key:'componentWillReceiveProps',value:function componentWillReceiveProps()/*nextProps*/{}},{key:'shouldComponentUpdate',value:function shouldComponentUpdate()/*nextProps, nextState*/{}},{key:'componentWillUpdate',value:function componentWillUpdate()/*nextProps, nextState*/{}},{key:'componentDidUpdate',value:function componentDidUpdate()/*prevProps, prevState*/{}},{key:'render',value:function render(){var _this2=this;var _props=this.props,id=_props.id,className=_props.className;var _id=id||'tUpload_'+_instanceCounter$87;var _style={};var _class=className?'tUpload '+className:'tUpload';return react.createElement('t-upload',{ref:function ref(container){_this2._container=container;},id:_id,style:_style,className:_class});}}]);return TUpload;}(react.Component);/**
   * @author [Tristan Valcke]{@link https://github.com/Itee}
   * @license [BSD-3-Clause]{@link https://opensource.org/licenses/BSD-3-Clause}
   *
   * @file Intermediary export file for uis/inputs/others folder
   *
   *//**
   * @author [Tristan Valcke]{@link https://github.com/Itee}
   * @license [BSD-3-Clause]{@link https://opensource.org/licenses/BSD-3-Clause}
   *
   * @file Intermediary export file for uis/inputs folder
   *
   *//**
   * @author [Tristan Valcke]{@link https://github.com/Itee}
   * @license [BSD-3-Clause]{@link https://opensource.org/licenses/BSD-3-Clause}
   *
   * @file Todo
   *
   * @example Todo
   *
   */var _instanceCounter$88=0;var TDialog=function(_React$Component){inherits(TDialog,_React$Component);function TDialog(props){classCallCheck(this,TDialog);var _this=possibleConstructorReturn(this,(TDialog.__proto__||Object.getPrototypeOf(TDialog)).call(this,props));_instanceCounter$88++;return _this;}/**
       * React lifecycle
       */createClass(TDialog,[{key:'componentWillMount',value:function componentWillMount(){}},{key:'componentDidMount',value:function componentDidMount(){}},{key:'componentWillUnmount',value:function componentWillUnmount(){}},{key:'componentWillReceiveProps',value:function componentWillReceiveProps()/*nextProps*/{}},{key:'shouldComponentUpdate',value:function shouldComponentUpdate()/*nextProps, nextState*/{}},{key:'componentWillUpdate',value:function componentWillUpdate()/*nextProps, nextState*/{}},{key:'componentDidUpdate',value:function componentDidUpdate()/*prevProps, prevState*/{}},{key:'render',value:function render(){var _this2=this;var _props=this.props,id=_props.id,className=_props.className;var _id=id||'tDialog_'+_instanceCounter$88;var _style={};var _class=className?'tDialog '+className:'tDialog';return react.createElement('t-dialog',{ref:function ref(container){_this2._container=container;},id:_id,style:_style,className:_class});}}]);return TDialog;}(react.Component);/**
   * @author [Tristan Valcke]{@link https://github.com/Itee}
   * @license [BSD-3-Clause]{@link https://opensource.org/licenses/BSD-3-Clause}
   *
   * @file Todo
   *
   * @example Todo
   *
   */var TDialogArea$1=function(_React$Component){inherits(TDialogArea,_React$Component);function TDialogArea(props){classCallCheck(this,TDialogArea);return possibleConstructorReturn(this,(TDialogArea.__proto__||Object.getPrototypeOf(TDialogArea)).call(this,props));}createClass(TDialogArea,[{key:'render',value:function render(){var props=this.props;var _STYLE={position:'absolute',zIndex:1000,top:0,left:0,height:'100%',width:'100%',display:props.isVisible?'flex':'none',alignItems:'center',justifyContent:'center',background:'#ffffffba'};return react.createElement('div',{className:'dialog-area',style:_STYLE},props.children);}}]);return TDialogArea;}(react.Component);/**
   * @author [Tristan Valcke]{@link https://github.com/Itee}
   * @license [BSD-3-Clause]{@link https://opensource.org/licenses/BSD-3-Clause}
   *
   * @file Todo
   *
   * @example Todo
   *
   */var _instanceCounter$89=0;var TErrorDialog=function(_React$Component){inherits(TErrorDialog,_React$Component);function TErrorDialog(props){classCallCheck(this,TErrorDialog);var _this=possibleConstructorReturn(this,(TErrorDialog.__proto__||Object.getPrototypeOf(TErrorDialog)).call(this,props));_instanceCounter$89++;return _this;}/**
       * React lifecycle
       */createClass(TErrorDialog,[{key:'componentWillMount',value:function componentWillMount(){}},{key:'componentDidMount',value:function componentDidMount(){}},{key:'componentWillUnmount',value:function componentWillUnmount(){}},{key:'componentWillReceiveProps',value:function componentWillReceiveProps()/*nextProps*/{}},{key:'shouldComponentUpdate',value:function shouldComponentUpdate()/*nextProps, nextState*/{}},{key:'componentWillUpdate',value:function componentWillUpdate()/*nextProps, nextState*/{}},{key:'componentDidUpdate',value:function componentDidUpdate()/*prevProps, prevState*/{}},{key:'render',value:function render(){var _this2=this;var _props=this.props,id=_props.id,className=_props.className;var _id=id||'tErrorDialog_'+_instanceCounter$89;var _style={};var _class=className?'tErrorDialog '+className:'tErrorDialog';return react.createElement('t-error-dialog',{ref:function ref(container){_this2._container=container;},id:_id,style:_style,className:_class});}}]);return TErrorDialog;}(react.Component);/**
   * @author [Tristan Valcke]{@link https://github.com/Itee}
   * @license [BSD-3-Clause]{@link https://opensource.org/licenses/BSD-3-Clause}
   *
   * @file Todo
   *
   * @example Todo
   *
   */var _instanceCounter$90=0;var TInfoDialog=function(_React$Component){inherits(TInfoDialog,_React$Component);function TInfoDialog(props){classCallCheck(this,TInfoDialog);var _this=possibleConstructorReturn(this,(TInfoDialog.__proto__||Object.getPrototypeOf(TInfoDialog)).call(this,props));_instanceCounter$90++;return _this;}/**
       * React lifecycle
       */createClass(TInfoDialog,[{key:'componentWillMount',value:function componentWillMount(){}},{key:'componentDidMount',value:function componentDidMount(){}},{key:'componentWillUnmount',value:function componentWillUnmount(){}},{key:'componentWillReceiveProps',value:function componentWillReceiveProps()/*nextProps*/{}},{key:'shouldComponentUpdate',value:function shouldComponentUpdate()/*nextProps, nextState*/{}},{key:'componentWillUpdate',value:function componentWillUpdate()/*nextProps, nextState*/{}},{key:'componentDidUpdate',value:function componentDidUpdate()/*prevProps, prevState*/{}},{key:'render',value:function render(){var _this2=this;var _props=this.props,id=_props.id,className=_props.className;var _id=id||'tInfoDialog_'+_instanceCounter$90;var _style={};var _class=className?'tInfoDialog '+className:'tInfoDialog';return react.createElement('t-info-dialog',{ref:function ref(container){_this2._container=container;},id:_id,style:_style,className:_class});}}]);return TInfoDialog;}(react.Component);/**
   * @author [Tristan Valcke]{@link https://github.com/Itee}
   * @license [BSD-3-Clause]{@link https://opensource.org/licenses/BSD-3-Clause}
   *
   * @file Todo
   *
   * @example Todo
   *
   */var _instanceCounter$91=0;var TInputDialog=function(_React$Component){inherits(TInputDialog,_React$Component);function TInputDialog(props){classCallCheck(this,TInputDialog);var _this=possibleConstructorReturn(this,(TInputDialog.__proto__||Object.getPrototypeOf(TInputDialog)).call(this,props));_instanceCounter$91++;return _this;}/**
       * React lifecycle
       */createClass(TInputDialog,[{key:'componentWillMount',value:function componentWillMount(){}},{key:'componentDidMount',value:function componentDidMount(){}},{key:'componentWillUnmount',value:function componentWillUnmount(){}},{key:'componentWillReceiveProps',value:function componentWillReceiveProps()/*nextProps*/{}},{key:'shouldComponentUpdate',value:function shouldComponentUpdate()/*nextProps, nextState*/{}},{key:'componentWillUpdate',value:function componentWillUpdate()/*nextProps, nextState*/{}},{key:'componentDidUpdate',value:function componentDidUpdate()/*prevProps, prevState*/{}},{key:'render',value:function render(){var _this2=this;var _props=this.props,id=_props.id,className=_props.className;var _id=id||'tInputDialog_'+_instanceCounter$91;var _style={};var _class=className?'tInputDialog '+className:'tInputDialog';return react.createElement('t-input-dialog',{ref:function ref(container){_this2._container=container;},id:_id,style:_style,className:_class});}}]);return TInputDialog;}(react.Component);/**
   * @author [Tristan Valcke]{@link https://github.com/Itee}
   * @license [BSD-3-Clause]{@link https://opensource.org/licenses/BSD-3-Clause}
   *
   * @file Todo
   *
   * @example Todo
   *
   */var _instanceCounter$92=0;var TLoginDialog$1=function(_React$Component){inherits(TLoginDialog,_React$Component);function TLoginDialog(props){classCallCheck(this,TLoginDialog);var _this=possibleConstructorReturn(this,(TLoginDialog.__proto__||Object.getPrototypeOf(TLoginDialog)).call(this,props));_instanceCounter$92++;return _this;}/**
       * React lifecycle
       */createClass(TLoginDialog,[{key:'componentWillMount',value:function componentWillMount(){}},{key:'componentDidMount',value:function componentDidMount(){}},{key:'componentWillUnmount',value:function componentWillUnmount(){}},{key:'componentWillReceiveProps',value:function componentWillReceiveProps()/*nextProps*/{}},{key:'shouldComponentUpdate',value:function shouldComponentUpdate()/*nextProps, nextState*/{}},{key:'componentWillUpdate',value:function componentWillUpdate()/*nextProps, nextState*/{}},{key:'componentDidUpdate',value:function componentDidUpdate()/*prevProps, prevState*/{}},{key:'render',value:function render(){var _this2=this;var _props=this.props,id=_props.id,className=_props.className;var _id=id||'tLoginDialog_'+_instanceCounter$92;var _style={};var _class=className?'tLoginDialog '+className:'tLoginDialog';return react.createElement('t-login-dialog',{ref:function ref(container){_this2._container=container;},id:_id,style:_style,className:_class});}}]);return TLoginDialog;}(react.Component);/**
   * @author [Tristan Valcke]{@link https://github.com/Itee}
   * @license [BSD-3-Clause]{@link https://opensource.org/licenses/BSD-3-Clause}
   *
   * @file Todo
   *
   * @example Todo
   *
   */var _instanceCounter$93=0;var TLoginOrRegisterDialog=function(_React$Component){inherits(TLoginOrRegisterDialog,_React$Component);function TLoginOrRegisterDialog(props){classCallCheck(this,TLoginOrRegisterDialog);var _this=possibleConstructorReturn(this,(TLoginOrRegisterDialog.__proto__||Object.getPrototypeOf(TLoginOrRegisterDialog)).call(this,props));_instanceCounter$93++;return _this;}/**
       * React lifecycle
       */createClass(TLoginOrRegisterDialog,[{key:'componentWillMount',value:function componentWillMount(){}},{key:'componentDidMount',value:function componentDidMount(){}},{key:'componentWillUnmount',value:function componentWillUnmount(){}},{key:'componentWillReceiveProps',value:function componentWillReceiveProps()/*nextProps*/{}},{key:'shouldComponentUpdate',value:function shouldComponentUpdate()/*nextProps, nextState*/{}},{key:'componentWillUpdate',value:function componentWillUpdate()/*nextProps, nextState*/{}},{key:'componentDidUpdate',value:function componentDidUpdate()/*prevProps, prevState*/{}},{key:'render',value:function render(){var _this2=this;var _props=this.props,id=_props.id,className=_props.className;var _id=id||'tLoginOrRegisterDialog_'+_instanceCounter$93;var _style={};var _class=className?'tLoginOrRegisterDialog '+className:'tLoginOrRegisterDialog';return react.createElement('t-login-or-register-dialog',{ref:function ref(container){_this2._container=container;},id:_id,style:_style,className:_class});}}]);return TLoginOrRegisterDialog;}(react.Component);/**
   * @author [Tristan Valcke]{@link https://github.com/Itee}
   * @license [BSD-3-Clause]{@link https://opensource.org/licenses/BSD-3-Clause}
   *
   * @file Todo
   *
   * @example Todo
   *
   */var _instanceCounter$94=0;var TMessageDialog=function(_React$Component){inherits(TMessageDialog,_React$Component);function TMessageDialog(props){classCallCheck(this,TMessageDialog);var _this=possibleConstructorReturn(this,(TMessageDialog.__proto__||Object.getPrototypeOf(TMessageDialog)).call(this,props));_instanceCounter$94++;return _this;}/**
       * React lifecycle
       */createClass(TMessageDialog,[{key:'componentWillMount',value:function componentWillMount(){}},{key:'componentDidMount',value:function componentDidMount(){}},{key:'componentWillUnmount',value:function componentWillUnmount(){}},{key:'componentWillReceiveProps',value:function componentWillReceiveProps()/*nextProps*/{}},{key:'shouldComponentUpdate',value:function shouldComponentUpdate()/*nextProps, nextState*/{}},{key:'componentWillUpdate',value:function componentWillUpdate()/*nextProps, nextState*/{}},{key:'componentDidUpdate',value:function componentDidUpdate()/*prevProps, prevState*/{}},{key:'render',value:function render(){var _this2=this;var _props=this.props,id=_props.id,className=_props.className;var _id=id||'tMessageDialog_'+_instanceCounter$94;var _style={};var _class=className?'tMessageDialog '+className:'tMessageDialog';return react.createElement('t-message-dialog',{ref:function ref(container){_this2._container=container;},id:_id,style:_style,className:_class});}}]);return TMessageDialog;}(react.Component);/**
   * @author [Tristan Valcke]{@link https://github.com/Itee}
   * @license [BSD-3-Clause]{@link https://opensource.org/licenses/BSD-3-Clause}
   *
   * @file Todo
   *
   * @example Todo
   *
   */var _instanceCounter$95=0;var TProgressDialog=function(_React$Component){inherits(TProgressDialog,_React$Component);function TProgressDialog(props){classCallCheck(this,TProgressDialog);var _this=possibleConstructorReturn(this,(TProgressDialog.__proto__||Object.getPrototypeOf(TProgressDialog)).call(this,props));_instanceCounter$95++;return _this;}/**
       * React lifecycle
       */createClass(TProgressDialog,[{key:'componentWillMount',value:function componentWillMount(){}},{key:'componentDidMount',value:function componentDidMount(){}},{key:'componentWillUnmount',value:function componentWillUnmount(){}},{key:'componentWillReceiveProps',value:function componentWillReceiveProps()/*nextProps*/{}},{key:'shouldComponentUpdate',value:function shouldComponentUpdate()/*nextProps, nextState*/{}},{key:'componentWillUpdate',value:function componentWillUpdate()/*nextProps, nextState*/{}},{key:'componentDidUpdate',value:function componentDidUpdate()/*prevProps, prevState*/{}},{key:'render',value:function render(){var _this2=this;var _props=this.props,id=_props.id,className=_props.className;var _id=id||'tProgressDialog_'+_instanceCounter$95;var _style={};var _class=className?'tProgressDialog '+className:'tProgressDialog';return react.createElement('t-progress-dialog',{ref:function ref(container){_this2._container=container;},id:_id,style:_style,className:_class});}}]);return TProgressDialog;}(react.Component);/**
   * @author [Tristan Valcke]{@link https://github.com/Itee}
   * @license [BSD-3-Clause]{@link https://opensource.org/licenses/BSD-3-Clause}
   *
   * @file Todo
   *
   * @example Todo
   *
   */var _instanceCounter$96=0;var TRegisterDialog=function(_React$Component){inherits(TRegisterDialog,_React$Component);function TRegisterDialog(props){classCallCheck(this,TRegisterDialog);var _this=possibleConstructorReturn(this,(TRegisterDialog.__proto__||Object.getPrototypeOf(TRegisterDialog)).call(this,props));_instanceCounter$96++;return _this;}/**
       * React lifecycle
       */createClass(TRegisterDialog,[{key:'componentWillMount',value:function componentWillMount(){}},{key:'componentDidMount',value:function componentDidMount(){}},{key:'componentWillUnmount',value:function componentWillUnmount(){}},{key:'componentWillReceiveProps',value:function componentWillReceiveProps()/*nextProps*/{}},{key:'shouldComponentUpdate',value:function shouldComponentUpdate()/*nextProps, nextState*/{}},{key:'componentWillUpdate',value:function componentWillUpdate()/*nextProps, nextState*/{}},{key:'componentDidUpdate',value:function componentDidUpdate()/*prevProps, prevState*/{}},{key:'render',value:function render(){var _this2=this;var _props=this.props,id=_props.id,className=_props.className;var _id=id||'tRegisterDialog_'+_instanceCounter$96;var _style={};var _class=className?'tRegisterDialog '+className:'tRegisterDialog';return react.createElement('t-register-dialog',{ref:function ref(container){_this2._container=container;},id:_id,style:_style,className:_class});}}]);return TRegisterDialog;}(react.Component);/**
   * @author [Tristan Valcke]{@link https://github.com/Itee}
   * @license [BSD-3-Clause]{@link https://opensource.org/licenses/BSD-3-Clause}
   *
   * @file Todo
   *
   * @example Todo
   *
   */var _instanceCounter$97=0;var TWarningDialog=function(_React$Component){inherits(TWarningDialog,_React$Component);function TWarningDialog(props){classCallCheck(this,TWarningDialog);var _this=possibleConstructorReturn(this,(TWarningDialog.__proto__||Object.getPrototypeOf(TWarningDialog)).call(this,props));_instanceCounter$97++;return _this;}/**
       * React lifecycle
       */createClass(TWarningDialog,[{key:'componentWillMount',value:function componentWillMount(){}},{key:'componentDidMount',value:function componentDidMount(){}},{key:'componentWillUnmount',value:function componentWillUnmount(){}},{key:'componentWillReceiveProps',value:function componentWillReceiveProps()/*nextProps*/{}},{key:'shouldComponentUpdate',value:function shouldComponentUpdate()/*nextProps, nextState*/{}},{key:'componentWillUpdate',value:function componentWillUpdate()/*nextProps, nextState*/{}},{key:'componentDidUpdate',value:function componentDidUpdate()/*prevProps, prevState*/{}},{key:'render',value:function render(){var _this2=this;var _props=this.props,id=_props.id,className=_props.className;var _id=id||'tWarningDialog_'+_instanceCounter$97;var _style={};var _class=className?'tWarningDialog '+className:'tWarningDialog';return react.createElement('t-warning-dialog',{ref:function ref(container){_this2._container=container;},id:_id,style:_style,className:_class});}}]);return TWarningDialog;}(react.Component);/**
   * @author [Tristan Valcke]{@link https://github.com/Itee}
   * @license [BSD-3-Clause]{@link https://opensource.org/licenses/BSD-3-Clause}
   *
   * @file Intermediary export file for uis/interactives/dialogs folder
   *
   *//**
   * @author [Tristan Valcke]{@link https://github.com/Itee}
   * @license [BSD-3-Clause]{@link https://opensource.org/licenses/BSD-3-Clause}
   *
   * @file Todo
   *
   * @example Todo
   *
   */var _instanceCounter$98=0;var TErrorNotification=function(_React$Component){inherits(TErrorNotification,_React$Component);function TErrorNotification(props){classCallCheck(this,TErrorNotification);var _this=possibleConstructorReturn(this,(TErrorNotification.__proto__||Object.getPrototypeOf(TErrorNotification)).call(this,props));_instanceCounter$98++;return _this;}/**
       * React lifecycle
       */createClass(TErrorNotification,[{key:'componentWillMount',value:function componentWillMount(){}},{key:'componentDidMount',value:function componentDidMount(){}},{key:'componentWillUnmount',value:function componentWillUnmount(){}},{key:'componentWillReceiveProps',value:function componentWillReceiveProps()/*nextProps*/{}},{key:'shouldComponentUpdate',value:function shouldComponentUpdate()/*nextProps, nextState*/{}},{key:'componentWillUpdate',value:function componentWillUpdate()/*nextProps, nextState*/{}},{key:'componentDidUpdate',value:function componentDidUpdate()/*prevProps, prevState*/{}},{key:'render',value:function render(){var _this2=this;var _props=this.props,id=_props.id,className=_props.className;var _id=id||'tErrorNotification_'+_instanceCounter$98;var _style={};var _class=className?'tErrorNotification '+className:'tErrorNotification';return react.createElement('t-error-notification',{ref:function ref(container){_this2._container=container;},id:_id,style:_style,className:_class});}}]);return TErrorNotification;}(react.Component);/**
   * @author [Tristan Valcke]{@link https://github.com/Itee}
   * @license [BSD-3-Clause]{@link https://opensource.org/licenses/BSD-3-Clause}
   *
   * @file Todo
   *
   * @example Todo
   *
   */var _instanceCounter$99=0;var TInfoNotification=function(_React$Component){inherits(TInfoNotification,_React$Component);function TInfoNotification(props){classCallCheck(this,TInfoNotification);var _this=possibleConstructorReturn(this,(TInfoNotification.__proto__||Object.getPrototypeOf(TInfoNotification)).call(this,props));_instanceCounter$99++;return _this;}/**
       * React lifecycle
       */createClass(TInfoNotification,[{key:'componentWillMount',value:function componentWillMount(){}},{key:'componentDidMount',value:function componentDidMount(){}},{key:'componentWillUnmount',value:function componentWillUnmount(){}},{key:'componentWillReceiveProps',value:function componentWillReceiveProps()/*nextProps*/{}},{key:'shouldComponentUpdate',value:function shouldComponentUpdate()/*nextProps, nextState*/{}},{key:'componentWillUpdate',value:function componentWillUpdate()/*nextProps, nextState*/{}},{key:'componentDidUpdate',value:function componentDidUpdate()/*prevProps, prevState*/{}},{key:'render',value:function render(){var _this2=this;var _props=this.props,id=_props.id,className=_props.className;var _id=id||'tInfoNotification_'+_instanceCounter$99;var _style={};var _class=className?'tInfoNotification '+className:'tInfoNotification';return react.createElement('t-info-notification',{ref:function ref(container){_this2._container=container;},id:_id,style:_style,className:_class});}}]);return TInfoNotification;}(react.Component);/**
   * @author [Tristan Valcke]{@link https://github.com/Itee}
   * @license [BSD-3-Clause]{@link https://opensource.org/licenses/BSD-3-Clause}
   *
   * @file Todo
   *
   * @example Todo
   *
   */var _instanceCounter$100=0;var TMessageNotification=function(_React$Component){inherits(TMessageNotification,_React$Component);function TMessageNotification(props){classCallCheck(this,TMessageNotification);var _this=possibleConstructorReturn(this,(TMessageNotification.__proto__||Object.getPrototypeOf(TMessageNotification)).call(this,props));_instanceCounter$100++;return _this;}/**
       * React lifecycle
       */createClass(TMessageNotification,[{key:'componentWillMount',value:function componentWillMount(){}},{key:'componentDidMount',value:function componentDidMount(){}},{key:'componentWillUnmount',value:function componentWillUnmount(){}},{key:'componentWillReceiveProps',value:function componentWillReceiveProps()/*nextProps*/{}},{key:'shouldComponentUpdate',value:function shouldComponentUpdate()/*nextProps, nextState*/{}},{key:'componentWillUpdate',value:function componentWillUpdate()/*nextProps, nextState*/{}},{key:'componentDidUpdate',value:function componentDidUpdate()/*prevProps, prevState*/{}},{key:'render',value:function render(){var _this2=this;var _props=this.props,id=_props.id,className=_props.className;var _id=id||'tMessageNotification_'+_instanceCounter$100;var _style={};var _class=className?'tMessageNotification '+className:'tMessageNotification';return react.createElement('t-message-notification',{ref:function ref(container){_this2._container=container;},id:_id,style:_style,className:_class});}}]);return TMessageNotification;}(react.Component);/**
   * @author [Tristan Valcke]{@link https://github.com/Itee}
   * @license [BSD-3-Clause]{@link https://opensource.org/licenses/BSD-3-Clause}
   *
   * @file Todo
   *
   * @example Todo
   *
   */var _instanceCounter$101=0;var TNotification=function(_React$Component){inherits(TNotification,_React$Component);function TNotification(props){classCallCheck(this,TNotification);var _this=possibleConstructorReturn(this,(TNotification.__proto__||Object.getPrototypeOf(TNotification)).call(this,props));_instanceCounter$101++;return _this;}/**
       * React lifecycle
       */createClass(TNotification,[{key:'componentWillMount',value:function componentWillMount(){}},{key:'componentDidMount',value:function componentDidMount(){}},{key:'componentWillUnmount',value:function componentWillUnmount(){}},{key:'componentWillReceiveProps',value:function componentWillReceiveProps()/*nextProps*/{}},{key:'shouldComponentUpdate',value:function shouldComponentUpdate()/*nextProps, nextState*/{}},{key:'componentWillUpdate',value:function componentWillUpdate()/*nextProps, nextState*/{}},{key:'componentDidUpdate',value:function componentDidUpdate()/*prevProps, prevState*/{}},{key:'render',value:function render(){var _this2=this;var _props=this.props,id=_props.id,className=_props.className;var _id=id||'tNotification_'+_instanceCounter$101;var _style={};var _class=className?'tNotification '+className:'tNotification';return react.createElement('t-notification',{ref:function ref(container){_this2._container=container;},id:_id,style:_style,className:_class});}}]);return TNotification;}(react.Component);/**
   * @author [Tristan Valcke]{@link https://github.com/Itee}
   * @license [BSD-3-Clause]{@link https://opensource.org/licenses/BSD-3-Clause}
   *
   * @file Todo
   *
   * @example Todo
   *
   */var _instanceCounter$102=0;var TProgressNotification=function(_React$Component){inherits(TProgressNotification,_React$Component);function TProgressNotification(props){classCallCheck(this,TProgressNotification);var _this=possibleConstructorReturn(this,(TProgressNotification.__proto__||Object.getPrototypeOf(TProgressNotification)).call(this,props));_instanceCounter$102++;return _this;}/**
       * React lifecycle
       */createClass(TProgressNotification,[{key:'componentWillMount',value:function componentWillMount(){}},{key:'componentDidMount',value:function componentDidMount(){}},{key:'componentWillUnmount',value:function componentWillUnmount(){}},{key:'componentWillReceiveProps',value:function componentWillReceiveProps()/*nextProps*/{}},{key:'shouldComponentUpdate',value:function shouldComponentUpdate()/*nextProps, nextState*/{}},{key:'componentWillUpdate',value:function componentWillUpdate()/*nextProps, nextState*/{}},{key:'componentDidUpdate',value:function componentDidUpdate()/*prevProps, prevState*/{}},{key:'render',value:function render(){var _this2=this;var _props=this.props,id=_props.id,className=_props.className;var _id=id||'tProgressNotification_'+_instanceCounter$102;var _style={};var _class=className?'tProgressNotification '+className:'tProgressNotification';return react.createElement('t-progress-notification',{ref:function ref(container){_this2._container=container;},id:_id,style:_style,className:_class});}}]);return TProgressNotification;}(react.Component);/**
   * @author [Tristan Valcke]{@link https://github.com/Itee}
   * @license [BSD-3-Clause]{@link https://opensource.org/licenses/BSD-3-Clause}
   *
   * @file Todo
   *
   * @example Todo
   *
   */var _instanceCounter$103=0;var TWarningNotification=function(_React$Component){inherits(TWarningNotification,_React$Component);function TWarningNotification(props){classCallCheck(this,TWarningNotification);var _this=possibleConstructorReturn(this,(TWarningNotification.__proto__||Object.getPrototypeOf(TWarningNotification)).call(this,props));_instanceCounter$103++;return _this;}/**
       * React lifecycle
       */createClass(TWarningNotification,[{key:'componentWillMount',value:function componentWillMount(){}},{key:'componentDidMount',value:function componentDidMount(){}},{key:'componentWillUnmount',value:function componentWillUnmount(){}},{key:'componentWillReceiveProps',value:function componentWillReceiveProps()/*nextProps*/{}},{key:'shouldComponentUpdate',value:function shouldComponentUpdate()/*nextProps, nextState*/{}},{key:'componentWillUpdate',value:function componentWillUpdate()/*nextProps, nextState*/{}},{key:'componentDidUpdate',value:function componentDidUpdate()/*prevProps, prevState*/{}},{key:'render',value:function render(){var _this2=this;var _props=this.props,id=_props.id,className=_props.className;var _id=id||'tWarningNotification_'+_instanceCounter$103;var _style={};var _class=className?'tWarningNotification '+className:'tWarningNotification';return react.createElement('t-warning-notification',{ref:function ref(container){_this2._container=container;},id:_id,style:_style,className:_class});}}]);return TWarningNotification;}(react.Component);/**
   * @author [Tristan Valcke]{@link https://github.com/Itee}
   * @license [BSD-3-Clause]{@link https://opensource.org/licenses/BSD-3-Clause}
   *
   * @file Intermediary export file for uis/interactives/notifications folder
   *
   *//**
   * @author [Tristan Valcke]{@link https://github.com/Itee}
   * @license [BSD-3-Clause]{@link https://opensource.org/licenses/BSD-3-Clause}
   *
   * @file Todo
   *
   * @example Todo
   *
   */var _instanceCounter$104=0;var TErrorPop=function(_React$Component){inherits(TErrorPop,_React$Component);function TErrorPop(props){classCallCheck(this,TErrorPop);var _this=possibleConstructorReturn(this,(TErrorPop.__proto__||Object.getPrototypeOf(TErrorPop)).call(this,props));_instanceCounter$104++;return _this;}/**
       * React lifecycle
       */createClass(TErrorPop,[{key:'componentWillMount',value:function componentWillMount(){}},{key:'componentDidMount',value:function componentDidMount(){}},{key:'componentWillUnmount',value:function componentWillUnmount(){}},{key:'componentWillReceiveProps',value:function componentWillReceiveProps()/*nextProps*/{}},{key:'shouldComponentUpdate',value:function shouldComponentUpdate()/*nextProps, nextState*/{}},{key:'componentWillUpdate',value:function componentWillUpdate()/*nextProps, nextState*/{}},{key:'componentDidUpdate',value:function componentDidUpdate()/*prevProps, prevState*/{}},{key:'render',value:function render(){var _this2=this;var _props=this.props,id=_props.id,className=_props.className;var _id=id||'tErrorPop_'+_instanceCounter$104;var _style={};var _class=className?'tErrorPop '+className:'tErrorPop';return react.createElement('t-error-pop',{ref:function ref(container){_this2._container=container;},id:_id,style:_style,className:_class});}}]);return TErrorPop;}(react.Component);/**
   * @author [Tristan Valcke]{@link https://github.com/Itee}
   * @license [BSD-3-Clause]{@link https://opensource.org/licenses/BSD-3-Clause}
   *
   * @file Todo
   *
   * @example Todo
   *
   */var _instanceCounter$105=0;var TInfoPop=function(_React$Component){inherits(TInfoPop,_React$Component);function TInfoPop(props){classCallCheck(this,TInfoPop);var _this=possibleConstructorReturn(this,(TInfoPop.__proto__||Object.getPrototypeOf(TInfoPop)).call(this,props));_instanceCounter$105++;return _this;}/**
       * React lifecycle
       */createClass(TInfoPop,[{key:'componentWillMount',value:function componentWillMount(){}},{key:'componentDidMount',value:function componentDidMount(){}},{key:'componentWillUnmount',value:function componentWillUnmount(){}},{key:'componentWillReceiveProps',value:function componentWillReceiveProps()/*nextProps*/{}},{key:'shouldComponentUpdate',value:function shouldComponentUpdate()/*nextProps, nextState*/{}},{key:'componentWillUpdate',value:function componentWillUpdate()/*nextProps, nextState*/{}},{key:'componentDidUpdate',value:function componentDidUpdate()/*prevProps, prevState*/{}},{key:'render',value:function render(){var _this2=this;var _props=this.props,id=_props.id,className=_props.className;var _id=id||'tInfoPop_'+_instanceCounter$105;var _style={};var _class=className?'tInfoPop '+className:'tInfoPop';return react.createElement('t-info-pop',{ref:function ref(container){_this2._container=container;},id:_id,style:_style,className:_class});}}]);return TInfoPop;}(react.Component);/**
   * @author [Tristan Valcke]{@link https://github.com/Itee}
   * @license [BSD-3-Clause]{@link https://opensource.org/licenses/BSD-3-Clause}
   *
   * @file Todo
   *
   * @example Todo
   *
   */var _instanceCounter$106=0;var TMessagePop=function(_React$Component){inherits(TMessagePop,_React$Component);function TMessagePop(props){classCallCheck(this,TMessagePop);var _this=possibleConstructorReturn(this,(TMessagePop.__proto__||Object.getPrototypeOf(TMessagePop)).call(this,props));_instanceCounter$106++;return _this;}/**
       * React lifecycle
       */createClass(TMessagePop,[{key:'componentWillMount',value:function componentWillMount(){}},{key:'componentDidMount',value:function componentDidMount(){}},{key:'componentWillUnmount',value:function componentWillUnmount(){}},{key:'componentWillReceiveProps',value:function componentWillReceiveProps()/*nextProps*/{}},{key:'shouldComponentUpdate',value:function shouldComponentUpdate()/*nextProps, nextState*/{}},{key:'componentWillUpdate',value:function componentWillUpdate()/*nextProps, nextState*/{}},{key:'componentDidUpdate',value:function componentDidUpdate()/*prevProps, prevState*/{}},{key:'render',value:function render(){var _this2=this;var _props=this.props,id=_props.id,className=_props.className;var _id=id||'tMessagePop_'+_instanceCounter$106;var _style={};var _class=className?'tMessagePop '+className:'tMessagePop';return react.createElement('t-message-pop',{ref:function ref(container){_this2._container=container;},id:_id,style:_style,className:_class});}}]);return TMessagePop;}(react.Component);/**
   * @author [Tristan Valcke]{@link https://github.com/Itee}
   * @license [BSD-3-Clause]{@link https://opensource.org/licenses/BSD-3-Clause}
   *
   * @file Todo
   *
   * @example Todo
   *
   */var _instanceCounter$107=0;var TPop=function(_React$Component){inherits(TPop,_React$Component);function TPop(props){classCallCheck(this,TPop);var _this=possibleConstructorReturn(this,(TPop.__proto__||Object.getPrototypeOf(TPop)).call(this,props));_instanceCounter$107++;return _this;}/**
       * React lifecycle
       */createClass(TPop,[{key:'componentWillMount',value:function componentWillMount(){}},{key:'componentDidMount',value:function componentDidMount(){}},{key:'componentWillUnmount',value:function componentWillUnmount(){}},{key:'componentWillReceiveProps',value:function componentWillReceiveProps()/*nextProps*/{}},{key:'shouldComponentUpdate',value:function shouldComponentUpdate()/*nextProps, nextState*/{}},{key:'componentWillUpdate',value:function componentWillUpdate()/*nextProps, nextState*/{}},{key:'componentDidUpdate',value:function componentDidUpdate()/*prevProps, prevState*/{}},{key:'render',value:function render(){var _this2=this;var _props=this.props,id=_props.id,className=_props.className;var _id=id||'tPop_'+_instanceCounter$107;var _style={};var _class=className?'tPop '+className:'tPop';return react.createElement('t-pop',{ref:function ref(container){_this2._container=container;},id:_id,style:_style,className:_class});}}]);return TPop;}(react.Component);/**
   * @author [Tristan Valcke]{@link https://github.com/Itee}
   * @license [BSD-3-Clause]{@link https://opensource.org/licenses/BSD-3-Clause}
   *
   * @file Todo
   *
   * @example Todo
   *
   */var _instanceCounter$108=0;var TProgressPop=function(_React$Component){inherits(TProgressPop,_React$Component);function TProgressPop(props){classCallCheck(this,TProgressPop);var _this=possibleConstructorReturn(this,(TProgressPop.__proto__||Object.getPrototypeOf(TProgressPop)).call(this,props));_instanceCounter$108++;return _this;}/**
       * React lifecycle
       */createClass(TProgressPop,[{key:'componentWillMount',value:function componentWillMount(){}},{key:'componentDidMount',value:function componentDidMount(){}},{key:'componentWillUnmount',value:function componentWillUnmount(){}},{key:'componentWillReceiveProps',value:function componentWillReceiveProps()/*nextProps*/{}},{key:'shouldComponentUpdate',value:function shouldComponentUpdate()/*nextProps, nextState*/{}},{key:'componentWillUpdate',value:function componentWillUpdate()/*nextProps, nextState*/{}},{key:'componentDidUpdate',value:function componentDidUpdate()/*prevProps, prevState*/{}},{key:'render',value:function render(){var _this2=this;var _props=this.props,id=_props.id,className=_props.className;var _id=id||'tProgressPop_'+_instanceCounter$108;var _style={};var _class=className?'tProgressPop '+className:'tProgressPop';return react.createElement('t-progress-pop',{ref:function ref(container){_this2._container=container;},id:_id,style:_style,className:_class});}}]);return TProgressPop;}(react.Component);/**
   * @author [Tristan Valcke]{@link https://github.com/Itee}
   * @license [BSD-3-Clause]{@link https://opensource.org/licenses/BSD-3-Clause}
   *
   * @file Todo
   *
   * @example Todo
   *
   */var _instanceCounter$109=0;var TWarningPop=function(_React$Component){inherits(TWarningPop,_React$Component);function TWarningPop(props){classCallCheck(this,TWarningPop);var _this=possibleConstructorReturn(this,(TWarningPop.__proto__||Object.getPrototypeOf(TWarningPop)).call(this,props));_instanceCounter$109++;return _this;}/**
       * React lifecycle
       */createClass(TWarningPop,[{key:'componentWillMount',value:function componentWillMount(){}},{key:'componentDidMount',value:function componentDidMount(){}},{key:'componentWillUnmount',value:function componentWillUnmount(){}},{key:'componentWillReceiveProps',value:function componentWillReceiveProps()/*nextProps*/{}},{key:'shouldComponentUpdate',value:function shouldComponentUpdate()/*nextProps, nextState*/{}},{key:'componentWillUpdate',value:function componentWillUpdate()/*nextProps, nextState*/{}},{key:'componentDidUpdate',value:function componentDidUpdate()/*prevProps, prevState*/{}},{key:'render',value:function render(){var _this2=this;var _props=this.props,id=_props.id,className=_props.className;var _id=id||'tWarningPop_'+_instanceCounter$109;var _style={};var _class=className?'tWarningPop '+className:'tWarningPop';return react.createElement('t-warning-pop',{ref:function ref(container){_this2._container=container;},id:_id,style:_style,className:_class});}}]);return TWarningPop;}(react.Component);/**
   * @author [Tristan Valcke]{@link https://github.com/Itee}
   * @license [BSD-3-Clause]{@link https://opensource.org/licenses/BSD-3-Clause}
   *
   * @file Intermediary export file for uis/interactives/pops folder
   *
   *//**
   * @author [Tristan Valcke]{@link https://github.com/Itee}
   * @license [BSD-3-Clause]{@link https://opensource.org/licenses/BSD-3-Clause}
   *
   * @file Todo
   *
   * @example Todo
   *
   */var _instanceCounter$110=0;var TErrorToast=function(_React$Component){inherits(TErrorToast,_React$Component);function TErrorToast(props){classCallCheck(this,TErrorToast);var _this=possibleConstructorReturn(this,(TErrorToast.__proto__||Object.getPrototypeOf(TErrorToast)).call(this,props));_instanceCounter$110++;return _this;}/**
       * React lifecycle
       */createClass(TErrorToast,[{key:'componentWillMount',value:function componentWillMount(){}},{key:'componentDidMount',value:function componentDidMount(){}},{key:'componentWillUnmount',value:function componentWillUnmount(){}},{key:'componentWillReceiveProps',value:function componentWillReceiveProps()/*nextProps*/{}},{key:'shouldComponentUpdate',value:function shouldComponentUpdate()/*nextProps, nextState*/{}},{key:'componentWillUpdate',value:function componentWillUpdate()/*nextProps, nextState*/{}},{key:'componentDidUpdate',value:function componentDidUpdate()/*prevProps, prevState*/{}},{key:'render',value:function render(){var _this2=this;var _props=this.props,id=_props.id,className=_props.className;var _id=id||'tErrorToast_'+_instanceCounter$110;var _style={};var _class=className?'tErrorToast '+className:'tErrorToast';return react.createElement('t-error-toast',{ref:function ref(container){_this2._container=container;},id:_id,style:_style,className:_class});}}]);return TErrorToast;}(react.Component);/**
   * @author [Tristan Valcke]{@link https://github.com/Itee}
   * @license [BSD-3-Clause]{@link https://opensource.org/licenses/BSD-3-Clause}
   *
   * @file Todo
   *
   * @example Todo
   *
   */var _instanceCounter$111=0;var TInfoToast=function(_React$Component){inherits(TInfoToast,_React$Component);function TInfoToast(props){classCallCheck(this,TInfoToast);var _this=possibleConstructorReturn(this,(TInfoToast.__proto__||Object.getPrototypeOf(TInfoToast)).call(this,props));_instanceCounter$111++;return _this;}/**
       * React lifecycle
       */createClass(TInfoToast,[{key:'componentWillMount',value:function componentWillMount(){}},{key:'componentDidMount',value:function componentDidMount(){}},{key:'componentWillUnmount',value:function componentWillUnmount(){}},{key:'componentWillReceiveProps',value:function componentWillReceiveProps()/*nextProps*/{}},{key:'shouldComponentUpdate',value:function shouldComponentUpdate()/*nextProps, nextState*/{}},{key:'componentWillUpdate',value:function componentWillUpdate()/*nextProps, nextState*/{}},{key:'componentDidUpdate',value:function componentDidUpdate()/*prevProps, prevState*/{}},{key:'render',value:function render(){var _this2=this;var _props=this.props,id=_props.id,className=_props.className;var _id=id||'tInfoToast_'+_instanceCounter$111;var _style={};var _class=className?'tInfoToast '+className:'tInfoToast';return react.createElement('t-info-toast',{ref:function ref(container){_this2._container=container;},id:_id,style:_style,className:_class});}}]);return TInfoToast;}(react.Component);/**
   * @author [Tristan Valcke]{@link https://github.com/Itee}
   * @license [BSD-3-Clause]{@link https://opensource.org/licenses/BSD-3-Clause}
   *
   * @file Todo
   *
   * @example Todo
   *
   */var _instanceCounter$112=0;var TMessageToast=function(_React$Component){inherits(TMessageToast,_React$Component);function TMessageToast(props){classCallCheck(this,TMessageToast);var _this=possibleConstructorReturn(this,(TMessageToast.__proto__||Object.getPrototypeOf(TMessageToast)).call(this,props));_instanceCounter$112++;return _this;}/**
       * React lifecycle
       */createClass(TMessageToast,[{key:'componentWillMount',value:function componentWillMount(){}},{key:'componentDidMount',value:function componentDidMount(){}},{key:'componentWillUnmount',value:function componentWillUnmount(){}},{key:'componentWillReceiveProps',value:function componentWillReceiveProps()/*nextProps*/{}},{key:'shouldComponentUpdate',value:function shouldComponentUpdate()/*nextProps, nextState*/{}},{key:'componentWillUpdate',value:function componentWillUpdate()/*nextProps, nextState*/{}},{key:'componentDidUpdate',value:function componentDidUpdate()/*prevProps, prevState*/{}},{key:'render',value:function render(){var _this2=this;var _props=this.props,id=_props.id,className=_props.className;var _id=id||'tMessageToast_'+_instanceCounter$112;var _style={};var _class=className?'tMessageToast '+className:'tMessageToast';return react.createElement('t-message-toast',{ref:function ref(container){_this2._container=container;},id:_id,style:_style,className:_class});}}]);return TMessageToast;}(react.Component);/**
   * @author [Tristan Valcke]{@link https://github.com/Itee}
   * @license [BSD-3-Clause]{@link https://opensource.org/licenses/BSD-3-Clause}
   *
   * @file Todo
   *
   * @example Todo
   *
   */var _instanceCounter$113=0;var TProgressToast=function(_React$Component){inherits(TProgressToast,_React$Component);function TProgressToast(props){classCallCheck(this,TProgressToast);var _this=possibleConstructorReturn(this,(TProgressToast.__proto__||Object.getPrototypeOf(TProgressToast)).call(this,props));_instanceCounter$113++;return _this;}/**
       * React lifecycle
       */createClass(TProgressToast,[{key:'componentWillMount',value:function componentWillMount(){}},{key:'componentDidMount',value:function componentDidMount(){}},{key:'componentWillUnmount',value:function componentWillUnmount(){}},{key:'componentWillReceiveProps',value:function componentWillReceiveProps()/*nextProps*/{}},{key:'shouldComponentUpdate',value:function shouldComponentUpdate()/*nextProps, nextState*/{}},{key:'componentWillUpdate',value:function componentWillUpdate()/*nextProps, nextState*/{}},{key:'componentDidUpdate',value:function componentDidUpdate()/*prevProps, prevState*/{}},{key:'render',value:function render(){var _this2=this;var _props=this.props,id=_props.id,className=_props.className;var _id=id||'tProgressToast_'+_instanceCounter$113;var _style={};var _class=className?'tProgressToast '+className:'tProgressToast';return react.createElement('t-progress-toast',{ref:function ref(container){_this2._container=container;},id:_id,style:_style,className:_class});}}]);return TProgressToast;}(react.Component);/**
   * @author [Tristan Valcke]{@link https://github.com/Itee}
   * @license [BSD-3-Clause]{@link https://opensource.org/licenses/BSD-3-Clause}
   *
   * @file Todo
   *
   * @example Todo
   *
   */var _instanceCounter$114=0;var TToast=function(_React$Component){inherits(TToast,_React$Component);function TToast(props){classCallCheck(this,TToast);var _this=possibleConstructorReturn(this,(TToast.__proto__||Object.getPrototypeOf(TToast)).call(this,props));_instanceCounter$114++;return _this;}/**
       * React lifecycle
       */createClass(TToast,[{key:'componentWillMount',value:function componentWillMount(){}},{key:'componentDidMount',value:function componentDidMount(){}},{key:'componentWillUnmount',value:function componentWillUnmount(){}},{key:'componentWillReceiveProps',value:function componentWillReceiveProps()/*nextProps*/{}},{key:'shouldComponentUpdate',value:function shouldComponentUpdate()/*nextProps, nextState*/{}},{key:'componentWillUpdate',value:function componentWillUpdate()/*nextProps, nextState*/{}},{key:'componentDidUpdate',value:function componentDidUpdate()/*prevProps, prevState*/{}},{key:'render',value:function render(){var _this2=this;var _props=this.props,id=_props.id,className=_props.className;var _id=id||'tToast_'+_instanceCounter$114;var _style={};var _class=className?'tToast '+className:'tToast';return react.createElement('t-toast',{ref:function ref(container){_this2._container=container;},id:_id,style:_style,className:_class});}}]);return TToast;}(react.Component);/**
   * @author [Tristan Valcke]{@link https://github.com/Itee}
   * @license [BSD-3-Clause]{@link https://opensource.org/licenses/BSD-3-Clause}
   *
   * @file Todo
   *
   * @example Todo
   *
   */var _instanceCounter$115=0;var TWarningToast=function(_React$Component){inherits(TWarningToast,_React$Component);function TWarningToast(props){classCallCheck(this,TWarningToast);var _this=possibleConstructorReturn(this,(TWarningToast.__proto__||Object.getPrototypeOf(TWarningToast)).call(this,props));_instanceCounter$115++;return _this;}/**
       * React lifecycle
       */createClass(TWarningToast,[{key:'componentWillMount',value:function componentWillMount(){}},{key:'componentDidMount',value:function componentDidMount(){}},{key:'componentWillUnmount',value:function componentWillUnmount(){}},{key:'componentWillReceiveProps',value:function componentWillReceiveProps()/*nextProps*/{}},{key:'shouldComponentUpdate',value:function shouldComponentUpdate()/*nextProps, nextState*/{}},{key:'componentWillUpdate',value:function componentWillUpdate()/*nextProps, nextState*/{}},{key:'componentDidUpdate',value:function componentDidUpdate()/*prevProps, prevState*/{}},{key:'render',value:function render(){var _this2=this;var _props=this.props,id=_props.id,className=_props.className;var _id=id||'tWarningToast_'+_instanceCounter$115;var _style={};var _class=className?'tWarningToast '+className:'tWarningToast';return react.createElement('t-warning-toast',{ref:function ref(container){_this2._container=container;},id:_id,style:_style,className:_class});}}]);return TWarningToast;}(react.Component);/**
   * @author [Tristan Valcke]{@link https://github.com/Itee}
   * @license [BSD-3-Clause]{@link https://opensource.org/licenses/BSD-3-Clause}
   *
   * @file Intermediary export file for uis/interactives/toasts folder
   *
   *//**
   * @author [Tristan Valcke]{@link https://github.com/Itee}
   * @license [BSD-3-Clause]{@link https://opensource.org/licenses/BSD-3-Clause}
   *
   * @file Intermediary export file for uis/interactives folder
   *
   *//**
   * @author [Tristan Valcke]{@link https://github.com/Itee}
   * @license [BSD-3-Clause]{@link https://opensource.org/licenses/BSD-3-Clause}
   *
   * @file Todo
   *
   * @example Todo
   *
   */var TBasicApplication=function(_React$Component){inherits(TBasicApplication,_React$Component);function TBasicApplication(props){classCallCheck(this,TBasicApplication);var _this=possibleConstructorReturn(this,(TBasicApplication.__proto__||Object.getPrototypeOf(TBasicApplication)).call(this,props));_this.state={underDialog:false,showLoginDialog:false,isLogged:false};_this.logInButtonHandler=_this.logInButtonHandler.bind(_this);_this.logOutButtonHandler=_this.logOutButtonHandler.bind(_this);_this.loginCloseHandler=_this.loginCloseHandler.bind(_this);_this.loginSubmitHandler=_this.loginSubmitHandler.bind(_this);return _this;}/**
       * Component lifecycle
       */createClass(TBasicApplication,[{key:'componentWillMount',value:function componentWillMount(){}},{key:'componentDidMount',value:function componentDidMount(){}},{key:'componentWillUnmount',value:function componentWillUnmount(){}},{key:'componentWillReceiveProps',value:function componentWillReceiveProps()/*nextProps*/{}},{key:'shouldComponentUpdate',value:function shouldComponentUpdate()/*nextProps, nextState*/{}},{key:'componentWillUpdate',value:function componentWillUpdate()/*nextProps, nextState*/{}},{key:'componentDidUpdate',value:function componentDidUpdate()/*prevProps, prevState*/{}/**
           * Component Handlers
           */},{key:'logInButtonHandler',value:function logInButtonHandler(){if(!this.state.isLogged){this.setState({underDialog:true,showLoginDialog:true});}}},{key:'logOutButtonHandler',value:function logOutButtonHandler(){if(this.state.isLogged){this.setState(function(prevState){return{isLogged:!prevState.isLogged};});}}},{key:'loginCloseHandler',value:function loginCloseHandler(){this.setState({underDialog:false,showLoginDialog:false});}},{key:'loginSubmitHandler',value:function loginSubmitHandler(event){//Todo: wait server response
  this.setState(function(prevState){return{isLogged:!prevState.isLogged,underDialog:false,showLoginDialog:false};});event.preventDefault();}/**
           * Component Methods
           *//**
           * Component Rendering
           */},{key:'render',value:function render(){var _props=this.props,id=_props.id,className=_props.className;var _id=id||'tBasicApplicationId';var _style={display:'flex',flexFlow:'column',height:'100%'};var _class=className||'tBasicApplication';return react.createElement('t-basic-application',{id:_id,style:_style,className:_class},react.createElement(THeader,null,react.createElement(TAppBar,{left:react.createElement(TBrand,{icon:'fa fa-rocket',label:'Itee'}),center:react.createElement(TMenu,null,react.createElement(TMenuItem,{id:'docsBtn',label:'Docs',tooltip:'Voir la documentation'}),react.createElement(TMenuItem,{id:'tutorialBtn',label:'Tutorial',tooltip:'Lancer le tutorial d\'utilisation'}),react.createElement(TMenuItem,{id:'viewerBtn',label:'Visualiseur',tooltip:'Voir les données'}),react.createElement(TMenuItem,{id:'uploadBtn',label:'Téléverser',tooltip:'Téléverser un fichier sur le serveur'}),react.createElement(TMenuItem,{id:'aboutBtn',label:'A propos',tooltip:'Voir les données'}),react.createElement(TDropDownMenu,{label:'MyDropdown'},react.createElement('a',{href:"#"},'Link 1'),react.createElement('a',{href:"#"},'Link 2'),react.createElement('a',{href:"#"},'Link 3'))),right:react.createElement('div',null,react.createElement(TLogingButton,{isLogged:this.state.isLogged,round:true,logInHandler:this.logInButtonHandler,logOutHandler:this.logOutButtonHandler}))})),react.createElement(TContent,null,react.createElement(TToolbar,null,react.createElement(TButtonGroup,null,react.createElement(TToolButton,{id:'importBtn',title:'Retourner à l\'acceuil',icon:'fa fa-home'}),react.createElement('li',{className:'vDivider',role:'separator'}),react.createElement(TToolButton,{id:'downloadBtn',title:'Importer un fichier local',icon:'fa fa-cloud-download'}),react.createElement(TToolButton,{id:'uploadBtn',title:'Télécharger un fichier sur le serveur',icon:'fa fa-cloud-upload'}),react.createElement('li',{className:'vDivider',role:'separator'}))),react.createElement(TSplitter,{initPosition:15,first:react.createElement(TTree,null,react.createElement(TTreeItem,{id:'fooId',name:'fooName'}),react.createElement(TTreeItem,{id:'barId',name:'barName'}),react.createElement(TTreeItem,{id:'bazId',name:'bazName'})),second:react.createElement(TViewport3D,null)})),react.createElement(TFooter,{height:40},react.createElement(TStatusBar,{state:'fixed',position:'bottom'},react.createElement(TDateTime,null))),react.createElement(TDialogArea,{isVisible:this.state.underDialog},react.createElement(TLoginDialog,{isVisible:this.state.showLoginDialog,closeHandler:this.loginCloseHandler,submitHandler:this.loginSubmitHandler})));}}]);return TBasicApplication;}(react.Component);/**
   * @author [Tristan Valcke]{@link https://github.com/Itee}
   * @license [BSD-3-Clause]{@link https://opensource.org/licenses/BSD-3-Clause}
   *
   * @file Intermediary export file for uis/templates folder
   *
   */

  /**
   * @file Todo
   *
   * @author Itee <valcketristan@gmail.com>
   * @license MIT
   */

  //import * as Client from '../node_modules/itee-client/sources/itee-client'


  (() => {

      function isObject$$1(item) {
          return item && typeof item === 'object' && !Array.isArray(item);
      }

      function mergeDeep(target, source) {

          var output = Object.assign({}, target);

          if (isObject$$1(target) && isObject$$1(source)) {

              var keys = Object.keys(source);

              for (var i = 0, n = keys.length; i < n; ++i) {

                  var key = keys[i];

                  if (isObject$$1(source[key])) {

                      if (!(key in target)) {
                          Object.assign(output, { [key]: source[key] });
                      } else {
                          output[key] = mergeDeep(target[key], source[key]);
                      }
                  } else {

                      Object.assign(output, { [key]: source[key] });
                  }
              }
          }
          return output;
      }

      // Check if webgl is available
      const message = Detector.getWebGLErrorMessage();
      if (message.innerText) {
          alert(message.innerText);
          return;
      }

      // Create App
      // Retrieve parameters
      const appContainer = document.getElementById('mainContainer');
      const appParameters = mergeDeep(window.TConfigParameters || {}, window.TUrlParameters || {});
      const appOnReady = function () {};

      const clientApp = new TApplication(appContainer, appParameters, appOnReady);

      window.addEventListener('resize', function () {

          console.log('RESIZEEEEEEEEEEEEEE');
      });
  })();

}());

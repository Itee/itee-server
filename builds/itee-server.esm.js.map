{"version":3,"file":"itee-server.esm.js","sources":["../sources/TBackendManager.js"],"sourcesContent":["/**\n * @author [Tristan Valcke]{@link https://github.com/Itee}\n * @license [BSD-3-Clause]{@link https://opensource.org/licenses/BSD-3-Clause}\n *\n * @file Todo\n *\n * @example Todo\n *\n */\n\nimport express from 'express'\nimport http    from 'http'\nimport https   from 'https'\nimport {\n    DefaultLogger,\n    TAbstractObject\n}              from 'itee-core'\n//todo: import Databases from 'itee-database'\nimport {\n    isArray,\n    isBlankString,\n    isDefined,\n    isEmptyString,\n    isNotArray,\n    isNotString,\n    isNull,\n    isUndefined\n}              from 'itee-validators'\nimport path    from 'path'\n\nclass TBackendManager extends TAbstractObject {\n\n    constructor( parameters = {} ) {\n\n        const _parameters = {\n            ...{\n                logger:       DefaultLogger,\n                rootPath:     __dirname,\n                applications: [],\n                databases:    [],\n                servers:      []\n            },\n            ...parameters\n        }\n\n        super( _parameters )\n\n        this.logger       = _parameters.logger\n        this.rootPath     = _parameters.rootPath\n        this.applications = express()\n        this.router       = express.Router\n        this.databases    = new Map()\n        this.servers      = new Map()\n        this.connections  = []\n\n        this._initApplications( _parameters.applications )\n        this._initDatabases( _parameters.databases )\n        this._initServers( _parameters.servers )\n\n    }\n    get applications() {\n        return this._applications\n    }\n    set applications( value ) {\n        this._applications = value\n    }\n    get router() {\n        return this._router\n    }\n\n    // Todo remove middleware\n    set router( value ) {\n        this._router = value\n    }\n    get databases() {\n        return this._databases\n    }\n    set databases( value ) {\n        this._databases = value\n    }\n    get servers() {\n        return this._servers\n    }\n    set servers( value ) {\n        this._servers = value\n    }\n    get rootPath() {\n\n        return this._rootPath\n\n    }\n    set rootPath( value ) {\n\n        if ( isNull( value ) ) { throw new TypeError( 'Root path cannot be null ! Expect a non empty string.' ) }\n        if ( isUndefined( value ) ) { throw new TypeError( 'Root path cannot be undefined ! Expect a non empty string.' ) }\n        if ( isNotString( value ) ) { throw new TypeError( `Root path cannot be an instance of ${ value.constructor.name } ! Expect a non empty string.` ) }\n        if ( isEmptyString( value ) ) { throw new TypeError( 'Root path cannot be empty ! Expect a non empty string.' ) }\n        if ( isBlankString( value ) ) { throw new TypeError( 'Root path cannot contain only whitespace ! Expect a non empty string.' ) }\n\n        this._rootPath = value\n\n    }\n    setApplications( value ) {\n\n        this.applications = value\n        return this\n\n    }\n    addMiddleware( middleware ) {\n\n        this.applications.use( middleware )\n        return this\n\n    }\n    setRouter( value ) {\n\n        this.router = value\n        return this\n\n    }\n    setDatabases( value ) {\n\n        this.databases = value\n        return this\n\n    }\n    addDatabase( databaseName, database ) {\n\n        this._databases.set( databaseName, database )\n        return this\n\n    }\n    setServers( value ) {\n\n        this.servers = value\n        return this\n\n    }\n    setRootPath( value ) {\n\n        this.rootPath = value\n        return this\n\n    }\n\n    _initApplications( config ) {\n\n        if ( config.case_sensitive_routing ) { this.applications.set( 'case sensitive routing', config.case_sensitive_routing ) }\n        if ( config.env ) { this.applications.set( 'env', config.env ) }\n        if ( config.etag ) { this.applications.set( 'etag', config.etag ) }\n        if ( config.jsonp_callback_name ) { this.applications.set( 'jsonp callback name', config.jsonp_callback_name ) }\n        if ( config.jsonp_escape ) { this.applications.set( 'json escape', config.jsonp_escape ) }\n        if ( config.jsonp_replacer ) { this.applications.set( 'json replacer', config.jsonp_replacer ) }\n        if ( config.jsonp_spaces ) { this.applications.set( 'json spaces', config.jsonp_spaces ) }\n        if ( config.query_parser ) { this.applications.set( 'query parser', config.query_parser ) }\n        if ( config.strict_routing ) { this.applications.set( 'strict routing', config.strict_routing ) }\n        if ( config.subdomain_offset ) { this.applications.set( 'subdomain offset', config.subdomain_offset ) }\n        if ( config.trust_proxy ) { this.applications.set( 'trust proxy', config.trust_proxy ) }\n        if ( config.views ) { this.applications.set( 'views', config.views ) }\n        if ( config.view_cache ) { this.applications.set( 'view cache', config.view_cache ) }\n        if ( config.view_engine ) { this.applications.set( 'view engine', config.view_engine ) }\n        if ( config.x_powered_by ) { this.applications.set( 'x-powered-by', config.x_powered_by ) }\n\n        this._initMiddlewares( config.middlewares )\n        this._initRouters( config.routers )\n\n    }\n\n    _initMiddlewares( middlewaresConfig ) {\n\n        for ( let [ name, config ] of Object.entries( middlewaresConfig ) ) {\n\n            if ( isNotArray( config ) ) {\n                throw new TypeError( `Invalid middlware configuration for ${ name }, expecting an array of arguments to spread to middleware module, got ${ config.constructor.name }` )\n            }\n\n            if ( this._initPackageMiddleware( name, config ) ) {\n\n                this.logger.log( `Use ${ name } middleware from node_modules` )\n\n            } else if ( this._initLocalMiddleware( name, config ) ) {\n\n                this.logger.log( `Use ${ name } middleware from local folder` )\n\n            } else {\n\n                this.logger.error( `Unable to register the middleware ${ name } the package and/or local file doesn't seem to exist ! Skip it.` )\n\n            }\n\n        }\n\n    }\n\n    _initPackageMiddleware( name, config ) {\n\n        let success = false\n\n        try {\n\n            this.applications.use( require( name )( ...config ) )\n            success = true\n\n        } catch ( error ) {\n\n            if ( !error.code || error.code !== 'MODULE_NOT_FOUND' ) {\n\n                this.logger.error( `The middleware \"${ name }\" seems to encounter internal error.` )\n                this.logger.error( error )\n\n            }\n\n        }\n\n        return success\n\n    }\n\n    _initLocalMiddleware( name, config ) {\n\n        let success = false\n\n        try {\n\n            const localMiddlewaresPath = path.join( this.rootPath, 'middlewares', name )\n            this.applications.use( require( localMiddlewaresPath )( ...config ) )\n            success = true\n\n        } catch ( error ) {\n\n            this.logger.error( error )\n\n        }\n\n        return success\n\n    }\n\n    _initRouters( routers ) {\n\n        for ( let [ baseRoute, routerPath ] of Object.entries( routers ) ) {\n\n            if ( this._initPackageRouter( baseRoute, routerPath ) ) {\n\n                this.logger.log( `Use ${ routerPath } router from node_modules over base route: ${ baseRoute }` )\n\n            } else if ( this._initLocalRouter( baseRoute, routerPath ) ) {\n\n                this.logger.log( `Use ${ routerPath } router from local folder over base route: ${ baseRoute }` )\n\n            } else {\n\n                this.logger.error( `Unable to register the router ${ routerPath } the package and/or local file doesn't seem to exist ! Skip it.` )\n\n            }\n\n        }\n\n    }\n\n    _initPackageRouter( baseRoute, routerPath ) {\n\n        let success = false\n\n        try {\n\n            this.applications.use( baseRoute, require( routerPath ) )\n            success = true\n\n        } catch ( error ) {\n\n            if ( !error.code || error.code !== 'MODULE_NOT_FOUND' ) {\n\n                this.logger.error( `The router \"${ baseRoute }\" seems to encounter internal error.` )\n                this.logger.error( error )\n\n            }\n\n        }\n\n        return success\n\n    }\n\n    _initLocalRouter( baseRoute, routerPath ) {\n\n        let success = false\n\n        try {\n\n            const localRoutersPath = path.join( this.rootPath, 'routers', routerPath )\n            this.applications.use( baseRoute, require( localRoutersPath ) )\n            success = true\n\n        } catch ( error ) {\n\n            if ( error instanceof TypeError && error.message === 'Found non-callable @@iterator' ) {\n\n                this.logger.error( `The router \"${ baseRoute }\" seems to encounter error ! Are you using an object instead an array for router configuration ?` )\n\n            }\n\n            this.logger.error( error )\n\n        }\n\n        return success\n\n    }\n\n    _initDatabases( config ) {\n\n        for ( let configIndex = 0, numberOfDatabasesConfigs = config.length ; configIndex < numberOfDatabasesConfigs ; configIndex++ ) {\n\n            const databaseConfig = config[ configIndex ]\n            const dbType         = databaseConfig.type\n            const dbFrom         = databaseConfig.from\n            const dbName         = `${ ( databaseConfig.name ) ? databaseConfig.name : `${ dbType }_${ configIndex }` }`\n\n            try {\n\n                let database = null\n\n                if ( isDefined( dbFrom ) ) {\n\n                    // In case user specify a package where take the database of type...\n                    const databasePackage = require( dbFrom )\n                    database              = new databasePackage[ dbType ]( {\n                        ...{\n                            application: this.applications,\n                            router:      this.router\n                        },\n                        ...databaseConfig\n                    } )\n\n                } else {\n\n                    //                    // Else try to use auto registered database\n                    //                    database = new Databases[ dbType ]( {\n                    //                        ...{\n                    //                            application: this.applications,\n                    //                            router:      this.router\n                    //                        },\n                    //                        ...databaseConfig\n                    //                    } )\n\n                }\n\n                // Todo move in start\n                database.connect()\n\n                this.databases.set( dbName, database )\n\n            } catch ( error ) {\n\n                this.logger.error( `Unable to create database of type ${ dbType } due to ${ error.name }` )\n                this.logger.error( error.message )\n                this.logger.error( error.stack )\n\n            }\n\n        }\n\n    }\n\n    _initServers( config ) {\n\n        const _config = ( isArray( config ) ) ? config : [ config ]\n\n        for ( let configId = 0, numberOfConfigs = _config.length ; configId < numberOfConfigs ; configId++ ) {\n\n            let configElement = _config[ configId ]\n            let server        = null\n\n            if ( configElement.type === 'https' ) {\n\n                const options = {\n                    pfx:        configElement.pfx,\n                    passphrase: configElement.passphrase\n                }\n\n                server = https.createServer( options, this.applications )\n\n            } else {\n\n                server = http.createServer( this.applications )\n\n            }\n\n            server.name            = configElement.name || `${ ( configElement.name ) ? configElement.name : `Server_${ configId }` }`\n            server.maxHeadersCount = configElement.max_headers_count\n            server.timeout         = configElement.timeout\n            server.type            = configElement.type\n            server.host            = configElement.host\n            server.port            = configElement.port\n            server.env             = configElement.env\n            server.listen( configElement.port, configElement.host, () => {\n                this.logger.log( `${ server.name } start listening on ${ server.type }://${ server.host }:${ server.port } at ${ new Date() } under ${ server.env } environment.` )\n            } )\n            server.on( 'connection', connection => {\n                this.connections.push( connection )\n                connection.on( 'close', () => {\n                    this.connections = this.connections.filter( curr => curr !== connection )\n                } )\n            } )\n\n            this.servers.set( server.name, server )\n\n        }\n\n    }\n\n    /**\n     *\n     * @param databaseKey\n     * @param eventName\n     * @param callback\n     */\n    databaseOn( databaseKey, eventName, callback ) {} // eslint-disable-line no-unused-vars\n\n    serverOn( serverName, eventName, callback ) {\n\n        this.servers[ serverName ].on( eventName, callback )\n\n    }\n\n    serversOn( serverKey, eventName, callback ) {\n\n        //TODO: filter availaible events\n        // [ 'request', 'connection', 'close', 'timeout', 'checkContinue', 'connect', 'upgrade', 'clientError' ]\n        for ( let serverKey in this.servers ) {\n            this.serverOn( serverKey, eventName, callback )\n        }\n\n    }\n\n    start() {\n\n    }\n\n    stop( callback ) {\n\n        const numberOfServers   = this.servers.size\n        const numberOfDatabases = this.databases.size\n        let shutDownServers     = 0\n        let closedDatabases     = 0\n\n        if ( allClosed() ) { return }\n\n        for ( const [ databaseName, database ] of this.databases ) {\n\n            database.close( () => {\n\n                closedDatabases++\n                this.logger.log( `Connection to ${ databaseName } is closed.` )\n\n                allClosed()\n\n            } )\n\n        }\n\n        for ( let connection of this.connections ) {\n            connection.end()\n        }\n\n        for ( const [ serverName, server ] of this.servers ) {\n\n            server.close( () => {\n\n                shutDownServers++\n                this.logger.log( `The ${ serverName } listening on ${ server.type }://${ server.host }:${ server.port } is shutted down.` )\n\n                allClosed()\n\n            } )\n\n        }\n\n        function allClosed() {\n\n            if ( shutDownServers < numberOfServers ) {\n                return false\n            }\n\n            if ( closedDatabases < numberOfDatabases ) {\n                return false\n            }\n\n            if ( callback ) { callback() }\n\n        }\n\n    }\n\n    closeServers() {\n\n    }\n\n}\n\nexport { TBackendManager }\n"],"names":[],"mappings":";;;;;;;;;;;;;;;;;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAqBA;AACA,MAAM,eAAe,SAAS,eAAe,CAAC;AAC9C;AACA,IAAI,WAAW,EAAE,UAAU,GAAG,EAAE,GAAG;AACnC;AACA,QAAQ,MAAM,WAAW,GAAG;AAC5B,YAAY,GAAG;AACf,gBAAgB,MAAM,QAAQ,aAAa;AAC3C,gBAAgB,QAAQ,MAAM,SAAS;AACvC,gBAAgB,YAAY,EAAE,EAAE;AAChC,gBAAgB,SAAS,KAAK,EAAE;AAChC,gBAAgB,OAAO,OAAO,EAAE;AAChC,aAAa;AACb,YAAY,GAAG,UAAU;AACzB,UAAS;AACT;AACA,QAAQ,KAAK,EAAE,WAAW,GAAE;AAC5B;AACA,QAAQ,IAAI,CAAC,MAAM,SAAS,WAAW,CAAC,OAAM;AAC9C,QAAQ,IAAI,CAAC,QAAQ,OAAO,WAAW,CAAC,SAAQ;AAChD,QAAQ,IAAI,CAAC,YAAY,GAAG,OAAO,GAAE;AACrC,QAAQ,IAAI,CAAC,MAAM,SAAS,OAAO,CAAC,OAAM;AAC1C,QAAQ,IAAI,CAAC,SAAS,MAAM,IAAI,GAAG,GAAE;AACrC,QAAQ,IAAI,CAAC,OAAO,QAAQ,IAAI,GAAG,GAAE;AACrC,QAAQ,IAAI,CAAC,WAAW,IAAI,GAAE;AAC9B;AACA,QAAQ,IAAI,CAAC,iBAAiB,EAAE,WAAW,CAAC,YAAY,GAAE;AAC1D,QAAQ,IAAI,CAAC,cAAc,EAAE,WAAW,CAAC,SAAS,GAAE;AACpD,QAAQ,IAAI,CAAC,YAAY,EAAE,WAAW,CAAC,OAAO,GAAE;AAChD;AACA,KAAK;AACL,IAAI,IAAI,YAAY,GAAG;AACvB,QAAQ,OAAO,IAAI,CAAC,aAAa;AACjC,KAAK;AACL,IAAI,IAAI,YAAY,EAAE,KAAK,GAAG;AAC9B,QAAQ,IAAI,CAAC,aAAa,GAAG,MAAK;AAClC,KAAK;AACL,IAAI,IAAI,MAAM,GAAG;AACjB,QAAQ,OAAO,IAAI,CAAC,OAAO;AAC3B,KAAK;AACL;AACA;AACA,IAAI,IAAI,MAAM,EAAE,KAAK,GAAG;AACxB,QAAQ,IAAI,CAAC,OAAO,GAAG,MAAK;AAC5B,KAAK;AACL,IAAI,IAAI,SAAS,GAAG;AACpB,QAAQ,OAAO,IAAI,CAAC,UAAU;AAC9B,KAAK;AACL,IAAI,IAAI,SAAS,EAAE,KAAK,GAAG;AAC3B,QAAQ,IAAI,CAAC,UAAU,GAAG,MAAK;AAC/B,KAAK;AACL,IAAI,IAAI,OAAO,GAAG;AAClB,QAAQ,OAAO,IAAI,CAAC,QAAQ;AAC5B,KAAK;AACL,IAAI,IAAI,OAAO,EAAE,KAAK,GAAG;AACzB,QAAQ,IAAI,CAAC,QAAQ,GAAG,MAAK;AAC7B,KAAK;AACL,IAAI,IAAI,QAAQ,GAAG;AACnB;AACA,QAAQ,OAAO,IAAI,CAAC,SAAS;AAC7B;AACA,KAAK;AACL,IAAI,IAAI,QAAQ,EAAE,KAAK,GAAG;AAC1B;AACA,QAAQ,KAAK,MAAM,EAAE,KAAK,EAAE,GAAG,EAAE,MAAM,IAAI,SAAS,EAAE,uDAAuD,EAAE,EAAE;AACjH,QAAQ,KAAK,WAAW,EAAE,KAAK,EAAE,GAAG,EAAE,MAAM,IAAI,SAAS,EAAE,4DAA4D,EAAE,EAAE;AAC3H,QAAQ,KAAK,WAAW,EAAE,KAAK,EAAE,GAAG,EAAE,MAAM,IAAI,SAAS,EAAE,CAAC,mCAAmC,GAAG,KAAK,CAAC,WAAW,CAAC,IAAI,EAAE,6BAA6B,CAAC,EAAE,EAAE;AAC5J,QAAQ,KAAK,aAAa,EAAE,KAAK,EAAE,GAAG,EAAE,MAAM,IAAI,SAAS,EAAE,wDAAwD,EAAE,EAAE;AACzH,QAAQ,KAAK,aAAa,EAAE,KAAK,EAAE,GAAG,EAAE,MAAM,IAAI,SAAS,EAAE,uEAAuE,EAAE,EAAE;AACxI;AACA,QAAQ,IAAI,CAAC,SAAS,GAAG,MAAK;AAC9B;AACA,KAAK;AACL,IAAI,eAAe,EAAE,KAAK,GAAG;AAC7B;AACA,QAAQ,IAAI,CAAC,YAAY,GAAG,MAAK;AACjC,QAAQ,OAAO,IAAI;AACnB;AACA,KAAK;AACL,IAAI,aAAa,EAAE,UAAU,GAAG;AAChC;AACA,QAAQ,IAAI,CAAC,YAAY,CAAC,GAAG,EAAE,UAAU,GAAE;AAC3C,QAAQ,OAAO,IAAI;AACnB;AACA,KAAK;AACL,IAAI,SAAS,EAAE,KAAK,GAAG;AACvB;AACA,QAAQ,IAAI,CAAC,MAAM,GAAG,MAAK;AAC3B,QAAQ,OAAO,IAAI;AACnB;AACA,KAAK;AACL,IAAI,YAAY,EAAE,KAAK,GAAG;AAC1B;AACA,QAAQ,IAAI,CAAC,SAAS,GAAG,MAAK;AAC9B,QAAQ,OAAO,IAAI;AACnB;AACA,KAAK;AACL,IAAI,WAAW,EAAE,YAAY,EAAE,QAAQ,GAAG;AAC1C;AACA,QAAQ,IAAI,CAAC,UAAU,CAAC,GAAG,EAAE,YAAY,EAAE,QAAQ,GAAE;AACrD,QAAQ,OAAO,IAAI;AACnB;AACA,KAAK;AACL,IAAI,UAAU,EAAE,KAAK,GAAG;AACxB;AACA,QAAQ,IAAI,CAAC,OAAO,GAAG,MAAK;AAC5B,QAAQ,OAAO,IAAI;AACnB;AACA,KAAK;AACL,IAAI,WAAW,EAAE,KAAK,GAAG;AACzB;AACA,QAAQ,IAAI,CAAC,QAAQ,GAAG,MAAK;AAC7B,QAAQ,OAAO,IAAI;AACnB;AACA,KAAK;AACL;AACA,IAAI,iBAAiB,EAAE,MAAM,GAAG;AAChC;AACA,QAAQ,KAAK,MAAM,CAAC,sBAAsB,GAAG,EAAE,IAAI,CAAC,YAAY,CAAC,GAAG,EAAE,wBAAwB,EAAE,MAAM,CAAC,sBAAsB,GAAE,EAAE;AACjI,QAAQ,KAAK,MAAM,CAAC,GAAG,GAAG,EAAE,IAAI,CAAC,YAAY,CAAC,GAAG,EAAE,KAAK,EAAE,MAAM,CAAC,GAAG,GAAE,EAAE;AACxE,QAAQ,KAAK,MAAM,CAAC,IAAI,GAAG,EAAE,IAAI,CAAC,YAAY,CAAC,GAAG,EAAE,MAAM,EAAE,MAAM,CAAC,IAAI,GAAE,EAAE;AAC3E,QAAQ,KAAK,MAAM,CAAC,mBAAmB,GAAG,EAAE,IAAI,CAAC,YAAY,CAAC,GAAG,EAAE,qBAAqB,EAAE,MAAM,CAAC,mBAAmB,GAAE,EAAE;AACxH,QAAQ,KAAK,MAAM,CAAC,YAAY,GAAG,EAAE,IAAI,CAAC,YAAY,CAAC,GAAG,EAAE,aAAa,EAAE,MAAM,CAAC,YAAY,GAAE,EAAE;AAClG,QAAQ,KAAK,MAAM,CAAC,cAAc,GAAG,EAAE,IAAI,CAAC,YAAY,CAAC,GAAG,EAAE,eAAe,EAAE,MAAM,CAAC,cAAc,GAAE,EAAE;AACxG,QAAQ,KAAK,MAAM,CAAC,YAAY,GAAG,EAAE,IAAI,CAAC,YAAY,CAAC,GAAG,EAAE,aAAa,EAAE,MAAM,CAAC,YAAY,GAAE,EAAE;AAClG,QAAQ,KAAK,MAAM,CAAC,YAAY,GAAG,EAAE,IAAI,CAAC,YAAY,CAAC,GAAG,EAAE,cAAc,EAAE,MAAM,CAAC,YAAY,GAAE,EAAE;AACnG,QAAQ,KAAK,MAAM,CAAC,cAAc,GAAG,EAAE,IAAI,CAAC,YAAY,CAAC,GAAG,EAAE,gBAAgB,EAAE,MAAM,CAAC,cAAc,GAAE,EAAE;AACzG,QAAQ,KAAK,MAAM,CAAC,gBAAgB,GAAG,EAAE,IAAI,CAAC,YAAY,CAAC,GAAG,EAAE,kBAAkB,EAAE,MAAM,CAAC,gBAAgB,GAAE,EAAE;AAC/G,QAAQ,KAAK,MAAM,CAAC,WAAW,GAAG,EAAE,IAAI,CAAC,YAAY,CAAC,GAAG,EAAE,aAAa,EAAE,MAAM,CAAC,WAAW,GAAE,EAAE;AAChG,QAAQ,KAAK,MAAM,CAAC,KAAK,GAAG,EAAE,IAAI,CAAC,YAAY,CAAC,GAAG,EAAE,OAAO,EAAE,MAAM,CAAC,KAAK,GAAE,EAAE;AAC9E,QAAQ,KAAK,MAAM,CAAC,UAAU,GAAG,EAAE,IAAI,CAAC,YAAY,CAAC,GAAG,EAAE,YAAY,EAAE,MAAM,CAAC,UAAU,GAAE,EAAE;AAC7F,QAAQ,KAAK,MAAM,CAAC,WAAW,GAAG,EAAE,IAAI,CAAC,YAAY,CAAC,GAAG,EAAE,aAAa,EAAE,MAAM,CAAC,WAAW,GAAE,EAAE;AAChG,QAAQ,KAAK,MAAM,CAAC,YAAY,GAAG,EAAE,IAAI,CAAC,YAAY,CAAC,GAAG,EAAE,cAAc,EAAE,MAAM,CAAC,YAAY,GAAE,EAAE;AACnG;AACA,QAAQ,IAAI,CAAC,gBAAgB,EAAE,MAAM,CAAC,WAAW,GAAE;AACnD,QAAQ,IAAI,CAAC,YAAY,EAAE,MAAM,CAAC,OAAO,GAAE;AAC3C;AACA,KAAK;AACL;AACA,IAAI,gBAAgB,EAAE,iBAAiB,GAAG;AAC1C;AACA,QAAQ,MAAM,IAAI,EAAE,IAAI,EAAE,MAAM,EAAE,IAAI,MAAM,CAAC,OAAO,EAAE,iBAAiB,EAAE,GAAG;AAC5E;AACA,YAAY,KAAK,UAAU,EAAE,MAAM,EAAE,GAAG;AACxC,gBAAgB,MAAM,IAAI,SAAS,EAAE,CAAC,oCAAoC,GAAG,IAAI,EAAE,sEAAsE,GAAG,MAAM,CAAC,WAAW,CAAC,IAAI,EAAE,CAAC,EAAE;AACxL,aAAa;AACb;AACA,YAAY,KAAK,IAAI,CAAC,sBAAsB,EAAE,IAAI,EAAE,MAAM,EAAE,GAAG;AAC/D;AACA,gBAAgB,IAAI,CAAC,MAAM,CAAC,GAAG,EAAE,CAAC,IAAI,GAAG,IAAI,EAAE,6BAA6B,CAAC,GAAE;AAC/E;AACA,aAAa,MAAM,KAAK,IAAI,CAAC,oBAAoB,EAAE,IAAI,EAAE,MAAM,EAAE,GAAG;AACpE;AACA,gBAAgB,IAAI,CAAC,MAAM,CAAC,GAAG,EAAE,CAAC,IAAI,GAAG,IAAI,EAAE,6BAA6B,CAAC,GAAE;AAC/E;AACA,aAAa,MAAM;AACnB;AACA,gBAAgB,IAAI,CAAC,MAAM,CAAC,KAAK,EAAE,CAAC,kCAAkC,GAAG,IAAI,EAAE,+DAA+D,CAAC,GAAE;AACjJ;AACA,aAAa;AACb;AACA,SAAS;AACT;AACA,KAAK;AACL;AACA,IAAI,sBAAsB,EAAE,IAAI,EAAE,MAAM,GAAG;AAC3C;AACA,QAAQ,IAAI,OAAO,GAAG,MAAK;AAC3B;AACA,QAAQ,IAAI;AACZ;AACA,YAAY,IAAI,CAAC,YAAY,CAAC,GAAG,EAAE,OAAO,EAAE,IAAI,EAAE,EAAE,GAAG,MAAM,EAAE,GAAE;AACjE,YAAY,OAAO,GAAG,KAAI;AAC1B;AACA,SAAS,CAAC,QAAQ,KAAK,GAAG;AAC1B;AACA,YAAY,KAAK,CAAC,KAAK,CAAC,IAAI,IAAI,KAAK,CAAC,IAAI,KAAK,kBAAkB,GAAG;AACpE;AACA,gBAAgB,IAAI,CAAC,MAAM,CAAC,KAAK,EAAE,CAAC,gBAAgB,GAAG,IAAI,EAAE,oCAAoC,CAAC,GAAE;AACpG,gBAAgB,IAAI,CAAC,MAAM,CAAC,KAAK,EAAE,KAAK,GAAE;AAC1C;AACA,aAAa;AACb;AACA,SAAS;AACT;AACA,QAAQ,OAAO,OAAO;AACtB;AACA,KAAK;AACL;AACA,IAAI,oBAAoB,EAAE,IAAI,EAAE,MAAM,GAAG;AACzC;AACA,QAAQ,IAAI,OAAO,GAAG,MAAK;AAC3B;AACA,QAAQ,IAAI;AACZ;AACA,YAAY,MAAM,oBAAoB,GAAG,IAAI,CAAC,IAAI,EAAE,IAAI,CAAC,QAAQ,EAAE,aAAa,EAAE,IAAI,GAAE;AACxF,YAAY,IAAI,CAAC,YAAY,CAAC,GAAG,EAAE,OAAO,EAAE,oBAAoB,EAAE,EAAE,GAAG,MAAM,EAAE,GAAE;AACjF,YAAY,OAAO,GAAG,KAAI;AAC1B;AACA,SAAS,CAAC,QAAQ,KAAK,GAAG;AAC1B;AACA,YAAY,IAAI,CAAC,MAAM,CAAC,KAAK,EAAE,KAAK,GAAE;AACtC;AACA,SAAS;AACT;AACA,QAAQ,OAAO,OAAO;AACtB;AACA,KAAK;AACL;AACA,IAAI,YAAY,EAAE,OAAO,GAAG;AAC5B;AACA,QAAQ,MAAM,IAAI,EAAE,SAAS,EAAE,UAAU,EAAE,IAAI,MAAM,CAAC,OAAO,EAAE,OAAO,EAAE,GAAG;AAC3E;AACA,YAAY,KAAK,IAAI,CAAC,kBAAkB,EAAE,SAAS,EAAE,UAAU,EAAE,GAAG;AACpE;AACA,gBAAgB,IAAI,CAAC,MAAM,CAAC,GAAG,EAAE,CAAC,IAAI,GAAG,UAAU,EAAE,2CAA2C,GAAG,SAAS,EAAE,CAAC,GAAE;AACjH;AACA,aAAa,MAAM,KAAK,IAAI,CAAC,gBAAgB,EAAE,SAAS,EAAE,UAAU,EAAE,GAAG;AACzE;AACA,gBAAgB,IAAI,CAAC,MAAM,CAAC,GAAG,EAAE,CAAC,IAAI,GAAG,UAAU,EAAE,2CAA2C,GAAG,SAAS,EAAE,CAAC,GAAE;AACjH;AACA,aAAa,MAAM;AACnB;AACA,gBAAgB,IAAI,CAAC,MAAM,CAAC,KAAK,EAAE,CAAC,8BAA8B,GAAG,UAAU,EAAE,+DAA+D,CAAC,GAAE;AACnJ;AACA,aAAa;AACb;AACA,SAAS;AACT;AACA,KAAK;AACL;AACA,IAAI,kBAAkB,EAAE,SAAS,EAAE,UAAU,GAAG;AAChD;AACA,QAAQ,IAAI,OAAO,GAAG,MAAK;AAC3B;AACA,QAAQ,IAAI;AACZ;AACA,YAAY,IAAI,CAAC,YAAY,CAAC,GAAG,EAAE,SAAS,EAAE,OAAO,EAAE,UAAU,EAAE,GAAE;AACrE,YAAY,OAAO,GAAG,KAAI;AAC1B;AACA,SAAS,CAAC,QAAQ,KAAK,GAAG;AAC1B;AACA,YAAY,KAAK,CAAC,KAAK,CAAC,IAAI,IAAI,KAAK,CAAC,IAAI,KAAK,kBAAkB,GAAG;AACpE;AACA,gBAAgB,IAAI,CAAC,MAAM,CAAC,KAAK,EAAE,CAAC,YAAY,GAAG,SAAS,EAAE,oCAAoC,CAAC,GAAE;AACrG,gBAAgB,IAAI,CAAC,MAAM,CAAC,KAAK,EAAE,KAAK,GAAE;AAC1C;AACA,aAAa;AACb;AACA,SAAS;AACT;AACA,QAAQ,OAAO,OAAO;AACtB;AACA,KAAK;AACL;AACA,IAAI,gBAAgB,EAAE,SAAS,EAAE,UAAU,GAAG;AAC9C;AACA,QAAQ,IAAI,OAAO,GAAG,MAAK;AAC3B;AACA,QAAQ,IAAI;AACZ;AACA,YAAY,MAAM,gBAAgB,GAAG,IAAI,CAAC,IAAI,EAAE,IAAI,CAAC,QAAQ,EAAE,SAAS,EAAE,UAAU,GAAE;AACtF,YAAY,IAAI,CAAC,YAAY,CAAC,GAAG,EAAE,SAAS,EAAE,OAAO,EAAE,gBAAgB,EAAE,GAAE;AAC3E,YAAY,OAAO,GAAG,KAAI;AAC1B;AACA,SAAS,CAAC,QAAQ,KAAK,GAAG;AAC1B;AACA,YAAY,KAAK,KAAK,YAAY,SAAS,IAAI,KAAK,CAAC,OAAO,KAAK,+BAA+B,GAAG;AACnG;AACA,gBAAgB,IAAI,CAAC,MAAM,CAAC,KAAK,EAAE,CAAC,YAAY,GAAG,SAAS,EAAE,gGAAgG,CAAC,GAAE;AACjK;AACA,aAAa;AACb;AACA,YAAY,IAAI,CAAC,MAAM,CAAC,KAAK,EAAE,KAAK,GAAE;AACtC;AACA,SAAS;AACT;AACA,QAAQ,OAAO,OAAO;AACtB;AACA,KAAK;AACL;AACA,IAAI,cAAc,EAAE,MAAM,GAAG;AAC7B;AACA,QAAQ,MAAM,IAAI,WAAW,GAAG,CAAC,EAAE,wBAAwB,GAAG,MAAM,CAAC,MAAM,GAAG,WAAW,GAAG,wBAAwB,GAAG,WAAW,EAAE,GAAG;AACvI;AACA,YAAY,MAAM,cAAc,GAAG,MAAM,EAAE,WAAW,GAAE;AACxD,YAAY,MAAM,MAAM,WAAW,cAAc,CAAC,KAAI;AACtD,YAAY,MAAM,MAAM,WAAW,cAAc,CAAC,KAAI;AACtD,YAAY,MAAM,MAAM,WAAW,CAAC,GAAG,EAAE,cAAc,CAAC,IAAI,KAAK,cAAc,CAAC,IAAI,GAAG,CAAC,GAAG,MAAM,EAAE,CAAC,GAAG,WAAW,EAAE,CAAC,EAAE,EAAC;AACxH;AACA,YAAY,IAAI;AAChB;AACA,gBAAgB,IAAI,QAAQ,GAAG,KAAI;AACnC;AACA,gBAAgB,KAAK,SAAS,EAAE,MAAM,EAAE,GAAG;AAC3C;AACA;AACA,oBAAoB,MAAM,eAAe,GAAG,OAAO,EAAE,MAAM,GAAE;AAC7D,oBAAoB,QAAQ,gBAAgB,IAAI,eAAe,EAAE,MAAM,EAAE,EAAE;AAC3E,wBAAwB,GAAG;AAC3B,4BAA4B,WAAW,EAAE,IAAI,CAAC,YAAY;AAC1D,4BAA4B,MAAM,OAAO,IAAI,CAAC,MAAM;AACpD,yBAAyB;AACzB,wBAAwB,GAAG,cAAc;AACzC,qBAAqB,GAAE;AACvB;AACA,iBAAiB,MAAM;AACvB;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,iBAAiB;AACjB;AACA;AACA,gBAAgB,QAAQ,CAAC,OAAO,GAAE;AAClC;AACA,gBAAgB,IAAI,CAAC,SAAS,CAAC,GAAG,EAAE,MAAM,EAAE,QAAQ,GAAE;AACtD;AACA,aAAa,CAAC,QAAQ,KAAK,GAAG;AAC9B;AACA,gBAAgB,IAAI,CAAC,MAAM,CAAC,KAAK,EAAE,CAAC,kCAAkC,GAAG,MAAM,EAAE,QAAQ,GAAG,KAAK,CAAC,IAAI,EAAE,CAAC,GAAE;AAC3G,gBAAgB,IAAI,CAAC,MAAM,CAAC,KAAK,EAAE,KAAK,CAAC,OAAO,GAAE;AAClD,gBAAgB,IAAI,CAAC,MAAM,CAAC,KAAK,EAAE,KAAK,CAAC,KAAK,GAAE;AAChD;AACA,aAAa;AACb;AACA,SAAS;AACT;AACA,KAAK;AACL;AACA,IAAI,YAAY,EAAE,MAAM,GAAG;AAC3B;AACA,QAAQ,MAAM,OAAO,GAAG,EAAE,OAAO,EAAE,MAAM,EAAE,KAAK,MAAM,GAAG,EAAE,MAAM,GAAE;AACnE;AACA,QAAQ,MAAM,IAAI,QAAQ,GAAG,CAAC,EAAE,eAAe,GAAG,OAAO,CAAC,MAAM,GAAG,QAAQ,GAAG,eAAe,GAAG,QAAQ,EAAE,GAAG;AAC7G;AACA,YAAY,IAAI,aAAa,GAAG,OAAO,EAAE,QAAQ,GAAE;AACnD,YAAY,IAAI,MAAM,UAAU,KAAI;AACpC;AACA,YAAY,KAAK,aAAa,CAAC,IAAI,KAAK,OAAO,GAAG;AAClD;AACA,gBAAgB,MAAM,OAAO,GAAG;AAChC,oBAAoB,GAAG,SAAS,aAAa,CAAC,GAAG;AACjD,oBAAoB,UAAU,EAAE,aAAa,CAAC,UAAU;AACxD,kBAAiB;AACjB;AACA,gBAAgB,MAAM,GAAG,KAAK,CAAC,YAAY,EAAE,OAAO,EAAE,IAAI,CAAC,YAAY,GAAE;AACzE;AACA,aAAa,MAAM;AACnB;AACA,gBAAgB,MAAM,GAAG,IAAI,CAAC,YAAY,EAAE,IAAI,CAAC,YAAY,GAAE;AAC/D;AACA,aAAa;AACb;AACA,YAAY,MAAM,CAAC,IAAI,cAAc,aAAa,CAAC,IAAI,IAAI,CAAC,GAAG,EAAE,aAAa,CAAC,IAAI,KAAK,aAAa,CAAC,IAAI,GAAG,CAAC,OAAO,GAAG,QAAQ,EAAE,CAAC,EAAE,EAAC;AACtI,YAAY,MAAM,CAAC,eAAe,GAAG,aAAa,CAAC,kBAAiB;AACpE,YAAY,MAAM,CAAC,OAAO,WAAW,aAAa,CAAC,QAAO;AAC1D,YAAY,MAAM,CAAC,IAAI,cAAc,aAAa,CAAC,KAAI;AACvD,YAAY,MAAM,CAAC,IAAI,cAAc,aAAa,CAAC,KAAI;AACvD,YAAY,MAAM,CAAC,IAAI,cAAc,aAAa,CAAC,KAAI;AACvD,YAAY,MAAM,CAAC,GAAG,eAAe,aAAa,CAAC,IAAG;AACtD,YAAY,MAAM,CAAC,MAAM,EAAE,aAAa,CAAC,IAAI,EAAE,aAAa,CAAC,IAAI,EAAE,MAAM;AACzE,gBAAgB,IAAI,CAAC,MAAM,CAAC,GAAG,EAAE,CAAC,GAAG,MAAM,CAAC,IAAI,EAAE,oBAAoB,GAAG,MAAM,CAAC,IAAI,EAAE,GAAG,GAAG,MAAM,CAAC,IAAI,EAAE,CAAC,GAAG,MAAM,CAAC,IAAI,EAAE,IAAI,GAAG,IAAI,IAAI,EAAE,EAAE,OAAO,GAAG,MAAM,CAAC,GAAG,EAAE,aAAa,CAAC,GAAE;AACnL,aAAa,GAAE;AACf,YAAY,MAAM,CAAC,EAAE,EAAE,YAAY,EAAE,UAAU,IAAI;AACnD,gBAAgB,IAAI,CAAC,WAAW,CAAC,IAAI,EAAE,UAAU,GAAE;AACnD,gBAAgB,UAAU,CAAC,EAAE,EAAE,OAAO,EAAE,MAAM;AAC9C,oBAAoB,IAAI,CAAC,WAAW,GAAG,IAAI,CAAC,WAAW,CAAC,MAAM,EAAE,IAAI,IAAI,IAAI,KAAK,UAAU,GAAE;AAC7F,iBAAiB,GAAE;AACnB,aAAa,GAAE;AACf;AACA,YAAY,IAAI,CAAC,OAAO,CAAC,GAAG,EAAE,MAAM,CAAC,IAAI,EAAE,MAAM,GAAE;AACnD;AACA,SAAS;AACT;AACA,KAAK;AACL;AACA;AACA;AACA;AACA;AACA;AACA;AACA,IAAI,UAAU,EAAE,WAAW,EAAE,SAAS,EAAE,QAAQ,GAAG,EAAE;AACrD;AACA,IAAI,QAAQ,EAAE,UAAU,EAAE,SAAS,EAAE,QAAQ,GAAG;AAChD;AACA,QAAQ,IAAI,CAAC,OAAO,EAAE,UAAU,EAAE,CAAC,EAAE,EAAE,SAAS,EAAE,QAAQ,GAAE;AAC5D;AACA,KAAK;AACL;AACA,IAAI,SAAS,EAAE,SAAS,EAAE,SAAS,EAAE,QAAQ,GAAG;AAChD;AACA;AACA;AACA,QAAQ,MAAM,IAAI,SAAS,IAAI,IAAI,CAAC,OAAO,GAAG;AAC9C,YAAY,IAAI,CAAC,QAAQ,EAAE,SAAS,EAAE,SAAS,EAAE,QAAQ,GAAE;AAC3D,SAAS;AACT;AACA,KAAK;AACL;AACA,IAAI,KAAK,GAAG;AACZ;AACA,KAAK;AACL;AACA,IAAI,IAAI,EAAE,QAAQ,GAAG;AACrB;AACA,QAAQ,MAAM,eAAe,KAAK,IAAI,CAAC,OAAO,CAAC,KAAI;AACnD,QAAQ,MAAM,iBAAiB,GAAG,IAAI,CAAC,SAAS,CAAC,KAAI;AACrD,QAAQ,IAAI,eAAe,OAAO,EAAC;AACnC,QAAQ,IAAI,eAAe,OAAO,EAAC;AACnC;AACA,QAAQ,KAAK,SAAS,EAAE,GAAG,EAAE,MAAM,EAAE;AACrC;AACA,QAAQ,MAAM,MAAM,EAAE,YAAY,EAAE,QAAQ,EAAE,IAAI,IAAI,CAAC,SAAS,GAAG;AACnE;AACA,YAAY,QAAQ,CAAC,KAAK,EAAE,MAAM;AAClC;AACA,gBAAgB,eAAe,GAAE;AACjC,gBAAgB,IAAI,CAAC,MAAM,CAAC,GAAG,EAAE,CAAC,cAAc,GAAG,YAAY,EAAE,WAAW,CAAC,GAAE;AAC/E;AACA,gBAAgB,SAAS,GAAE;AAC3B;AACA,aAAa,GAAE;AACf;AACA,SAAS;AACT;AACA,QAAQ,MAAM,IAAI,UAAU,IAAI,IAAI,CAAC,WAAW,GAAG;AACnD,YAAY,UAAU,CAAC,GAAG,GAAE;AAC5B,SAAS;AACT;AACA,QAAQ,MAAM,MAAM,EAAE,UAAU,EAAE,MAAM,EAAE,IAAI,IAAI,CAAC,OAAO,GAAG;AAC7D;AACA,YAAY,MAAM,CAAC,KAAK,EAAE,MAAM;AAChC;AACA,gBAAgB,eAAe,GAAE;AACjC,gBAAgB,IAAI,CAAC,MAAM,CAAC,GAAG,EAAE,CAAC,IAAI,GAAG,UAAU,EAAE,cAAc,GAAG,MAAM,CAAC,IAAI,EAAE,GAAG,GAAG,MAAM,CAAC,IAAI,EAAE,CAAC,GAAG,MAAM,CAAC,IAAI,EAAE,iBAAiB,CAAC,GAAE;AAC3I;AACA,gBAAgB,SAAS,GAAE;AAC3B;AACA,aAAa,GAAE;AACf;AACA,SAAS;AACT;AACA,QAAQ,SAAS,SAAS,GAAG;AAC7B;AACA,YAAY,KAAK,eAAe,GAAG,eAAe,GAAG;AACrD,gBAAgB,OAAO,KAAK;AAC5B,aAAa;AACb;AACA,YAAY,KAAK,eAAe,GAAG,iBAAiB,GAAG;AACvD,gBAAgB,OAAO,KAAK;AAC5B,aAAa;AACb;AACA,YAAY,KAAK,QAAQ,GAAG,EAAE,QAAQ,GAAE,EAAE;AAC1C;AACA,SAAS;AACT;AACA,KAAK;AACL;AACA,IAAI,YAAY,GAAG;AACnB;AACA,KAAK;AACL;AACA;;;;"}